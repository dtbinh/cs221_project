Journal Artificial Intelligence Research 50 (2014) 885-922

Submitted 4/14; published 8/14

Demand Side Energy Management via Multiagent Coordination
Consumer Cooperatives
Andreas Veit

ANDREAS @ CS . CORNELL . EDU

Department Computer Science
Cornell University
Ithaca, NY 14853 USA

Ying Xu
Ronghuo Zheng

YINGX 1@ ANDREW. CMU . EDU
RONGHUOZ @ ANDREW. CMU . EDU

Tepper School Business
Carnegie Mellon University
5000 Forbes Avenue
Pittsburgh, PA 15213 USA

Nilanjan Chakraborty

NILANJAN . CHAKRABORTY @ STONYBROOK . EDU

Department Mechanical Engineering
Stony Brook University
Stony Brook, NY 11794 USA

Katia Sycara

KATIA @ CS . CMU . EDU

Robotics Institute, School Computer Science
Carnegie Mellon University
5000 Forbes Avenue
Pittsburgh, PA 15213 USA

Abstract

key challenge creating sustainable energy-efficient society make consumer
demand adaptive supply energy, especially renewable supply. article,
propose partially-centralized organization consumers (or agents), namely, consumer cooperative purchases electricity market. cooperative, central coordinator buys
electricity whole group. technical challenge consumers make demand
decisions, based private demand constraints preferences, share
coordinator agents. propose novel multiagent coordination algorithm, shape
energy demand cooperative. coordinate individual consumers incomplete information, coordinator determines virtual price signals sends consumers induce
shift demands required. prove algorithm converges central optimal solution minimizes electric energy cost cooperative. Additionally,
present results time complexity iterative algorithm implications agents
incentive compatibility. Furthermore, perform simulations based real world consumption
data (a) characterize convergence properties algorithm (b) understand effect
differing demand characteristics participants well different price functions cost
reduction. results show convergence time scales linearly agent population
size length optimization horizon. Finally, observe participants flexibility
shifting demands increases, cost reduction increases cost reduction sensitive
variation consumption patterns consumers.
2014 AI Access Foundation. rights reserved.

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

1. Introduction
Two key issues creating sustainable energy-efficient society increase penetration
renewable sources, manage supply demand reduce demand peaks
maintaining supply demand balance. One way, commonly used, achieve
demand supply balance supply requested demand whenever occurs. However,
attempting achieve demand supply balance adjusting supply side leads use
flexible (usually diesel operated) power plants expensive, inefficient, emit large
amount carbon. alternative adjusting supply side only, adjust demand
consumers (Palensky & Dietrich, 2011) via demand response programs. Demand Response
defined changes electricity consumption end users normal consumption
patterns response changes price electricity time (Albadi & El-Saadany, 2007).
Several different forms demand response programs developed (for overview
see Albadi & El-Saadany, 2007). typical example incentive based program, customers receive payment participation, Direct Load Control programs, utilities
remotely control power consumption consumers appliances switching on/off.
small scale pilot studies, direct load control successful reducing peak energy consumption, however consumers uncomfortable yielding control appliances utility
companies (Rahimi & Ipakchi, 2010; Medina, Muller, & Roytelman, 2010). Another type demand management program price based, energy rates variable follow real cost
electricity. objective indirect method control overall demand incentivizing consumers flatten demand curve shifting energy peak off-peak times.
typical example programs Time Use pricing, price peak times
higher price off-peak times. Recent technological advances smart meters
smart appliances created potential enable direct real time participation individual
consumers energy market thus make real-time price based demand management programs
reality. However, two key problems realizing potential. First, despite presence
small pilot programs, utilities consider individual consumers insufficient size considered
demand response services. Second, consumers participate market directly, rather
utilities, stability system may compromised (e.g., herding) (Ramchurn,
Vytelingum, Rogers, & Jennings, 2012). Considering challenges, Mohsenian-Rad, Wong,
Jatskevich, Schober, Leon-Garcia (2010) argue good demand side management program
focus controlling aggregate demand (which important economic load dispatching, Wood & Wollenberg, 1996) group consumers instead individual consumers.
paper, problem coordinating group consumers called consumer cooperative
introduced studied.
consumer cooperative, collective, allows partial centralization consumers represented
group coordinator (mediator) agent, purchases electricity utilities market
behalf. consumer configurations potentially increase energy efficiency via aggregation demand reduce peak power demand. coordinator neither market maker
traditional demand response aggregator (Jellings & Chamberlin, 1993), since set energy
prices aims incur profits selling market. Rather, role akin social planners,
sense manages demand associated consumer group (a) electricity cost
group minimized, (b) individual group members autonomously decentralized
manner decide shift demands, maintaining privacy individual demand preferences
constraints. members cooperative typically geographically co-located close
proximity one another, example small neighborhood households and/or enterprises.
practice, close proximity required due limitations distribution infrastructure, geograph886

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

ically separated system operators, markets, electricity suppliers. proposed coordination
algorithm could benefit already existing structures universities, malls, industrial parks,
commercial estates, large residential complexes. Although organizations may already purchase electricity centralized manner, constituent members (e.g. firms industrial park)
currently coordinated keep constraints private.
Consumer cooperatives offer advantages energy utility companies consumers.
utility companys perspective, consumer groups large enough useful demand response programs predictable demand shifts compared individual consumers. Barbose, Goldman, Neenan (2004) give survey utility experience price based programs
conclude participants large industrial customers. individual consumers, participation energy groups allows retain control appliances. addition,
consumers obtain electricity better prices would have, purchased
electricity individually. price advantage due three reasons: First, groups size allows
group enter flexible purchase contracts, price paid consumers
reflects actual cost production accurately. case current long term fixed
contract structures (Kirschen, 2003). Second, buying collectively, group benefit
volume discounts analogous group insurance programs. Third, negotiated electricity contracts,
price usually consists two components, one reflecting actual energy production cost
premium volatility energy demand and/or supply. Buying group
help reduce premium volatility, provided demands group members
coordinated, making total demand stable.
aim paper design effective schemes coordinating electricity demand
agents purchasing electricity consumer cooperative. technical challenge
endeavor fact central coordinator know constraints individual
consumers, thus cannot compute optimal demand schedule own. Furthermore,
actual cost electricity consumption depends aggregate consumption profile agents.
However, agents may want share demand patterns constraints agents
coordinator. Therefore, present algorithm designed enable central agent coordinate consumers achieve optimal centralized load, individual agents decide
demand shifting autonomously retain private knowledge demand constraints.1
papers contributions follows. First, present iterative coordination algorithm
minimize energy cost consumer cooperative preserves privacy individual
demand constraints costs consumers. Second, prove algorithm converges
centralized optimal solution provide computational complexity results. Third, provide
formal arguments incentive compatibility coordination scheme. Fourth, present
discuss extensive simulation results based real world data. preliminary version work
appeared work Veit, Xu, Zheng, Chakraborty, Sycara (2013).
paper organized follows: Section 2 give overview related work
point differences approach paper. Section 3 formulate cost optimization problem consumer cooperative. Then, Section 4 introduce demand scheduling
algorithms consumer cooperative. particular, Section 4.1 introduce basic iterative algorithm Section 4.2 prove convergence optimal solution. Section 5,
introduce general iterative algorithm Section 5.3 prove convergence general
1. problem surface resemblance problems centralized coordinator determines resource allocations agents private preferences, coordinator tries elicit. problems typically addressed
via Vickrey-Clark-Groves mechanisms. problem differs fundamental ways discussed
Related Work section.

887

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

settings. Section 5.4, provide complexity analysis algorithms convergence Section 5.5 provide formal arguments incentive compatibility consumers. Section 6
evaluate coordination algorithms using simulations based real world consumption data.
Finally, Section 7, summarize main contributions paper offer perspective
future work.

2. Related Work
mentioned introduction, demand response programs vary classical direct load
control price based programs real time prices. paper, introduce algorithm
uses variable price signals coordinate energy consumption consumer cooperative.
Therefore, restrict discussion demand management using variable price signals.
Current literature price-based demand shaping mostly operates assumption
desirable automated autonomous system (e.g. smart meter) receives price
signals uses help consumer schedule demand minimize electricity cost,
satisfying demand preferences constraints. two types price signals
used: dynamic deterministic prices. literature price-based demand response
programs considers case deterministic prices, electricity prices time slots
known consumption. case applies long-term contracts day-ahead markets,
planning horizon sufficiently short (see Vytelingum, Ramchurn, Rogers, & Jennings, 2010;
Ramchurn, Vytelingum, Rogers, & Jennings, 2011). known electricity prices, consumers
compute consumption schedule ahead time, e.g., daily consumption plan, annual
production plan. paper falls category demand scheduling deterministic prices.
approaches demand scheduling proposed literature differ important characteristics. First, differ level problem studied secondly differ
objective demand scheduling. different levels problem studied include level single consumer, market maker, grid operator. different
objectives include minimizing cost single consumer, minimizing total cost power
generation, reducing peak-to-average ratio demand, optimizing grid stability.
papers studying demand scheduling problem level grid operators,
major concern grid stability. particular, objectives include minimization power
flow fluctuations (Tanaka et al., 2011), minimization power losses voltage deviations (Clement-Nyns, Haesen, & Driesen, 2010).
work demand scheduling done level consumers. important characteristic regime electricity prices often exogenously fixed influenced
demand scheduling; i.e., consumer price taker. Almost papers regime focus
(micro) demand scheduling one multiple appliances single residential household
commercial building, typical objective minimize incurred electricity cost. example, Chu Jong (2008) study air-conditioning load control; Pedrasa, Spooner, MacGill (2010)
optimize operation schedule various distributed energy resources including space heater
pool pump, etc. papers studying problem different perspectives. example, Philpott Pettersen (2006) Samadi, Mohsenian-Rad, Wong, Schober (2013) address
challenge uncertainty loads consumers energy consumption. stream
research close work, since well study demand management level
consumers. However, instead studying single consumer, consider group consumers
consumer cooperative, buys electricity utility company known price scheme.
work differs literature following aspects: size shift, system stability,
888

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

indirect control, and, crucially, information privacy. First, literature
considers control single consumer, practice, may difficult utility companies
grid operators deal individual consumers demand response programs. demand shift individual consumer might small magnitude compared aggregated
necessary shift. Thus, unclear whether scheme induce shift sufficient size.
contrast, utilitys perspective, consumer cooperative studied work large enough
useful demand response programs. Second, literature assumes
consumers participate markets directly. However, concerns voiced that,
without control utility companies, stability system may compromised
uncontrolled distributed interactions (Kirschen, 2003). contrast, demands consumers
consumer cooperative coordinated central coordinator minimize electricity procurement cost cooperative. Buying group helps reduce demand volatility,
coordinated demand management achieve higher stability demand reduce demand
peaks. Third, common assumption literature demand manager direct
control appliances household perfect knowledge loads operation
constraints. However, cooperative, coordinator lacks control demand scheduling
individual consumers. Moreover, demand constraints preferences private knowledge
individual consumer known either coordinator consumers.
Another stream research related work demand scheduling level market maker. contrast previous approaches, regime, coordinator (i.e., market
maker) set electricity prices consumers, often use price lever influence
demand number consumers. studies stream categorized two groups:
centralized decentralized. Dietrich, Latorre, Olmos, Ramos (2012) compare demand response programs electric system high wind penetration two different settings (i.e.,
centralized vs. decentralized) show centralized approach often reaches higher overall
cost savings, disadvantage central knowledge consumers constraints preferences necessary. partially decentralized approach avoids limitation keeps consumers
constraints preferences private achieving proven optimality solution.
coordinator uses prices incentivize consumers shift demand, coordinator
needs pay close attention possibility herding phenomenon, whereby agents move
demand towards low price times simultaneously thus cause spike demand bring
instability system. address issue, addition price signal, papers adopt
auxiliary methods make agents gradually change loads. Voice, Vytelingum, Ramchurn,
Rogers, Jennings (2011) charge agents additional fee based much change
demand profile one period next. Ramchurn et al. (2011) introduce adaptive mechanism controlling rate frequency agents allowed adapt loads
readjust demand profile. Vytelingum et al. (2010) introduce compensation signal sent
agents, providing estimate much aim change behavior.
approaches may perform well, but, unlike work, provide formal guarantees
proposed algorithms converge optimal solution. Moreover, approaches require
coordinator market maker charge consumers arbitrarily, e.g., imposing additional fees, feature may implementable acceptable practice. contrast,
coordinator akin social planner must ensure total charge energy demand
agents equal actual amount paid energy supplier.
papers address decentralized demand-side management problem game theoretic perspective. mainly focus deriving charging mechanism make consumers
reach stable demand equilibrium, achieves central objective. papers often share
889

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

underlying assumption individual consumers unit electricity cost increases consumers aggregate consumption. assumption holds setting energy cost
period increases difference demand supply (Wu, Mohsenian-Rad, & Huang,
2012) Peak-To-Average ratio (Mohsenian-Rad et al., 2010; Nguyen, Song, & Han,
2012), unit market price per period increases aggregate demand (Vytelingum, Voice,
Ramchurn, Rogers, & Jennings, 2011; Atzeni, Ordonez, Scutari, Palomar, & Fonollosa, 2013).
work Mohsenian-Rad et al. (2010), Nash equilibrium demand achieves optimality via
designed billing strategy individual cost proportional total energy cost. However, billing strategy, consumer must estimate consumers demand
making decision. Therefore, implement proposed algorithms, consumers
needs coordinate iterative manner exchange demand profiles
iteration, may cause invasions consumers privacy. works Wu et al.
(2012), Nguyen et al. (2012), Vytelingum et al. (2011) Atzeni et al. (2013), individual consumers dont need interact other, communicate central coordinator.
papers, coordinator maintains equilibrium designing unit price, based
aggregate demand. algorithm often implemented distributed iterative scheme:
iteration agents report loads coordinator coordinator updates price
accordingly. Although papers ensure minimum information exchange, none
theoretically proven algorithms would converge centralized optimal solution.
contrast, paper safeguards privacy consumers, proves algorithm
converges centralized optimal solution.
problem surface resemblance problems, central coordinator determines resource allocations agents private preferences, coordinator tries elicit.
problems typically addressed via Vickrey-Clark-Groves mechanisms. reason considering VCG-type mechanisms problem one key requirements application coordinator pay supplier groups electricity demand prices
given supplier. Thus, revenue, namely sum payments individual agents make
equal actual amount paid supplier. words, jargon mechanism design, budget balance key requirement problem. well-documented
literature VCG-type mechanisms guarantee budget balance (Green & Laffont, 1977;
Hurwicz, 1975)2 impossible design mechanism achieves three properties,
namely, efficiency, budget balance strategy-proofness. problem, addition budget
balance, allocation efficiency desired social goal. algorithm achieves budget balance (Lemma 2) allocation efficiency (Theorem 3). Although algorithm cannot guarantee
strategy-proofness, due impossibility results, prove manipulation strategy exists
dominates truth reporting (Theorem 5).

3. Problem Formulation
model, consumer group consists N members planning period divided
discrete time slots. number discrete time slots depends market price structure,
differ depending utility companies. example, = 2 time-of-use pricing
different prices day night, whereas = 24 hourly time use pricing. Let
R N matrix row matrix, ri electricity demand agent i,
2. fact, shown Ausubel Milgrom (2006), context broadcast spectrum allocation,
revenue obtained VCG-type mechanisms even zero! case, would mean agents would
pay money coordinator, making impossible pay supplier.

890

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

20

Twolevel Threshold Rate

13
12

high load

11

9

low load

7
6
5
4
0

high load
(Price: 10.34 Cents/kWh)

16
14
12
10

threshold hj

Total Cost

Marginal price pM
(j)
j

10

8

Twolevel Threshold Rate

18

(Dollars)

(Cents/kWh)

14

8

low load
(Price: 6.9 Cents/kWh)

threshold hj

6
4
2

50

100

Aggregated demand j

150

0
0

200

(kWh)

(a) Marginal electricity prices.

50

100

Aggregated demand j

150

200

(kWh)

(b) Total electricity cost.

Figure 1: Sample two-level increasing threshold pricing model used BC Hydro
{1, 2, . . . , N }. call ri demand profile agent i. entry rij electricity demand
P
agent time slot j. total aggregated demand time slot j j = N
i=1 rij . average
market price unit electricity consumer group time slot j defined pj (j ).
assume typical market price function, prices different time slot
price threshold structure. means marginal electricity prices differ among different demand levels. time slot, every unit electricity consumed specified price
threshold charged lower price, additional unit exceeding threshold charged
higher price. Thus, marginal electricity price time slot, denoted pm
j (j ), nondecreasing function total demand. marginal price given demand level payment
increment (decrement) adding (reducing) one unit electricity. Figure 1a shows example
two-level increasing threshold pricing model adopted BC Hydro.3 The(marginal price
pH
j > hj
j
two-level threshold structure formally written follows: pm
(
)
=

j
j
L
p j j hj
L
+
pH
j > pj , hj price threshold time slot j. Let x denote positive value term
x, i.e., x+ = max {0, x}, x denote negative value respectively, i.e., x = min {0, x}.
total energy cost time slot j thus integral marginal prices. Figure 1b shows total
electricity cost aggregated demand based two-level threshold pricing model. total
electricity cost computed as:
+

L
L
pj (j ) j = pH
j (j hj ) + pj (j hj ) + pj hj

(1)

demand profile agent ri must satisfy individual constraints. overall demand
consists two types loads: shiftable loads non-shiftable loads. Mohsenian-Rad et al. (2010),
Mohsenian-Rad Leon-Garcia (2010) Wu et al. (2012) model demand constraints
shiftable non-shiftable loads. example non-shiftable loads typically refrigerator
3. BC Hydro Canadian utility company. pricing model obtained www.bchydro.com.

891

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

shiftable loads include dishwasher, electric vehicles, washer/dryer, etc. appliances modeled
total demand required course planning horizon, upper lower bounds
demand time slot well earliest start latest end times. constraints form
convex set. problem, P
assume total demand agent whole
planning period fixed, i.e.,
j=1 rij = , total demand agent i. Further,
consider loads, demand constraints form convex set denote Xi .
constraint set private knowledge agent share it, neither firms
coordinator. application scenarios, agent determines energy demand profile,
consider additional costs associated demand schedule. example, given
factory energy commonly used production. Changing energy demand schedule,
therefore, may mean changing production process and, thereby, production cost. agent i,
cost denoted gi (ri ). assume cost function convex. overall cost function
P
agent
j=1 pj (j ) rij + gi (ri ).
objective minimize sum agents costs, overall energy allocation problem written as:
P
PN PM
pj (j )rij + N
min C (R) :=
i=1 gi (ri )
i=1
j=1
PM
(2)
s.t. ri Xi , j=1 rij = .
energy allocations rij optimization variables R matrix demand
profiles agents. Note problem defined convex
Xi . Although
P setP

objective function non-linear, convex following. First, N
j=1 pj (j ) rij =
i=1
PM
j=1 pj (j ) j convex non-decreasing j indicated Equation 1. Together
PM
PN
j =
j=1 pj (j ) j convex rij , i, j, (Boyd & Vandeni=1 rij , conclude
berghe, 2004). Since gi (ri ) convex, total cost function C (R) summation convex
functions convex. Thus, Problem 2 convex minimization problem.

4. Solution Approach
Although Problem 2 convex optimization problem, since constraints preferences
agents private knowledge, optimal demand profiles cannot computed directly
central coordinator. objective function, although sum individual costs agent,
coupled, price electricity time slot j depends aggregated demand
agents j . However, since constraints Problem 2 agent-specific, naturally
separable. Therefore, primal decomposition approach (Bertsekas & Tsitsiklis, 1989) used
solve problem sub-problems correspond agent optimizing energy
cost subject individual constraints. central coordinator compute appropriate
information sent agents guide demand pattern towards time slots lower
prices (this corresponds master problem primal decomposition methods).
Since agents know electricity market prices, individually optimize demand
according prices. Let resulting demand profile called uncoordinated demand
profile. Figure 2a depicts aggregated uncoordinated demand profile setting three
time slots. seen aggregated demand time slot 2 threshold, 2 > h2 ,
aggregated demand time slots 1 3 below, 1 < h1 , 3 < h3 . Thus, shift
demand time slot 2 time slots would reduce total cost group. However,
since agents dont know demand agents, cannot shift demand.
intuitive solution approach, coordinator, coordinate demand would inform
892

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

2
1.5

Threshold
h2

High price
Low price
1

h1

3

1

1
0.5
0

h3
3

3

1

2.5

h1

2

High price

Threshold
3
h3

1.5

2

1
0.5

1

2

Time slot j

3

0

Aggregated demand

3.5

h2

Low price

(c) Coordinated Scenario

4

Aggregated demand

3.5

2

3
2.5

(b) Herding Scenario

4

2
Aggregated demand j

Aggregated demand j

Aggregated demand

Aggregated demand j

(a) Initial Scenario

4
3.5

Threshold

3

2

2.5
2
1.5

High price
h
Low price 1
1

h2
3

h3

1
0.5

1

2

Time slot j

3

0

1

2

Time slot j

3

Figure 2: comparison demand profiles Uncoordinated, Herding Coordinated scenarios.
agents aggregated demand time slot. Knowing market price, agents could
solve individual optimization problems. approach problematic, agents
dont know demand constraints preferences agents group, costs
strongly depend demand agents. example, agents knowing market
price current aggregated demand could shift much demand possible supposedly
cheap time slot. would lead load synchronization, herding phenomenon, agents
shift demand supposedly cheap time slot, resulting new demand peak time slot
thus increasing total cost. effect herding phenomenon shown Figure 2b,
much demand shifted time slot 2 resulting demand threshold
time slots 1 3. Thus, key challenge design information coordinator sends
agents, virtual price signal, enable system minimize overall cost.
virtual price signal final price agents pay, information
would pay, given current aggregated demand. virtual price signal enables
agents foresee possible price increment/reduction caused demand shifting. Therefore, virtual price signal agent time slot j, svij (rij |R), function variable rij ,
denoting new demand agent time slot j. price signal computed based previous aggregate demand profile R, therefore included price function. ease
readability, time made explicit notation used proofs. superscript v indicates virtual price, contrast real market prices pj (j ). design virtual
price signal, coordinator first computes amount demand ideally shifted
time slot. shown Figure (2a), amount, denoted j , j = 1, 2, 3, difference
total aggregated demand price threshold time slot. readability,
refer j delta increment, noting delta could negative values, i.e., could
decrement. avoid herding, delta increment needs divided among agents
threshold price signal needs designed agent, price threshold
lower price threshold. serves penalize total demand time slot going threshold. Thus, agents know maximum amount demand could shift
prices solve individual optimization problem. exact calculation price
signal svij (rij |R) shown Section 4.1.2. Given price signal, virtual cost optimization
problem agent solves
P
v
min Cvi (ri |R) := min
j=1 sij (rij |R) rij + gi (ri )
P
(3)

s.t. ri Xi , j=1 rij = .
Note problem, overall problem, convex optimization problem thus solvable. However, individual constraints cost functions, agents might
able shift much demand assigned means virtual price signal.
893

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

implies aggregated demand shift less amount could achieved.
Figure 2c shows case, total demand second time slot remains threshold, whole 2 could shifted. order shift remaining demand, another
price signal, dividing remaining amount, would necessary. motivates us design
iterative algorithm coordinator update virtual price signal based consumers
feedback thus gradually adjust individual demands central optimal solution.
4.1 Basic Coordination Algorithm
present basic coordination algorithm details virtual price signal design
energy allocation setting planning horizon two time slots, = 2, cost
shifting demand, g() = 0. Although called basic setting paper, setting practical
relevance, represents commonly used Time Use pricing schemes divide
planning horizon two time slots (Albadi & El-Saadany, 2007). One time slot typically high
load high prices one time slot typically low load low prices electricity.
4.1.1 OVERVIEW LGORITHM
Recall ri denotes demand profile agent R matrix demand profiles
agents. Let r0i updated demand profile agent iteration R0 new
demand profile agents.
Initialization: agent computes initial uncoordinated electricity demand profile ri
solving Problem 3 based market prices sends coordinator.
1. coordinator adds individual demands determine aggregated demand j
time slot j calculates delta increment j demand shifted
time slot. Finally, coordinator divides demand among agents computes
virtual price signals svij (rij |R) agent time slot j.
2. coordinator sends virtual price signals agents.
3. receiving virtual price signal, agent individually calculate new demand
profiles r0i according optimization Problem 3.
4. agents send new demand profiles back coordinator.
5. coordinator compares new demand profiles old profiles. agent changed
demand profile, i.e., R = R0 , coordinator stops algorithm. Otherwise, sets R = R0
goes step (1).
4.1.2 C OORDINATION V IRTUAL P RICE IGNAL
virtual price signal one agent one time slot threshold price function demand
time slot. demand specified threshold charged low price demand
threshold charged higher price. virtual price signal therefore parameterized
H
low marginal price, pL
j , high marginal price, pj , price threshold, hij (R),
specifies demand levels prices apply. virtual price, svij , agent time slot j
computed based parameters follows
( pL h (R)+pH (r h (R))
ij
ij
j ij
j
rij > hij (R)
rij
svij (rij |R) =
(4)
L
pj
rij hij (R)
894

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

Aggregated demand iteration

1.75

Agent 1 demand r

1j

4

3.5

2
2

2.5

h2

2

2j

1

0.5

0

1

0.75
0.5
0.25

1.75

1

1

12

h12

1

r11

h11

11
1

2

Time slot j

h1

1.5

r12

1.5
1.25

0

Agent 2 demand r

Aggregated demand j

3

Agent 1 demand local optimization

r22

1.5
1.25
1

h21

0.75
0.5
0.25

22

h22

21
r21

0

2

Time slot j

Agent 2 demand local optimization

1

2

Time slot j

Figure 3: Division j among agents virtual price signal. yellow demand belongs
agent 1 red demand agent 2. 1 amount demand shifted
time slot 1, 2 indicates amount demand needs shifted time slot 2.

Agent 1 demand local optimization

1.5

r

1.25

h

1

3.5

12

12

0.75
0.5
0.25

3

h

11

r
11

0

1

2

Time slot j

Agent 2 demand local optimization


2j

1.75

Agent 2 demand r

Aggregated demand iteration

4

1.5
1.25
1
0.75
0.5

h21

r21

h22

Aggregated demand j

Agent 1 demand r


1j

1.75

r22

2.5

h2

2

1.5

2

h1
1

1

0.5

0.25
0

1

0

2

Time slot j

1

Time slot j

2

Figure 4: Demand agents local optimization. Agent 1 cannot reduce entire demand
time slot 2 (i.e., r12 > h12 ), demand constraints (left top plot). Thus,
aggregated demand time slot 1 still threshold (i.e., 01 < h1 ). Therefore, central
coordinator sends modified price signal agents algorithm continues
agents stop shifting demands.

895

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

L
v
Although prices pH
j pj derived market prices, sij called virtual price
signal, threshold hij (R) changes, agents change demand profiles.
coordinator chooses hij (R) < rij induce agents reduce demand hij (R) > rij
increase demand one time slot. ij amount coordinator wants agent change
demand time slot j, threshold hij (R) updated based demand profiles submitted
last iteration:
hij (R) = rij + ij
(5)

Thus, agents know that, current market price, change demand
time slot j ij . demand exceeding hij (R), need pay higher price.
demand, j , coordinator wants change time slot j calculated difference
current aggregated demand threshold market price:
j = hj j

(6)

Since coordinator
wants total demand change agents less j ,
P
ensure ij j . allowable shift agent proportional agents share
r
aggregated demand time slot, i.e., ij = Pj rijij . Figure 3 shows total demand

change divided among agents order create individual virtual price signals. left
side shows initial aggregated demand two agents. yellow demand belongs agent 1
red demand agent 2. Since aggregated demand threshold time slot 1 (i.e.,
1 < h1 ) threshold time slot 2 (i.e., 2 > h2 ), coordinator wants agents
shift demand time slot 2 time slot 1. amount demand shifted time
slot 1 1 , 2 amount demand shifted time slot 2. right
side shows individual thresholds agents determined central coordinator using
procedure described above. allocation demand change agents illustrated
dashed arrows. current demand agent 1 time slot 1 r11 threshold time slot
1 h11 (the notations interpreted similarly).
4.1.3 AGENT R ESPONSE V IRTUAL P RICE IGNAL
received virtual price signal, agents independently optimize demand profiles order minimize cost according Problem 3. agents objective function Cvi (ri |R)
P
v
=
j=1 sij (rij |R) rij + gi (ri ) written as:
Cvi

(ri |R) =


X



+

L
L
pH
j (rij hij (R)) + pj (rij hij (R)) + pj hij (R) + gi (ri )

(7)

j=1

Since agents pay high price pH
j demand exceeding individual threshold,
agent shift much demand, based false impression possible cost reduction. Figure 4 shows agents demand profiles individual optimization. left side shows
individual problems agents, optimized demand profile. comparison
right side Figure 3, seen agent 2 shifted whole allocated amount, agent 1
shifted part (e.g., due constraints). right side Figure 4 shows central
problem agents individual optimization. seen still demand left
shifted time slot 2 time slot 1. remaining demand would divided among
agents subsequent iteration.
896

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

4.1.4 PAYMENT RULE
algorithm converged, agents pay virtual unit price demand
time slot. last iteration virtual unit price equals average unit price aggregate demand whole cooperative, agent changed demand profile, Equation 9.
R final demand profiles whole cooperative ri final demand profile agent i,
payment agent given
paymenti =


X

svij (rij |R) rij

(8)

j=1

4.2 Convergence Basic Algorithm
section prove basic iterative procedure always converges optimal solution
L
basic setting = 2, gi () = 0 pH
j > pk , j, k. Lemma 1, show
algorithm strictly reduces cost every iteration. fact used Theorem 1 show
algorithm always converges. Then, Theorem 2 show that, = 2, gi () = 0
L
pH
j > pk , j, k, converged solution optimal solution. Subsequently, show
algorithm get stuck suboptimal solution general settings > 2 (Lemma 3)
gi () 6= 0 (Lemma 4).
Lemma 1. algorithm strictly reduces total cost every iteration: C (R0 ) < C (R).
Proof. Lets first introduce notation used throughout proof. Let R total
demand profile end iteration round R0 total demand profile end round
+ 1. Similarly, let C(R) total cost end iteration C(R0 ) total cost
end iteration + 1. virtual prices round + 1 computed central coordinator
using R. Let Cvi (ri |R) cost agent computed according virtual price signal
demands beginning round + 1 Cvi (r0i |R) end round + 1.
beginning iteration total cost consumer group based market prices
(given objective function Problem 2) equals sum individual cost agents
P
v
based virtual price signals (given Problem 3), i.e., N
i=1 Ci (ri |R) = C (R):
N X

X

svij

(rij |R) rij +

gi (ri )

i=1

i=1 j=1
N X

X

N
X

"



+
(hj j ) rij
P
=
rij rij +
rij
i=1 j=1



(hj j ) rij
P
+ pL
r

r
+
ij
ij
j
rij

# X
N
(hj j ) rij
L
P
+ pj rij +
+
gi (ri )
rij
i=1
=

pH
j

h
N
X
X
+

L
L
pH
(

h
)
+
p
(

h
)
+
p
h
+
gi (ri )
j
j
j
j
j
j
j
j
j=1

=

(9)

N X

X
i=1 j=1

i=1

pj (j ) rij +

N
X

gi (ri )

i=1

897

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

algorithm stopped, least one agent changed demand profile, i.e.,
r0i 6= ri . Agents change demand profile, reduces cost according Problem 3.
Thus, given virtual price, signal agent cost new demand profile r0i strictly lower
previous demand profile ri :

Cvi r0i |R < Cvi (ri |R)
(10)
agents
submitted new demand profile, new aggregated demand comPN
0
0
puted as: j = i=1 rij . Next, show sum agents individual cost according
virtual price signals upper bound total central cost market prices. Thus, total cost,
based new aggregated demand, lower equal sum agents individual cost,
based new demand. fact important, prevents herding behavior:
solution reduces cost agents individual problems lead worse solution
central problem. proved showing Equations 1 7 every time slot j
difference central cost aggregated demand sum agents individual
cost less equal 0. following sketch proof omitting algebraic steps
ease readability. Consult Appendix complete proof. time slot, j,
N
X

N
X
0
0
0
pj 0j rij

svij rij
|R rij

i=1

i=1

(PN
=


0
rij
hij (R) 0j
0

H
pL
rij hij (R) 0j
j pj
0

L
pH

p
r

h
(R)
0
ij
j
j
ij



+
H
0
pL
rij
hij (R)
0
j pj

i: r 0 h
PN ij ij
0 >h
i: rij
ij

hP
N

i=1
= hPN


i=1

L
pH
j pj



> hj
hj

(11)

0j > hj
0j hj



PN v 0
0 j, holds sum time slots:
0
0
Since i=1 pj j rij i=1 sij rij |R rij
P
v
0
C (R0 ) N
i=1 Ci (ri |R).
Equations 9, 10 11 conclude that:
PN

N
N
X
X
C R0
Cvi r0i |R <
Cvi (ri |R) = C (R)
i=1

(12)

i=1

Thus, total cost strictly reduced iteration.
Theorem 1. basic iterative algorithm solving Problem 2 always converges.
Proof. definition Problem 2 convex lower bound total cost
obtained sum individual initial demand profile costs market prices. Lemma
1 algorithm reduces total cost iteration. Thus, concluded
algorithm converges.

P
PN v
N
Lemma 2. real market cost, N
i=1 pj i=1 rij rij , equals virtual cost
i=1 sij (rij |R) rij
time slot j, either i, rij hij (R) i, rij hij (R).
Proof. i, rij hij (R), j hj first case Equation 11 follows cost
equal. i, rij hij (R), j hj second case Equation 11 follows cost
equal.
898

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

Theorem 2. solution R basic algorithm optimal, either following cases
A) j, R satisfies j 6= hj restrictions gi ()
B) R satisfies j, s.t. j = hj = 2, gi () = 0 high price time slot
L
greater low price time slot, i.e., pH
j > pk , j, k
Proof. prove contradiction algorithm converged solution R
satisfies Case A, solution R0 lower cost. Suppose exists solution
R0 , i.e., C(R0 ) < C(R). show contradicts convergence conditions
algorithm i, ri solution agents individual problem, ri = arg minxi Xi Cvi (xi |R).
Denote R# () = R+(1 ) R0 , (0, 1), linear combination R R0 . Since central
cost function convex C(R0 ) < C(R), C(R# ()) < C(R). j, R satisfies
j 6= hj , demand beginning iteration rij j either i, rij > hij (R)
i, rij < hij (R), j > 0 i, ij > 0 similarly j < 0 i, ij < 0.
#
#
follows, (0, 1), s.t. j, either i, rij
() hij (R) i, rij
(1 ) hij (R).


PN
#
v
= C(R# ()). Moreover,
Therefore, Lemma 2,
i=1 Ci ri () |R
P
v
C(R# ()) < C(R) Equation 9 N
i=1 Ci (ri |R) = C(R). follows,
v
v
i, s.t. Cvi r#
() |R < Ci (ri |R), conflicts ri = arg minxi Xi Ci (xi |R), i.e., ri
solution agents individual Problem.
prove contradiction algorithm converged solution R satisfies
Case B, solution R0 lower cost. Assume exists solution R0
C(R0 ) < C(R). Let 2 time slots {j, k}, 0j < j 0k > k (without loss

generality). Note pm
j (j ) > pk (k ), otherwise new cost would lower.
H
L

j = hj , k = hk pm
j (j ) = pj (as j decreases) pk (k ) = pk (as k increases).
L


market price structure pH
k > pj . follows pj (j ) < pk (k ), leads

L
H
contradiction. j 6= hj , k = hk j < hj pj (j ) = pj pm
k (k ) = pk thus
H
H
H

H


pm
j (j ) < pk (k ). j > hj pj (j ) = pj pk (k ) = pk . pk > pj ,
otherwise shift j k would beneficial least one agent algorithm would

stopped. follows pm
j (j ) < pk (k ), leads contradiction. case
j = hj , k 6= hk works similarly.
follows R optimal solution, solution lower cost exists. Thus, proposed iterative algorithm converges optimal solution. Since problem convex solution global optimal solution (Boyd & Vandenberghe, 2004).
Lemma 3. basic algorithm could converge suboptimal solution R settings, R
satisfies j, s.t. j = hj , > 2 gi () = 0.
Proof. prove presenting counterexample basic algorithm converge
suboptimal solution settings, R satisfies j, s.t. j = hj , > 2 gi () = 0. Consider
population 2 agents, N = 2, planning horizon 3 time slots, = 3. agents
constraints form converged solution aggregated demand
threshold one time slot, directly threshold another time slot one time slot
threshold.
Let price function three time slots given as:
H
L H
L H
(pL
1 , p1 ) = (3, 6), h1 = 10; (p2 , p2 ) = (2, 5), h2 = 10; (p3 , p3 ) = (1, 4), h3 = 10;

899

fi8
6

p1H=6

p2H=5

p3H=4

p1L=3

p2L=2

p3L=1

(KWh)

10

demand agent 1

demand agent 1

(KWh)

V EIT, X U , Z HENG , C HAKRABORTY, & YCARA

4
2
0

1

2

3

10
8
6
4
2
0

1

(KWh)

10
8
6
4
2
0

1

2

2

3

time slot

demand agent 2

demand agent 2

(KWh)

time slot

3

time slot

10
8
6
4
2
0

1

2

3

time slot

(b) Optimal Solution R0

(a) Converged Solution R(T )

Figure 5: Converged Optimal solution example Lemma 3. top row shows
demand agent 1 bottom row demand agent 2. dashed lines indicate upper
lower bounds demands agents time slot. solid black lines show price
thresholds time slot.
individual constraints agents demand are: (a) upper lower bounds demand
time slot (b) constant total demand time slots. Specifically,
r11 [1, 4], r12 [1, 9], r13 [1, 9], r11 + r12 + r13 = 1 = 17
r21 [1, 9], r22 [1, 9], r23 [8, 9], r21 + r22 + r23 = 2 = 17
Let R(t) denote demand profile agents tth iteration let = 1 initial
iteration = final iteration convergence. beginning agents compute
(1)
(1)
initial demand profiles based market
prices r1 = (1, 7, 9), r2 = (1, 7, 9). cost based

initial demand profiles C R(1) = 88. convergence, profiles two agents
(T )

(T )

r1 = (4, 5, 8), r2 = (4, 5, 8) (see Figure 5a graphical representation). cost based
demand profiles C R(T ) = 78. However, different demand profile agents exists
r01 = (4, 7, 6), r02 = (6, 3, 8) (see Figure 5b graphical representation). profile
feasible leads lower total cost, i.e., C (R0 ) = 76. follows algorithm stopped
suboptimal solution.

Lemma 4. basic algorithm could converge suboptimal solution R settings, R
satisfies j, s.t. j = hj , = 2 gi () 6= 0.
Proof. Appendix B counterexample presented, proving basic algorithm converge
suboptimal solution settings, R satisfies j, s.t. j = hj , = 2 gi () 6= 0.
900

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

5. General Coordination Algorithm
previous sections introduced basic iterative coordination algorithm optimal energy
allocation basic setting planning horizon two time slots, = 2, cost
shifting demand, g() = 0. Moreover, presented counter examples showing that, general
settings > 2 g() 6= 0, algorithm get stuck suboptimal solution.
section, present general coordination algorithm energy allocation general settings
two time slots non-zero individual costs shifting demand.
5.1 Additional Phase
reason convergence suboptimal solution coordinator cannot determine
agents marginal valuation demand, aggregated demand time slot
threshold. agents might different marginal valuations, shift agent
lower valuation agent higher valuation might beneficial. However, opportunity
improvement cannot realized, coordinator know marginal valuations
agents.
introduce additional phase algorithm address problem. basic
algorithm converged, coordinator checks whether aggregated demand threshold
least one time slot. case, algorithm stops solution optimal.
However, demand threshold time slot, coordinator initiates another phase.
basic idea that, besides virtual price signal, coordinator sends additional query
agents, requesting valuations -increase -decrease threshold time
slots, aggregated demand threshold. Then, coordinator uses information
adjust virtual price signals.
+
Let vij
denote value agent -increase threshold time slot j. Let
ij+
R
demand profile, resulting price signal agent
time slot
threshold

j+
v
ij+
ij+
virtual cost,
j increased , i.e., hij (R ) = hij (R) + . Moreover, let Ci ri |R
threshold time slot j increased .
Definition 1. Agent marginal valuation -increase threshold time slot j
difference virtual cost original virtual problem virtual problem
-increased threshold time slot j. valuation -decrease defined analogously.







j

+
ij+
0
v
ij
vij
(R) = Cvi rj+
|R

C
r
|R
;
v
(R)
=
C
r
|R
Ci r0i |R .




ij


(13)

agents receive virtual price signal query marginal valuations,
first compute optimal demand profile r0i , based price signal. Second, compute
+

marginal valuations vij
(R) vij
(R) every time slot, aggregated demand
+
threshold. Let vector vi consist valuations -increments vi decrements
respectively. Finally, agents send ri , vi+ vi back coordinator.
received agents information, coordinator computes virtual price signals
next iteration. aggregated demand thenthreshold,
finds agents lowest

+
cost -increase threshold: l = arg mini vij lowest cost -decrease
n


+
threshold: k = arg mini vij
. combined cost negative vkj
+ vlj
< 0, beneficial shift
901

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

agent l agent k exists. case, coordinator updates thresholds agents l, k
lj = , kj = .
algorithm stops, demand threshold time slot time slots

+
thresholds pair {l, k} exists vkj
+ vlj
< 0. follows, algorithm converges,
every time slot aggregated demand threshold, j = hj , agents, cost
reduction -increase threshold less additional cost -decrease
threshold agents, i.e.,
+

vlj
vkj
, l, k {1, ..., N } j s.t. j = hj .

(14)

Otherwise, coordinator would change price signals algorithm would stop.
5.2 General Algorithm
general algorithm designed iterative algorithm, coordinator updates virtual
price signals based consumers feedback thus gradually adjusts individual demands
central optimal solution. overall algorithm shown Algorithm 1. iteration
consists two steps: First, central coordinator aggregates demand submitted agents
computes virtual price signals agent. virtual price signals computed
subroutine CalculateVirtualPriceSignals (Algorithm 2). Second, individual agents use
virtual price signal solve individual cost optimization problem compute marginal
valuation electricity demand report coordinator. agents response
computed CalculateDemandProfileAndValuation (Algorithm 3).
general algorithm first runs basic algorithm convergence subsequently
performs additional phase, necessary. particular, additional phase performed, basic algorithm converged (Algorithm 1 line 8) least one time slot aggregated demand
threshold (Algorithm 1 line 9). algorithm reaches optimal solution R =
+

R0 either j 6= hj , j additional phase vlj
vkj
, l, k {1, ..., N }, j s.t. j = hj .
5.3 Convergence General Algorithm -optimal Solution
Please note Theorem 1 still holds general algorithm, algorithm still reduces
total cost iteration. Thus, extended algorithm converges. Theorem 3 prove
solution general algorithm lies within -neighborhood optimal solution.
Theorem 3. converged solution R general algorithm lies within neighborhood
optimal solution R , amount agents compute marginal valuations.
Proof. prove contradiction general algorithm converged solution R, solution R0 exists lower cost respect central Problem 2
outside -neighborhood around R. Suppose exists solution R0 lower total energy cost R, i.e., C(R0 ) < C(R). show contradicts convergence
conditions general algorithm i, ri solution agents individual problem,
+

ri = arg minxi Xi Cvi (xi |R), vlj
vkj
, l, k {1, ..., N } j s.t. j = hj .
case left Theorem 2 j, j = hj , implies i, rij = hij (R),




0 > h (R) k K, r 0 < h (R), l, k s.t. r 0 r
L, K 6= , s.t. l L, rlj
lj
lj
kj
lj
kj


0

, firkj
rkj . show case conflicts convergence conditions, too.
902

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

Algorithm 1: Overall algorithm.
Data: Scenario electricity contract agent definitions.
Result: Optimal demand schedule R .
1
2
3
4

5
6

7
8
9
10
11
12
13
14
15
16
17
18
19
20
21

Initialization: agents compute initial energy demand profile ri solving Problem 3
based market prices send coordinator.;
addP hase = f alse;
demand schedule R optimal
Coordinator calculates price signals using Algorithm 2:
svij (rij |R) , i, j CalculateVirtualPriceSignals (ri , vi+ , vi , addP hase);
coordinator sends virtual price signals agents;
Agents calculate demand profiles valuations time slots, j, using Algorithm 3:
i: r0i , vi+ , vi CalculateDemandProfileAndValuation (svij (rij |R), addP hase);
agents send new demand profiles valuations back coordinator;
algorithm converged, i.e., R = R0
j 6= hj , j
demand schedule R0 optimal;
else
+

addP hase vlj
vkj
, l, k {1, ..., N }, j s.t. j = hj
demand schedule R0 optimal;
else
start additional phase, i.e., addP hase = true;
end
end
else
R R0 ;
end
end




#
() rlj =
start case |L| = |K| = 1. (0, 1), s.t. firlj


#

firkj () rkj = . Moreover, denote R## () s.t.,
##
rit


() =

#
rit
() L K, = j
rit
otherwise

demand profile reflecting changes demand time slot j resulting individ#
#
ual problems agents demand threshold, rlj
= hlj (R## ) rkj
=
##
hkj (R ). Thus, Lemma 2 get sum virtual cost equal central cost.
N
X







#
#
v
v
##
##
Cvi r#
()
|R
+
C
r
()
|R
()
+
C
r
()
|R
()
l
k

l
k

i=1,i6=l,k

=

C(R# ()) < C(R) =

N
X

Cvi (ri |R)

i=1

903

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

Algorithm 2: Calculation virtual price signal coordinator.
1

2
3
4

CalculateVirtualPriceSignals (ri , vi+ , vi , addP hase);
Data: demand profiles valuations agents, ri vi+ , vi , i.
Result: virtual price signals agents, svij (rij |R) , i, j.
P
Compute aggregated demand: j N
i=1 rij ;
Compute demand shifted time slot: j hj j ;
r
Divide demand among agents: ij Pj rijij ;


5
6
7
8
9
10
11

addP hase
n

+

Find time slot j agents l, k s.t. min vlj
vkj
;
+

vlj
+ vkj
< 0
Adapt demand shifted agent l: lj agent k: kj ;
end
end
Compute thresholds based demands shifted: hij rij + ij ;

Algorithm 3: Calculation individual demand profiles marginal valuation energy
agent i.
1 CalculateDemandProfileAndValuation (sv
ij (rij |R), addP hase);
Data: virtual price signal svij (rij |R), j = 1, . . . , .
Result: new demand profile r0i valuations vi+ , vi .
2
3
4
5
6
7
8

Compute new demand profile r0i according virtual price signal:
ri = arg minxi Xi Cvi (xi |R);
addP hase
foreach time slot j threshold, rij = hij



+
ij+ Cv (r0 |R);
Compute valuation increased threshold: vij
Cvi rj+
|R




ij Cv (r0 |R);
Compute valuation decreased threshold: vij
Cvi rj

|R

end
end

implies either
N
X



Cvi r#
() |R <

i=1,i6=l,k



N
X

Cvi (ri |R)

i=1,i6=l,k



v
i, s.t. Cvi r#
() |R < Ci (ri |R)

conflicts convergence condition ri = arg minxi Xi Cvi (xi |R);








#
v
##
##
Cvl r#
()
|R
()
+
C
r
()
|R
()
< Cvl (rl |R) + Cvk (rk |R)
k
l
k


h


##
##
Cvl r#
() Cvl (rl |R) < Cvk r#
() Cvk (rk |R)
l () |R
k () |R

904

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT







#

## () equal Cv rj+ |Rij+
firkj
() rkj = get Cvl r#
()
|R

l
l
l




## () equal Cv rj |Rij . Thus, Equation 13 follows
Cvk r#
k
k () |R
k
+

vlj
(R) < vkj
(R)

+

conflicts convergence condition, l, k {1, 2, , N }, vlj
(R) vkj
(R).
general case |L| , |K| 1, get
N
X




X
X

##
##
()
() +
Cvk r#
Cvl r#
Cvi r#
() |R +
k () |R
l () |R

i=1,iLK
/

=

kK



C(R# ()) < C(R) =

N
X

Cvi (ri |R)

i=1

implies either
N
X
i=1,iLK
/



i, s.t. Cvi

N
X



Cvi r#
()
|R
<


Cvi (ri |R)

i=1,iLK
/



r#




() |R <

Cvi

(ri |R)

conflicts convergence condition ri = arg minxi Xi Cvi (xi |R);

X


X

X
X
#
v
##
##
Cvk (rk |R)
Cvl r#
()
|R
()
+
C
r
()
|R
()
<
Cvl (rl |R) +
k
l
k





X


kK

Cvl





kK

"
#
X

X
X
##
##
r#
()
Cvl (rl |R) <
Cvk r#
()
Cvk (rk |R)
l () |R
k () |R


kK

kK

Since amount demand increased time slot j equal demand decreased, cost
decrease LHS greater increase cost RHS, exists pair agents,
l, k marginal cost decrease l larger marginal cost increase k
+

l L, k K, vlj
(R) < vkj
(R)

+

conflicts convergence condition, l, k {1, 2, , N }, vlj
(R) vkj
(R).

solution R lies within neighborhood optimal solution R , amount
agents compute marginal valuations. beneficial shift size greater
equal exists more, algorithm stops. However, beneficial shift smaller might
still exist.
5.4 Convergence Time Algorithm
section, give upper bound number steps algorithm needs converge.
First, give bound basic algorithm Lemma 5 extended phase Lemma 6.
Second, give bound general algorithm Theorem 4.
905

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

Lemma 5. basic algorithm converges within maximum log N e steps, N
number agents distance converged solution optimal solution basic
algorithm.
Proof. prove showing upper bound number iterations needed one time
slot, say, time slot j, get initial demand level neighborhood optimal
demand level basic algorithm. sufficient, demand last time
slot reached optimal level, demand time slots reached optimal level.
proof consider time slot initial demand optimal demand.
sufficient, every shift consists demand decrease least one time slot
increase least one time slot. Thus, time slots optimal demand
level, reached optimal level, remaining time slots reached optimal levels.
Since variables proof time slot j, omit subscript j increased readability. Let Dt difference optimal aggregated demand aggregated demand
iteration t. Since demand assumed optimal demand, Dt > 0. Without
loss generality, assume initial value Dt 1 (D0 = 1) optimum 0;
agent i, initial demand rij = 1. worst case one agent (e.g., agent 1) increase
demand. case, agent 1 increase demand iteration, increment
equals amount demand shift assigned coordinator.
denote increment agent 1s demand iteration ct agent 1s demand
iteration (c0 = 1). N denoting total number agents, demand shift assigned
r
agent given based definition price signal ij = PNj ij . Then,
i=1 rij

agent 1s increment

ct1 Dt1
.
(15)
N 1 + ct1
Agent 1s demand iteration initial demand plus increments first iterations.
Similarly, difference Dt initial difference minus agent 1s increments.
=

ct = 1 +


X

al , Dt = 1

l=1


X

al = ct ct1 = Dt + Dt1 , ct = 2 Dt .

l=1

substituting Equation 15,
(2 Dt1 ) Dt1
N + 1 Dt1
2
= 2Dt1 Dt1
(N 1) Dt1
=
N + 1 Dt1

Dt + Dt1 =
2
(N + 1) (Dt + Dt1 ) + Dt Dt1 Dt1

Dt
Since n 1, Dt (0, 1), get



(N 1) Dt1
N 1 n
Dt <
Dt <
N
N


l

log

Thus, > 0, = loglogN1 = log N
log(N 1) , s.t., > , Dt < . Moreover,
N

since logarithm strictly increasing concave, log N log (N 1) >
> 0, = log N e, s.t., > , Dt < .
906

1
N.

Thus,

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

Lemma 6. extended phase converges maximum within number
0

l

(C0 C )
v



steps,



C total cost solution basic algorithm, C total cost optimal
solution v minimum value marginal valuations -increase decrease
threshold one time slot.
Proof. prove showing upper bound number iterations needed reduce
total cost solution basic algorithm, i.e., C0 , total cost optimal
solution, i.e., C . iteration extended phase, thresholds adapted two agents,

+
say k, j. Thus, total cost reduced vkj
+ vlj
(Equation 13). Let v minimum value

+
vkj + vlj . Then, long algorithm converge, iteration, total cost
l 0
reduced least v . Thus, algorithm stops within (C vC ) steps.
Theorem 4. time complexity general algorithm lies O(N + (C0 -C )), i.e., algorithm linear number agents pseudopolynomial (C 0 C ).
Proof. Lemma 5 get upper bound number iterations basic algorithm
dN log e. log constant, independent N , time complexity
basic algorithm O(N
l 0 ).
Lemma 6 get upper bound number iterations
(C C )
extended phase
. cost difference (C0 C ) depend N ,
v
specific characteristics agents. minimum valuation v proportional size
threshold increment/decrement . Thus v constant constant choice . Thus,
bound extended phase pseudopolynomial (C0 C ).
5.5 Incentive Compatibility
general, allocation problems, three key properties interest, namely, efficiency,
strategy-proofness, budget-balance. context problem, efficiency implies
overall electricity consumption cost minimized. Strategy-proofness implies telling truth
dominant strategy agents hence report truthfully. Budget-balance implies
total amount paid members cooperative equal actual electricity consumption cost. two well known facts three properties literature: First,
allocation efficient, way implement payments guarantee strategy-proofness
use VCG-type mechanisms, see work Green Laffont (1977), Hurwicz (1975). Second, Green Laffont (1977) Hurwicz (1975) prove, payments obtained VCG-type
mechanisms cannot achieve budget balance. Thus, impossible design mechanism
achieves three properties, namely, efficiency, budget balance strategy-proofness.
stated discussion related work section, budget balance key requirement problem application point view. Furthermore, allocation efficiency desired social goal. algorithm achieves budget balance (Lemma 2) allocation efficiency
(Theorem 3). Therefore, impossibility results, cannot achieve strategy-proofness, i.e.,
truth telling cannot dominant strategy. However, believe agent may choose truthfully respond, agents cannot anticipate future development algorithm and,
prove below, manipulation strategy exists dominates truth reporting. Therefore, define
notion weak incentive compatibility.
Definition 2. algorithm satisfies weak incentive compatibility weakly incentive compatible,
strategy dominates telling truth algorithm.
907

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

Theorem 5. general algorithm weakly incentive compatible.
Proof. algorithm agents two possible ways deviate truthful reporting: First,
could report demand profile minimize individual cost according
current virtual price signals intent misreporting would benefit final
payment. Second, could report marginal valuations differ true marginal valuations. analysis assume rational agents, i.e., agents always prefer lower cost.
Note payment rule (Equation 8) agent pays electricity demand based
final price signal. iteration, truthful demand report minimizes agents cost given
price signal. Therefore, agent report truthfully final price signal (i.e., final
iteration) incur higher cost. Furthermore, agents know whether given price
signal final price signal not. is, agents limited knowledge
know demand profiles agents constraints preferences. Thus, manipulation
iteration may result higher cost truthful report. Therefore, manipulation strategy
involving misreported demand profiles dominates truthful reporting.
Regarding reporting marginal valuations (Definition 1), obvious deflating
valuation hurts agent. demonstrate extension example Lemma 3,
deviating truth revelation inflating reported marginal valuation hurt
agent. aggregated demand threshold time slot 2 coordinator asks
agents valuations -increase threshold. Without loss generality assume = 1.
+
L
= pH
Agent 1s true valuation (reduce time slot 3 increase 2) v12
3 p2 = 2 agent 2s
+
L
(reduce time slot 1 increase 2) v22 = pH
1 p2 = 1. Lets assume agent 2 misreports
+
valuation v22 > 2. Then, coordinator increases threshold time slot 2 agent 2
decreases threshold agent 1. follows agent 1 shift demand time slot 2
time slot 3 agent 2 shift demand time slot 1 time slot 2. leads
demand profiles: rdeviate
= (4, 4, 9), rdeviate
= (3, 6, 8). However, profile
1
2
lead increase total cost, increase individual cost deviating
agent 2. Table 1 shows individual cost.4 Since misreporting valuations may result higher
electricity cost truthful report misreporting agent, manipulation strategy involving
misreported marginal valuations dominates truthful reporting.
cost
truthful reports
agent 2 deviates

agent 1s cost
37.143
40.118

agent 2s cost
38,857
38.882

total cost
76
79

Table 1: Cost different demand profiles individual agents.

6. Simulation
perform simulations based real world consumption data (a) characterize convergence
properties algorithm (b) understand effect different parameters characterize
electricity demand profile cost reduction coordination algorithm.
results show algorithm scales linearly number agents time slots. Further,
observe participants flexibility shifting demands increases, cost reduction
4. Since Agent 2s deviation increases agent 1s well agent 2s cost, one might argue increasing
agents cost could incentive deviation. However, note cost agent visible others.
Therefore, believe agent may choose report truthfully.

908

fielectricity price (Euro cents/kWh)

ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

dayahead
spot market
price

6

4

2

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

Figure 6: Day-ahead spot market prices EPEX Spot average Tuesday 2013
increases well cost reduction sensitive whether consumers use
electricity evening day.
6.1 Datasets
CER Electricity Consumption Data: use real electricity consumption data generate consumer demand profiles. data gathered Irish Commission Energy Regulation
(CER) context smart metering study. study, electricity consumption data
485 small medium enterprises 4, 225 private households collected period
1.5 years. observation period divided time intervals 30 minutes. One data
point represents average electricity consumption kilowatts one participant 30
minute interval. particular, used data 46 enterprises. participating enterprises
answered questionnaires about, among others, number employees typical hours
operation. refer data set CER data set5 .
EEX Electricity Prices Market Data: generate cooperatives electricity prices using real
day-ahead market electricity prices, gathered European Energy Exchange (EEX),
leading energy exchange Europe. particular, use average hourly day-ahead
prices EPEX Spot market 20 Tuesdays January 1st 2013 May 14th 2013.
Figure 6 shows average day-ahead spot market prices observation period. refer
hourly market price data EEX data set6 .
6.2 Simulation Parameters
model work Mohsenian-Rad et al. (2010), weP
define agent predetermined total electricity demand planning horizon, =
r , upper lower
h j=1 iji
bounds electricity demand time slot, i.e., rij rij , rij . Regarding individual cost functions gi , assume gi = 0, data industry specific cost
functions.
5. data set available http://www.ucd.ie/issda/data/commissionforenergyregulation/.
6. data available http://www.eex.com/en/Market%20Data.

909

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

6.2.1 ODELING C OMPOSITION C OOPERATIVES :
Agents variety different demand characteristics. reflect diversity, use
CER data set identify two classes consumers similar characteristics. group
consumers similar characteristics, clustered participants study using k-means
clustering based information questionnaires electricity consumption data.
particular, used consumption profiles Tuesdays, Tuesday average
work day. Here, Class 1 represents consumers consuming electricity day,
whereas Class 2 represents consumers stable consumption day, higher
consumption night. Based classes, cooperatives varying compositions simulated. parameter p fracAgent defines composition cooperative specifying
fraction agents Class 1 (and Class 2 1 p f racAgent).
6.2.2 G ENERATING N OMINAL EMAND AGENTS :
agents nominal demand value around agent vary demand. simulate
scenarios {12, 24, 48} time slots use time intervals 30, 60 120 minutes,
generate interpolating averaging data points two data sets. Then, j = 1
represents first j = last time slot day. get different agents, nominal
demand agent time slot outcome xij random variable XCj . Let Cj

mean average demands participants class C time slot j let Cj
corrected sample standard deviationof average
demands. Thenominal demand drawn
uniform distribution XCj U Cj Cj , Cj + Cj . distributions XCj
two Classes
shown Figure 7. total demand agent whole day, computed
P
x
=
j=1 ij .
6.2.3 ODELING F LEXIBILITY C ONSUMERS :
Agents different flexibilities changing demand profiles. Here, ability expressed agents upper lower bound constraints electricity demand
time slot. parameter p flexShift defines flexibility agents specifying percentage, agents vary demands nominal demand. Thus,
larger p f lexShif t, apart upper lower bounds. parameter
agents fixed one scenario. Based flexibility nominal demand, upper
lower bounds computed
rij = xij (1 p f lexShif t)
rij = xij (1 + p f lexShif t)

(16)

6.2.4 ODELING E LECTRICITY P RICE :
cooperatives electricity price function time slot defined marginal price
H
low load, pL
j , high load, pj , price threshold, hj , specifying demand
levels marginal prices apply. use prices EEX data set exemplar prices
H
generate pL
j pj . Let mpj average spot market price EPEX Spot time slot j.
910

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

14

14
exemplary
nominal
demand

10

12

electricity demand (kW)

electricity demand (kW)

12

distribution
nominal
demand

8

6

4

10

2

0

8

6

4

2

0

2

4

6

8

10

12

14

16

18

20

22

0

24

0

2

4

6

time slot

8

10

12

14

16

18

20

22

24

time slot

(a) Class 1 - day consumer

(b) Class 2 - night consumer

Figure 7: Distributions nominal demand two different consumer classes.
compute marginal electricity prices
pL
j = mpj
pH
j = mpj +

max

x{1,...,M }

{mpx }

min

x{1,...,M }

(17)

{mpx }

keep marginal prices fixed across simulations. However, price thresholds may
vary across different simulation scenarios. example, price threshold could
aggregated nominal demand demand increased could
demand reduced. parameter p distThresh defines distance
aggregated nominal demand price thresholds specifying percentage thresholds
aggregated nominal demand. negative value p distT hresh,
thresholds lie positive value lie aggregated nominal demand.
scenario one fixed value time slots. Figure 8a illustrates scenarios
different values p distT hresh. addition, price thresholds could either different
time slot (e.g., following profile aggregated nominal demand) could
time slot (flat thresholds). Here, compute flat thresholds defining moving
average aggregated nominal demand. parameter p flatThresh defines flatness
threshold specifying width interval thresholds flattened
moving average. p f latT hresh = 0 thresholds follow exactly aggregated nominal
demand, whereas p f latT hresh = thresholds every time slot. Figure 8b
illustrates scenarios different values p f latT hresh. thresholds computed
1
hj =
1 + 2p f latT hresh

j+p f latT
X hresh
jp f latT hresh

!
(1 + p distT hresh)

X

xij

(18)



6.2.5 IMULATION CENARIOS :
create different scenarios, vary input parameters follows: p f racAgent {0, 0.25, 0.5,
0.75, 1}, p f lexShif {0.1, 0.2, 0.3}, p f latT hresh {0, 12, 24}, p distT hresh {0.2,
911

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

500

500
values
p_distThresh
0.2

400

0
0.1

300

0.2

200

100

0

0

400

0.1

aggregated demand (kW)

aggregated demand (kW)

values
p_flatThresh

6
24

300

200

100

0

2

4

6

8

10

12

14

16

18

20

22

0

24

time slot

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Price thresholds different values p distT hresh. (b) Price thresholds different values p f latT hresh.

Figure 8: Price thresholds different values parameters p distT hresh p f latT hresh.

0.1, 0, 0.1, 0.2}, #agents {20, 40, 60, 80, 100}, {12, 24, 48} {0.5, 1, 2}.
leads 3375 different scenarios. define algorithm converged, cost reduction
one iteration gets less 0.00001%, i.e., C (R) / C (R0 ) < 1.0000001.
6.3 Simulation Results
first present effects different parameters cost reduction algorithm
subsequently discuss convergence time.
Definition 3. cost reduction difference cost uncoordinated profile C0
(chosen agent optimizing cost according market price)
coordinated

profile C percentage cost uncoordinated profile, i.e., CR = C0C0C 100.
Figure 9 shows subset results p f racAgent {0, 0.5, 1}, = 24, #agents = 40
= 1. Figure 9a shows cost reduction cooperatives consisting consumers mainly
consuming electricity night. Figure 9b shows cost reductions cooperatives consist
consumer classes equal proportions. Finally, Figure 9c shows cost reductions cooperatives consisting consumers main demand day. x-axis represents
flexibility shifting demand, y-axis flatness thresholds z-axis height
thresholds. figures scenarios high cost reduction (white) scenarios
less cost reduction (dark red). scenarios, observed mean cost reduction 2.57%,
results varying 0% 7.44%. However, sampled cases represent combinations
input parameters cannot say realistic individual settings are. example,
many scenarios optimization possible put cost reduction 0%. optimization
possible, price threshold provided supplier higher sum agents upper
bound constraints price threshold lower sum lower bound constraints.
taking account scenarios, observe mean 2.96%. Moreover, looking cost
reduction initial nominal demand profile, get mean 3.7%, results 11.1%.
912

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

0.2

0.07

0.07

0.06

0.06

0.2

0.05

0.05

0.03
0.1

0.1
0.04

0
0.03
0.1

0.3

p_flexShift

0

12

0.01
0.1

24
0

p_flatThresh

0.02
0.2

0.01
0.2

0.03

0.02
0.2

0.1

0.04
0

0.1

0.02
0.2

p_distThresh

0.04

p_distThresh

0.1

0

0.06

0.2

0.05

0.1

p_distThresh

0.07

0.2
0.3

0

12

0

p_flatThresh

p_flexShift

0.01
0.1

24

0.2
0.3

p_flexShift

0

12

24
0

p_flatThresh

(a) consumers mainly con-(b) Consumers classes have(c) consumers mainly consume night, p f racAgent = 0.
equal fractions, p f racAgent = 0.5 sume day, p f racAgent = 1.

Figure 9: cost reduction algorithm function four input parameters:
p f racAgent, p f latT hresh, p distT hresh p f lexShif t. Scenarios high cost reduction white scenarios less cost reduction dark red.
6.3.1 ENSITIVITY NALYSIS
purpose sensitivity analysis understand effect different input parameters
cost reduction algorithm. sensitivity analysis perform multiple
linear regression. dependent variable (criterion) choose cost reduction (Definition 3).
independent variables (predictors) choose smallest interpretable model provides good
adjusted R-squared. resulting model shown Table 2. model explains 76.36%
variance adjusted R-squared 0.7571. remaining variance cannot explained
model, agents demand constraints generated randomly.
predictors
p f racAgent
p f latT hresh
p f lexShif
|p distT hresh|
p distT hresh p f lexShif
p f racAgent p f latT hresh

coefficient
0.0019
0.0077
0.0114
-0.0072
0.0018
-0.0016

stand. error
0.0011
0.0017
0.0010
0.0008
0.0002
0.0005

p-value
0.0910
1.66E-05
1.35E-25
2.08E-16
6.67E-17
0.0035

Table 2: Multiple linear regression model; adjusted R2 = 0.7571
Result 1: agents flexibility shifting demands increases, cost reduction increases, i.e.,
p f lexShif % G %.
multiple linear regression model summarized Table 2 shows effect p f lexShif
highly significant p < 0.01. positive value coefficient (0.0114) shows
increase flexibility leads increased cost reduction.
Intuitively, higher flexibility, demand time slots high prices shifted
lower prices. Consequently, higher cost reduction achieved. example,
p f lexShif = 0, demand shifted cost reduced. However, another reason
high cost reduction uncoordinated profile algorithm higher cost. Recall
uncoordinated demand profile agents optimize demand according hourly
913

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

550

550

500

500

450

aggregated
nominal demand

400

aggregated
optimal demand

aggregated demand (kW)

aggregated demand (kW)

price thresholds

350
300
250
200
150
100

450
400
350
300
250
200
150

0

2

4

6

8

10

12

14

16

18

20

22

100

24

time slot

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Lower flexibility, p f lexShif = 0.1.

(b) Higher flexibility, p f lexShif = 0.3.

Figure 10: Example scenarios different flexibilities agents shifting demands.

market prices. Consequently, higher agents flexibility, adapt demand
schedules hourly prices. However, since coordinated, agents shift much
demand possible cheap time slots. leads load synchronization, total demand
former cheap slots exceeds thresholds, leading higher costs (herding behavior). Thus,
high flexibility uncoordinated consumers leads highly synchronized demand. high initial
costs allow cost reduction algorithm. Figure 10 illustrates settings low
(p f lexShif = 0.1) high (p f lexShif = 0.3) flexibility. figure shows clearly
initial demand peak higher scenario flexibility. Recall Figure 6 slots
14, 15, 16 17 relatively low priced slots 17 lowest. area
red dashed curve uncoordinated demand profile coordinated demand profile gray
multiplied respective marginal prices shows cost reduction coordination.
increasing freedom Figure 10b seen area two curves increases.
reason height peak stays same, first agents shift much demand
possible time slots aggregated demands thresholds (peaks) time slots
demand levels thresholds. agents reach upper bounds time
slots, shift remaining demand time slots lowest prices threshold.
According hourly prices, cheapest remaining time slot 17. Since freedom allows
demanding remaining electricity time slot, height peak change.
Result 2: absolute distance demand thresholds aggregated load profile
decreases, cost reduction increases, i.e., |p distT hresh| & G %.
multiple linear regression model summarized Table 2 shows effect |p distT hresh|
highly significant p < 0.01. negative coefficient (-0.0072) shows away
thresholds aggregated load profile less cost reduction achieved.
Figure 11 illustrates settings low (p distT hresh = 0.2), normal (p distT hresh = 0)
high (p distT hresh = 0.2) thresholds. cost reduction limited much agents
decrease demand increase thresholds. demand thresholds
represented area initial demand profile (red dashed line) thresholds
(yellow flat line) thresholds, unused demand thresholds area
two lines thresholds. amounts affected flatness
914

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

550

550

500

500

500

400

aggregated
nominal demand

350

aggregated
optimal demand

aggregated demand (kW)

aggregated demand (kW)

price thresholds

450

450

450

400

400

350

300

350

300

250

300

250

200

250

200

150
100

aggregated demand (kW)

550

200

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Thresholds average load,(b) Thresholds average load,(c) Thresholds average load,
p distT hresh = 0.2.
p distT hresh = 0.
p distT hresh = 0.2.

Figure 11: Example scenarios different heights price thresholds.

thresholds, i.e., flatter thresholds, larger two areas become. Thus, flatter
thresholds cost reduction increases well. regression model supports this,
parameter p f latT hresh positive coefficient (0.0077) highly significant p < 0.01.
However, cost reduction scenario high thresholds Figure 11c greater
case normal thresholds Figure 11b. happens, flexibility shifting
demand limiting factor. Since absolute distance upper lower bounds
smaller time slots low demand, demand hits upper bounds time slots
reaches lower bounds time slots high demand. situation, increment
thresholds leads time slots thresholds thus possibilities shift
demand. Consequently, flexibility limiting factor, cost reduction increases,
thresholds slightly increased. supported regression model, interaction
term p distT hresh p f lexShif highly significant p < 0.01.
Result 3: observe similar cost reductions groups mostly consumers one class
groups agents classes similar fractions.
multiple linear regression model Table 2 shows parameter p f racAgent
significant predictor cost reduction p > 0.05. supports observation
see cost reductions coordinated behavior two classes (day consumers
night consumers) well mixed groups. Figure 12 illustrates settings night consumers
(Figure 12a), mixed group (Figure 12b), day consumers (Figure 12c). However,
examples, increasing fraction day consumers, cost reduction decreases larger
extent indicated parameter p f racAgent regression model. effect due
interaction effect composition cooperative flatness thresholds.
multiple linear regression model shows interaction term p f racAgent p f latT hresh
significant predictor p < 0.01. negative value coefficient (-5.219e-04) shows
flatness thresholds increases fraction day consumers increases,
cost reduction decreases. Figure 12 seen thresholds lying outside
agents demand bounds many time slots, thresholds time slot.
situation thresholds, demand bounds limit potential cost reduction
coordination. Consequently, thresholds get flatter, get reach agents demand
bounds. Since load profiles day consumers significant difference peak
low load, effect stronger groups larger fraction day consumers.
915

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

650

600

600

price thresholds

500

aggregated
nominal demand

aggregated demand (kW)

550

450

550

500

450

450

400

350

400

350

300

350

300

250

300

250

200

250

200

150
100

550

500

aggregated
optimal demand

400

aggregated demand (kW)

650

600

aggregated demand (kW)

650

200

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

150
0

2

4

6

8

10

12

14

16

18

20

time slot

22

24

100

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) consumers mainly con-(b) Consumers classes have(c) consumers mainly consuming
sume night, p f racAgent = 0.
equal fractions, p f racAgent = 0.5. day, p f racAgent = 1.

Figure 12: Example scenarios different compositions consumer cooperative.
6.3.2 C ONVERGENCE P ROPERTIES LGORITHM
Let first iteration submission agents uncoordinated initial demand profiles. Then,
second iteration coordinator sends first virtual price signals agents. Recall
beginning basic algorithm performed basic algorithm converged,
additional phase started, necessary. recall defined algorithm converged,
cost reduction one iteration gets less 0.00001%, i.e., C (R) / C (R0 ) < 1.0000001.
simulations, basic algorithm converges average within 9.57 iterations. cases
need additional phase, general algorithm converges average additional 35.10 iterations.
experiment setup using one HP Pavilion dmt4-1000 Intel Core i5 520M
two cores operating 2.4GHz 8 Gigabyte DDR3 physical memory. Using setup, one
iteration basic algorithm took average 25.12 seconds one iteration extended
phase took average 52.13 seconds. Looking agents demand profiles convergence,
observe agent average 67.6% time slots demand bounds tight.
sampled scenarios, least one time slot, demand bound tight,
agents satisfy constant total demand whole planning horizon.
Definition 4. convergence accuracy difference cost converged solution
optimal solution percentage difference cost uncoordinated profile
)C(R )
optimal solution, i.e., C(R
100.
C(R1 )C(R )
Result 4: simulations, basic algorithm achieves optimal solution 44.9%
sampled scenarios.
found 44.9% sampled cases basic algorithm achieves optimal solution.
remaining scenarios basic algorithm comes average 1.06% close optimal solution.
indicates cases basic algorithm provide good results.
Result 5: simulations indicate larger step sizes, , lead faster convergence
cost small reductions accuracy.
parameter defines step size extended phase. Intuitively, larger steps lead faster
convergence, cost reduced accuracy. Table 3 shows convergence accuracy average
number iterations convergence varying {0.5, 1, 2}. number agents time
slots fixed N = 40 = 24. results indicate increases, number
iterations convergence well accuracy decreases. However, reduction accuracy
small algorithm achieves good results . results indicate order
916

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

achieve accurate solutions within iterations, step size adapted run-time.
particular, value reduced time.


Convergence accuracy

0.5
1
2

0.22%
0.33%
0.55%

Number iterations
convergence
36.5
26.1
17.9

Table 3: Convergence accuracy time varying step sizes
Result 6: simulations indicate convergence time scales linearly agent
population size number time slots.
analyze influence convergence time algorithm, vary number agents
20 100 time slots 12 48. Table 4a shows convergence accuracy Table 4b
number iterations convergence. step size fixed = 1. results indicate
number iterations convergence increases linearly number agents time
slots. accuracy change much, increase agent population time slots.
Ptime
P slots
agents PPPP

PP

20
40
60
80
100

12

24

48

0.21%
0.24%
0.23%
0.26%
0.25%

0.19%
0.29%
0.26%
0.26%
0.28%

0.18%
0.20%
0.28%
0.30%
0.38%

(a) Convergence accuracy

Ptime
P slots
agents PPPP
20
40
60
80
100

PP

12

24

48

9.8
12.4
13.5
15.2
16.9

16
20.1
23.7
27.1
28.2

22.4
30.2
35.4
40.3
43.2

(b) Number iterations convergece

Table 4: Convergence accuracy time varying number agents time slots

7. Conclusion Future Work
paper, presented iterative coordination algorithm minimize energy cost
consumer cooperative, given information agents individual demand constraints
preferences remains private. proved algorithm converges optimal demand schedule presented results time complexity iterative algorithm agents incentive
compatibility. Additionally, conducted evaluations algorithm using multiagent simulation based real world consumption data. simulations, characterized convergence
properties algorithm effect differing demand characteristics cooperative
price functions cost reduction algorithm. results show convergence
time scales linearly population size length optimization horizon. Finally, observe participants flexibility shifting demands increases, cost reduction increases
cost reduction sensitive variation consumption patterns consumers.
work extended several directions. Future work investigate settings
agents might able compute guaranteed optimal solution individual problem,
provably good approximation. could apply settings detailed load
917

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

models agents. overall demand come two types loads: shiftable loads
non-shiftable loads. loads divided interruptible non-interruptible
loads. addition, loads subject temporal constraints. lead situation
individual problems agents longer convex, thus agent solve
individual problem optimally. Luo, Chakraborty, Sycara (2013) present distributed iterative
algorithm generalized task assignment problem context multirobot system (MRGAP). Based (approximate) best responses agents, algorithm provable
approximate ratio. would interesting investigate distributed algorithm context
problem.
paper, demand cooperative time slot solely consists aggregated
demand agents. Future work consider problems generation and/ storage (that
centralized, i.e., owned cooperative, distributed, i.e., owned individual agent).
Another avenue future work consider problem formulation cooperative faces
uncertainty electricity prices. example, consider 24-hour planning horizon instead
long term contract electricity bought hourly spot market. Here, scheduling
demand, one knows price next hour prices future hourly time slots
uncertain. spot market electricity price depends many factors controlled
coordinator. Hence, planning purposes, prices assumed externally
specified stochastic process. assumption, goal would design algorithms (1)
determining policies (for generation, storage, price signals sent firms) central
coordinator (2) determine schedules individual firms, expected cost
buying electricity minimized.

Acknowledgements
work partially supported NSF award IIS-1218542.

Appendix A. Proof: Virtual Cost Upper Bound Total Cost
Proof. Here, give full proof showing sum agents individual cost according
virtual price signals upper bound total central cost market prices. prove this,
showing Equations 1 7 every time slot j difference total cost
aggregated demand sum agents individual cost lower equal 0. Since
true every time slot, true sum time slots.
central cost aggregated demand given Equation 1
N
X

0
pj 0j rij
, j

i=1

+

0
= pH
0j hj + pL
+ pL
j
j j hj
j hj
(

H
0
L
0
pj j hj + pj hj j > hj

=
0
L
0j hj
pL
j j hj + pj hj
(P
PN

N
0
pH
rij
hij + i=1 pL
j
j hij

P
= Pi=1
N
N
L
0
+ i=1 pL
j hij
i=1 pj rij hij
918

0j > hj
0j hj

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

sum agents individual cost given Equation 7
N
X

0
0
sij rij
rij , j

i=1

=

N h
X

0
pH
rij
hij
j

+

0
+ pL
j rij hij



+ pL
j hij



i=1

difference two costs get:
N
X

N
X
0
0
0
pj 0j rij

sij rij
rij , j

i=1

i=1
P

h

+

N
L
0
L
0
H
L
0
H

h

h

p
r

h

p
r
h

p

h
+
p
r
p
ij
ij
ij
j ij
ij
j
ij
j
j ij
ij
j
i=1

= PN h

+

L
0
L
H
0
L
0
L

rij hij pj rij hij pj hij
i=1 pj rij hij + pj hij pj

Since

PN
i=1

0j hj


PN L
pL
h


ij
j
i=1 pj hij equal removed.

P
h



N pH r0 hij pH r0 hij + pL r0 hij
j
ij
j
ij
j
ij
i=1
= PN h

+

L
0
H
0
L
0

p
r

h

p
r

h

p
r
ij
ij
j
ij
j
ij
j
ij hij
i=1

Lets write
P
analog N
i: r0

0j > hj
0j hj



+


PN L 0
PN
H r0 h
H r0 h
p
r

h
p
p


0
ij
ij
ij
ij
ij
ij
i=1 j
i=1 j
i: rij >hij j


PN
PN
PN
H
0
rij hij . Lets write i=1 i: r0 >hij + i: r0 hij .
hij pj

PN

ij

=

0j > hj

ij

ij

N
N


H 0


P H 0
P

H
0
L
0


i: r0 >h pj rij hij pj rij hij + i: r0 h pj rij hij pj rij hij
ij






i:

ij

N
P
0 >h
rij
ij

ij

i:

0j > hj terms

PN
i:

0 h
rij
pH
ij
j

=

i: r 0 h
PN ij ij
0 >h
i: rij
ij



0
L
0
pL
j rij hij pj rij hij



removed. 0j hj remove
(PN



0 h
rij
ij



0 >h
rij
ij

ij

N
P

L 0


0
pj rij hij pH
rij
hij +
j

0
i: rij

PN

0 >h
rij
ij

H 0


0
pj rij hij pL
j rij hij


L 0
0
pj rij hij pH
rij
hij
j

0j > hj
0j hj

0j > hj


H
0
pL
rij
hij
0j hj
j pj
(P
0

N
H
L
0j > hj
i=1 pj pj rij hij
= PN
+
L
H
0
rij
hij
0j hj
i=1 pj pj
h P




N
H
L
0

rij
hij
0 0j > hj
i=1 pj pj
h

=


P
+
N
L
H
0

rij
hij
0 0j hj
i=1 pj pj
=

i: r 0 h
PN ij ij
0 >h
i: rij
ij

L
pH
j pj



919

0j hj



H r0 h
p
ij equal
ij
j
i:


L
0
hij pj rij hij respectively.


PN





L pL pH out.
Factor pH

p
j
j
j
j
(PN

0j > hj

0
rij
hij



fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

Since inequality true every time slot, holds sum time slots. follows
sum agents individual cost according virtual price signals upper bound
P
0
total central cost market prices, C (R0 ) N
i=1 Ci (ri ):
N X

X

N X

X
0
0
0
pj 0j rij
+ gi (r0i )
sij rij
rij + gi (r0i )

i=1 j=1

i=1 j=1

Appendix B. Proof Counterexample: Basic Algorithm Converge
Suboptimal Solution Case gi () 6= 0
present counterexample prove basic algorithm converge suboptimal solution
general settings gi () 6= 0. Consider population 2 agents, N = 2, planning
horizon 2 time slots, = 2. agents constraints converged solution,
aggregated demand equal threshold one time slot. Let price function given as:
H
L H
(pL
1 , p1 ) = (3, 8), h1 = 9 ; (p2 , p2 ) = (3, 8), h2 = 11

individual constraints agents demand are:
r11 [1, 3], r12 [4, 6], r11 + r12 = 1 = 7
r21 [4, 6], r22 [4, 6], r21 + r22 = 2 = 10

agents individual cost associated demand schedule given as:

g1 (r1 ) = r1

5
1




, g2 (r2 ) = r2

6
3



(1)

beginning, agents compute initial demand profiles based market prices r1 =

(1)
(1, 6), r2 = (4, 6). cost based demand profiles C R(1) = 109.
(T )

(T )

convergence, final profiles twoagents r1 = (1.5, 5.5), r2 = (4.5, 5.5).
cost based demand profiles C R(T ) = 107.5.
However different demand profile agents exists r01 = (1, 6), r02 = (5, 5).
profile feasible leads lower total cost, i.e., C (R0 ) = 107. follows algorithm
stopped suboptimal solution.

References
Albadi, M., & El-Saadany, E. (2007). Demand response electricity markets: overview.
Power Engineering Society General Meeting, 2007. IEEE, pp. 15. IEEE.
Atzeni, I., Ordonez, L., Scutari, G., Palomar, D., & Fonollosa, J. (2013). Demand-side management
via distributed energy generation storage optimization. IEEE Transactions Smart Grid,
4(2), 866876.
Ausubel, L. M., & Milgrom, P. (2006). lovely lonely vickrey auction. Combinatorial
auctions, 1740.
Barbose, G., Goldman, C., & Neenan, B. (2004). survey utility experience real time
pricing. Tech. rep., Ernest Orlando Lawrence Berkeley National Laboratory, Berkeley, CA,
USA.
920

fiM ULTIAGENT C OORDINATION EMAND IDE E NERGY ANAGEMENT

Bertsekas, D. P., & Tsitsiklis, J. N. (1989). Parallel distributed computation: numerical methods. Prentice-Hall, Inc., Upper Saddle River, NJ, USA.
Boyd, S., & Vandenberghe, L. (2004). Convex optimization. Cambridge university press.
Chu, C., & Jong, T. (2008). novel direct air-conditioning load control method. IEEE Transactions
Power Systems, 23(3), 13561363.
Clement-Nyns, K., Haesen, E., & Driesen, J. (2010). impact charging plug-in hybrid electric
vehicles residential distribution grid. IEEE Transactions Power Systems, 25(1), 371
380.
Dietrich, K., Latorre, J., Olmos, L., & Ramos, A. (2012). Demand response isolated system
high wind integration. IEEE Transactions Power Systems, 27(1), 2029.
Green, J., & Laffont, J.-J. (1977). Characterization satisfactory mechanisms revelation
preferences public goods. Econometrica: Journal Econometric Society, 427438.
Hurwicz, L. (1975). existence allocation systems whose manipulative nash equilibria
pareto-optimal. 3rd World Congress Econometric Society.
Jellings, C. W., & Chamberlin, J. H. (1993). Demand Side Management: Concepts Methods.
PennWell Books, Tulsa, OK, USA.
Kirschen, D. (2003). Demand-side view electricity markets. IEEE Transactions Power Systems, 18(2), 520527.
Luo, L., Chakraborty, N., & Sycara, K. (2013). Distributed algorithm design multi-robot generalized task assignment. Proceedings IEEE International Conference Intelligent
Robots Systems.
Medina, J., Muller, N., & Roytelman, I. (2010). Demand response distribution grid operations:
Opportunities challenges. IEEE Transactions Smart Grid, 1(2), 193198.
Mohsenian-Rad, A., Wong, V., Jatskevich, J., Schober, R., & Leon-Garcia, A. (2010). Autonomous
demand-side management based game-theoretic energy consumption scheduling
future smart grid. IEEE Transactions Smart Grid, 1(3), 320331.
Mohsenian-Rad, A., & Leon-Garcia, A. (2010). Optimal residential load control price prediction real-time electricity pricing environments. IEEE Transactions Smart Grid, 1(2),
120133.
Nguyen, H. K., Song, J. B., & Han, Z. (2012). Demand side management reduce peak-to-average
ratio using game theory smart grid. IEEE Conference Computer Communications
Workshops (INFOCOM WKSHPS), pp. 9196. IEEE.
Palensky, P., & Dietrich, D. (2011). Demand side management: Demand response, intelligent energy
systems, smart loads. IEEE Transactions Industrial Informatics, 7(3), 381388.
Pedrasa, M., Spooner, T., & MacGill, I. (2010). Coordinated scheduling residential distributed
energy resources optimize smart home energy services. IEEE Transactions Smart Grid,
1(2), 134143.
Philpott, A., & Pettersen, E. (2006). Optimizing demand-side bids day-ahead electricity markets.
IEEE Transactions Power Systems, 21(2), 488498.
Rahimi, F., & Ipakchi, A. (2010). Demand response market resource smart grid
paradigm. IEEE Transactions Smart Grid, 1(1), 8288.
921

fiV EIT, X U , Z HENG , C HAKRABORTY, & YCARA

Ramchurn, S., Vytelingum, P., Rogers, A., & Jennings, N. (2012). Putting smarts
smart grid: grand challenge artificial intelligence. Communications ACM, 55(4),
8697.
Ramchurn, S. D., Vytelingum, P., Rogers, A., & Jennings, N. (2011). Agent-based control decentralised demand side management smart grid. 10th International Conference
Autonomous Agents Multiagent Systems-Volume 1, pp. 512.
Samadi, P., Mohsenian-Rad, H., Wong, V., & Schober, R. (2013). Tackling load uncertainty
challenges energy consumption scheduling smart grid. IEEE Transactions Smart
Grid, 4(2), 10071016.
Tanaka, K., Uchida, K., Ogimi, K., Goya, T., Yona, A., Senjy, T., Funabashi, T., & Kim, C. (2011).
Optimal operation controllable loads based smart grid topology considering insolation
forecasted error. IEEE Transactions Smart Grid, 2(3), 438444.
Veit, A., Xu, Y., Zheng, R., Chakraborty, N., & Sycara, K. (2013). Multiagent coordination energy consumption scheduling consumer cooperatives. Proceedings 27th AAAI Conference Artificial Intelligence, pp. 13621368.
Voice, T., Vytelingum, P., Ramchurn, S., Rogers, A., & Jennings, N. (2011). Decentralised control
micro-storage smart grid. Proceedings 25th AAAI Conference Artificial
Intelligence, pp. 14211427.
Vytelingum, P., Ramchurn, S., Rogers, A., & Jennings, N. (2010). Agent-based homeostatic control
green energy smart grid. First International Workshop Agent Technologies
Energy Systems (ATES 2010).
Vytelingum, P., Voice, T., Ramchurn, S., Rogers, A., & Jennings, N. (2011). Theoretical practical foundations large-scale agent-based micro-storage smart grid. Journal Artificial Intelligence Research, 42(1), 765813.
Wood, A., & Wollenberg, B. (1996). Power Generation Operation Control. John Wiley & Sons.
Wu, C., Mohsenian-Rad, H., & Huang, J. (2012). Wind power integration via aggregator-consumer
coordination: game theoretic approach. Innovative Smart Grid Technologies (ISGT),
2012 IEEE PES, pp. 16. IEEE.

922


