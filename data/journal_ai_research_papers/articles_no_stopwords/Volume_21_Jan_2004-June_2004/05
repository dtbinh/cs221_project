journal artificial intelligence

submitted published

learn beat best stock
allan borodin

bor cs toronto edu

department computer science
university toronto
toronto g canada

ran el yaniv

rani cs technion ac il

department computer science
technion israel institute technology
haifa israel

vincent gogan

vincent cs toronto edu

department computer science
university toronto
toronto g canada

abstract
novel actively trading stocks presented traditional expert
advice universal well standard technical trading heuristics attempt
predict winners trends relies predictable statistical relations
pairs stocks market empirical historical markets provide strong
evidence type technical trading beat market moreover beat
best stock market utilize idea smoothing critical
parameters context expert learning

introduction
portfolio selection ps challenging machine learning online
course computational finance well known e g see lugosi
sequence prediction log loss measure viewed special case portfolio selection perhaps surprisingly certain worst case minimax criterion
portfolio selection essentially harder prediction shown cover ordentlich see lugosi thm seems qualitative
difference practical utility universal sequence prediction universal
portfolio selection simply stated universal sequence prediction
probabilistic worst case appear work well practice whereas known
universal portfolio selection seem provide substantial benefit
naive investment strategy see section
major pragmatic question whether computer program consistently
outperform market closer inspection interesting ideas developed information theory online learning suggests promising exploit natural
volatility market particular benefit simple rather persistent statistical relations stocks rather try predict stock prices winners

c

ai access foundation rights reserved

fiborodin el yaniv gogan

present non universal portfolio selection try predict
winners motivation behind rationale behind constant rebalancing
worst case study universal trading introduced cover
proposed substantially beat market historical markets
beats best stock presenting simply
making money course caveats obstacles utilizing
large investors possibility goose laying silver golden eggs
perhaps impossible

portfolio selection
assume market stocks let vt vt vt daily closing prices
stocks tth day vt j price jth stock convenient
work relative prices xt j vt j vt j investment jth
stock tth day yields dxt j dollars let xt xt xt denote
market vector relative prices corresponding tth day portfolio b allocation
wealth stocks specified proportions b b
p b current dollar
wealth invested stocks b j p
j b j daily return
portfolio b w r market vector x b x j b j x j compound total
return retx b q
bn sequence portfolios b bn w r market sequence
x x xn nt bt xt portfolio selection deterministic
randomized rule specifying sequence portfolios let retx denote total
return market sequence x
simplest strategy buy hold stocks portfolio b denote
strategy bahb let u bah denote uniform buy hold b
say portfolio selection beats market outpeforms u bah
given market sequence although practice market represented
non uniform bah buy hold strategies rely tendency successful markets
grow much modern portfolio theory focuses choose good b buyand hold strategy seminal ideas markowitz yield algorithmic procedure
choosing weights portfolio b minimize variance feasible
expected return variance minimization possible placing appropriate larger
weights subsets sufficiently anti correlated stocks idea shall utilize
denote optimal hindsight buy hold strategy e invest best
stock bah
alternative static buy hold dynamically change portfolio
trading period often called active trading one example
active trading constant rebalancing namely fix portfolio b invest dollars
day according b denote constant rebalancing strategy cbalb let
cbal denote optimal hindsight cbal constant rebalancing strategy often
ps modified universal investing fixed fraction initial wealth
universal
nothing special daily closing prices defined respect
sub sequence intra day sequence price offers appear stock market
example dow jones industrial average djia calculated non uniform average
djia stocks see e g http www dowjones com



fican learn beat best stock

take advantage market fluctuations achieve return significantly greater
least good best stock bah real market
sequences constant rebalancing strategy take advantage market fluctuations
significantly outperform best stock see e g table consider cover
glusss classic contrived example
cash one stock
consisting

ofa market
consider cbalb
market sequence price relatives

b odd day daily return cbalb even
day total return n days therefore n illustrating constant
rebalancing strategy yield exponential returns growth market
assumption daily market vectors observations identically independently
distributed random variables shown cover thomas cbal
performs least good sense expected total return best online portfolio
selection however many studies see e g lo mackinlay argue
stock price sequences long term memory
non traditional objective computational finance develop online trading
strategies sense guaranteed perform well within line
pioneered cover cover gluss cover cover ordentlich
one attempts design portfolio selection provably well terms
total return respect online offline benchmark two
natural online benchmark uniform buy hold u bah uniform



natural
constant rebalancing strategy u cbal cbalb b

offline benchmark bah challenging offline benchmark cbal
portfolio selection called universal every market sequence x
n days guarantees subexponential ratio n return retx
retx cbal particular cover ordentlichs universal portfolios cover
cover ordentlich denoted universal proven universal
specifically every market sequence x stocks n days guarantees
subexponential indeed polynomial ratio


retx cbal retx universal n
bah cbal

theoretical perspective surprising performance ratio bounded
polynomial n fixed whereas cbal capable exponential returns
practical perspective bound useful empirical returns observed
cbal portfolios often exponential number trading days however
motivation underlies potential cbal useful follow motivation develop call anticor attempting systematically
follow constant rebalancing philosophy anticor capable extraordinary performance absence transaction costs even small transaction costs
trading strategy online computes portfolio st day market information
first days contrast offline u bah cbal optimal
strategy picking best stock individual day offline compute sequence
portfolios function entire market sequence



fiborodin el yaniv gogan

trying learn winners
direct expert learning portfolio selection reward
weighted average prediction scheme adaptively computes weighted average
experts gradually increasing multiplicative additive update rule relative
weights successful experts section briefly discuss related
portfolio selection along lines
example context ps consider exponentiated gradient
eg proposed helmbold et al eg computes
next portfolio
bt j exp xt j bt xt
bt j pm

j bt j exp xt j bt xt
learning rate parameter eg designed greedily choose best portfolio
yesterdays market xt time paying penalty movingp
far yesterdays portfolio universal bound eg helmbold et al set xmin log n
xmin lower bound price relative easy see n increases
decreases think small order achieve universality
eg degenerates uniform cbal assuming started
uniform portfolio universal case
day price relatives stocks identical eg well ps
converge uniform cbal combining small learning rate reasonably
balanced market expect performance eg similar uniform
cbal confirmed experiments see table
covers universal adaptively learn days portfolio increasing
weights successful cbals update rule universal
r
b rett cbalb b
bt r

rett cbalb b
prior distribution portfolios thus weight possible portfolio
proportional total return rett b thus far times prior particular universal consider experiments uses dirichlet prior parameters
cover ordentlich somewhat surprisingly noted cover ordentlich equivalent static weighted average given b
cbals see borodin el yaniv p equivalence helps demystify
universality shows never outperform cbal
helmbold et al eliminate need know xmin n eg made universal
performance ratio sub exponential polynomial n
following helmbold et al fix experiments additional experiments wide range
fixed settings confirm datasets choice optimal near optimal
choice course possible adaptively set throughout trading period beyond
scope
papers cover cover ordentlich blum kalai consider simpler version
dirichlet prior uniform universal achieves
ratio nm experimentally datasets negligible difference two
variants report asymptotically optimal



fican learn beat best stock

different type winner learning obtained sequence
prediction strategy noted borodin el yaniv gogan stock j
soft sequence prediction provides probability p j next symbol
j view prediction stock j best relative
price next day set bt j pj borodin et al considers
predictions made prediction component well known lempel ziv lz lossless
compression ziv lempel prediction component nicely described
langdon feder prediction lz provably powerful
senses first shown asymptotically optimal respect
stationary ergodic finite order markov source rissanen ziv lempel
moreover feder shows lz universal worst case sense respect
offline benchmark class finite state prediction machines summarize common
devising ps attempt learn winners simple
sophisticated winner learning schemes

anticor
propose different motivated cbal inspired philosophy
interpret success uniform cbal cover gluss example section
clearly uniform cbal taking advantage price fluctuation constantly transferring wealth high performing stock relatively low performing stock even
less contrived market cbal capable large returns market model favoring
use cbal one stock growth rates stable long term occasional larger return rates followed smaller rates vice versa market
phenomenon sometimes called reversal mean
many ways one interpret implement
philosophy reversal mean particular cbal viewed static
implementation philosophy describe motivation basic ingredients
anticor adaptively recent empirical statistics rather
aggressively implements reversal mean
given trading day consider recent past w trading days w
integer parameter growth rate stock window time measured
product relative prices window motivated assumption
portfolio stocks performing similarly terms long term growth rates
anticors first condition transferring money stock stock j growth
rate stock exceeds stock j recent window time addition
anticor requires indication stock j start emulate past
growth stock near future end anticor requires positive correlation
stock second last window stock j last window
relative extent transfer money stock stock j depend
anticor aggressive say compared cbal sense transfer
assets given stock heuristics used moderate behavior
since would rather deal arithmetic instead geometric means use logarithms
relative prices
note umderlying model assumption reversal mean one modify
account different means



fiborodin el yaniv gogan

strength correlation well strength self anti correlations
stocks j two consecutive windows anticor named use
correlations anticorrelations consecutive windows indicate potential
anticorrelations growth rates stocks j near future hopefully
growth rate stock j becoming greater stock
formally define
lx log xt w log xtw lx log xtw log xt



log xk denotes log xk log xk thus lx lx two vector
sequences equivalently two w matrices constructed taking logarithm
market subsequences corresponding time windows w w w
respectively denote jth column lxk lxk j let k k k
vectors averages columns lxk similarly let k vector standard
deviations columns lxk cross correlation matrix normalization
column vectors lx lx defined

lx lx j j
w



mcov j
j j
mcor j

otherwise

mcov j



mcor j measures correlation log relative prices stock
first window stock j second window note respectively
j zero window growth rate stock second last
window respectively stock j last window constant window
sufficiently large windows time constant growth stock unlikely however
unlikely case choose move money stock
pair stocks j compute claimij extent want shift
investment stock stock j namely claim iff j
mcor j case claimij mcor j j h mcor h h
mcor h h else following interpretation success cbal mcor j
used predict stocks j correlated consecutive windows e
current window next window evidence last two windows
mcor h h predicts stock h p
negatively auto correlated consecutive
windows finally
b


b



j transferji transferij transferij
p
bt claimij j claimij pseudocode summarizing anticor appears
figure pseudocode describes routine anticor w xt bt receives
window size w current trading day historical market sequence xt giving
market vectors corresponding days current portfolio bt defined
bt bt xt bt xt bt xt routine first called empty historical
market sequence bt uniform portfolio stocks routine
recall correlation coefficient normalized covariance covariance divided
product standard deviations cor x cov x std x std
cov x e x mean x mean
course approaches used accommodate constant nearly constant growth rate



fican learn beat best stock

returns portfolio rebalance start st trading
day
algoritm anticor w xt bt
input
w window size
index last trading day
xt x xt historical market sequence
bt current portfolio end trading day
output bt next days portfolio
return current portfolio bt w
compute lx lx defined equation vector averages
lx lx respectively
compute mcor j defined equation
calculate claims j initialize claimij
j mcor j
claimij claimij mcor j
b mcor claimij claimij mcor
c mcor j j claimij claimij mcor j j
calculate portfolio initialize bt bt j
p
let transferij bti claimij j claimij
b bt
bt
transferij


c bt
bt
transferji



figure

anticor

anticorw one critical parameter window size w figure
depict total return anticorw two historical datasets function
window size w detailed descriptions datasets appear section
might expect performance anticorw depends significantly window size
however w anticorw beats uniform market moreover beats best
stock window sizes course online trading cannot choose w hindsight
viewing anticorw experts try learn best expert
windows individual stocks induce rather volatile set experts standard expert
combination cesa bianchi et al tend fail
alternatively adaptively learn invest weighted average anticorw
w less maximum w simplest case uniform investment windows uniform buy hold investment
anticorw w w denoted bahw anticor figure graphs total return
bahw anticor function w values w four datasets
consider considering graphs choice w arbitrary clearly
assertion empirical studies conducted expert advice



fiborodin el yaniv gogan

nyse anticorw vs window size

tsx anticorw vs window size



bah anticor window
anticor window
best stock
market return







anticorw



total return

total return logscale





bah anticorw
anticorw
best stock
market

best stock

anticorw
best stock







































window size w





bah anticorw
anticorw

best stock
market return



best stock
market return

anticorw



total return

total return



djia anticorw vs window size



bah anticor
w
anticorw





b

sp anticorw vs window size



window size w

anticorw











best stock

best stock














window size w













window size w

c
figure





anticorw

total return per investment vs window size w
nyse b tsx c sp djia dashed red lines represent
final return best stock dash dotted blue lines final return
uniform market dotted green horizontal lines represent uniform
investment number anticorw applications later described

optimal course could try optimize parameter w particular dataset
training historical data beginning trade however claim
almost choice w yield returns beat best stock exception
w djia dataset
since consider stocks whose prices determined
cumulative returns back original portfolio selection
anticor performs well stocks may perform well
thus consider active investment anticorw
anticor consider windows w w course continue compound
number times compound twice use buy hold
investment resulting denoted bahw anticor anticor one impact
compounding depicted figure smooth anti correlations exhibited
stocks evident compounding twice returns become almost completely


fican learn beat best stock

nyse total return vs max window









bah anticor
w

bahw anticor





total return

total return logscale



tsx total return vs max window
bahw anticor



best stock
market









best stock


bahw anticor






best stock
market

best stock


































w



total return

total return





best stock


figure

bahw anticor
best stock



bahw anticor








bahw anticor





best stock
market



best stock
market




djia total return vs max window

bah anticor





b

sp total return vs max window




maximal window size w

maximal window size w













maximal window size w

maximal window size w

c







bahw anticor

total return per investment function maximal
window w nyse tsx b sp c djia

correlated thus diminishing possibility additional compounding substantially
help idea smoothing critical parameters may applicable learning
applications challenge understand conditions applications
process compounding smoothing effect

empirical comparison
present experimental study anticor three online
learning described section focus bah anticor abbreviated
anti bah anticor anticor abbreviated anti four historical datasets
used first nyse dataset one used cover cover ordentlich
helmbold et al blum kalai dataset contains daily prices
stocks york stock exchange nyse twenty two year period july
rd dec st second tsx dataset consists stocks toronto
stock exchange tsx five year period jan th dec st third
smoothing effect allows use simple prediction expert advice
cesa bianchi et al better predict good window size
explored direction



fiborodin el yaniv gogan

djia dec jan
anticor

stocks




anticor






total return


































days


days


days

figure cumulative returns last month djia dataset stocks left panel
anticorw trading stocks denoted anticor middle panel
anticorw trading anticor right panel

dataset consists stocks sp apr largest market
capitalization set spans trading days period jan nd jan st
fourth dataset consists thirty stocks composing dow jones industrial
average djia two year period days jan th jan th

market u bah
best stock
cbal
u cbal
anti
anti
lz
eg
universal

nyse










tsx










sp










djia










nyse










tsx










sp










djia










table monetary returns dollars per investment four
different datasets reversed versions winner runner
market appear boldface figures truncated two decimals
four datasets quite different nature market returns datasets
appear first row table every stock nyse increased value
stocks tsx lost money stocks sp lost money
four datasets including sources individual stock compositions downloaded
http www cs technion ac il rani portfolios



fican learn beat best stock

stocks negative market djia lost money exception
tsx data sets include highly liquid stocks large market capitalizations
order maximize utility datasets yet present rather different markets
ran market reverse simply done reversing order inverting
relative prices reverse datasets denoted superscript
reverse markets particularly challenging example nyse stocks
going note forward reverse markets e u bah tsx
increasing tsx challenging market since many stocks
declining
table reports total returns eight datasets
see prediction lz quite well aggressive anti
anti excellent sometimes fantastic returns note active strategies
beat best stock even cbal markets exception tsx
case still significantly outperform market reader may well distrustful
appears unbelievable returns anti anti especially applied
nyse dataset however recall nyse dataset consists n trading
days n total nyse return approximately
anti respectively anti average daily increase less
respectively observe learning universal eg
substantial advantage u cbal previous expositions
highlighted particular combinations stocks returns significantly outperformed
best stock said u cbal
djia cumulative total returns


cumulative total return



anti
anti
best stock
market

anti


anti






best stock




market

jan

jan

jan

date

figure djia cumulative returns
market

anti anti

best stock uniform

bah

total returns anti anti presented table impressive far
telling complete story consider graphs figure anti anti
perform well respect uniform market best stock throughout
investment period periods cumulative return strategies


fiborodin el yaniv gogan

decrease surprising behavior indicates certain degree risk
investment
finance standard risk measure standard deviation return table
provide annualized returns risks well risk adjusted returns markets
considered example annualized return best stock
djia set annualized risk standard deviation annualized
risk adjusted return sharpe ratio

market
u bah
best stock
cbal
u cbal
anti
anti
lz
eg
universal

nyse



















tsx



















sp



















djia



















nyse



















tsx



















sp



















djia



















table annualized returns respective annualized volatilities well annualized riskadjusted returns sharpe ratio three datasets
reversed versions winner runner sharpe ratio market
appear boldface figures truncated two decimals

commissions trading friction caveats
handling portfolio stocks may perform transactions
per day major concern therefore commissions incur within proportional commission model see e g blum kalai borodin el yaniv section
exists fraction investor pays rate
buy sell therefore return
sequence b bn portfolios

q
p
respect market sequence x xn bt xt j bt j bt j
annualized return estimated geometric mean ofthe individual daily returns risk
standard deviation daily returns multiplied assumed standard
number trading days per year calculations standard annualized sharpe ratio
sharpe ratio annualized return minus risk free return taken divided
annualized standard deviation



fican learn beat best stock

bt bt xt bt xt bt xt investment simplest form
tolerate small proportional commission rates still beat best stock
graphs figure depict total returns bah anticor proportional commission factor strategy withstand small commission factors
example still beat best stock four markets
consider beats market moreover still clearly beats market
whenever
nyse







best stock



tsx



anti
return

return logscale



market


















commission rate






sp







commission rate



djia


return

return
















commission rate

figure total returns







bah anticor





commission rate



proportional commissions



however current online brokers charge small proportional commissions perhaps addition small flat commission rate trades means large
investor scale investment suffer small proportional transaction rate
additional caveat assumption trades could implemented
closing price principle nothing special closing price e
trade time trading day practical consideration related
dataset gathering availability dictated use prices
note blum kalai showed performance guarantee universal still holds
gracefully degrades case proportional commissions
example usa site e trade https us etrade com offers flat fee trade
shares share thereafter
specifically historical closing prices public domain allow experimental reproducibility
historical intraday trading quotes gathered data usually protected
costly obtain



fiborodin el yaniv gogan

assume portfolio adjustments implemented quoted prices receive
inputs means transactions implemented simultaneously
quoted prices current online brokers computerized system issue transaction
orders almost instantly guarantee implemented instantly
trading friction necessarily generate discrepancies input prices
implementation prices
related one must face actually trading difference
bid ask prices bid ask spreads availability stocks buying
selling functions stock liquidity typically small large market capitalization
stocks consider large market cap stocks
report abnormal returns historical markets suspected data
snooping particular historical data sets conditioned fact
stocks traded every day bankrupcies stocks became
virtually worthless data sets furthermore dataset excessively
mined testing many strategies substantial chance one strategies
successful simple fitting another data snooping hazard stock selection
anticor fully developed nyse tsx datasets
djia sp sets obtained public domain sources
fixed finally one parameter maximal window size w
experiments clearly indicate performance robust respect w
see example figure

concluding remarks
traditional work financial economics tend focus understanding stock price
determination main question predict stock market judging
extensive inconclusive work done financial forecasting perhaps
beneficial question ask rather computer program consistently outperform
market besides practicality clear successful portfolio selection
mathematical model provide intuition stock price formation
example case suggest stock price fluctuations
sufficiently periodic anti correlated
number well respected works report statistically robust abnormal returns
simple technical analysis heuristics slightly beat market example
landmark study brock lakonishok lebaron apply simple trading
heuristics djia index provide strong support technical
analysis heuristics consistently beating market considered significant
impossible challenge portfolio selection indicates beating best
stock achievable goal mainly focused idealized frictionless
setting believe even frictionless setting seems reasonable
starting point previously claimed literature
presented raise interesting questions since simple statistical
relations correlation give rise outstanding returns plausible
perhaps sophisticated machine learning techniques give rise better



fican learn beat best stock

portfolio selection capable larger returns tolerating larger commissions
fees
theoretical side missing point time analytical model
better explains active trading strategies successful regard
investigating statistical adversary along lines suggested raghavan
chou et al namely would performs
well relative benchmark market sequence satisfies certain constraints
empirical statistics
one final caveat needs mentioned namely entire theory portfolio selection
assumes one portfolio selection impact market
goose laying golden eggs widespread use soon lead end
goose case market quickly react method consistently
substantially beat market

acknowledgments
thank michael loftus helpful comments thank izzy nelken super
computing inc help validating djia dataset

references
blum kalai universal portfolios without transaction costs
machine learning
borodin el yaniv r online computation competitive analysis cambridge university press
borodin el yaniv r gogan v competitive theory practice
portfolio selection proc th latin american symposium theoretical
informatics latin pp
brock l lakonishok j lebaron b simple technical trading rules
stochastic properties stock returns journal finance
cesa bianchi n freund haussler helmbold schapire r warmuth
use expert advice journal acm
chou cooperstock j el yaniv r klugerman leighton
statistical adversary allows optimal money making trading strategies proceedings
th annual acm siam symposium discrete
cover universal portfolios mathematical finance
cover gluss empirical bayes stock market portfolios advances applied
mathematics
cover ordentlich e universal portfolios side information ieee
transactions information theory
cover thomas j elements information theory john wiley sons inc
feder gambling finite state machine ieee transactions information
theory


fiborodin el yaniv gogan

helmbold schapire r singer warmuth portfolio selection
multiplicative updates mathematical finance
langdon g note lempel ziv model compressing individual sequences
ieee transactions information theory
lo mackinlay c non random walk wall street princeton
university press
lugosi g
lectures prediction
url http www econ upf es lugosi ihp ps



individual

sequences

markowitz h portfolio selection efficient diversification investments john
wiley sons
raghavan p statistical adversary line dimacs series
discrete mathematics theoretical computer science
rissanen j universal data compression system ieee transactions information theory
sharpe w adjusting risk portfolio performance measurement journal
portfolio management winter
ziv j lempel compression individual sequences via variable rate coding
ieee transactions information theory




