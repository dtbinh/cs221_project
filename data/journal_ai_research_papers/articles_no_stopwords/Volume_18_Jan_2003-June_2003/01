journal artificial intelligence

submitted published

monte carlo methods tempo tracking
rhythm quantization
ali taylan cemgil
bert kappen

snn geert grooteplein cpk university nijmegen
nl ez nijmegen netherlands

cemgil snn kun nl
bert snn kun nl

abstract

present probabilistic generative model timing deviations expressive music performance structure proposed model equivalent switching state
space model switch variables correspond discrete note locations musical
score continuous hidden variables denote tempo formulate two well known
music recognition namely tempo tracking automatic transcription rhythm
quantization filtering maximum posteriori map state estimation tasks exact computation posterior features map state intractable model
class introduce monte carlo methods integration optimization compare
markov chain monte carlo mcmc methods gibbs sampling simulated annealing iterative improvement sequential monte carlo methods particle filters
simulation suggest better sequential methods methods
applied online batch scenarios tempo tracking transcription
thus potentially useful number music applications adaptive automatic
accompaniment score typesetting music information retrieval
introduction
automatic music transcription refers extraction human readable interpretable
description recording musical performance traditional music notation
description lists pitch levels notes corresponding timestamps
ideally one would recover score directly audio signal representation surface structure music would useful music information retrieval
music ir content description musical material large audio databases however
operating sampled audio data polyphonic acoustical signals extraction
score description challenging auditory scene analysis task vercoe gardner
scheirer
focus subproblem music ir assume exact timing
information notes available example stream midi events digital
keyboard
model tempo tracking transcription midi music representation
useful broad spectrum applications one example automatic score typesetting
musical instruments digital interface standard communication protocol especially designed digital
instruments keyboards time key pressed midi keyboard generates short message
containing pitch key velocity computer tag received message timestamp real time
processing recording file

c ai access foundation morgan kaufmann publishers rights reserved

ficemgil kappen
musical analog word processing almost score typesetting applications provide
means automatic generation conventional music notation midi data
conventional music notation onset time note implicitly represented
cumulative sum durations previous notes durations encoded simple rational
numbers e g quarter note eighth note consequently events music placed
discrete grid basic task midi transcription associate onset times
discrete grid locations e quantization
however unless music performed mechanical precision identification
correct association becomes dicult due fact musicians introduce
intentional unintentional deviations mechanical prescription example
timing events deliberately delayed pushed moreover tempo uctuate
slowing accelerating fact deviations natural aspects expressive
performance absence music tends sound rather dull mechanical
hand deviations accounted transcription resulting
scores often poor quality
robust fast quantization tempo tracking important requirement
interactive performance systems applications listen performer generating
accompaniment improvisation real time raphael b thom last
useful musicology systematic study characterization expressive
timing principled analysis existing performance data
theoretical perspective simultaneous quantization tempo tracking
chicken egg quantization depends upon intended tempo interpretation tempo interpretation depends upon quantization apparently human
listeners resolve ambiguity cases without effort even persons without
musical training able determine beat tempo rapidly however
still unclear precisely constitutes tempo relates perception
beat rhythmical structure pitch style music etc tempo perceptual construct
cannot directly measured performance
goal understanding tempo perception stimulated significant body psychological computational modeling aspects tempo tracking
beat induction e g see desain honing large jones toiviainen
papers assume events presented onset list attempts made
deal directly audio signal goto muraoka scheirer dixon
cambouropoulos
another class tempo tracking developed context interactive
performance systems score following make use prior knowledge
form annotated score dannenberg vercoe puckette recently
raphael b demonstrated interactive real time system follows solo player
schedules accompaniment events according player tempo interpretation
tempo tracking crucial quantization since one uniquely quantize onsets
without estimate tempo beat converse quantization
help identification correct tempo interpretation already noted desain
honing one defines correct tempo one simpler
quantization however schema never fully implemented practice due
computational complexity obtaining perceptually plausible quantization hence



fimonte carlo methods tempo tracking rhythm quantization
quantization methods proposed literature estimate tempo simple
heuristics longuet higgins pressing lawrence agon assayag fineberg
rueda assume tempo known constant desain honing
cambouropoulos hamanaka goto asoh otsu
transcription tempo tracking probabilistic e bayesian
modeling perspective cemgil et al introduced probabilistic
perceptually realistic quantization work assumed tempo known
estimated external procedure tempo tracking introduced kalman filter
model cemgil kappen desain honing modeled tempo
smoothly varying hidden state variable stochastic dynamical system
current integrate quantization tempo tracking basically
model balances score complexity versus smoothness tempo deviations correct tempo
interpretation simple quantization correct quantization
smooth tempo uctuation essentially similar model proposed recently raphael
however raphael uses inference technique applies small
namely continuous hidden state one dimensional severely restricts
one consider current survey general widely used state ofthe art techniques inference
outline follows section propose probabilistic model
timing deviations expressive music performance given model define tempo
tracking quantization inference posterior quantities turn model
switching state space model computation exact probabilities becomes intractable section introduce approximation techniques simulation
namely markov chain monte carlo mcmc sequential monte carlo smc doucet
de freitas gordon andrieu de freitas doucet jordan approaches
provide exible powerful inference methods successfully applied diverse fields applied sciences robotics fox burgard thrun aircraft
tracking gordon salmond smith computer vision isard blake econometrics tanizaki finally present simulation conclusions

model
assume pianist improvising recording exact onset times key
presses performance denote observed onset times
yk yk compactly k neither access musical notation
piece know initial tempo started performance moreover
pianist allowed freely change tempo introduce expression given onset
time information k wish score k track tempo uctuations z k
refine meaning z later
apparently ill posed pianist allowed change tempo
arbitrarily possible assign correct score given performance
words performance k represented suitable combination
arbitrary score arbitrary tempo trajectory fortunately bayes theorem provides
elegant principled guideline formulate given onsets k
best score k tempo trajectory z k derived posterior distribution



ficemgil kappen
given

p j z p z
p k k k k k k
quantity proportional product likelihood term p k j k z k
prior term p k z k
rhythm transcription tempo tracking prior encodes background knowledge nature musical scores tempo deviations example construct prior prefers simple scores smooth tempo variations
likelihood term relates tempo score actual observed onset times
respect likelihood model short time expressive timing deviations motor
errors introduced performer

p k z k jy k

c
c
f
ck
ee

cc
f
ee
ee
cc

ee
ee
cc

ee
ee
cc

cc
e
e



c ee



k






bb

bb
bb

bb
bb

bb
bb

bb
b

b
b




b















cc quantization
cc
hh
cc
hh
cc
hh
cc
h

ck

hh

k

score

k
tempo

trajectory

ee

ee

ee

ee

e

k
noiseless

onsets

k e






k






locations



yk

yk

observed

onsets

figure graphical model square oval nodes correspond discrete continuous
variables respectively text sometimes refer continuous hidden
variables k k zk dependence c deterministic
c hidden onsets observed

score prior
define score k first introduce sequence quantization locations c k
quantization location ck specifies score time k th onset let k denote
interval quantization locations two consecutive onsets
k ck

ck



example consider conventional music notation
encodes score
corresponding quantization locations c
one simple way defining prior distribution quantization locations p ck specifying table probabilities ck mod fraction ck example wish








fimonte carlo methods tempo tracking rhythm quantization
allow scores sixteenth notes triplets define table probabilities
states c mod f g f g technically resulting prior
p ck periodic improper since ck principle unbounded normalize
distribution
however number states ck mod large may dicult estimate
parameters prior reliably situations propose generic prior follows
define probability k th onset gets quantized location ck p ck
exp ck ck number significant digits binary expansion ck
mod example etc positive parameter
used penalize quantization locations require bits represented assuming
quantization locations onsets independent priori besides increasing
k e ck ck p
prior probability sequence quantization locations given
p c k exp k
k ck assume c one check
p
generalize
prior prefers simpler notations e g p
prior subdivisions triplets quintiplets appendix
formally given distribution c k prior score k given








p k

x

c k













p k jc k p c k



since relationship c k k deterministic p k jc k degenerate
given c k

p k exp



k
k
x
x



k

k
one might tempted specify prior directly k get rid c k entirely
however simpler easy devise realistic priors example
consider sequence note durations assuming factorized prior
penalizes short note durations rhythm would relatively high probability
whereas quite uncommon conventional music
k

tempo prior
represent tempo terms inverse e period denote
example tempo beats per minute bpm corresponds seconds
onset tempo changes unknown amount k assume change k
iid n q assume first order gauss markov process tempo
k k k

eq defines distribution tempo sequences k given tempo sequence
ideal intended time k next onset given

k k k k k



denote scalar multivariate gaussian distribution p x mean vector covariance

matrix p n p
j p j exp x p x



ficemgil kappen
noise term k denotes amount accentuation deliberately playing
note ahead back time without causing tempo changed assume k
n q ideal onsets actually observed noisy onsets related

yk k k



noise term k small scale expressive deviations motor errors timing individual notes assume k gaussian distribution parameterized
n r
initial tempo distribution p specifies range reasonable tempi given
gaussian broad variance assume uninformative prior
conditional independence structure given graphical model figure table
shows possible realization model
note model particular instance well known switching state space
model known conditionally linear dynamical system jump markov linear system
switching kalman filter see e g bar shalom li doucet andrieu
murphy

k



k

ck
k
k
yk










table possible realization model ritardando clarity assume
following sections sometimes refer use zk k k refer z k
tempo trajectory given definition compactly represent eq eq

zk



k




zk k



k k k

extensions
several possible extensions basic parameterization example one could
represent period logarithmic scale warping ensures positivity seems
perceptually plausible since promotes equal relative changes tempo rather
absolute scale grubb cemgil et al although resulting model
becomes nonlinear approximated fairly well extended kalman filter barshalom li
simple random walk model tempo uctuations eq seems
realistic would expect tempo deviations structured smoother



fimonte carlo methods tempo tracking rhythm quantization
dynamical system framework smooth deviations modeled increasing
dimensionality z include higher order inertia variables cemgil et al
example consider following model


k
b
k
b
b
k
b
b


k




k k
k
c
b
c
b
c b k
c
b
c
b
c
b
k
b
c
c
b
c
b
c
b










k


c
c
c
k
c
c




choose particular parameterization wish interpret slowly
varying average tempo temporary change tempo model useful
situations performer uctuates around almost constant tempo random
walk model sucient case forgets initial values additional state
variables act additional memory elements choosing parameter
matrix noise covariance matrix q one model rich range temporal structures
expressive timing deviations
score prior improved richer model example allow
different time signatures alternative rhythmic subdivisions one introduce additional
hidden variables see cemgil et al appendix use markov chain raphael
potentially extensions make easier capture additional structure musical
rhythm weak positions followed likely strong positions
hand number model parameters rapidly increases one
cautious order avoid overfitting
score typesetting need quantize note durations well e associate note
offsets quantization locations simple way accomplishing define
indicator sequence u k identifies whether yk onset uk offset uk
given uk redefine observation model p yk jk uk uk n r
uk n roff roff observation noise associated offsets typical model
would roff r roff offsets would effect tempo process
moreover since uk observed extension requires simple lookup
principle one must allow arbitrary long intervals onsets hence k
drawn infinite discrete set subsequent derivations assume
number possible intervals fixed priori given estimate zk observation yk
almost virtually infinite number choices k almost zero probability
easy identify candidates would significant probability mass
conceptually listed extensions easy incorporate model
none introduces fundamental computational diculty basic
quantization tempo tracking



ficemgil kappen
definition
given model define rhythm transcription e quantization map state estimation
k argmax p k jy k

p k jy k

z k

dz k p k z k jy k

tempo tracking filtering
x
zk argmax p k zk jy k
zk

k



quantization smoothing wish likely score

k given onsets performance useful oine applications
score typesetting
real time interaction need online estimate tempo beat zk
information carried forth filtering density p k zk jy k eq
definition best tempo zk maximum somewhat arbitrary depending upon
requirements application p
one make use features filtering
density example variance k p k zk jy k used estimate amount
confidence tempo interpretation arg maxzk k p k zk jy k estimate
likely score tempo pair far
unfortunately quantities eq eq intractable due explosion
number mixture components required represent exact posterior step k
see figure example calculate exact posterior eq need evaluate
following expression
z

dz k p k jz k k p z k j k p k

p k jy k

z

p k j k p k

z
p
normalization constant given z p k k p k j k p k
trajectory k integral z k computed stepwise k kalman
filter see appendix b however map state eq need evaluate
p k j k independently exponentially many trajectories consequently
quantization eq solved approximately
accurate approximation wish exploit inherent independence structure
exact posterior unfortunately since z c integrated k become coupled
general p k jy k possess conditional independence structure e g
markov chain would facilitate ecient calculation consequently resort
numerical approximation techniques

monte carlo simulation
consider high dimensional probability distribution

p x p x
z





fimonte carlo methods tempo tracking rhythm quantization
























































































b






























figure














c

example demonstrating explosion number components represent
exact posterior ellipses denote conditional marginals p k k jc k k
period logarithmic scale k log k toy example assume
score consists notes length e k
start unimodal posterior p jc e g gaussian centered
since assume score consist eight quarter
notes e k f g predictive distribution p jc bimodal
modes centered respectively shown dashed contour
line next observation observed shown dashed vertical line around
predictive distribution updated yield p jc numbers
denote respective log posterior weight mixture component b predictive
distribution p jc step k modes two component
p jc c number components grows exponentially k








ficemgil kappen
r
normalization constant z dxp x known p x evaluated
particular x suppose want estimate expectation function f x
distribution p x denoted
z

hf x ip x dxf x p x
e g mean x p x given hxi intractable integration approximated average n points x n p x

hf x ip x n

n
x





f x



x generated independently sampling p x shown n
approaches infinity approximation becomes exact
however generating independent samples p x dicult task high dimensions usually easier generate dependent samples generate x
making use x somewhat surprising even x x correlated
provided ergodicity conditions satisfied eq remains still valid estimated
quantities converge true values number samples n goes infinity
sequence dependent samples x generated markov chain
stationary distribution p x chain defined collection transition probabilities e transition kernel x jx definition kernel implicit
sense one defines procedure generate x given x metropolis
metropolis ulam metropolis rosenbluth rosenbluth teller teller
provides simple way defining ergodic kernel desired stationary
distribution p x suppose sample x candidate x generated sampling symmetric proposal distribution q x jx example gaussian centered
x candidate x accepted next sample x p x p x x
lower probability still accepted probability p x p x
initialized generating first sample x according arbitrary
proposal distribution
however given transition kernel hard assess time required converge
stationary distribution practice one run simulation large
number samples obtained see e g roberts rosenthal choice
proposal distribution q critical poor choice may lead rejection
many candidates x hence resulting slow convergence stationary distribution
large class probability full posterior p x intractable one
still eciently compute marginals form p xk jx k x k x xk xk xk
exactly case one apply specialized markov chain monte carlo mcmc
gibbs sampler given
initialize x
k sampling proposal q x k
n





fimonte carlo methods tempo tracking rhythm quantization

k k sample


x ki p xk jx

k xk k
contrast metropolis candidate vector x
gibbs sampler uses exact marginal p xk jx k proposal distribution
step sampler updates one coordinate current state x namely xk
candidate guaranteed accepted
note principle need sample xk sequentially e choose k
randomly provided slice visited equally often limit however deterministic scan k k provides important time savings type
consider
simulated annealing iterative improvement
shift focus sampling map state estimation principle one use
samples generated sampling metropolis hastings gibbs estimate
map state x p x argmax p x however unless posterior much
n
concentrated around map state sampler may visit x even though samples
x obtained stationary distribution case simply
reformulated sample p x distribution concentrated local
maxima p x one class distributions given pj x p x j sequence
exponents j called cooling schedule annealing schedule
owing inverse temperature interpretation j statistical mechanics hence
name simulated annealing sa aarts van laarhoven j suciently
slowly j cascade mcmc samplers stationary distribution pj x
guaranteed limit converge global maximum p x unfortunately
convergence hold cooling schedule must go slowly fact logarithmically
infinity practice faster cooling schedules must employed
iterative improvement ii aarts van laarhoven heuristic simulated annealing fast cooling schedule fact j j eventual
advantage greedy converges iterations local maximum restarting many times different initial configurations x one hopes
different local maxima p x eventually visit map state x practice
ii heuristic one may better solutions sa limited computation time
implementation point view trivial convert mcmc code sa ii
code example consider gibbs sampler implement sa need construct
cascade gibbs samplers stationary distribution p x j exact one time
slice marginal distribution p xk jx k j sa samples actual
temperature marginal p xk jx k raised power j
switching state space model map estimation
solve rhythm quantization need calculate map state
posterior eq
p k jy k

z

p k dz k p k jz k k p z k j k




ficemgil kappen
combinatorial optimization seek maximum function p k jy k
associates number discrete configurations k since feasible
visit exponentially many configurations maximizing configuration
k resort stochastic search simulated annealing sa
iterative improvement ii due strong relationship gibbs sampler
sa ii first review gibbs sampler switching state space model
first important observation conditioned k model becomes linear
state space model integration z k computed analytically kalman
filtering equations consequently one sample k integrate z
analytical marginalization called rao blackwellization casella robert improves
eciency sampler e g see doucet de freitas murphy russell
suppose switch variable k distinct states wish
n g naive implementation
generate n samples e trajectories f ik
gibbs sampler requires step k run kalman filter times whole
observation sequence k compute proposal p k j ik k k k would
time complexity nk prohibitively slow k
large carter kohn proposed much time ecient deterministic scan
gibbs sampler circumvents need run kalman filtering equations
step k whole observation sequence k see doucet andrieu murphy

method observation proposal distribution p k j
factorized product terms depend past observations k
future observations yk k contribution future computed priori
backward filtering pass subsequently proposal computed samples k
generated forward pass sampling distribution given

p k j k k p k j k p k j k



first term proportional joint prior p k j k p k k second
term decomposed

p k j k


z
z

dzk p yk k jy k zk k p k zk j k



dzk p yk k jzk k k p k zk j k



terms unnormalized gaussian potentials hence integral evaluated
analytically term p yk k jzk k k unnormalized gaussian potential zk
computed backwards filtering second term filtering distribution
p zk jy k k scaled likelihood p k j k computed forward
filtering outline given see appendix b details
initialize k sampling proposal q k
n

k k


fimonte carlo methods tempo tracking rhythm quantization



compute p yk k jzk k k
k k

compute proposal
p k sj p k k

z

dzk p k zk j ik k p yk k jzk k k

sample k p k j
resulting time complexity nks important saving terms
time however space complexity increases k since expectations
computed backward pass need stored
step gibbs sampler generates sample single time slice k
certain types sticky dependence k k
strong sampler may get stuck one configuration moving rarely due
fact singleton ips end low probability configurations due strong
dependence adjacent time slices example consider quantization model
two configurations k k updating
single slice may dicult move two configurations consider
intermediate configuration since duration k k increases
future quantization locations ck k shifted may correspond score
heavily penalized prior thus blocking path
allow sampler move freely e allow global jumps one
sample l slices jointly case proposal distribution takes form
p k k l j p k k l k k l
z
dzk l p k l zk l j ik k k l p yk l k jzk l k l k
similar one slice case terms integral unnormalized gaussian potentials
zk l representing contribution past future observations since k k l
l states resulting time complexity generating n samples nks l thus
practice l must kept rather small one remedy would use metropolis hastings
heuristic proposal distribution q k k l jy k circumvent exact calculation obvious construct q
one shortcoming gibbs sampler related mcmc methods
standard form inherently oine need access
observations k start simulation certain applications e g automatic score
typesetting batch might still feasible however scenarios require
real time interaction interactive music performance tempo tracking online
methods must used
sequential monte carlo
sequential monte carlo k particle filtering powerful alternative mcmc
generating samples target posterior distribution smc especially suitable
application dynamical systems observations arrive sequentially



ficemgil kappen
basic idea smc represent posterior p x k jy k time k
possibly weighted set samples fx k n g extend representation
f x k x ki n g observation yk becomes available time k
common practice use importance sampling
importance sampling

consider high dimensional probability distribution p x p x z unknown
normalization constant suppose given proposal distribution q x close
p x high probability regions distributions fairly overlap
p generate
independent samples e particles x proposal q x ni x
x n approximate
p x
q x

p x
z q x
n

x
z pq xx n x x


n
x
w


pn j x x
j w

w p x q x importance weights one interpret w correction factors compensate fact sampled incorrect distribution q x given approximation eq estimate expectations weighted
averages
n
x
hf x ip x
w f x

w w

pn
j







w

j normalized importance weights

sequential importance sampling

wish apply importance sampling dynamical model

p x k jy k



k

k



p yk jxk p xk jx k



x fz g principle one naively apply standard importance sampling
arbitrary proposal distribution q x k however finding good proposal distribution
hard k key idea sequential importance sampling sequential
construction proposal distribution possibly available observations k e

q x k jy k

k

k





q xk jx k k

fimonte carlo methods tempo tracking rhythm quantization
given sequentially constructed proposal distribution one compute importance
weight recursively

p x k jy k p yk jx ki p x ki jx k k p k jx k p x k


q x k jy k
q x ki jx k k
q x k jy k
p yk jx ki p x ki jx k k

wk

q x ki jx k k

wk

sequential update schema potentially accurate naive importance sampling since step k one generate particle fairly accurate proposal
distribution takes current observation yk account natural choice
proposal distribution filtering distribution given

q xk jx k k p xk jx k k



case weight update rule eq simplifies

wk p yk jx k wk
fact provided proposal distribution q constructed sequentially past sampled trajectories updated filtering distribution optimal choice sense
minimizing variance importance weights w doucet godsill andrieu b
note eq identical proposal distribution used gibbs sampling k k
eq k k smc proposal take future observations account
introduce discount factors wk compensate sampling wrong distribution
selection

unfortunately sequential importance sampling may degenerate fact
shown variance wk increases k practice iterations
one particle almost probability mass
computation time wasted updating particles negligible probability
avoid undesired degeneracy several heuristic approaches proposed
literature basic idea duplicate discard particles according
normalized importance weights selection procedure deterministic stochastic deterministic selection usually greedy one chooses n particles highest
importance weights stochastic case called resampling particles drawn
probability proportional importance weight wk recall normalized weights
fw k n g interpreted discrete distribution particle labels

smc switching state space model
sis directly applied switching state space model sampling
directly xk zk k however particulate approximation quite poor z



ficemgil kappen




































figure outline ellipses correspond conditionals
p zk j k k vertical dotted lines denote observations yk step
k particles low likelihood discarded surviving particles linked
parents

high dimensional hence many particles may needed accurately represent
posterior
similar mcmc methods introduced previous section eciency
improved analytically integrating z k sampling k fact
form rao blackwellization reported give superior compared standard
particle filtering z sampled jointly chen liu doucet et al
b improvement perhaps surprising since importance sampling performs
best sampled space low dimensional
intuitive interpretation terms randomized breadth first tree
search procedure step k expand n kernels obtain n kernels
consequently avoid explosion number branches select n n
branches proportional likelihood see figure derivation technical details
given appendix c
tree search interpretation immediately suggests deterministic version one selects without replacement n branches highest weight
refer method greedy filter gf method known split track
filter chen liu closely related multiple hypothesis tracking mht
bar shalom fortmann one greedy selection schema gf
loss particle diversity even particles initialized different locations z
e g different initial tempi mainly due discrete nature state space k
particles become identical steps k consequently
improved increasing number particles n nevertheless
particles used say e g real time application gf may still viable choice



fimonte carlo methods tempo tracking rhythm quantization

optimal
figure hypothetical situation neither two particles
would obtain eventually higher likelihood configuration interchanging
particles
smc estimation map trajectory
mcmc smc sampling method hence comments made section
jy
eventual suboptimality estimating map trajectory particles arg max p ik
k
apply hypothetical situation shown figure
one obvious solution employ sa trick raise proposal distribution
power p k j however proposal peaked time
slice consequently particles become identical time
eventually degenerates greedy filtering
estimating map trajectory set smc samples recently
proposed literature godsill doucet west relies
observation particles x ki sampled forward pass one left
n
discrete distribution defined discrete supportn
x k k
k xk xk denotes
support filtering distribution time k cartesian product

sets formally xk set distinct samples time k given xk fx ki g
distribution p x k jy k markovian original state transition model
markovian e posterior represented exactly
p x k jy k

k


p yk jxk p xk jxk

consequently one best map trajectory arg max p x k
analogous viterbi hidden markov rabiner
however idea carry directly case one applies rao blackwellization general subset hidden variables
nisk integrated sall time
slices posterior p k jy k coupled k k k k f k g
one still employ chain approximation run viterbi e g cemgil kappen
guarantee arg max p k jy k
hand k drawn discrete set several particles become
identical k usually small cardinality compared number particles
n consequently becomes feasible employ sa ii reduced state space k
possibly proposal distribution extends several time slices l
k

slight abuse notation use symbol xk set general element used
argument density p yk jxk means p yk jxk xk xk



ficemgil kappen
n g
practice finding map solution particle set f ik
p apply iterative
propose best trajectory arg maxi p k j ik
k

improvement starting initial configuration ik

simulations
compared inference methods terms quality solution execution time tests carried artificial real data
given true notation true
k measure quality solution terms
log likelihood difference
l log

p k j k p k
true
p k j true
k p k

terms edit distance

e k

k
x

k

ktrue


edit distance e k gives simply number notes quantized wrongly
k

artificial data clave pattern
c
synthetic example repeating son clave pattern
uctuating tempo repeat pattern times obtain score k
k
syncopated rhythms usually hard transcribe make dicult track
tempo even experienced human listeners moreover since onsets absent
prominent beat locations standard beat tracking usually loose track
given score k generated observation sequences k sampling
tempo model eq parameterized observation noise variance
q k qa qb formulation variance depends length interval
consecutive onsets longer notes score allow tempo timing
uctuation tests clave example used prior model ects
true source statistics instead used generic prior model defined section

example cases sampled score clave pattern however due
use generic prior capture exact source statistics well
relatively broad noise model map trajectory k given k identical

original clave pattern th example defined ground truth true
k
highest likelihood solution found sampling technique independent
run although definition ground truth introduces bias found
exercise realistic well discriminative among methods
compared e g dataset essentially shorter sequences exact map


















noise covariance parameters r qa qb identity
matrix



fimonte carlo methods tempo tracking rhythm quantization
trajectory computed exhaustive enumeration wish stress main
aim simulations synthetic dataset compare effectiveness different inference
techniques postpone actual test whether model good one simulations
real data
tested mcmc methods namely gibbs sampling gibbs simulated annealing sa iterative improvement ii one two time slice optimal proposal
sweeps onset yk optimal proposal p k j computed
fixed set f g figure shows typical run mcmc
similarly implemented smc n f g particles
selection schema random drawing optimal proposal p k j computed
one two time slices special case greedy filtering gf e n
selected switch maximum probability example run shown figure
observe average smc superior mcmc figure observe
increasing number sweeps mcmc improve solution significantly
hand increasing number particles seems improve quality
smc solution monotonically moreover suggest sampling two time
slices jointly exception sa big effect gf outperforms
particle filter particles draws randomly proposal suggests
pf small number particles n may desirable use hybrid selection
schema selects particle maximum weight automatically randomly selects
remaining n
compare inference methods terms execution time quality solutions
measured edit distance figure suggests two slice proposal justified
moreover seems comparable computational effort smc tends outperform
mcmc methods

real data beatles
evaluate performance model polyphonic piano performances pianists
invited play two beatles songs michelle yesterday pieces relatively
simple rhythmic structure ample opportunity add expressiveness uctuating
tempo original score shown figure subjects different musical education background four professional jazz players four professional classical performers
four amateur classical pianists arrangement played three tempo
conditions three repetitions per tempo condition tempo conditions normal slow
fast tempo musically realistic range according judgment
performer details reported cemgil et al
preprocessing

original performances contained several errors missing notes additional notes
original score errors eliminated matching technique heijink desain honing dynamical programming however visual
inspection resulting dataset suggested still several matching errors interpret
outliers remove outliers extended quantization model two
state switching observation model e discrete space consists k ik simple



ficemgil kappen












































figure particle filtering clave example particles circle denotes mean
k n k n k n log k diameter particle proportional
normalized importance weight generation denote true
pairs modulated tempo deterministically according
k sin ck observation noise variance r



fimonte carlo methods tempo tracking rhythm quantization



log likelihood




gibbs
sa
ii
gf
desired





figure







gibbs sweep





typical runs gibbs sampling simulated annealing sa iterative improvement
ii clave example initialized greedy filter solution
annealing schedule sa linear proceeding deterministically sa ii converge configuration reinitialize
particle filter one particle draws randomly proportional optimal
proposal sharp drops likelihood correspond reinitializations see
first sweep greedy filter solution slightly improved ii consequently sampler reinitializes likelihood sa drops considerably mainly due
high temperature consequently stabilizes suboptimal solution gibbs
sampler seems explore support posterior able visit map
state run



ficemgil kappen

log likelihood difference










slice
slice


sa

gibbs

ii

gf

pf

likelihood difference


slice
slice

edit distance







sa

gibbs

ii

gf

pf

b edit distance mcmc sweeps omitted

figure

comparison inference methods clave data squares ovals denote
median vertical bars correspond interval quantiles
tested mcmc methods gibbs sa ii independently
shown left right smc methods greedy filter gf particle filter
pf tested filters n f g particles independently shown
left right



fimonte carlo methods tempo tracking rhythm quantization

sa

sa

median edit distance





pf

pf

pf


gf

ii pf

gf

gi

gi
ii





pf

pf

pf
pf

flops log scale

figure

comparison execution time terms oating point operations methods
first number denotes number slices used optimal proposal distribution
particle filter pf second number denotes number particles
dashed lines merely used connect related methods

outlier detection mechanism switch ik binary indicator variable specifying whether
onset yk outlier assume indicators independent priori
uniform prior observation model given p yk jik k n rik
since score k known unknown discrete quantities indicators k
used greedy filtering followed iterative improvement map state
indicators k eliminated outliers studies many performances
around outliers less notes resulting dataset
downloaded url http www snn kun nl cemgil
parameter estimation

trained tempo tracking different dimensionality denotes
dimension hidden variable z use transition matrix
form eq
since true score known e quantization location ck onset yk given
clamp discrete variables model consequently estimate
observation noise variance r transition noise variance q transition matrix
coecients data
optimized parameters expectation maximization em linear
dynamical systems shumway stoffer ghahramani hinton perfor took rik rik



ficemgil kappen
mances yesterday training data similarly score prior parameters estimated
frequency counts score yesterday tests carried michelle


figure typesetting performance without tempo
tracking due uctuations tempo quality automatically generated score
poor quality significantly improved model
figure shows tempo tracking examples michelle dataset pianists
different background training observe cases satisfactory
figure give summary test michelle data terms loglikelihood edit distance function model order number particles used
inference figure shows median likelihood test data increasing
model order suggests higher order filter able capture structure pianists expressive timing moreover sythetic data see somewhat monotonic
increase likelihood solutions found particles
edit distance original score estimates given figure b
since pieces arranged piano due polyphony many onsets
associated quantization location consequently many ktrue original
score effectively zero cases typically corresponding inter onset interval
yk yk small correct quantization namely k identified
even tempo estimate completely wrong consequence edit distance remains
small make task slightly challenging exclude onsets ktrue
edit distance calculation
observe extra prediction ability obtained higher order model
directly translate better transcription errors around
hand variance edit distance higher order smaller
suggests higher order tend robust divergence
original tempo track

discussion
presented switching state space model joint rhythm quantization tempo
tracking model describes rhythmic structure musical pieces prior distribution quantization locations representation easy construct generic
prior prefers simpler notations learn parameters data set prior
quantization locations c k translates non markovian distribution score k
timing deviations introduced performers tempo uctuation accentuations motor errors modeled independent gaussian noise sources performer specific timing
preferences captured parameters distributions
given model formulated rhythm quantization map state estimation
tempo tracking filtering introduced markov chain
maximum likelihood parameters model dimension found r
q q q prior p c p p
p p remaining p c set



fimonte carlo methods tempo tracking rhythm quantization

michelle
lennon mccartney

bb




b b n n ww n


w
b b b
w



w
b




piano









bb
b b

bb
bb



n


n


bb
b b n


bb

bb















n



n

n n w n
j



n
n n


n


n







n n


n

n

n















































































































bb
b b n

bb
bb


n n


bb
b b

j
bb
bb
n



bb
b b n w
w
bb
bb



j




b







j








n









n



j
ww
w







n




j




























n ww
w

n n

w



original score






































b typesetting without
processing model
due uctuations
tempo quality
score poor

figure

























q










































































































c typesetting tempo
tracking quantization
particle filter

typesetting scores

























ficemgil kappen




estimated
original

estimated
original






log



log

k



k










































k













k

professional jazz pianist

b amateur




estimated
original

estimated
original










log



log

k



k






































k



















k

c professional classical pianist
filter temporarily loses track

figure



tracking twice rate
original tempo

examples filtered estimates
z k k k beatles data set circles
original
denote mean p zk j k k x denote mean p zk j k k obtained
smc interesting note different timing characteristics example classical
pianist uses lot tempo uctuation professional jazz pianist jazz pianist
slows dramatically end piece amateur rushes e constantly
accelerates beginning tracking quantization b
satisfactory filter loses track last two notes pianist
dramatically slows c filter loses track catches
filter jumps metrical level twice fast original performance
would translate duplication note durations



fimonte carlo methods tempo tracking rhythm quantization





likelihood
















model dimension



likelihood dashed horizontal line shows median
likelihood original score michelle model






percent edit distance




















model dimension



b edit distance

figure

smc test data performances michelle model
obtained n particles median
best particle x denote median applying iterative improvement
vertical bars correspond interval quantiles


ficemgil kappen
monte carlo mcmc sequential monte carlo smc approximate respective
distributions
quantization model propose similar raphael transcription raphael proposes compute arg max p c k z k jy k uses message propagation scheme essentially analogous rao blackwellized particle filtering prevent
number kernels explosion uses deterministic selection method called
thinning advantage raphael joint map trajectory
computed exactly provided continuous hidden state z one dimensional
model parameter regime keeps number propagated gaussian kernels
limited e g r small thinning eliminate many kernels one disadvantage
number kernels varies depending upon features filtering distribution
dicult implement scheme real time perhaps importantly simple extensions increasing dimensionality z introducing nonlinearities
transition model would render quickly invalid contrast monte carlo
methods provide generic inference technique allow great exibility one
employ
tested method challenging artificial clave example smc
outperformed mcmc terms quality solutions measured terms
likelihood well edit distance propose use smc
finding map quantization propose apply iterative improvement ii smc
solution reduced configuration space
correct choice score prior important overall performance
system music pieces tend certain rhythmical vocabulary certain
rhythmical motives reoccur several times given piece rhythmic structure depends
mostly upon musical genre composer seems rather dicult devise
general prior model would work well large spectrum styles nevertheless
given genre expect simple prior capture enough structure sucient good
transcription example beatles dataset estimated prior counting
original score yesterday statistics fairly close michelle
good test set partially accounted fact pieces
similar rhythmical structure
conditioned score tempo tracking model linear dynamical system
optimized several tempo em varied dimension
tempo variables z test suggest increasing dimensionality z improves
likelihood however increase likelihood whole dataset translate
directly overall better quantization measured edit distance observe
trained whole training data fail consistently subjects especially
professional classical pianists perhaps interestingly train custom specifically
optimized subjects improve significantly test cases
observation suggests kind multimodality parameter space modes
correspond different performer regimes seems kalman filter able capture
structure expressive timing deviations however averaged subjects
details tend wiped suggested quantization
vary significantly among different dimensions



fimonte carlo methods tempo tracking rhythm quantization
related edit distance measure average model
likelihood desired score e g original score michelle may lower likelihood
solution found inference method cases increasing likelihood may
even decrease edit distance test cases even observe solutions higher
likelihood original notation notes wrong cases
tempo trajectory solution correspond half twice original tempo
consequently note durations halved doubled e g whole notes notated
half notes half notes quarters e c considering fact model self
initializing tempo assume broad uncertainty priori still
satisfactory practical application perspective
one potential shortcoming model takes timing information onsets
account reality believe pitch melodic grouping well articulation
duration note onsets offsets dynamics louder softer provide useful
additional information tempo tracking well quantization moreover current model
assumes onsets equally relevant estimation probably general
true example kick drum provide information tempo
ute hand simulations suggest even limited model one
obtain quite satisfactory least simple piano music
somewhat surprising smc basically method samples filtering
distribution outperforms mcmc method sa specifically designed
finding map solution given observations intuitive explanation relatively
poorer mcmc mcmc proceeds first proposing global solution
tries improve local adjustments human transcriber hand would
listen shorter segments music gradually write score respect
sequential update schema smc seems natural rhythm transcription similar smc outperforms mcmc already reported
literature e g called growth monte carlo generating self avoiding random
walks liu chen logvinenko seems large class dynamical including rhythm transcription sequential updating preferable batch methods
note theoretical convergence sa require use logarithmic
cooling schedule seems cooling schedule fast meet requirement
one still careful interpreting poor performance negative sa
maintain richer neighborhood structure configuration space e g
block proposal distribution slower cooling schedule sa
improved significantly moreover mcmc methods modified operate
sequentially example see marthi pasula russell peres
another family inference methods switching state space rely deterministic approximate methods family includes variational approximations ghahramani
hinton expectation propagation heskes remains interesting open
question whether deterministic approximation methods provide advantage terms
computation time accuracy particular quantization
switching state space potential application deterministic approximation
techniques mcmc schema designing proposal distributions extend
several time slices schema would circumvent burden computing optimal
proposal distribution exhaustively hence allowing global moves sampler



ficemgil kappen
current suggest superiority smc perhaps
important advantage smc essentially anytime
faster computer increase number particles make use additional
computational power computing time becomes short one decrease number
samples features make smc attractive real time applications one
easily tune quality computation time tradeoff
motivated practical advantages smc positive simulation
implemented prototype smc method real time current computer system
mhz p laptop pc running ms windows allows us use particles
almost delay even busy passages expect significantly improve eciency
translating matlab c constructs native c code hence method used
tempo tracker automatic interactive performance system quantizer
automatic score typesetting program

acknowledgments
supported technology foundation stw applied science division
nwo technology programme dutch ministry economic affairs
would thank associate editor daphne koller anonymous reviewers
comments helped us significantly improve article would
thank ric ashley peter desain henkjan honing paul trilsbeek suggestions
contributions data collection moreover gratefully acknowledge pianists
northwestern university nijmegen university excellent performances

appendix generic prior model quantization locations c
traditional western music notation note durations generated recursive subdivisions
starting whole note hence convenient generate quantization locations
similar fashion regular subdivisions decompose quantization location
integer part fraction c bcc c mod defining prior use
fraction
set fractions generated recursively subdividing unit interval
let si denote subdivision schema si finite sequence
arbitrary integers usually small primes choice particular
depends mainly assumed time signature generate set fractions c
follows first iteration divide unit interval intervals equal length
append endpoints c resulting intervals set c following iteration
subdivide intervals generated previous iteration si equal parts append
resulting endpoints c note thisqprocedure generates regular grid two
neighboring grid points distance si denote iteration number
endpoint c first inserted c depth c respect number
denoted c js easy see definition coincides number
significant bits represent c mod
illustirative example consider subdivision first iteration
unit interval divided equal intervals resulting endpoints



fimonte carlo methods tempo tracking rhythm quantization
inserted c depths second iteration
endpoints inserted c assigned depth
given define distribution quantization locations

p ck js exp ck mod js
wish consider several time signatures e different subdivision schemata
interpret hidden indicator variable define
p prior p case prior
becomes multinomial mixture given p ck p ck js p details
empirical justifying choice see cemgil et al

appendix b derivation two pass kalman filtering equations
consider gaussian potential mean covariance defined domain
indexed x



x z n z j j exp x x

r
dx x z z potential normalized exponent eq
quadratic form potential written

x kx

x exp g ht x



k
k
h
g log z log j j
h k h


denote potential canonical form use notation

x z n h k g
refer g h k canonical parameters consider gaussian
potential x x canonical representation

x x



h
h




k k
k k


g

several variables interacting one desired quantities applying
three basic operations defined gaussian potentials multiplication conditioning marginalization multiplication two gaussian potentials index
set x follows directly eq given
x x b x
h k g ha ka ga hb kb gb ha hb ka kb ga gb
domain b overlaps subset potentials extended
appropriate domain appending zeros corresponding dimensions



ficemgil kappen
marginalization operation given

x

z

k k h k

x x h

x

k k k g

g g log jk j h k h g initial constant term x x
conditioning operation given
x x x h k x k g

x k x


g g ht x

b kalman filter recursions
suppose given following linear model subject noise
zk azk k
yk czk k
c constant matrices k n q k n r
model encodes joint distribution
k


p yk jzk p zk jzk

p z jz p z

p z k k

k






p z p p log j p j
p



tr


c
r
c
c
p jz

log j rj

r c
r



p jz c r c r c log j rj
r





tq



q


p z jz
log j qj

q
q


b forward message passing

suppose wish compute likelihood

p k

z

zk

p yk jzk

z

z

p z jz p jz

z
z

p z jz p jz p z

compute integral starting z proceeding zk define forward
messages
r
r
let z dz



fimonte carlo methods tempo tracking rhythm quantization

j p z
k k
ffkjk p yk k jzk ffkjk
r
ffk jk zk p zk jzk ffkjk
forward recursion given
j p p log j p j
k k

p


ffkjk hkjk kkjk gkjk
hkjk c r k hkjk
kkjk c r c kkjk
gkjk gkjk log j rj r k
ffk jk hk jk kk jk gk jk
mk q kkjk
hk jk q amk hkjk
kk jk q q amk q
gk jk gkjk log j qj log j mk j htkjk mk hkjk
b backward message passing

compute likelihood starting yk

p k

z

z

p z p jz

z

z

p z jz p jz

z
zk

case backward propagation summarized

fik jk
k k
fikjk p yk k jzk fikjk
r
fik jk zk p zk jzk fikjk
recursion given

hk jk kk jk gk jk
k k
fikjk hkjk kkjk gkjk
hkjk c r k hkjk
kkjk c r c kkjk



p zk jzk p yk jzk

ficemgil kappen
gkjk log j rj kt r k gkjk
fik jk hk jk kk jk gk jk
mk q kkjk
hk jk q mk hkjk
kk jk q q mk q
gk jk gkjk log j qj log j mk j h tkjk mk hkjk
b kalman smoothing
suppose wish distribution particular zk given observations k
combine forward backward messages
p zk jy k

p yk k zk k

p k zk p yk k jzk
ffkjk fikjk
hkjk hkjk kkjk kkjk gkjk gkjk

appendix c rao blackwellized smc switching state space
model
let n index particles index states
denote unnormalized filtering distribution time k
ki p k zk j ik
since k observed ki gaussian potential zk parameters zk
n
note normalization constant zk data likelihood p k j ik
r k k
dzk k similarly denote filtered distribution next slice conditioned
k

ksji


z

dzk p yk jzk p zk jzk k ki

p k zk j ik k
denote normalization constant ksji zk sji hence joint proposal
given
qk sji

z

dzk ksji p k ik
p k ik k

outline given
initialize n p x



fimonte carlo methods tempo tracking rhythm quantization

k k
n
compute ksji ki eq
qk sji zk sji p k ik
n
select tuple sjj qk
ik jk k
ki ksjj
p sjj
wk
qk
note procedure built resampling schema eliminating particles
small importance weight sampling jointly sji equivalent sampling single
resampling according weights wk one check
since optimal proposal distribution eq weight step
given wk p ik k

references

aarts e h l van laarhoven p j statistical cooling general
combinatorial optimization philips journal
agon c assayag g fineberg j rueda c kant critique pure quantification
proceedings international computer music conference pp aarhus denmark
international computer music association
andrieu c de freitas n doucet jordan introduction mcmc
machine learning machine learning appear
bar shalom fortmann e tracking data association academic press
bar shalom li x r estimation tracking principles techniques software
artech house boston
cambouropoulos e midi traditional musical notation proceedings aaai
workshop artificial intelligence music towards formal composition performance analysis austin texas
carter c k kohn r markov chain monte carlo conditionally gaussian state space
biometrika
casella g robert c p rao blackwellisation sampling schemas biometrika

cemgil desain p kappen h j rhythm quantization transcription computer
music journal
cemgil kappen h j rhythm quantization tempo tracking sequential
monte carlo dietterich g becker ghahramani z eds advances neural
information processing systems mit press
cemgil kappen h j desain p honing h tempo tracking tempogram
representation kalman filtering journal music
chen r liu j mixture kalman filters j r statist soc


ficemgil kappen
dannenberg r line real time accompaniment proceedings icmc
pp san francisco
desain p honing h quantization musical time connectionist todd
p loy g eds music connectionism pp mit press cambridge
mass
desain p honing h brief introduction beat induction proceedings icmc
san francisco
dixon cambouropoulos e beat tracking musical knowledge horn w ed
proceedings ecai th european conference artificial intelligence amsterdam
doucet andrieu c iterative state estimation jump markov linear
systems ieee trans signal processing
doucet de freitas n gordon n j eds sequential monte carlo methods
practice springer verlag york
doucet de freitas n murphy k russell rao blackwellised particle filtering
dynamic bayesian networks uncertainty artificial intelligence
doucet godsill andrieu c b sequential monte carlo sampling methods
bayesian filtering statistics computing
fox burgard w thrun markov localization mobile robots dynamic
environments journal artificial intelligence jair
ghahramani z hinton g variational learning switching state space neural
computation
ghahramani z hinton g e parameter estimation linear dynamical systems crgtr tech rep university totronto dept computer science
godsill doucet west maximum posteriori sequence estimation monte
carlo particle filters annals institute statistical mathematics
gordon n j salmond j smith f novel nonlinear nongaussian bayesian state estimation iee proceedings part f radar signal processing
vol pp
goto muraoka music understanding beat level real time beat tracking
audio signals rosenthal f okuno h g eds computational auditory scene
analysis
grubb l probabilistic method tracking vocalist ph thesis school computer
science carnegie mellon university pittsburgh pa
hamanaka goto asoh h otsu n learning quantization estimation
onset times musical score proceedings th world multi conference systemics
cybernetics informatics sci vol x pp
heijink h desain p honing h make match evaluation different approaches
score performance matching computer music journal
heskes zoeter expectation propagation approximate inference dynamic
bayesian networks proceedings uai
isard blake contour tracking stochastic propagation conditional density
eccv pp
large e w jones r dynamics attending track time varying events
psychological review
liu j chen r logvinenko theoretical framework sequential importance
sampling resaampling doucet de freitas n gordon n j eds sequential
monte carlo methods practice pp springer verlag


fimonte carlo methods tempo tracking rhythm quantization
longuet higgins h c mental processes studies cognitive science mit press cambridge p
marthi b pasula h russell peres decayed mcmc filtering proceedings
uai
metropolis n rosenbluth rosenbluth teller teller e equations state
calculations fast computing machines journal chemical physics
metropolis n ulam monte carlo method journal american statistical
assoc
murphy k p dynamic bayesian networks representation inference learning ph
thesis university california berkeley
pressing j lawrence p transcribe comprehensive autotranscription program
proceedings international computer music conference pp tokyo computer
music association
rabiner l r tutorial hidden markov selected applications speech
recognation proc ieee
raphael c mixed graphical model rhythmic parsing proc th conf
uncertainty artif int morgan kaufmann
raphael c b probabilistic expert system automatic musical accompaniment journal
computational graphical statistics
roberts g rosenthal j markov chain monte carlo practical implications
theoretical canadian journal statistics
scheirer e tempo beat analysis acoustic musical signals journal acoustical
society america
shumway r h stoffer time series smoothing forecasting
em j time series analysis
tanizaki h nonlinear non gaussian state space modeling monte carlo techniques
survey comparative study rao c shanbhag eds handbook statistics
vol stochastic processes modeling simulation north holland
thom b unsupervised learning interactive jazz blues improvisation proceedings
aaai aaai press
toiviainen p interactive midi accompanist computer music journal
vercoe b puckette synthetic rehearsal training synthetic performer
proceedings icmc pp san francisco international computer music association
vercoe b l gardner w g scheirer e structured audio creation transmission
rendering parametric sound representations proc ieee




