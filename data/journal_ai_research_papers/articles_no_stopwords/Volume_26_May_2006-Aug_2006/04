journal artificial intelligence

submitted published

convexity arguments efficient minimization
bethe kikuchi free energies
tom heskes

heskes science ru nl

iris faculty science radboud university nijmegen
toernooiveld ed nijmegen netherlands

abstract
loopy generalized belief propagation popular approximate inference markov random fields bayesian networks fixed points
shown correspond extrema bethe kikuchi free energy
approximations exact helmholtz free energy however belief propagation converge motivates approaches explicitly minimize
kikuchi bethe free energy cccp ups
describe class solves typically non convex constrained
minimization sequence convex constrained minimizations upper
bounds kikuchi free energy intuitively one would expect tighter bounds lead
faster indeed convincingly demonstrated simulations several
ideas applied obtain tight convex bounds yield dramatic speed ups cccp

introduction
pearls belief propagation pearl popular inference bayesian
networks known exact special cases e g tree structured singly connected
networks gaussian discrete nodes networks containing cycles
called loopy belief propagation empirically often leads good performance approximate
marginals close exact marginals murphy weiss jordan mceliece mackay
cheng notion fixed points loopy belief propagation correspond
extrema called bethe free energy yedidia freeman weiss important
step theoretical understanding success
kikuchi free energy kikuchi generalization bethe free energy
lead better approximations exact helmholtz free energy fixed points
loopy belief propagation correspond extrema bethe free energy fixed points
called generalized belief propagation yedidia et al correspond
extrema kikuchi free energy
loopy generalized belief propagation
converge stable fixed point yuille teh welling
derived therefore explicitly minimize bethe kikuchi free energy
describe section minimization kikuchi free energy corresponds usually nonconvex constrained minimization non convex constrained minimization
known rather difficult solve section first derive sufficient
conditions kikuchi free energy convex set constraints section
derive class converging double loop inner loop
corresponds constrained minimization convex bound kikuchi free energy
c

ai access foundation rights reserved

fiheskes

outer loop step recalculation bound intuition
tightest bound yields fastest come several ideas construct
tight bounds see yuilles cccp corresponds special
case rather loose bound discuss relationship ups teh
welling section simulations section illustrate use tight
convex bounds several inference implications issues discussed
section technical details treated appendices

kikuchi approximation
exact inference graphical often intractable section introduce
kikuchi approximation particular example variational towards approximate inference
graphical
undirected graph g v e consists set nodes vertices v n
joined set edges e place node variable xi takes values
finite discrete alphabet vector containing variables denoted x x xn
let subset v call region clique fully connected subset v c
set cliques potential referred compatibility kernel function x
strictly positive function depends variables part clique
define probability distribution probability mass function
pexact x


x
z



c

z normalizing constant often called partition function hammersleyclifford theorem besag guarantees us underlying probability process
markov respect graph vice versa distribution markov random field g strictly positive expressed form process
moralization directed graphical model bayesian network transformed
corresponding undirected model consequently probability distribution corresponding
bayesian network written form lauritzen
computing partition function z well computing marginals subsets variables principle requires summation exponential number states circumvent
exponential summation two kinds approaches sampling techniques
variational methods sampling one draws samples exact probability distribution variational methods try approximation exact probability
distribution
variational methods
variational methods often derived approximation called free energy
x
xx
p x log x
p x log p x e p p

f p
c x

x



fiefficient minimization kikuchi free energy

first term e p referred energy second term p entropy
functional minimization f p respect functions p x constraint
p x properly normalized yields pexact x furthermore partition function z
follows
log z f pexact
stick exact free energy really gain anything entropy
part p still consists sum exponentially many terms variational methods
tractable approximation free energy roughly divided two
classes mean field kikuchi approximations mean field one
confines minimization free energy restricted class tractable probability
distributions instead considering class p probability distributions
log z f pexact min f p min f p
pp

pt

crux choose class entropy p becomes tractable p
note however restriction typically affects energy term e p jordan
ghahramani jaakkola saul jaakkola jordan
kikuchi approximation free energy leaves energy term
approximates entropy p combination marginal entropies
x
x
p
p x log p x
c p
r

x



x

c

r

x

p x log p x



x

r denotes collection called regions parameters c called moebius
overcounting numbers
partially ordered sets
following pakzad anantharam use language partially ordered
sets posets specifically collection r regions viewed poset
ordering defined respect inclusion operator region includes
region written variables part use denote
strict inclusion e say covers r written
exists r visualize poset
called hasse diagram region graph see examples given particular poset
r hasse diagram gr directed acyclic graph whose vertices elements r
whose edges corresponds cover relationships edge
iff
cluster variation method
kikuchis original cluster variation method cvm collections regions
overcounting numbers constructed follows start defining collection
outer regions minimal choice original set cliques c choose


fiheskes

combine cliques construct larger ones similar process triangulation lauritzen
convenience redefine potentials correspondingly e
precisely one potential x per outer region see example
given outer regions construct regions taking intersections
outer regions intersections intersections intersections
made refer regions constructed way inner regions combined
collection collection regions r union outer
inner regions r
overcounting moebius numbers original cvm follow moebius
formula
x

c
c


definition c outer regions
bethe free energy considered special case kikuchi free energy
bethe free energy intersectionspof intersections e one level
inner regions c n n equals number outer regions
covering inner region
alternatives
several alternatives original cvm weaker constraints constraints
choice regions overcounting numbers proposed recently yedidia
freeman weiss present overview particular choice inner regions
subsets overcounting numbers junction graphs aji mceliece join
graphs dechter kask mateescu leads entropy approximation
overcounting numbers inner regions negative resulting
similar junction tree applied graph loops
entropy approximation follows original cluster variation method takes
account entropy contributions level outer regions consistent manner
theoretical grounds seems reason deviate pakzad
anantharam therefore focus original cluster variation
method analysis holds much generally poset region graph
constrained minimization
kikuchi approximation free energy depends marginals p x
r replace minimization exact free energy complete
distribution p x minimization kikuchi free energy
xx
x x
fkikuchi q
q x log x
c
q x log q x

x

r



x

fiefficient minimization kikuchi free energy

pseudo marginals q q r consistency normalization constraints
q x r x
x

q x r

positive



normalized

b

consistent

c

x

x

q x q x r

x

referring class pseudo marginals satisfying constraints q
approximation
log z min fkikuchi q
qq

furthermore hope pseudo marginals q x corresponding minimum accurate approximations exact marginals pexact x kikuchi free
energy corresponding marginals exact hasse diagram turns singlyconnected pakzad anantharam
illustration
illustration main concepts consider probability model variables
nodes pairwise interactions nodes visualized figure
obvious shorthand notation exact distribution form


pexact x
ij xi xj
z
z
j

note potentials originally defined single nodes incorporated
definition two node potentials region graph corresponding minimal
choice outer regions e equivalent potential subsets given figure b
outer regions pairs nodes inner regions subsets single nodes
fact case region graph equivalent called factor graph kschischang
frey loeliger kikuchi approximation free energy boils
bethe approximation
xx
qij xi xj log ij xi xj
fkikuchi q
j xi xj



xx

qij xi xj log qij xi xj

j xi xj

x
x
ni
qi xi log qi xi


xi

ni number outer regions containing inner region
cluster variation method allows us choose larger outer regions example
consisting triples j k redefine factorization potentials
pexact x


ijk xi xj xk
z
j k



fiheskes


x

x

ee
ee yyy
eyey
yy eee

e
yy














ii
ii
ii
u
u
u
u
ii
ii
u
iii
uu
uu
iii iiii iuiuiuiu
uu
u


ii uu ii uu

iuiu
iu
iiii

uuuii
uu





x

x



markov random field







b hasse diagram bethe approximation











ii
iu
iu

ii
uuii
uuii
uuu iii uuu iii
ii


ii


u
u





u
u
ii

u
u


ii
ii
uuu
ii
uu





u

uu


uu




ii
ii
ii
u
u
u
u



u
u
ii
ii uu uu
ii



u
iiii iiii uuiuiuii
uu
ii
ii uuu
ii uu




ui

ii
uuuii
uu












c region graph kikuchi approximation
figure region graphs bethe kikuchi approximations lines nodes
markov random field indicate edges region graphs b c
outer regions drawn highest level lines indicate covering
relationship lower regions covered higher regions oblique
numbers overcounting numbers follow moebius formula
bethe approximation b corresponds minimal approximation
outer regions equivalent cliques graph pairs nodes
particular kikuchi approximation c follows taking outer regions
node triples



fiefficient minimization kikuchi free energy

example distribute symmetrically















assign first outer region




corresponding region graph given figure c first level inner regions
pairs nodes second level inner regions single nodes overcounting numbers respectively kikuchi approximation entropy boils

x
x
x
skikuchi q
sijk
sij
si
j k

j



intuitive reasoning behind approximation follows sum threenode entropies overcounts two node interactions combination j appears twice
rather therefore discounted single node
interactions much discounted overcounting number times appearances compared appearances overcounting number three node entropies
yielding overcounting number
generalized loopy belief propagation
summarize finding kikuchi approximation partition function z boils
minimization kikuchi free energy respect set pseudo marginals
linear constraints introducing lagrange multipliers constraints
shown fixed points popular called loopy belief propagation correspond extrema bethe free energy generally fixed points generalized
belief propagation extrema kikuchi free energy yedidia et al however
guaranteed converge minimum practice get stuck
example limit cycles explains search convergent alternatives directly
minimize kikuchi free energy topic rest

convexity kikuchi free energy
section derive sufficient conditions kikuchi free energy convex
set consistency constraints relevant kikuchi free
energy indeed convex constraint set must unique minimum
minimization relatively straightforward furthermore argument


fiheskes

use deriving conditions play important role construction efficient
minimization later
sufficient conditions
consider kikuchi free energy function pseudo marginals q
reasoning convexity disregard energy term linear q
entropy terms give convex concave contribution depending whether
corresponding overcounting numbers positive negative respectively ignoring
constraints free energy convex concave contributions vanish
e c r
however really care subspace induced constraints therefore introduce notion convexity set constraints call free energy
convex set constraints
f q q f q f q q q q
note since constraints linear q q satisfy constraints
q q following talk convexity kikuchi free
energy conditioning constraint set implicitly assumed
one way proceed make use consistency constraints express kikuchi
free energy terms outer region pseudo marginals study convexity
along lines particular replace inner region pseudomarginals correspond concave contributions outer region pseudo marginals
pseudo marginals corresponding convex contributions concern fact may
able use convex contributions well compensate concave
contributions
make reasoning precise define positive regions perhaps better
nonnegative r r r c negative regions r
r r c idea formulated following theorem
kikuchi free energy convex compensate concave contributions
negative regions r convex contributions positive regions r
theorem kikuchi free energy convex set constraints
exists allocation matrix positive regions r negative regions
r satisfying


used compensate




x
c

positivity

b

sufficient amount resources

c

sufficient compensation



r



x

c

r





fiefficient minimization kikuchi free energy

proof first note worry energy terms
linear q words prove theorem restrict showing
minus entropy


x
x
q
c q
c q
r

r

convex set constraints
intermediate step let us consider combination convex entropy contribution
positive region r concave entropy contribution negative inner region
r subset
x
x
q q q
q x log q x
q x log q x
x



x

q x log q x



x

q x log q x

x

x

x

x

x



q x

x

x



q x x log q x x

used standard definitions
x
q x
q x q x x
q x

q x
x


first step applied constraint q x q x extended summation
x second term summation x second step basically turned
difference two entropies weighted sum conditional entropies
difference depends q lemma appendix convex
q words concave contribution fully compensated convex
contribution yielding overall convex term relevant set constraints
resulting operation matter resource allocation concave contribution c convex contributions compensate let denote
amount resources take positive region r compensate
negative region r obviously positive region compensate negative regions
contains subset explains condition
shorthand notation little bit rewriting


x
x
c
c
q
r



x

r



x

r



c



c

r

x





x



x











x x

r



x

r





x







x



x

r






c

x





c

fiheskes

p
convexity first term guaranteed
p c c second term
b third term c

checking conditions

checking conditions theorem cast form linear programming
example follows define auxiliary variable replacing condition c

x

c r variable compensation


solve linear programming attempts maximize single variable constraints implied four conditions interpretation
try use available resources compensate much concave contributions
solution conditions satisfied kikuchi free energy
convex set constraints unique minimum optimal turns
smaller matrix satisfying constraints convexity
kikuchi free energy guaranteed theorem
instead solving linear program often get away simpler checks
example guess particular check whether conditions hold obvious
choice
x
c
n


n
r


satisfies condition c substituted yields condition
x

c

r

c

n


r



similarly choice


x
c


n



n

r


satisfies condition yields condition
x

r

c
c r
n




substituted c holds theorem guarantees convexity
kikuchi free energy
two conditions sufficient necessary theorem apply
necessary condition
x
x
c

c
r

r

easily derived summing condition r substituting condition c condition fails cannot use theorem prove convexity
kikuchi free energy



fiefficient minimization kikuchi free energy

would conjecture conditions theorem sufficient
necessary convexity kikuchi free energy pursue
irrelevant current purposes furthermore may
relevant practice since convexity sufficient necessary condition unique minimum tatikonda jordan heskes ihler
fisher willsky give conditions convergence loopy belief propagation
uniqueness minimum corresponding bethe free energy conditions
depend graphical structure strength kernels x
related work
chiang forney present similar ideas convex entropy terms compensating
concave terms set constraints derive conditions convexity bethe
free energy pairwise potentials resulting conditions formulated terms
single node marginals may difficult validate practice generalize
kikuchi case
closely related theorem following theorem pakzad anantharam

theorem pakzad anantharam kikuchi free energy convex
set consistency constraints imposed collection regions r hence
constrained minimization unique solution overcounting numbers c
c satisfy
x
x
r
c
c

r




words subset r sum overcounting numbers elements
ancestors r must nonnegative
fact halls matching theorem shown conditions
theorem equivalent conditions theorem latter
direct require solution linear program
theorem theorem used bethe free energy
graphs single loop convex set constraints heskes mceliece
yildirim pakzad anantharam
minimization convex kikuchi free energy
kikuchi free energy convex guaranteed unique minimum
minimum relatively easy message passing similar
standard loopy belief propagation
basic idea follows focus case overcounting numbers
positive case negative overcounting numbers involved worked
appendix b furthermore rest ignore positivity
constraints easy check satisfied solutions obtain
introduce lagrange multipliers x consistency constraints well



fiheskes

normalization constraints construct lagrangian


xx
x
l q fkikuchi q
q x
x q x





x




x

x



x
x



q x



minimization kikuchi free energy appropriate consistency normalization constraints terms lagrangian equivalent
min fkikuchi q min max l q
q

qq



minimization q unconstrained standard constrained
optimization e g luenberger tell us
min max l q max min l q
q





q

equality convex linear equality constraints convex
allowed interchange maximum minimum q
furthermore optimal q corresponding minimum lagrangian
function unique since l q convex q substitution solution
yields called dual
l min l q l q



q

dual concave unique maximum
many used maximum dual particular
one derived appendix b given slightly differs presented
yedidia et al yuille sending messages messages directly related
lagrange multipliers inner regions outer regions e never
inner regions subsets inner regions price one pay update
line depends overcounting number c bethe free energy c n
obtain standard loopy belief propagation update rules particular ordering
running inner regions updating messages inner
region neighboring outer regions guarantees dual increases
iteration local partition functions z z lines chosen
normalize pseudo marginals q x q x normalization strictly
necessary helps prevent numerical instability initialized
setting messages x skipping lines first iteration
positive overcounting numbers c argumentation negative overcounting numbers
complicated may require damping updates achieve convergence see appendix b details



fiefficient minimization kikuchi free energy

message passing constrained minimization kikuchi free
energy


converged









x
q x
q x
x



x

q x
x



end



q x




q x
x
x


q x
x
x
z



n c

x
z









end



end



end

double loop guaranteed convergence
even kikuchi free energy convex still run
hope converges fixed point fixed point must correspond
extremum kikuchi free energy appropriate constraints yedidia et al
even better empirically general kikuchi free energy provably
bethe free energy heskes extremum fact minimum however practice
single loop converge resort double loop
guarantee convergence minimum kikuchi free energy
general procedure
introduce class double loop following theorem
note single loop refers message passing nothing
notion single loop graphical model



fiheskes

theorem given function fconvex q q properties
fconvex q q fkikuchi q

q q q

fconvex q q fkikuchi q

fconvex q q fifi
fkikuchi q

q
q
q q

fconvex q q convex q q

bound



qq

touching

b

q q

convex

c


qn argmin fconvex q qn



qq

qn pseudo marginals iteration n guaranteed converge local minimum
kikuchi free energy fkikuchi q appropriate constraints
proof immediate kikuchi free energy decreases iteration
fkikuchi qn fconvex qn qn fconvex qn qn fkikuchi qn
first inequality follows condition upper bound second
definition gradient property b ensures
stationary points gradient fkikuchi zero construction qn q
n
see figure illustration proof fact convexity
fconvex used establish proof argued section
algorithmic point view constrained minimization convex functional much simpler
constrained minimization non convex functional general idea replacing
minimization complex functional consecutive minimization easier
handle upper bound functional forms basis popular
em dempster laird rubin neal hinton iterative
scaling iterative proportional fitting darroch ratcliff jirousek preucil
intuitively tighter bound faster
bounding concave terms
first step lay main ideas build convex bound removing concave
entropy contributions make use linear bound
x
x

q x log q x

q x log q x
x

x

directly follows


kl q q



x
x



q x
q x log
q x





fiefficient minimization kikuchi free energy






figure illustration proposed corresponding convergence proof
iteration n fconvex q qn dashed line convex bound non convex
fkikuchi q solid line touch qn point fconvex qn qn
fkikuchi qn
minimum point fconvex qn qn
fconvex qn qn corresponding kikuchi free energy point obeys
fkikuchi qn fconvex qn qn bounding property

kl kullback leibler divergence choice fconvex reads

x
xx
x
q x


fconvex q q
q x log
q x log q x
c

x
x
x



x
x
x
x
c
q x
c

q x log q x




x

x

easy check functional properties c last term
added fulfill property b next make crucial observation

constraints fixed q rewrite fconvex normal form

x x
xx
q x

fconvex
q q
q x log

c
q x log q x c q

x



x
x


c q evaluates zero q q implicitly depends q
c defined

x c


log q x c


log x log x
c
n




incorporate terms linear q energy term
redefinition potentials chosen distribute terms equally
n neighboring outer regions choices possible well


fiheskes

term c q evaluates zero q q thus irrelevant
optimization inner loop consists terms last one

serve make bound fconvex satisfy b construction bounds
ignore terms affect way

fconvex convex normal form use
solve constrained resulting double loop described
two lines
outer loop recompute q qn
inner loop run c c yielding qn
inner loop initialize messages converged values previous
inner loop
bounding convex terms
section many cases make better
simpler idea bound concave convex entropy
contributions inner regions enforce c set


xx
q x


fconvex q q
q x log


x
x

log x log x

x c
log q x
n







let us first explain fconvex simpler one
reference inner regions disappeared fact constraints
care outer regions pseudo marginals agree
intersections consequently inner loop run
inner regions direct intersections outer regions
exist outer regions x x x similar arguments
used well neglecting negative inner regions
correspond direct intersections outer regions practice however
negative inner regions direct intersections outer regions whereas many positive
inner regions arise next level intersections intersections see instance
example figure six negative inner regions direct intersections outer
regions contrast four positive inner regions

applied positive inner regions clear fconvex q q



fconvex q q bound fconvex tighter bound fconvex expect

fconvex perform better remains shown

conditions fkikuchi q fconvex q q following theorem comes

fconvex

alternatively could relax condition b statement gradients fconvex fkikuchi
equal subspace orthogonal constraints milder condition c q
well last term longer needed



fiefficient minimization kikuchi free energy

theorem functional fconvex convex bound kikuchi free energy exists allocation matrix negative inner regions
positive inner regions satisfying


used compensate




x
c

positivity

b

sufficient amount resources

c

sufficient compensation







x

c





proof surprisingly proof follows line reasoning proof theorem first consider combination concave entropy contribution
convex entropy contribution
x
x

q x log q x
q x log q x
x

x



x

q x log q x

x

x

q x log q x



x

follows

q x x

q x q x x
q x x
x



x
q x
q x q x

q x
log

x
q
x

q
x

q






x
x







recognize term braces kullback leibler divergence two
probability distributions

difference fconvex fkikuchi nonnegative
able compensate concave contributions c convex contributions without exceeding available amount resources
c shorthand notation


x
q x
k

q x log
q x
x


decomposition
x
x
x

fconvex
fkikuchi
c k
c k
c k




x





c

x





k



x x



k k



x








x





c k

fiheskes































































































































outer regions





























b region graph
figure smallest example showing conditions theorem need
hold region graph overcounting numbers constructed cluster
variation method visualization outer regions black means
variable part outer region
b region graph overcounting numbers boldface positive overcounting numbers third level outweigh negative overcounting numbers second level

inequality follows since terms guaranteed nonnegative
conditions satisfied
conditions theorem checked linear program
generated many different sets overcounting numbers resulting moebius formula started wondering whether conditions perhaps automatically satisfied however exhaustively checking possible outer region combinations given fixed
number variables come counterexample smallest counterexample
violates conditions theorem illustrated figure
even counterexample positive inner regions compensated
negative inner regions pay get rid many possible finding optimal
assignment may complex heuristics easy see appendix c
pulling tree


previous section tightened convex bound fconvex kikuchi free energy
fkikuchi bounding convex contributions positive regions well another way
get tighter bound bound part concave contributions negative



fiefficient minimization kikuchi free energy

inner regions first illustrate considering bethe free energy e
non overlapping negative inner regions nodes c n
bethe free energy convex singly connected structures inspired teh
welling choose set nodes ibound remaining nodes ifree
become singly connected take


xx
x
x
q x


fconvex q q
q x log

n
q x log q x
x
x
x
ifree
x
x

n

q x log q x
ibound

x

bound entropy terms corresponding bounded nodes ibound
simply keep entropy terms correspond free nodes ifree construction
fconvex satisfies conditions furthermore rewritten normal form
definitions

x n

ibound

log x log x

log q x c


n
n
ifree


bound



note resulting inner loop completely equivalent running standard belief propagation tree free nodes send messages
bounded nodes ibound well enforce constraints q x q x

rather pulling single tree pull convex combination
trees suppose several bounds pulling
particular tree corresponding set overcounting numbers ci
convex combination
x
x
c
wi ci wi
wi




corresponds convex bound generally combine ideas
previous section choosing c resulting bound convex
procedure given appendix c basically first try shield much
concave entropy contributions convex entropy contributions next
tighten bound incorporating convex contributions linear bounds
concave contributions manage shield first step steps
cast form easy solve linear programming
related work


double loop described section fconvex closely related
yuilles cccp concave convex procedure although originally formulated completely different way cccp applied minimization kikuchi free
energy understood particular case general procedure outlined
theorem specifically bounding concave contributions
x
x
x
c
q x log q x
q x log q x c
q x log q x
x

x

x



fiheskes

compared bounding concave entropy contributions part concave terms taken convex side reason
cccp requires functional convex independent
constraints involved procedure hand makes use fact
functional convex set constraints allows us use
tighter bounds yielding efficient sometimes simpler less important note inner loop particular message passing scheme applied
yuille somewhat different

double loop fconvex inspired teh wellings
ups unified propagation scaling difference
bound entropy contributions nodes tree ups nodes thus
entropy contributions clamped values resulting previous inner loop
inner loop ups corresponds minimizing


xx
x
x
q x
ups

fconvex q q
q x log

n
q x log q x
x
x
x
ifree
x
x

n
q x log q x
iclamped

x

constraints
q x q x ifree yet q x q x iclamped
boils iterative scaling relatively easy solve
outer loop iteration different choice made ifree iclamped ups
understood coordinate descent guaranteed converge
local minimum bethe free energy appropriate conditions choices made

ifree iclamped inner loop fconvex allows changes
marginals q x ibound e flexible make larger steps loosely

ups furthermore
speaking fconvex tighter bound fconvex
choose different subdivisions bounded free nodes
within inner loop
wainwright jaakkola willsky b present similar ideas exploiting
convexity bethe free energy tree structures wainwright et al b use
tree structure obtain efficient implementation loopy belief propagation without
however guaranteeing convergence wainwright et al particular convex
combinations convex bethe free energies lead convex bounds exact helmholtz
free energy bounds overcounting numbers inner regions still follow
moebius relation overcounting numbers outer regions smaller
equal constrained minimization bound similar constrained

minimization fconvex used wainwright jaakkola willsky
indeed closely related
procedure described yuille often even moves part convex terms concave side
makes implicit bound even worse corresponding slower following
stick favorable interpretation cccp implicit
bound



fiefficient minimization kikuchi free energy

simulations
intuitively would expect tightest bound converge
fastest terms outer loop iterations however larger steps outer loop
might need inner loop iterations achieve convergence inner loop
following simulations designed check
general set
simulations compare four different different
bound
convex tightest bound kikuchi free energy convex
ideas described section appendix c
negative zero bound obtained setting negative overcounting numbers
zero explained section
zero bound described section follows setting overcounting
numbers negative positive zero considered
overcounting numbers satisfy conditions theorem e setting zero
indeed yields bound kikuchi free energy note zero
equivalent negative zero bethe free energy
cccp rather favorable interpretation bound implicit yuilles cccp
explained section
applied inner loop difference
setting overcounting numbers c implied bound
inner loop runs preset convergence criterion met specifically end inner loop
inner region marginals change less criterion
happened converge probably would case looser criteria
example yuille reports two inner loop iterations sufficient obtain
convergence
simulations report kullback leibler kl divergence exact
approximate marginals summed nodes subset nodes plots
different error functions look much kikuchi bethe free energy
somewhat less illustrative close minimum marginals
thus kl divergence still change considerably visualize kl divergence
function outer loop iterations function floating point operations
count necessary operations involved inner loop outer loop updates e
involved convergence checks computing kl divergence
comparing number inner loop iterations used different meet
convergence criterion scale outer loop iterations relative outer loop iterations
convex number outer loop iterations used
reach particular level accuracy consider corresponding number
outer loop iterations used convex reach level



fiheskes



b
convex
negative zero
cccp
kldivergence

kldivergence

convex
negative zero
cccp






















outerloop iterations








flops






x

figure bethe approximation boltzmann grid kullback leibler divergence
exact approximate single node marginals function outerloop iterations floating point operations b three different

done simulations quite number different instances involving markov random fields bayesian networks shown
exemplary meant illustrate general findings summarize

bethe free energy boltzmann grid
first set simulations concerns minimization bethe free energy boltzmann grid nodes pairwise interactions form


tj
ti

ij xi xj exp wij xi xj xi xj
ni
nj
ni number neighbors node e corner node nodes
boundary nodes middle weights wij biases ti drawn
random normal distribution mean zero standard deviation
bethe approximation outer regions pairs neighboring nodes
figure shows summed kl divergence exact approximate single node
marginals function number outer loop iterations function
number floating point operations b convex negative zero
cccp seen expected convex converges
faster negative zero converges faster cccp speed terms outer loop iterations translates almost equivalent
speed terms flops indeed seen figure number inner loop
iterations required convex slightly higher
two
curves figure mapped onto rough linear scaling
number outer loop iterations suggested straight lines


fiefficient minimization kikuchi free energy



outerloop iterations



b
number innerloop iterations


convex
negative zero
cccp



















convex
negative zero
cccp


outerloop iterations





outerloop iterations scaled

figure bethe approximation boltzmann grid outer loop iterations
convex versus corresponding outer loop iterations
two b number inner loop iterations needed meet
convergence criterion function outer loop iterations scaled according


figure slope lines relate definition
convex negative zero cccp respectively see convergence rates
table following argumentation shows striking correspondence
numbers respective bounds
negative overcounting numbers
p
bethe free energy fkikuchi
p add c respective convex
bounds fconvex sums c translate
fraction negative overcounting mass bounded e
p
p
c
c
p

c

obtain respectively definition appears
almost linear relationship tightness bound expressed fraction
concave entropy contributions bounded linearly speed convergence
noticed almost linear relationship simulations involving
bethe free energy positive overcounting numbers
kikuchi free energy boltzmann grid

second set simulations boltzmann grid outer regions
chosen squares four neighboring nodes potentials form
weights biases drawn normal distribution standard deviation
respectively note size weights much larger previous set
simulations make still bit challenge kikuchi approximation
weights bethe approximation badly summed kullback leibler


fiheskes



b






convex
negative zero
zero
cccp





kldivergence

kldivergence







convex
negative zero
zero
cccp














outerloop iterations








flops




x

figure kikuchi approximation boltzmann grid kullback leibler divergence
exact approximate single node marginals function outerloop iterations floating point operations b four different

divergence larger bethe kikuchi singleloop convergence bethe approximation typically gets
stuck limit cycle kikuchi approximation tends diverge total
outer regions negative inner regions node pairs
correspond intersections outer regions positive inner regions
single nodes correspond intersections node pairs
figure shows kl divergence approximate exact single node marginals
four different terms outer loop iterations floating point
operations b seen ordering expected tighter
bound faster terms floating point operations convex
zero get much closer together
part explanation given figure convex requires considerably inner loop iterations meet convergence criterion
effect zero inner loop runs negative
inner regions instead positive negative inner regions makes
inner loop iteration zero requires factor less floating point operations
inner loop iteration three
difficult quantitative relationship tightness
bounds asymptotic convergence rates one complications
negative positive overcounting numbers play role case
still seem converge linearly faster convergence rates tighter bounds
convergence rates expressed time scale corresponding exponential decay
kl kl exp outer loop iterations summarized
table



fiefficient minimization kikuchi free energy



outerloop iterations



b
number innerloop iterations


convex
negative zero
zero
cccp

























outerloop iterations

convex
negative zero
zero
cccp







outerloop iterations scaled

figure kikuchi approximation boltzmann grid outer loop iterations
convex versus corresponding outer loop iterations
three b number inner loop iterations needed meet
convergence criterion function outer loop iterations scaled according


figure graphical structure qmr network
qmr network
third set simulations concerns qmr quick medical reference bayesian
network heckerman jaakkola jordan bipartite graph layer
disease nodes layer findings particular network used simulations
generated bayes net toolbox murphy contains finding nodes
observed positive hidden disease nodes see figure diseases
bernoulli probability distributions prior drawn random
findings noisy conditional probability distributions without leakage diseases
findings linked randomly probability absence leakage large amount
findings strong connectivity make relatively difficult inference
outer regions take subsets implied conditional probability distribution e
outer region consists disease findings linked figure gives
corresponding region graph



fiheskes



























































figure region graph resulting qmr network


convex
negative zero
zero
cccp














outerloop iterations

convex
negative zero
zero
cccp



kldivergence



kldivergence

b














flops






x

figure kikuchi approximation qmr network kullback leibler divergence
exact approximate single node marginals function outerloop iterations floating point operations b four different



fiefficient minimization kikuchi free energy

b
number innerloop iterations

outerloop iterations


convex
negative zero
zero
cccp



























outerloop iterations

convex
negative zero
zero
cccp






outerloop iterations scaled



figure kikuchi approximation qmr network outer loop iterations
convex versus corresponding outer loop iterations
three b number inner loop iterations needed meet
convergence criterion function outer loop iterations scaled according


original
convex
negative zero
zero
cccp







bethe









kikuchi



















qmr











table summary asymptotic convergence time constant time outerloop iterations exponential decay sums negative positive overcounting numbers original kikuchi bethe free energy convex bounds
used different

found figure comparable
kikuchi approximation boltzmann grid single loop fails
converge convex converges much faster three requires inner loop iterations less efficient zero makes latter preferable terms floating point operations however
relatively straightforward speed convex first probably
need many inner loop iterations outer loop converge properly
secondly bound part entropy contribution efficient choice
would many zero overcounting numbers possible



fiheskes

general findings
summarize points illustrated
encountered many simulations well
tighter convex bound used inner loop faster convergence
terms outer loop iterations
number outer loop iterations needed meet prespecified convergence criterion tends decrease looser bound never nearly enough compensate
slower convergence outer loop
fact observed strong dependency number inner loop
iterations tightness bound bound convex
hard sense single loop would fail converge
terms floating point operations looser bound sets overcounting numbers
inner loop zero beat tighter bound negative overcounting numbers
slower convergence terms outer loop iterations compensated
efficient inner loop
pelizzola tests several convergent kikuchi approximations statistical physics reports similar findings study convex described first time heskes albers kappen clearly outperforms competitors

discussion
article perspective interested minima kikuchi
free energy appropriate constraints finding minimum becomes possibly non convex constrained minimization well studies
solve non convex sequential constrained minimization convex bounds kikuchi free energy presumption tighter
bounds yield faster worked several ideas construct tight convex
bounds simulation article well obtained pelizzola
clearly validate presumption speed ups significant
heskes zoeter wiegerinck apply bounds approximate parameter
learning directed graphical
double loop considered article convex bounds
kikuchi free energy principle necessary concern
inner loop converges might well case tighter bounds one
practical solution simply choose tight bound kikuchi free check whether
inner loop converge restart looser bound alternatively
construct tighter bounds making use conditions guaranteed convergence
belief propagation derived tatikonda jordan heskes
ihler et al bethe approximation
suggested non convergence single loop generalized loopy belief propagation indication kikuchi bethe approximation inaccurate


fiefficient minimization kikuchi free energy

section need case apparently
exist middle range kikuchi free energy easy minimize yield decent approximations
described article useful

acknowledgments
author would thank wim wiegerinck onno zoeter kees albers bert kappen fruitful discussions anonymous reviewers constructive comments
work supported part dutch technology foundation stw

appendix convexity difference two entropies
appendix treats two lemmas convexity difference two entropies
first one used proof theorem similar lemma used mceliece
yildirim
lemma difference two entropies
x
x
q x log q x
q x log q x
q
x

x



x
x

convex q



q x

x

x



q x x log q x x

proof take step backwards write

q

x
x





q x

q x log
x

q x

x

taking derivatives best interpret table q specifying value q x
possible realization x vector x playing role index taking second
derivatives obtain
hx x q

q




ix x

q x q x
q x q x x x

ix x elements x x equal zero otherwise



fiheskes

next would matrix positive semi definite e
tables q interpreted vectors indices x


x

q x hx x q q x

x x

x


x q x x
x





q x x
x x




x q x q x


q x
q x x x

x x



q x x q x x

x q x

x

x x



q x



hp



x x q x x
x q x x

p


q x x

x q x x
x x







cauchys inequality

x

k

k

x

b k

k



x
k

ak bk





follows term braces indeed semi positive q
realization x
see make substitutions x k q x x q x x ak
q
q x x bk


x
k

k

p

k ak bk
p


k bk


following related lemma used appendix b

lemma difference two entropies
x
x
q q
q x log q x
q x log q x
x

x

convex q q
proof hessian matrix components
hx x



q


ix x

q x q x
q x

hx x



q





q x q x
q x x x

hx x



q x
q




q x q x
q x x x



fiefficient minimization kikuchi free energy

convexity requires q q x q x
q x q x




x q x



hx x
hx x

hx x
hx x

x q x q x

q x


x
q x q x


q x

q x q x
x
x

q x



x





q x
q x



x q x q x
q x

x



appendix b minimizing convex kikuchi free energy
appendix derive minimizing convex kikuchi free energy
appropriate linear constraints simplify notation use convention runs
outer regions inner regions
first note principle necessary explicitly take account
constraints since constraints implied others obviously constraint
two inner region marginals
q x q x
implied corresponding constraints inner region marginals outer
region subsuming inner regions
q x q x q x q x
take account constraints inner regions
inner regions similarly normalization constraints outer region pseudo marginals follow
normalization constraints inner region pseudo marginals sufficient set
constraints
x
q x

q x q x q x
x

x

q x



x

introducing lagrange multipliers x corresponding constraints
obtain lagrangian
x x

xx
q x
q x log q x

c
l q
q x log
x
x
x





xxx
x
x
x

x q x
q x

q x b
x

x





x

fiheskes

convex independent constraints
let us first consider case overcounting numbers c strictly positive c
lagrangian convex set constraints convex
q independent constraints minimization lagrangian respect
pseudo marginals follows setting derivatives zero yielding

e x
b
q x x e


q x

c

e



e x c

b



following noted q q functions
lagrange multipliers substituting solution back lagrangian obtain
dual
x
xx
x x
l l q

q x
c
q x
b




x



x

consider optimizing l respect subset components corresponding
inner region collected x x keeping
fixed concavity dual l maximum
direction setting corresponding derivatives zero yields

l fifi
qnew x qnew x x
x

x
l fifi



qnew x
b

x
q refers solution b b x replaced
x


since

b



qnew x

e x
x q x
e

solution
x must obey


x log q x x log q x

still solve qnew x summing expression substituting b solving qnew x get
log qnew x

x


log q x x
c
n c
n c


obtain exactly updates define
x e x x q x e x


fiefficient minimization kikuchi free energy

properly normalize q x line normalization q x line
fact unnecessary since construction updates ensure q x q x
z
bottom line particular ordering joint update
messages particular subset interpreted coordinate wise gradient
ascent dual l updating lagrange multipliers x particular
time therefore guaranteed converge
unique maximum case positive overcounting numbers c
convex set constraints
next let us consider general case overcounting numbers
negative kikuchi free energy still convex set constraints
consider case inner region overcounting numbers negative
sufficient damping updates still guaranteed
converge unique minimum kikuchi free energy set constraints
note direct application argumentation fails solution b
q x negative c corresponds maximum rather minimum consequently dual l b need concave updates
follow setting derivatives zero interpreted fixed point iterations coordinate ascent l still practice seem work fine indeed without
increasing l following explain argue updates correspond coordinate ascent rather something
coordinate descent ascent convex concave saddle function sufficient damping
converge unique saddle point corresponds
minimum kikuchi free energy set constraints
convexity set
p according theorem exists
p constraints implies
matrix c q x q x replace
lagrangian b

xx
xx
x
q x
l q
q x log
q x log q x


x
x
x





xxx
x
x
x
x


x
q x
q x

q x b
n
x
x
x












since lemma appendix
x
x
q x log q x
q x log q x
x

x

convex q x q x lagrangian b indeed convex q independent
constraints thus could apply argumentation minimum
argumentation hold negative inner region entropy contributions
compensated positive inner region subset entropy contributions prove convexity kikuchi free
energy case might need slightly different guarantee convergence



fiheskes

convex lagrangian respect q substitute corresponding solution q back
lagrangian obtain concave dual l maximize dual respect
closed form expression optimal q
thus closed form expression dual l makes procedure
rather awkward
instead distinguish outer region marginals collected qo
inner region marginals collected qi rewritten consistency constraint terms
outer region marginals alone replace constrained minimization respect
qo unconstrained maximization respect corresponding lagrange multipliers
leaving minimization respect qi normalization constraint
gives us saddle point type minqi maxo even without explicitly
writing equations tell maximization respect particular
corresponds finding
qnew x qnew
x



minimization respect q given fixed qnew x immediately yields
x
qnew x
qnew x


properly normalized sum exactly updates particular inner
region amount yield unique maximum respect
minimum respect q keeping q fixed
coordinate descent ascent procedure works fine saddle function convex minimizing parameter concave maximizing parameter e g seung
richardson lagarias hopfield concavity immediate convexity
qi follows convexity lagrangian b q qo qi minimizing
overall convex function parameters qo yields convex function
remaining parameters qi technically convergence unique solution
saddle point proven construction lyapunov function
decreases infinitesimal updates parameters descent ascent direction
zero unique saddle point seung et al convergence guaranteed
sufficiently damped updates full ones empirically full updates correspond full maximization minimization one inner region
moving next one work fine cases occasionally indeed require little
damping wainwright et al successfully apply damping similar
attempt minimize convexified bethe free energy

appendix c constructing tight convex bound
appendix describe procedure constructing tight convex bound fconvex
kikuchi free energy fkikuchi combines ideas section
first convexify kikuchi free energy bounding little concave contributions
negative inner regions possible next terms bound anyways
try incorporate many convex contributions leads following
procedure


fiefficient minimization kikuchi free energy

consider minus entropy



x







x

c

x

c












choose c c first term



x
x

x
x
c
c
c c











convex

corresponding allocation matrix theorem define used resources
x
c c
c


rewrite



x








c




x


x

x

c



c c

x





construction first term still convex





c c








guarantee convexity bound entropy contributions second
term make bound tighter include many convex
contributions still satisfying conditions theorem call
corresponding overcounting numbers c c c c put remaining
c c back first term


x

x
x
c

c







x

x

c c
c c






choose fconvex first term plus linear bound second term

c first step similarly c third use linear program
similar one described section checking conditions theorem
introduce slack variables replace condition
x
variable compensation




fiheskes

similar spirit furthermore add inequality constraints cp

need compensate c search maximum
compensate much possible terms corresponding solution set c
c

references
aji mceliece r generalized distributive law free energy minimization proceedings allerton conference communication control
computing
besag j spatial interaction statistical analysis lattice systems journal
royal statistical society series b
chiang forney g statistical physics convex optimization sum
product tech rep stanford university
darroch j ratcliff generalized iterative scaling annals mathematical
statistics
dechter r kask k mateescu r iterative join graph propagation darwiche friedman n eds proceedings uai pp
dempster laird n rubin maximum likelihood incomplete data
via em journal royal statistical society b
hall p representatives subsets journal london mathematical society

heckerman tractable inference diagnosing multiple diseases
kanal l henrion shachter r lemmer j eds proceedings fifth
workshop uncertainty artificial intelligence pp amsterdam elsevier
heskes stable fixed points loopy belief propagation minima bethe
free energy becker thrun obermayer k eds advances neural
information processing systems pp cambridge mit press
heskes uniqueness loopy belief propagation fixed points neural
computation
heskes albers k kappen b approximate inference constrained optimization uncertainty artificial intelligence proceedings nineteenth
conference uai pp san francisco ca morgan kaufmann publishers
heskes zoeter wiegerinck w approximate expectation maximization thrun saul l scholkopf b eds advances neural information
processing systems pp cambridge mit press
ihler fisher j willsky loopy belief propagation convergence
effects message errors journal machine learning
jaakkola jordan variational probabilistic inference qmr dt
network journal artificial intelligence


fiefficient minimization kikuchi free energy

jirousek r preucil effective implementation iterative proportional fitting procedure computational statistics data analysis
jordan ghahramani z jaakkola saul l introduction variational
methods graphical jordan ed learning graphical
pp kluwer academic publishers dordrecht
kikuchi r theory cooperative phenomena physical review
kschischang f frey b loeliger h factor graphs sum product ieee transactions information theory
lauritzen graphical oxford university press oxford
luenberger linear nonlinear programming addison wesley reading
massachusetts
mceliece r mackay cheng j turbo decoding instance pearls
belief propagation ieee journal selected areas communication

mceliece r yildirim belief propagation partially ordered sets
gilliam rosenthal j eds mathematical systems theory biology communications computation finance pp springer york
murphy k bayes net toolbox matlab computing science statistics

murphy k weiss jordan loopy belief propagation approximate
inference empirical study laskey k prade h eds proceedings
fifteenth conference uncertainty articial intelligence pp san
francisco ca morgan kaufmann publishers
neal r hinton g view em justifies incremental
sparse variants jordan ed learning graphical pp
kluwer academic publishers dordrecht
pakzad p anantharam v belief propagation statistical physics
conference information sciences systems princeton university
pakzad p anantharam v estimation marginalization kikuchi approximation methods neural computation
pearl j probabilistic reasoning intelligent systems networks plausible inference morgan kaufmann san francisco ca
pelizzola cluster variation method statistical physics graphical
journal physics r r
seung richardson lagarias j hopfield j minimax hamiltonian
dynamics excitatory inhibitory networks jordan kearns solla
eds advances neural information processing systems pp mit
press
tatikonda jordan loopy belief propagation gibbs measures darwiche friedman n eds uncertainty artificial intelligence proceedings


fiheskes

eighteenth conference uai pp san francisco ca morgan
kaufmann publishers
teh welling unified propagation scaling dietterich
becker ghahramani z eds advances neural information processing
systems pp cambridge mit press
wainwright jaakkola willsky class upper bounds log
partition function darwiche friedman n eds uncertainty artificial
intelligence proceedings eighteenth conference uai pp san
francisco ca morgan kaufmann publishers
wainwright jaakkola willsky b tree reparameterization
approximate estimation loopy graphs dietterich becker ghahramani
z eds advances neural information processing systems pp
cambridge mit press
wainwright jaakkola willsky tree reweighted belief propagation
approximate ml estimation via pseudo moment matching bishop
c frey b eds proceedings ninth international workshop artificial
intelligence statistics society artificial intelligence statistics
yedidia j freeman w weiss generalized belief propagation leen
dietterich tresp v eds advances neural information processing
systems pp cambridge mit press
yedidia j freeman w weiss constructing free energy approximations
generalized belief propagation ieee transactions information
theory
yuille cccp minimize bethe kikuchi free energies
convergent alternatives belief propagation neural computation




