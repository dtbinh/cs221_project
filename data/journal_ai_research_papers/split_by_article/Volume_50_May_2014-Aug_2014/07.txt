Journal of Artificial Intelligence Research 50 (2014) 885-922

Submitted 4/14; published 8/14

Demand Side Energy Management via Multiagent Coordination in
Consumer Cooperatives
Andreas Veit

ANDREAS @ CS . CORNELL . EDU

Department of Computer Science
Cornell University
Ithaca, NY 14853 USA

Ying Xu
Ronghuo Zheng

YINGX 1@ ANDREW. CMU . EDU
RONGHUOZ @ ANDREW. CMU . EDU

Tepper School of Business
Carnegie Mellon University
5000 Forbes Avenue
Pittsburgh, PA 15213 USA

Nilanjan Chakraborty

NILANJAN . CHAKRABORTY @ STONYBROOK . EDU

Department of Mechanical Engineering
Stony Brook University
Stony Brook, NY 11794 USA

Katia Sycara

KATIA @ CS . CMU . EDU

Robotics Institute, School of Computer Science
Carnegie Mellon University
5000 Forbes Avenue
Pittsburgh, PA 15213 USA

Abstract

A key challenge in creating a sustainable and energy-efficient society is to make consumer
demand adaptive to the supply of energy, especially to the renewable supply. In this article, we
propose a partially-centralized organization of consumers (or agents), namely, a consumer cooperative that purchases electricity from the market. In the cooperative, a central coordinator buys the
electricity for the whole group. The technical challenge is that consumers make their own demand
decisions, based on their private demand constraints and preferences, which they do not share with
the coordinator or other agents. We propose a novel multiagent coordination algorithm, to shape
the energy demand of the cooperative. To coordinate individual consumers under incomplete information, the coordinator determines virtual price signals that it sends to the consumers to induce
them to shift their demands when required. We prove that this algorithm converges to the central optimal solution and minimizes the electric energy cost of the cooperative. Additionally, we
present results on the time complexity of the iterative algorithm and its implications for agents
incentive compatibility. Furthermore, we perform simulations based on real world consumption
data to (a) characterize the convergence properties of our algorithm and (b) understand the effect
of differing demand characteristics of participants as well as of different price functions on the cost
reduction. The results show that the convergence time scales linearly with the agent population
size and length of the optimization horizon. Finally, we observe that as participants flexibility of
shifting their demands increases, cost reduction increases and that the cost reduction is not sensitive
to variation in consumption patterns of the consumers.
2014 AI Access Foundation. All rights reserved.

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

1. Introduction
Two key issues in creating a sustainable and energy-efficient society are to increase the penetration
of renewable sources, and to manage supply and demand so as to reduce demand peaks while
maintaining supply and demand balance. One way, which is most commonly used, to achieve
the demand supply balance is to supply all the requested demand whenever it occurs. However,
attempting to achieve demand supply balance by adjusting only the supply side leads to the use
of flexible (usually diesel operated) power plants that can be expensive, inefficient, and emit large
amount of carbon. An alternative to adjusting the supply side only, is to also adjust the demand
of the consumers (Palensky & Dietrich, 2011) via demand response programs. Demand Response
is defined as the changes in electricity consumption by end users from their normal consumption
patterns in response to changes in the price of electricity over time (Albadi & El-Saadany, 2007).
Several different forms of demand response programs have been developed (for an overview
see Albadi & El-Saadany, 2007). A typical example of an incentive based program, where customers receive payment for their participation, are Direct Load Control programs, where utilities
remotely control the power consumption of consumers appliances by switching them on/off. In
small scale pilot studies, direct load control has been successful in reducing peak energy consumption, however consumers were uncomfortable with yielding control of their appliances to utility
companies (Rahimi & Ipakchi, 2010; Medina, Muller, & Roytelman, 2010). Another type of demand management program is price based, where energy rates are variable and follow the real cost
of electricity. The objective of this indirect method is to control the overall demand by incentivizing consumers to flatten the demand curve through shifting energy from peak to off-peak times.
A typical example of these programs is Time of Use pricing, where the price during peak times
is higher than the price during off-peak times. Recent technological advances in smart meters and
smart appliances have created the potential to enable direct and real time participation of individual
consumers in the energy market and thus make real-time price based demand management programs
a reality. However, there are two key problems in realizing this potential. First, despite the presence
of small pilot programs, utilities consider individual consumers of insufficient size to be considered
for demand response services. Second, if consumers participate in the market directly, rather than
through the utilities, the stability of the system may be compromised (e.g., herding) (Ramchurn,
Vytelingum, Rogers, & Jennings, 2012). Considering these challenges, Mohsenian-Rad, Wong,
Jatskevich, Schober, and Leon-Garcia (2010) argue that a good demand side management program
should focus on controlling the aggregate demand (which is also important for economic load dispatching, Wood & Wollenberg, 1996) of a group of consumers instead of individual consumers.
In this paper, the problem of coordinating a group of consumers called consumer cooperative is
introduced and studied.
A consumer cooperative, or collective, allows partial centralization of consumers represented
by a group coordinator (mediator) agent, who purchases electricity from utilities or the market on
their behalf. Such consumer configurations can potentially increase energy efficiency via aggregation of demand to reduce peak power demand. The coordinator is neither a market maker nor a
traditional demand response aggregator (Jellings & Chamberlin, 1993), since it does not set energy
prices or aims to incur profits by selling to the market. Rather, its role is akin to a social planners, in
the sense that it manages the demand of its associated consumer group so that (a) the electricity cost
to the group is minimized, and (b) individual group members autonomously and in a decentralized
manner decide how to shift demands, while maintaining privacy of individual demand preferences
and constraints. The members of such a cooperative are typically geographically co-located in close
proximity to one another, for example a small neighborhood of households and/or enterprises. In
practice, close proximity is required due to limitations in the distribution infrastructure, geograph886

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

ically separated system operators, markets, and electricity suppliers. The proposed coordination
algorithm could also benefit already existing structures such as universities, malls, industrial parks,
commercial estates, and large residential complexes. Although such organizations may already purchase electricity in a centralized manner, their constituent members (e.g. firms in an industrial park)
are not currently coordinated so as to keep their constraints private.
Consumer cooperatives offer advantages to both energy utility companies and consumers. From
a utility companys perspective, the consumer groups are large enough to be useful in demand response programs and have more predictable demand shifts compared to individual consumers. Barbose, Goldman, and Neenan (2004) give a survey of utility experience with price based programs
and conclude that most participants were large industrial customers. For individual consumers, participation in such energy groups allows them to retain control of their own appliances. In addition,
the consumers can obtain electricity at better prices than they would have, if they had purchased
electricity individually. The price advantage is due to three reasons: First, the groups size allows
the group to enter into more flexible purchase contracts, so that the price paid by the consumers
reflects the actual cost of production more accurately. This is not the case in current long term fixed
contract structures (Kirschen, 2003). Second, by buying collectively, the group can benefit from
volume discounts analogous to group insurance programs. Third, in negotiated electricity contracts,
the price usually consists of two components, one reflecting the actual energy production cost and
the other as a premium against volatility in the energy demand and/or supply. Buying as a group
can help reduce the premium against volatility, provided that the demands of the group members
are coordinated, making their total demand more stable.
Our aim in this paper is to design effective schemes for coordinating the electricity demand of
agents who are purchasing electricity as a consumer cooperative. The technical challenge of this
endeavor is the fact that the central coordinator does not know the constraints of the individual
consumers, and thus cannot compute the optimal demand schedule on its own. Furthermore, the
actual cost of electricity consumption depends on the aggregate consumption profile of all agents.
However, the agents may not want to share their demand patterns or constraints with other agents or
the coordinator. Therefore, we present an algorithm designed to enable the central agent to coordinate the consumers to achieve the optimal centralized load, while the individual agents decide their
demand shifting autonomously and retain their private knowledge about their demand constraints.1
The papers contributions are as follows. First, we present an iterative coordination algorithm
to minimize the energy cost of a consumer cooperative that preserves the privacy of individual
demand constraints and costs of the consumers. Second, we prove that the algorithm converges to
the centralized optimal solution and provide computational complexity results. Third, we provide
formal arguments on the incentive compatibility of the coordination scheme. Fourth, we present and
discuss extensive simulation results based on real world data. A preliminary version of this work
appeared in the work of Veit, Xu, Zheng, Chakraborty, and Sycara (2013).
This paper is organized as follows: In Section 2 we give an overview of the related work and
point out the differences to the approach in this paper. In Section 3 we formulate the cost optimization problem of the consumer cooperative. Then, in Section 4 we introduce the demand scheduling
algorithms for the consumer cooperative. In particular, in Section 4.1 we introduce the basic iterative algorithm and in Section 4.2 we prove its convergence to the optimal solution. In Section 5,
we introduce the general iterative algorithm and in Section 5.3 we prove its convergence in general
1. This problem has some surface resemblance to problems where a centralized coordinator determines resource allocations for agents with private preferences, which the coordinator tries to elicit. Such problems are typically addressed
via Vickrey-Clark-Groves mechanisms. Our problem differs from those in fundamental ways that will be discussed
in the Related Work section.

887

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

settings. In Section 5.4, we provide complexity analysis of the algorithms convergence and in Section 5.5 we provide formal arguments on the incentive compatibility of the consumers. In Section 6
we evaluate the coordination algorithms using simulations based on real world consumption data.
Finally, in Section 7, we summarize the main contributions of this paper and offer a perspective on
future work.

2. Related Work
As mentioned in the introduction, the demand response programs vary from classical direct load
control to price based programs with real time prices. In this paper, we introduce an algorithm
that uses variable price signals to coordinate the energy consumption of a consumer cooperative.
Therefore, we restrict this discussion to demand management using variable price signals.
Current literature on price-based demand shaping mostly operates under the assumption that
it is desirable to have an automated or autonomous system (e.g. smart meter) that receives price
signals and uses them to help a consumer schedule its demand so as to minimize its electricity cost,
while satisfying its demand preferences and constraints. There are two types of price signals that
can be used: dynamic and deterministic prices. Most literature on price-based demand response
programs considers the case of deterministic prices, in which the electricity prices of all time slots
are known before consumption. This case applies to all long-term contracts and day-ahead markets,
if the planning horizon is sufficiently short (see Vytelingum, Ramchurn, Rogers, & Jennings, 2010;
Ramchurn, Vytelingum, Rogers, & Jennings, 2011). With known electricity prices, consumers can
compute their consumption schedule ahead of time, e.g., a daily consumption plan, or an annual
production plan. Our paper falls in this category of demand scheduling under deterministic prices.
The approaches for demand scheduling proposed in the literature differ in some important characteristics. First, they differ in the level at which the problem is studied and secondly they differ in
the objective of the demand scheduling. The different levels at which the problem has been studied include the level of the single consumer, the market maker, or the grid operator. The different
objectives include minimizing the cost of a single consumer, minimizing the total cost of power
generation, reducing the peak-to-average ratio in demand, and optimizing grid stability. There are
only a few papers studying the demand scheduling problem at the level of grid operators, where
the major concern is grid stability. In particular, objectives include the minimization of power
flow fluctuations (Tanaka et al., 2011), and the minimization of power losses and voltage deviations (Clement-Nyns, Haesen, & Driesen, 2010).
Most work on demand scheduling is done at the level of the consumers. An important characteristic of this regime is that the electricity prices are often exogenously fixed and not influenced by
the demand scheduling; i.e., the consumer is a price taker. Almost all papers in this regime focus on
the (micro) demand scheduling of one or multiple appliances in a single residential household or a
commercial building, with the typical objective to minimize the incurred electricity cost. For example, Chu and Jong (2008) study air-conditioning load control; Pedrasa, Spooner, and MacGill (2010)
optimize the operation schedule of various distributed energy resources including space heater and
pool pump, etc. There are other papers studying the problem from different perspectives. For example, Philpott and Pettersen (2006) and Samadi, Mohsenian-Rad, Wong, and Schober (2013) address
the challenge of the uncertainty in the loads of the consumers energy consumption. This stream
of research is close to our work, since we as well study the demand management at the level of
consumers. However, instead of studying a single consumer, we consider a group of consumers in a
consumer cooperative, who buys the electricity from a utility company under a known price scheme.
Our work differs from the above literature in the following aspects: size of shift, system stability,
888

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

indirect control, and, most crucially, information privacy. First, while all the above literature only
considers the control of a single consumer, in practice, it may be difficult for utility companies
or grid operators to deal with individual consumers in such demand response programs. The demand shift of an individual consumer might be too small in magnitude compared to the aggregated
necessary shift. Thus, it is unclear whether such a scheme will induce a shift of sufficient size. In
contrast, from the utilitys perspective, the consumer cooperative studied in our work is large enough
to be useful in demand response programs. Second, most of the above literature assumes that the
consumers can participate in the markets directly. However, there have been concerns voiced that,
without control by the utility companies, the stability of the system may be compromised with such
uncontrolled distributed interactions (Kirschen, 2003). In contrast, the demands of consumers in
our consumer cooperative are coordinated by a central coordinator to minimize the electricity procurement cost of the cooperative. Buying as a group helps to reduce the demand volatility, and
the coordinated demand management can achieve higher stability of demand and reduce demand
peaks. Third, the common assumption in the above literature is that the demand manager has direct
control over the appliances in the household and perfect knowledge about their loads and operation
constraints. However, in our cooperative, the coordinator lacks such control on demand scheduling
for individual consumers. Moreover, the demand constraints and preferences are private knowledge
to the individual consumer and not known either to the coordinator or other consumers.
Another stream of research related to our work is the demand scheduling at the level of the market maker. In contrast to the previous approaches, in this regime, the coordinator (i.e., the market
maker) can set the electricity prices for consumers, and often use the price lever to influence the
demand of a number of consumers. The studies in this stream can be categorized into two groups:
centralized and decentralized. Dietrich, Latorre, Olmos, and Ramos (2012) compare demand response programs in an electric system with high wind penetration under two different settings (i.e.,
centralized vs. decentralized) and show that the centralized approach often reaches higher overall
cost savings, but has the disadvantage that central knowledge of consumers constraints and preferences is necessary. Our partially decentralized approach avoids this limitation and keeps consumers
constraints and preferences private while also achieving proven optimality of the solution.
When the coordinator uses prices to incentivize consumers to shift demand, the coordinator
needs to pay close attention to the possibility of a herding phenomenon, whereby agents move their
demand towards the low price times simultaneously and thus cause a spike in demand and bring
instability to the system. To address this issue, in addition to a price signal, some papers adopt
auxiliary methods to make agents gradually change their loads. Voice, Vytelingum, Ramchurn,
Rogers, and Jennings (2011) charge agents an additional fee based on how much they change their
demand profile from one period to the next. Ramchurn et al. (2011) introduce an adaptive mechanism controlling the rate and frequency at which the agents are allowed to adapt their loads and to
readjust their demand profile. Vytelingum et al. (2010) introduce a compensation signal that is sent
to the agents, providing an estimate of how much they should aim to change their behavior. These
approaches may perform well, but, unlike our work, they do not provide any formal guarantees that
their proposed algorithms will converge to the optimal solution. Moreover, these approaches require
that the coordinator be a market maker who can charge consumers arbitrarily, e.g., by imposing additional fees, a feature that may not be implementable and acceptable in practice. In contrast, our
coordinator is akin to a social planner who must ensure that the total charge for the energy demand
of agents should equal the actual amount to be paid to the energy supplier.
Other papers address the decentralized demand-side management problem from a game theoretic perspective. They mainly focus on deriving a charging mechanism that can make all consumers
reach a stable demand equilibrium, which achieves a central objective. These papers often share an
889

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

underlying assumption that an individual consumers unit electricity cost increases in other consumers aggregate consumption. This assumption holds under the setting that the energy cost in each
period increases with the difference between demand and supply (Wu, Mohsenian-Rad, & Huang,
2012) or with the Peak-To-Average ratio (Mohsenian-Rad et al., 2010; Nguyen, Song, & Han,
2012), or the unit market price per period increases with the aggregate demand (Vytelingum, Voice,
Ramchurn, Rogers, & Jennings, 2011; Atzeni, Ordonez, Scutari, Palomar, & Fonollosa, 2013). In
the work of Mohsenian-Rad et al. (2010), a Nash equilibrium of demand achieves optimality via a
designed billing strategy under which individual cost is proportional to the total energy cost. However, under this billing strategy, a consumer must have an estimate of other consumers demand
before making its own decision. Therefore, to implement the proposed algorithms, the consumers
needs to coordinate in an iterative manner and exchange their demand profiles with each other in
each iteration, which may cause invasions of the consumers privacy. In other works of Wu et al.
(2012), Nguyen et al. (2012), Vytelingum et al. (2011) and Atzeni et al. (2013), individual consumers dont need to interact with each other, but only communicate with the central coordinator.
In these papers, the coordinator maintains the equilibrium by designing the unit price, based on the
aggregate demand. The algorithm is often implemented in a distributed and iterative scheme: in
each iteration the agents report their loads to the coordinator and the coordinator updates the price
accordingly. Although these papers ensure a minimum information exchange, none of them has
theoretically proven that their algorithms would converge to the centralized optimal solution. In
contrast, our paper not only safeguards the privacy of consumers, but also proves that the algorithm
converges to the centralized optimal solution.
Our problem has surface resemblance to problems, where a central coordinator determines resource allocations for agents with private preferences, which the coordinator tries to elicit. Such
problems are typically addressed via Vickrey-Clark-Groves mechanisms. The reason for not considering VCG-type mechanisms for our problem is that one of the key requirements of our application is that the coordinator has to pay the supplier for the groups electricity demand at the prices
given by the supplier. Thus, the revenue, namely the sum of the payments individual agents make
should equal the actual amount to be paid to the supplier. In other words, in the jargon of mechanism design, budget balance is a key requirement for our problem. It is well-documented in the
literature that VCG-type mechanisms do not guarantee budget balance (Green & Laffont, 1977;
Hurwicz, 1975)2 and it is impossible to design a mechanism that achieves all the three properties,
namely, efficiency, budget balance and strategy-proofness. For our problem, in addition to budget
balance, allocation efficiency is also a desired social goal. Our algorithm achieves both budget balance (Lemma 2) and allocation efficiency (Theorem 3). Although the algorithm cannot guarantee
strategy-proofness, due to the impossibility results, we prove that no manipulation strategy exists
that dominates truth reporting (Theorem 5).

3. Problem Formulation
In our model, the consumer group consists of N members with the planning period divided into
M discrete time slots. The number of discrete time slots depends on the market price structure,
which can differ depending on the utility companies. For example, M = 2 for time-of-use pricing
with different prices during day and night, whereas M = 24 for hourly time of use pricing. Let
R be an N  M matrix where each row of the matrix, ri is the electricity demand of the agent i,
2. In fact, as has been shown by Ausubel and Milgrom (2006), in the context of broadcast spectrum allocation, the
revenue obtained from VCG-type mechanisms can even be zero! In our case, this would mean the agents would not
pay any money to the coordinator, making it impossible to pay the supplier.

890

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

20

Twolevel Threshold Rate

13
12

high load

11

9

low load

7
6
5
4
0

high load
(Price: 10.34 Cents/kWh)

16
14
12
10

threshold hj

Total Cost

Marginal price pM
(j)
j

10

8

Twolevel Threshold Rate

18

(Dollars)

(Cents/kWh)

14

8

low load
(Price: 6.9 Cents/kWh)

threshold hj

6
4
2

50

100

Aggregated demand j

150

0
0

200

(kWh)

(a) Marginal electricity prices.

50

100

Aggregated demand j

150

200

(kWh)

(b) Total electricity cost.

Figure 1: Sample two-level increasing threshold pricing model as used by BC Hydro
i  {1, 2, . . . , N }. We call ri the demand profile of agent i. Each entry rij is the electricity demand
P
of agent i for time slot j. The total aggregated demand in time slot j is j = N
i=1 rij . The average
market price of a unit of electricity for the consumer group at time slot j is defined as pj (j ).
We assume a typical market price function, where the prices are different in each time slot and
the price has a threshold structure. This means that the marginal electricity prices differ among different demand levels. For each time slot, every unit of electricity consumed below a specified price
threshold is charged at a lower price, while any additional unit exceeding that threshold is charged
at a higher price. Thus, the marginal electricity price in a time slot, denoted by pm
j (j ), is a nondecreasing function of the total demand. The marginal price at a given demand level is the payment
increment (decrement) for adding (reducing) one unit of electricity. Figure 1a shows an example of
a two-level increasing threshold pricing model adopted from BC Hydro.3 The(marginal price of a
pH
j > hj
j
two-level threshold structure can formally be written as follows: pm
(
)
=
with
j
j
L
p j  j  hj
L
+
pH
j > pj , where hj is the price threshold in time slot j. Let x denote the positive value of a term
x, i.e., x+ = max {0, x}, and x denote the negative value respectively, i.e., x = min {0, x}. The
total energy cost for time slot j is thus the integral of the marginal prices. Figure 1b shows the total
electricity cost for the aggregated demand based on the two-level threshold pricing model. The total
electricity cost can be computed as:
+

L
L
pj (j ) j = pH
j (j  hj ) + pj (j  hj ) + pj hj

(1)

The demand profile of each agent ri must satisfy its individual constraints. The overall demand
consists of two types of loads: shiftable loads and non-shiftable loads. Mohsenian-Rad et al. (2010),
Mohsenian-Rad and Leon-Garcia (2010) and Wu et al. (2012) model the demand constraints of
shiftable and non-shiftable loads. An example for non-shiftable loads is typically a refrigerator and
3. BC Hydro is a Canadian utility company. This pricing model is obtained from www.bchydro.com.

891

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

shiftable loads include dishwasher, electric vehicles, washer/dryer, etc. The appliances are modeled
by a total demand that is required over the course of the planning horizon, upper and lower bounds
on the demand in each time slot as well as earliest start and latest end times. These constraints form
a convex set. For our problem, P
we also assume that the total demand of each agent during the whole
planning period is fixed, i.e., M
j=1 rij = i , where i is the total demand for agent i. Further,
we also consider loads, where the demand constraints form a convex set and denote it as Xi . This
constraint set is private knowledge and an agent does not share it, neither with other firms nor with
the coordinator. In some application scenarios, when an agent determines its energy demand profile,
it has to consider additional costs associated with the demand schedule. For example, in any given
factory the energy is most commonly used for production. Changing the energy demand schedule,
therefore, may mean changing the production process and, thereby, the production cost. For agent i,
this cost is denoted by gi (ri ). We assume this cost function to be convex. The overall cost function
P
of each agent is then M
j=1 pj (j ) rij + gi (ri ).
With the objective to minimize the sum of all agents costs, the overall energy allocation problem can be written as:
P
PN PM
pj (j )rij + N
min C (R) :=
i=1 gi (ri )
i=1
j=1
PM
(2)
s.t. ri  Xi , j=1 rij = i .
where the energy allocations rij are the optimization variables and R is the matrix of the demand
profiles of all the agents. Note that the above problem is defined on a convex
Xi . Although the
P setP
M
objective function is non-linear, it is convex because of the following. First, N
j=1 pj (j ) rij =
i=1
PM
j=1 pj (j ) j is convex and non-decreasing in j as indicated by Equation 1. Together with
PM
PN
j =
j=1 pj (j ) j is convex in rij , i, j, (Boyd & Vandeni=1 rij , we can conclude that
berghe, 2004). Since gi (ri ) is also convex, the total cost function C (R) is a summation of convex
functions and so also convex. Thus, Problem 2 is a convex minimization problem.

4. Solution Approach
Although the Problem 2 is a convex optimization problem, since the constraints and preferences of
the agents are private knowledge, the optimal demand profiles cannot be computed directly by the
central coordinator. The objective function, although a sum of the individual costs of each agent,
is coupled, because the price of electricity in any time slot j depends on the aggregated demand
of all agents j . However, since the constraints in Problem 2 are agent-specific, they are naturally
separable. Therefore, a primal decomposition approach (Bertsekas & Tsitsiklis, 1989) is used to
solve the problem in which the sub-problems correspond to each agent optimizing its own energy
cost subject to its individual constraints. The central coordinator has to compute the appropriate
information to be sent to the agents so as to guide the demand pattern towards time slots with lower
prices (this corresponds to the master problem in primal decomposition methods).
Since the agents know the electricity market prices, they individually optimize their demand
according to those prices. Let the resulting demand profile be called the uncoordinated demand
profile. Figure 2a depicts such an aggregated uncoordinated demand profile in a setting with three
time slots. It can be seen that the aggregated demand in time slot 2 is above the threshold, 2 > h2 ,
and the aggregated demand in time slots 1 and 3 is below, 1 < h1 , 3 < h3 . Thus, a shift of
demand from time slot 2 to the other time slots would reduce the total cost for the group. However,
since the agents dont know the demand of the other agents, they cannot shift their demand. An
intuitive solution approach, for the coordinator, to coordinate the demand would be to inform the
892

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

2
1.5

Threshold
h2

High price
Low price 
1

h1

3

1

1
0.5
0

h3
3

3

1

2.5

h1

2

High price

Threshold
3
h3

1.5

2

1
0.5

1

2

Time slot j

3

0

Aggregated demand

3.5

h2

Low price

(c) Coordinated Scenario

4

Aggregated demand

3.5

2

3
2.5

(b) Herding Scenario

4

2
Aggregated demand j

Aggregated demand j

Aggregated demand

Aggregated demand j

(a) Initial Scenario

4
3.5

Threshold

3

2

2.5
2
1.5

High price
h
Low price  1
1

h2
3

h3

1
0.5

1

2

Time slot j

3

0

1

2

Time slot j

3

Figure 2: A comparison of demand profiles in Uncoordinated, Herding and Coordinated scenarios.
agents about the aggregated demand in each time slot. Knowing the market price, the agents could
then solve their individual optimization problems. This approach is problematic, because the agents
dont know the demand constraints and preferences of the other agents in the group, while their costs
strongly depend on the demand of the other agents. For example, all agents knowing the market
price and the current aggregated demand could shift as much demand as possible to a supposedly
cheap time slot. This would lead to load synchronization, herding phenomenon, where all agents
shift demand to the supposedly cheap time slot, resulting in a new demand peak in that time slot
and thus increasing the total cost. The effect of this herding phenomenon is shown in Figure 2b,
where too much demand was shifted from time slot 2 resulting in demand above the threshold in
time slots 1 and 3. Thus, the key challenge is to design the information that the coordinator sends
to the agents, the virtual price signal, to enable the system to minimize the overall cost.
A virtual price signal is not the final price the agents have to pay, but information about what
they would have to pay, given the current aggregated demand. The virtual price signal enables the
agents to foresee the possible price increment/reduction caused by their demand shifting. Therefore, the virtual price signal for agent i in time slot j, svij (rij |R), is a function of the variable rij ,
denoting the new demand of agent i in time slot j. The price signal is computed based on the previous aggregate demand profile R, which is therefore included in the price function. For ease of
readability, time is not made explicit in this notation and will only be used in the proofs. The superscript v indicates the virtual price, in contrast to the real market prices pj (j ). To design the virtual
price signal, the coordinator first computes the amount of demand that should be ideally shifted in
each time slot. As shown in Figure (2a), this amount, denoted by j , j = 1, 2, 3, is the difference
between the total aggregated demand and the price threshold in each time slot. For readability, we
will refer to j as delta increment, noting that the delta could have negative values, i.e., it could
be a decrement. To avoid herding, the delta increment needs to be divided among the agents and a
threshold price signal needs to be designed for each agent, so that the price below the threshold is
lower than the price above the threshold. This serves to penalize the total demand in a time slot going above the threshold. Thus, the agents know the maximum amount of demand they could shift at
what prices and can solve their individual optimization problem. The exact calculation of the price
signal svij (rij |R) is shown in Section 4.1.2. Given the price signal, the virtual cost optimization
problem each agent solves is
P
v
min Cvi (ri |R) := min M
j=1 sij (rij |R) rij + gi (ri )
P
(3)
M
s.t. ri  Xi , j=1 rij = i .
Note that this problem, like the overall problem, is a convex optimization problem and thus solvable. However, because of their individual constraints and cost functions, some agents might not be
able to shift as much demand as was assigned to them by means of the virtual price signal. This
893

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

implies that the aggregated demand shift can be less than the amount that could have been achieved.
Figure 2c shows this case, where the total demand in the second time slot remains above the threshold, because not the whole 2 could be shifted. In order to shift the remaining demand, another
price signal, dividing the remaining amount, would be necessary. This motivates us to design an
iterative algorithm for the coordinator to update the virtual price signal based on the consumers
feedback and thus gradually adjust the individual demands to the central optimal solution.
4.1 Basic Coordination Algorithm
We present the basic coordination algorithm and the details of the virtual price signal design for the
energy allocation in the setting with a planning horizon of only two time slots, M = 2, and no cost
for shifting demand, g() = 0. Although called basic setting in this paper, this setting has practical
relevance, because it represents the commonly used Time of Use pricing schemes that divide the
planning horizon in two time slots (Albadi & El-Saadany, 2007). One time slot with typically high
load has high prices and one time slot with typically low load has low prices for electricity.
4.1.1 OVERVIEW OF A LGORITHM
Recall that ri denotes the demand profile of agent i and that R is the matrix of the demand profiles
of all agents. Let r0i be the updated demand profile of agent i after an iteration and R0 be the new
demand profile of all agents.
Initialization: Each agent computes an initial uncoordinated electricity demand profile ri by
solving Problem 3 based on the market prices and sends it to the coordinator.
1. The coordinator adds up the individual demands to determine the aggregated demand j for
each time slot j and then calculates the delta increment j of demand to be shifted in or out
of each time slot. Finally, the coordinator divides that demand among all agents and computes
the virtual price signals svij (rij |R) for each agent i and time slot j.
2. The coordinator sends the virtual price signals to all agents.
3. After receiving the virtual price signal, each agent individually calculate its new demand
profiles r0i according to the optimization Problem 3.
4. The agents send their new demand profiles back to the coordinator.
5. The coordinator compares the new demand profiles to the old profiles. If no agent changed its
demand profile, i.e., R = R0 , the coordinator stops the algorithm. Otherwise, it sets R = R0
and goes to step (1).
4.1.2 C OORDINATION WITH V IRTUAL P RICE S IGNAL
The virtual price signal for one agent in one time slot is a threshold price function of the demand
in that time slot. The demand up to a specified threshold is charged at a low price and the demand
above the threshold is charged at a higher price. The virtual price signal is therefore parameterized
H
by the low marginal price, pL
j , the high marginal price, pj , and the price threshold, hij (R), that
specifies the demand levels at which the prices apply. The virtual price, svij , for agent i in time slot j
is computed based on these parameters as follows
( pL h (R)+pH (r h (R))
ij
ij
j ij
j
rij > hij (R)
rij
svij (rij |R) =
(4)
L
pj
rij  hij (R)
894

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

Aggregated demand before iteration

1.75

Agent 1 demand r

1j

4

3.5

2
2

2.5

h2

2

2j

1

0.5

0

1

0.75
0.5
0.25

1.75

1

1

12

h12

1

r11

h11

11
1

2

Time slot j

h1

1.5

r12

1.5
1.25

0

Agent 2 demand r

Aggregated demand j

3

Agent 1 demand before local optimization

r22

1.5
1.25
1

h21

0.75
0.5
0.25

22

h22

21
r21

0

2

Time slot j

Agent 2 demand before local optimization

1

2

Time slot j

Figure 3: Division of j among agents for the virtual price signal. The yellow demand belongs to
agent 1 and the red demand to agent 2. Here 1 is the amount of demand that can be shifted into
time slot 1, while 2 indicates the amount of demand that needs to be shifted from time slot 2.

Agent 1 demand after local optimization

1.5

r

1.25

h

1

3.5

12

12

0.75
0.5
0.25

3

h

11

r
11

0

1

2

Time slot j

Agent 2 demand after local optimization


2j

1.75

Agent 2 demand r

Aggregated demand after iteration

4

1.5
1.25
1
0.75
0.5

h21

r21

h22

Aggregated demand j

Agent 1 demand r


1j

1.75

r22

2.5

h2

2

1.5

2

h1
1

1

0.5

0.25
0

1

0

2

Time slot j

1

Time slot j

2

Figure 4: Demand after agents local optimization. Agent 1 cannot reduce its entire demand from
time slot 2 (i.e., r12 > h12 ), because of its own demand constraints (left top plot). Thus, the
aggregated demand in time slot 1 is still below the threshold (i.e., 01 < h1 ). Therefore, the central
coordinator again sends a modified price signal to the agents and the algorithm continues until
agents stop shifting their demands.

895

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

L
v
Although the prices pH
j and pj are derived from the market prices, sij is called a virtual price
signal, because the threshold hij (R) changes, if the agents change their demand profiles. The
coordinator chooses hij (R) < rij to induce the agents to reduce demand or hij (R) > rij to
increase demand in one time slot. With ij as the amount the coordinator wants agent i to change
demand in time slot j, the threshold hij (R) is updated based on the demand profiles submitted in
the last iteration:
hij (R) = rij + ij
(5)

Thus, the agents know that, at the current market price, they can at most change their demand
in time slot j by ij . For the demand exceeding hij (R), they need to pay a higher price. The
demand, j , the coordinator wants to change in time slot j is calculated as the difference between
the current aggregated demand and the threshold of the market price:
j = hj  j

(6)

Since the coordinator
wants the total demand change of the agents to be less than j , it has to
P
ensure that i ij  j . The allowable shift for an agent is proportional to the agents share of
 r
the aggregated demand in that time slot, i.e., ij = Pj rijij . Figure 3 shows how the total demand
i
change is divided among the agents in order to create the individual virtual price signals. The left
side shows the initial aggregated demand of two agents. The yellow demand belongs to agent 1 and
the red demand to agent 2. Since the aggregated demand is below the threshold in time slot 1 (i.e.,
1 < h1 ) and above the threshold in time slot 2 (i.e., 2 > h2 ), the coordinator wants the agents to
shift demand from time slot 2 to time slot 1. The amount of demand that can be shifted into time
slot 1 is 1 , while 2 is the amount of demand that should to be shifted out of time slot 2. The right
side shows the individual thresholds of the agents as determined by the central coordinator using
the procedure described above. The allocation of the demand change to the agents is illustrated by
the dashed arrows. The current demand of agent 1 in time slot 1 is r11 and its threshold for time slot
1 is h11 (the other notations can be interpreted similarly).
4.1.3 T HE AGENT  S R ESPONSE TO THE V IRTUAL P RICE S IGNAL
Having received the virtual price signal, the agents will independently optimize their demand profiles in order to minimize their cost according to Problem 3. The agents objective function Cvi (ri |R)
P
v
= M
j=1 sij (rij |R) rij + gi (ri ) can be written as:
Cvi

(ri |R) =

M
X



+

L
L
pH
j (rij  hij (R)) + pj (rij  hij (R)) + pj hij (R) + gi (ri )

(7)

j=1

Since the agents have to pay the high price pH
j for demand exceeding their individual threshold,
no agent will shift too much demand, based on a false impression of possible cost reduction. Figure 4 shows the agents demand profiles after their individual optimization. The left side shows the
individual problems of the agents, after they have optimized their demand profile. In comparison to
the right side in Figure 3, it can be seen that agent 2 shifted the whole allocated amount, but agent 1
only shifted some part of it (e.g., due to its constraints). The right side in Figure 4 shows the central
problem after the agents individual optimization. It can be seen that there is still demand left to be
shifted from time slot 2 to time slot 1. This remaining demand would again be divided among the
agents in the subsequent iteration.
896

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

4.1.4 PAYMENT RULE
After the algorithm has converged, the agents have to pay the virtual unit price for their demand in
each time slot. In the last iteration the virtual unit price equals the average unit price for the aggregate demand of the whole cooperative, because no agent changed its demand profile, Equation 9.
With R as final demand profiles of the whole cooperative and ri as final demand profile of agent i,
the payment for agent i is given as
paymenti =

M
X

svij (rij |R) rij

(8)

j=1

4.2 Convergence of the Basic Algorithm
In this section we prove that the basic iterative procedure always converges to an optimal solution
L
in the basic setting with M = 2, gi () = 0 and pH
j > pk , j, k. In Lemma 1, we show that the
algorithm strictly reduces cost in every iteration. This fact will be used in Theorem 1 to show that
the algorithm always converges. Then, in Theorem 2 we show that, when M = 2, gi () = 0 and
L
pH
j > pk , j, k, the converged solution is an optimal solution. Subsequently, we show that the
algorithm can get stuck in a suboptimal solution in general settings if M > 2 (Lemma 3) or if
gi () 6= 0 (Lemma 4).
Lemma 1. The algorithm strictly reduces the total cost in every iteration: C (R0 ) < C (R).
Proof. Lets first introduce some notation that will be used throughout this proof. Let R be the total
demand profile at the end of iteration round t and R0 be the total demand profile at the end of round
t + 1. Similarly, let C(R) be the total cost at the end of iteration t and C(R0 ) be the total cost at
the end of iteration t + 1. The virtual prices for round t + 1 are computed by the central coordinator
using R. Let Cvi (ri |R) be the cost for agent i computed according to the virtual price signal for
demands at the beginning of round t + 1 and Cvi (r0i |R) at the end of round t + 1.
At the beginning of each iteration the total cost for the consumer group based on market prices
(given by the objective function in Problem 2) equals the sum of the individual cost of the agents
P
v
based on the virtual price signals (given by Problem 3), i.e., N
i=1 Ci (ri |R) = C (R):
N X
M
X

svij

(rij |R) rij +

gi (ri )

i=1

i=1 j=1
N X
M
X

N
X

"



+
(hj  j ) rij
P
=
rij  rij +
i rij
i=1 j=1



(hj  j ) rij
P
+ pL
r

r
+
ij
ij
j
i rij

# X
N
(hj  j ) rij
L
P
+ pj rij +
+
gi (ri )
i rij
i=1
=

pH
j

M h
N
i X
X
+

L
L
pH
(

h
)
+
p
(

h
)
+
p
h
+
gi (ri )
j
j
j
j
j
j
j
j
j=1

=

(9)

N X
M
X
i=1 j=1

i=1

pj (j ) rij +

N
X

gi (ri )

i=1

897

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

If the algorithm has not stopped, at least one agent has changed its demand profile, i.e., i with
r0i 6= ri . Agents only change their demand profile, if that reduces their cost according to Problem 3.
Thus, given the virtual price, signal for agent i the cost of the new demand profile r0i is strictly lower
than of its previous demand profile ri :

Cvi r0i |R < Cvi (ri |R)
(10)
After all agents
submitted their new demand profile, the new aggregated demand is comPN have
0
0
puted as: j = i=1 rij . Next, we show that the sum of the agents individual cost according to the
virtual price signals is an upper bound on the total central cost at market prices. Thus, the total cost,
based on the new aggregated demand, is lower or equal to the sum of the agents individual cost,
based on their new demand. This fact is very important, because it prevents the herding behavior:
No solution that reduces the cost for the agents individual problems can lead to a worse solution in
the central problem. This is proved by showing with Equations 1 and 7 that for every time slot j the
difference between the central cost for the aggregated demand and the sum of the agents individual
cost is less than or equal to 0. The following is a sketch of the proof omitting some algebraic steps
for ease of readability. Consult Appendix A for the complete proof. For any time slot, j, we have
N
X

N
X
 0
 0
0
pj 0j rij

svij rij
|R rij

i=1

i=1

(PN
=


0
rij
 hij (R) 0j
 0

H
pL
rij  hij (R) 0j
j  pj
 0
 i
L
pH

p
r

h
(R)
0
ij
j
j
ij
i


+
H
0
pL
rij
 hij (R)
0
j  pj

i: r 0 h
PN ij ij
0 >h
i: rij
ij

hP
N

i=1
= hPN


i=1

L
pH
j  pj



> hj
 hj

(11)

0j > hj
0j  hj


 
PN v  0
0 j, it also holds for the sum of all time slots:
0
0
Since i=1 pj j rij  i=1 sij rij |R rij
P
v
0
C (R0 )  N
i=1 Ci (ri |R).
From Equations 9, 10 and 11 we can conclude that:
PN

N
N
 X
 X
C R0 
Cvi r0i |R <
Cvi (ri |R) = C (R)
i=1

(12)

i=1

Thus, the total cost is strictly reduced in each iteration.
Theorem 1. The basic iterative algorithm for solving Problem 2 always converges.
Proof. From the definition we have that Problem 2 is convex and a lower bound on the total cost can
be obtained by the sum of the individual initial demand profile costs at market prices. From Lemma
1 we have that the algorithm reduces the total cost in each iteration. Thus, it can be concluded that
the algorithm converges.

P
PN v
N
Lemma 2. The real market cost, N
i=1 pj i=1 rij rij , equals the virtual cost
i=1 sij (rij |R) rij
in a time slot j, if either i, rij  hij (R) or i, rij  hij (R).
Proof. If i, rij  hij (R), then j  hj and from the first case in Equation 11 follows the cost are
equal. If i, rij  hij (R), then j  hj and from the second case in Equation 11 follows the cost
are equal.
898

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

Theorem 2. The solution R of the basic algorithm is optimal, in either of the following cases
A) j, R satisfies j 6= hj with no restrictions on M and gi ()
B) R satisfies j, s.t. j = hj and M = 2, gi () = 0 and the high price in any time slot is
L
greater than the low price in any other time slot, i.e., pH
j > pk , j, k
Proof. We prove by contradiction that when the algorithm has converged to the solution R that
satisfies Case A, there is no other solution R0 with lower cost. Suppose there exists such a solution
R0 , i.e., C(R0 ) < C(R). We will show that this contradicts the convergence conditions of the
algorithm that i, ri is the solution of the agents individual problem, ri = arg minxi Xi Cvi (xi |R).
Denote R# () = R+(1  ) R0 ,   (0, 1), a linear combination of R and R0 . Since the central
cost function is convex and C(R0 ) < C(R), we also have C(R# ()) < C(R). If j, R satisfies
j 6= hj , then for the demand in the beginning of the iteration rij we have j either i, rij > hij (R)
or i, rij < hij (R), because if j > 0 then i, ij > 0 and similarly if j < 0 then i, ij < 0.
#
#
It follows,   (0, 1), s.t. j, either i, rij
()  hij (R) or i, rij
(1 )  hij (R).


PN
#
v
= C(R# ()). Moreover, we have
Therefore, by Lemma 2,
i=1 Ci ri () |R
P
v
C(R# ()) < C(R) and from Equation 9 we also have N
i=1 Ci (ri |R) = C(R). It follows,
v
v
i, s.t. Cvi r#
i () |R < Ci (ri |R), which conflicts with ri = arg minxi Xi Ci (xi |R), i.e., ri is
not the solution of the agents individual Problem.
We prove by contradiction that when the algorithm has converged to the solution R that satisfies
Case B, there is no other solution R0 with lower cost. Assume there exists a solution R0 with
C(R0 ) < C(R). Let the 2 time slots be {j, k}, where 0j < j and 0k > k (without loss of
m
generality). Note that pm
j (j ) > pk (k ), because otherwise the new cost would not be lower. If
H
L
m
j = hj , k = hk then pm
j (j ) = pj (as j decreases) and pk (k ) = pk (as k increases).
L
m
m
From the market price structure we have pH
k > pj . It follows pj (j ) < pk (k ), which leads to
m
L
H
a contradiction. If j 6= hj , k = hk and if j < hj then pj (j ) = pj and pm
k (k ) = pk thus
H
H
H
m
H
m
m
pm
j (j ) < pk (k ). If j > hj then pj (j ) = pj and pk (k ) = pk . We have pk > pj , because
otherwise a shift from j to k would be beneficial for at least one agent and the algorithm would
m
not have stopped. It follows pm
j (j ) < pk (k ), which again leads to a contradiction. The case of
j = hj , k 6= hk works similarly.
It follows that R is the optimal solution, as no solution with lower cost exists. Thus, the proposed iterative algorithm converges to the optimal solution. Since the problem is convex that solution is also the global optimal solution (Boyd & Vandenberghe, 2004).
Lemma 3. The basic algorithm could converge to a suboptimal solution R in settings, where R
satisfies j, s.t. j = hj , M > 2 and gi () = 0.
Proof. We now prove by presenting a counterexample that the basic algorithm can converge to a
suboptimal solution in settings, where R satisfies j, s.t. j = hj , M > 2 and gi () = 0. Consider
a population of 2 agents, N = 2, and a planning horizon of 3 time slots, M = 3. The agents
constraints are in a form so that in the converged solution the aggregated demand is below the
threshold in one time slot, directly at the threshold in another time slot and in one time slot above
the threshold.
Let the price function for the three time slots be given as:
H
L H
L H
(pL
1 , p1 ) = (3, 6), h1 = 10; (p2 , p2 ) = (2, 5), h2 = 10; (p3 , p3 ) = (1, 4), h3 = 10;

899

fi8
6

p1H=6

p2H=5

p3H=4

p1L=3

p2L=2

p3L=1

(KWh)

10

demand agent 1

demand agent 1

(KWh)

V EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

4
2
0

1

2

3

10
8
6
4
2
0

1

(KWh)

10
8
6
4
2
0

1

2

2

3

time slot

demand agent 2

demand agent 2

(KWh)

time slot

3

time slot

10
8
6
4
2
0

1

2

3

time slot

(b) Optimal Solution R0

(a) Converged Solution R(T )

Figure 5: Converged and Optimal solution for the example in Lemma 3. The top row shows the
demand of agent 1 and the bottom row the demand of agent 2. The dashed lines indicate the upper
and lower bounds of the demands of the agents in a time slot. The solid black lines show the price
thresholds for each time slot.
The individual constraints on the agents demand are: (a) upper and lower bounds on the demand
in each time slot and (b) constant total demand over all time slots. Specifically,
r11  [1, 4], r12  [1, 9], r13  [1, 9], r11 + r12 + r13 = 1 = 17
r21  [1, 9], r22  [1, 9], r23  [8, 9], r21 + r22 + r23 = 2 = 17
Let R(t) denote the demand profile of the agents in the tth iteration and let t = 1 be the initial
iteration and t = T be the final iteration at convergence. At the beginning the agents compute their
(1)
(1)
initial demand profiles based on the market
prices r1 = (1, 7, 9), r2 = (1, 7, 9). The cost based

on the initial demand profiles is C R(1) = 88. At convergence, the profiles of the two agents are
(T )

(T )

r1 = (4, 5, 8), r2 = (4, 5, 8) (see Figure 5a for a graphical representation). The cost based on
these demand profiles is C R(T ) = 78. However, a different demand profile of the agents exists
with r01 = (4, 7, 6), r02 = (6, 3, 8) (see Figure 5b for a graphical representation). This profile is
feasible and leads to lower total cost, i.e., C (R0 ) = 76. It follows that the algorithm has stopped in
a suboptimal solution.

Lemma 4. The basic algorithm could converge to a suboptimal solution R in settings, where R
satisfies j, s.t. j = hj , M = 2 and gi () 6= 0.
Proof. In Appendix B a counterexample is presented, proving that the basic algorithm can converge
to a suboptimal solution in settings, where R satisfies j, s.t. j = hj , M = 2 and gi () 6= 0.
900

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

5. General Coordination Algorithm
In the previous sections we introduced a basic iterative coordination algorithm for optimal energy
allocation in the basic setting with a planning horizon of only two time slots, M = 2, and no cost
for shifting demand, g() = 0. Moreover, we presented counter examples showing that, in general
settings with M > 2 or g() 6= 0, the algorithm can get stuck in a suboptimal solution. In this
section, we present a general coordination algorithm for the energy allocation in general settings
with more than two time slots and non-zero individual costs for shifting demand.
5.1 The Additional Phase
The reason for convergence to a suboptimal solution is that the coordinator cannot determine the
agents marginal valuation for their demand, if the aggregated demand in some time slot is at a
threshold. The agents might have different marginal valuations, so that a shift from an agent with a
lower valuation to an agent with a higher valuation might be beneficial. However, this opportunity
for improvement cannot be realized, because the coordinator does not know the marginal valuations
of the agents.
We now introduce an additional phase to the algorithm to address this problem. When the basic
algorithm has converged, the coordinator checks whether the aggregated demand is at the threshold
for at least one time slot. If that is not the case, the algorithm stops and the solution is optimal.
However, if the demand is at the threshold in some time slot, the coordinator initiates another phase.
The basic idea is that, besides the virtual price signal, the coordinator sends an additional query
to the agents, requesting their valuations for an -increase and -decrease of threshold in the time
slots, where the aggregated demand is at the threshold. Then, the coordinator uses this information
to adjust the virtual price signals.
+
Let vij
denote the value for agent i of an -increase of its threshold in time slot j. Let further
ij+
R
be the demand profile, where in the resulting price signal for agent
in time slot
 i the threshold

j+
v
ij+
ij+
be its virtual cost,
j is increased by , i.e., hij (R ) = hij (R) + . Moreover, let Ci ri |R
where the threshold in time slot j is increased by .
Definition 1. Agent is marginal valuation for an -increase of the threshold in time slot j is the
difference in its virtual cost between the original virtual problem and the virtual problem with an
-increased threshold in time slot j. The valuation for an -decrease is defined analogously.







j

+
ij+
0
v
ij
vij
(R) = Cvi rj+
|R

C
r
|R
;
v
(R)
=
C
r
|R
 Ci r0i |R .
i
i
i
i
ij
i

(13)

When the agents receive their virtual price signal and the query for their marginal valuations,
they first compute their optimal demand profile r0i , based on the price signal. Second, they compute
+

their marginal valuations vij
(R) and vij
(R) for every time slot, with the aggregated demand at
+
the threshold. Let the vector vi consist of the valuations for -increments and vi for decrements
respectively. Finally, the agents send ri , vi+ and vi back to the coordinator.
Having received the agents information, the coordinator computes the virtual price signals for
the next iteration. If the aggregated demand is at thenthreshold,
it finds the agents with the lowest
o
+
cost for an -increase of the threshold: l = arg mini vij and the lowest cost for an -decrease of
n o


+
the threshold: k = arg mini vij
. If the combined cost is negative vkj
+ vlj
< 0, a beneficial shift
901

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

from agent l to agent k exists. In that case, the coordinator updates the thresholds of agents l, k as
lj = , kj = .
The algorithm stops, if the demand is not at the threshold in any time slot or if for all time slots at

+
the thresholds no pair {l, k} exists with vkj
+ vlj
< 0. It follows, when the algorithm converges,
in every time slot with the aggregated demand at the threshold, j = hj , for all agents, the cost
reduction of an -increase of the threshold is less than the additional cost from a -decrease of the
threshold for all other agents, i.e.,
+

vlj
 vkj
, l, k  {1, ..., N } and j s.t. j = hj .

(14)

Otherwise, the coordinator would change the price signals and the algorithm would not stop.
5.2 General Algorithm
The general algorithm is designed as an iterative algorithm, where the coordinator updates the virtual
price signals based on the consumers feedback and thus gradually adjusts the individual demands
to the central optimal solution. The overall algorithm is shown in Algorithm 1. Each iteration
consists of two steps: First, the central coordinator aggregates the demand submitted by the agents
and computes virtual price signals for each agent. The virtual price signals are computed in the
subroutine CalculateVirtualPriceSignals (Algorithm 2). Second, the individual agents use the
virtual price signal to solve their individual cost optimization problem and compute their marginal
valuation for their electricity demand and report them to the coordinator. The agents response is
computed in CalculateDemandProfileAndValuation (Algorithm 3).
The general algorithm first only runs the basic algorithm until convergence and subsequently
performs the additional phase, if necessary. In particular, the additional phase is performed, if the basic algorithm has converged (Algorithm 1 line 8) and in at least one time slot the aggregated demand
is not at the threshold (Algorithm 1 line 9). The algorithm reaches the optimal solution when R =
+

R0 and either j 6= hj , j or in the additional phase vlj
 vkj
, l, k  {1, ..., N }, j s.t. j = hj .
5.3 Convergence of the General Algorithm to an -optimal Solution
Please note that Theorem 1 still holds for the general algorithm, because the algorithm still reduces
the total cost in each iteration. Thus, the extended algorithm converges. In Theorem 3 we prove that
the solution of the general algorithm lies within an -neighborhood of the optimal solution.
Theorem 3. The converged solution R of the general algorithm lies within an  neighborhood of the
optimal solution R , where  is the amount for which the agents compute their marginal valuations.
Proof. We now prove by contradiction that when the general algorithm has converged to the solution R, then no other solution R0 exists with lower cost with respect to the central Problem 2
outside of an -neighborhood around R. Suppose there exists a solution R0 having a lower total energy cost than R, i.e., C(R0 ) < C(R). We will show that this contradicts the convergence
conditions of the general algorithm that i, ri is the solution of the agents individual problem,
+

ri = arg minxi Xi Cvi (xi |R), and that vlj
 vkj
, l, k  {1, ..., N } and j s.t. j = hj .
The only case left from Theorem 2 is that j, j = hj , which implies i, rij = hij (R),
and that
fi
fi
fi
0 > h (R) and k  K, r 0 < h (R), where l, k s.t. r 0  r fi 
L, K 6= , s.t. l  L, rlj
fi lj
lj
kj
lj fi
kj
fi
fi
fi 0
fi
, firkj
 rkj fi  . We will show that this case conflicts with the convergence conditions, too.
902

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

Algorithm 1: Overall algorithm.
Data: Scenario with electricity contract and agent definitions.
Result: Optimal demand schedule R .
1
2
3
4

5
6

7
8
9
10
11
12
13
14
15
16
17
18
19
20
21

Initialization: All agents compute an initial energy demand profile ri by solving Problem 3
based on the market prices and send it to the coordinator.;
addP hase = f alse;
while demand schedule R is not optimal do
Coordinator calculates the price signals using Algorithm 2:
svij (rij |R) , i, j  CalculateVirtualPriceSignals (ri , vi+ , vi , addP hase);
The coordinator sends the virtual price signals to all agents;
Agents calculate demand profiles and valuations for all time slots, j, using Algorithm 3:
i: r0i , vi+ , vi  CalculateDemandProfileAndValuation (svij (rij |R), addP hase);
The agents send their new demand profiles and valuations back to the coordinator;
if algorithm has converged, i.e., R = R0 then
if j 6= hj , j then
the demand schedule R0 is optimal;
else
+

if addP hase and vlj
 vkj
, l, k  {1, ..., N }, j s.t. j = hj then
the demand schedule R0 is optimal;
else
start additional phase, i.e., addP hase = true;
end
end
else
R  R0 ;
end
end

fi
fi
fi
fi #
()  rlj fi =
We start with the case in which |L| = |K| = 1. Then we have   (0, 1), s.t. firlj
fi
fi
fi #
fi
firkj ()  rkj fi = . Moreover, denote R## () s.t.,
##
rit


() =

#
rit
() if i  L  K, t = j
rit
otherwise

a demand profile reflecting the changes in demand in time slot j so that in the resulting individ#
#
ual problems again all agents have their demand on the threshold, rlj
= hlj (R## ) and rkj
=
##
hkj (R ). Thus, with Lemma 2 we get that the sum of the virtual cost is equal to the central cost.
N
X







#
#
v
v
##
##
Cvi r#
()
|R
+
C
r
()
|R
()
+
C
r
()
|R
()
l
k
i
l
k

i=1,i6=l,k

=

C(R# ()) < C(R) =

N
X

Cvi (ri |R)

i=1

903

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

Algorithm 2: Calculation of the virtual price signal by the coordinator.
1

2
3
4

CalculateVirtualPriceSignals (ri , vi+ , vi , addP hase);
Data: demand profiles and valuations of all agents, ri vi+ , vi , i.
Result: virtual price signals for all agents, svij (rij |R) , i, j.
P
Compute the aggregated demand: j  N
i=1 rij ;
Compute demand to be shifted in each time slot: j  hj  j ;
 r
Divide that demand among all agents: ij  Pj rijij ;
i

5
6
7
8
9
10
11

if addP hase then
n
o
+

Find time slot j and agents l, k s.t. min vlj
 vkj
;
+

if vlj
+ vkj
< 0 then
Adapt demand to be shifted for agent l: lj   and agent k: kj  ;
end
end
Compute thresholds based on demands to be shifted: hij  rij + ij ;

Algorithm 3: Calculation of the individual demand profiles and marginal valuation of energy
for agent i.
1 CalculateDemandProfileAndValuation (sv
ij (rij |R), addP hase);
Data: virtual price signal svij (rij |R), j = 1, . . . , M .
Result: new demand profile r0i and valuations vi+ , vi .
2
3
4
5
6
7
8

Compute new demand profile r0i according to virtual price signal:
ri = arg minxi Xi Cvi (xi |R);
if addP hase then
foreach time slot j at the threshold, rij = hij do



+
ij+  Cv (r0 |R);
Compute valuation of increased threshold: vij
 Cvi rj+
|R
i i
i


ij  Cv (r0 |R);
Compute valuation of decreased threshold: vij
 Cvi rj
i i
i |R

end
end

which implies either
N
X



Cvi r#
i () |R <

i=1,i6=l,k



N
X

Cvi (ri |R)

i=1,i6=l,k



v
i, s.t. Cvi r#
i () |R < Ci (ri |R)

which conflicts with the convergence condition ri = arg minxi Xi Cvi (xi |R);
or







#
v
##
##
Cvl r#
()
|R
()
+
C
r
()
|R
()
< Cvl (rl |R) + Cvk (rk |R)
k
l
k


h 

i
##
##
Cvl r#
()  Cvl (rl |R) <  Cvk r#
()  Cvk (rk |R)
l () |R
k () |R

904

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

fi
fi




fi #
fi
## () is equal to Cv rj+ |Rij+
For firkj
()  rkj fi =  we get that Cvl r#
()
|R
and
l
l
l




## () is equal to Cv rj |Rij . Thus, with Equation 13 follows
Cvk r#
k
k () |R
k
+

vlj
(R) < vkj
(R)

+

which conflicts with the convergence condition, l, k  {1, 2,    , N }, vlj
(R)  vkj
(R).
For the general case of |L| , |K|  1, we can get
N
X




 X
 X

##
##
()
() +
Cvk r#
Cvl r#
Cvi r#
i () |R +
k () |R
l () |R

i=1,iLK
/

=

kK

lL

C(R# ()) < C(R) =

N
X

Cvi (ri |R)

i=1

which implies either
N
X
i=1,iLK
/



i, s.t. Cvi

N
X



Cvi r#
()
|R
<
i

Cvi (ri |R)

i=1,iLK
/



r#
i



() |R <

Cvi

(ri |R)

which again conflicts with the convergence condition ri = arg minxi Xi Cvi (xi |R);
or
X


 X

 X
X
#
v
##
##
Cvk (rk |R)
Cvl r#
()
|R
()
+
C
r
()
|R
()
<
Cvl (rl |R) +
k
l
k

lL



X
lL

kK

Cvl



lL

kK

"
#
 X

 X
X
##
##
r#
() 
Cvl (rl |R) < 
Cvk r#
() 
Cvk (rk |R)
l () |R
k () |R
lL

kK

kK

Since the amount of demand increased in time slot j is equal to the demand decreased, and the cost
decrease on the LHS is greater than the increase in cost on the RHS, there exists a pair of agents,
l, k such that the marginal cost decrease of l is larger than the marginal cost increase of k
+

 l  L, k  K, vlj
(R) < vkj
(R)

+

which conflicts with the convergence condition, l, k  {1, 2,    , N }, vlj
(R)  vkj
(R).

The solution R lies within an  neighborhood of the optimal solution R , where  is the amount
for which the agents compute their marginal valuations. When no beneficial shift of the size greater
or equal to  exists any more, the algorithm stops. However, a beneficial shift smaller than  might
still exist.
5.4 Convergence Time of the Algorithm
In this section, we give an upper bound on the number of steps the algorithm needs to converge.
First, we give a bound for the basic algorithm in Lemma 5 and the extended phase in Lemma 6.
Second, we give a bound for the general algorithm in Theorem 4.
905

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

Lemma 5. The basic algorithm converges within a maximum of d log   N e steps, where N is the
number of agents and  is the distance of the converged solution to the optimal solution of the basic
algorithm.
Proof. We prove this by showing an upper bound on the number of iterations needed in one time
slot, say, time slot j, to get from the initial demand level into the neighborhood of the optimal
demand level of the basic algorithm. This is sufficient, because when the demand in the last time
slot has reached its optimal level, the demand in all other time slots also reached their optimal level.
In this proof we will consider a time slot with its initial demand below the optimal demand. This
is sufficient, because every shift consists of a demand decrease in at least one time slot and also an
increase in at least one time slot. Thus, when all time slots that were below their optimal demand
level, reached their optimal level, the remaining time slots also reached their optimal levels.
Since all variables in this proof are for time slot j, we omit the subscript j for increased readability. Let Dt be the difference between the optimal aggregated demand and the aggregated demand
after iteration t. Since the demand is assumed to be below the optimal demand, Dt > 0. Without
loss of generality, assume the initial value of Dt is 1 (D0 = 1) and the optimum is 0; for each
agent i, its initial demand rij = 1. The worst case is that only one agent (e.g., agent 1) can increase
its demand. In this case, only agent 1 can increase its demand in each iteration, and its increment
equals the amount of demand shift assigned by the coordinator.
We denote at as the increment of agent 1s demand in iteration t and ct as agent 1s demand
after iteration t (c0 = 1). With N denoting the total number of agents, the demand shift assigned
 r
to agent i is given based on the definition of the price signal by ij = PNj ij . Then, we have for
i=1 rij

agent 1s increment

ct1 Dt1
.
(15)
N  1 + ct1
Agent 1s demand after iteration t is its initial demand plus its increments in the first t iterations.
Similarly, the difference Dt is the initial difference minus agent 1s increments.
at =

ct = 1 +

t
X

al , Dt = 1 

l=1

t
X

al  at = ct  ct1 = Dt + Dt1 , ct = 2  Dt .

l=1

By substituting the above into Equation 15, we have
(2  Dt1 ) Dt1
N + 1  Dt1
2
= 2Dt1  Dt1
(N  1) Dt1
=
N + 1  Dt1

Dt + Dt1 =
2
(N + 1) (Dt + Dt1 ) + Dt Dt1  Dt1

Dt
Since n  1, Dt  (0, 1), we get



(N  1) Dt1
N 1 n
Dt <
 Dt <
N
N


l
m
log 

Thus,  > 0, t = loglogN1 = log N
log(N 1) , s.t., t > t , we have Dt < . Moreover,
N

since logarithm is strictly increasing and concave, we have log N  log (N  1) >
 > 0, t = d log   N e, s.t., t > t , we have Dt < .
906

1
N.

Thus,

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

Lemma 6. The extended phase converges at maximum within a number of
0

l

(C0  C )
v

m

steps, where



C is the total cost in the solution from the basic algorithm, C is the total cost in the optimal
solution and v is the minimum value for the marginal valuations of an -increase and decrease of
the threshold in one time slot.
Proof. We will prove this by showing an upper bound on the number of iterations needed to reduce
the total cost from the solution of the basic algorithm, i.e., C0 , to the total cost of the optimal
solution, i.e., C . In each iteration of the extended phase, the thresholds are adapted for two agents,

+
say k, j. Thus, the total cost is reduced by vkj
+ vlj
(Equation 13). Let v be the minimum value

+
for vkj + vlj . Then, as long as the algorithm does not converge, after each iteration, the total cost is
l 0  m
reduced at least by v . Thus, the algorithm stops at most within (C vC ) steps.
Theorem 4. The time complexity of the general algorithm lies is O(N + (C0 -C )), i.e., the algorithm is linear in the number of agents and pseudopolynomial in (C 0  C  ).
Proof. From Lemma 5 we get the upper bound on the number of iterations of the basic algorithm
as dN log e. With  log  being a constant, which is independent of N , the time complexity of
the basic algorithm is O(N
l 0 ). From
m Lemma 6 we get the upper bound on the number of iterations of
(C  C )
the extended phase as
. The cost difference (C0  C ) does not depend on N or M , but
v
on the specific characteristics of the agents. The minimum valuation v is proportional to the size
of the threshold increment/decrement . Thus v is a constant for any constant choice of . Thus,
the bound of the extended phase is pseudopolynomial in (C0  C ).
5.5 Incentive Compatibility
In general, for allocation problems, there are three key properties of interest, namely, efficiency,
strategy-proofness, and budget-balance. In the context of our problem, efficiency implies that the
overall electricity consumption cost is minimized. Strategy-proofness implies that telling the truth
is the dominant strategy for the agents and hence they report truthfully. Budget-balance implies
that the total amount paid by the members of the cooperative is equal to the actual electricity consumption cost. There are two well known facts about these three properties in the literature: First,
if the allocation is efficient, the only way to implement payments that guarantee strategy-proofness
is to use VCG-type mechanisms, see the work of Green and Laffont (1977), Hurwicz (1975). Second, as Green and Laffont (1977) and Hurwicz (1975) also prove, payments obtained by VCG-type
mechanisms cannot achieve budget balance. Thus, it is impossible to design a mechanism that
achieves all the three properties, namely, efficiency, budget balance and strategy-proofness.
As we have stated in our discussion in the related work section, budget balance is a key requirement of our problem from the application point of view. Furthermore, allocation efficiency is a desired social goal. Our algorithm achieves both budget balance (Lemma 2) and allocation efficiency
(Theorem 3). Therefore, from the impossibility results, we cannot achieve strategy-proofness, i.e.,
truth telling cannot be a dominant strategy. However, we believe each agent may choose to truthfully respond, because agents cannot anticipate the future development of the algorithm and, as we
prove below, no manipulation strategy exists that dominates truth reporting. Therefore, we define a
notion of weak incentive compatibility.
Definition 2. An algorithm satisfies weak incentive compatibility or is weakly incentive compatible,
if and only if no strategy dominates telling the truth in the algorithm.
907

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

Theorem 5. The general algorithm is weakly incentive compatible.
Proof. In our algorithm the agents have two possible ways to deviate from truthful reporting: First,
they could report a demand profile that does not minimize their individual cost according to the
current virtual price signals with the intent that this misreporting would benefit them for the final
payment. Second, they could report marginal valuations that differ from their true marginal valuations. For our analysis we assume rational agents, i.e., agents always prefer lower cost.
Note that in the payment rule (Equation 8) each agent pays for its electricity demand based on
its final price signal. In each iteration, a truthful demand report minimizes an agents cost given
the price signal. Therefore, if an agent does not report truthfully at the final price signal (i.e., final
iteration) it will incur a higher cost. Furthermore, agents do not know whether any given price
signal is the final price signal or not. This is, because agents have limited knowledge and do not
know the demand profiles of other agents or their constraints and preferences. Thus, manipulation
at any iteration may result in higher cost than a truthful report. Therefore, no manipulation strategy
involving misreported demand profiles dominates truthful reporting.
Regarding the reporting of the marginal valuations (Definition 1), it is obvious that deflating its
valuation hurts the agent. We now demonstrate with an extension of the example from Lemma 3,
that deviating from truth revelation through inflating the reported marginal valuation can also hurt
an agent. The aggregated demand is at the threshold in time slot 2 so that the coordinator asks for
the agents valuations for an -increase of the threshold. Without loss of generality assume  = 1.
+
L
= pH
Agent 1s true valuation is (reduce in time slot 3 and increase in 2) v12
3  p2 = 2 and agent 2s
+
L
is (reduce in time slot 1 and increase in 2) v22 = pH
1  p2 = 1. Lets assume agent 2 misreports its
+
valuation so that v22 > 2. Then, the coordinator increases the threshold in time slot 2 for agent 2
and decreases the threshold for agent 1. It follows that agent 1 has to shift demand from time slot 2
to time slot 3 and that agent 2 can now shift demand from time slot 1 to time slot 2. This leads
to the demand profiles: rdeviate
= (4, 4, 9), rdeviate
= (3, 6, 8). However, this profile does not
1
2
only lead to an increase in total cost, but also to an increase of the individual cost for the deviating
agent 2. Table 1 shows the individual cost.4 Since misreporting the valuations may result in higher
electricity cost than a truthful report for the misreporting agent, no manipulation strategy involving
misreported marginal valuations dominates truthful reporting.
cost
truthful reports
agent 2 deviates

agent 1s cost
37.143
40.118

agent 2s cost
38,857
38.882

total cost
76
79

Table 1: Cost of different demand profiles for individual agents.

6. Simulation
We perform simulations based on real world consumption data to (a) characterize the convergence
properties of our algorithm and (b) understand the effect of different parameters that characterize
the electricity demand profile on the cost reduction through coordination by our algorithm. The
results show that the algorithm scales linearly with the number of agents and time slots. Further,
we observe that as the participants flexibility of shifting their demands increases, cost reduction
4. Since Agent 2s deviation increases both agent 1s as well as agent 2s cost, one might argue that increasing the other
agents cost could also be an incentive for deviation. However, note that the cost of an agent is not visible to others.
Therefore, we believe that each agent may choose to report truthfully.

908

fielectricity price (Euro cents/kWh)

M ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

dayahead
spot market
price

6

4

2

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

Figure 6: Day-ahead spot market prices from EPEX Spot for an average Tuesday in 2013
increases as well and that the cost reduction is not very sensitive to whether the consumers use more
electricity during the evening or during the day.
6.1 Datasets
CER Electricity Consumption Data: We use real electricity consumption data to generate consumer demand profiles. The data was gathered by the Irish Commission for Energy Regulation
(CER) in the context of a smart metering study. In this study, the electricity consumption data of
485 small and medium enterprises and 4, 225 private households was collected over a period of
about 1.5 years. The observation period is divided into time intervals of 30 minutes. One data
point represents the average electricity consumption in kilowatts of one participant during a 30
minute interval. In particular, we used the data from 46 enterprises. The participating enterprises
also answered questionnaires about, among others, their number of employees and typical hours of
operation. We will refer to this data set as the CER data set5 .
EEX Electricity Prices Market Data: We generate the cooperatives electricity prices using real
day-ahead market electricity prices, gathered from the European Energy Exchange (EEX), which
is the leading energy exchange in Europe. In particular, we use the average hourly day-ahead
prices from the EPEX Spot market from the 20 Tuesdays from January 1st 2013 to May 14th 2013.
Figure 6 shows the average day-ahead spot market prices of the observation period. We will refer
to the hourly market price data as the EEX data set6 .
6.2 Simulation Parameters
As of the model in the work of Mohsenian-Rad et al. (2010), weP
define each agent by its predetermined total electricity demand over the planning horizon, i = M
r , and by upper and lower
h j=1 iji
bounds on the electricity demand in each time slot, i.e., rij  rij , rij . Regarding the individual cost functions gi , we assume gi = 0, because we do not have data on industry specific cost
functions.
5. The data set is available at http://www.ucd.ie/issda/data/commissionforenergyregulation/.
6. The data is available at http://www.eex.com/en/Market%20Data.

909

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

6.2.1 M ODELING THE C OMPOSITION OF C OOPERATIVES :
Agents can have a variety of different demand characteristics. To reflect this diversity, we use
the CER data set to identify two classes of consumers with similar characteristics. To group
consumers with similar characteristics, we clustered the participants of the study using k-means
clustering based on the information from the questionnaires and the electricity consumption data.
In particular, we used the consumption profiles of Tuesdays, because Tuesday is the most average
work day. Here, Class 1 represents consumers consuming most of their electricity during the day,
whereas Class 2 represents consumers having a stable consumption during the day, but have a higher
consumption at night. Based on these classes, cooperatives with varying compositions can be simulated. The parameter p fracAgent defines the composition of the cooperative by specifying the
fraction of agents from Class 1 (and Class 2 by 1  p f racAgent).
6.2.2 G ENERATING THE N OMINAL D EMAND OF AGENTS :
An agents nominal demand is the value around which the agent can vary its demand. We simulate
scenarios with M  {12, 24, 48} time slots and use time intervals of 30, 60 and 120 minutes, which
we generate by interpolating and averaging the data points from the two data sets. Then, j = 1
represents the first and j = M the last time slot of the day. To get different agents, the nominal
demand for each agent and time slot is the outcome xij of the random variable XCj . Let y Cj be

the mean of the average demands of all participants in class C in time slot j and let s y Cj be the
corrected sample standard deviationof their average
 demands. Thenominal demand is drawn from
the uniform distribution XCj  U y Cj  s y Cj , y Cj + s y Cj . The distributions of XCj for
the two Classes
are shown in Figure 7. The total demand of an agent for the whole day, is computed
P
x
by i = M
j=1 ij .
6.2.3 M ODELING THE F LEXIBILITY OF C ONSUMERS :
Agents can have different flexibilities of changing their demand profiles. Here, this ability is expressed through the agents upper and lower bound constraints on their electricity demand in each
time slot. The parameter p flexShift defines the flexibility of the agents by specifying the percentage, by which agents can vary their demands above and below their nominal demand. Thus, the
larger p f lexShif t, the further apart are the upper and lower bounds. The parameter is the same
for all agents and fixed for one scenario. Based on the flexibility and the nominal demand, the upper
and lower bounds can be computed as
rij = xij (1  p f lexShif t)
rij = xij (1 + p f lexShif t)

(16)

6.2.4 M ODELING THE E LECTRICITY P RICE :
The cooperatives electricity price function in each time slot is defined by the marginal price for the
H
low load, pL
j , and for the high load, pj , and the price threshold, hj , specifying at which demand
levels the marginal prices apply. We use the prices from the EEX data set as exemplar prices to
H
generate pL
j and pj . Let mpj be the average spot market price from EPEX Spot in time slot j. We
910

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

14

14
exemplary
nominal
demand

10

12

electricity demand (kW)

electricity demand (kW)

12

distribution
of nominal
demand

8

6

4

10

2

0

8

6

4

2

0

2

4

6

8

10

12

14

16

18

20

22

0

24

0

2

4

6

time slot

8

10

12

14

16

18

20

22

24

time slot

(a) Class 1 - day consumer

(b) Class 2 - night consumer

Figure 7: Distributions of the nominal demand for the two different consumer classes.
compute the marginal electricity prices as
pL
j = mpj
pH
j = mpj +

max

x{1,...,M }

{mpx } 

min

x{1,...,M }

(17)

{mpx }

We keep these marginal prices fixed across all simulations. However, the price thresholds may
vary across the different simulation scenarios. For example, the price threshold could be above
the aggregated nominal demand so that the demand can be increased or it could be below so that
the demand should be reduced. The parameter p distThresh defines the distance between the
aggregated nominal demand and the price thresholds by specifying the percentage the thresholds
are above or below the aggregated nominal demand. With a negative value of p distT hresh, the
thresholds lie below and with a positive value they lie above the aggregated nominal demand. For
each scenario there is only one fixed value for all time slots. Figure 8a illustrates scenarios that have
different values of p distT hresh. In addition, the price thresholds could either be different in each
time slot (e.g., following the profile of the aggregated nominal demand) or could be the same for
each time slot (flat thresholds). Here, we compute flat thresholds by defining them as the moving
average of the aggregated nominal demand. The parameter p flatThresh defines the flatness of
the threshold by specifying the width of the interval over which the thresholds are flattened by a
moving average. For p f latT hresh = 0 the thresholds follow exactly the aggregated nominal
demand, whereas for p f latT hresh = M the thresholds are the same in every time slot. Figure 8b
illustrates scenarios with different values p f latT hresh. The thresholds are computed by
1
hj =
1 + 2p f latT hresh

j+p f latT
X hresh
jp f latT hresh

!
(1 + p distT hresh)

X

xij

(18)

i

6.2.5 S IMULATION S CENARIOS :
To create different scenarios, we vary the input parameters as follows: p f racAgent  {0, 0.25, 0.5,
0.75, 1}, p f lexShif t  {0.1, 0.2, 0.3}, p f latT hresh  {0, 12, 24}, p distT hresh  {0.2,
911

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

500

500
values for
p_distThresh
0.2

400

0
0.1

300

0.2

200

100

0

0

400

0.1

aggregated demand (kW)

aggregated demand (kW)

values for
p_flatThresh

6
24

300

200

100

0

2

4

6

8

10

12

14

16

18

20

22

0

24

time slot

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Price thresholds for different values of p distT hresh. (b) Price thresholds for different values of p f latT hresh.

Figure 8: Price thresholds for different values of the parameters p distT hresh and p f latT hresh.

0.1, 0, 0.1, 0.2}, #agents  {20, 40, 60, 80, 100}, M  {12, 24, 48} and   {0.5, 1, 2}. This
leads to 3375 different scenarios. We define the algorithm to be converged, when the cost reduction
in one iteration gets less than 0.00001%, i.e., C (R) / C (R0 ) < 1.0000001.
6.3 Simulation Results
We first present the effects of the different parameters on the cost reduction through the algorithm
and subsequently discuss the convergence time.
Definition 3. The cost reduction is the difference between the cost of the uncoordinated profile C0
(chosen by each agent when optimizing its cost according to the market price) and the
coordinated

profile C as a percentage of the cost of the uncoordinated profile, i.e., CR = C0C0C  100.
Figure 9 shows a subset of the results for p f racAgent  {0, 0.5, 1}, M = 24, #agents = 40
and  = 1. Figure 9a shows the cost reduction in cooperatives only consisting of consumers mainly
consuming electricity at night. Figure 9b shows the cost reductions in cooperatives that consist of
both consumer classes in equal proportions. Finally, Figure 9c shows the cost reductions in cooperatives consisting of only consumers with their main demand during the day. The x-axis represents
the flexibility of shifting demand, the y-axis the flatness of the thresholds and the z-axis the height
of the thresholds. In all figures are scenarios with high cost reduction (white) and scenarios with
less cost reduction (dark red). Over all scenarios, we observed a mean cost reduction of 2.57%,
with results varying from 0% to 7.44%. However, the sampled cases represent all combinations
of the input parameters and we cannot say how realistic individual settings are. For example, in
many scenarios no optimization is possible and we put in a cost reduction of 0%. No optimization
is possible, if the price threshold provided by the supplier is higher than the sum of the agents upper
bound constraints or if the price threshold is lower than the sum of the lower bound constraints. Not
taking into account those scenarios, we observe a mean of 2.96%. Moreover, looking at the cost
reduction from the initial nominal demand profile, we get a mean of 3.7%, with results up to 11.1%.
912

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

0.2

0.07

0.07

0.06

0.06

0.2

0.05

0.05

0.03
0.1

0.1
0.04

0
0.03
0.1

0.3

p_flexShift

0

12

0.01
0.1

24
0

p_flatThresh

0.02
0.2

0.01
0.2

0.03

0.02
0.2

0.1

0.04
0

0.1

0.02
0.2

p_distThresh

0.04

p_distThresh

0.1

0

0.06

0.2

0.05

0.1

p_distThresh

0.07

0.2
0.3

0

12

0

p_flatThresh

p_flexShift

0.01
0.1

24

0.2
0.3

p_flexShift

0

12

24
0

p_flatThresh

(a) Only consumers who mainly con-(b) Consumers from both classes have(c) Only consumers who mainly consume at night, p f racAgent = 0.
equal fractions, p f racAgent = 0.5 sume during day, p f racAgent = 1.

Figure 9: The cost reduction through the algorithm as a function of the four input parameters:
p f racAgent, p f latT hresh, p distT hresh and p f lexShif t. Scenarios with high cost reduction are white and scenarios with less cost reduction are dark red.
6.3.1 S ENSITIVITY A NALYSIS
The purpose of this sensitivity analysis is to understand the effect of the different input parameters
on the cost reduction through our algorithm. For the sensitivity analysis we perform a multiple
linear regression. As dependent variable (criterion) we choose the cost reduction (Definition 3). As
independent variables (predictors) we choose the smallest interpretable model that provides a good
adjusted R-squared. The resulting model is shown in Table 2. The model explains 76.36% of the
variance with an adjusted R-squared of 0.7571. The remaining variance cannot be explained by the
model, because the agents demand constraints are generated randomly.
predictors
p f racAgent
p f latT hresh
p f lexShif t
|p distT hresh|
p distT hresh  p f lexShif t
p f racAgent  p f latT hresh

coefficient
0.0019
0.0077
0.0114
-0.0072
0.0018
-0.0016

stand. error
0.0011
0.0017
0.0010
0.0008
0.0002
0.0005

p-value
0.0910
1.66E-05
1.35E-25
2.08E-16
6.67E-17
0.0035

Table 2: Multiple linear regression model; adjusted R2 = 0.7571
Result 1: As agents flexibility of shifting their demands increases, cost reduction increases, i.e.,
p f lexShif t %  G %.
The multiple linear regression model summarized in Table 2 shows that the effect of p f lexShif t
is highly significant with p < 0.01. The positive value of the coefficient (0.0114) shows that an
increase of the flexibility leads to increased cost reduction.
Intuitively, with higher flexibility, more demand from time slots with high prices can be shifted
to those with lower prices. Consequently, higher cost reduction can be achieved. For example, if
p f lexShif t = 0, no demand can be shifted and no cost reduced. However, another reason for the
high cost reduction is that the uncoordinated profile before the algorithm has higher cost. Recall
that for the uncoordinated demand profile the agents optimize their demand according to the hourly
913

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

550

550

500

500

450

aggregated
nominal demand

400

aggregated
optimal demand

aggregated demand (kW)

aggregated demand (kW)

price thresholds

350
300
250
200
150
100

450
400
350
300
250
200
150

0

2

4

6

8

10

12

14

16

18

20

22

100

24

time slot

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Lower flexibility, p f lexShif t = 0.1.

(b) Higher flexibility, p f lexShif t = 0.3.

Figure 10: Example scenarios with different flexibilities for the agents of shifting their demands.

market prices. Consequently, the higher the agents flexibility, the more they adapt their demand
schedules to the hourly prices. However, since not being coordinated, all agents shift as much
demand as possible to cheap time slots. This leads to load synchronization, so that the total demand
in the former cheap slots exceeds the thresholds, leading to higher costs (herding behavior). Thus,
high flexibility of uncoordinated consumers leads to highly synchronized demand. These high initial
costs allow for more cost reduction through the algorithm. Figure 10 illustrates settings with low
(p f lexShif t = 0.1) and high (p f lexShif t = 0.3) flexibility. The figure shows clearly that the
initial demand peak is higher in the scenario with more flexibility. Recall from Figure 6 that slots
14, 15, 16 and 17 are relatively low priced slots with 17 being the lowest. The area between the
red dashed curve of the uncoordinated demand profile and the coordinated demand profile in gray
multiplied by the respective marginal prices shows the cost reduction through coordination. With
the increasing freedom in Figure 10b it can be seen that the area between the two curves increases.
The reason the height of the peak stays the same, is that at first the agents shift as much demand
as possible from time slots with aggregated demands above the thresholds (peaks) to time slots
with demand levels below the thresholds. When all agents reach their upper bounds in those time
slots, they shift the remaining demand to the time slots with the lowest prices above the threshold.
According to the hourly prices, the cheapest remaining time slot is 17. Since the freedom allows
demanding most of the remaining electricity in that time slot, the height of the peak does not change.
Result 2: As the absolute distance of the demand thresholds to the aggregated load profile
decreases, cost reduction increases, i.e., |p distT hresh| &  G %.
The multiple linear regression model summarized in Table 2 shows that the effect of |p distT hresh|
is highly significant with p < 0.01. The negative coefficient (-0.0072) shows that the further away
the thresholds are from the aggregated load profile the less cost reduction can be achieved.
Figure 11 illustrates settings with low (p distT hresh = 0.2), normal (p distT hresh = 0)
and high (p distT hresh = 0.2) thresholds. The cost reduction is limited by how much the agents
can decrease demand above and increase below the thresholds. The demand above the thresholds
is represented by the area between the initial demand profile (red dashed line) and the thresholds
(yellow flat line) above the thresholds, and the unused demand below the thresholds by the area
between the two lines below the thresholds. These amounts are also affected by the flatness of
914

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

550

550

500

500

500

400

aggregated
nominal demand

350

aggregated
optimal demand

aggregated demand (kW)

aggregated demand (kW)

price thresholds

450

450

450

400

400

350

300

350

300

250

300

250

200

250

200

150
100

aggregated demand (kW)

550

200

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Thresholds below the average load,(b) Thresholds at the average load,(c) Thresholds above the average load,
p distT hresh = 0.2.
p distT hresh = 0.
p distT hresh = 0.2.

Figure 11: Example scenarios with different heights of the price thresholds.

the thresholds, i.e., the flatter the thresholds, the larger the two areas become. Thus, with flatter
thresholds the cost reduction increases as well. The regression model supports this, because the
parameter p f latT hresh has a positive coefficient (0.0077) and is highly significant with p < 0.01.
However, the cost reduction in the scenario with high thresholds in Figure 11c is greater than
in the case of normal thresholds in Figure 11b. That happens, because the flexibility of shifting
demand is a limiting factor. Since the absolute distance between the upper and lower bounds is
smaller in time slots with low demand, the demand hits the upper bounds in those time slots before
it reaches the lower bounds in the time slots with high demand. In this situation, an increment
of the thresholds leads to more time slots below the thresholds and thus more possibilities to shift
demand. Consequently, if the flexibility is a limiting factor, the cost reduction increases, if the
thresholds are slightly increased. This is supported by the regression model, because the interaction
term p distT hresh  p f lexShif t is highly significant with p < 0.01.
Result 3: We observe similar cost reductions in groups with mostly consumers from one class
and groups with agents from both classes in similar fractions.
The multiple linear regression model in Table 2 shows that the parameter p f racAgent is not a
significant predictor for the cost reduction with p > 0.05. This supports the observation that we can
see cost reductions from the coordinated behavior in each of the two classes (day consumers and
night consumers) as well as mixed groups. Figure 12 illustrates settings with only night consumers
(Figure 12a), a mixed group (Figure 12b), and only day consumers (Figure 12c). However, in these
examples, with an increasing fraction of day consumers, the cost reduction decreases to a larger
extent than indicated by the parameter p f racAgent in the regression model. This effect is due to
an interaction effect between the composition of the cooperative and the flatness of the thresholds.
The multiple linear regression model shows that the interaction term p f racAgent  p f latT hresh
is a significant predictor with p < 0.01. The negative value of the coefficient (-5.219e-04) shows
that as the flatness of the thresholds increases and the fraction of day consumers also increases,
cost reduction decreases. In Figure 12 it can be seen that the thresholds are lying outside of the
agents demand bounds in many time slots, because the thresholds are the same in each time slot. In
this situation not the thresholds, but the demand bounds limit the potential cost reduction through
coordination. Consequently, as the thresholds get flatter, they get out of reach of the agents demand
bounds. Since the load profiles of day consumers have a more significant difference between peak
and low load, this effect is stronger for groups with a larger fraction of day consumers.
915

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

650

600

600

price thresholds

500

aggregated
nominal demand

aggregated demand (kW)

550

450

550

500

450

450

400

350

400

350

300

350

300

250

300

250

200

250

200

150
100

550

500

aggregated
optimal demand

400

aggregated demand (kW)

650

600

aggregated demand (kW)

650

200

150
0

2

4

6

8

10

12

14

time slot

16

18

20

22

24

100

150
0

2

4

6

8

10

12

14

16

18

20

time slot

22

24

100

0

2

4

6

8

10

12

14

16

18

20

22

24

time slot

(a) Only consumers who mainly con-(b) Consumers from both classes have(c) Only consumers mainly consuming
sume at night, p f racAgent = 0.
equal fractions, p f racAgent = 0.5. during the day, p f racAgent = 1.

Figure 12: Example scenarios with different compositions of the consumer cooperative.
6.3.2 C ONVERGENCE P ROPERTIES OF THE A LGORITHM
Let the first iteration be the submission of the agents uncoordinated initial demand profiles. Then,
in the second iteration the coordinator sends the first virtual price signals to the agents. Recall
that in the beginning the basic algorithm is performed and after the basic algorithm converged, the
additional phase is started, if necessary. Also recall that we defined the algorithm to have converged,
when the cost reduction in one iteration gets less than 0.00001%, i.e., C (R) / C (R0 ) < 1.0000001.
In our simulations, the basic algorithm converges in average within 9.57 iterations. In the cases that
need the additional phase, the general algorithm converges in average in additional 35.10 iterations.
The experiment was setup using one HP Pavilion dmt4-1000 with an Intel Core i5 520M with
two cores operating at 2.4GHz and 8 Gigabyte of DDR3 physical memory. Using this setup, one
iteration of the basic algorithm took on average 25.12 seconds and one iteration of the extended
phase took on average 52.13 seconds. Looking at the agents demand profiles at convergence, we
observe that for each agent in average in 67.6% of the time slots the demand bounds are tight. In all
sampled scenarios, there is at least one time slot, where the demand bound is not tight, because the
agents have to satisfy their constant total demand over the whole planning horizon.
Definition 4. The convergence accuracy is the difference between the cost of the converged solution
and the optimal solution as percentage of the difference between the cost of the uncoordinated profile
T )C(R )
and the optimal solution, i.e., C(R
 100.
C(R1 )C(R )
Result 4: In our simulations, the basic algorithm achieves the optimal solution in 44.9% of all
sampled scenarios.
We found that in 44.9% of all sampled cases the basic algorithm achieves the optimal solution. In
the remaining scenarios the basic algorithm comes in average 1.06% close to the optimal solution.
This indicates that in most cases the basic algorithm can provide good results.
Result 5: Our simulations indicate that larger step sizes, , lead to faster convergence at the
cost of small reductions in accuracy.
The parameter  defines the step size of the extended phase. Intuitively, larger steps lead to a faster
convergence, at a cost of reduced accuracy. Table 3 shows the convergence accuracy and the average
number of iterations until convergence for varying   {0.5, 1, 2}. The number of agents and time
slots are fixed as N = 40 and M = 24. The results indicate that as  increases, the number of
iterations until convergence as well as the accuracy decreases. However, the reduction in accuracy
is very small and the algorithm achieves good results for all . Our results indicate that in order
916

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

to achieve accurate solutions within few iterations, the step size should be adapted at run-time. In
particular, the value of  should be reduced over time.


Convergence accuracy

0.5
1
2

0.22%
0.33%
0.55%

Number of iterations
until convergence
36.5
26.1
17.9

Table 3: Convergence accuracy and time for varying step sizes
Result 6: Our simulations indicate that the convergence time scales linearly with the agent
population size and number of time slots.
To analyze the influence on the convergence time of the algorithm, we vary the number of agents
from 20 to 100 and time slots from 12 to 48. Table 4a shows the convergence accuracy and Table 4b
the number of iterations until convergence. The step size is fixed at  = 1. The results indicate that
the number of iterations until convergence increases linearly with the number of agents and time
slots. The accuracy does not change much, as we increase the agent population and time slots.
Ptime
P slots
agents PPPP

PP

20
40
60
80
100

12

24

48

0.21%
0.24%
0.23%
0.26%
0.25%

0.19%
0.29%
0.26%
0.26%
0.28%

0.18%
0.20%
0.28%
0.30%
0.38%

(a) Convergence accuracy

Ptime
P slots
agents PPPP
20
40
60
80
100

PP

12

24

48

9.8
12.4
13.5
15.2
16.9

16
20.1
23.7
27.1
28.2

22.4
30.2
35.4
40.3
43.2

(b) Number of iterations until convergece

Table 4: Convergence accuracy and time for varying number of agents and time slots

7. Conclusion and Future Work
In this paper, we presented an iterative coordination algorithm to minimize the energy cost of a
consumer cooperative, given that information about the agents individual demand constraints and
preferences remains private. We proved that the algorithm converges to the optimal demand schedule and presented results on the time complexity of the iterative algorithm and the agents incentive
compatibility. Additionally, we conducted evaluations on the algorithm using multiagent simulation based on real world consumption data. Through simulations, we characterized the convergence
properties of our algorithm and the effect of differing demand characteristics in the cooperative and
price functions on the cost reduction through our algorithm. The results show that the convergence
time scales linearly with the population size and length of the optimization horizon. Finally, we observe that as participants flexibility of shifting their demands increases, cost reduction increases and
that the cost reduction is not very sensitive to variation in consumption patterns of the consumers.
This work can be extended in several directions. Future work can investigate settings in which
the agents might not be able to compute a guaranteed optimal solution of their individual problem,
but only a provably good approximation. This could apply to settings with more detailed load
917

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

models for the agents. The overall demand can come from two types of loads: shiftable loads
and non-shiftable loads. These loads can be divided further into interruptible and non-interruptible
loads. In addition, these loads can be subject to temporal constraints. This can lead to the situation
where the individual problems for the agents are no longer convex, and thus no agent can solve its
individual problem optimally. Luo, Chakraborty, and Sycara (2013) present a distributed iterative
algorithm for the generalized task assignment problem in the context of a multirobot system (MRGAP). Based on the (approximate) best responses from the agents, this algorithm has a provable
approximate ratio. It would be interesting to investigate such a distributed algorithm in the context
of this problem.
In this paper, the demand of the cooperative in each time slot solely consists of the aggregated
demand of the agents. Future work can consider problems with generation and/ or storage (that can
be centralized, i.e., owned by the cooperative, or distributed, i.e., owned by an individual agent).
Another avenue of future work is to consider a problem formulation where the cooperative faces
uncertainty in electricity prices. For example, consider a 24-hour planning horizon and instead of
a long term contract the electricity is bought from an hourly spot market. Here, for scheduling
demand, one only knows the price for the next hour and the prices for the future hourly time slots
are uncertain. The spot market electricity price depends on many factors that are not controlled
by the coordinator. Hence, for planning purposes, the prices can be assumed to be an externally
specified stochastic process. Under this assumption, the goal would be to design algorithms for (1)
determining policies (for generation, storage, and price signals to be sent to the firms) for the central
coordinator and (2) determine the schedules for the individual firms, such that the expected cost of
buying electricity is minimized.

Acknowledgements
This work was partially supported by NSF award IIS-1218542.

Appendix A. Proof: Virtual Cost is an Upper Bound on the Total Cost
Proof. Here, we give the full proof showing that the sum of the agents individual cost according to
their virtual price signals is an upper bound on the total central cost at market prices. We prove this,
by showing with Equations 1 and 7 that for every time slot j the difference between the total cost
for the aggregated demand and the sum of the agents individual cost is lower or equal to 0. Since it
is true for every time slot, it is also true for the sum over all time slots.
The central cost for the aggregated demand is given in Equation 1 as
N
X

 0
pj 0j rij
, j

i=1

+

0
= pH
0j  hj + pL
+ pL
j
j j  hj
j hj
(

H
0
L
0
pj j  hj + pj hj j > hj

=
0
L
0j  hj
pL
j j  hj + pj hj
(P
 PN

N
0
pH
rij
 hij + i=1 pL
j
j hij

P
= Pi=1
N
N
L
0
+ i=1 pL
j hij
i=1 pj rij  hij
918

0j > hj
0j  hj

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

The sum of the agents individual cost is given in Equation 7 as
N
X

 0
0
sij rij
rij , j

i=1

=

N h
X

0
pH
rij
 hij
j

+

0
+ pL
j rij  hij



+ pL
j hij

i

i=1

For the difference of the two costs we get:
N
X

N
X
 0
 0
0
pj 0j rij

sij rij
rij , j

i=1

i=1
P
i
h

+

N
L
0
L
0
H
L
0
H

h

h

p
r

h

p
r
h

p

h
+
p
r
p
ij
ij
ij
j ij
ij
j
ij
j
j ij
ij
j
i=1
i
= PN h

+

L
0
L
H
0
L
0
L

rij  hij  pj rij  hij  pj hij
i=1 pj rij  hij + pj hij  pj

Since

PN 
i=1

0j  hj


PN  L 
pL
h
and

ij
j
i=1 pj hij equal each other out they and can be removed.

P
h


 i
 N pH r0  hij  pH r0  hij +  pL r0  hij 
j
ij
j
ij
j
ij
i=1
= PN h

+
 i
L
0
H
0
L
0

p
r

h

p
r

h

p
r
ij
ij
j
ij
j
ij
j
ij  hij
i=1

Lets now write
P
analog as N
i: r0

0j > hj
0j  hj



+


PN L  0
PN
H r0  h
H r0  h
p
r

h
p
p
and
as
0
ij
ij
ij
ij
ij
ij
i=1 j
i=1 j
i: rij >hij j


PN
PN
PN
H
0
rij  hij . Lets also write i=1 as i: r0 >hij + i: r0 hij .
hij pj

PN

ij

=

0j > hj

ij

ij

 N
N


 H 0


P  H 0
P

H
0
L
0


i: r0 >h pj rij  hij  pj rij  hij + i: r0 h pj rij  hij  pj rij  hij
ij






i:

ij

N
P
0 >h
rij
ij

ij

i:

For 0j > hj the terms

PN
i:

0 h
rij
pH
ij
j

=

i: r 0 h
PN ij ij
0 >h
i: rij
ij



0
L
0
pL
j rij  hij  pj rij  hij



other out and can be removed. For 0j  hj remove
(PN



0 h
rij
ij



0 >h
rij
ij

ij

N
P

 L 0


0
pj rij  hij  pH
rij
 hij +
j

0
i: rij

PN

0 >h
rij
ij

 H 0


0
pj rij  hij  pL
j rij  hij


 L 0
0
pj rij  hij  pH
rij
 hij
j

0j > hj
0j  hj

0j > hj


H
0
pL
rij
 hij
0j  hj
j  pj
(P
 0

N
H
L
0j > hj
i=1 pj  pj  rij  hij 
= PN
+
L
H
0
rij
 hij
0j  hj
i=1 pj  pj
h P
i



N
H
L
0

rij
 hij
 0 0j > hj
i=1 pj  pj
h
i
=


P
+
N
L
H
0

rij
 hij
 0 0j  hj
i=1 pj  pj
=

i: r 0 h
PN ij ij
0 >h
i: rij
ij

L
pH
j  pj



919

0j  hj



H r0  h
p
ij equal each
ij
j
i:


L
0
hij pj rij  hij respectively.

and 
PN





L and pL  pH out.
Factor pH

p
j
j
j
j
(PN

0j > hj

0
rij
 hij



fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

Since this inequality is true for every time slot, it also holds for the sum over all time slots. It follows
that the sum of the agents individual cost according to their virtual price signals is an upper bound
P
0
on the total central cost at market prices, C (R0 )  N
i=1 Ci (ri ):
N X
M
X

N X
M
X
 0
 0
0
pj 0j rij
+ gi (r0i ) 
sij rij
rij + gi (r0i )

i=1 j=1

i=1 j=1

Appendix B. Proof by Counterexample: Basic Algorithm Can Converge to a
Suboptimal Solution in Case of gi () 6= 0
We present a counterexample to prove that the basic algorithm can converge to a suboptimal solution
in general settings with gi () 6= 0. Consider a population of 2 agents, N = 2, and a planning
horizon of 2 time slots, M = 2. The agents constraints are such that in the converged solution, the
aggregated demand is equal to the threshold in one time slot. Let the price function be given as:
H
L H
(pL
1 , p1 ) = (3, 8), h1 = 9 ; (p2 , p2 ) = (3, 8), h2 = 11

The individual constraints on the agents demand are:
r11  [1, 3], r12  [4, 6], r11 + r12 = 1 = 7
r21  [4, 6], r22  [4, 6], r21 + r22 = 2 = 10

The agents individual cost associated with the demand schedule is given as:

g1 (r1 ) = r1

5
1




, g2 (r2 ) = r2

6
3



(1)

At the beginning, the agents compute their initial demand profiles based on the market prices r1 =

(1)
(1, 6), r2 = (4, 6). The cost based on these demand profiles is C R(1) = 109.
(T )

(T )

At convergence, the final profiles of the twoagents are r1 = (1.5, 5.5), r2 = (4.5, 5.5). The
cost based on these demand profiles is C R(T ) = 107.5.
However a different demand profile of the agents exists with r01 = (1, 6), r02 = (5, 5). This
profile is feasible and leads to lower total cost, i.e., C (R0 ) = 107. It follows that the algorithm has
stopped in a suboptimal solution.

References
Albadi, M., & El-Saadany, E. (2007). Demand response in electricity markets: An overview. In
Power Engineering Society General Meeting, 2007. IEEE, pp. 15. IEEE.
Atzeni, I., Ordonez, L., Scutari, G., Palomar, D., & Fonollosa, J. (2013). Demand-side management
via distributed energy generation and storage optimization. IEEE Transactions on Smart Grid,
4(2), 866876.
Ausubel, L. M., & Milgrom, P. (2006). The lovely but lonely vickrey auction. Combinatorial
auctions, 1740.
Barbose, G., Goldman, C., & Neenan, B. (2004). A survey of utility experience with real time
pricing. Tech. rep., Ernest Orlando Lawrence Berkeley National Laboratory, Berkeley, CA,
USA.
920

fiM ULTIAGENT C OORDINATION FOR D EMAND S IDE E NERGY M ANAGEMENT

Bertsekas, D. P., & Tsitsiklis, J. N. (1989). Parallel and distributed computation: numerical methods. Prentice-Hall, Inc., Upper Saddle River, NJ, USA.
Boyd, S., & Vandenberghe, L. (2004). Convex optimization. Cambridge university press.
Chu, C., & Jong, T. (2008). A novel direct air-conditioning load control method. IEEE Transactions
on Power Systems, 23(3), 13561363.
Clement-Nyns, K., Haesen, E., & Driesen, J. (2010). The impact of charging plug-in hybrid electric
vehicles on a residential distribution grid. IEEE Transactions on Power Systems, 25(1), 371
380.
Dietrich, K., Latorre, J., Olmos, L., & Ramos, A. (2012). Demand response in an isolated system
with high wind integration. IEEE Transactions on Power Systems, 27(1), 2029.
Green, J., & Laffont, J.-J. (1977). Characterization of satisfactory mechanisms for the revelation of
preferences for public goods. Econometrica: Journal of the Econometric Society, 427438.
Hurwicz, L. (1975). On the existence of allocation systems whose manipulative nash equilibria are
pareto-optimal. In 3rd World Congress of the Econometric Society.
Jellings, C. W., & Chamberlin, J. H. (1993). Demand Side Management: Concepts and Methods.
PennWell Books, Tulsa, OK, USA.
Kirschen, D. (2003). Demand-side view of electricity markets. IEEE Transactions on Power Systems, 18(2), 520527.
Luo, L., Chakraborty, N., & Sycara, K. (2013). Distributed algorithm design for multi-robot generalized task assignment. In Proceedings of IEEE International Conference on Intelligent
Robots and Systems.
Medina, J., Muller, N., & Roytelman, I. (2010). Demand response and distribution grid operations:
Opportunities and challenges. IEEE Transactions on Smart Grid, 1(2), 193198.
Mohsenian-Rad, A., Wong, V., Jatskevich, J., Schober, R., & Leon-Garcia, A. (2010). Autonomous
demand-side management based on game-theoretic energy consumption scheduling for the
future smart grid. IEEE Transactions on Smart Grid, 1(3), 320331.
Mohsenian-Rad, A., & Leon-Garcia, A. (2010). Optimal residential load control with price prediction in real-time electricity pricing environments. IEEE Transactions on Smart Grid, 1(2),
120133.
Nguyen, H. K., Song, J. B., & Han, Z. (2012). Demand side management to reduce peak-to-average
ratio using game theory in smart grid. In IEEE Conference on Computer Communications
Workshops (INFOCOM WKSHPS), pp. 9196. IEEE.
Palensky, P., & Dietrich, D. (2011). Demand side management: Demand response, intelligent energy
systems, and smart loads. IEEE Transactions on Industrial Informatics, 7(3), 381388.
Pedrasa, M., Spooner, T., & MacGill, I. (2010). Coordinated scheduling of residential distributed
energy resources to optimize smart home energy services. IEEE Transactions on Smart Grid,
1(2), 134143.
Philpott, A., & Pettersen, E. (2006). Optimizing demand-side bids in day-ahead electricity markets.
IEEE Transactions on Power Systems, 21(2), 488498.
Rahimi, F., & Ipakchi, A. (2010). Demand response as a market resource under the smart grid
paradigm. IEEE Transactions on Smart Grid, 1(1), 8288.
921

fiV EIT, X U , Z HENG , C HAKRABORTY, & S YCARA

Ramchurn, S., Vytelingum, P., Rogers, A., & Jennings, N. (2012). Putting the smarts into the
smart grid: A grand challenge for artificial intelligence. Communications of the ACM, 55(4),
8697.
Ramchurn, S. D., Vytelingum, P., Rogers, A., & Jennings, N. (2011). Agent-based control for decentralised demand side management in the smart grid. In The 10th International Conference
on Autonomous Agents and Multiagent Systems-Volume 1, pp. 512.
Samadi, P., Mohsenian-Rad, H., Wong, V., & Schober, R. (2013). Tackling the load uncertainty
challenges for energy consumption scheduling in smart grid. IEEE Transactions on Smart
Grid, 4(2), 10071016.
Tanaka, K., Uchida, K., Ogimi, K., Goya, T., Yona, A., Senjy, T., Funabashi, T., & Kim, C. (2011).
Optimal operation by controllable loads based on smart grid topology considering insolation
forecasted error. IEEE Transactions on Smart Grid, 2(3), 438444.
Veit, A., Xu, Y., Zheng, R., Chakraborty, N., & Sycara, K. (2013). Multiagent coordination for energy consumption scheduling in consumer cooperatives. In Proceedings of 27th AAAI Conference on Artificial Intelligence, pp. 13621368.
Voice, T., Vytelingum, P., Ramchurn, S., Rogers, A., & Jennings, N. (2011). Decentralised control
of micro-storage in the smart grid. In Proceedings of 25th AAAI Conference on Artificial
Intelligence, pp. 14211427.
Vytelingum, P., Ramchurn, S., Rogers, A., & Jennings, N. (2010). Agent-based homeostatic control
for green energy in the smart grid. In First International Workshop on Agent Technologies for
Energy Systems (ATES 2010).
Vytelingum, P., Voice, T., Ramchurn, S., Rogers, A., & Jennings, N. (2011). Theoretical and practical foundations of large-scale agent-based micro-storage in the smart grid. Journal of Artificial Intelligence Research, 42(1), 765813.
Wood, A., & Wollenberg, B. (1996). Power Generation Operation and Control. John Wiley & Sons.
Wu, C., Mohsenian-Rad, H., & Huang, J. (2012). Wind power integration via aggregator-consumer
coordination: A game theoretic approach. In Innovative Smart Grid Technologies (ISGT),
2012 IEEE PES, pp. 16. IEEE.

922

fi