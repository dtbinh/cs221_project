journal of artificial intelligence research                 

submitted       published      

vision based road detection in automotive systems 
a real time expectation driven approach
alberto broggi
simona berte

dipartimento di ingegneria dell informazione
universita di parma
viale delle scienze
i       parma  italy

broggi ce unipr it
simona ce unipr it

abstract

the main aim of this work is the development of a vision based road detection system
fast enough to cope with the dicult real time constraints imposed by moving vehicle
applications  the hardware platform  a special purpose massively parallel system  has
been chosen to minimize system production and operational costs 
this paper presents a novel approach to expectation driven low level image segmentation  which can be mapped naturally onto mesh connected massively parallel simd architectures capable of handling hierarchical data structures  the input image is assumed to
contain a distorted version of a given template  a multiresolution stretching process is used
to reshape the original template in accordance with the acquired image content  minimizing
a potential function  the distorted template is the process output 

   introduction
the work discussed in this paper forms part of the eureka prometheus activities  aimed at
improved road trac safety  since the processing of images is of fundamental importance
in automotive applications  our current work has been aimed at the development of an
embedded low cost computer vision system  due to the special field of application  the
vision system must be able to process data and produce results in real time  it is therefore
necessary to consider data structures  processing techniques  and computer architectures
capable of reducing the response time of the system as a whole 
the system considered is currently integrated on the mob lab land vehicle  adorni 
broggi  conte    d andrea         the mobile laboratory  the result of italian work
within the prometheus project  see figure   a   comprises a camera for the acquisition
and digitization of images  which pipelines data to an on board massively parallel computer
for processing  as illustrated in figure    the current output configuration comprises a set
of warnings to the driver  displayed by means of a set of leds on a control panel  shown in
figure   b   but  due to the high performance levels achieved  it will be possible to replace
this output device with a heads up display showing the enhanced features superimposed
onto the original image 
this paper presents a move toward the use of top down control  the following feature
extraction mechanism is based on a model driven approach   instead of the traditional datadriven approach  which is generally used for data parallel algorithms 

c      ai access foundation and morgan kaufmann publishers  all rights reserved 

fialberto broggi  simona berte

figure     a  the mob lab land vehicle   b  the control panel used as output to display
the processing results

heads up
display

 a 

led based
control panel

 b 

road detection
system
camera

input

processing

output

figure    block diagram of the complete system   a  planned heads up display output and
 b  current led based output
starting from the experience gained in the development of a different approach  broggi 
    c  based on the parallel detection of image edges pointing to the focus of expansion 
this work presents a model driven low level processing technique aimed at road detection and
enhancement of the road  or lane  image acquired from a moving vehicle  the model which
contains a priori knowledge of the feature to be extracted  road or lane  is encoded in the
traditional data structure handled in low level processing  a two dimensional array  in this
case  a binary image representing two different regions  road and off road  has been chosen 
hereinafter this image will be referred to as synthetic image  it is obvious that different
synthetic images must be used according to different acquisition conditions  camera position 
orientation  optics  etc   which are fixed  and environment  number of lanes  one way or two
way trac  etc   which may change at run time   in the final system implementation some
   

fivision based road detection

a priori world knowledge enables the correct synthetic model selection  as an example 
figure   presents several different synthetic images for different conditions 

 a 

 b 

figure    synthetic images used as road models for   a  different camera positions and or
orientations  b  different number of lanes  assuming driving on the right 
the following section presents a survey of vision based lane detection systems  section
  explains the choice of the multiresolution approach  section   presents the details of the
complete algorithm  section   discusses the performances of current implementation on
the paprica system  section   presents some results and a critical analysis of the approach
which leads to the present development  finally section   presents some concluding remarks 

   comparison with related systems
many different vision based road detection systems have been developed worldwide  each
relying on various characteristics such as different road models  two or three dimensional  
acquisition devices  color or monochromatic camera  using mono or stereo vision   hardware systems  special  or general purpose  serial or parallel   and computational techniques
 template matching  neural networks  etc   

 the scarf system  tested on the navlab vehicle at carnegie mellon university 

uses two color cameras for color based image segmentation  the different regions are
classified and grouped together to form larger areas  finally a hough like transform is
used to vote for different binary model candidates  due to the extremely high amount
of data to be processed  the two incoming color images            are reduced to
       pixel  nevertheless  a high performance computer architecture  a    cell
warp  crisman   webb        hamey  web    wu        annaratone  arnould 
t gross  h kung    j webb         has been chosen to speed up the processing  the
system  capable of detecting even unstructured roads  reaches a processing rate of
  hz  crisman   thorpe                    thorpe         in addition to its heavy
 
computational load  the main problems with this approach are found in the implicit
models assumed  if the road curves sharply or if it changes width  the assumed shape
model becomes invalid and detection fails  kluge   thorpe        
 the vits system  tested on the alv vehicle and developed at martin marietta  also
relies on two color cameras  it uses a combination of the red and blue color bands to
segment the image  in an effort to reduce the artifacts caused by shadows  information
on vehicle motion is also used to aid the segmentation process  tested successfully
   

fialberto broggi  simona berte

on straight  single lane roads  it runs faster than scarf  sacrificing general capability
for speed  turk  morgenthaler  gremban    marra        
 alvinn  tested on navlab  cmu  is a neural network based        video retina
designed  like scarf  to detect unstructured roads  but it does not have any road
model  it learns associations between visual patterns and steering wheel angles  without considering the road location  it has also been implemented on the warp system 
reaching a processing rate of about    hz  jochem  pomerleau    thorpe       
pomerleau              
 a different neural approach has been developed at cmu and tested on navlab 
a          color image is segmented on a   k processor maspar mp    maspar
computer corporation         a trapezoidal road model is used  but the road width
is assumed to be constant throughout the sequence  this means that although the
trapezoid may be skewed to the left or right  the top and bottom edges maintain a
constant length  the high performance offered by such a powerful hardware platform
is limited by its low i o bandwidth  therefore a simpler reduced version  processing
         images  has been implemented  working at a rate of     hz  jochem  
baluja        
due to the high amount of data    color images  and to the complex operations involved  segmentation  clustering  hough transform  etc   the system discussed  even if implemented on extremely powerful hardware machines  achieve a low processing rate  many
different methods have been considered to speed up the processing  including the processing
of monochromatic images and the use of windowing techniques  turk et al         to process
only the regions of interest  thus implementing a focus of attention mechanism  wolfe  
cave        neumann   stiehl        

 as an example  in vamors  developed at universitat der bundeswehr  munchen 

monochromatic images are processed by custom hardware  focusing only on the regions
of interest  graefe   kuhnert         the windowing techniques are supported by
strong road and vehicles models to predict features in incoming images  dickmans  
mysliwetz         in this case  the vehicle was driven at high speeds  up to     kph  on
german autobahns  which have constant lane width  and where the road has specific
shapes  straight  constant curvature  or clothoidal  the use of a single monochromatic
camera together with these simple road models allows a fast processing based on
simple edge detection  a match with a structured road model is then used to discard
anomalous edges  this approach is disturbed in shadow conditions  when the overall
illumination changes  or when road imperfections are found  kluge   thorpe        
 the lanelok system  developed at general motors  also relies on strong road models 
it estimates the location of lane boundaries with a curve fitting method  kenue  
bajpayee        kenue               using a quadratic equation model  in addition to
being disturbed by the presence of vehicles close to the road markings  lane detection
generally fails in shadow conditions  an extension for the correct interpretation of
shadows has therefore been introduced  kenue         unfortunately this technique
relies on fixed brightness thresholds which is far from being a robust and general
approach 
   

fivision based road detection

the main aim of the approach discussed in this paper  on the other hand  is to build
a low cost system capable of achieving real time performance in the detection of structured roads  with painted lane markings   and robust enough to tolerate severe illumination
changes such as shadows  limitation to the analysis of structured environments allows the
use of simple road models which  together with the processing of monocular monochromatic
images on special purpose hardware allows the achievement of low cost high performances 
the use of a high performance general purpose architecture  such as a    cell warp or a
  k maspar mp    as in the case of carnegie mellon s navlab   involves high costs which
are not compatible with widespread large scale use  it is for this reason that the execution
of low level computations  eciently performed by massively parallel systems  has usually
been implemented on general purpose processors  as in the case of vamors  the design
and implementation of special purpose application oriented architectures  like paprica 
broggi  conte  gregoretti  sansoe    reyneri               on the other hand  keep the
production costs down  while delivering very high performance levels  more generally  the
features that enable the integration of this architecture on a generic vehicle are 
 a  its low production cost 
 b  its low operational cost  and
 c  its small physical size 

    the computing architecture

additional considerations on power consumption show that mobile computing is moving
in the direction of massively parallel architectures comprising a large number of relatively
slow clocked processing elements  the power consumption of dynamic systems can be
considered proportional to cfv     where c represents the capacitance of the circuit  f is
the clock frequency  and v is the voltage swing  power can be saved in three different ways
 forman   zahorjan         by minimizing c   f   and v respectively 
 using a greater level of vlsi integration  thus reducing the capacitance c  
 trading computer speed  with a lower clock frequency f   for lower power consumption
 already implemented on many portable pcs  
 reducing the supply voltage vdd  
recently  new technological solutions have been exploited to reduce the ic supply voltage
from   v to     v  unfortunately  there is a speed penalty to pay for this reduction  for
a cmos gate  shoji         the device delay td  following a first order approximation  is
vdd     which shows that the reduction of vdd determines a quasiproportional to
 vdd   vt  
linear increment  until the device threshold value vt   of the circuit delay td   on the other
hand  the reduction of vdd determines a quadratic reduction of the power consumption 
thus  for power saving reasons  it is desirable to operate at the lowest possible speed  but  in
order to maintain the overall system performance  compensation for these increased delays
is required 
the use of a lower power supply voltage has been investigated and different architectural solutions have been considered so as to overcome the undesired side effects caused
by the reduction of vdd  courtois        chandrakasan  sheng    brodersen         the
   

fialberto broggi  simona berte

reduction of power consumption  while maintaining computational power  can be achieved
by using low cost simd computer architectures  comprising a large number of extremely
simple and relatively slow clocked processing elements  these systems  using slower device
speeds  provide an effective mechanism for trading power consumption for silicon area  while
maintaining the computational power unchanged  the   major drawbacks of this approach
are 

 a solution based on hardware replication increases the silicon area  and thus it is not

suitable for designs with extreme area constraints 
 parallelism must be accompanied by extra routing  requiring extra power  this issue
must be carefully considered and optimized 
 the use of parallel computer architectures involves the redesigning of the algorithms
with a different computational model 
 since the number of processing units must be high  if the system has size constraints
the processing elements must be extremely simple  performing only simple basic operations 

this paper investigates a novel approach to real time road following based on the use of
low cost massively parallel systems and data parallel algorithms 

   the multiresolution approach
the image encoding the model  synthetic image  and the image from the camera  natural
image  cannot be directly compared with local computations  because the latter contains
much more detail than the former  from all the known methods used to decrease the
presence of details  it is necessary to choose one that does not decrease the strength of the
feature to be extracted  for this purpose  a low pass filter  such as a      neighborhoodbased anisotropic average filter  would not only reduce the presence of details  but also the
sharpness of the road boundaries  rendering their detection more dicult  since the road
boundaries exploit a long distance correlation  a subsampling of both the natural and the
synthetic image would lead to a comparison which was less dependent on detail content 
more generally  it is much easier to detect large objects at a low resolution  where only
their main characteristics are present  than at a high resolution  where the details of the
specific represented object can make its detection more dicult  the complete recognition
and description process  on the other hand  can only take place at high resolutions  where
it is possible to detect even small details because of the preliminary results obtained at a
coarse resolution 
these considerations lead to the use of a pyramidal data structure  rosenfeld       
ballard   brown        tanimoto   kilger         comprising the same image at different
resolutions  many different architectures have been developed recently to support this computational paradigm  cantoni   ferretti        cantoni  ferretti    savini        fountain 
      cantoni   levialdi         where the computing architecture contains a number of
processing elements which is smaller than the number of image pixels and an external processor virtualization mechanism  broggi        is used  a useful side effect due to resolution
reduction is a decrease in the number of computations to be performed  thus  the choice
   

fioutput image

input image

synthetic image

vision based road detection

 

   
x
   

 

 

   
x
   

undersampling

 

   
x
   

 

 

 

average

   

 

  
x
  

 

  
x
  

   
x
   

 

 

 

average

   

undersampling

 
 

   
x
   

dbs

 

 

oversampling

 

undersampling

undersampling

 
 

 

 

 
 

   
x
   

 

 

oversampling

dbs

   

 

dbs

figure    block diagram of the whole algorithm  for each step the depth of every image is
shown  in bit pixel 
of a pyramidal computational paradigm  in addition to being supported by theory  offers
an advantage in terms of computational eciency 

   algorithm structure

as shown in figure    before each subsampling the natural image is filtered  in this way it is
possible to decrease both the inuence of noise and redundant details  and the distortion due
to aliasing  pratt        introduced by the subsampling process  the image is partitioned
into non overlapping square subsets of      pixels each  the filter comprises a simple average
of the pixels values for a given subset  which reduces the signal bandwidth  the set of
resulting values forms the subsampled image 
the stretching of the synthetic image is performed through an iterative algorithm
 driven binary stretching  dbs   a much simpler and morphological  haralick  sternberg 
  zhuang        serra        version of the  snake  technique  blake   yuille        cohen   cohen        cohen        kass  witkin    terzopolous         the result is then
oversampled  and further improved using the same dbs algorithm  until the original resolution is reached  the boundary of the stretched template represents the final result of the
process 

    the dbs filter

the purpose of the dbs filter  illustrated in figure    is to stretch the binary input model in
accordance with the data encoded in the grey tone natural image and to produce a reshaped
version of the synthetic model as an output 
usually the boundary of a generic object is represented by brightness discontinuities
in the image reproducing it  therefore  in the first version  the first step of the dbs filter
comprises an extremely fast and simple gradient based filter computed on the      neighborhood of each pixel  then  as shown in figure    a threshold is applied to the gradient
image  in order to keep only the most significant edges  the threshold value is now fixed 
but its automatic tuning based on median filtering is currently being tested  folli        
   

fialberto broggi  simona berte

more precisely  two different threshold values are computed for the left and right halves
of the image  in order to detect both road boundaries even under different illumination
conditions 
 
 
 

 

gradient

dbs

 

threshold

threshold
value

 

dt
 
 

 

iterative algorithm

figure    block diagram of the dbs filter
since a  d mesh connected massively parallel architecture is used  an iterative algorithm
must be performed in order to stretch the synthetic model toward the positions encoded in
the thresholded image  a further advantage of the pyramidal approach is that the number
of iterations required for successful stretching is low at a coarse resolution since the image
size is small  and again  only a few iterations are required for high resolution refinement 
due to the initial coarse low resolution stretching  each border pixel of the synthetic image
is attracted towards the position of the nearest foreground pixel of the thresholded image 
as shown in figure   

model
section

threshold

 a 

 b 

figure    the attraction of the boundary pixels of the model  in grey  toward the thresholded image  the rectangular contour    a  two dimensional case   b  monodimensional section
for this purpose  a scalar field v is defined on e    field v   e     e   links the position
of each pixel p   e   to a scalar value v  p    e   which represents the potential associated
to the pixel itself  the set of these values is encoded in a potential image  the difference
v  p    v  q  represents the cost of moving pixel p toward position q  the scalar field is
defined in such a way that a negative cost corresponds to the movement toward the nearest
   

fivision based road detection

position of the foreground pixels ti of the thresholded image  as a consequence  the iterative
process is designed explicitly to enable all the pixel movements associated to a negative cost 
thus  the value v  p  depends on the minimum distance between pixel p and pixels ti  
v  p      min
   
i d p  ti   

where d   e    e     e represents the distance between two pixels  measured with respect
to a given metric  in this case  due to the special simplicity of the implementation  a city
block  manhattan distance  metric has been chosen  see figure    
 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

figure    city block or manhattan distance from the central pixel
a very ecient method for the computation of the potential image using  d mesh connected
architectures is based on the iterative application of morphological dilations  haralick et al  
      serra        
   a scalar counter is initialized to    for parallel architectures which cannot run any
fragment of scalar code  this counter is associated to every pixel in the image  thus
constituting a  parallel  counter 
   the counter is decremented 
   the binary input image is dilated using a   connected structuring element n   formed
by the following elements 
n
o

n                                                    


   

   the value of the counter is assigned to the potential image in the positions where the
pixel  due to the previous dilation  changes its state from background to foreground 
   the process is then repeated from step    until the output of the morphological dilation
is equal to its input 
this shows that the potential image can be generated by the application of a distance
transform  dt  borgefors        to the binary thresholded image  due to a more ecient
implementation dependent data handling  the final version of the potential image dt is
obtained by adding a constant  to every coecient  so as to work with only positive
values   represents the maximum value allowed for grey tone images   thus the new
definition of the scalar field v is 
v  p       min
   
i d p  ti   
   in this specific case  since   bit images are considered         

   

fialberto broggi  simona berte

linear profile of
the input image
   bit pixel 

threshold value

gradient
   bit pixel 

threshold
   bit pixel 

distance
transform  dt 
   bit pixel 

synthetic
input image
   bit pixel 
synthetic
output image
   bit pixel 

figure    example of   iterations of the dbs algorithm  monodimensional case 
furthermore  since the  distance  information is used only by the pixels belonging to the
border of the synthetic image and their neighbors  the iterative process is stopped when the
dt has been computed for these pixels  producing a noticeable performance improvement 
as already mentioned  the crux of the algorithm is an iterative process whose purpose
is to move the edge pixels of the synthetic image in the directions in which the dt gradient
has a maximum  figure   shows an example of a monodimensional stretching  as shown
in appendix a  the strength of this approach lies in the fact that the stretching algorithm
can be expressed simply by a sequence of morphological operations  and can therefore be
mapped eciently on mesh connected massively parallel architectures  achieving higher
performance levels than other approaches  cohen   cohen        cohen        kass et al  
      
in order to describe the dbs algorithm  let us introduce some definitions using mathematical morphology operators  haralick et al         serra        such as dilation    
erosion      or complement     a two dimensional binary image s is represented as a
subset of e    whose elements correspond to the foreground pixels of the image 

n
o
s   s   e    s    x  y   x  y   e  
   
where vector  x  y   represents the coordinates of the generic element s 
   

fivision based road detection

the external edge of s is defined as the set of elements representing the difference
between s and the dilation of s by the   connected structuring element n shown in expression     
   
be s      s  n     s  
in a similar way  the set of elements representing the difference between s and its erosion
using the same structuring element n is defined to be the internal edge of s  

bi s      s   n     s  

   

      the iterative rules

the set of elements b s     be  s     bi  s   are the only elements which can be inserted or
removed from set s by the application of a single iteration of the dbs algorithm  more
precisely  two different rules are applied to the two edges  the first  applied to the external
edge be  s    determines the elements to be included in set s   while the second  applied to
the internal edge bi  s    determines the elements to be removed from set s  

 rule for the external edge 
  each pixel of the external edge of s computes the minimum value of the dt
associated to its   connected neighbors belonging to set s  
  all the pixels  whose associated dt is greater than the value previously computed  are inserted into set s  

the application of this rule has the effect of expanding the synthetic image towards
the foreground pixels ti which are not included in the synthetic model  see the right
hand side of figure   b  

 rule for the internal edge 
  each pixel of the internal edge of s computes the minimum value of the dt
associated to its   connected neighbors not belonging to set s  
  all the pixels  whose associated dt is greater than the value previously computed  are removed from set s  
the application of this rule has the effect of shrinking the synthetic image  see the
left hand side of figure   b  
note that rule   is the inverse of rule    the latter tends to stretch the foreground onto
the background  while the former acts in the opposite way  using the complement of the
synthetic image 
      flat handling

figure   refers to a monodimensional stretching  unfortunately  when dealing with  d data
structures  the dt image does not present a strictly increasing or decreasing behavior  even
locally  thus  an extension to the previous rules must be considered for correct at handling
in the  d space 
   

fialberto broggi  simona berte

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

a  input image

b  stretching without flat handling

c  stretching with flat handling

figure    two dimensional stretching  different square markings represent different states
of input binary image  dark grey areas represent the stretching area
figure   a shows the modulus of the dt coecients  in the case of        together
with the input binary image  shown in grey   the output of the iterative dbs algorithm is
presented in figure   b 
since the movement of a generic pixel towards positions holding an equal dt coecient is expressly disabled  the resulting binary image does not completely follow the shape
encoded in the dt image  a minor revision to the definition of rule   is thus required 
figure   c is obtained with the following rule applied to the external edge 

 rule for the external edge  including at handling 
  each pixel of the external edge of s computes the minimum value of the dt
associated to its   connected neighbors belonging to set s  
  all the pixels  whose associated dt is greater than the value previously computed  and all the pixels not belonging to the thresholded image  whose associated dt is equal to the value previously computed are inserted into set s  

the specific requirement for the pixels moving toward a at region  of not belonging to the
thresholded image  ensures that the binary image does not follow the dt chain of maxima 
with such a requirement  in the specific case of figure    the maxima in the upper right
hand area are not included in the resulting binary image 

   performance analysis of the current implementation

since the final aim of this work is to integrate the road detection system on a mobile
vehicle  the main requirement is to achieve real time performance  the choice of a specialpurpose massively parallel architecture has already been justified in section    moreover 
the algorithm discussed in this paper maps naturally onto a single bit mesh connected simd
machine  because the whole computation can be eciently expressed as a sequence of binary
morphological operators  as shown in appendix a  which presents the morphology based
description of the whole dbs algorithm  
the complete processing  first tested on a connection machine cm    hillis        
is now implemented on the special purpose massively parallel simd architecture paprica 
   

fivision based road detection

the paprica system  parallel processor for image checking and analysis   based on a hierarchical morphology computational model  has been designed as a specialized coprocessor
to be attached to a general purpose host workstation  the current implementation  consisting of a        square array of processing units  is connected to a sparc based workstation
via a vme bus  and installed on mob lab  the current hardware board  a single  u vme
board integrating the processor array  the image and program memories  and a frame
grabber device for the direct acquisition of images for the paprica image memory  is the
result of the full reengineering of the first paprica prototype which has been extensively
analyzed and tested  gregoretti  reyneri  sansoe  broggi    conte        for several years 
the paprica architecture has been developed explicitly to meet the specific requirements of real time image processing applications  broggi      c      b  adorni  broggi 
conte    d andrea         the specific processor virtualization mechanism utilized by paprica architecture allows the handling of pyramidal data structures without any additional
overhead equipment 
as shown in figure    the output device can be 
 a  a heads up display in which the road  or lane  boundaries are highlighted 
 b  a set of leds indicating the relative position of the road  or lane  and the vehicle 
starting from          grey tone images and after the resolution reduction process  in the
first case  a  the initial resolution must be recovered in order to superimpose the result onto
the original image  in the second case  b   on the other hand  due to the high quantization
of the output device  the processing can be stopped at a low resolution  e g            where
only a stripe of the resulting image is analyzed to drive the leds  table   presents the
computational time required by each step of the algorithm  considering   dt iterations
and   dbs iterations for each pyramid level  
operation
image size
time  ms 
resolution reduction
        
      
 
 
dt  dbs   oversampling
      
     
dt  dbs   oversampling
        
     
dt  dbs   oversampling
         
      
total  led output 
             
      
 
 
 
total  heads up display output              
      
table    performance of paprica system  the numbers refer to   iterations of the dt
process and   iterations of the dbs filter for each pyramid level 
in the current mob lab configuration  the output device  shown in figure   b  consists
of a set of   leds  table   shows that the                  filtering of a single frame takes
       ms  depending on the number of iterations required   allowing the acquisition and
processing of about   frames per second 
moreover  due to the high correlation between two consecutive sequence frames  the
final stretched template can be used as the input model to be stretched by the processing
of the following frame  in these conditions a lower number of dbs and dt iterations
   

fialberto broggi  simona berte

a

b

c

d

e

a

b

c

d

e

a

b

c

d

e

figure     the detection of road markings through the removal of the perspective effect in
three different conditions  straight road with shadows  curved road with shadows  junction   a  input image   b  reorganized image  obtained by non uniform
resampling of  a    c  result of the line wise detection of black white black transitions in the horizontal direction   d  reintroduction of the perspective effect 
where the grey areas represent the portion of the image shown in  c    e  superimposition of  d  onto a brighter version of the original image  a  
are needed for the complete template reshaping  thus producing a noticeable performance
improvement  the reduction in the time required to process a single frame also increases
the correlation between the current and the following frame in the sequence  thus allowing
a further reduction in computation time   
images acquired in many different conditions and environments have been used for
extensive experimentation  which was performed first off line on a functional simulator
implemented on an  k processor connection machine cm    hillis        and then in realtime on the paprica hardware itself on mob lab  the complete system was demonstrated
at the final prometheus project meeting in paris  in october       the mob lab land
vehicle was driven around the two lane track at mortefontaine  under different conditions
 straight and curved roads  with shadows and changing illumination conditions and with
other vehicles on the path  
   in the processing of highly correlated sequences  namely when the road conditions change slowly or in an
off line slow motion tape playback in the laboratory  the computational time required by the processing
of a single frame can reach a minimum value of     ms 

   

fivision based road detection

the performances obtained during this demonstration allowed the main limitations of
the system to be detected and enabled a critical analysis of the approach  thus leading to
proposals for its development 

   critical analysis and evolution

the approach discussed achieves good performances in terms of output quality when the
model matches  or is suciently similar to  the road conditions  namely when road markings
are painted on the road surface  on structured roads  see figures    a and    a  inducing
a suciently high luminance gradient  this approach is successful when the road or lane
boundaries can be extracted from the input image through a gradient thresholding operation
 see figures    b and    b   unfortunately  this is not always possible  for example when the
road region is a patch of shadow or sunlight  as in figure    a  in this case the computation
of the dt starting from the thresholded image  see figure    b  is no longer significant  a
different method must be devised for the determination of the binary image to be used as
input for the distance transform 

a

b

c

d

e

figure     lane detection on a straight road   a  input image   b  image obtained by
thresholding the gradient image   c  image obtained by the perspective based
filter   d  stretched template   e  superimposition of the edges of the stretched
template onto the original image  in this case both the thresholded gradient  b 
and the perspective based filtered  c  images can be used as input to the dt 

a

b

c

d

e

figure     lane detection on a curved road  also in this case both the thresholded gradient
 b  and the perspective based filtered  c  images can be used as input to the
dt 
in a recent work  broggi      a  an approach based on the removal of the perspective
effect is presented and its performances discussed  a transform  a non uniform resampling
similar to what happens in the human visual system  zavidovique   fiorini        wolfe  
   

fialberto broggi  simona berte

cave         is applied to the input image  figures    a   assuming a at road  every pixel
of the resampled image  figures    b  now represent the same portion of the road   due to
their constant width within the overall image  the road markings can now be easily enhanced
and extracted by extremely simple morphological filters  broggi      a   figures    c  
finally the perspective effect is reintroduced  figures    d  

a

b

c

d

e

figure     lane detection on a straight road with shadows  this is a case where the thresholded gradient  b  cannot be used to determine the dt image due to the noise
caused by shadows  on the other hand  the perspective based processing is able
to filter out the shadows and extract the road markings  the dt is in fact
determined using image  c  instead of  b  

a

b

c

d

e

figure     lane detection on a straight road with a vehicle in the path  this is the only
case in which the dbs algorithm cannot stretch the binary model successfully 
due to the presence of the vehicle occluding the road markings  the use of a
pair of stereo cameras to remove this problem is currently being investigated 
due to the high effectiveness of this filter  in the test version of the system currently
operational in the laboratory  the dbs filter has been improved by replacing the gradient
thresholding with the perspective based filter  the extended version of the dbs filter is
shown in figure    
since the removal  and reintroduction  of the perspective effect can be reduced to a
mere image resampling and the filter is based on simple morphological operators  broggi 
    a   the implementation on the paprica system is straightforward  the preliminary
results obtained by the current test version of the system are encouraging both for the
output quality  the problems caused by shadows are now resolved  and for computation
   note that  due to the perspective effect  the pixels in the lower part of the original image  figures    a 
represent a few cm  of the road region  while the central pixels represent a few tens of cm    the nonuniform resampling of the original image has been explicitly designed for a homogeneous distribution of
the information among all the pixels in the image 

   

fivision based road detection

 
 
 

extended
dbs

persp  eff 
removal

 

 

morph 
filter
 

persp  eff 
reintrod 
 

dt
 
 

 

iterative algorithm

figure     diagram of the extended dbs filter including the perspective based filtering
time  a single frame is processed in less than     ms  thus allowing the processing of about
   frames per second  the improvement of the dbs process by means of the perspectivebased filter  in addition to allowing correct road  or lane  detection in presence of shadows 
can be implemented extremely eciently on the paprica system  taking advantage of a
specific hardware extension designed explicitly for this purpose  non uniform resampling 
 broggi      a  
figures             and    show the results of the processing in different conditions 
straight and curved road  with shadows and other vehicles in the path  respectively    in
the last case the lane cannot be detected successfully due to the presence of an obstacle
the use of a pair of stereo images is currently being investigated to overcome this
problem  the removal of the perspective effect from both the stereo images would lead to
the same image iff the road is at  namely if no obstacles are found on the vehicle path  a
difference in the two reorganized images  namely when an obstacle is detected  would cause
the algorithm to stop the lane detection and warn the driver 
the general nature of the presented approach enables the detection of other suciently
large sized features  for example  using different synthetic models it is possible to detect
road or lane boundaries  as shown in figure    

   conclusions
in this paper a novel approach for the detection of road  or lane  boundaries for visionbased systems has been presented  the multiresolution approach  together with top down
control  allows achievement of remarkable performances in terms of both computation time
 when mapped on massively parallel architectures  and output quality 
   some sequences in mpeg format      and      frames respectively  are available via world wide
web at http   www ce unipr it computer vision  showing lane detection in particularly challenging
conditions  the images shown in figures                 and    are part of the sequences available in the
previously mentioned www page 

   

fialberto broggi  simona berte

a

b

c

d

e

figure      a  input image   b  synthetic model used for lane detection   c  superimposition
of the edges of the stretched model onto the original input image   d  synthetic
model used for road detection   e  superimposition of the edged of the stretched
model onto the original input image 
a perspective based filter has been introduced to improve system performance in shadow
conditions  however  even if the perspective based filter alone is able to extract the road
markings with a high degree of confidence  the hierarchical application of the dbs filter
 and its extension to the handling of image sequences  is of basic importance since it allows
the exploitation of the temporal correlation between successive sequence frames  performing
solution tracking  
the presence of an obstacle in the vehicle path is still an open problem  which is currently
being approached using stereo vision  broggi      a  
the algorithm has been implemented on the paprica system  a massively parallel lowcost simd architecture  because of its specific hardware features  paprica is capable of
processing about    frames per second 

appendix a  the morphological implementation of the dbs filter

in this appendix  the rule for the external edge will be considered  assuming step n in
the iterative process  recalling the mathematical morphology notations used to identify a
grey tone two dimensional image  the dt image is a subset of e   

dt   fd   e   j d    u  v   v   v  u     u   e  g  

   

where u represents the position of element d in e    and v represents its value 
the pixelwise masking operation between a binary and a grey tone image is here defined
as a function
fi   e   e    e 
   
such that a fi b represents a subset of b containing only the elements b    u  v   whose
position vector u   e   also belongs to a 

a fi b   fx   e   j x    u  v    b  u   ag

   

in order to compute the minimum value of the dt in the specified neighborhood  let us
consider image ke n 

 

ke n    se n  fi dt   se n  fi l  
    
   

fivision based road detection

where se n  represents the binary image at step n  the subscript e indicates that the rule for
the external edge is being considered  and finally

l   fl   e   j l    u       u   e  g  

    

as shown in  haralick et al          in order to compute the minimum value of a grey tone
image ke n  in a   connected neighborhood  the following grey scale morphological erosion
should be used 
me n    ke n    q  
    
where
q   f                                            g  
    
as shown in figure    
 
 

 
 

z
y

q                                                      

x

figure     structuring element q
in order to determine the set of elements in which me n  has a value smaller than dt  
a new function m is required 
m   e   e    e   
    
such a function is defined as

m a  b    fx   e   j v  a  x    v  b  x g  

    

where v   e    e     e is defined as

v  a  x   

 

a if   a   e j  x  a    t  a   
   otherwise

    

in equation       t  a  represents the top of a  haralick et al          here defined as

t  a    ft   a  t    u  v  j     t     x  v     a for which v    vg  

    

the set of elements which will be included in set se n    is given by the logical intersection
between m me n   dt   and the set of elements belonging to the external edge of se n   








ee n    m me n   dt   be se n   
   

    

fialberto broggi  simona berte

distance
transform  dt 
   bit pixel 

distance
transform  dt 
   bit pixel 
input
image s
   bit pixel 

input
image s
   bit pixel 

synthetic image
complemented s
   bit pixel 

masked
image k
   bit pixel 

masked
image k
   bit pixel 

dt

dt
eroded
image m
   bit pixel 

dilated
image m
   bit pixel 

m  m dt 
   bit pixel 

m  m dt 
   bit pixel 

external edge
   bit pixel 

internal edge
   bit pixel 

output image
   bit pixel 

output image
   bit pixel 

figure     monodimensional stretching in the case of external edge  left  and internal edge
 right 
thus  the final result of iteration n is given by
se n      se n    ee n   
    
figure    a shows the execution of an individual iteration of rule   on a monodimensional
image profile 
following similar steps  it is possible to formalize rule    in order to compute the
maximum value of the dt in the specified neighborhood  let us consider image ki n 

ki n    si n  fi dt  

    
where the subscript i indicates that the rule for the internal edge is being considered  as
shown above  in order to compute the maximum value of a grey tone image ki n  in a
  connected neighborhood  the following morphological dilation should be used 
mi n    ki n   q  
    
where q is shown in figure    
the set of elements which will be removed from set si n    is given by the logical intersection between m mi n   dt   and the set of elements belonging to the internal edge of si n   




ei n    m mi n   dt   bi si n   
    
   

fivision based road detection

thus  the final result of iteration n is given by




si n      si n    ei n    si n    ei n   

    

figure   b shows the execution of an individual iteration of rule   on a monodimensional
profile of an image 

acknowledgements
this work was partially supported by the italian cnr within the framework of the eureka
prometheus project   progetto finalizzato trasporti under contracts n           pf  
and          pf   
the authors are indebted to gianni conte for the valuable and constructive discussions
and for his continuous support throughout the project 

references

adorni  g   broggi  a   conte  g     d andrea  v          a self tuning system for realtime optical flow detection  in proceedings ieee system  man  and cybernetics
conf  vol     pp       
adorni  g   broggi  a   conte  g     d andrea  v          real time image processing for
automotive applications  in laplante  p  a     stoyenko  a  d   eds    real time image processing  theory  techniques and applications  ieee and spie press  in press 
annaratone  m   arnould  e   t gross  h kung    j webb         the warp computer  architecture  implementation and performance  ieee trans on computers 
c                    
ballard  d  h     brown  c  m          computer vision  prentice hall 
blake  a     yuille  a          active vision  mit press 
borgefors  g          distance transformations in digital images  in computer vision 
graphics and image processing  vol      pp          
broggi  a          performance optimization on low cost cellular array processors  in
proceedings ieee intl conf on massively parallel computing systems  pp          
broggi  a       a   a massively parallel approach to real time vision based road markings detection  in masaky  i   ed    proceedings ieee intelligent vehicles     pp 
      
broggi  a       b   a novel approach to lossy real time image compression  hierarchical
data reorganization on a low cost massively parallel system  real time imaging
journal        
broggi  a       c   parallel and local feature extraction  a real time approach to road
boundary detection  ieee trans on image processing                 
broggi  a   conte  g   gregoretti  f   sansoe  c     reyneri  l  m          the evolution
of the paprica system  integrated computer aided engineering journal   special
issue on massively parallel computing  in press 
   

fialberto broggi  simona berte

broggi  a   conte  g   gregoretti  f   sansoe  c     reyneri  l  m          the paprica
massively parallel processor  in proceedings ieee intl conf on massively parallel
computing systems  pp        
cantoni  v     ferretti  m          pyramidal architectures for computer vision  plenum
press  london 
cantoni  v   ferretti  m     savini  m          compact pyramidal architectures  in tou 
j     balchen  j   eds    highly redundant sensing in robotic systems  vol      pp 
         nato asi series f 
cantoni  v     levialdi  s          pyramidal systems for computer vision  springer
verlag  berlin 
chandrakasan  a   sheng  s     brodersen  r          low power cmos digital design 
ieee journal of solid state circuits                  
cohen  l  d          note on active contour models and balloons  cgvip  image understanding                  
cohen  l  d     cohen  i          finite element methods for active contour models and
balloons for   d and   d images  ieee trans on pami                     
courtois  b          cad and testing of ics and systems  where are we going   tech 
rep   tima   cmp 
crisman  j     thorpe  c          color vision for road following  in thorpe  c  e   ed   
vision and navigation  the carnegie mellon navlab  pp        kluwer academic
publishers 
crisman  j     thorpe  c          unscarf  a color vision system for the detection
of unstructured roads  in proceedings ieee intl conf on robotics and automation 
pp            
crisman  j     thorpe  c          scarf  a color vision system that tracks roads and
intersections  ieee trans on robotics and automation               
crisman  j  d     webb  j  a          the warp machine on navlab  ieee trans on
pami                  
dickmans  e  d     mysliwetz  b  d          recursive   d road and relative ego state
recognition  ieee trans on pami              
folli  a          elaborazione parallela di immagini per applicazioni in tempo reale su
autoveicolo  master s thesis  universita degli studi di parma  facolta di ingegneria 
forman  g  h     zahorjan  j          the challenge of mobile computing  computer 
              
fountain  t          processor arrays  architectures and applications  academic press 
london 
graefe  v     kuhnert  k  d          vision based autonomous road vehicles  in masaki 
i   ed    vision based vehicle guidance  pp        springer verlag 
gregoretti  f   reyneri  l  m   sansoe  c   broggi  a     conte  g          the paprica
simd array  critical reviews and perspectives  in dadda  l     wah  b   eds   
proceedings asap      ieee intl conf on application specific array processors  pp 
        venezia  italy 
   

fivision based road detection

hamey  l  g  c   web  j  a     wu  i          low level vision on warp and the apply
programming model  in kowalik  j  s   ed    parallel computations and computers
for artificial intelligence  pp           kluwer academic publishers 
haralick  r  m   sternberg  s  r     zhuang  x          image analysis using mathematical
morphology  ieee trans on pami                 
hillis  w  d          the connection machine  mit press  cambridge  ma 
jochem  t  m     baluja  s          a massively parallel road follower  in bayoumi 
m  a   davis  l  s     valavanis  k  p   eds    proceedings computer architectures
for machine perception      pp       
jochem  t  m   pomerleau  d  a     thorpe  c  e          maniac  a next generation neurally based autonomous road follower  in proceedings of the intl conf on
intelligent autonomous systems  ias    pittsburgh  pennsylvania  usa 
kass  m   witkin  a     terzopolous  d          snakes  active contour models  intl
journal of computer vision             
kenue  s  k          lanelok  detection of lane boundaries and vehicle tracking using
image processing techniques  in proceedings of spie   mobile robots iv  vol       
pp          
kenue  s  k          lanelok  an algorithm for extending the lane sensing operating
range to     feet  in proceedings of spie   mobile robots v  vol        pp          
kenue  s  k          correction of shadow artifacts for vision based vehicle guidance  in
proceedings of spie   mobile robots viii  vol        pp        
kenue  s  k     bajpayee  s          lanelok  robust line and curvature fitting of
lane boundaries  in proceedings of spie   mobile robots vii  vol        pp          
kluge  k     thorpe  c  e          explicit models for robot road following  in thorpe 
c  e   ed    vision and navigation  the carnegie mellon navlab  pp         kluwer
academic publishers 
kluge  k          extracting road curvature and orientation from image edge points
without perceptual grouping into features  in proceedings ieee intelligent vehicles    
maspar computer corporation  sunnyvale  california         mp   family data parallel
computers 
neumann  h     stiehl  h          toward a computational architecture for monocular
preattentive segmentation  in g hartmann  r     g hauske  eds    parallel processing in neural systems and computers  elsevier  north holland  
newman  w  m     sproull  r  f          principles of interactive computer graphics 
mcgraw hill  tokyo 
pomerleau  d  a          neural network based autonomous navigation  in thorpe 
c  e   ed    vision and navigation  the carnegie mellon navlab  pp         kluwer
academic publishers 
pomerleau  d  a          neural network perception for mobile robot guidance  kluwer
academic publishers  boston 
pratt  w  k          digital image processing  john wiley   sons 
   

fialberto broggi  simona berte

rosenfeld  a          multiresolution image processing and analysis  springer verlag 
berlin 
serra  j          image analysis and mathematical morphology  academic press  london 
shoji  m          cmos digital circuit technology  prentice hall 
tanimoto  s  l     kilger  k          structured computer vision  machine perception
trough hierarchical compuation structures  academic press  ny 
thorpe  c          outdoor visual navigation for autonomous robots  in kanada  t  
groen  f  c  a     hertzberger  l  o   eds    intelligent autonomous systems  vol    
pp          
tsai  r          an ecient and accurate camera calibration technique for  d machine
vision  in proceedings ieee intl conf on computer vision and pattern recognition 
pp          
turk  m  a   morgenthaler  d  g   gremban  k  d     marra  m          vits   a vision
system for autonomous land vehicle navigation  ieee trans on pami         
wolfe  j  m     cave  k  r          deploying visual attention  the guided model  in ai
and the eye  pp          a blake and t troscianko 
zavidovique  b     fiorini  p          a control view to vision architectures  in cantoni 
v   ed    human and machine vision  analogies and divergencies  pp         plenum
press 

   

fi