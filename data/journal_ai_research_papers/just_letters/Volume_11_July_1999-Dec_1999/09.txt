journal of artificial intelligence research                  

submitted       published      

the complexity of reasoning about spatial congruence
matteo cristani

dipartimento scientifico e tecnologico 
universita di verona 
ca vignal    strada le grazie  i       verona

cristani sci univr it

abstract

in the recent literature of artificial intelligence  an intensive research effort has been
spent  for various algebras of qualitative relations used in the representation of temporal and
spatial knowledge  on the problem of classifying the computational complexity of reasoning
problems for subsets of algebras  the main purpose of these researches is to describe
a restricted set of maximal tractable subalgebras  ideally in an exhaustive fashion with
respect to the hosting algebras 
in this paper we introduce a novel algebra for reasoning about spatial congruence  show
that the satisfiability problem in the spatial algebra mc   is np complete  and present a
complete classification of tractability in the algebra  based on the individuation of three
maximal tractable subclasses  one containing the basic relations  the three algebras are
formed by        and   relations out of    which form the full algebra 

   introduction
qualitative spatial reasoning has received an increasing amount of interest in the recent
literature  the main reason for this  as already observed by jonsson and drakengren        
is probably that spatial reasoning has proved to be applicable to real world problems  as in
geographical information systems  egenhofer        grigni  papadias    papadimitriou 
       and molecular biology  cui        
the specific stress on qualitative reasoning about space  as observed by zimmermann
        is justified by the fact that qualitative spatial relations can be treated as eciently
as their quantitative counterparts  but they seem to be closer to the model of relations
humans adopt for spatial reasoning 
even though qualitative spatial reasoning has an extended literature  in spite of its
relatively short history  certain aspects of the discipline have been neglected  in particular 
no exhaustive computational perspective has been developed on qualitative morphological
reasoning about space  the term morphological reasoning is intended to suggest reasoning
about the internal structure of the objects  in the case of spatial reasoning this includes
reasoning about the size  shape and internal topology of spatial regions 
the purpose of the present work is to analyse the complexity of reasoning about relations
of congruence  either actual or partial  between spatial regions  using the spatial algebra
mc   which has been preliminarly analysed by cristani        
the algebra mc   is a constraint algebra  ladkin   maddux        for qualitative
reasoning about the morphological relation of congruence  two spatial regions  in the
models documented in literature  are considered to be equivalent if and only if they share
interior and boundaries  namely if and only if they are the same spatial region  in particular 
c      ai access foundation and morgan kaufmann publishers  all rights reserved 

ficristani

the relation eq  as defined by randell  cui and cohn         and analogously by egenhofer
and franzosa         becomes identity under the unique name assumption  geometry and
topology  conversely  allow other kinds of equivalence relations  these relations are weaker
than the identity  namely the equivalence classes they induce are larger than singletons 
the simplest weakening we can define is the congruence relation  even though  the
relation has been studied  borgo  guarino    masolo              cristani        mutinelli 
       the complexity of reasoning in subalgebras has not yet been deeply investigated 
the reason to introduce this new relation  and to provide an algebraic structure to host
relations based on it  in particular relations in which we compare regions  which  even if
they are not congruent  can be overlapped by roto translating one into the interior of the
other   is that  in many cases  the knowledge we have to represent in our systems necessarily
includes internal structures  consider the following example 

example  
a gis is dedicated to the representation of geographical data about industrial sites 
in the system  the structure of factories can be described by means of various attributes 
including size and shape  one of the users wants to query the system about the opportunity
of moving the factory  where he works  from the present site to a new one  in the new site
prefabricated facilities already exist  and the problem consists of deciding how to preserve
topological layout of the factory and minimise the costs of buying new engines  to substitute
those which cannot fit with the new facilities 
in order to reason about these problems the system can be made able to represent the
qualitative relations between the old and new site parts  establishing  in particular whether
the spatial regions occupied by the engines are  congruent   or even  congruent to a part 
of the ones which can be chosen for hosting them in the new factory s site 
clearly we cannot use topological information  since a spatial region presently occupied
by an engine is surely disjoint from the region that this engine is going to occupy in the new
site  but this information is insucient for deciding whether the new site is able to host the
engine itself 
though metric information can be involved in final decision about moving the factory 
qualitative reasoning can be used in the initial design phase 
in figure   we give a pictorial representation of one possible situation in which  to make
decisions  we need to represent spatial information which is not topological 


the algebra mc   can be used to represent the four basic relations which can be built on
the equivalence relation of congruence  if we consider the roto translation of a region x with
respect to a region y  only four possible situations arise 
 there is at least one roto translation in which x coincides with y  the two regions
are congruent 
 there is at least one roto translation in which x coincides with a proper part of y 
the region x is congruent to a proper part of y 
   

fithe complexity of reasoning about spatial congruence

figure    a pictorial representation of the relations to be analysed in a gis for moving
a factory from an old to a new site  note that the production lines of the new
facility may not be suitable for hosting certain engines 

 there is at least one roto translation in which y coincides with a proper part of x 
the region x has a proper part congruent to y 
 none of the above  the region x and y cannot be perfectly overlapped 
we would like to stress here three main aspects of these relations 
   the relations can be established between two spatial regions in any position of space 
there is no specific need for the regions to be close  or to be in any particular topological relation  provided that the relation is compatible  so these congruence relations
are purely morphological 
   the equality of two regions implies congruence  the relation of proper part excludes
morphological relations other than  congruent to a part   this is not the case for the
morphological side  a region can be congruent to a part of another region  even if
they are disjoint  and the same can happen to congruence  as already stated in point
  
   even if two regions are of the same size  there may be the case that the regions are
not congruent  this holds also for partial congruence  being possible that a region is
smaller than another one but they cannot be overlapped 
the practical relevance of the algebra can be proved by exhibiting many other examples 
especially coming from gis  in this paper we deal with the problem of reasoning about
congruence in two dimensional space domain  the kind of congruence we assume is the
weakest one  roto translability  three dimensional congruence is not of the same type  the
 natural  notion of three dimensional congruence is isometry  which is much more general
than roto translability  for example left and right hands are congruent  under the simplified
assumption that they have the same shape and size   but they cannot be roto translated
each into the other one  we concentrate here in two dimensional reasoning which may be
   

ficristani

analysed in terms of roto translation and topological relations  the analysis of isometries
is left for further work 
the paper is organised as follows  section   describes related work which has been
developed in the area  section   presents the spatial algebra mc    and section   discusses
the classification of tractability we found for this algebra  finally  in section    some
conclusions are given 

   previous work
from the perspective of individuating primitives to describe space  a significant effort has
been lately spent  in the direction of defining binary relations between spatial regions  which
may be used as a model of space in qualitative terms  moreover  it was natural  in the ai
community  to use constraint processing for reasoning about such binary relations  a
specific attention to constraint processing emerged in the spatial database community 
and in the community of geographical information science as well 
two apparently independently developed models  which can be shown to be essentially
equivalent  exist in the artificial intelligence  randell   cohn        randell  cui   
cohn        and spatial database literatures  egenhofer   herring        egenhofer  
franzosa        franzosa   egenhofer         the artificial intelligence model   randell  
cohn        randell et al         is known as rcc  where the acronym stands for region
connection calculus 
the rcc model is centered on the primitive of  connection  as originally suggested
by clarke         gotts        and further gotts  gooday and cohn        obtained
connection to be the only primitive  in the original framework  randell   cohn       
randell et al         the model was formulated in two versions  now called rcc   and
rcc    the rcc   model is a model in which we cannot distinguish between interior
and boundary of a spatial region  so that the external connection may be tangency or
overlapping  for example   while in the rcc   model this distinction is possible 
bennett               used propositional logic to represent rcc reasoning problems  he
observed that  given a propositional logic  and interpreting the truth values of each formula
as a spatial region  the language of rcc   is sucient to express a satisfaction problem at
the semantical level  this fact  however  is not due to the spatial interpretation  because
a non spatial interpretation in which the rcc   relations are still sucient to represent
truth condition at semantical level can be found  set theory  therefore  he applied the
result of cook        on np completeness of classical propositional logic to the restricted
model rcc    proving that deciding the consistency of a constraint satisfaction problem
 csp  on rcc   is an np complete problem too 
the complete model of rcc    instead  can not be analysed in terms of pure set theory 
because the distinction between boundary connection and interior connection is possible 
this distinction means that the minimal interpretation in which rcc   still provides a
correct and complete representation of truth conditions at semantical level requires topology 
statman        proved that intuitionistic logic along with interpretations in set theory forces
a topology in the models of a sound theory  bennett proved  thus  that rcc   can be used
to define the truth conditions of formulas in an intuitionistic propositional logic  statman
       proved that intuitionistic propositional logic is pspace complete  however  since
   

fithe complexity of reasoning about spatial congruence

we do not need a complete truth verification procedure  but only a procedure for constraint
processing  bennett could reduce the result  proving that also rcc   is np complete 
these results  even if they are in general negative for practical purposes  encouraged
researches in the direction of restricted models  in such a way that at least for certain
cases we may process a finite set of rcc constraints in polynomial fashion on deterministic
machines  in particular  nebel        showed that reasoning with the basic relations of
rcc   and rcc   are tractable problems  renz and nebel        improved the results
above  by showing that there exists a maximal tractable subclass of rcc    denoted by
hb   formed by    relations out of     which includes all the basic relations  and a maximal
tractable subclass of rcc    denoted by hb    formed by     relations out of     including
the basic relations  a maximal tractable subclass a  is a subset of a constraint algebra  such
that problems defined on a are tractable  while problems defined on proper supersets of a
are not  these results have been obtained in a similar fashion to the work of nebel and
burckert        on temporal reasoning  the result of renz and nebel is anyway incomplete 
since he simply proved that there exists one maximal tractable subclass  and he did not
classify every maximal tractable subclasses of rcc    jonsson and drakengren       
showed that there exist four maximal tractable subclasses of rcc    one including the
basic relations  the result is obtained in a similar fashion to  drakengren   jonsson       
jonsson  drakengren    backstrom         a complete analysis of the rcc   maximal
tractable subclasses including the basic relations has been provided by renz in        
our result is the analogous in mc   of jonsson and drakengren result for rcc    the
mc   algebra  we describe in this paper  is structured in the same way as the algebra of
partially ordered time  po time algebra   studied by anger  mitra and rodriguez  we
would like to stress two main aspects here 
 the mc   algebra has the po time algebra are the same algebraic structure  the
discussion of this paper stands a different interpretation of the po time algebra  even
different from the spatial interpretation provided by anger  mitra and rodriguez in
their papers 
 the computational results we present here can be applied to the po time algebra as
well  and they extend the previous findings obtained by anger  mitra and rodriguez 
in particular anger  mitra and rodriguez               proved that path consistency
is insucient to ensure consistency for relations in this algebra  and that there exists a
tractable subalgebra of it which can be treated by an o n    algorithm 
anger  mitra and rodriguez         showed that deciding the consistency of a po time
network is an np complete problem by reducing to it the analogous decision problem on
rcc   
some important observations are needed  with respect to the results of anger  mitra
and rodriguez 
 the results on the complexity of po time algebra can be applied to mc    only if
we can show that when a mc   network is consistent then we can exhibit a consistent scenario in which vertices of the network are substituted with spatial regions 
therefore  even if we can show this correspondence for po time algebra too  our
np completeness result is independent  moreover  the method we used to prove the
   

ficristani

intractability of mc   is independent as well  and the main difference is in the way
we used to exhibit problematic algebraic structure  through this proof we derived a
simple way to solve the problems whenever possible in polynomial time 

 the discovery of the tractable subalgebras we indicate by m     m   and m   in

the present paper  deserves acknowledgement of priority to anger  mitra and rodriguez  however  anger  mitra and rodriguez also classified one more algebra  which
is tractable  but not maximal  since it is contained in m     moreover  the algorithms
we found for m   and m   are substantially different from the one anger  mitra and
rodriguez present and more ecient  being o n    instead of o n     therefore the
two algorithmic solutions can be considered as independent results as well 

 the classification presented here is complete  since we classify all the maximal tractable
subalgebras of mc    and this is a result which may be applied to temporal reasoning
as well  since it is obtained by means of algorithms which are completely independent
from the interpretation we give to the relations  either spatial or temporal  

 the introduction of morphological relations in spatial reasoning is novel too  and the

study of spatial congruence deserves  in our opinion  deep investigations henceforth 
the fact that two algebras of spatial and temporal reasoning present substantial similarities is not a novelty  the rcc model corresponds to subalgebras of interval
calculus  as stated by bennett         also anger  mitra and rodriguez stated this
property of po time algebra with respect to rcc    but their interpretation is completely different from our own  the equality of po time being interpreted as eq in
rcc    while we interpret it as congruence 

thus  even though a similar algebraic structure has been partially investigated before  the
present paper presents substantial methodological differences and we have obtained results
which are independent of or extensions to the ones obtained by anger  mitra and rodriguez 
in the remainder of the paper  when a result can be attributed to anger  mitra and
rodriguez we note it in the text 

   the spatial algebra mc  
in this section we present the spatial algebra mc    which has been previously presented
by cristani        and largely analysed in by mutinelli        
mc   is a binary constraint algebra  henceforth indicated as a constraint algebra   in
a constraint algebra we have a constraint domain and an algebra base  which is formed
by mutually exclusive relations among elements of the constraint domain  whose union
form the universal relation  the converse of a basic relation is a basic relation too  and
the composition of basic relations is the union of some basic relations  a constraint is the
establishment of one of all possible unions of basic relations between two variables which
vary on the domain  a constraint is satisfied by an assignment of one pair of values of the
domain to the variables  so that the pair of values is in one of the relations of the constraint
itself  given a finite set of constraints between two variables  the problem of deciding
whether there exists an assignment to the variables such that all the constraints can be
   

fithe complexity of reasoning about spatial congruence

y

x

x cg y
y

x

x cgpp y
y

x

x cno y

figure    a pictorial representation of the basic relations of mc  
cg
cgpp

cg
cg
cgpp

cgpp
cgpp
cgpp

cgpp  
cgpp  

cgpp  

cgpp  

 

cgpp  

cno

cno

cgpp
cno

cgpp  
cno




 

cno
cno
cgpp
cno
cgpp  
cno

 

table    the composition table of mc    the symbol   represents the universal relation
fcg  cgpp  cgpp     cnog 
simultaneously satisfied is referred to as constraint satisfaction problem  and henceforth
indicated as a csp 
the mc   algebra is formed by all the unions of the four basic relations  which can be
established between two dimensional spatial regions  from a morphological point of view 
with respect to the equivalence relation of congruence 
the congruence relation is variously interpreted in geometry  our interpretation is the
most restrictive one  two regions are congruent iff they can be rigidly roto translated into
each other 
a region x  in this interpretation  may be congruent  x cg y  to a region y  or congruent
to a part of y  x cgpp y  or they cannot be perfectly overlapped  x cno y   the relation
congruent to a part of may also be inverted to having a part congruent to  y cgpp   x iff
x cgpp y  
in figure   a pictorial representation of the three basic relations cg  cgpp and cno is
given  in table   we present the composition table of mc   showing how the basic relations
compose with each other 
   

ficristani

x dr y
x

x po y
y

x

y

  

x pp y

x pp y

x eq y

x y

x y

x y

figure    a pictorial representation of the relations of rcc   
a csp can be represented by a network of constraints  a network of constraints is a
labelled graph g   hv     ei  where v is a finite set of vertices  e is a binary relation on
v whose elements are called edges  and  is a labelling function which maps each vertex
of g to a variable  and each edge to a relation of a constraint algebra on a given domain
d  given a network of constraints g   the problem of deciding the consistency of g is the
problem of establishing whether is it possible to instantiate each vertex label  the variables 
with elements of d  in such a way that all the relations represented in g as labels of the
edges are simultaneously satisfied  the csp represented by a network g is often referred to 
for the algebra a  as a sat g    for the sake of simplicity we refer to the csp represented
by a network g on mc   as msat g   
the main result on the mc   algebra  with respect to msat  is unfortunately a negative
computational account  in general  deciding the consistency is hard to solve for networks
of constraints between variables representing spatial regions  as stated in theorem    this
result has been already proved by cristani        
anger  mitra and rodriguez         showed that path consistency cannot be applied
successfully to the algebra of partially ordered time  which is isomorphic to mc   at the
syntactic level  this is insucient to prove that the csp on this algebra is np complete 
they showed  anger et al         that po time algebra is np complete  their proof lies on
the  translation  which can be shown to be analogous  but not identical  to the 
 translation
we introduced here  at the syntactical level  being completely different at the semantical
one  however  their proof is insucient to show that we can arrange spatial solutions 
since the map they defined is purely syntactical  as already observed by lemon        
the representation of space by means of relation algebra is not pure  and we can obtain
satisfiable networks which are not realizable in space  our proof  instead  can be applied
to spatial interpretations  it can be applied to nonlinear time temporal interpretations as
well  since the syntactic level is shown to be sucient for space  and nonlinear time can be
interpreted as space too  anger et al         
before getting into the proof of this negative result we need to describe a relevant
correspondences of the mc   algebra to the rcc   model  which is also used in the proof
of theorem    the well known rcc   algebra is a constraint algebra with   basic relations 
eq   dr   po   pp   pp     the five relations correspond to the pictorial representation of
figure   
if two spatial regions are in one of the relations of mc    then only certain relations
of rcc   can be established between them  conversely  if certain relations of rcc   are
established only certain corresponding relations of mc   are  this correspondence  however 
is not one to one  consider  for instance  a region x and a region y  such that x dr y  in
   

fithe complexity of reasoning about spatial congruence

rel  of mc   rel  of rcc  
cg
cgpp
cgpp  
cno

feq  dr  pog
fpp  dr  pog
fpp    dr  pog
fdr  pog

table    the basic relations of mc   and their counterparts in rcc    the meaning of the
table is that when a relation of mc   is established  then one of the relations of
rcc   in second column is established as well 

rel  of rcc   rel  of mc  
eq
pp
pp  
po
dr

cg
cgpp
cgpp  
fcg  cgpp  cgpp    cnog
fcg  cgpp  cgpp    cnog

table    the basic relations of rcc   and their counterparts in mc   
rcc    namely x is disjoint from y  then  each relation of mc   can be established between
x and y  however  if x pp y  namely x is a proper part of y  then only the cgpp relation
can be established between x and y  on the other hand  if two regions are congruent  only
the relations dr   po and eq can exist between x and y 
in table   we set the correspondences between mc   basic relations and rcc    while
in table   we set the correspondences between rcc   and mc   
the correspondences of the above tables are not suciently strict  to use them in proving that msat mc    is an np complete problem by a direct polynomial reduction  if
we consider a csp on mc    the corresponding rcc   csp is not intractable  since the
relations obtained from table   do not define an intractable subset of rcc    by means
of the complete classification established by jonsson and drakengren         therefore 
msat mc    is not reducible to rsat rcc     the rsat symbol represents the satisfiability in rcc models  by the corresponding relation mapping of table   
conversely  we can establish  by means of the above tables  that among all the possible
regions satisfying the relation cg  there exists at least one pair in which the regions are
eq  that when cgpp is established  there exists one pair in a pp relation  and finally that
when cno is established  we have two regions in a po relation  the summary of this
correspondence is reported in table   
this correspondence is obtained from the definition of basic relations  two regions a
and b are congruent iff we can roto translate a by a t in such a way that t  a  eq b or
conversely by t   so that t    b  eq a  analogously a is congruent to a part of b iff we can
   

ficristani

rel  of mc   rel  of rcc  
cg
cgpp
cgpp  
cno

eq
pp
pp  
po

table    the basic relations of mc   and their counterparts in rcc   in the special mapping 
 
roto translate a by t so that t  a  pp b  finally two regions are in a cno relation iff they
can only be in a po relation or disjoint 
the correspondence of table   is called 
  and a network of constraints g on mc  
translated in rcc   by it is denoted by 
 g    the networks which are labelled on all edges
by basic relations of mc   are henceforth called scenarios of mc   
consider a consistent scenario s of mc    applying the composition tables of mc   and
rcc    we clearly derive that the scenario of rcc   
 s   is consistent  when the scenario
of mc   does so  the consequence of above reasoning is the next lemma 

lemma   if a scenario on mc   is consistent  then 
 g   is consistent 
ladkin and maddux        proved that a network of constraints is consistent iff it has a
consistent scenario  therefore  an immediate consequence of lemma   is that if a network
of constraints g on mc   is consistent  then 
 g   is consistent  we are now able to prove
a first theorem 

theorem   msat mc    is np hard 
proof

by the observation about existence of consistent scenarios in a constraint algebra due
to mackworth and freuder         we obtain a polynomial reduction of rsat rcc    to
msat mc    
it suces to note that if we can solve msat then we can solve rcc   problems obtained
by the 
 translation as well  now  the problems mapped from mc   into rcc   by means
of 
 can be trivially inverted by 
     since 
 is trivially one to one  this means that each
problem in the set of relations obtained in rcc   by 
 corresponds to a problem in mc   
and vice versa 
the set of relations of rcc   translated by 
 contains fpp  pp   g and po   nebel and
renz         proved that each set of relations of rcc   containing these two relations is
intractable  therefore the set 
 mc      is intractable 
this proves that if we are able to solve a problem in mc   we can solve a problem of a
subset of rcc   which is intractable  therefore msat mc    is np hard 


   

fithe complexity of reasoning about spatial congruence

mackworth and freuder        also proved that backtracking can be applied to csps  the
backtracking algorithm is usually implemented by a linear non deterministic technique 
being therefore a polynomial algorithm on non deterministic machines 
the backtracking technique is applicable to mc   as well  so we can perform a polynomial solution of msat on nondeterministic machines  this shows that msat is in np 
and allows us to claim 

theorem   msat mc    is np complete 
because of this negative result a deep investigation is needed to define tractable subclasses of the set of    relations which allow us to perform polynomial analysis for at least
a subset of the networks of constraints definable on mc   
in this paper we give the definition of the three maximal tractable subclasses of mc   exhibiting therefore a complete classification of tractability for the algebra  the three
maximal tractable subclasses have already been studied by anger  mitra and rodriguez in
        they obtain maximality of the algebras  and exhibited o n    algorithms  we have
three main differences here with respect to their paper 
   the number of classes we individuated is lower than theirs  because they found four
maximal tractable subclasses  they failed to note that one of the four subalgebras is
a subset of another one  in table    the subalgebra m   corresponds to the fourth
algebra of anger  mitra and rodriguez  this subalgebra is tractable  but not maximal 
   the algorithms we exhibit are all o n    while anger  mitra and rodriguez exhibited
only an o n    algorithm for one of the three maximal subsets 
   our classification is complete  thus any subset of mc   which is not a subset of one of
the three maximal tractable subalgebras we individuated is intractable  anger  mitra
and rodriguez did not find this result  since they did not analyse all the subalgebras
of po time algebra  as we did for mc   

   maximal tractable subclasses of mc  

given a subset s of a constraint algebra a  we indicate by sb the set formed by all the
relations of a which can be written as expressions of the algebra involving only elements
of s and the operations of composition  intersection and converse of relations  this set is
often called the transitive closure of s with respect to the operations above  we refer to it
as the closure of s   a set s which coincides with its closure is called a subalgebra 
in the previous section we recall the result on np completeness for mc    the first
important observation on the complexity of subalgebras is that  when a subalgebra b does
not contain the empty relation  then a network of constraints on b cannot entail a strict
contradiction  then it is consistent  so far  the problem is necessarily polynomially solvable 
because it is o     this is stated in the next lemma 

lemma   given an algebra a  if a subalgebra b of a does not contain the empty relation 
then sat b  is polynomial 

   

ficristani

the main consequence of lemma   is that we can limit ourselves in the analysis of
subalgebras in mc   to these subalgebras which contain the empty relation 
moreover  since a network of constraints represents the relations in an implicit way 
when an edge of a network is not labelled we should interpret it as representing the universal
relation  therefore  the universal relation should be a member of the subalgebras to which
we are interested in  we call algebras which contain both the empty and the universal
relations expressive algebras 
there are     expressive subalgebras  we denominate mi where i varies between   to
     in tables                   of appendix a  the     expressive subalgebras of mc   are
listed 

lemma   given a subset a of mc    a is an expressive subalgebra iff a is one of the
subalgebras mi with i between   and      

proof

consider a subset a of mc    we test the closure of a by a lisp program which computes
the closure by composition  intersection and converse of a subset of mc    and test the
presence of empty and universal relation in a by the obvious membership test  the lisp
procedure transitive closure is listed in online appendix    which accompanies this
article  the test succeeds for the subalgebras mi with i between   and     and fails for all
the other                   subsets of mc    the claim is therefore proved 


the following technical lemma shows that some of the     subalgebras individuated
above are np hard  there are    subalgebras of the     which are intractable by lemma
   the algebras are presented in table   of appendix a  the proof of lemma   is a trivial
consequence of the proof of theorem   

lemma   given a subalgebra a of mc    if a contains the relations cno and fcgpp 
cgpp   g then msat a  is np hard 
in the next three subsections we show that three maximal tractable subclasses of mc   can
be found  so that the only intractable algebras are the    listed in table   of appendix a 

    the cg  complete subalgebra m  

  is tractable  jonsson and drakengren        observed
when proving that the class r  
that any subalgebra of rcc   containing only relations including eq is tractable  this
result applies also to mc   with respect to the relation cg  and also to the relations cno 
fcgpp  cgpp  g  fcg  cnog  fcg  cgpp  cgpp  g 
the only relevant cases are cg   cno and fcgpp  cgpp   g   since the other two
cases are included in two of the former three  an algebra formed by relations which all
contain cg and by the relation   is tractable  because we can obtain an inconsistency
iff we explicitly have an edge labelled by   in the network  deciding the consistency is
therefore an o n    problem 

   

fithe complexity of reasoning about spatial congruence

algorithm m   consistency
a constraint network t on m  

input 

output 

  

  

yes if t has a solution formed by spatial regions of r    no if not 

for

each edge in t   hx  yi
if the label on hx  y i is  

then return inconsistency

loop

return consistency
figure    algorithm m   consistency 

m     f   cg  fcg  cgppg  fcg  cgpp  g  fcg  cnog  fcg  cgpp  cgpp  g 
fcg  cgpp  cnog  fcg  cgpp    cnog   g 
since no contradiction derives from a relation in m   except for    algorithm m    consistency
 see figure    solves the consistency checking problem for a network of constraints on m    
thus we can claim the following theorem 

theorem   algorithm m    consistency correctly decides the consistency of a network of
constraints t on m   in o n    time where n is the number of vertices in t  
the immediate consequence of theorem   is the following theorem 

theorem   msat m     is polynomial 
the subalgebras included in m   are in table   of appendix a 
the    subalgebras of table   are not the only subalgebras which can be theoretically
obtained based on the method incorporated in algorithm m    consistency  the same algorithm can be applied to subalgebras formed only with relations containing a symmetrical
relation in mc   and the empty relation  then we can also prove the polynomiality for
subalgebras of relations all containing cno  or all containing fcgpp  cgpp   g  if such subalgebras exist  the subalgebra formed by relations containing cno and the empty relation
is m     the subalgebra formed only by relations containing fcgpp  cgpp   g is m     in
table   and in table   of appendix a the subalgebras of m   and of m   are shown 
in the next subsection we introduce a maximal tractable subclass which includes m    
and in subsection     we introduce an algebra containing m     so that the proof of tractability for subalgebras in tables   and   can be derived from these tables as well  conversely 
the subalgebra m   is neither a subalgebra of m   nor a subalgebra of m     so theorem  
is an independent result 
   

ficristani

    the maximal tractable subclass m  

we look for a maximal tractable subalgebra containing all the basic relations  the best
candidate  based on table    is m     which is the only algebra formed by more than   
relations which can be polynomial  because we did not show that it is np hard by reducing
it to an intractable problem over rcc   
m     f   cg  cgpp  cgpp    cno  fcg  cgppg  fcg  cgpp  g  fcg  cnog 
fcgpp  cnog  fcgpp     cnog  fcg  cgpp  cnog  fcg  cgpp    cnog   g 
fortunately  we can prove the tractability of m     so it is maximal based on the fact
that all algebras containing the basic relations are either intractable by table   or subsets
of m    
consider the subset of m    
g     ffcg  cgppg  fcg  cnog  fcgpp  cgpp    cnogg 
the following claim holds 

lemma   gd     m    
proof

the following expressions represent valid implementations of relations in m   using only
elements of g   and the operators of composition  intersection and converse 
t   

 

  fcg  cgppg

t   

cg

 fcg  cnog
fcgpp  cgpp    cnog
  fcg  cgppg  fcg  cgppg  



t   

cgpp

  fcg  cgppg  fcgpp  cgpp     cnog

t   

cgpp  

  fcg  cgppg    fcgpp  cgpp     cnog

t   

cno

  fcg  cnog  fcgpp  cgpp     cnog

t   

 

  fcg  cgppg 
 fcgpp  cgpp     cnog

t   

fcg  cgpp  g

  fcg  cgppg  

t   

fcgpp  cnog

   fcg  cgppg

t   

fcgpp    cnog

t     fcg  cgpp  cnog


 fcg  cnog  
 fcgpp  cgpp    cnog
   fcg  cgppg   
 fcg  cnog  
 fcgpp  cgpp    cnog
  fcg  cgppg 
 fcg  cnog

t     fcg  cgpp     cnog

  fcg  cgppg   
 fcg  cnog
   

fithe complexity of reasoning about spatial congruence


a network of constraints t on m     implemented by means of lemma   is denoted henceforth by      t   
we can derive a contradiction from a network of constraints iff the network derives two
relations r  and r    between one pair of vertices such that r    r       the ways in
which a contradiction can be derived in networks labelled by relations of m     based on the
intersections of relations  except the empty relation which obviously generates a contradiction by itself  are 
a 
b 
c 
d 
e 
f 
g 
h 
i 
l 
m 
n 

cg
cg
cg
cg
cgpp
cgpp
cgpp
cgpp
cgpp
cgpp
cno
fcg  cgppg














cgpp
cno
fcgpp  cnog
fcgpp  cgpp    cnog
cgpp  
cno
fcg  cgpp  g
fcg  cnog
fcgpp     cnog
fcg  cgpp    cnog
fcg  cgppg
fcgpp     cnog

this is simply obtained by considering all pairs of relations in m   whose intersection is
empty 
in g   the contradictions are only 
fcg  cgppg  fcg  cgppg    fcgpp  cgpp    cnog and
fcg  cgppg  fcg  cnog  fcgpp  cgpp     cnog  
henceforth we represent the relation fcg  cgppg by    the relation fcg  cnog by   
and the relation fcgpp  cgpp     cnog by    since any path in which labels are all corresponds to the representation of   between each pair of vertices in the path  and 
         the possible expressions for contradictions in g   are   n 
   n     and   n

    n k  
    
   k       hence  a cycle   n 
   n  is called a   cycle  while a cycle
  n 
    n k  
    
   k   is called a quasi   cycle  the graph representation of these
two different contradictory situations in g   is showed in figure    a   cycle and a quasi
  cycle  in m   force the elements involved in the cycle to be all in the relation cg  
we can now show that the contradictions represented in g   are the only contradictions
which can be obtained by the implementation suggested in lemma    this is very important 
because we may perform consistency checking by simply checking all cycles  this result is
stated in the next lemma 

lemma   given a network of constraints t on m     t is inconsistent iff     t   contains
either a   cycle of a quasi   cycle  and two vertices of one cycle are connected by an edge
labelled by   
   

ficristani

proof  sketch 

case by case  the contradictions from a  to n   as in the table above  generate one of the
two situations of the claim 
for example  the contradiction a  cg  cgpp   generates
 fcg  cgppg 
 fcg  cgppg       fcg  cgppg  fcgpp  cgpp     cnog  
which is a   cycle in which two vertices are connected by an edge labelled by    as stated
in the claim  all the other cases behave in the same way as can be easily checked by the
reader 
conversely  if a contradiction derives from one of the possible implicit ways of representing relations in m     the implementation also produces one of the cases of the claim 
in particular we have that  in m     cgn   cg   cgppn   cgpp    cgpp    n   cgpp    
fcg  cgppgn   fcg  cgppg and fcg  cgpp   gn   fcg  cgpp  g are the only idempotent relations  the other cases of implicitness can be obtained by considering all the
             pairs of relations in m     composing and intersecting them  the implicit cases
arising thus are listed in below 
i   

cg

  fcg  cgppgn  fcg  cgpp   gn

i   

cg

  fcg  cgppgn  fcg  cnog

i   

cgpp

  fcg  cgppgn  fcgpp  cnog

i   

cno

  fcg  cnog  fcgpp  cnog

i   

cno

  fcgpp  cnog  fcgpp     cnog

i   

cno

  fcgpp  cnog  fcg  cgpp     cnog

i   

fcg  cnog

  fcg  cgpp  cnog

i   

fcgpp  cnog

  cgppn 
 cno

i   

fcgpp  cnog

  cgppn 
 fcg  cnog

fcg  cgpp    cnog



i     fcgpp  cnog

  cgppn 
 fcg  cgpp  cnog

i     fcgpp  cnog

  fcg  cgppgn 
 cno

i     fcgpp  cnog

  fcg  cgpp  cnog

fcgpp  cgpp    cnog
i     fcg  cgpp  cnog   fcg  cgppgn 
 fcg  cnog



readers may directly express in g   each of these relations along with the corresponding
   

fithe complexity of reasoning about spatial congruence

figure    contradictions in g     fg indicates   and r  s  t respectively fcg  cgppg 
fcg  cnog and fcgpp  cgpp    cnog 
relation producing a contradiction in m   and they immediately verify the existence of  cycles or quasi   cycle where one pair of vertices is connected by an edge labelled by   for
these generated graphs 
for example if we express cg as implicit relation by i    as in table above  formed by
relations in g      cgpp as implicit relation by i    and fcgpp  cnog by     as in t    
and consider the contradiction cg  cgpp we obtain a quasi   cycle where two vertices
are connected by an edge labelled by    similarly we can derive the other cases 



we can now exhibit an algorithm which looks for   cycles and quasi   cycles  and
checks about pairs of a cycle being connected by an edge labelled by   
in figure   an algorithm able to solve the consistency checking problem for networks
of constraints labelled by relations in m   is presented  based on lemma   we can prove
the following theorem 
theorem   algorithm m   consistency correctly decides the consistency of a network of constraints t on m   in o n    steps where n is the number of vertices of t  

proof

by lemma   we can ensure the correctness of algorithm m   consistency  the complexity of the algorithm can be derived from the fact that the computation of strongly
   

ficristani

figure    contradictions in m     r  s  t respectively indicate fcg  cgppg 
fcg  cnog and fcgpp  cgpp    cnog  letters from a  to n  refer to the
table of page     
   

fithe complexity of reasoning about spatial congruence

algorithm m   consistency
a constraint network t on m  

input 

output 

  
  
  
  
  

yes if t has a solution formed by spatial regions of r    no if not 

translate t into the generator set as in lemma  
look for cycles labelled by   and at most one   
check whether edges between two vertices in one cycle are not labelled by  
otherwise return no 
substitute vertices of the cycle with one vertex 
if there are more cycles go to step     otherwise return yes 
figure    algorithm m   consistency

connected components is a o e  problem where e is the number of edges in the network 
the     implementation adds  in the worst case  o e    edges  where e  is the number of
edges in t   and therefore the number of edges in      t   is o    e     which is o n    



an immediate consequence of theorem   is the following theorem 

theorem   msat m     is polynomial 
the subalgebras of mc   included in m   are in table    of appendix a 

    the maximal tractable subclass m  

the problem of deciding the consistency of a network of constraints on mc   is tractable 
by means of tables         and    for    subalgebras  the remainder is formed by   
subalgebras  each of these can be either tractable or intractable  the set
m     f    cg  cgpp  cgpp    fcg  cgppg  fcg  cgpp  g  fcgpp  cgpp  g 
fcg  cgpp  cgpp  g  fcgpp  cgpp     cnog   g
contains all these subalgebras  so that if m   is tractable all these algebras are as well 
by analogy with the schema of the previous section we look for a small generator set
for m     this is g     ffcg  cgppg  fcg  cgpp  cgpp   g  fcgpp  cgpp     cnogg 
the following lemma states the properties of m   with respect to g    
lemma   gd     m    

proof

the following expressions represent valid implementations of relations in m   using only
elements of g   and the operators of composition  intersection and converse 
   

ficristani

r     

  fcg  cgppg  fcg  cgppg

r    cg

  fcg  cgppg  fcg  cgppg  

r    cgpp

  fcg  cgppg  fcgpp  cgpp     cnog

r    cgpp  

  fcg  cgppg    fcgpp  cgpp     cnog

r    fcg  cgpp   g

  fcg  cgppg  

 fcgpp  cgpp     cnog

r    fcgpp  cgpp   g   fcg  cgpp  cgpp   g

fcgpp  cgpp     cnog

 



  fcg  cgppg 
 fcgpp  cgpp     cnog

r     


the implementation of relations in m   as described in lemma   is denoted by       the
contradictions in m   are as in the next table 
a 
b 
c 
d 
e 

cg
cg
cg
cgpp
cgpp







cgpp
fcgpp  cgpp  g
fcgpp  cgpp    cnog
cgpp  
fcg  cgpp  g

the only possible contradiction in g   is

fcg  cgppg  fcg  cgppg    fcgpp  cgpp    cnog
and it corresponds to a   cycle where two vertices are connected by an edge labelled by   
lemma   given a network of constraints t on m     t is inconsistent iff     t   contains
a   cycle and two vertices of one cycle are connected by an edge labelled by   
proof  sketch 

case by case  the contradictions from a  to e   as in the table above  generate one of the
two cases claimed here 
for example  the contradiction cg  fcgpp  cgpp   g   is implemented
 fcg  cgppg  fcg  cgppg       fcg  cgpp  cgpp   g
 fcgpp  cgpp    cnog  
which is a   cycle in which two vertices are connected by an edge labelled by    as stated
in the claim  all the other cases behave in the same way as can be easily checked by the
reader 
the only possible ways of representing implicit relations are provided by the schema of
      therefore the claim is proved 
   

fithe complexity of reasoning about spatial congruence

figure    contradictions in m    
r  s  t respectively indicate fcg  cgppg 
 
 
fcg  cgpp  cgpp g  fcgpp  cgpp    cnog  letters from a  to e  refer to
the table of page     

algorithm m   consistency
a constraint network t on m  

input 

output 

  
  
  
  
  

yes if t has a solution formed by spatial regions of r    no if not 

translate t into the generator set as in lemma  
look for cycles labelled by check whether edges between two vertices in one cycle are not labelled by  
otherwise return no 
substitute vertices of the cycle with one vertex 
if there are more cycles go to step     otherwise return yes 
figure    algorithm m   consistency
   

ficristani


in figure   an algorithm is presented which solves the problem of consistency checking for
the subalgebra m     we can show  in particular  the following claim 

theorem   algorithm m   consistency correctly decides the consistency of a network of constraints t on m   in o n    steps where n is the number of vertices of t  
proof

by lemma   we can ensure the correctness of algorithm m   consistency  the complexity of the algorithm can be derived from the fact that the computation of strongly
connected components is a o e  problem where e is the number of edges in the network 
the     implementation adds  in the worst case  o e    edges  where e  is the number of
edges in t   and therefore the number of edges in      t   is o    e     which is clearly o n    


an immediate consequence of theorem   is the following

theorem   msat m     is polynomial 
the subalgebras included in m   are in table   of appendix a 

   conclusions

we presented a classification of tractability which is complete for the spatial algebra mc   
this classification states that there exist three maximal tractable subalgebras m     m  
and m   which include    out of     expressive subalgebras of mc   
the interest in a complete classifications of tractability  as already observed by jonsson
and drakengren         is determined by the need for a definition of the boundary between
tractable and intractable problems  nebl        has suggested that the knowledge of this
boundary can be used either as preprocessing step and as a way to structure the backtracking
search on such algebras 
the provision of a complete classification is one step in researching about constraint
algebras  a next step is the individuation of useful heuristics which give improvements in the
performances of various techniques  we are currently exploiting the use of these techniques
in association with techniques based on the classification presented in this paper to obtain
ecient reasoning algorithms which can be used in practice  preliminary results on pathconsistency are encouraging  but we cannot yet guarantee the percentage of improvement 
since the algebra mc   is so simply structured that for networks randomly chosen it is very
hard to obtain a case where inconsistency is not detectable by path consistency 

acknowledgements

i would like to thank elena mutinelli who developed her laurea thesis  mutinelli       
on the theme of complexity of reasoning about congruence and first discussed preliminary
   

fithe complexity of reasoning about spatial congruence

results which i used for developing the classification of this paper  her work has been very
relevant in reaching my results 
i would also like to thank bernhard nebel for some important observations he made to
a student of mine  alessandro fin  which improved this work  further thanks go to jochen
renz for discussions in the early stages of this work 
i would also like to thank the anonymous referees of the journal of artificial intelligence
research for their very careful comments and suggestions which allowed me to make the
presentation simpler and more systematical  some of the proofs in the paper have been
rewritten thanks to their suggestions 
finally i would like to thank tony cohn for reading a near final version  his comments
have been useful in enhancing both scientific and literary quality of the paper 
this work has been developed in the context of the national project  murst ex    
 metodologie e tecnologie per la gestione di dati e processi su reti internet ed intranet 
 methods and technologies for data and process management on internet and intranet 
directed by l  tanca 

   

ficristani

appendix a  tables of the     subalgebras of mc  

in this section we present the subalgebras of mc   organized in separated tables depending
on their characteristics  in particular table   shows those subalgebras which are intractable
by lemma    table   those which are tractable by theorem    and in tables      those
to which algorithm used in theorem   can be applied  which are all including cno or
fcgpp  cgpp  g    in table    the subalgebras included in m   are displyed  while in
table   we present the subalgebras included in m    
rel 

alg 

m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m   
m   



cg
cgpp
cgpp  
cno






















  
  


    

     

     





































































 
 





  
  



























































 















































 
 
  
table    the subalgebras of mc   containing the relations cno and fcgpp  cgpp   g

   

fithe complexity of reasoning about spatial congruence



rel  cg

alg 

m 
m 
m 
m 
m 
m  
m  
m  
m  
m  
m  
m  
m  

cgpp
cgpp  
cno















m 
m 
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  













 






 











  
  



cgpp
cgpp  
cno














 

  
  


    

     

     















 


 


 
 
 





















 
  
table    the subalgebras of mc   contained in m    

rel  cg

alg 

  
  


    

     

     





















 





 

  
table    the subalgebras of mc   contained in m   and not contained in m    
   

ficristani



rel  cg

alg 

cgpp
cgpp  
cno



  
  

    

     

     








 

 
table    the subalgebras of mc   contained in m   and not contained in m   or m    
m 
m  
m  
m  

rel  cg

alg 

m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  

cgpp
cgpp  
cno

































  
  


    

     

     





























 
 



  
  
 
 

 
  
  
  
  
  
  





 
 
























  
  

  


table    the subalgebras of mc   contained in m   and not contained in m   or m   or
m   or m    

   

fithe complexity of reasoning about spatial congruence



rel  cg

alg 

cgpp
cgpp  
cno




 




 

 




 

 


 

 

 

 

 
 

 
 
 

  
  

    

     

     









 






 



 


 


 
  

 
 


  



  

 
 
 
 

 
  

  
 
 
 
 

  
 
 



     
 
 
 
 
  
 
   
 

 
     
 
  
 

      
 
     
   
 
 
 
      
 
      
      
 
          
table     the subalgebras of mc   contained in m   and not contained in m   or m   or
m    
m 
m 
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  
m  








































   

ficristani

references
anger  f   mitra  d     rodriguez  r          temporal constraint networks in nonlinear
time  in workshop notes of the spatial and temporal reasoning at ecai   brighton 
uk 
anger  f   mitra  d     rodriguez  r          satisfiability in nonlinear time  algorithms
and complexity  in proceedings of the florida artificial intelligence research society
conference orlando  usa  
bennett  b          spatial reasoning with propositional logic  in doyle  j   sandewall  e  
  torasso  p   eds    proceedings of the  th international conference on principles of
knowledge representation and reasoning  kr      pp           morgan kaufmann 
san francisco  ca  usa 
bennett  b          carving up space  existential axioms for a formal theory of spatial
regions  in proceedings of the ijcai    workshop on spatial and temporal reasoning
montreal 
borgo  s   guarino  n     masolo  c          a pointless theory of space based on
strong connection and congruence  in aiello  l  c     doyle  j   eds    proceedings
of the  th international conference on principles of knowledge representation and
reasoning  kr      morgan kaufmann  san francisco  ca  usa 
borgo  s   guarino  n     masolo  c          an ontological theory of physical objects 
in ironi  l   ed    proceedings of eleventh international workshop on qualitative
reasoning  qr        pp          cortona  italy 
clarke  b  l          a calculus of individuals based on  connection   notre dame
journal of formal logic              
cook  s  a          the complexity of theorem proving procedures  in proceedings of the
 rd symposium on theory of computation  pp          
cristani  m          morphological spatial reasoning  preliminary report  tech  rep 
       ladseb cnr padova  italy  
cui  z          using interval logic for order assembly  in proceedings of the second international conference on intelligent systems in molecular biology  pp           aaai
press 
drakengren  t     jonsson  p          twenty one large tractable subclasses of allen s
algebra  artificial intelligence                    
egenhofer  m  j          reasoning about binary topological relations  in gunther  o    
schek  h  j   eds    advances in spatial databases second symposium ssd      no 
    in lecture notes in computer science  pp           springer verlag  new york 
ny  usa 
   

fithe complexity of reasoning about spatial congruence

egenhofer  m  j     franzosa  r          point set topological spatial relations  international journal of geographical information systems                 
egenhofer  m  j     herring  j          a mathematical framework for the definition
of topological relationships  in fourth international symposium on spatial data
handling  pp          zurich  switzerland 
franzosa  r     egenhofer  m  j          topological spatial relations based on components and dimensions of set intersections  in spie s oe technology     vision
geometry boston  ma  usa 
gotts  n  m          how far can we  c   defining a  doughnut  using connection
alone  in doyle  j   sandewall  e     torasso  p   eds    proceedings of the  th
international conference on principles o f knowledge representation and reasoning
 kr      pp           morgan kaufmann  san francisco  ca  usa 
gotts  n  m   gooday  j  m     cohn  a  g          a connection based approach to
commonsense topological description and reasoning  the monist  an international
journal of general philosofical inquiry         
grigni  m   papadias  d     papadimitriou  c          topological inference  in mellis  c 
 ed    proceeding of the   th international joint conference on artificial intelligence
 ijcai      pp          montreal  pq  canada  morgan kaufmann 
jonsson  p     drakengren  t          a complete classification of tractability in the spatial theory rcc    journal of artificial intelligence research              research
note 
jonsson  p   drakengren  t     backstrom  c          computational complexity of relating
time points with intervals  artificial intelligence                     
ladkin  p     maddux  r          on binary constraint problems  journal of the acm 
                
lemon  o  j          semantical foundations of spatial logics  in aiello  l  c     doyle  j 
 eds    proceedings of the  th international conference on principles o f knowledge
representation and reasoning  kr      morgan kaufmann  san francisco  ca  usa 
mackworth  a     freuder  c          the complexity of some polynomial network consistency algorithms for constraint satisfation problems  artificial intelligence         
      
mutinelli  e          sviluppo ed analisi di algoritmi per il ragionamento spaziale qualitativo con reti di vincoli  laurea thesis  universita di verona  in italian 
nebel  b          computational properties of qualitative spatial reasoning  first results  in
advances in artificial intelligence  ki      pp          bielefeld  germany  springerverlag  new york  ny  usa 
   

ficristani

nebel  b          observations on the complexity of reasoning in constraint algebras 
personal communication to a  fin and m  cristani 
nebel  b     burckert  h  j          reasoning about temporal relations  a maximal
tractable subclass of allen s interval algebra  journal of the acm                
randell  d  a     cohn  a  g          modelling topological and metrical properties
of physical processes  in brachman  r  j   levesque  h  j     reiter  r   eds   
proceedings of the  st international conference on knowledge representation and
reasoning  kr      pp        toronto  on  canada  morgan kaufmann 
randell  d  a   cui  z     cohn  a  g          a spatial logic based on regions and
connection  in swartout  b     nebel  b   eds    proceedings of the  rd international
conference on principles of knowledge representation and reasoning  kr      pp 
        cambridge  ma  usa  morgan kaufmann 
renz  j          maximal tractable fragments of the region connection calculus  a
complete analysis  in proccedings of the   th international conference on artificial
intelligence  ijcai     
renz  j     nebel  b          on the complexity of qualitative spatial reasoning  a maximal
tractable fragment of the region connection calculus  artificial intelligence                   
statman  r          intuitionistic logic is polynomial space complete  theoretical computer
science               
zimmermann  k          measuring without measures  the  calculus  in proceedings of
the international conference on spatial information  pp        

   

fi