journal of artificial intelligence research                  

submitted        published       

reasoning about topological and cardinal direction relations
between   dimensional spatial objects
anthony g  cohn

a g c ohn   leeds   ac   uk

school of computing  university of leeds  uk
faculty of engineering and information technology 
university of technology sydney  australia

sanjiang li

s anjiang  l i   uts   edu   au

amss uts joint research lab 
centre for quantum computation   intelligent systems 
university of technology sydney  australia
college of computer science  shaanxi normal university  china

weiming liu

l iu w eiming   baidu   com

baidu  china  co   ltd   shanghai  china

jochen renz

j ochen  r enz   anu   edu   au

research school of computer science 
the australian national university  australia

abstract
increasing the expressiveness of qualitative spatial calculi is an essential step towards meeting the
requirements of applications  this can be achieved by combining existing calculi in a way that
we can express spatial information using relations from multiple calculi  the great challenge is
to develop reasoning algorithms that are correct and complete when reasoning over the combined
information  previous work has mainly studied cases where the interaction between the combined
calculi was small  or where one of the two calculi was very simple  in this paper we tackle the
important combination of topological and directional information for extended spatial objects  we
combine some of the best known calculi in qualitative spatial reasoning  the rcc  algebra for
representing topological information  and the rectangle algebra  ra  and the cardinal direction
calculus  cdc  for directional information  we consider two different interpretations of the rcc 
algebra  one uses a weak connectedness relation  the other uses a strong connectedness relation 
in both interpretations  we show that reasoning with topological and directional information is decidable and remains in np  our computational complexity results unveil the significant differences
between ra and cdc  and that between weak and strong rcc  models  take the combination of
basic rcc  and basic cdc constraints as an example  we show that the consistency problem is
in p only when we use the strong rcc  algebra and explicitly know the corresponding basic ra
constraints 

   introduction
qualitative spatial reasoning  qsr  is a multi disciplinary research field that aims at establishing
expressive representation formalisms of qualitative spatial knowledge and providing effective reasoning mechanisms  originating from allens work        on temporal interval relations  qsr has
been widely acknowledged as the ai approach to spatial knowledge representation and reasoning 
with applications ranging from natural language understanding  davis         robot navigation  shi 
jian    krieg bruckner        falomir         geographic information systems  giss   egenhofer
c
    
ai access foundation  all rights reserved 

fic ohn   l i   l iu     r enz

  mark         sea navigation  wolter et al          to high level interpretation of video data  sridhar  cohn    hogg        cohn  renz    sridhar         we refer the reader to the work of cohn
and renz         and wolter and wallgrun        for more information 
the qualitative approach usually represents spatial information by introducing a relation model
on the domain of spatial entities  which could be points  line segments  rectangles  or arbitrary
regions  in the literature  such a relation model is often called a qualitative calculus  ligozat  
renz         which contains a finite set of jointly exhaustive and pairwise disjoint  jepd  relations
defined on the domain  in the past three decades  dozens of spatial relation models have been
proposed in the literature  cohn   renz        chen  cohn  liu  wang  ouyang    yu        
many of these qualitative calculi approximate spatial entities by points  while this is convenient
when representing spatial direction  distance and positions  providing the extent of the objects is
small compared to their distance apart   it is inappropriate as far as the shapes and or topology
of the spatial objects are concerned  in this paper  we represent spatial entities as   dimensional
bounded regions in the real plane  which may have holes or multiple connected components 
in the literature  most spatial calculi focus on one single aspect of space  e g  topology  direction  distance  position  or shape  topological relations are those relations that are invariant under
homeomorphisms such as scale  rotation  and translation  it is widely acknowledged that topological relations are of crucial importance  one influential formalism for topological relations is the
region connection calculus  rcc   randell  cui    cohn         based on one primitive binary
connectedness relation  a set of eight jepd topological relations can be defined in the rcc  this
calculus is known as the rcc  algebra  according to different interpretations of connectedness 
this calculus may have different variants  in this paper  we say two  closed  regions are weakly connected if they share at least a common point  and say they are strongly connected if their intersection
is at least one dimensional  accordingly  we address the two resulting rcc  algebras as the weak
and the strong rcc  algebras respectively  for convenience  we denote the weak rcc  algebra as
rcc   and the strong one as rcc    
the importance of the distinction between strong and weak rcc  becomes clear when analysing
the different ways of defining the neighbourhood of pixels commonly used in computer vision   connectedness refers to the pixels that are horizontally and vertically connected to a pixel  while
  connectedness includes the diagonally neighbouring pixels as well  this distinction corresponds
nicely to the distinction between strong and weak rcc  as   connectedness considers connections at a point  while   connectedness only considers connections along a line  which is onedimensional   therefore  we can use strong or weak rcc  in a similar way we use    or  connectedness  depending on the requirements of the application at hand 
the rcc  algebra only represents topological information between spatial objects  in many
practical applications  however  other kinds of relations are often used together with topological
relations  for example  when recommending a restaurant you dined at before it is common to give
descriptions such as the restaurant is in the city centre  west of the central station  and nearby there
is a mcdonalds 
among all these aspects of spatial information other than topology  directional relations are
perhaps the most important  there are two well known formalisms that can cope with directional
relations between extended spatial objects  one is the rectangle algebra  ra   balbiani  condotta 
  farinas del cerro         the other is the cardinal direction calculus  cdc   goyal   egenhofer 
      skiadopoulos   koubarakis         when representing the direction of a primary object
to a reference object  ra approximates both the reference object and the primary object by their
   

fir easoning about t opological and c ardinal d irection r elations

minimum bounding rectangles  mbrs   and relates the two objects by the interval relations between
the projected intervals  on the other hand  cdc only approximates the reference object by its mbr 
while leaving the primary object unchanged  the cdc has     basic relations  and ra has    
basic relations  most      out of      basic cdc relations intersect with one and only one basic
ra relation and  hence  are contained in a unique basic ra relation  therefore  cdc is in a sense
more expressive than ra 
a central reasoning problem in qsr is the consistency problem  an instance of the consistency
problem is a set  of constraints like  xy   where x  y are spatial variables  and  is a qualitative
relation from a qualitative calculus  we say  is consistent or satisfiable if there exists an instantiation of the spatial variables such that all constraints in  are satisfied  without loss of generality 
we assume that there is a unique constraint between any two variables  note that if x and y are not
related  we can add  x   y  in  without changing its consistency  where   is the universal relation
in the calculus  unlike classical csps  the domain of a spatial variable is usually infinite  and it may
be undecidable to determine the consistency of binary csps with infinite domains  hirsch        
in the past three decades  qsr has made significant progress in solving the consistency problems
for a variety of qualitative calculi  renz   nebel        renz        balbiani et al         zhang 
liu  li    ying        skiadopoulos   koubarakis        liu  zhang  li    ying        liu   li 
      
in order to bring spatial reasoning theory closer to practical applications  it is necessary to
combine multiple aspects of spatial information  a growing number of works have been devoted to
combining topological rcc relations with other aspects of spatial information  e g  qualitative size
 gerevini   renz         cardinal directions  sistla   yu        li      a        liu  li    renz 
      li   cohn         connectivity  kontchakov  nenov  pratt hartmann    zakharyaschev 
       convexity  davis  gotts    cohn        schockaert   li         betweenness  schockaert
  li         and gravity  ge   renz         recently  wolfl and westphal        also empirically
compared two approaches to the combination of binary qualitative constraint calculi in general 
there are also interesting works on combining spatial and temporal formalisms  gerevini   nebel 
      gabelaia  kontchakov  kurucz  wolter    zakharyaschev         moreover  in other subareas
of formalisms of constraint research  combination of formalisms has been discussed for a long time
and there are some very strong results  see e g  the work by bodirsky and kara         and jonsson
and krokhin        
the current paper considers the full combination of rcc  and rcc   with the two directional
relation models ra and cdc  we identify the joint satisfaction problem  jsp  as the main reasoning
task  given a network of topological  rcc  or rcc     constraints  and a network of directional
 ra or cdc  constraints   assuming that  and  involve the same set of variables  the jsp is to
decide when the joint network     is satisfiable  note that we use    instead of   to indicate
that  and  are over the same variables 
since topological and directional information is not independent  it is possible that the joint
network     is unsatisfiable while both  and  are satisfiable  solving the joint satisfaction
problem is in general harder than solving  and  independently  in this paper  we interpret directional relations in terms of ra and cdc  and interpret topological relations in terms of the weak
and the strong rcc  algebras  when only basic constraints are involved  we show that the jsp
for basic  weak or strong  rcc  and basic ra networks can be solved in polynomial time  but the
jsp for basic  weak or strong  rcc  and basic cdc networks is np complete  furthermore  we
show that  when the three calculi  viz  rcc   ra  and cdc  are combined together  the jsp for
   

fic ohn   l i   l iu     r enz

basic rcc   networks and basic ra and cdc networks is tractable  since non basic constraints
can always be backtracked to basic constraints  these results show that the jsp over  weak or strong 
rcc  and ra or cdc is in np 
this paper is a significant extension of the conference paper  liu et al          where the combination of basic weak rcc  and ra or cdc constraints was considered  this paper also considers
the combination of rcc   and ra and or cdc constraints  in addition  we extend our tractable
results to two maximal tractable subsets of rcc  and one large tractable subset of ra  this paper
is also closely related to the work of li         and li and cohn         where the combination of
the weak rcc  algebra and two subalgebras  viz  dir  and dir    of ra is considered 
    an application scenario
as an example for demonstrating the usefulness of our results  we use the angry birds domain 
similar representation and reasoning tasks can be applied whenever we use computer vision to
detect objects in image or video  angry birds is a popular computer game that has gained increasing
attention within the ai community  see e g  the work of zhang and renz         the angry birds
ai competition is an ai challenge problem  where the goal is to build an intelligent agent that can
play angry birds better than the best human players  see http   aibirds org  

figure    a screenshot of the angry birds game 
the angry birds domain includes a number of building blocks of different materials  sizes
and shapes  and even with holes  the building blocks form complicated spatial structures that
protect pigs from the attacking birds  see figure     ai agents have to be able to play the game
like humans do  that is they only get visual information about the game in the form of screenshots 
the competition organisers provide a basic computer vision software that detects the minimum
bounding boxes of all objects in a screenshot as well as the object category  so what is given is a
set of rectangles that form the minimum bounding boxes of the actual objects  see figure     while
each object is a solid physical object that cannot overlap another object  only rcc  relations dc
and ec are possible between objects   their bounding boxes can be related in any relation of the
rectangle algebra and any relation in cdc  instead of considering only spatial relations between
single objects  we can also take into account sets of objects  for example  the set of all objects that
are directly or indirectly supported by a particular other object  or the set of all objects that provide
cover for a particular pig  or the set of all wooden blocks 
   

fir easoning about t opological and c ardinal d irection r elations

notations
          
d  r  s  t

 w 
x  y  z vi   vj
    
a  b  c  m
b    q    c 
h
p  q
h
ix  a   iy  a 
m a 

m    mi  ni  
    
x       y     
    
 
jsp s  t  
ra t  
rcc  d 
ccp vi   vj  

meanings
relations  usually basic relations  page     
relations  usually non basic relations  page     
the converse relation of   page     
the weak composition of  and   page     
spatial variable or interval variable  page     
network of constraints  page     
bounded regions  page     
the three maximal tractable subclasses of rcc   page     
points  page     
the unique maximal tractable subclass of ia  page     
the x  and y  projective intervals of region a  page     
the minimal bounding rectangle  mbr  of region a  page     
the ra relation induced by two ia relations     page     
an n tuple of regions mi that form a solution to some network  page     
a consistent pair of basic cdc relations  page     
the x  and y  projective interval relations of       page     
the ra relation x       y      induced by       page     
the combination of two networks over the same set of variables  page     
the joint satisfaction problem over subclasses s and t  page     
the ra relation induced by an rcc  relation t  page     
the rcc  relation induced by an ra relation d  page     
two variables vi   vj have the common conflict point relation  page     
table    notations 

these sets of building blocks form spatial regions in the general sense as used by rcc  and
brcc   wolter   zakharyaschev         which also include regions with multiple disconnected
pieces or regions with holes  in particular  it means that any rcc  relation is possible between two
sets of objects  not just dc or ec 
given spatial configurations in the angry birds domain  we can now use rcc  relations as well
as ra and cdc relations to represent spatial information about  sets of  objects and their minimum
bounding boxes that is extracted from the screenshots  the results of this paper allow us to accurately reason about the combined information represented using rcc   ra  and cdc  important
reasoning tasks that can benefit from our results include  for example  inferring how a configuration
changes after it is hit by a bird or inferring whether a given representation is consistent or whether
it is stable under gravity  zhang   renz         an algorithm for predicting the configuration of
the blocks after a shot might work by envisaging individual possible block positions but these might
be mutually or globally inconsistent  an algorithm for reasoning about the consistency of such
predictions is therefore desirable 
the remainder of this paper proceeds as follows  section   introduces basic notions  important
examples  and essential results of qualitative calculi  section   then describes the joint satisfaction
problem and considers the simple example of the combination of ra and cdc constraints  sections
  and   consider the computational complexity of the combination of weak and  respectively  strong
   

fic ohn   l i   l iu     r enz

rcc  with ra  section   discusses the computational complexity of the combination of weak and
strong rcc  with cdc  we conclude the paper in section   and give proofs of major computational complexity results in the appendices  for the convenience of the reader  table   summarises
notations used in this paper 

   qualitative calculi
the establishment of a proper qualitative calculus is the key to the success of the qualitative approach to temporal and spatial reasoning  this section introduces basic notions of qualitative calculi and recalls the rcc  algebra  the rectangle algebra  and the cardinal direction calculus  in
addition  we will also summarise some essential results that will be used in the main part of the
paper 
    basic notions
let u be the domain of temporal or spatial entities  and rel u  be the set of binary relations on u 
with the usual relational operations of intersection  union  and complement  rel u  is a boolean
algebra  a finite set b of nonempty binary relations on u is jointly exhaustive and pairwise disjoint
 jepd for short  if any two entities in u are related by one and only one relation in b  write hbi
for the subalgebra of rel u  generated by b  clearly  relations in b are atoms in the algebra hbi 
we call hbi a qualitative calculus on u  and call relations in b basic relations of the calculus 
notation  note that each relation in hbi is the union of a set of basic relations  in this paper  we
write r                 k   if r is the union of basic relations              k   for convenience  we
regard each basic relation  as the singleton    
for two relations r  s in a qualitative calculus m   hbi  we write r for the converse of r 
which is defined as
r     x  y   u  u    y  x   r  

   

and write r w s for the smallest relation in m which contains r  s  the usual composition of r
and s  which is defined as
r  s     x  y   u    z  u  x  z   r   z  y   s  
we call r w s the weak composition of r and s  duntsch  wang    mccloskey        
a constraint over hbi has the form  xry   where r is a relation in hbi  we call  xry  a basic
constraint if r is a basic relation in b  an important reasoning problem in a qualitative calculus is to
determine the satisfiability or consistency of a network     vi rij vj  ni j   of constraints over hbi 
where  is satisfiable  or consistent  if there is an instantiation  ai  ni   in u such that  ai   aj    rij
holds for all    i  j  n 
given two constraint networks     vi rij vj  ni j   and     vi tij vj  ni j     we say  refines
 if tij is a subset of rij for any    i  j  n  a consistent scenario of  is a consistent basic
network that refines   it is clear that  is consistent iff it has a consistent scenario  on the other
hand  given an n tuple of entities  ai  ni   in u  write ij for the basic relation in a fixed qualitative
calculus that relates ai to aj   then     vi ij vj  ni j   is a consistent scenario and we call this the
scenario  or basic constraint network  induced by  ai  ni    
   

fir easoning about t opological and c ardinal d irection r elations

the consistency of a constraint network can be partially determined by path consistency algorithms  we say a network     vi rij vj  ni j   is path consistent if

rji   rij
 

    rij  rik w rkj

   

for any i  j and any k    i  j  in case  is a basic network  this is equivalent to saying that every
subnetwork involving three variables of  is consistent 
path consistency can be enforced in cubic time  vilain   kautz         that is  if we apply
the path consistency algorithm on a constraint network   then in cubic time the algorithm will
terminate and we either get an empty constraint  and hence know that  is inconsistent  or transform
 into an equivalent path consistent network  for basic networks  it is easy to see that consistency
implies path consistency  but the opposite proposition does not always hold 
in the following subsections we recall the qualitative topological and directional calculi that will
be discussed in this paper 
    the region connection calculus rcc 
the region connection calculus  rcc   randell et al         is a first order theory based on a binary
connectedness relation  standard rcc models arise from topological spaces  in this paper  we are
only concerned with interpretations of rcc in the real plane  which provides arguably the most
important model for rcc  another reason lies in that the directional calculi considered in this paper
are also defined over the real plane  a plane region  or region  is a nonempty regular closed subset
of the real plane  we only consider bounded regions  as cardinal directions only involve bounded
regions  but these regions could have multi pieces and or have holes  
one standard interpretation of rcc is based on the whiteheadean connectedness  whitehead 
      on plane regions  where two regions are connected if they have a common point  this connectedness may be considered too weak in many cases  for example  a worm cannot pass from the
interior of one apple to another  which touch just at a point  without becoming visible to the exterior  so from the worms point of view we might as well say that the apples are not sufficiently
connected   borgo  guarino    masolo        p       in this paper  we also consider a stronger
connectedness  in which two regions are regarded as connected if their intersection is at least onedimensional  li  liu    wang         in the case of a rectangular grid of spatial primitive entities 
as already noted  strong and weak connectedness correspond to  respectively  the important notion
of    and   neighbourhood of pixels commonly used in computer vision 
in both interpretations  the relations in table   and the converses of tpp and ntpp form a
jepd set  write brcc  and brcc   for these two sets  we call the boolean algebras generated by
brcc  and brcc     respectively  the weak and the strong rcc  models  written as rcc  and rcc    
strong connectedness has been considered by borgo et al           cohn and varzi         and
li et al           it is easy to see that  as relations  strong connectedness is contained in weak
connectedness  table   illustrates a configuration  the  nd from the left  which is an instance of ec
in rcc  but an instance of dc in rcc     and a configuration  the  nd from the right  which is an
instance of tpp in rcc  but an instance of ntpp in rcc    
   we stress here that the restriction of rcc to bounded plane regions does not affect the complexity of reasoning with
rcc   as every consistent rcc  network has a solution in any rcc model  li      b  

   

fic ohn   l i   l iu     r enz

relation
equals
disconnected
externally connected

symb 
eq
dc
ec

partially overlap

po

tangential proper part
non tangential proper part

tpp
ntpp

definition  weak 
a b
ab 
a  b      a  b   
a  b     
a   b  a   b
a  b  a   b
a  b

definition  strong 
a b
dim a  b    
dim a  b     
a  b     
a   b  a   b
a  b  dim a  b     
a  b  dim a  b    

table    the set of basic rcc  and rcc   relations  where a  b are two plane regions and x   x  dim x 
denote  respectively  the interior  boundary  and dimension of x  note that for notational convenience we set dim       

remark    as far as consistency and realisations are concerned  li      b  has shown that any
consistent rcc  network has a solution in any rcc model  the cubic realisation algorithm described there can be used to construct a solution in both the weak and the strong rcc  models 
this implies in particular that an rcc  network has a solution in the weak rcc  model iff it has
a solution in the strong rcc  model  as we will show in this paper  this is  however  not the case
when cardinal directions are combined with topological relations 
in the following  we recall some important properties of the three maximal tractable subclasses
b
h    c    and q  of rcc  identified by renz         a complete list of relations in these subclasses
can be found in appendix a of the work of renz        
lemma    suppose r is a non basic rcc  relation such that r   dc  ec  po      then
    r  q  iff r is either  tpp  ntpp  or  tpp   ntpp   
b  iff r is in q  or one of the following relations
    r  h
 tpp  eq    tpp  ntpp  eq    tpp   eq    tpp   ntpp   eq  
b    or either  ntpp  eq  or  ntpp   eq  
    r  c  iff r is in h
we note the above lemma does not define these subclasses  in particular  these subclasses do
include rcc  relations r such that r   dc  ec  po   
   
renz also shows that a consistent scenario can be constructed in o n    time for any pathconsistent network  over one of the three maximal tractable subclasses 
   

fir easoning about t opological and c ardinal d irection r elations

theorem    renz         a consistent scenario s of a path consistent network  of constraints
b    c    or over q  can be computed in o n    time  by replacing every constraint  vi rvj    
over h
with  vi base r  vj    s   where base r  is a basic relation obtained as follows 
    if r  b  then base r    r 
    else if  dc   r  then base r     dc  
b    then base r     ec  
    else if  ec   r and s   q  or s   h
    else if  po   r  then base r     po  
    else if  ntpp   r and s   c    then base r     ntpp  
    else if  tpp   r  then base r     tpp  
    else base r    base r   
in what follows  we call s the canonical consistent scenario of  
      r ealisation of basic rcc  n etworks
it is known that  for basic rcc  networks  path consistency implies consistency  nebel         we
next give a a short description of the cubic realisation algorithm proposed by li      b   as we need
to devise a similar algorithm later for the combination cases 
given a basic rcc  network     vi ij vj  ni j     suppose  is path consistent  an ntpp chain
in  is defined to be a series of variables vi    vi         vik such that vis ntppvis     for all
s           k     the ntpp level l i  of a variable vi is defined to be the maximum length of the
ntpp chains contained in  that ends with vi  
a realisation can be constructed as follows  where a variable may be interpreted as a bounded
region with multiple pieces  without loss of generality  we assume  vi eqvj     only when
i   j  we first define for each variable vi a finite set xi of control points as follows  for each i 
introduce a point pi to vi   if vi ecvj or vi povj   then introduce a point pij to vi   if vi tppvj or
vi ntppvj   then put all xi points into xj   we then expand each point p in xi a little to obtain a
square s p    these squares are pairwise disjoint  then  taking the union of these squares  we obtain
an instantiation of bounded regions to these vi   this works for all but the ec and ntpp constraints 
further modifications are needed to cope with these constraints  cf  li      b or appendix c of
this paper  
    interval algebra and rectangle algebra
in this subsection  we recall interval algebra  ia   allen        and rectangle algebra  ra   balbiani et al          ia is the qualitative calculus generated by the    basic relations between closed
intervals on the real line shown in table    we write
bint    b  m  o  s  d  f  eq  fi  di  si  oi  mi  bi 

   

for the set of basic ia relations  ligozat        defines the dimension  of a basic interval relation
as   minus the number of equalities appearing in the definition of the relation  see table     that is 
   we stress that this notion of dimension is different from the topological dimension 

   

fic ohn   l i   l iu     r enz

for basic relations we have
dim eq       dim m    dim s    dim f       dim b    dim o    dim d      

   

for a non basic relation r we define
dim r    max dim      is a basic relation in r  

relation
before
meets
overlaps
starts
during
finishes
equals

symb 
b
m
o
s
d
f
eq

conv 
bi
mi
oi
si
di
fi
eq

dim 
 
 
 
 
 
 
 

   

definition
x    y 
x    y 
x   y    x    y  
x   y    x    y  
y    x   x    y  
y    x   x    y  
x   y    x    y  

 i 

 ii 

table    ia basic relations  i  definitions and  ii  conceptual neighbourhood graph  where x  
 x   x     y    y    y     are two intervals 
nebel and burckert        have shown that there is a unique maximal tractable subclass of ia
which contains all basic relations  this subclass  written as h  is known as the ord horn class 
using the conceptual neighbourhood graph  cng  of ia  freksa         ligozat        gives a
geometrical characterisation for ord horn relations  consider the cng of ia  shown in table  
 ii   as a partially ordered set  bint      by interpreting any relation smaller than its right or upper
neighbours   for        bint with        we write          as the set of basic interval relations 
such that          and call such a relation a convex interval relation  an ia relation r is called
pre convex if it can be obtained from a convex relation by removing one or more basic relations with
dimension lower than r  for example   o  eq     o  s  fi  eq  is a convex relation and  o  eq  is a
pre convex relation  ligozat has shown that ord horn relations are precisely pre convex relations 
nebel and burckert also show that every path consistent ia network over h is consistent  furthermore  we can construct a consistent scenario for every path consistent ia network over h in
quadratic time 
suppose r is an ia relation and let
rcore      bint   dim     dim r     r  

   

by     it is clear that rcore    eq  iff r    eq   and rcore   r   b  o  d  di  oi  bi  if r 
 b  o  d  di  oi  bi  is nonempty  and rcore   r    eq  otherwise  then we have
lemma     renz        suppose     vi rij vj  ni j   is a path consistent ia network over h  let
core
core    vi rij
vj  ni j    

then core is also path consistent 
   

   

fir easoning about t opological and c ardinal d irection r elations

from table    ii  it is easy to see that a pre convex relation r has dimension   iff either r is a
  dim basic relation or r is contained in  s  eq  si  or  fi  eq  f   as a consequence  we know
corollary    suppose     vi rij vj  ni j   is a path consistent network over h  then  has a
 v  n
consistent scenario     vi rij
j i j   which has the following property 
     dim r    and
dim rij
ij
    eq  only if r    eq   r    m  only if r    m   r    mi  only if r    mi  
rij
ij
ij
ij
ij
ij

this result shows that  for any path consistent network  over h  we can construct in quadratic
time a consistent scenario for  

 i 

 ii 

figure     i  the minimum bounding rectangle m a  of a region a   ii  the ra relation of a to b is
m  o 
ia can be naturally extended to regions in the plane  we assume an orthogonal basis in the euclidean plane  for a bounded region a  its minimum bounding rectangle  mbr   denoted by m a  
is the smallest rectangle which contains a and whose sides are parallel to the axes of the basis 
we write ix  a  and iy  a  as  respectively  the x  and y projections of m a   the basic rectangle
relation between two bounded regions a  b is    iff  ix  a   ix  b     and  iy  a   iy  b     
where    are two basic ia relations  see figure   for illustration   we write brec for the set of
basic rectangle relations  i e  
brec             bint   

   

there are     different basic rectangle relations in brec   the rectangle algebra  ra  is the algebra
generated by relations in brec  balbiani et al         
the following definitions will be used later 
definition    suppose         is a basic ra relation  we say  is a   meet relation if
        m  mi   and is a corner relation if         m  mi  s  si  f  fi  eq   in general  we say a
non basic ra relation r             k    k     is a corner relation if each i     i  k  is a
corner relation 
by definition  each   meet relation is a corner relation  furthermore  it is easy to see that a basic
ra relation  is a   meet relation iff  for every two rectangles r  r  with  r  r       r  r  is a
singleton in the plane  and  is a corner relation iff every two rectangles r  r  with  r  r      have 
at least  a corner point in common 
the following lemma is straightforward 
   

fic ohn   l i   l iu     r enz

lemma    let     vi  rij  sij  vj  ni j   be an ra network  where rij and sij are arbitrary ia
relations  then  is satisfiable iff its projections x    xi rij xj  ni j   and y    yi sij yj  ni j  
are satisfiable ia networks 
by corollary   and the above lemma we have
lemma    suppose     vi rij vj   is a path consistent ra network over h  h  then  has a
consistent scenario     vi ij vj   such that
 ij is a   meet relation iff rij is a   meet basic relation  and
 ij is a corner relation iff rij consists only of basic corner relations 
as a consequence  we know h h is a tractable subclass of ra  no maximal tractable subclass
has been identified for ra  but a larger tractable subclass of ra has been identified  balbiani et al  
      
we next show that each path consistent basic ia or ra network has a canonical solution in the
following sense 
  n
definition    canonical tuple of intervals  rectangles    suppose m     m
i   mi   i   is an n tuple
of intervals  let e m  be the set of the values of the end points of intervals in m  we say m is
canonical iff e m                m    a tuple of rectangles  mi  ni   is canonical iff its x  and
y projections   ix  mi   ni   and  iy  mi   ni     are canonical tuples of intervals  a solution of an
ia  ra  respectively  network is called a canonical solution if it is a canonical tuple of intervals
 rectangles  respectively  

for a basic satisfiable ia network  we can compute the total order of all the end points  hence
we can obtain a canonical solution  by assigning   to the first end point    to the second  etc    this
gives us the following proposition 
proposition     suppose  is a satisfiable basic ia  ra  constraint network  then  has a unique
canonical solution 
    cardinal direction calculus
the cardinal direction calculus  cdc  was proposed by goyal and egenhofer         given a
bounded region b in the real plane  by extending the four edges of m b   we partition the plane into
nine tiles  denoted by bij     i  j      see figure    i  for illustration 
for a primary region a and a reference region b  the cdc relation of a to b  denoted by ab  
is encoded in a      boolean matrix  dij   i j    where dij     iff a  bij      where a is
again the interior of a   for example  the basic cdc relations ab and ba for the regions a  b in
figure   ii  are represented by the following matrices 




     
     
    ab               ba          
   
     
     
a cdc relation can be any but the zero boolean matrix  so there are            basic relations
in cdc  we denote this set by bcdc   a pair of basic cdc relations      is called a consistent pair
   

fir easoning about t opological and c ardinal d irection r elations

 i 

 ii 

 iii 

figure    illustrations of  i  the nine tiles of a reference region   ii  and  iii   two solutions of the
cdc basic constraint network  v    v    v    v     where   and   are defined in eq      

if the constraint network  v  v    v  v    has a solution  we also call  a weak converse of  if
     is a consistent pair  figure   shows that a basic cdc relation may have more than one weak
converse  therefore  we need both the relation of a to b and the relation of b to a to give a complete
description  in terms of the cdc calculus  of the directional information between two regions a  b 

 i 

 ii 

figure    illustration of two consistent cdc pairs  i   ab   ba   and  ii   a  b    b  a    where ab  
a  b  but ba    b  a    also note that the rectangle relation between a  b and that between
a    b  are both o  o 
in the following we show that there is a strong connection between cdc and ra relations 
definition      zhang et al         liu et al         for a pair of basic cdc relations       we
define the x projective interval relation of       written as x       as the disjunction of all basic
ia relations  which has an instance that is the x projection of some solution of  v  v    v  v    
i e 
x           bint    m    m     m    m        m    m        ix  m     ix  m         
a similar definition applies for the y direction 
note that if      is not a consistent pair  then both x      and y      are the empty relation 
if      is a consistent pair  then we can prove  liu et al         that its x   or y   projective interval
   

fic ohn   l i   l iu     r enz

relation is an ia relation r which has the following property
r    b  m  or r    bi  mi   or r is a basic ia relation in  o  s  d  f  eq  oi  si  di  fi  

    

the two projective interval relations can then be combined into an ra relation 
definition      zhang et al         liu et al         for a pair of basic cdc relations       we
call        x       y      the ra relation induced by       in general  for a basic cdc
constraint network     vi ij vj  ni j     we call       vi rij vj  ni j   the ra constraint network
induced by   where rij    ij   ji   
note that      is not necessarily a basic ra relation  if      is consistent  then we know the
ra relation      has the form     where    are ia relations that satisfy       furthermore 
a solution of  v  v    v  v    is always a solution of  v      v     we note that a solution of
 v      v    is not necessarily a solution of  v  v    v  v    
take the consistent pair          defined in     as an example  figure    ii  and  iii  show two
solutions  a  b  and  a    b    of the basic cdc constraint network  v    v    v    v     this implies
by definition that x          contains  b  m   it is easy to see from the definition that x         
contains no other basic ia relations and x             b  m   similarly  we can show y           
 d   this shows that this consistent pair          corresponds to basic ra relations  viz  m  d and
b  d 
      c anonical s olutions of basic cdc n etworks
just like ia and ra  consistent cdc networks also have canonical solutions 
definition     regular solution  zhang et al         liu et al          suppose m    mi  ni   is
a solution of a basic cdc constraint network   we say that m is maximal if m i  mi holds
for any solution  m i  ni   of  with m mi     m m i    we say m is regular if m is maximal and
 m mi   ni   is a canonical tuple of rectangles 
a basic cdc network in general has many regular solutions  but we have the following result 
proposition     let  be a basic cdc network  suppose  is a basic ra network that refines
    the induced ra network of   then we can determine in cubic time whether  has a solution
that also satisfies   moreover  if  has a solution  then it has a unique regular solution which also
satisfies   furthermore  this unique regular solution can be constructed in cubic time 
proof  the proof is similar to that for proposition    in the work of liu et al           a sketch is
given in appendix a 
from the proof of the above result  we can see that each region mi in a regular solution  mi  ni  
consists of unit cells  i e  rectangles of the form  i  i    j  j      where i  j  z  in the canonical
solution of   i e  for each region mi and each cell c  we have either c  mi or c  mi     
for a basic cdc network   there may exist exponentially many different basic ra networks
that refine     hence   may have exponentially many different regular solutions  see figure    a  for an example of such a network   however  to verify that  has a solution  we need
only prove that  has a solution for some special basic ra network that refines     liu et al  
      proposition       therefore  the consistency of  can be determined in cubic time  and  if 
is consistent  a regular solution can be constructed in cubic time  liu et al         
   such a special network is called a meet free basic ra network in the work of liu et al          

   

fir easoning about t opological and c ardinal d irection r elations

   the joint satisfaction problem
after the preparatory introduction of basic notions and essential results of qualitative calculi  we are
now ready to describe the joint satisfaction problem 
let m  and m  be two qualitative calculi over the same domain u  suppose si is a subclass of
mi  i          we write jsp s    s    for the joint satisfaction problem  gerevini   renz        li 
      over s  and s   
suppose     vi tij vj  ni j   is a constraint network over s    and     vi dij vj  ni j   is a
constraint network over s  involving the same variables  then we say     is an instance of
jsp s    s     the joint satisfaction problem was first considered for rcc  and the qualitative size
calculus  identical to the point algebra in vilain   kautz        by gerevini and renz        
moreover  it was shown that the consistency of a joint network can be approximated by the polynomial bipath consistency algorithm  li and cohn        recently showed that bipath consistency
can be equivalently expressed as below 
definition     let   be a joint constraint network over m  and m    where     vi tij vj  ni j  
and     vi dij vj  ni j     we say     is bi closed if   dij and tij   are nonempty for any
basic relation   tij   any basic relation   dij   and any    i  j  n  here we regard each
relation as a subset of u  u   a bi closed joint network     is bipath consistent if  and  are
both path consistent 
informally speaking  a joint constraint network is bi closed if each basic relation of a given
relation in one of the calculi is consistent with the corresponding relation in the other calculus 
as a simple example of the joint satisfaction problem  we consider the combination of ra and
cdc in the next subsection 
    the combination of ra and cdc
let r be a basic cdc relation  then r   the set theoretic converse  or inverse  relation of r
 cf        may be not representable in the relation algebra cdc  cicerone   di felice        liu
et al          that is  r cannot be represented as the union of several basic cdc relations  in this
sense  we say the cdc is not closed under converse  recently  schneider et al         proposed a
variant of cdc  called the object interaction model  oim   which is closed under converse 
for two bounded regions a  b  oim divides the plane into up to  l         l       tiles by
extending the edges of m a  and m b   where l      and l      are the numbers of horizontal
and  respectively  vertical lines  it is clear that    l    l     since edges of m a  and m b  may
coincide  the oim relation ab is represented by an l   l  matrix  also written as ab   considering
existence of interior points of a and or b in corresponding bounded tiles  let t be such a bounded
tile  we set the entry corresponding to t in the matrix ab to   if t has no interior point which is in
either a or b  and set it       respectively  if t has an interior point which is in a  b  respectively  and
has no interior point which is in b  a  respectively   and set it   otherwise  the converse relation of
a basic oim relation is also a basic oim relation  in particular  the basic oim relation ba of b to a
can be obtained by swapping the occurrences of   and   in ab  
for example  the oim relations between the regions in figure    ii  and  iii  are respectively




     
   
ab           a  b         
     
   
   

fic ohn   l i   l iu     r enz

and the oim relations between the regions in figure   are respectively

ab



     
         
     

a  b 



     
         
     

we note that for regions a  b  a    b  in both figures we have ab   a  b    this suggests that oim is
finer grained than cdc in the sense that it splits one basic cdc relation into several oim relations 
nevertheless  since cdc is not closed under converse  we need to consider consistent pairs of basic
cdc relations in order to evaluate its expressivity  when comparing the expressivity of the two
calculi in this way  we can see that  ab   ba       a  b    b  a    in figure    but  ab   ba      a  b    b  a   
in figure    this shows that oim makes finer distinctions than cdc in describing the scenarios
given in figure   ii  and  iii   when saying a is west of b  cdc does not differentiate if the east
boundary of a meets or precedes the west boundary of b  the following result shows that oim is
only finer than cdc in describing these cardinal relations  and it is in essence the combination of
cdc and ra 
theorem      li   liu        for any two regions a and b  we can compute the ra relation of a
to b  the cdc relation of a to b  and the cdc relation of b to a from the oim relation of a to b  and
vice versa 
in other words  for each basic oim relation   there exist two basic cdc relations      and a
basic ra relation  such that             i e  for any two regions a and b  the relation  is the
oim relation of a to b iff      and  are  respectively  the cdc relation of a to b  the cdc relation
of b to a  and the ra relation of a to b  because basic cdc and ra relations are both jepd  the
above choices of         are unique  in the following  we call  the cdc relation induced by  and
call  the ra relation induced by   note that in this case     as a relation of b to a  is the cdc
relation induced by    which is the oim relation of b to a 
as a consequence  we have the following result 
 for any
proposition     suppose     vi ij vj  ni j   is a basic oim network such that ji   ij
n
n
i  j  let     vi ij vj  i j   and     vi ij vj  i j     where ij and ij are  respectively  the cdc
relation and the ra relation induced by ij   then  is consistent iff the joint network     is
consistent 

proof  recall that the converse of a basic oim relation is also a basic oim relation  because
   it is straightforward to show that            therefore  solutions of  are
ji   ij
ij
ij
ij
ji
exactly the solutions of     
as a consequence of propositions    and    we have
corollary     let    and  be as given in proposition     then  is a basic ra network that
refines     and the consistency of  can be determined in cubic time  moreover  if  is consistent 
then there is a unique regular solution of  that is also a solution of  
so far  we have described by an example what is a jsp  in the next three sections  we will
consider the main task of this paper  the jsp of topological and directional constraints 
   

fir easoning about t opological and c ardinal d irection r elations

   combination of weak rcc  and ra networks
in this section we represent topological information as weak rcc  relations and directional information as ra relations  we first consider the interaction between weak rcc  and ra relations 
then consider the jsp for basic constraints  and  lastly  consider the jsp in general 
    interaction between weak rcc  and ra relations
relations in different calculi may interact in the sense that a relation from one calculus may intersect
with several relations from the second calculus  we here recall related definitions and preliminary
results obtained by li and cohn        
definition     let t be an rcc  relation and d an ra relation  the ra relation induced by t
and the rcc  relation induced by d are defined as
ra t          is a basic ra relation and   t     

    

rcc  d         is a basic rcc  relation and   d      

    

note that a joint network     is bi closed if ij  ra ij   and ij  rcc  ij   for any i  j 
s
it is easy to see  cf  li and cohn        that ra t      ra         t   and
ra  dc    ra  ec   ra  po    ra  tpp    ra  ntpp  eq   




ra  po    ra  tpp     ra  ntpp   eq   

    
    

where  for example  ra  ec    ra  po   holds because  for each basic ra relation    is
in ra  ec   if m a   m b      for all  a  b     and  is in ra  po   if m a   m b  is
a non degenerate rectangle for all  a  b    
lemma     let t be an rcc  relation and d an ra relation  then rcc  d  is a relation in the
b    q    and c    and ra t   is a relation in h  h if t is a relation in h
b  or q   
intersection of h
proof  this follows from the definitions of rcc  d  and ra t   and a simple table look up from
appendix a of the work of renz        
the second statement does not apply to relations in c    for example  consider t    ntpp 
eq   then t is a relation in c    but ra t      d  d  eq  eq  is outside h  h 
    combination of basic networks
we now consider the combination of rcc  and ra  first we show that bipath consistency is not
sufficient for consistency in jsp brcc    brec    li   cohn         let     vi ij vj   i j   be the
basic ra network induced by the four rectangles mi  i               illustrated below 
let     vi ij vj   i j   be the basic rcc  constraint network in which            ec  and
all the others are  dc   clearly   is satisfiable  although     is bipath consistent  it is not
satisfiable  this is because  otherwise  there exists a solution m    mi   i   and m m   m m     
m m     m m       p   is a singleton  by            ec  we know p  mi  i               
this contradicts       dc  
we call point p in the above configuration a conflict point  in general  we have the following
definition 
   

fic ohn   l i   l iu     r enz

definition     conflict point   let     vi ij vj  ni j   be a basic rcc  network and     vi
ij vj  ni j   a basic ra network  suppose m is the canonical solution of   a point q is called a
conflict point of mi if there exists j such that mi  mj    q  and ij    ec   we write ci for
the set of all conflict points of mi  
clearly  each conflict point of mi is also a corner point of mi   this implies that mi and mj
may have at most one common conflict point  moreover  suppose m    mi  ni   is a solution of
    such that m mi     mi for all    i  n  then each conflict point of mi is contained in
mi   this means ci  mi   as a consequence  we have
ci  cj      ij     dc      i  j  n 

    

the following theorem shows that this is also sufficient 
theorem     let     vi ij vj  ni j   be a basic rcc  network and     vi ij vj  ni j   a basic ra
network  suppose     is bipath consistent  then     is satisfiable iff      holds 
proof  the necessity part is clear  we defer the proof of the sufficiency part to appendix b 
as a corollary  we have jsp brcc    brec   is in p 
corollary     for a basic rcc  network  and a basic ra network   the consistency of    
can be decided in cubic time 
proof  bipath consistency of     can be checked in cubic time  we can construct the unique
canonical rectangle solution of  in quadratic time  the conflict point set ci can also be computed
in quadratic time  that is  the condition of theorem    can be checked in cubic time 
    large tractable subsets
b    c    and q    and ia has one maximal
recall that rcc  has three maximal tractable subclasses h
tractable subclass h  all containing the basic relations  in this subsection  we aim to extend the
b    c  of rcc   and the large tractable subset h  h of
above result to maximal tractable subsets h
ra 
to this end  we need to extend the notion of conflict points from basic networks to arbitrary
networks  recall that   meet relations and corner relations are basic ra relations defined in definition   
definition     common conflict point   let     vi tij vj  ni j   be an rcc  network and   
 vi dij vj  ni j   an ra network  we say two variables vi   vj have the ccp  common conflict point 
relation  written ccp vi   vj    if dij is a   meet  basic  relation and tij    ec   or
 dij is a  possibly disjunctive  corner relation  and
   

fir easoning about t opological and c ardinal d irection r elations

 there exist i    j   such that dii  and djj   are   meet  basic  relations  dij     di  j and di  j   are
 possibly disjunctive  corner relations  and tii    tjj      ec  
if ccp vi   vj   and vi    vj  are variables that satisfy the above conditions  we also write ccp i  j  
i    j     to stress the roles of vi  and vj    

 i 

 ii 

figure    two joint constraint networks in jsp rcc   ra   where in both  i  and  ii 
dij is the basic ra relation between vi and vj as illustrated in the picture  t     t      ec  and all unspecified rcc  constraints are
non basic rcc  relation  dc  ec  po  
in both  i  and  ii  we have
ccp        ccp        ccp        ccp        ccp        ccp       

examples are shown in figure    note that if  and  are all basic networks  then vi and vj
have the ccp relation iff ci  cj is nonempty  i e  vi and vj have a common conflict point 
definition     let     vi tij vj  ni j   be an rcc  network and     vi dij vj  ni j   an ra
network  we say     is ccp consistent if
ccp vi   vj    dc   tij

    

holds for any i    j  we say a joint network     is bc consistent if it is bipath consistent and
ccp consistent 
in general  if vi and vj have the ccp relation  then  in any realisation  vi and vj share at least
one corner point  of their mbrs  in common  therefore  in the weak rcc  algebra  they cannot be
disconnected  and neither can be contained in another as a non tangential proper part  note that the
latter statement also follows from the bi closedness of     
similar to the bipath consistency algorithm  gerevini   renz         we devise an algorithm
 algorithm    for enforcing bc consistency  the following theorem shows that this algorithm is
sound 
theorem     suppose     is a joint network of rcc  and ra constraints  where     vi tij
vj  ni j   and     vi dij vj  ni j     then in o n    time  the algorithm bc c onsistency either
finds an inconsistency or transforms     into an equivalent joint network       which is
bc consistent 
   

fic ohn   l i   l iu     r enz

input  a joint network      where     vi tij vj  ni j   and     vi dij vj  ni j    
output  false  if an empty constraint is generated  a bc consistent joint network equivalent
to      otherwise 
q    i  k  j    i    j  k    i  k    j  
 i indicates the i th variable of     
analogously for j and k 
while q     do
select and delete a path  i  k  j  from q 
if bc r evision i  k  j  then
if tij    or dij    then
return false 
end
q  q    i  j  k    k  i  j    k    i  k    j  
end
end
function  bc r evision i  k  j 
input  three variables i  k and j
output  true  if tij or dij is revised  false otherwise 
side effects  tij and dji revised using the operations  and w  
tij 
 tij  rcc  dij      tji  rcc  dji      tik  rcc  dik    w  tkj  rcc  dkj    
dij   dij  ra tij      dji  ra tji      dik  ra tik    w  dkj  ra tkj    
if ccp i  j   k  then
tij  tij    dc  
end
if neither tij nor dij is revised then
return false 
end
 
dji  dij
tji  tij  
return true 
algorithm    bc c onsistency  where we write ccp i  j   k  to represent the situation
where there exists another variable vl such that vl and vk together are evidence of ccp i  j  

   

fir easoning about t opological and c ardinal d irection r elations

proof  this is because  if we iteratively use the following updating rules then either an empty constraint occurs or the network becomes stable 
tij   tij  rcc  dij      tji  rcc  dji   
  tik  rcc  dik    w  tkj  rcc  dkj   


    

dij   dij  ra tij      dji  ra tji      dik  ra tik    w  dkj  ra tkj   

    

tij  tij    dc  if ccp i  j   k  

    

where i  j  k represent the variables vi   vj and vk and ccp i  j   k  represents the situation where
there exists another variable vl such that vl and vk together are evidence of ccp i  j   for each
triple  ccp i  j   k  can be determined in o n  time and the subroutine bc r evision i  k  j  can
be carried out in o n  time  since each tij is a set of basic rcc  relations and each dij is a set of
basic ra relations   tij   dij   can be revised for a constant number of times  therefore the number
of the loops remains cubic  and bc c onsistency will terminate in o n    time 
the algorithm is in general not complete  the following lemma will be useful to prove the main
result  theorem      which will guarantee the completeness of the algorithm for rcc  networks
b  and ra networks over h  h 
over h
lemma     let     vi tij vj  ni j   be an rcc  network and     vi dij vj  ni j   an ra network 
b  or q  and     is bipath consistent  assume that  is the canonical
suppose  is over h
consistent scenario of   cf  theorem     and  is any consistent scenario of   then     is
bipath consistent 
proof  because both  and  are path consistent basic networks  we need only show that   
  ra     and    rcc      for any i    j  since   and   are both basic
is bi closed  i e  ij
ij
ij
ij
ij
ij
    is nonempty for any i    j  by      and      it
relations  this is equivalent to showing that ij
ij
    therefore    d  ra t     ra     
is straightforward to show that ra tij     ra ij
ij
ij
ij
ij


i e  ij  ij is nonempty 
we note that this result does not apply to c    for example  let t    ntpp  eq   d  
 d  d  eq  eq   the rcc  relation ntpp is inconsistent with the ra relation eq  eq 
theorem     let     vi tij vj  ni j   be an rcc  network and     vi dij vj  ni j   an ra netb    and  is over h  h  then     is consistent if it is bc consistent 
work  suppose  is over h
proof  recall that each ra network over h  h is in essence a pair of ia networks over h  by
 is a   meet relation iff d is 
lemma   we know  has a consistent scenario  such that  i  ij
ij

and  ii  ij is a corner relation iff dij consists of corner relations  let  be the canonical consistent
scenario of   we show     is consistent 
by lemma    we know     is bipath consistent  we next show it satisfies       which is
equivalent to      when only basic constraints are concerned  to this end  we show that ccp i  j  
i    j     holds in     only if it holds in      by the choice of  and    we know tii   
tjj      ec  and all the ra relations are either   meet relations or consist of corner relations 
therefore  ccp i  j   i    j     also holds in      because     is bc consistent  we know dc is
     dc  and    satisfies       by theorem     we know     
not in ij   this implies ij
hence      is consistent 
   

fic ohn   l i   l iu     r enz

b  or q  and h  h can be
as a consequence  we know the joint consistency problem over h
solved in polynomial time 
b    h  h  and jsp q    h  h  are in p 
theorem     the joint satisfaction problems jsp h
b  or q    and  is over h  h 
proof  suppose     is a joint network such that  is over h
we first apply the algorithm bc c onsistency to      if an empty relation occurs during the
process  then     is inconsistent  otherwise  suppose       is the bc consistent joint network
b  or q  and   is over h  h  we note that 
equivalent to      we assert that   is still over h
b   or q     and any ra relation d in h  h  we have by lemma   
for any rcc  relation t in h
b  and q   
 rcc  d  is a relation in both h
 ra t   is a relation in h  h 
b   or q    
 t    dc    t   ec  po  tpp  ntpp  tpp   ntpp   eq  is in h
because bc c onsistency only uses the rules           to update relations  each rcc  relation
b   or q     and each ra relation in   remains in hh  the consistency     
in   remains in h
then follows from theorem    
the property in the proof of the above theorem does not hold for c    it remains open if
jsp c    h  h  is tractable  though this is not very important for practical purposes since either
b  or q  can be used to backtrack over to find a solution if required  
h

   combination of rcc   and ra networks
in this section  we represent topological information as rcc   relations and directional information
as ra relations  in the previous section we have shown that  for certain tractable subclasses of rcc 
and ra  the jsp can be determined in polynomial time  but we also show that bipath consistency
is incomplete for these subclasses  the reason lies in that two regions that are constrained by dc
may have a common conflict point  for rcc     this situation does not exist anymore because two
disjoint regions may still have a   dimensional intersection  this section will show that  for rcc    
bipath consistency alone is sufficient to show the consistency of a joint network     for  over
h  or c  and  over h  h 
as in the case of weak rcc   we first consider the interaction between rcc   and ra relations 
then consider the consistency of joint basic networks  and  lastly  consider the general case 
similar to definition     we have the following definition 
definition     let t be an rcc   relation and d an ra relation  the ra relation induced by t
and the rcc   relation induced by d are defined as
ra t          is a basic ra relation and   t     
 

rcc   d         is a basic rcc   relation and   d      
s
it is easy to see that ra t      ra         t   and

    
    

ra  dc    ra  ec   ra  po    ra  tpp     ra  ntpp    ra  eq   
ra  po    ra  tpp      ra  ntpp     ra  eq   
   

fir easoning about t opological and c ardinal d irection r elations

note that we have ra  tpp     ra  ntpp     s  d  f  eq    s  d  f  eq   this is because
in rcc   a non tangential proper part of a region a may have the same mbr as a  for example 
each star region in figure   is a non tangential proper part of its mbr in rcc    
lemma     let t be an rcc   relation and d an ra relation  then rcc    d  is a relation in
b    q    and c    and ra t   is a relation in h  h if t is a relation in h
b  or
the intersection of h
q  or c   
in particular  unlike the case for weak rcc   we have ra  ntpp  eq      s  d  f  eq  
 s  d  f  eq  is a relation in h  h 

figure    basic regions of a control point p in the combination of rcc   and ra 
theorem     suppose  is a basic rcc   network and  is a basic ra network  then     is
consistent if it is bipath consistent 
proof  the proof follows the same pattern as for the combination of weak rcc  and ra  theorem      but we need to replace the basic regions around a control point p with the star regions shown in figure    where we only show three regions b  r  g around p   and bntppr and
rntppg 
we have the following result for rcc   and ra 
b  or q  in rcc      is an ra network  then    
theorem     suppose  is a network over h
is consistent if     is bi closed   is path consistent  and  is consistent 
proof  assume that  is the canonical consistent scenario of   and  is any consistent scenario
     ra    and hence the
of   then  completely similar to lemma     we can show that ra ij
ij




bi closeness of       because  and  are consistent  we know     is bipath consistent 
hence consistent by theorem    
b    ra  can be polynothe above result shows that the consistency of a joint network in jsp h
b  and an ra network 
mially reduced to determining the consistency of an rcc  network over h
b    ra  is a separable problem  in particular  we have
in this sense  jsp h
   

fic ohn   l i   l iu     r enz

theorem     if rcc  relations are interpreted by using strong connectedness  then the joint satisb    h  h  and jsp q    h  h  are in p 
faction problems jsp h
again  it remains open whether the above result holds for networks over c  in rcc     even
though in this case ra  ntpp  eq     ra tpp  is a relation in h  h 
in the following section  we consider the combination of rcc  and cdc constraints 

   combination of rcc  and cdc constraints
although basic rcc  networks and basic cdc networks can be solved in cubic time independently  the interaction between rcc  and cdc constraints makes the joint satisfaction problem
hard to solve  in this section  we first show that the joint satisfaction problem is in np by designing a polynomial non deterministic algorithm and then show it is np hard even for basic constraints  this shows that jsp brcc    bcdc   is np complete  we then consider three variants of
jsp brcc    bcdc   obtained by replacing rcc  with rcc   and or cdc with oim  write boim for
the set of basic oim relations  we show jsp brcc    boim   and jsp brcc     bcdc   are np complete 
but jsp brcc     boim   is in p 
    algorithms
let  be an instance of a joint basic rcc  or rcc   network and  a basic cdc or oim network
over the same set of variables  we provide in this subsection algorithms for determining the consistency of      our key idea is first showing that     is consistent iff  has a regular solution
that is ra consistent with   see below  and then giving algorithms for determining whether  has
such a regular solution 
suppose m    mi  ni   is a solution of   recall that we say m    mi  ni   is a regular solution
if it is a maximal solution and  m mi   ni   is a canonical tuple of rectangles  cf  dfn       note
that each region in a regular solution m is the union of a set of cells introduced by the canonical
tuple of rectangles 
definition     let     vi ij vj  ni j   be a basic rcc  network and     vi ij vj  ni j   a basic
cdc network  suppose m    mi  ni   is a regular solution of   write  for the ra network
induced by m  we say a regular solution m of  is ra consistent with  if there exists a solution of
    which also satisfies  
the following lemma gives a characterisation of consistent joint basic networks 
lemma     let     vi ij vj  ni j   be a basic rcc  network and     vi ij vj  ni j   a basic
cdc network  then     is consistent iff  has a regular solution that is ra consistent with  
proof  the sufficiency part is clear by definition  we only prove the necessity part  suppose a  
 ai  ni   is a solution of    write  for the ra network induced by a  then a is also a solution of
     hence there is a unique regular solution of  which also satisfies   write m    mi  ni   for
this regular solution  it is clear that m is a regular solution of  that is ra consistent with  
by this lemma  to determine the consistency of      we need only determine the existence
of regular solutions of  that are ra consistent with   suppose m is a regular solution of   we
next give a necessary and sufficient condition for m being ra consistent with  
   

fir easoning about t opological and c ardinal d irection r elations

to this end  we first fix some notation and terminology  for a region mi in m  we say a corner
point p of mi is a potential conflict point  in m  if exactly one of the four cells incident to p is
contained in mi   for example  the grey region shown in figure   has five potential conflict points
pi  i               later we will show that these points may introduce conflicts that are hard to resolve
when rcc  constraints are involved  furthermore  we denote by gi the set of cells contained in
mi   ei the set of edges of cells which lie on the boundary of mi   and ni the set of potential conflict
points of vi  

figure    illustration of potential conflict points 
lemma     let     vi ij vj  ni j   be a basic rcc  network and     vi ij vj  ni j   a basic
cdc network  if a regular solution m    mi  ni   of  is ra consistent with   then we have 
if ij   tpp or ntpp then gi  gj  

    

proof  we prove this by contradiction  assume that  vi tppvj   or  vi ntppvj   is a constraint in
 and gi   gj  
suppose  vs vt   is a constraint in   where  is a basic cdc relation represented by the     
boolean matrix  dpq   p q    because m is a solution of   we have for any    p  q    that
dpq     iff ms  mpq
t     

    

where mpq
t denotes one of the nine tiles generated by the mbr of mt  cf  fig      since m is a
regular solution and gs is the set of cells contained in ms   this is equivalent to saying that
dpq     iff

gs and mpq
t have a common cell 

    

now let g be a cell in gi   gj   because g is not in gj   by the construction procedure of regular
solutions  see appendix a   there exists a constraint  vj    vk     with       d uv   such that g is a
 pq     and hence 
cell contained in mpq
k for some p  q  by      and that g is not in gj we know d
pq

  
by       mj  mk     let  vi  vk   be the cdc constraint between vi and vk in  and suppose
  pq     by      
       d  uv    because g is cell in both gi and mpq
k   we have d
because m is ra consistent with   there exists a solution a    ai  ni   of     such that
m ai     m mi    since  vi tppvj   or  vi ntppvj   is in   we know ai  aj   furthermore 
pq
we have aj  mj as m is a maximal solution of   therefore  ai  mj   because mpq
k   ak
pq
pq


  
  pq
and mj  mk     ai  ak is empty  this shows that  ai   ak   is not in  since d
     a
contradiction 
the ntpp constraints may furthermore exclude some edges in ei and nodes in ni from the
valuation of vi   suppose vi ntppvj is a constraint in  and m    mi  ni   is ra consistent with
  for any solution a    ai  ni   of     with m ai     m mi    by ai ntppaj and aj  mj
   

fic ohn   l i   l iu     r enz

we have aj  mj     this is to say  ai cannot touch the edges and nodes in ej and nj   to
characterise this  we define
 
ei  ei    ej   vi ntppvj    
    
 
ni  ni    nj   vi ntppvj    
    
since every region in m can be represented by a boolean matrix  gi   ei   ni can be calculated
in polynomial time  the following proposition then gives a necessary and sufficient condition for m
being ra consistent with  
lemma     let     vi ij vj  ni j   be a basic rcc  network and     vi ij vj  ni j   a basic
cdc network  then a regular solution m    mi  ni   of  is ra consistent with  iff
 vi tppvj   or vi ntppvj   implies gi  gj   and
s
 m  ei     m mi   for any i  and
 vi povj   implies gi  gj      and
s
 there exists a resolving function f   which is defined as a function from v to p   n         nn   
satisfying           
f  vi    ni  

    

vi ecvj    gi  gj     or ei  ej     or f  vi    f  vj       

    

vi dcvj    f  vi    f  vj      

    

proof  we begin with the necessity part  suppose m is ra consistent with   then by definition
there exists a solution a    ai  ni   of     such that m ai     m mi    the first condition is
proven in lemma     for the second condition  because m ai     m mi    and ai  mi   we know
that ai has a nonempty intersection with one unit edge on a cell that lies on the top  bottom  leftmost 
or rightmost  edge of m mi    this unit
s edge is clearly in ei   furthermore  it can be proven that this
edge is in ei   and thus we have m  ei     m mi    the following two conditions guarantee that
the po  ec constraints can
s be satisfied while not violating dc constraints  the third condition
follows directly from ai  gi and ai poaj   for the last condition  we define a resolving function
f as f  vi      p  ni   p  ai    it is straightforward to prove that f satisfies           
for the sufficiency part  we construct a solution of      the procedure is quite similar to that
given for theorem    in appendix b  for vi   we choose a control point from each cell in gi and
a control point from each edge in ei   if vi povj   we choose a control point for both of them from
a common cell of gi and gj   if vi ecvj   we choose a control point for them in a common cell if
gi  gj      or from a common edge if ei  ej      or from f  vi    f  vj   by the resolving
function f   it can then be proven that these control points lead to a solution of   moreover  the
choice of control points ensures that the regions are also a solution of  
since the conditions in lemma    can be verified by a nondeterministic polynomial algorithm 
we have the following theorem 
theorem     jsp brcc    bcdc   is in np 
   

fir easoning about t opological and c ardinal d irection r elations

proof  suppose   is an instance of jsp brcc    bcdc    we devise a nondeterministic polynomial
algorithm as follows  we first guess a basic ra network  that is consistent with the basic cdc
network   and compute the regular solution m of  that satisfies  in cubic time  and further guess
a resolving function f that satisfies the conditions            and check whether m is consistent
with the basic rcc  network  by lemma    via f   if this is the case  the algorithm returns true 
otherwise  the algorithm returns false  this shows that jsp brcc    bcdc   is in np 
since each oim network has at most one regular solution  by lemma    we have
corollary     jsp brcc    boim   is in np 
if we interpret topological constraints in rcc     then we have the following simplified condition
for determining whether a regular solution of  is ra consistent with  
proposition     suppose that  is a basic rcc   network  and  is a basic cdc network  both
over the same set of variables v    v         vn    then a regular solution of  is ra consistent
with  iff
 vi tppvj   or vi ntppvj   implies gi  gj   and
 vi povj   implies gi  gj      and
 vi ecvj   implies that either gi  gj or ei  ej is nonempty 
moreover  the above conditions can be checked in polynomial time 
proof  the proof is similar to that for lemma     the resolving function is now irrelevant  because
in rcc   conflict points are no longer evidence for ec relations  where a point p  a set x  respectively  is regarded as evidence
s of a relation  aecb  if p   a  b  x  a  b   respectively 
note that we do not require m  ei     m mi    as in rcc  it is possible that antppb and
m a    m b   see figure   for illustration 
this directly leads to the following two results 
theorem     jsp brcc     bcdc   is in np 
proof  the proof is similar to that for theorem     suppose   is an instance of jsp brcc    bcdc   
we first guess a basic ra network  that is consistent with  and construct a regular solution m of
 that satisfies  and then check whether m is ra consistent with  by proposition    
recall that oim is in essence the combination of cdc and ra  and a basic oim network is
consistent iff the two component cdc and ra networks are consistent  see proposition      in the
case when rcc   is combined with oim  we have the following tractability result 
theorem     jsp brcc     boim   is in p 
proof  the algorithm for jsp brcc     boim   contains three steps  suppose     is an instance
with n variables  the first step is to decide whether  and  are independently consistent  if not
so  then return false  otherwise  construct the unique regular solution m of   this can be achieved
in o n    time  we then calculate gi and ni   which can be done in o n    time  the third step is
to decide whether m is ra consistent with  according to proposition     which can be done in
o n    time  therefore  the consistency of     can be determined in o n    time and  hence 
jsp brcc     boim   is in p 
   

fic ohn   l i   l iu     r enz

in the next subsection  we show that jsp brcc    bcdc    jsp brcc     bcdc    and jsp brcc    boim  
are all np hard 
    np hardness results
recall that in the proof of theorem     we guess twice when determining the consistency of an
instance     of jsp brcc    bcdc    once for a basic ra network that is consistent with   and
once for a resolving function f that satisfies            see proposition      in this subsection we
devise two polynomial reductions from known np hard problems to jsp brcc    bcdc   by exploiting
these two facts 
theorem     jsp brcc    bcdc   is np hard 
proof  the first reduction is from   sat to jsp brcc    bcdc    because it is quite complicated  we
defer the construction to appendix c  here we only explain why this problem is np hard 
for each   sat instance   we construct an instance     of jsp brcc    bcdc   such that
each rcc  constraint is either a dc or an ec constraint  furthermore  we can show that  has a
unique regular solution that is ra consistent with  if  is consistent 
the intractability is caused by the potential conflict points in the regular solution  which  together with the ec and dc constraints  may introduce conflicts that are hard to resolve  by
lemma     to satisfy an ec constraint vi ecvj   we need to check whether mi and mj share a
cell  or else an edge  or else a corner point  in the last case  it can be proven without much difficulty
that points shared by mi and mj are exactly those points in ni  nj   therefore  if mi and mj share
no cell or edge  then the evidence point for the constraint vi ecvj can only be chosen from ni  nj  
it turns out that choosing such evidence points for all the ec constraints while not violating the
dc constraints in  is np hard 
the second reduction is from graph   colouring problem to jsp brcc    bcdc    we defer the construction to appendix d  for each graph g  we construct an instance g   g in jsp brcc    bcdc   
this reduction differs from the first one in that it does not exploit the intractability of finding a
resolving function  in fact  when vi ecvj is a constraint  then in each regular solution m of g  
either mi and mj share a cell or an edge  or mi and mj are disjoint  in which case m is not ra
consistent with    that is to say  resolving functions have no effect on the ra consistency of m 
the reduction is based on the fact that g has exponentially many regular solutions  and there is no
general way to test all of them in polynomial time  unless p   np  
note that in the first reduction we have shown  has a unique regular solution that is ra
consistent with  if  is consistent  where  is a   sat instance and     is the instance
of jsp brcc    bcdc   defined by the reduction  write  for the basic ra network induced by this
particular regular solution of    it is easy to see that     is consistent iff        is
consistent  in other words  the reduction from   sat is also a reduction to jsp brcc    boim   
corollary     jsp brcc    boim   is np hard 
similarly  the second reduction is also a reduction to jsp brcc     bcdc    this is because the
jsp brcc    bcdc   instance for each graph g only uses dc and ec constraints  and when two variables are required to be ec  then their mbrs do not   meet  but their mbrs may overlap 
corollary     jsp brcc     bcdc   is np hard 
   

fir easoning about t opological and c ardinal d irection r elations

by these np hardness results and theorem     corollary     and theorem     we know
theorem     the joint satisfaction problems jsp brcc    bcdc    jsp brcc     bcdc    and jsp brcc   
boim   are all np complete 

   conclusion
in this paper  we have investigated the computational complexity of reasoning with topological
relations and cardinal directions between extended spatial objects  we used two different interpretations of the well known rcc  algebra for representing topological information  and use the
rectangle algebra  ra  and the cardinal direction calculus  cdc  to describe directional information  we have shown that the joint satisfaction problems are decidable and remain in np for all
these interpretations of topological and directional information  more importantly  we have shown
that the consistency problem is in p when basic  weak or strong  rcc  and basic ra constraints
are involved  or when topological constraints are basic strong rcc  constraints and directional
constraints are jointly represented by basic ra and cdc constraints 
some related work has been reported in the work of sistla and yu         li         and li
and cohn         but only small fragments of ra are used to express directional information  our
results represent a large step towards the applicability of qualitative spatial reasoning techniques for
real world problems  in particular the tractable results are very promising as they enable efficient
reasoning about these important calculi  it also means that if efficient reasoning is important for
a potential application  developers should aim for representing directional information using ra
 or together with cdc  instead of cdc alone and or representing topological information by using
rcc   instead of rcc   our results about combining rcc  and cdc oim are very important
from a theoretical point of view as they are the first formal results for this combination  as demonstrated using a concrete application scenario  our results are also of practical significance  as the
combined information we consider can be easily extracted in cases where computer vision is used
for obtaining spatial information 

acknowledgments
we thank the anonymous reviewers for their invaluable comments and detailed suggestions  the
first author also thanks the university of technology sydney for their funding of a visit to sydney
as an adjunct professor  this work was partially supported by australian research council  grant
no s dp           dp          and ft          the national natural science foundation of
china  grant no             and the eu funded projects race  fp  ict         and strands
 fp  ict         

appendix a  realisation of basic cdc networks
we here describe the cubic algorithm given in the work of zhang et al           and liu et al          
given a basic cdc network  first  we compute a canonical solution of the induced  possibly nonbasic  ra network  next  we remove the cells that violate some constraints from each rectangle 
third  we check whether what we have obtained is a valid solution  in the following  we give a
detailed description with a running example illustrated in table   and figure   
   

fic ohn   l i   l iu     r enz

      

      

      


 
 
 
 
 
 
 
 
 

ij
 
 
 
 
 
 
 
 
 


 
 
 
 
 
 
 
 
 


 
 
 
 
 
 
 
 
 

ji
 
 
 
 
 
 
 
 
 

xij  yij

xij  yij

oo

oo

 m  b   fi

b  fi

o  oi

o  oi



 
 
 
 
 
 
 
 
 

table    example of solving a basic cdc network 

step    compute the induced ra network   of  
step    refine   to a basic ra network     vi  xij  yij  vj  ni j   by setting xij   xij   m  mi 
and yij   yij   m  mi   if  is unsatisfiable  then neither is   suppose  is satisfiable and construct
its canonical solution m    mi  ni    cf  figure    

figure    illustration of step    deriving a solution m of  from a canonical solution m of  
step    this step tries to find a solution m    mi  ni   of the basic cdc network  such that
m mi     m mi    recall a basic cdc relation ij is represented as a      boolean matrix
  ij  xy    if m is a solution  mi   mj  xy    holds for every  ij  xy      where  mj  xy is one
of the nine tiles generated by m mj    cf  figure     this
to make m a solution to   we
s means 


need to exclude all impossible cells from mi   set ti     mj  xy    ij  xy     nj     let mi be
the closure of mi   ti  cf  figure   left  
step    the last step checks whether m    mi  ni   is a solution of   if it is a solution  then m
must be a regular solution  if it is not  then we assert that  has no solution at all 
we note that other regular solutions may exist  cf  figure   right   we can get all of them by
repeating steps   to   using every possible refinement of    

appendix b  proof of theorem   
we only need to show the sufficiency part  similar to the cubic construction method for basic rcc  constraints  cf  li      b and section       of this paper   we construct a solution
m    mi  ni   with an additional requirement that m mi     mi for each    i  n  where
 m         mn   is the canonical solution of   recall that the coordinates of each corner point of a
rectangle mi are integral  assuming the ntpp level l i  has been computed for each    i  n  we
next describe the construction in detail 
   

fir easoning about t opological and c ardinal d irection r elations

step    selection of control points
for each vi we select a set of control points xi   first of all  each corner point in ci is a control point
for vi   we then select one  non integral  point from each edge of mi and put the four points into
xi   then  for any j   i with ij   ec or po select a point pij from mi  mj  which is nonempty
because of the bipath consistency of       and put it into both xi and xj   note that mi  mj
could be a single point  or a line segment  or a rectangle  when choosing pij from mi  mj   we
require that each pij is a fresh point that has not been chosen before and is not a corner point of any
rectangle  unless i  mj is a singleton set   we write p for the set of all the control points 
step    basic regions associated to control points
for each control point q  we construct a series of sectors  q i k   k             ni   and a series
of squares  q  i   ni    see figure     we call these the basic regions associated to q  note that we
use an upper case letter to denote a control point  and use the corresponding lower case letter  with
indices  to denote basic regions  the sectors are chosen in this way as this allows us to distinguish
up to four connecting regions in cases where q is a corner point  such as point p in figure    the
sectors completely fill all the disks 

figure    basic regions of a control point q 
for any two different control points  we require their outermost squares to be disjoint  furthermore  a basic region must be small enough so that it is not crossed by the border of any mi of which
q is not a boundary point 
step    region construction
for each control point q  set q i  
a i
a i
a i
a i

s 

k   q

i k  

let
 
  mi   q i   q  xi  
 
  a i   mi   q j   ij   po  q  xi  xj   
 
  a i   a j   ji   tpp or ji   ntpp 
 
  a i   q  l i     ji   ntpp  q  a j  

set mi   a i and m    mi  ni     it is easy to prove that m satisfies all rcc  constraints in   for
example  suppose  vi dc vj   is a constraint in   because      holds  we know vi and vj share no
common conflict point  i e  ci  cj     due to the choice of control points for vi and vj   we know
   

fic ohn   l i   l iu     r enz

xi  xj is also empty  it is now easy to show that mi  mj is empty and hence the dc constraint
is satisfied 
to show m also satisfies   we need only prove m mi     mi for each i  it is clear that a i
and a i are subsets of mi   by the choice of xi   we know mi   m a i     m a i    if ji   tpp
or ntpp  then mj  mi by bipath consistency  this implies m a i     mi   furthermore  if
ji   ntpp  we have  mj   mi    d  d by bipath consistency  so for any control point q in
a j  mj   q is also in the interior of mi   therefore  by the choice of basic regions  we know the
outmost square q  n  at q  hence q  l i     is contained in mi   therefore  m a i     mi   this proves
that m is a solution to     

appendix c  the reduction from  sat to jsp brcc    bcdc  
v
n
let    m
i   cj be a  sat instance involving n propositional variables  pk  k   and m clauses 
assume that the j th clause cj is qi   qi   qi    where each qij is a literal in  pk  nk     pk  nk    
we construct a jsp brcc    bcdc   instance     and choose a particular regular solution m of
 such that  is satisfiable iff m is ra consistent with   
there are three types of spatial variables in       auxiliary variables  called grid variables 
which are used to fix the relative locations of other variables  variables to simulate propositional
variables  and variables to simulate propositional clauses 
c   grid variables
we introduce     n grid variables gij     i   n     j      the cdc constraints between
these variables are specified as in figure     left   the rcc  relation between two grid variables
gij   gi  j   is ec if they are   neighbours  i e    i  i      j  j                these ec constraints
make sure that there is no gap between the mbrs of two neighbouring grid variables  this implies
that there is at most one regular solution of   
grid variables are mainly used to locate other spatial variables  for a new variable v and a grid
variable gij   we say v occupies gij if v  m gij   is nonempty  and its mbr is m gij    i e 
m v  m gij      m gij   

figure     grid and spatial variables for propositional variables 

c   spatial variables for propositional variables
for each propositional variable pi in   four spatial variables ai   bi   ci and di are introduced such
that each occupies two grid cells  but has an empty intersection with the interiors of the mbrs of
   

fir easoning about t opological and c ardinal d irection r elations

all other grid variables  the corresponding grid cells are illustrated in figure     right   take ai
as example  by assigning the cdc constraints between ai and the grid variables  we require ai
occupies g i    and g i      but is disjoint from the mbrs of all other grid variables  it is easy to
see that ai  bi contains at most two points  viz  pi  and pi   and so does ci  di  
as for the topological constraints  we require ai ecbi and ci ecdi   and all other constraints
are dc  the ec constraints imply that both ai  bi and ci  di are nonempty  on the other hand 
since ai dcci   we can conclude that ai and bi must share only one of pi  and pi   while ci and
di share the other one 
c   spatial variables for propositional clauses
for each clause  qj   qj   qj    in   we introduce two new spatial variables ej and fj   both
occupy three grid cells  the precise occupied grid cells are set according to the variables and signs
of qjk   figure    gives an example to illustrate the construction  where we assume qj    pi    qj   
pi    qj    pi    as for the topological constraints  we set the constraint between ej and fj
as ec  and set all other constraints as dc  this implies ej  fj contains at least one point of
pi    pi     pi     we claim that it is not the case that ai   bi     pi     ai   bi     pi     and
ai   bi     pi      otherwise  some dc constraint  e g  that between ai  and ej   will be violated 
c   the regular solution that may be ra consistent with 

figure     spatial variables for clauses 
we have now finished the construction  note that  is always satisfiable and there are exponentially many regular solutions of it  as there may be or may be not a gap between   neighbouring
grid variables   however  the ec constraints between the   neighbouring grid variables imply that
only the regular solution in which there is no gap between   neighbouring grid variables can be ra
consistent with    we denote this regular solution by m 
we next show that  is consistent iff     is consistent  suppose     has a solution a 
we define an assignment     pi  ni     true  f alse  such that  pi     true iff ai  bi    pi   
in a  we can verify that  satisfies   on the other hard  suppose  is an assignment that satisfies
  we prove that     has a solution  the idea is to introduce an instance of jsp brcc    brec   

in which we have two spatial variables a 
i and ai instead of ai  also for bi   ci   di    and three
k
variables ej     k     instead of ej  also for fj    the ra constraints are set according to
figure    and figure     while the rcc  constraints are set by  and   it can be proven that
this new joint network satisfies       and a solution can be obtained in cubic time  a solution of

    can then be obtained by merging the related regions  e g  merging a 
i and ai into ai   
   

fic ohn   l i   l iu     r enz

the verification is straightforward  therefore   is satisfiable iff     is satisfiable  and thus 
is satisfiable iff m is ra consistent with   

appendix d  the reduction from graph   colouring to jsp brcc    bcdc  
suppose g    v  e  is a graph  we construct an instance g   g of jsp brcc    bcdc   as follows 
for each node vi in v   we construct a gadget with    spatial variables  uki  k                  xi
 
and yi   we first describe their cdc constraints  the basic cdc constraints between uki and uki are
specified as in figure     i   for example  g contains the following basic cdc constraints








     
     
     
     
u i       u i   u i       u i   u i       u i   u i       u i  
     
     
     
     
note that  the induced ra constraint between u l  
and u l  
for l           is  b  m   eq  the
i
i
basic cdc constraints between xi and yi are specified as in figure     ii   i e 




     
     
xi       yi   yi       xi  
     
     
the cdc constraints concerning xi   yi and uki are specified as follows 

 
xi  
 

 
xi  
 

 
k
ui  
 

 

yi  
 

 
yi  
 

 
uki  
 




     
   
    u i   xi       u i  
     
   



   
     
    u i   xi       u i  
   
     

   
    xi  k       
   



   
     
    u i   yi       u i  
   
     



   
     
    u i   yi       u i  
   
     

   
    yi     k     
   


 
xi  
 

 
xi  
 

 
 
ui  
 

 

yi  
 

 
yi  
 

 
u i  
 




     
   
    u i   xi       u i  
     
   

   
    uki  k         
   

   
    xi  
   



   
     
    u i   yi       u i  
   
     

   
    uki  k         
   

   
     yi  
   

figure     ii  illustrates a regular solution of uki   xi and yi   where u i meets u i while there is
a gap between u i and u i   and between u i and u i   we note that there are in total eight different
regular solutions when the network is restricted to the gadget of vi  
   

fir easoning about t opological and c ardinal d irection r elations

 i 

 ii 
figure     illustrations of the cdc constraints   i  constraints between uki  k                   ii 
constraints relating xi   yi   note we use dashed squares to denote variables u i and u i  
which connect two other variables  note that both xi and yi have three disjoint parts 

   

fic ohn   l i   l iu     r enz

the rcc  constraint between any two variables is either ec or dc  we require xi ecyi   this
is realisable only if u l  
meets u l  
in x direction for at least one l              we use this fact
i
i
to mimic that the node vi  v is coloured with one of the three colours  the rcc  constraints of
the remaining pairs of variables are all specified as dc   
the gadgets for all nodes in v are horizontally aligned  as illustrated in figure    

figure     illustrations of the gadgets for all nodes in v

figure     illustrations of the gadget for edge ek    vi   vj    where dashed lines suggest that corresponding edges are aligned according to proper cdc constraints 
we then devise the gadgets for edges in graph g  let ek    vi   vj   be an edge in e  for each
    w     w   and w   as well as constraints to
colour l             we introduce four variables wk l
k l
k l
k l
 l  
 l  
 l  
guarantee that u l  
cannot
meet
u
if
u
meets
u
 
which
corresponds
to that nodes vi
i
i
j
j
and vj cannot both have colour l  because ek is an edge in g   the cdc constraints are specified
  meets w   iff u l   meets u l     and w   meets w   iff u l  
as in figure     we note that wk l
i
i
j
k l
k l
k l
    is contained in
meets u l  
 
all
in
x direction 
by
the
cdc
constraints
we
can
show
that
m w
j
k l
     this implies that there is either a gap between w   and w   or a gap between w   and
m wk l
k l
k l
k l
    in other words  w   meets w   and w   meets w   cannot happen simultaneously  by the
wk l
k l
k l
k l
k l
   if there are more than one l such that u l  
meets u l  
in x direction  we always choose the smallest such l as the
i
i
colour of the node vi  
   note that u i dcu i together with the cdc relations between u i and u i does not necessarily imply that u i should
precede u i in x direction  that is  u i could still meet u i in x direction in this case 

   

fir easoning about t opological and c ardinal d irection r elations

constraints enforcing the dashed lines we know u l  
cannot meet u l  
if u l  
meets u l  
  and
i
i
j
j
vice versa 
note that we need to complete both  and   while unspecified cdc constraints can be easily
deduced from these figures  unspecified rcc  constraints are all dc 
it is not hard to verify that graph g is   colourable iff the joint network g   g is consistent 
the idea is that  if    v            is a   colouring of g  then we may construct a solution of
g   g in which the ra relation between u l  
and u l  
is m  eq if  i    l  and is b  eq
i
i
otherwise  this guarantees that xi and yi are realisable  the fact that no incident nodes in g have
r are realisable  on the other hand  if     is satisfiable 
the same colour implies that all wk l
g
g
then at least one pair in   u i   u i     u i   u i     u i   u i    should have ra relation m  eq  otherwise 
xi ecyi is violated   define    v            by  vi     min l   u l  
m  eq u l  
   it can be
i
i
r are realisable 
verified that  is a   colouring of g due to the fact that wk l
now we have completed the reduction from graph   colouring to jsp brcc    bcdc    we note
that the ec constraints can also be interpreted in terms of rcc     this means that g   g can
also be regarded as an instance of jsp brcc    bcdc    therefore  we have also provided a reduction
from graph   colouring to jsp brcc     bcdc   

references
allen  j  f          maintaining knowledge about temporal intervals  communications of the acm 
               
balbiani  p   condotta  j  f     farinas del cerro  l          a new tractable subclass of the rectangle algebra  in dean  d   ed    proceedings of the sixteenth international joint conference
on artificial intelligence  ijcai      pp          morgan kaufmann 
bodirsky  m     kara  j          the complexity of temporal constraint satisfaction problems  j 
acm        
borgo  s   guarino  n     masolo  c          a pointless theory of space based on strong connection
and congruence  in aiello  l  c   doyle  j     shapiro  s  c   eds    kr  pp          morgan
kaufmann 
chen  j   cohn  a  g   liu  d   wang  s   ouyang  j     yu  q          a survey of qualitative
spatial representations  the knowledge engineering review  firstview      
cicerone  s     di felice  p          cardinal directions between spatial objects  the pairwiseconsistency problem  information sciences                   
cohn  a  g     renz  j          qualitative spatial reasoning  in van harmelen  f   lifschitz  v    
porter  b   eds    handbook of knowledge representation  elsevier 
cohn  a  g   renz  j     sridhar  m          thinking inside the box  a comprehensive spatial
representation for video analysis  in kr  pp         
cohn  a  g     varzi  a  c          modes of connection  in freksa  c     mark  d  m   eds   
cosit  vol       of lecture notes in computer science  pp          springer 
davis  e          qualitative spatial reasoning in interpreting text and narrative  spatial cognition
  computation                
   

fic ohn   l i   l iu     r enz

davis  e   gotts  n  m     cohn  a  g          constraint networks of topological relations and
convexity  constraints               
duntsch  i   wang  h     mccloskey  s          a relation algebraic approach to the region
connection calculus  theoretical computer science            
egenhofer  m  j     mark  d  m          naive geography  in frank  a     kuhn  w   eds   
cosit     pp       springer 
falomir  z          qualitative distances and qualitative description of images for indoor scene
description and recognition in robotics  ai communications                
freksa  c          temporal reasoning based on semi intervals  artificial intelligence            
    
gabelaia  d   kontchakov  r   kurucz  a   wolter  f     zakharyaschev  m          combining
spatial and temporal logics  expressiveness vs  complexity  journal of artificial intelligence
research             
ge  x     renz  j          representation and reasoning about general solid rectangles  in rossi 
f   ed    ijcai  ijcai aaai 
gerevini  a     renz  j          combining topological and size information for spatial reasoning 
artificial intelligence              
gerevini  a     nebel  b          qualitative spatio temporal reasoning with rcc   and allens
interval calculus  computational complexity  in ecai  pp         
goyal  r     egenhofer  m          the direction relation matrix  a representation for directions
relations between extended spatial objects  in the annual assembly and the summer retreat
of university consortium for geographic information systems science 
goyal  r     egenhofer  m          similarity of cardinal directions  in jensen  c   schneider  m  
seeger  b     tsotras  v   eds    proceedings of the  th international symposium on advances
in spatial and temporal databases  sstd      pp        springer 
hirsch  r          a finite relation algebra with undecidable network satisfaction problem  logic
journal of the igpl               
jonsson  p     krokhin  a  a          complexity classification in qualitative temporal constraint
reasoning  artificial intelligence                 
kontchakov  r   nenov  y   pratt hartmann  i     zakharyaschev  m          on the decidability of
connectedness constraints in  d and  d euclidean spaces  in ijcai  pp         
li  s       a   combining topological and directional information  first results  in lang  j   lin  f  
  wang  j   eds    proceedings of the first international conference on knowledge science 
engineering and management  ksem      pp          springer 
li  s       b   on topological consistency and realization  constraints              
li  s          combining topological and directional information for spatial reasoning  in veloso 
m   ed    proceedings of the   th international joint conference on artificial intelligence
 ijcai      pp          aaai 
li  s     cohn  a  g          reasoning with topological and directional spatial information 
computational intelligence                
   

fir easoning about t opological and c ardinal d irection r elations

li  s     liu  w          cardinal directions  a comparison of direction relation matrix and objects
interaction matrix  international journal of geographical information science  accepted for
publication  doi  http   dx doi org                              
li  s   liu  w     wang  s          qualitative constraint satisfaction problems  an extended
framework with landmarks  artificial intelligence            
ligozat  g          tractable relations in temporal reasoning  pre convex relations  in ecai    
workshop on spatial and temporal reasoning  pp        
ligozat  g     renz  j          what is a qualitative calculus  a general framework  in zhang  c  
guesgen  h     yeap  w  k   eds    pricai     pp        springer 
liu  w     li  s          reasoning about cardinal directions between extended objects  the nphardness result  artificial intelligence                    
liu  w   li  s     renz  j          combining rcc   with qualitative direction calculi  algorithms
and complexity  in boutilier  c   ed    proceedings of the twenty first international joint
conference on artificial intelligence  ijcai      pp         
liu  w   zhang  x   li  s     ying  m          reasoning about cardinal directions between extended objects  artificial intelligence                     
nebel  b          computational properties of qualitative spatial reasoning  first results  in ki    
pp          berlin  germany  springer verlag 
nebel  b     burckert  h  j          reasoning about temporal relations  a maximal tractable
subclass of allens interval algebra  journal of the acm              
randell  d  a   cui  z     cohn  a  g          a spatial logic based on regions and connection  in
kr     pp         
renz  j          maximal tractable fragments of the region connection calculus  a complete
analysis  in dean  d   ed    proceedings of the sixteenth international joint conference on
artificial intelligence  ijcai      pp          morgan kaufmann 
renz  j          qualitative spatial reasoning with topological information  vol       of lecture
notes in artificial intelligence  springer verlag  berlin  germany 
renz  j     nebel  b          on the complexity of qualitative spatial reasoning  a maximal
tractable fragment of the region connection calculus  artificial intelligence             
schneider  m   chen  t   viswanathan  g     yuan  w          cardinal directions between complex
regions  acm transactions on database systems                 
schockaert  s     li  s          convex solutions of rcc  networks  in ecai  pp         
schockaert  s     li  s          combining rcc  relations with betweenness information  in
ijcai  pp           
shi  h   jian  c     krieg bruckner  b          qualitative spatial modelling of human route instructions to mobile robots  in achi  pp     
sistla  a     yu  c          reasoning about qualitative spatial relationships  journal of automated
reasoning                
skiadopoulos  s     koubarakis  m          on the consistency of cardinal direction constraints 
artificial intelligence                
   

fic ohn   l i   l iu     r enz

sridhar  m   cohn  a  g     hogg  d  c          from video to rcc   exploiting a distance
based semantics to stabilise the interpretation of mereotopological relations  in cosit  pp 
       
vilain  m  b     kautz  h  a          constraint propagation algorithms for temporal reasoning  in
aaai  pp         
whitehead  a          process and reality  an essay in cosmology  cambridge university press 
cambridge 
wolfl  s     westphal  m          on combinations of binary qualitative constraint calculi  in
boutilier  c   ed    proceedings of the twenty first international joint conference on artificial
intelligence  ijcai      pp         
wolter  d     wallgrun  j          qualitative spatial reasoning for applications  new challenges
and the sparq toolbox  in hazarika  m   ed    qualitative spatio temporal representation
and reasoning  trends and future directions  pp         
wolter  d   dylla  f   wolfl  s   wallgrun  j  o   frommberger  l   nebel  b     freksa  c         
sailaway  spatial cognition in sea navigation  ki              
wolter  f     zakharyaschev  m          spatial reasoning in rcc   with boolean region terms  in
ecai  pp         
zhang  p     renz  j          qualitative spatial representation and reasoning in angry birds  the
extended rectangle algebra  in kr 
zhang  x   liu  w   li  s     ying  m          reasoning with cardinal directions  an efficient
algorithm  in fox  d     gomes  c   eds    proceedings of the twenty third aaai conference
on artificial intelligence  aaai      pp          aaai 

   

fi