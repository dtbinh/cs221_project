journal of artificial intelligence research                  

submitted        published      

can we learn to beat the best stock
allan borodin

bor cs toronto edu

department of computer science
university of toronto
toronto  on  m s  g  canada

ran el yaniv

rani cs technion ac il

department of computer science
technion   israel institute of technology
haifa        israel

vincent gogan

vincent cs toronto edu

department of computer science
university of toronto
toronto  on  m s  g  canada

abstract
a novel algorithm for actively trading stocks is presented  while traditional expert
advice and universal algorithms  as well as standard technical trading heuristics  attempt
to predict winners or trends  our approach relies on predictable statistical relations between
all pairs of stocks in the market  our empirical results on historical markets provide strong
evidence that this type of technical trading can beat the market and moreover  can beat
the best stock in the market  in doing so we utilize a new idea for smoothing critical
parameters in the context of expert learning 

   introduction
the portfolio selection  ps  problem is a challenging problem for machine learning  online
algorithms and  of course  computational finance  as is well known  e g  see lugosi       
sequence prediction under the log loss measure can be viewed as a special case of portfolio selection  and perhaps more surprisingly  from a certain worst case minimax criterion 
portfolio selection is not essentially any harder  than prediction  as shown in  cover   ordentlich         see also lugosi        thm            but there seems to be a qualitative
difference between the practical utility of universal sequence prediction and universal
portfolio selection  simply stated  universal sequence prediction algorithms under various
probabilistic and worst case models appear to work very well in practice whereas the known
universal portfolio selection algorithms do not seem to provide any substantial benefit over
a naive investment strategy  see section    
a major pragmatic question is whether or not a computer program can consistently
outperform the market  a closer inspection of the interesting ideas developed in information theory and online learning suggests that a promising approach is to exploit the natural
volatility in the market and in particular to benefit from simple and rather persistent statistical relations between stocks rather than to try to predict stock prices or winners 

c
    
ai access foundation  all rights reserved 

fiborodin  el yaniv    gogan

we present a non universal portfolio selection algorithm    which does not try to predict
winners  the motivation behind our algorithm is the rationale behind constant rebalancing
algorithms and the worst case study of universal trading introduced by cover         not
only does our proposed algorithm substantially beat the market on historical markets 
it also beats the best stock  so why are we presenting this algorithm and not just simply
making money  there are  of course some caveats and obstacles to utilizing the algorithm 
but for large investors the possibility of a goose laying silver  if not golden  eggs is not
perhaps impossible 

   the portfolio selection problem
assume a market with m stocks  let vt    vt              vt  m   be the daily closing prices 
of the m stocks for the tth day  where vt  j  is the price of the jth stock  it is convenient
to work with relative prices xt  j    vt  j  vt   j  so that an investment of  d in the jth
stock just before the tth day yields dxt  j  dollars  we let xt    xt              xt  m   denote the
market vector of relative prices corresponding to the tth day  a portfolio b is an allocation
of wealth in the stocks  specified by the proportions b    b    
p         b m   of current dollar
wealth invested in each of the stocks  where b j  p
  and j b j       the daily return
of a portfolio b w r t  a market vector x is b  x   j b j x j  and the  compound  total
return  retx  b         q
  bn    of a sequence of portfolios b            bn w r t  a market sequence
x   x            xn is nt   bt  xt   a portfolio selection algorithm a is any deterministic or
randomized rule for specifying a sequence of portfolios and we let retx  a  denote its total
return for the market sequence x 
the simplest strategy is to buy and hold stocks using some portfolio b  we denote this
strategy by bahb and let u bah denote the uniform buy and hold when b      m            m  
we say that a portfolio selection algorithm beats the market when it outpeforms u bah
on a given market sequence although in practice the market can be represented by some
non uniform bah   buy and hold strategies rely on the tendency of successful markets to
grow  much of modern portfolio theory focuses on how to choose a good b for the buyand hold strategy  the seminal ideas of markowitz        yield an algorithmic procedure
for choosing the weights of the portfolio b so as to minimize the variance for any feasible
expected return  this variance minimization is possible by placing appropriate  larger 
weights on subsets of sufficiently anti correlated stocks  an idea which we shall also utilize 
we denote the optimal in hindsight buy and hold strategy  i e  invest only in the best
stock  by bah  
an alternative approach to the static buy and hold is to dynamically change the portfolio
during the trading period  this approach is often called active trading  one example of
active trading is constant rebalancing  namely  fix a portfolio b and  re invest your dollars
each day according to b  we denote this constant rebalancing strategy by cbalb and let
cbal denote the optimal  in hindsight  cbal  a constant rebalancing strategy can often
   any ps algorithm can be modified to be universal by investing any fixed fraction of the initial wealth in
a universal algorithm 
   there is nothing special about daily closing prices and the problem can be defined with respect to any
 sub sequence of the  intra day  sequence of all price offers which appear in the stock market 
   for example the dow jones industrial average  djia  is calculated as a non uniform average of the   
djia stocks  see e g  http   www dowjones com 

   

fican we learn to beat the best stock

take advantage of market fluctuations to achieve a return significantly greater than that of
is always at least as good as the best stock bah and in some real market
sequences a constant rebalancing strategy will take advantage of market fluctuations and
significantly outperform the best stock  see e g  table     for now  consider cover and
glusss        classic  but contrived  example
of cash and one stock
    consisting

   ofa market
              now consider the cbalb
and the market sequence of price relatives    
         
with b                on each odd day the daily return of cbalb is                  and on each even
day  it is      the total return over n days is therefore      n     illustrating how a constant
rebalancing strategy can yield exponential returns in a no growth market  under the
assumption that the daily market vectors are observations of identically and independently
distributed  i i d  random variables  it is shown in  cover   thomas        that cbal
performs at least as good  in the sense of expected total return  as the best online portfolio
selection algorithm  however  many studies  see e g  lo   mackinlay        argue that
stock price sequences do have long term memory and are not i i d 
a non traditional objective  in computational finance  is to develop online trading
strategies that are in some sense always guaranteed to perform well   within a line of
research pioneered by cover  cover   gluss        cover        cover   ordentlich       
one attempts to design portfolio selection algorithms that can provably do well  in terms
of their total return  with respect to some online or offline benchmark algorithms  two
natural online benchmark algorithms are the uniform buy and hold u bah  and the uniform
 
 
      m
   a natural
constant rebalancing strategy u cbal  which is cbalb with b     m

offline benchmark is bah and a more challenging offline benchmark is cbal  
a portfolio selection algorithm a is called universal if for every market sequence x over
n days  it guarantees a subexponential ratio  in n  between its return retx  a  and that of
retx  cbal    in particular  cover and ordentlichs universal portfolios algorithm  cover 
      cover   ordentlich         denoted here by universal  was proven to be universal 
more specifically for every market sequence x of m stocks over n days  it guarantees the
subexponential  indeed polynomial  ratio
 m  
   
retx  cbal   retx  universal    o n    
bah   cbal

from a theoretical perspective this is surprising as this performance ratio is bounded by
a polynomial in n  for fixed m  whereas cbal is capable of exponential returns  from a
practical perspective  this bound is not very useful because the empirical returns observed
for cbal portfolios is often not exponential in the number of trading days  however  the
motivation that underlies the potential of cbal algorithms is useful  we follow this motivation and develop a new algorithm which we call anticor  by attempting to systematically
follow the constant rebalancing philosophy  anticor is capable of some extraordinary performance in the absence of transaction costs  or even with very small transaction costs 
   a trading strategy is online if it computes the portfolio for the  t   st day using only market information
for the first t days  this is in contrast to offline algorithms such as u bah   cbal and the optimal
strategy of picking the best stock for each individual day  such offline algorithms compute a sequence
of portfolios as a function of the entire market sequence 

   

fiborodin  el yaniv    gogan

   trying to learn the winners
the most direct approach to expert learning and portfolio selection is a  reward based 
weighted average prediction scheme  which adaptively computes a weighted average of
experts by gradually increasing  by some multiplicative or additive update rule  the relative
weights of the more successful experts  in this section we briefly discuss some related
portfolio selection results along these lines 
for example  in the context of the ps problem consider the exponentiated gradient
eg   algorithm proposed by  helmbold et al          the eg   algorithm computes the
next portfolio to be
bt  j  exp  xt  j   bt  xt   
bt    j    pm
 
j   bt  j  exp  xt  j   bt  xt   
where  is a learning rate parameter  eg was designed to greedily choose the best portfolio
for yesterdays market xt while at the same time paying a penalty from movingp
far from yesterdays portfolio  for a universal bound on eg  helmbold et al  set     xmin   log m  n
where xmin is a lower bound on any price relative   it is easy to see that as n increases  
decreases to   so that we can think of  as being very small in order to achieve universality 
when       the algorithm eg   degenerates to the uniform cbal  assuming we started
with a uniform portfolio  which is not a universal algorithm  it is also the case that if each
day the price relatives for all stocks were identical  then eg  as well as other ps algorithms 
will converge to the uniform cbal  combining a small learning rate with a reasonably
balanced market we expect the performance of eg to be similar to that of the uniform
cbal and this is confirmed by our experiments  see table     
covers universal algorithms adaptively learn each days portfolio by increasing the
weights of successful cbals  the update rule for these universal algorithms is
r
b  rett  cbalb  d b 
bt     r
 
rett  cbalb  d b 
where    is some prior distribution over portfolios  thus  the weight of a possible portfolio
is proportional to its total return rett  b  thus far times its prior  the particular universal algorithm we consider in our experiments uses the dirichlet prior  with parameters
                      cover   ordentlich          somewhat surprisingly  as noted in  cover   ordentlich        the algorithm is equivalent to a static weighted average  given by  b   over
all cbals  see also borodin   el yaniv        p        this equivalence helps to demystify
the universality result and also shows that the algorithm can never outperform cbal  
   helmbold et al  show how to eliminate the need to know xmin and n  while eg can be made universal 
its performance ratio is only sub exponential  and not polynomial  in n 
   following helmbold et al  we fix         in our experiments  additional experiments  for a wide range
of fixed  settings  confirm that for our datasets the choice of         is an optimal or near optimal
choice  of course  it is possible to adaptively set  throughout the trading period  but that is beyond
the scope of this paper 
   the papers  cover        cover   ordentlich        blum   kalai        consider a simpler version
of this algorithm where the  dirichlet  prior is uniform  this algorithm is also universal and achieves
a ratio  nm     experimentally  on our datasets  there is a negligible difference between these two
variants and here we only report on the results of the asymptotically optimal algorithm 

   

fican we learn to beat the best stock

a different type of winner learning algorithm can be obtained from any sequence
prediction strategy  as noted in  borodin  el yaniv    gogan         for each stock j  a
 soft  sequence prediction algorithm provides a probability p j  that the next symbol will
be j              m   we view this as a prediction that stock j will have the best relative
price for the next day and set bt    j    pj   the paper  borodin et al         considers
predictions made using the prediction component of the well known lempel ziv  lz  lossless
compression algorithm  ziv   lempel         this prediction component is nicely described
in  langdon        and in  feder         as a prediction algorithm  lz is provably powerful
in various senses  first it can be shown that it is asymptotically optimal with respect to any
stationary and ergodic finite order markov source  rissanen        ziv   lempel        
moreover  feder shows that lz is also universal in a worst case sense with respect to the
 offline  benchmark class of all finite state prediction machines  to summarize  the common
approach to devising ps algorithms has been to attempt and learn winners using simple or
more sophisticated winner learning schemes 

   the anticor algorithm
we propose a different approach  motivated by a cbal inspired philosophy  how can we
interpret the success of the uniform cbal on the cover and gluss example of section   
clearly  the uniform cbal here is taking advantage of price fluctuation by constantly transferring wealth from the high performing stock to the relatively low performing stock  even
in a less contrived market  a cbal is capable of large returns  a market model favoring
the use of a cbal is one in which stock growth rates are stable in the long term and occasional larger return rates will be followed by smaller rates  and vice versa   this market
phenomenon is is sometimes called reversal to the mean 
there are many ways that one can interpret and implement algorithms based on the
philosophy of reversal to the mean  in particular  any cbal can be viewed as a static
implementation of this philosophy  we now describe the motivation and basic ingredients in
our anticor algorithm which adaptively  based on recent empirical statistics  and rather
aggressively  implements reversal to the mean 
for a given trading day  consider the most recent past w trading days  where w is some
integer parameter  the growth rate of any stock i during this window of time is measured
by the product of relative prices during this window   motivated by the assumption that we
have a portfolio of stocks that are all performing similarly in terms of long term growth rates 
anticors first condition for transferring money from stock i to stock j is that the growth
rate for stock i exceeds that of stock j in this most recent window of time    in addition 
the anticor algorithm requires some indication that stock j will start to emulate the past
growth of stock i in the near future  to this end  anticor requires a positive correlation
between stock i during the second last window and stock j during the last window  the
relative extent to which we will transfer money from stock i to stock j will depend on
   our anticor algorithm is aggressive  say  compared to cbal  in the sense that it can transfer all
assets out of a given stock  various heuristics can be used to moderate this behavior 
   since we would rather deal with arithmetic instead of geometric means we will use the logarithms of
relative prices 
    note that here the umderlying model assumption is reversal to the same mean  one can modify the
algorithm so as to account for different means 

   

fiborodin  el yaniv    gogan

the strength of this correlation as well as the strength of the self anti correlations for
stocks i and j  again in two consecutive windows   anticor is so named because we use
these correlations and anticorrelations in consecutive windows to indicate the potential for
anticorrelations of the growth rates for stocks i and j in the near future  with hopefully the
growth rate of stock j becoming greater than that of stock i  
formally  we define
lx    log xt w              log xtw  t and lx    log xtw              log xt  t  

   

where log xk   denotes  log xk               log xk  m     thus  lx  and lx  are the two vector
sequences  equivalently  two w  m matrices  constructed by taking the logarithm over the
market subsequences corresponding to the time windows  t   w      t  w  and  t  w      t  
respectively  we denote the jth column of lxk by lxk  j   let k    k              k  m   
be the vectors of averages of columns of lxk   similarly  let k   be the vector of standard
deviations of columns of lxk   the cross correlation matrix  and its normalization  between
column vectors in lx  and lx  are defined as  
 
 lx   i      i  t  lx   j      j   
w

 
 
mcov  i j 
   i    j     i      j       
mcor  i  j   
 
otherwise 

mcov  i  j   

   

mcor  i  j          measures the correlation between log relative prices of stock i over the
first window and stock j over the second window  we note that if    i   respectively 
   j   is zero over some window then the growth rate of stock i during the second last
window  respectively  stock j during the last window  is constant during this window  for
sufficiently large windows of time constant growth of any stock i is unlikely  however  in
this unlikely case we choose not to move money into or out of such a stock i   
for each pair of stocks i and j we compute claimij   the extent to which we want to shift
our investment from stock i to stock j  namely  there is such a claim iff    i       j  and
mcor  i  j      in which case claimij   mcor  i  j    a i    a j  where a h     mcor  h  h   if
mcor  h  h       else    following our interpretation for the success of a cbal  mcor  i  j     
is used to predict that stocks i and j will be correlated in consecutive windows  i e  the
current window and the next window based on the evidence for the last two windows  and
mcor  h  h      predicts that stock h p
will be negatively auto correlated over consecutive
windows  finally 
b
 i 
 
b
 i 
 
t
j  i  transferji  transferij   where transferij  
p t  
bt  i   claimij   j claimij   a pseudocode summarizing the anticor algorithm appears
in figure    the pseudocode describes the routine anticor w  t  xt   bt   that receives a
window size w  the current trading day t  the historical market sequence xt  giving the
market vectors corresponding to days            t  and the current portfolio bt defined to be
bt   bt xt  bt    xt              bt  m xt  m    the routine is first called with an empty historical
market sequence and with bt being the uniform portfolio  over m stocks   the routine
    recall that the correlation coefficient is a normalized covariance with the covariance divided by
the product of the standard deviations  that is  cor x  y     cov x  y    std x   std y    where
cov x  y     e  x  mean x   y  mean y     
    of course  other approaches can be used to accommodate constant or nearly constant growth rate 

   

fican we learn to beat the best stock

returns the new portfolio  to which we should rebalance at the start of the  t     st trading
day 
algoritm anticor w  t  xt   bt  
input 
   w  window size
   t  index of last trading day
   xt   x            xt   historical market sequence
   bt   current portfolio  by the end of trading day t 
output  bt     next days portfolio
   return the current portfolio bt if t    w 
   compute lx  and lx  as defined in equation      and   and     the  vector  averages of
lx  and lx    respectively 
   compute mcor  i  j  as defined in equation     
   calculate claims  for    i  j  m  initialize claimij    
   if    i      j  and mcor  i  j      then
 a  claimij   claimij   mcor  i  j  
 b  if mcor  i  i      then claimij   claimij  mcor  i  i  
 c  if mcor  j  j      then claimij   claimij  mcor  j  j  
   calculate new portfolio  initialize bt     bt   for    i  j  m
p
 a  let transferij   bti  claimij   j claimij  
 b  bt  
  bt  
 transferij  
i
i
 c  bt  
  bt  
  transferji  
i
i

figure    algorithm

anticor

our anticorw algorithm has one critical parameter  the window size w  in figure  
we depict the total return of anticorw on two historical datasets as a function of the
window size w                  detailed descriptions of these datasets appear in section     as
we might expect  the performance of anticorw depends significantly on the window size 
however  for all w  anticorw beats the uniform market and  moreover  it beats the best
stock using most window sizes  of course  in online trading we cannot choose w in hindsight 
viewing the anticorw algorithms as experts  we can try to learn the best expert  but the
windows  like individual stocks  induce a rather volatile set of experts and standard expert
combination algorithms  cesa bianchi et al         tend to fail   
alternatively  we can adaptively learn and invest in some weighted average of all anticorw
algorithms with w less than some maximum w   the simplest case is a uniform investment on all the windows  that is  a uniform buy and hold investment on the algorithms
anticorw   w      w    denoted by bahw  anticor   figure   graphs the total return of
bahw  anticor  as a function of w for all values of    w     for the four datasets we
consider here  considering these graphs  our choice of w      was arbitrary but clearly not
    this assertion is based on empirical studies we conducted with various expert advice algorithms 

   

fiborodin  el yaniv    gogan

nyse  anticorw vs  window size

tsx  anticorw vs  window size

   

bah anticor window  
anticor window 
best stock
market return

 

  

  

anticorw

 

total return

total return  logscale 

   

  

bah anticorw 
anticorw
best stock
market

best stock

anticorw
best stock

  

  

 

  

  

 

  

 

  

 

 

  

  

  

  

 

  

 

  

window size  w 

 a 

  

bah anticorw 
anticorw

best stock
market return

   

best stock
market return

anticorw

 

total return

total return

  

djia  anticorw vs  window size

 

bah anticor  
w
anticorw

  

  

 b 

sp     anticorw vs  window size
  

  
window size  w 

anticorw
 

 

   

 
 

 

best stock

best stock

 
 

  

  

  

  

  

window size  w 

 

  

  

  

  

  

window size  w 

 c 
figure   

   

 d 

anticorw s

total return  per    investment  vs  window size    w     for
 a  nyse   b  tsx   c  sp      d  djia  the dashed  red  lines represent the
final return of the best stock and the dash dotted  blue  lines  the final return
the  uniform  market  the dotted  green  horizontal lines represent a uniform
investment on a number of anticorw applications as later described 

optimal  of course  we could try to optimize the parameter w for each particular dataset
by training the algorithm on historical data before beginning to trade  however  our claim
is that almost any choice of w will yield returns that beat the best stock  the only exception
is w     in the djia dataset  
since we now consider the various algorithms as stocks  whose prices are determined by
the cumulative returns of the algorithms   we are back to our original portfolio selection
problem and if the anticor algorithm performs well on stocks it may also perform well on
algorithms  we thus consider active investment in the various anticorw algorithms using
anticor  we again consider all windows w  w   of course  we can continue to compound
the algorithm any number of times  here we compound twice and then use a buy and hold
investment  the resulting algorithm is denoted bahw  anticor anticor    one impact of
this compounding  depicted in figure    is to smooth out the anti correlations exhibited in
the stocks  it is evident that after compounding twice the returns become almost completely
   

fican we learn to beat the best stock

nyse  total return vs  max window

  

 

 

  

bah  anticor 
w

bahw anticor 

 

  

total return

total return  logscale 

  

tsx  total return vs max window
bahw anticor 

  

best stock
market

 

  

 

  

best stock

  
bahw anticor 
  

  

 

best stock
market

best stock

  

 

 

  

 

  

 

  

  

  

  

 

  

  

  

 a 
   

w

 

total return

total return

   

 

best stock
 

figure   

bahw anticor 
best stock

   

bahw anticor 

 

 

 
 

bahw anticor 

  

  

best stock
market

   

best stock
market
  

  

djia  total return vs max window

bah  anticor 

 

  

 b 

sp     total return vs max window
 

  

maximal window size  w 

maximal window size  w 

  

  

 

  

  

  

maximal window size  w 

maximal window size  w 

 c 

 d 

  

  

bahw  anticor s

total return  per    investment  as a function of the maximal
window w   nyse  a   tsx  b   sp     c   djia  d  

correlated thus diminishing the possibility that additional compounding will substantially
help    this idea for smoothing critical parameters may be applicable in other learning
applications  the challenge is to understand the conditions and applications in which the
process of compounding algorithms will have this smoothing effect 

   an empirical comparison of the algorithms
we present an experimental study of the the anticor algorithm and the three online
learning algorithms described in section    we focus on bah    anticor   abbreviated by
anti  and bah    anticor anticor    abbreviated by anti    four historical datasets are
used  the first nyse dataset  is the one used in  cover        cover   ordentlich       
helmbold et al         and  blum   kalai         this dataset contains      daily prices
for    stocks in the new york stock exchange  nyse  for the twenty two year period july
 rd        to dec   st         the second tsx dataset consists of    stocks from the toronto
stock exchange  tsx   for the five year period jan  th        to dec   st         the third
    this smoothing effect also allows for the use of simple prediction algorithms such as expert advice
algorithms  cesa bianchi et al          which can now better predict a good window size  we have not
explored this direction 

   

fiborodin  el yaniv    gogan

djia  dec           jan         
anticor 

stocks
   

 

anticor

   
   

 

total return

   

 

   

   
   

   

   

   
   

 

   
   

   

   

   

   

 

   
             
days

             
days

             
days

figure    cumulative returns for last month of the djia dataset  stocks  left panel  
anticorw algorithms trading the stocks  denoted anticor    middle panel  
anticorw algorithms trading the anticor algorithms  right panel  

dataset consists of the    stocks from sp    which  as of apr        had the largest market
capitalization  this set spans      trading days for the period jan  nd        to jan   st  
      the fourth dataset consists of the thirty stocks composing the dow jones industrial
average  djia  for the two year period      days  from jan   th        to jan   th          
algorithm
market  u bah 
best stock
cbal
u cbal
anti 
anti 
lz
eg
universal

nyse
     
     
      
     
             
              
     
     
     

tsx
    
    
    
    
     
     
    
    
    

sp   
    
    
    
    
    
    
    
    
    

djia
    
    
    
    
    
    
    
    
    

nyse 
    
    
    
    
      
       
    
    
    

tsx 
    
     
     
    
    
    
    
    
    

sp    
    
    
    
    
    
    
    
    
    

djia 
    
    
    
    
    
    
    
    
    

table    monetary returns in dollars  per    investment  of various algorithms for four
different datasets and their reversed versions  the winner and runner up for each
market appear in boldface  all figures are truncated to two decimals 
these four datasets are quite different in nature  the market returns for these datasets
appear in the first row of table     while every stock in the nyse increased in value    
of the    stocks in the tsx lost money    of the    stocks in the sp    lost money and
    the four datasets  including their sources and individual stock compositions can be downloaded from
http   www cs technion ac il rani portfolios 

   

fican we learn to beat the best stock

   of the    stocks in the negative market djia lost money  with the exception of the
tsx  these data sets include only highly liquid stocks with large market capitalizations  in
order to maximize the utility of these datasets and yet present rather different markets  we
also ran each market in reverse  this is simply done by reversing the order and inverting
the relative prices  the reverse datasets are denoted by a    superscript  some of the
reverse markets are particularly challenging  for example  all of the nyse  stocks are
going down  note that the forward and reverse markets  i e  u bah  for the tsx are both
increasing but that the tsx  is also a challenging market since so many stocks     of    
are declining 
table   reports on the total returns of the various algorithms for all eight datasets  we
see that prediction algorithms such as lz can do quite well and the more aggressive anti 
and anti  have excellent and sometimes fantastic returns  note that these active strategies
beat the best stock and even cbal in all markets with the exception of the tsx  in which
case they still significantly outperform the market  the reader may well be distrustful of
what appears to be such unbelievable returns for anti  and anti  especially when applied
to the nyse dataset  however  recall that the nyse dataset consists of n        trading
days and the y such that y n   the total nyse return is approximately           for
anti   respectively            for anti     that is  the average daily increase is less than
     respectively         we observe that learning algorithms such as universal and eg
have no substantial advantage over u cbal  some previous expositions of these algorithms
highlighted particular combinations of stocks where the returns significantly outperformed
the best stock  but the same can be said for u cbal 
djia  cumulative total returns
   

cumulative total return

 

anti 
anti 
best stock
market

anti 
 

anti

   
   
   
   

best stock

 
   

market

jan  

jan  

jan  

date

figure    djia  cumulative returns of of
 the market  

anti    anti   

the best stock and a uniform

bah

the total returns of anti  and anti  presented in table   are impressive but are far
from telling a complete story  consider the graphs in figure    while both anti  and anti 
perform well with respect to the uniform market and the best stock throughout most of the
investment period  there are some periods where the cumulative return of these strategies
   

fiborodin  el yaniv    gogan

decrease  this  not surprising  behavior indicates that there is a certain degree of risk in
using these investment algorithms 
in finance the standard risk measure is the standard deviation of the return  in table  
we provide annualized returns and risks as well as risk adjusted returns for all markets
and algorithms considered here    for example  the annualized return of the best stock in
the djia set is       its annualized risk  standard deviation  is     and its annualized
risk adjusted return  sharpe ratio  is     
algorithm
market
 u bah 
best stock
cbal
u cbal
anti 
anti 
lz
eg
universal

nyse
       
   
       
   
       
   
       
   
        
    
        
    
       
   
       
   
       
   

tsx
       
   
       
   
       
    
      
   
       
    
        
    
      
  
      
   
      
   

sp   
      
  
       
   
       
   
       
   
       
   
       
   
       
   
       
   
       
   

djia
       
    
      
   
       
   
      
    
       
   
       
    
      
    
      
    
      
    

nyse 
      
    
      
    
      
  
      
    
       
   
       
    
      
  
      
    
      
    

tsx 
       
   
         
   
        
    
      
   
       
    
       
   
       
    
      
   
      
   

sp    
      
    
       
   
       
   
      
   
       
    
       
    
      
     
      
   
      
    

djia 
       
   
        
   
       
   
       
   
       
    
        
    
       
    
       
   
       
   

table    annualized returns and respective annualized volatilities as well as annualized riskadjusted returns  sharpe ratio  of the various algorithms over three datasets and
their reversed versions  the winner and runner up sharpe ratio for each market
appear in boldface  all figures are truncated to two decimals 

   on commissions  trading friction and other caveats
when handling a portfolio of m stocks our algorithm may perform up to m transactions
per day  a major concern is therefore the commissions it will incur  within the proportional commission model  see e g  blum   kalai        borodin   el yaniv        section
        there exists a fraction          such that an investor pays at a rate of    for
each buy and for each sell  therefore  the return
of a sequence b            bn of portfolios

q 
p
with respect to a market sequence x            xn is t bt  xt     j    bt  j   bt  j      where
    the annualized return is estimated using the geometric mean ofthe individual daily returns and the risk
is the standard deviation of these daily returns multiplied by     where     is the assumed standard
number of trading days per year  these calculations are standard  the  annualized  sharpe ratio
 sharpe        is the ratio of annualized return minus the risk free return  taken to be     divided by
the  annualized  standard deviation 

   

fican we learn to beat the best stock

bt   bt xt  bt    xt              bt  m xt  m      our investment algorithm in its simplest form
can tolerate very small proportional commission rates and still beat the best stock  the
graphs in figure   depict the total returns of bah    anticor  with proportional commission factor                            the strategy can withstand small commission factors 
for example  with         the algorithm still beat the best stock in all four markets we
consider  and it beats the market with           moreover it still clearly beats the market
whenever         
nyse

  

  

 

best stock

  

tsx

  

anti 
return

return  logscale 

  

market

  
  
  
 

 

  

 

 

   
   
   
   
commission rate   

 
 

 

sp   

 

   
   
   
   
commission rate   

 

djia

 
return

return

 
 
 

   

 

 
 

       
   
   
   
commission rate   

figure    total returns of
                       

   
 

 

bah    anticor 

   
   
   
   
commission rate   

 

with proportional commissions 

 

however  some current online brokers charge very small proportional commissions  perhaps in addition to a small flat commission rate for all trades    this means that a large
investor can scale up the investment and suffer only a small proportional transaction rate 
an additional caveat is our assumption that all trades could be implemented using the
closing price  while in principle there is nothing special about the closing price  i e  our
algorithms can trade at any time during the trading day  practical consideration related
to dataset gathering and availability dictated the use of these prices    our algorithms
    we note that blum and kalai        showed that the performance guarantee of universal still holds
 and gracefully degrades  in the case of proportional commissions 
    for example  on its usa site  e trade  https   us etrade com  offers a flat fee of     for any trade
up to      shares and then      share thereafter 
    specifically  historical closing prices are in the public domain and allow for experimental reproducibility 
historical intraday trading quotes can also be gathered but such data is usually protected and can be
costly to obtain 

   

fiborodin  el yaniv    gogan

assume that all portfolio adjustments are implemented using the quoted prices they receive
as inputs  this means that all transactions are implemented simultaneously using the
quoted prices  with current online brokers a computerized system can issue all transaction
orders almost instantly but there is no guarantee that they will be all implemented instantly 
this trading friction will necessarily generate discrepancies between the input prices and
implementation prices 
a related problem that one must face when actually trading is the difference between
bid and ask prices  these bid ask spreads  and the availability of stocks for both buying and
selling  are functions of stock liquidity and are typically small for large market capitalization
stocks  we consider here only very large market cap stocks 
any report of abnormal returns using historical markets should be suspected of data
snooping  in particular  all of our historical data sets are conditioned on the fact that
all stocks were traded every day and there were no bankrupcies or stocks that became
virtually worthless in any of these data sets  furthermore  when a dataset is excessively
mined by testing many strategies there is a substantial chance that one of the strategies
will be successful by simple over fitting  another data snooping hazard is stock selection 
our anticor algorithms were fully developed using only the nyse and tsx datasets 
the djia and sp    sets were obtained  from public domain sources  after the algorithms
were fixed  finally  our algorithm has one parameter  the maximal window size w    our
experiments clearly indicate that the algorithms performance is robust with respect to w
 see  for example  figure    

   concluding remarks
traditional work in financial economics tend to focus on the understanding of stock price
determination  the main question there is  can we predict the stock market  judging by
the extensive but inconclusive work done in financial forecasting  perhaps this is not the most
beneficial question to ask  rather  can a computer program consistently outperform the
market  besides practicality  it is clear that any successful portfolio selection algorithm is in
itself a mathematical model that can provide some new intuition on stock price formation 
for example  in our case  the algorithms suggest that some stock price fluctuations are
sufficiently periodic and anti correlated 
a number of well respected works report on statistically robust abnormal returns
for simple technical analysis heuristics  which slightly beat the market  for example 
the landmark study of brock  lakonishok  and lebaron        apply    simple trading
heuristics to the djia index from      to      and provide strong support for technical
analysis heuristics  while consistently beating the market is considered a significant  if not
impossible  challenge  our approach to portfolio selection indicates that beating the best
stock is an achievable goal  while we have mainly focused on an idealized frictionless
setting  we believe that even in such a frictionless setting  which seems like a reasonable
starting point  no such results have been previously claimed in the literature 
the results presented here raise various interesting questions  since simple statistical
relations such as correlation give rise to such outstanding returns it is plausible that various
other  perhaps more sophisticated machine learning techniques  can give rise to better

   

fican we learn to beat the best stock

portfolio selection algorithms capable of larger returns and tolerating larger commissions
fees 
on the theoretical side  what is missing at this point of time is an analytical model which
better explains why our active trading strategies are so successful  in this regard  we are
investigating various statistical adversary models along the lines suggested by raghavan
       and chou et al          namely  we would like to show that an algorithm performs
well  relative to some benchmark  for any market sequence that satisfies certain constraints
on its empirical statistics 
one final caveat needs to be mentioned  namely  the entire theory of portfolio selection
algorithms assumes that any one portfolio selection algorithm has no impact on the market 
but just like any goose laying golden eggs  widespread use will soon lead to the end of the
goose  in our case  the market will quickly react to any method which does consistently
and substantially beat the market 

acknowledgments
we thank michael loftus for his helpful comments  we also thank izzy nelken and super
computing inc  for their help in validating the djia dataset 

references
blum  a     kalai  a          universal portfolios with and without transaction costs 
machine learning               
borodin  a     el yaniv  r          online computation and competitive analysis  cambridge university press 
borodin  a   el yaniv  r     gogan  v          on the competitive theory and practice
of portfolio selection  in proc  of the  th latin american symposium on theoretical
informatics  latin     pp         
brock  l   lakonishok  j     lebaron  b          simple technical trading rules and the
stochastic properties of stock returns  journal of finance               
cesa bianchi  n   freund  y   haussler  d   helmbold  d   schapire  r     warmuth  m 
        how to use expert advice  journal of the acm                 
chou  a   cooperstock  j   el yaniv  r   klugerman  m     leighton  t          the
statistical adversary allows optimal money making trading strategies  in proceedings
of the  th annual acm siam symposium on discrete algorithms 
cover  t          universal portfolios  mathematical finance         
cover  t     gluss  d          empirical bayes stock market portfolios  advances in applied
mathematics            
cover  t     ordentlich  e          universal portfolios with side information  ieee
transactions on information theory                 
cover  t     thomas  j          elements of information theory  john wiley   sons  inc 
feder  m          gambling using a finite state machine  ieee transactions on information
theory               
   

fiborodin  el yaniv    gogan

helmbold  d   schapire  r   singer  y     warmuth  m          portfolio selection using
multiplicative updates  mathematical finance                
langdon  g          a note on the lempel ziv model for compressing individual sequences 
ieee transactions on information theory             
lo  a     mackinlay  c          a non random walk down wall street  princeton
university press 
lugosi  g         
lectures on prediction
url http   www econ upf es lugosi ihp ps 

of

individual

sequences 

markowitz  h          portfolio selection  efficient diversification of investments  john
wiley and sons 
raghavan  p          a statistical adversary for on line algorithms  dimacs series in
discrete mathematics and theoretical computer science          
rissanen  j          a universal data compression system  ieee transactions on information theory             
sharpe  w          adjusting for risk in portfolio performance measurement  journal of
portfolio management        winter 
ziv  j     lempel  a          compression of individual sequences via variable rate coding 
ieee transactions on information theory             

   

fi