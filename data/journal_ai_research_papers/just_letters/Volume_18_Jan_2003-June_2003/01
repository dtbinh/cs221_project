journal artificial intelligence research                

submitted        published      

monte carlo methods tempo tracking
rhythm quantization
ali taylan cemgil
bert kappen

snn  geert grooteplein    cpk         university nijmegen
nl      ez nijmegen  netherlands

cemgil snn kun nl
bert snn kun nl

abstract

present probabilistic generative model timing deviations expressive music performance  structure proposed model equivalent switching state
space model  switch variables correspond discrete note locations musical
score  continuous hidden variables denote tempo  formulate two well known
music recognition problems  namely tempo tracking automatic transcription  rhythm
quantization  filtering maximum posteriori  map  state estimation tasks  exact computation posterior features map state intractable model
class  introduce monte carlo methods integration optimization  compare
markov chain monte carlo  mcmc  methods  such gibbs sampling  simulated annealing iterative improvement  sequential monte carlo methods  particle filters  
simulation results suggest better results sequential methods  methods
applied online batch scenarios tempo tracking transcription
thus potentially useful number music applications adaptive automatic
accompaniment  score typesetting music information retrieval 
   introduction
automatic music transcription refers extraction human readable interpretable
description recording musical performance  traditional music notation
description lists pitch levels  notes  corresponding timestamps 
ideally  one would recover score directly audio signal  representation surface structure music would useful music information retrieval
 music ir  content description musical material large audio databases  however 
operating sampled audio data polyphonic acoustical signals  extraction
score like description challenging auditory scene analysis task  vercoe  gardner 
  scheirer        
paper  focus subproblem music ir  assume exact timing
information notes available  example stream midi  events digital
keyboard 
model tempo tracking transcription midi like music representation
useful broad spectrum applications  one example automatic score typesetting 
   musical instruments digital interface  standard communication protocol especially designed digital
instruments keyboards  time key pressed  midi keyboard generates short message
containing pitch key velocity  computer tag received message timestamp real time
processing and or recording file 

c      ai access foundation morgan kaufmann publishers  rights reserved 

ficemgil   kappen
musical analog word processing  almost score typesetting applications provide
means automatic generation conventional music notation midi data 
conventional music notation  onset time note implicitly represented
cumulative sum durations previous notes  durations encoded simple rational
numbers  e g   quarter note  eighth note   consequently events music placed
discrete grid  basic task midi transcription associate onset times
discrete grid locations  i e   quantization 
however  unless music performed mechanical precision  identification
correct association becomes dicult  due fact musicians introduce
intentional  and unintentional  deviations mechanical prescription  example
timing events deliberately delayed pushed  moreover  tempo uctuate
slowing accelerating  fact  deviations natural aspects expressive
performance  absence these  music tends sound rather dull mechanical 
hand  deviations accounted transcription  resulting
scores often poor quality 
robust fast quantization tempo tracking important requirement
interactive performance systems  applications  listen  performer generating
accompaniment improvisation real time  raphael      b  thom         last 
models useful musicology systematic study characterization expressive
timing principled analysis existing performance data 
theoretical perspective  simultaneous quantization tempo tracking
 chicken and egg  problem  quantization depends upon intended tempo interpretation tempo interpretation depends upon quantization  apparently  human
listeners resolve ambiguity  in cases  without effort  even persons without
musical training able determine beat tempo rapidly  however 
still unclear precisely constitutes tempo relates perception
beat  rhythmical structure  pitch  style music etc  tempo perceptual construct
cannot directly measured performance 
goal understanding tempo perception stimulated significant body research psychological computational modeling aspects tempo tracking
beat induction  e g   see  desain   honing        large   jones        toiviainen        
papers assume events presented onset list  attempts made
deal directly audio signal  goto   muraoka        scheirer        dixon  
cambouropoulos        
another class tempo tracking models developed context interactive
performance systems score following  models make use prior knowledge
form annotated score  dannenberg        vercoe   puckette         recently 
raphael      b  demonstrated interactive real time system follows solo player
schedules accompaniment events according player s tempo interpretation 
tempo tracking crucial quantization  since one uniquely quantize onsets
without estimate tempo beat  converse  quantization
help identification correct tempo interpretation already noted desain
honing         here  one defines correct tempo one results simpler
quantization  however  schema never fully implemented practice due
computational complexity obtaining perceptually plausible quantization  hence

  

fimonte carlo methods tempo tracking rhythm quantization
quantization methods proposed literature either estimate tempo using simple
heuristics  longuet higgins        pressing   lawrence        agon  assayag  fineberg 
  rueda        assume tempo known constant  desain   honing       
cambouropoulos        hamanaka  goto  asoh    otsu        
approach transcription tempo tracking probabilistic  i e   bayesian
modeling perspective  cemgil et al          introduced probabilistic approach
perceptually realistic quantization  work assumed tempo known
estimated external procedure  tempo tracking  introduced kalman filter
model  cemgil  kappen  desain    honing         approach  modeled tempo
smoothly varying hidden state variable stochastic dynamical system 
current paper  integrate quantization tempo tracking  basically 
model balances score complexity versus smoothness tempo deviations  correct tempo
interpretation results simple quantization correct quantization results
smooth tempo uctuation  essentially similar model proposed recently raphael
     a   however  raphael uses inference technique applies small models 
namely continuous hidden state one dimensional  severely restricts
models one consider  current paper  survey general widely used state ofthe art techniques inference 
outline paper follows  section    propose probabilistic model
timing deviations expressive music performance  given model  define tempo
tracking quantization inference posterior quantities  turn model
switching state space model computation exact probabilities becomes intractable  section    introduce approximation techniques based simulation 
namely markov chain monte carlo  mcmc  sequential monte carlo  smc   doucet 
de freitas    gordon        andrieu  de freitas  doucet    jordan         approaches
provide exible powerful inference methods successfully applied diverse fields applied sciences robotics  fox  burgard    thrun         aircraft
tracking  gordon  salmond    smith         computer vision  isard   blake         econometrics  tanizaki         finally present simulation results conclusions 

   model
assume pianist improvising recording exact onset times key
presses performance  denote observed onset times y    y    y       
yk       yk compactly y  k   neither access musical notation
piece know initial tempo started performance with  moreover 
pianist allowed freely change tempo introduce expression  given onset
time information y  k   wish find score   k track tempo uctuations z  k  
refine meaning z later 
problem apparently ill posed  pianist allowed change tempo
arbitrarily possible assign  correct  score given performance 
words performance y  k represented using suitable combination
arbitrary score arbitrary tempo trajectory  fortunately  bayes theorem provides
elegant principled guideline formulate problem  given onsets y  k  
best score   k tempo trajectory z  k derived posterior distribution

  

ficemgil   kappen
given
 
p y j   z  p    z  
p y  k     k   k   k   k   k
quantity  proportional product likelihood term p y  k j   k   z  k  
prior term p    k   z  k   
rhythm transcription tempo tracking  prior encodes background knowledge nature musical scores tempo deviations  example  construct prior prefers  simple  scores smooth tempo variations 
likelihood term relates tempo score actual observed onset times 
respect  likelihood model short time expressive timing deviations motor
errors introduced performer 

p    k   z  k jy  k    

  c 
  c 
       f
  ck
ee

cc
f
ee
ee
cc

ee
ee
cc

ee
ee
cc

cc
e 
e 
 
      

c  ee

 

k  

 

     
   
   
bb
  
bb
bb
  
bb
bb
  
bb
bb
  
bb
b
  
b 
b 
   
   
     

  b

 


y 



y 



y 

     
cc quantization
cc
hh
cc
hh
cc
hh
cc
h 
 
  ck

  hh

k

score

  k
   tempo
  
trajectory
  
ee
 
ee
  
ee
  
ee
  
e 
 
  k
     noiseless
 
onsets

k  e
 

 



k  


   

   

locations



yk  

yk

  observed
  
onsets

figure    graphical model  square oval nodes correspond discrete continuous
variables respectively  text  sometimes refer continuous hidden
variables  k   k   zk   dependence c deterministic 
c    hidden  onsets observed 

    score prior
define score   k   first introduce sequence quantization locations c  k  
quantization location ck specifies score time k th onset  let k denote
interval quantization locations two consecutive onsets
k   ck

ck  

   

example consider conventional music notation
encodes score      
             corresponding quantization locations c                  
one simple way defining prior distribution quantization locations p ck   specifying table probabilities ck mod    the fraction ck    example wish


  





fimonte carlo methods tempo tracking rhythm quantization
allow scores sixteenth notes triplets  define table probabilities
states c mod     f                  g f             g  technically  resulting prior
p ck   periodic improper  since ck principle unbounded normalize
distribution  
however  number states ck mod   large  may dicult estimate
parameters prior reliably  situations propose  generic  prior follows 
define probability  k th onset gets quantized location ck   p ck    
exp  d ck    d ck   number significant digits binary expansion ck
mod    example d         d           d               etc  positive parameter
used penalize quantization locations require bits represented  assuming
quantization locations onsets independent a priori   besides increasing
k  i e   ck ck      p
prior probability sequence quantization locations given
p c  k     exp  k
k   d ck     assume c            one check
    p 
   generalize
prior prefers simpler notations  e g   p 
prior subdivisions triplets quintiplets appendix a 
formally  given distribution c  k   prior score   k given






 

p    k    

x

c  k











 

p    k jc  k  p c  k  

   

since relationship c  k   k deterministic  p    k jc  k   degenerate
given c  k  

p    k     exp



k
k
x
x

 

d  k   
   
   k    
one might tempted specify prior directly   k get rid c  k entirely 
however  simpler approach easy devise realistic priors  example 
consider sequence note durations                        assuming factorized prior
penalizes short note durations  rhythm would relatively high probability
whereas quite uncommon conventional music 
k

    tempo prior
represent tempo terms inverse  i e   period  denote  
example tempo     beats per minute  bpm  corresponds                seconds 
onset tempo changes unknown amount k   assume change k
iid n     q      assume first order gauss markov process tempo
k   k     k
   
eq    defines distribution tempo sequences   k   given tempo sequence 
 ideal   intended  time k next onset given

k   k     k k     k

   

   denote  scalar multivariate  gaussian distribution p x  mean vector covariance
 
matrix p n    p   
  j p j   exp      x  t p    x    

  

ficemgil   kappen
noise term k denotes amount accentuation  that deliberately playing
note ahead back time  without causing tempo changed  assume k
n     q    ideal onsets actually observed  noisy  onsets related

yk   k   k

   

noise term k models small scale expressive deviations motor errors timing individual notes  paper assume k gaussian distribution parameterized
n     r  
initial tempo distribution p     specifies range reasonable tempi given
gaussian broad variance  assume uninformative   at  prior    
conditional independence structure given graphical model figure    table  
shows possible realization model 
note model particular instance well known switching state space
model  also known conditionally linear dynamical system  jump markov linear system 
switching kalman filter   see  e g   bar shalom   li        doucet   andrieu       
murphy        

k  
 
 
 
k
   
ck                  
k                        
k                       
yk                       


 





 

table    possible realization model  ritardando  clarity assume     
following sections  sometimes refer use zk    k   k  t refer z  k
tempo trajectory  given definition  compactly represent eq    eq   

zk  



  k
   



zk     k

   

k    k   k   

    extensions
several possible extensions basic parameterization  example  one could
represent period logarithmic scale  warping ensures positivity seems
perceptually plausible since promotes equal relative changes tempo rather
absolute scale  grubb        cemgil et al          although resulting model
becomes nonlinear  approximated fairly well extended kalman filter  barshalom   li        
simple random walk model tempo uctuations eq    seems
realistic  would expect tempo deviations structured smoother 

  

fimonte carlo methods tempo tracking rhythm quantization
dynamical system framework smooth deviations modeled increasing
dimensionality z include higher order  inertia  variables  cemgil et al         
example consider following model 

 
k
b
  k
b
b
  k
b
b
     

  k

 
 
  
  k k          
k  
c
b
c
b
                c b   k  
c
b
c
b
c
b
  k  
  b   
c
c
b
c
b
c
b
 
 
  

       
a 

 
   

  k  

 
c
c
c
  k
c
c


   

choose particular parameterization wish interpret   slowly
varying  average  tempo   temporary change tempo  model useful
situations performer uctuates around almost constant tempo  random
walk model sucient case forgets initial values  additional state
variables               act additional  memory  elements  choosing parameter
matrix noise covariance matrix q  one model rich range temporal structures
expressive timing deviations 
score prior improved using richer model  example allow
different time signatures alternative rhythmic subdivisions  one introduce additional
hidden variables  see cemgil et al         appendix a  use markov chain  raphael 
    a   potentially  extensions make easier capture additional structure musical
rhythm  such  weak  positions followed likely  strong  positions  
hand  number model parameters rapidly increases one
cautious order avoid overfitting 
score typesetting  need quantize note durations well  i e   associate note
offsets quantization locations  simple way accomplishing define
indicator sequence u  k identifies whether yk onset  uk      offset  uk  
    given uk   redefine observation model p yk jk   uk     uk n     r      
uk  n     roff   roff observation noise associated offsets  typical model
would roff r  roff      offsets would effect tempo process 
moreover  since uk always observed  extension requires simple lookup 
principle  one must allow arbitrary long intervals onsets  hence k
drawn infinite  but discrete  set  subsequent derivations  assume
number possible intervals fixed a priori  given estimate zk   observation yk  
almost virtually infinite number choices k almost zero probability
easy identify candidates would significant probability mass 
conceptually  listed extensions easy incorporate model
none introduces fundamental computational diculty basic problems
quantization tempo tracking 

  

ficemgil   kappen
    problem definition
given model  define rhythm transcription  i e   quantization map state estimation problem
   k   argmax p    k jy  k  
   
p    k jy  k    

z   k

dz  k p    k   z  k jy  k  

tempo tracking filtering problem
x
zk   argmax p    k   zk jy  k  
zk

  k

    

quantization problem smoothing problem  wish find likely score

  k given onsets performance  useful  oine  applications
score typesetting 
real time interaction  need online estimate tempo beat zk  
information carried forth filtering density p    k   zk jy  k   eq    
definition best tempo zk maximum somewhat arbitrary  depending upon
requirements application  p
one make use features filtering
density  example  variance   k p    k   zk jy  k   used estimate  amount
confidence  tempo interpretation arg maxzk     k p    k   zk jy  k   estimate
likely score tempo pair far 
unfortunately  quantities eq    eq     intractable due explosion
number mixture components required represent exact posterior step k
 see figure     example  calculate exact posterior eq    need evaluate
following expression 
z
 
dz  k p y  k jz  k     k  p z  k j   k  p    k  
    
p    k jy  k    

z
 
  p y  k j   k  p    k  
    
z
p
normalization constant given z   p y  k       k p y  k j   k  p    k   
trajectory   k   integral z  k computed stepwise k kalman
filter  see appendix b     however  find map state eq      need evaluate
p y  k j   k   independently exponentially many trajectories  consequently 
quantization problem eq    solved approximately 
accurate approximation  wish exploit inherent independence structure
exact posterior  unfortunately  since z c integrated over  k become coupled
general p    k jy  k   possess conditional independence structure  e g  
markov chain  would facilitate ecient calculation  consequently  resort
numerical approximation techniques 

   monte carlo simulation
consider high dimensional probability distribution
 
p x    p  x 
z

  

    

fimonte carlo methods tempo tracking rhythm quantization

   

   

   

   

   

   

      

 

 

      
       





      

   

   
      
      

   

   

   

   
   

   

 

   

 

   


 

   

 

   

 a 

   
   

 

   

 

 

   

   


 

   

 

   

 b 

   

   
      
   

      
       
      



 

   

       
       
     

   

      

   

   
   

figure   

 

   

 

   


 

   

 c 

example demonstrating explosion number components represent
exact posterior  ellipses denote conditional marginals p k    k jc  k   y  k     we show
period logarithmic scale  k   log  k    toy example  assume
score consists notes length   i e   k either       
 a  start unimodal posterior p        jc    y     e g   gaussian centered
                since assume score consist eight  quarter
notes  i e   k   f      g  predictive distribution p       jc     y   bimodal
modes centered                 respectively  shown dashed contour
line   next observation y  observed  shown dashed vertical line around
        predictive distribution updated yield p        jc      y       numbers
denote respective log posterior weight mixture component   b  predictive
distribution p       jc     y     step k       modes  two component
p      jc     y       c  number components grows exponentially k 




  

 

ficemgil   kappen
r
normalization constant z   dxp  x  known p  x  evaluated
particular x  suppose want estimate expectation function f  x 
distribution p x  denoted
z

hf  x ip x    dxf  x p x 
e g   mean x p x  given hxi  intractable integration approximated average find n points x i              n p x 

hf  x ip x  n 

n
x

  



f  x i   

    

x i  generated independently sampling p x   shown n
approaches infinity  approximation becomes exact 
however  generating independent samples p x  dicult task high dimensions usually easier generate dependent samples  generate x i   
making use x i    somewhat surprising  even x i  x i    correlated
 and provided ergodicity conditions satisfied   eq     remains still valid estimated
quantities converge true values number samples n goes infinity 
sequence dependent samples x i  generated using markov chain
stationary distribution p x   chain defined collection transition probabilities  i e   transition kernel  x i    jx i     definition kernel implicit 
sense one defines procedure generate x i    given x i    metropolis
algorithm  metropolis   ulam        metropolis  rosenbluth  rosenbluth  teller    teller 
      provides simple way defining ergodic kernel desired stationary
distribution p x   suppose sample x i    candidate x  generated sampling symmetric proposal distribution q x  jx i     for example gaussian centered
x i     candidate x  accepted next sample x i    p x      p x i     x 
lower probability  still accepted  probability p x    p x i    
algorithm initialized generating first sample x    according  arbitrary 
proposal distribution 
however given transition kernel   hard assess time required converge
stationary distribution practice one run simulation large
number samples obtained   see e g   roberts   rosenthal         choice
proposal distribution q critical  poor choice may lead rejection
many candidates x  hence resulting slow convergence stationary distribution 
large class probability models  full posterior p x  intractable  one
still eciently compute marginals form p xk jx k    x k   x        xk     xk           xk
exactly  case one apply specialized markov chain monte carlo  mcmc 
algorithm  gibbs sampler given below 
   initialize x   
  k sampling proposal q x  k  
             n

 

  

fimonte carlo methods tempo tracking rhythm quantization

k              k   sample

 i 
x ki    p xk jx   i   
    
k     xk   k  
contrast metropolis algorithm  new candidate vector x   
gibbs sampler uses exact marginal p xk jx k   proposal distribution 
step  sampler updates one coordinate current state x  namely xk  
new candidate guaranteed accepted 
note that  principle don t need sample xk sequentially  i e   choose k
randomly provided slice visited equally often limit  however  deterministic scan algorithm k            k   provides important time savings type
models consider here 
    simulated annealing iterative improvement
shift focus sampling map state estimation  principle  one use
samples generated sampling algorithm  metropolis hastings gibbs  estimate
map state x p x  argmax p x i     however  unless posterior much
i   n
concentrated around map state  sampler may visit x even though samples
x i  obtained stationary distribution  case  problem simply
reformulated sample p x  distribution concentrated local
maxima p x   one class distributions given pj  x    p x j   sequence
exponents           j         called cooling schedule annealing schedule
owing inverse temperature interpretation j statistical mechanics  hence
name simulated annealing  sa   aarts   van laarhoven         j     suciently
slowly j   cascade mcmc samplers stationary distribution pj  x 
guaranteed  in limit  converge global maximum p x   unfortunately 
convergence result hold  cooling schedule must go slowly  in fact  logarithmically 
infinity  practice  faster cooling schedules must employed 
iterative improvement  ii   aarts   van laarhoven        heuristic simulated annealing algorithm fast cooling schedule  fact  j     j   eventual
advantage greedy algorithm converges iterations local maximum  restarting many times different initial configurations x  one hopes find
different local maxima p x  eventually visit map state x   practice  using
ii heuristic one may find better solutions sa limited computation time 
implementation point view  trivial convert mcmc code sa  or ii 
code  example  consider gibbs sampler  implement sa  need construct
cascade gibbs samplers  stationary distribution p x j   exact one time
slice marginal distribution p xk jx k  j   so  sa samples actual
 temperature    marginal p xk jx k   raised power j  
    switching state space model map estimation
solve rhythm quantization problem  need calculate map state
posterior eq    
p    k jy  k  

z

  p    k   dz  k p y  k jz  k     k  p z  k j   k  
  

    

ficemgil   kappen
combinatorial optimization problem  seek maximum function p    k jy  k  
associates number discrete configurations   k   since feasible
visit exponentially many configurations find maximizing configuration
   k   resort stochastic search algorithms simulated annealing  sa 
iterative improvement  ii   due strong relationship gibbs sampler
sa  or ii   first review gibbs sampler switching state space model 
first important observation that  conditioned   k   model becomes linear
state space model integration z  k computed analytically using kalman
filtering equations  consequently  one sample   k integrate z  
analytical marginalization  called rao blackwellization  casella   robert         improves
eciency sampler  e g   see doucet  de freitas  murphy    russell      a  
suppose switch variable k distinct states wish
              n g  naive implementation
generate n samples  i e trajectories  f    ik
gibbs sampler requires step k run kalman filter times whole
observation sequence y  k compute proposal p  k j    ik      k i     k   y  k    would
result algorithm time complexity o nk     prohibitively slow k
large  carter kohn        proposed much time ecient deterministic scan
gibbs sampler circumvents need run kalman filtering equations
step k whole observation sequence y  k   see  doucet   andrieu        murphy 
      
method based observation proposal distribution p  k j  
factorized product terms either depend past observations y  k
future observations yk   k   contribution future computed a priori
backward filtering pass  subsequently  proposal computed samples k i 
generated forward pass  sampling distribution given

p  k j k   y  k     p  k j k  p y  k j   k  

    

first term proportional joint prior p  k j k     p  k   k    second
term decomposed

p y  k j   k    
 

z
z

dzk p yk   k jy  k   zk     k  p y  k   zk j   k  

    

dzk p yk   k jzk   k   k  p y  k   zk j   k  

    

terms  unnormalized  gaussian potentials hence integral evaluated
analytically  term p yk   k jzk   k   k   unnormalized gaussian potential zk
computed backwards filtering  second term filtering distribution
p zk jy  k     k   scaled likelihood p y  k j   k   computed forward
filtering  outline algorithm given below  see appendix b   details 
   initialize      k sampling proposal q    k  
             n

k   k              
  

fimonte carlo methods tempo tracking rhythm quantization



  compute p yk   k jzk   k i     k  
k              k  
           
compute proposal
p  k   sj     p  k   s  k  

z

dzk p y  k   zk j    ik      k   s p yk   k jzk   k i     k  

  sample k i  p  k j  
resulting algorithm time complexity o nks    important saving terms
time  however  space complexity increases o    o k   since expectations
computed backward pass need stored 
step  gibbs sampler generates sample single time slice k 
certain types  sticky  models  dependence k k  
strong  sampler may get stuck one configuration  moving rarely  due
fact singleton ips end low probability configurations due strong
dependence adjacent time slices  example  consider quantization model
two configurations        k   k                                                          updating
single slice  may dicult move two configurations  consider
intermediate configuration                        since duration   k   k     increases 
future quantization locations ck k shifted      may correspond score
heavily penalized prior  thus  blocking  path 
allow sampler move freely  i e   allow global jumps  one
sample l slices jointly  case proposal distribution takes form
p  k k l  j     p  k k l     k k l    
z
dzk l   p y  k l    zk l   j    ik      k k l   p yk l k jzk l     k i l   k  
similar one slice case  terms integral unnormalized gaussian potentials
 on zk l     representing contribution past future observations  since k k l  
l states  resulting time complexity generating n samples o nks l    thus
practice l must kept rather small  one remedy would use metropolis hastings
algorithm heuristic proposal distribution q  k k l  jy  k   circumvent exact calculation  obvious construct q 
one shortcoming gibbs sampler  and related mcmc methods 
algorithm standard form inherently oine  need access
observations y  k start simulation  certain applications  e g   automatic score
typesetting  batch algorithm might still feasible  however scenarios require
real time interaction  interactive music performance tempo tracking  online
methods must used 
    sequential monte carlo
sequential monte carlo  a k a  particle filtering  powerful alternative mcmc
generating samples target posterior distribution  smc especially suitable
application dynamical systems  observations arrive sequentially 

  

ficemgil   kappen
basic idea smc represent posterior p x  k   jy  k     time k  
 possibly weighted  set samples fx   i k               n g extend representation
f x   i k     x ki               n g observation yk becomes available time k 
common practice use importance sampling 
      importance sampling

consider high dimensional probability distribution p x    p  x  z unknown
normalization constant  suppose given proposal distribution q x  close
p x  high probability regions distributions fairly overlap 
p generate
independent samples  i e   particles  x i  proposal q x  ni    x
x i    n   approximate
  p  x 
q x 
    
p x   
z q x 
n

x
z  pq  xx   n   x x i   
    
i  
n
x
w i 

    
pn  j   x x i   
j    w
i  
w i    p  x i    q x i    importance weights  one interpret w i  correction factors compensate fact sampled  incorrect  distribution q x   given approximation eq    estimate expectations weighted
averages
n
x
hf  x ip x 
w   i  f  x i   

w   i    w i   

pn
j

  

    



   w

 j   normalized importance weights 

      sequential importance sampling

wish apply importance sampling dynamical model

p x  k jy  k  

 

k

k

  

p yk jxk  p xk jx  k    

    

x   fz  g  principle one naively apply standard importance sampling using
arbitrary proposal distribution q x  k    however finding good proposal distribution
hard k    key idea sequential importance sampling sequential
construction proposal distribution  possibly using available observations y  k   i e  

q x  k jy  k    

k

k

  

  

q xk jx  k     y  k  

fimonte carlo methods tempo tracking rhythm quantization
given sequentially constructed proposal distribution  one compute importance
weight recursively

p  x   i k jy  k   p yk jx ki   p x ki  jx   i k     y  k     p y  k   jx   i k    p x   i k    
 
    
q x   i k jy  k  
q x ki  jx   i k   y  k  
q x   i k   jy  k    
p yk jx ki   p x ki  jx   i k     y  k      i 
 
wk  
    
q x ki  jx   i k   y  k  

wk i   

sequential update schema potentially accurate naive importance sampling since step k  one generate particle fairly accurate proposal
distribution takes current observation yk account  natural choice
proposal distribution filtering distribution given

q xk jx   i k   y  k     p xk jx   i k     y  k  

    

case weight update rule eq     simplifies

wk i    p yk jx   i k    wk i   
fact  provided proposal distribution q constructed sequentially past sampled trajectories updated  filtering distribution optimal choice sense
minimizing variance importance weights w i   doucet  godsill    andrieu      b  
note eq     identical proposal distribution used gibbs sampling k   k
 eq      k   k   smc proposal take future observations account 
introduce discount factors wk compensate sampling wrong distribution 
      selection

unfortunately  sequential importance sampling may degenerate  fact 
shown variance wk i  increases k  practice  iterations
algorithm  one particle almost probability mass
computation time wasted updating particles negligible probability 
avoid undesired degeneracy problem  several heuristic approaches proposed
literature  basic idea duplicate discard particles according
normalized importance weights  selection procedure deterministic stochastic  deterministic selection usually greedy  one chooses n particles highest
importance weights  stochastic case  called resampling  particles drawn
probability proportional importance weight wk i    recall normalized weights
fw k i              n g interpreted discrete distribution particle labels  i  

    smc switching state space model
sis algorithm directly applied switching state space model sampling
directly xk    zk   k    however  particulate approximation quite poor z

  

ficemgil   kappen
   

   

   



 

   

   

   

   
   

 

   

 

   


 

   

 

   

figure    outline algorithm  ellipses correspond conditionals
p zk j k i    y  k    vertical dotted lines denote observations yk   step
k  particles low likelihood discarded  surviving particles linked
parents 

high dimensional  hence  many particles may needed accurately represent
posterior 
similar mcmc methods introduced previous section  eciency
improved analytically integrating z  k sampling   k   fact 
form rao blackwellization reported give superior results compared standard
particle filtering z sampled jointly  chen   liu        doucet et al  
    b   improvement perhaps surprising  since importance sampling performs
best sampled space low dimensional 
algorithm intuitive interpretation terms randomized breadth first tree
search procedure  new step k  expand n kernels obtain n new kernels 
consequently  avoid explosion number branches  select n n
branches proportional likelihood  see figure    derivation technical details
algorithm given appendix c 
tree search interpretation immediately suggests deterministic version algorithm one selects  without replacement  n branches highest weight 
refer method greedy filter  gf   method known split track
filter  chen   liu        closely related multiple hypothesis tracking  mht 
 bar shalom   fortmann         one problem greedy selection schema gf
loss particle diversity  even particles initialized different locations z   
 e g   different initial tempi   mainly due discrete nature state space k  
particles become identical steps k  consequently  results
improved increasing number particles n   nevertheless 
particles used  say e g   real time application  gf may still viable choice 

  

fimonte carlo methods tempo tracking rhythm quantization

 i  optimal 
figure    hypothetical situation neither two particles    
would obtain eventually higher likelihood configuration interchanging  
particles 
    smc estimation map trajectory
mcmc  smc sampling method  hence comments made section    
  jy  
eventual suboptimality estimating map trajectory particles arg max p     ik
  k
apply here  hypothetical situation shown figure   
one obvious solution employ sa  trick  raise proposal distribution
power p  k j    however  proposal peaked time
slice  consequently  particles become identical time algorithm
eventually degenerates greedy filtering 
algorithm estimating map trajectory set smc samples recently
proposed literature  godsill  doucet    west         algorithm relies
observation particles x ki  sampled forward pass  one left
n
discrete distribution defined  discrete  supportn
x  k   k
k   xk   xk denotes
support filtering distribution time k cartesian product

sets  formally  xk set distinct samples time k given xk   fx ki  g 
distribution p x  k jy  k    markovian original state transition model
markovian  i e   posterior represented exactly
p x  k jy  k    

k


p yk jxk  p xk jxk    
  
consequently  one find best map trajectory arg max p x  k   using algorithm
analogous viterbi algorithm hidden markov models  rabiner        
however  idea carry directly case one applies rao blackwellization  general  subset hidden variables
nisk integrated out sall time
slices posterior p    k jy  k   coupled    k   k   k k   f k i  g 
one still employ chain approximation run viterbi   e g   cemgil   kappen 
       guarantee find arg max p    k jy  k   
hand  k i  drawn discrete set  several particles become
identical k usually small cardinality compared number particles
n   consequently  becomes feasible employ sa ii reduced state space   k  
possibly using proposal distribution extends several time slices l 
k

   slight abuse notation use symbol xk set general element used
argument density  p yk jxk   means p yk jxk   s t  xk   xk

  

ficemgil   kappen
              n g 
practice  finding map solution particle set f    ik
   p   i    apply iterative
propose find best trajectory   arg maxi p y  k j    ik
  k

improvement starting initial configuration    ik   

   simulations
compared inference methods terms quality solution execution time  tests carried artificial real data 
given true notation   true
k   measure quality solution terms
log likelihood difference
l   log

p y  k j   k  p    k  
true
p y  k j   true
k  p    k  

terms edit distance

e    k    

k
x

     k

ktrue   

  
edit distance e    k   gives simply number notes quantized wrongly 
k

    artificial data  clave pattern
 c                 
synthetic example repeating  son clave  pattern
           uctuating tempo  repeat pattern   times obtain score   k
k      
syncopated rhythms usually hard transcribe make dicult track
tempo even experienced human listeners  moreover  since onsets absent
prominent beat locations  standard beat tracking algorithms usually loose track 
given score   k   generated     observation sequences y  k sampling
tempo model eq     parameterized observation noise variance 
q   k qa   qb   formulation  variance depends length interval
consecutive onsets  longer notes score allow tempo timing
uctuation  tests clave example used prior model ects
true source statistics  instead  used generic prior model defined section    
    
example cases sampled score  clave pattern   however  due
use generic prior  that capture exact source statistics well 
relatively broad noise model  map trajectory    k given y  k always identical
 i
original clave pattern  i th example  defined  ground truth    true
k
highest likelihood solution found using sampling technique independent
run  although definition ground truth introduces bias  found
exercise realistic well discriminative among various methods
compared to  e g    using dataset essentially shorter sequences exact map
 

 



 









 

   noise covariance parameters r           qa         qb               identity
matrix 

  

fimonte carlo methods tempo tracking rhythm quantization
trajectory computed exhaustive enumeration  wish stress main
aim simulations synthetic dataset compare effectiveness different inference
techniques  postpone actual test whether model good one simulations
real data 
tested mcmc methods  namely gibbs sampling  gibbs   simulated annealing  sa  iterative improvement  ii  one two time slice optimal proposal
      sweeps  onset yk   optimal proposal p  k j  computed
always fixed set    f                   g  figure   shows typical run mcmc 
similarly  implemented smc n   f                 g particles 
selection schema random drawing optimal proposal p  k j  computed using
one two time slices  special case greedy filtering  gf   i e   n     
selected switch maximum probability  example run shown figure   
observe average smc results superior mcmc  figure     observe
that  increasing number sweeps mcmc improve solution significantly 
hand  increasing number particles seems improve quality
smc solution monotonically  moreover  results suggest sampling two time
slices jointly  with exception sa   big effect  gf outperforms
particle filter   particles draws randomly proposal  suggests
pf small number particles n   may desirable use hybrid selection
schema selects particle maximum weight automatically randomly selects
remaining n   
compare inference methods terms execution time quality solutions  as
measured edit distance   figure   suggests  using two slice proposal justified 
moreover seems comparable computational effort  smc tends outperform
mcmc methods 

    real data  beatles
evaluate performance model polyphonic piano performances     pianists
invited play two beatles songs  michelle yesterday  pieces relatively
simple rhythmic structure ample opportunity add expressiveness uctuating
tempo  original score shown figure   a   subjects different musical education background  four professional jazz players  four professional classical performers
four amateur classical pianists  arrangement played three tempo
conditions  three repetitions per tempo condition  tempo conditions normal  slow
fast tempo  musically realistic range according judgment
performer  details reported  cemgil et al         
      preprocessing

original performances contained several errors  missing notes additional notes
original score  errors eliminated using matching technique  heijink  desain    honing        based dynamical programming  however  visual
inspection resulting dataset suggested still several matching errors interpret
outliers  remove outliers  extended quantization model two
state switching observation model  i e   discrete space consists   k   ik    simple

  

ficemgil   kappen

 

   

   

   



   

 

   

   

   

   

 

 

 

 

 

 


  

  

  

  

figure    particle filtering clave example   particles  circle denotes mean
 k n     k n     k n    log  k   diameter particle proportional
normalized importance weight generation      denote true
      pairs  modulated tempo deterministically according
 k       sin  ck       observation noise variance r           

  

fimonte carlo methods tempo tracking rhythm quantization

 

log likelihood

  

  
gibbs
sa
ii
gf
desired

  

  

figure   

 

  

  
  
gibbs sweep

  

  

typical runs gibbs sampling  simulated annealing  sa  iterative improvement
 ii  clave example  algorithms initialized greedy filter solution 
annealing schedule sa linear                 proceeding deterministically            sa ii converge configuration  reinitialize
particle filter one particle draws randomly proportional optimal
proposal  sharp drops likelihood correspond reinitializations  see that 
first sweep  greedy filter solution slightly improved ii  consequently sampler reinitializes  likelihood sa drops considerably  mainly due
high temperature  consequently stabilizes suboptimal solution  gibbs
sampler seems explore support posterior able visit map
state run 

  

ficemgil   kappen

log likelihood difference

 

 

  

  

  
  slice
  slice
  

sa

gibbs

ii

gf

pf

 a  likelihood difference
  

  slice
  slice

edit distance

  
  
  
  
 
 
sa

gibbs

ii

gf

pf

 b  edit distance  mcmc results    sweeps omitted 

figure   

comparison inference methods clave data  squares ovals denote
median vertical bars correspond interval         quantiles 
tested mcmc methods  gibbs  sa ii  independently      
 shown left right   smc methods greedy filter  gf  particle filter
 pf   tested filters n   f              g particles independently  shown
left right   

  

fimonte carlo methods tempo tracking rhythm quantization

sa 

sa 

median edit distance

  

  

pf  

pf  

pf   

  
gf 

ii  pf   

gf 

gi 

gi 
ii 

 

 

pf   

pf    

pf   
pf    

flops  log scale 

figure   

comparison execution time terms oating point operations  methods 
first number       denotes number slices used optimal proposal distribution 
particle filter  pf   second number denotes number particles 
dashed lines merely used connect related methods 

outlier detection mechanism  switch ik binary indicator variable specifying whether
onset yk outlier not  assume indicators independent a priori
uniform prior  observation model given p yk jik   k     n     rik      
since score   k known  unknown discrete quantities indicators i  k  
used greedy filtering followed iterative improvement find map state
indicators i  k eliminated outliers studies  many performances 
around     outliers  less    notes  resulting dataset
downloaded url http   www snn kun nl cemgil 
      parameter estimation

trained tempo tracking models different dimensionality d  denotes
dimension hidden variable z   models  use transition matrix
form eq    
since true score known  i e   quantization location ck onset yk given 
clamp discrete variables model  consequently  estimate
observation noise variance r  transition noise variance q transition matrix
coecients data 
optimized parameters expectation maximization  em  linear
dynamical systems  shumway   stoffer        ghahramani   hinton        using perfor   took rik            rik        

  

ficemgil   kappen
mances  yesterday  training data  similarly  score prior parameters estimated
frequency counts score  yesterday      tests carried  michelle  
      results

figure   show result typesetting performance without tempo
tracking  due uctuations tempo  quality automatically generated score
poor  quality significantly improved using model 
figure    shows tempo tracking examples michelle dataset pianists
different background training  observe cases results satisfactory 
figure     give summary test results michelle data terms loglikelihood edit distance function model order number particles used
inference  figure    a  shows median likelihood test data increasing
model order  suggests higher order filter able capture structure pianists  expressive timing  moreover  sythetic data  see somewhat monotonic
increase likelihood solutions found using particles 
edit distance original score estimates given figure    b  
since pieces arranged piano  due polyphony  many onsets
associated quantization location  consequently  many ktrue original
score effectively zero  cases  typically  corresponding inter onset interval
yk yk   small correct quantization  namely k      identified
even tempo estimate completely wrong  consequence  edit distance remains
small  make task slightly challenging  exclude onsets ktrue    
edit distance calculation 
observe extra prediction ability obtained using higher order model
directly translate better transcription  errors around    models 
hand  variance edit distance higher order models smaller 
suggests higher order models tend robust divergence
original tempo track 

   discussion
presented switching state space model joint rhythm quantization tempo
tracking  model describes rhythmic structure musical pieces prior distribution quantization locations  representation  easy construct generic
prior prefers simpler notations learn parameters data set  prior
quantization locations c  k translates non markovian distribution score   k  
timing deviations introduced performers  tempo uctuation  accentuations motor errors  modeled independent gaussian noise sources  performer specific timing
preferences captured parameters distributions 
given model  formulated rhythm quantization map state estimation
problem tempo tracking filtering problem  introduced markov chain
   maximum likelihood parameters model dimension     found be           r  
       q            q           q             prior p c  p            p               
p             p                remaining p c  set       

  

fimonte carlo methods tempo tracking rhythm quantization

michelle
lennon mccartney

bb  




  b b   n n ww n


w
  b b b   
w



w
b


 

piano







 

bb
  b b

  bb
bb



n


n


bb
  b b n


  bb

bb





 

  







n



n

n n   w n
  j



n
n n


n


n





 

n n


n

n

n






































































































  

 

  

  
 

bb
  b b   n 
 
  bb
bb
  

n n


bb
  b b

j
  bb
bb
n

  

bb
  b b n w
w
  bb
bb

 

j

    


b   

  





j
 
  






n









n



j
ww
w



 



n




j











  

  








  

  



n ww
w

n n

w



 a  original score






































 b  typesetting without
processing model 
due uctuations
tempo  quality
score poor 

figure   

























q      

 

  

  

 












 






 








































































  



  

 c  typesetting tempo
tracking quantization
particle filter 

results typesetting scores 

  























ficemgil   kappen

 

 
estimated
original

estimated
original

   

   
 

log

 

log

k

   

k

   

   

   

   

   

 

 

  

  

  



  

  

  

 
  

  

 

  

  

  

k



  

  

  

  

  

k

 a  professional jazz pianist

 b  amateur

 

 
estimated
original

estimated
original

   

   

   
   

 

log

 

log

k

   

k

   

   

 

   
   

   

   
   

 
  

 

  

  

  



  

  

  

  

  

k

 

  

  

  



  

  

  

  

k

 c  professional classical pianist 
filter temporarily loses track 

figure    

 

 d  tracking twice rate
original tempo 

examples filtered estimates
z  k    k   k  t beatles data set  circles
original
denote mean p zk j   k   y  k    x  denote mean p zk j    k   y  k   obtained
smc  interesting note different timing characteristics  example classical
pianist uses lot tempo uctuation professional jazz pianist  jazz pianist
slows dramatically end piece  amateur  rushes   i e   constantly
accelerates beginning  tracking quantization results  a   b 
satisfactory   a   filter loses track last two notes  pianist
dramatically slows down   c   filter loses track catches again   d  
filter jumps metrical level twice fast original performance 
would translate duplication note durations only 

  

fimonte carlo methods tempo tracking rhythm quantization

   

   

likelihood

   

   

   

   

   

   

 

 
model dimension

 

 a  likelihood  dashed horizontal line shows median
likelihood original score michelle model 
  

  

  

percent edit distance

  

  

  

  

  

  

 

 

 

 
model dimension

 

 b  edit distance

figure    

smc results test data      performances michelle   model show
results obtained n                particles      show median
best particle  x  denote median applying iterative improvement 
vertical bars correspond interval         quantiles 
  

ficemgil   kappen
monte carlo  mcmc  sequential monte carlo  smc  approximate respective
distributions 
quantization model propose similar  raphael      a   transcription  raphael proposes compute arg max p c  k   z  k jy  k   uses message propagation scheme essentially analogous rao blackwellized particle filtering  prevent
number kernels explosion  uses deterministic selection method  called
 thinning   advantage raphael s approach joint map trajectory
computed exactly  provided continuous hidden state z one dimensional
model parameter regime keeps number propagated gaussian kernels
limited  e g   r small  thinning eliminate many kernels  one disadvantage
number kernels varies depending upon features filtering distribution 
dicult implement scheme real time  perhaps importantly  simple extensions increasing dimensionality z introducing nonlinearities
transition model would render approach quickly invalid  contrast  monte carlo
methods provide generic inference technique allow great exibility models one
employ 
tested method challenging artificial problem  clave example   smc
outperformed mcmc terms quality solutions  measured terms
likelihood well edit distance  propose use smc problems 
finding map quantization  propose apply iterative improvement  ii  smc
solution reduced configuration space 
correct choice score prior important overall performance
system  music pieces tend certain rhythmical vocabulary  certain
rhythmical motives reoccur several times given piece  rhythmic structure depends
mostly upon musical genre composer  seems rather dicult devise
general prior model would work well large spectrum styles  nevertheless 
given genre  expect simple prior capture enough structure sucient good
transcription  example  beatles dataset  estimated prior counting
original score  yesterday   statistics fairly close  michelle  
good results test set partially accounted fact pieces
similar rhythmical structure 
conditioned score  tempo tracking model linear dynamical system 
optimized several tempo models using em varied dimension
tempo variables z   test results suggest increasing dimensionality z improves
likelihood  however  increase likelihood whole dataset translate
directly overall better quantization results  as measured edit distance   observe
models trained whole training data fail consistently subjects  especially
professional classical pianists  perhaps interestingly  train  custom  models specifically
optimized subjects  improve results significantly test cases 
observation suggests kind multimodality parameter space modes
correspond different performer regimes  seems kalman filter able capture
structure expressive timing deviations  however  averaged subjects 
details tend wiped out  suggested quantization results
vary significantly among models different dimensions 

  

fimonte carlo methods tempo tracking rhythm quantization
related problem edit distance measure  average  model 
likelihood desired score  e g   original score  michelle   may lower likelihood
solution found inference method  cases increasing likelihood may
even decrease edit distance  test cases even observe solutions higher
likelihood original notation notes wrong  cases 
tempo trajectory solution correspond half twice original tempo
consequently note durations halved doubled  e g   whole notes notated
half notes  half notes quarters e t c    considering fact model  self
initializing  tempo  assume broad uncertainty a priori  results still
satisfactory practical application perspective 
one potential shortcoming model takes timing information onsets
account  reality  believe pitch melodic grouping well articulation
 duration note onsets offsets  dynamics  louder softer  provide useful
additional information tempo tracking well quantization  moreover  current model
assumes onsets equally relevant estimation  probably general
true  example  kick drum provide information tempo
ute  hand  simulations suggest even limited model one
obtain quite satisfactory results  least simple piano music 
somewhat surprising  smc  basically method samples filtering
distribution outperforms mcmc method sa specifically designed
finding map solution given observations  intuitive explanation relatively
poorer mcmc results mcmc proceeds first proposing global solution
tries improve local adjustments  human transcriber  hand  would
listen shorter segments music gradually write score  respect 
sequential update schema smc seems natural rhythm transcription problem  similar results  smc outperforms mcmc already reported
literature  e g   so called  growth monte carlo  generating self avoiding random
walks  liu  chen    logvinenko         seems large class dynamical problems  including rhythm transcription  sequential updating preferable batch methods 
note theoretical convergence results sa require use logarithmic
cooling schedule  seems cooling schedule fast meet requirement 
one still careful interpreting poor performance negative sa result 
maintain using richer neighborhood structure configuration space  e g  
using block proposal distribution  slower cooling schedule  sa results
improved significantly  moreover  mcmc methods modified operate
sequentially  example see  marthi  pasula  russell    peres        
another family inference methods switching state space models rely deterministic approximate methods  family includes variational approximations  ghahramani  
hinton        expectation propagation  heskes         remains interesting open
question whether deterministic approximation methods provide advantage terms
computation time accuracy  particular quantization problem
switching state space models  potential application deterministic approximation
techniques mcmc schema designing proposal distributions extend
several time slices  schema would circumvent burden computing optimal
proposal distribution exhaustively hence allowing global moves sampler 

  

ficemgil   kappen
current results suggest superiority smc problem  perhaps
important advantage smc essentially  anytime  algorithm 
faster computer increase number particles make use additional
computational power  computing time becomes short one decrease number
samples  features make smc attractive real time applications one
easily tune quality computation time tradeoff 
motivated practical advantages smc positive simulation results 
implemented prototype smc method real time  current computer system
 a     mhz p  laptop pc running ms windows  allows us use   particles
almost delay even busy passages  expect significantly improve eciency
translating matlab c constructs native c code  hence  method used
tempo tracker automatic interactive performance system quantizer
automatic score typesetting program 

acknowledgments
research supported technology foundation stw  applied science division
nwo technology programme dutch ministry economic affairs 
would thank associate editor daphne koller anonymous reviewers
comments helped us significantly improve article  would
thank ric ashley  peter desain  henkjan honing paul trilsbeek suggestions
contributions data collection  moreover gratefully acknowledge pianists
northwestern university nijmegen university excellent performances 

appendix a  generic prior model quantization locations c
traditional western music notation  note durations generated recursive subdivisions
starting whole note  hence convenient generate quantization locations
similar fashion regular subdivisions  decompose quantization location
integer part fraction  c   bcc    c mod     defining prior  use
fraction 
set fractions generated recursively subdividing unit interval
        let    si   denote subdivision schema   si    finite  sequence
arbitrary integers  usually small primes         choice particular
depends mainly assumed time signature  generate set fractions c
follows  first iteration  divide unit interval s  intervals equal length
append endpoints c  resulting intervals set c   following iteration i 
subdivide intervals generated previous iteration si equal parts append
resulting endpoints c   note thisqprocedure generates regular grid two
neighboring grid points distance    si   denote iteration number
endpoint c  first inserted c depth c   with respect    number
denoted d c  js    easy see definition coincides number
significant bits represent c mod                    
illustirative example consider subdivision           first iteration 
unit interval divided s      equal intervals  resulting endpoints        

  

fimonte carlo methods tempo tracking rhythm quantization
    inserted c depths d      d        d           second iteration 
new endpoints              inserted c assigned depth   
given   define distribution quantization locations

p ck js     exp  d ck mod  js   
wish consider several time signatures  i e   different subdivision schemata 
interpret hidden indicator variable define
p prior p s    case  prior
becomes multinomial mixture given p ck     p ck js  p s    details
empirical results justifying choice see  cemgil et al         

appendix b  derivation two pass kalman filtering equations
consider gaussian potential mean covariance defined domain
indexed x 
 
 
    
 x    z n        z j j   exp   x  t    x   
 
r
dx x    z      z     potential normalized  exponent eq    
quadratic form potential written
 
x kx 
    
 x    exp g   ht x
 

 
k    
k   
h   
g   log z   log j j
h k h
 
   
denote potential canonical form use notation

 x    z n       h  k  g 
refer g  h k canonical parameters  consider gaussian
potential  x    x   t   canonical representation

 x    x     



h 
h 


 

k   k  
k   k  


 g

models several variables interacting  one find desired quantities applying
three basic operations defined gaussian potentials  multiplication  conditioning  marginalization  multiplication two gaussian potentials index
set x follows directly eq     given
   x     x  b  x 
 h    k     g       ha   ka   ga    hb   kb   gb      ha   hb   ka   kb   ga   gb  
domain b overlaps subset  potentials extended
appropriate domain appending zeros corresponding dimensions 

  

ficemgil   kappen
marginalization operation given

 x     

z

k   k    h    k  

 x    x       h 

x 

k   k    k     g   

g    g    log jk      j      h   k       h  g initial constant term  x    x    
conditioning operation given
 x    x    x        h  k   x     k     g   

  x t k   x    
   

g    g   ht  x  

b   kalman filter recursions
suppose given following linear model subject noise
zk   azk     k
yk   czk   k
c constant matrices  k n     q  k n     r 
model encodes joint distribution
k


p yk jzk  p zk jzk    
  
p z  jz      p z   

p z  k   y  k    

k

    
    

 
   
p z       p     p     log j p j
p  
 
t   

tr  
 
 
c
r
c
c
p y  jz     
 
  log j rj
 
r  c
r  
 
 
   
p y    y   jz           c r   y     c r   c  log j rj
y  r y    
 
   

 

tq  
 
 

q


p z  jz     
  log j qj
   
q  a
q  
 
   
b     forward message passing

suppose wish compute likelihood

p y  k    

z

zk

p yk jzk        

z

z 

p z  jz   p y  jz   

z
z 

p z  jz   p y  jz   p z   

  compute integral starting z  proceeding zk   define forward
 messages 
r
r
   let z dz

  

fimonte carlo methods tempo tracking rhythm quantization

ff j    p z   
k   k
  ffkjk   p yk   y k jzk  ffkjk  
r
  ffk  jk   zk p zk   jzk  ffkjk
forward recursion given
ff j     p     p       log j p j
k       k

  p    
 

  ffkjk    hkjk   kkjk   gkjk  
hkjk   c r   y k   hkjk  
kkjk   c r   c   kkjk  
gkjk   gkjk      log j rj    y  t r   y k
  ffk  jk    hk  jk   kk  jk   gk  jk  
mk    at q     kkjk    
hk  jk   q   amk hkjk
kk  jk   q   q   amk q  
gk  jk   gkjk    log j qj      log j mk j      htkjk mk hkjk
b     backward message passing

compute likelihood starting yk  

p y  k    

z

z 

p z   p y  jz   

z

z 

p z  jz   p y  jz         

z
zk

case backward propagation summarized

fik jk       
k   k     
  fikjk   p yk   y k jzk  fikjk  
r
  fik  jk   zk p zk jzk    fikjk
recursion given

 hk jk     kk jk     gk jk                
k   k     
  fikjk    hkjk   kkjk   gkjk  
hkjk   c r   y k   hkjk  
kkjk   c r   c   kkjk  

  

p zk jzk    p yk jzk  

ficemgil   kappen
gkjk      log j rj    y kt r   y k   gkjk  
  fik  jk    hk  jk   kk  jk   gk  jk  
mk    q     kkjk    
hk  jk   q   mk hkjk
kk  jk   q    q mk  q  
gk  jk   gkjk    log j qj      log j mk j      h tkjk mk hkjk
b   kalman smoothing
suppose wish find distribution particular zk given observations y  k  
combine forward backward messages
p zk jy  k  

  p yk   k   zk   y  k  

  p y  k   zk  p yk   k jzk  
  ffkjk fikjk  
   hkjk   hkjk     kkjk   kkjk    gkjk   gkjk   

appendix c  rao blackwellized smc switching state space
model
let           n index particles           index states  
denote  unnormalized  filtering distribution time k  
 ki       p y  k    zk   j    ik     
since y  k   observed   ki    gaussian potential zk   parameters zk i   
n
  i     i     note normalization constant zk i    data likelihood p y  k  j    ik       
r k   i  k  
dzk k     similarly  denote filtered distribution next slice conditioned
k  

 ksji   
 

z

dzk   p yk jzk  p zk jzk     k   s  ki   
    
  p y  k   zk j    ik      k   s 
denote normalization constant  ksji  zk sji   hence joint proposal
 i  given
qk sji   

z

dzk  ksji  p  k   s     ik     
  p  k   s     ik      y  k  

outline algorithm given below 
initialize            n     i  p y   x  

  

fimonte carlo methods tempo tracking rhythm quantization

k           k
            n            
compute  ksji   ki    using eq    
qk sji  zk sji  p  k   s     ik     
            n
select tuple  sjj   qk
   ik       jk      k   s 
 ki   ksjj  
p  sjj 
wk i 
qk
note procedure  built in  resampling schema eliminating particles
small importance weight  sampling jointly  sji  equivalent sampling single
resampling according weights wk i    one check that 
since using optimal proposal distribution eq     weight step
given wk i    p     ik      y  k   

references

aarts  e  h  l     van laarhoven  p  j  m          statistical cooling  general approach
combinatorial optimization problems  philips journal research                  
agon  c   assayag  g   fineberg  j     rueda  c          kant  critique pure quantification 
proceedings international computer music conference  pp        aarhus  denmark 
international computer music association 
andrieu  c   de freitas  n   doucet  a     jordan  m  i          introduction mcmc
machine learning  machine learning  appear 
bar shalom  y     fortmann  t  e          tracking data association  academic press 
bar shalom  y     li  x  r          estimation tracking  principles  techniques software 
artech house  boston 
cambouropoulos  e          midi traditional musical notation  proceedings aaai
workshop artificial intelligence music  towards formal models composition  performance analysis  austin  texas 
carter  c  k     kohn  r          markov chain monte carlo conditionally gaussian state space
models  biometrika                  
casella  g     robert  c  p          rao blackwellisation sampling schemas  biometrika     
      
cemgil  a  t   desain  p     kappen  h  j          rhythm quantization transcription  computer
music journal              
cemgil  a  t     kappen  h  j          rhythm quantization tempo tracking sequential
monte carlo  dietterich  t  g   becker  s     ghahramani  z   eds    advances neural
information processing systems     mit press 
cemgil  a  t   kappen  h  j   desain  p     honing  h          tempo tracking  tempogram
representation kalman filtering  journal new music research                
chen  r     liu  j  s          mixture kalman filters  j  r  statist  soc      
  

ficemgil   kappen
dannenberg  r          on line algorithm real time accompaniment  proceedings icmc 
pp           san francisco 
desain  p     honing  h          quantization musical time  connectionist approach  todd 
p  m     loy  d  g   eds    music connectionism   pp           mit press   cambridge 
mass 
desain  p     honing  h          brief introduction beat induction  proceedings icmc 
san francisco 
dixon  s     cambouropoulos  e          beat tracking musical knowledge  horn  w   ed   
proceedings ecai         th european conference artificial intelligence   amsterdam 
doucet  a     andrieu  c          iterative algorithms state estimation jump markov linear
systems  ieee trans  signal processing                    
doucet  a   de freitas  n     gordon  n  j   eds            sequential monte carlo methods
practice  springer verlag  new york 
doucet  a   de freitas  n   murphy  k     russell  s       a   rao blackwellised particle filtering
dynamic bayesian networks  uncertainty artificial intelligence 
doucet  a   godsill  s     andrieu  c       b   sequential monte carlo sampling methods
bayesian filtering  statistics computing                  
fox  d   burgard  w     thrun  s          markov localization mobile robots dynamic
environments  journal artificial intelligence research  jair      
ghahramani  z     hinton  g          variational learning switching state space models  neural
computation                  
ghahramani  z     hinton  g  e          parameter estimation linear dynamical systems   crgtr        tech  rep   university totronto  dept  computer science 
godsill  s   doucet  a     west  m          maximum posteriori sequence estimation using monte
carlo particle filters  annals institute statistical mathematics                
gordon  n  j   salmond  d  j     smith  a  f  m          novel approach nonlinear nongaussian bayesian state estimation  iee proceedings part f  radar signal processing 
vol          pp          
goto  m     muraoka  y          music understanding beat level  real time beat tracking
audio signals  rosenthal  d  f     okuno  h  g   eds    computational auditory scene
analysis 
grubb  l          probabilistic method tracking vocalist  ph d  thesis  school computer
science  carnegie mellon university  pittsburgh  pa 
hamanaka  m   goto  m   asoh  h     otsu  n          learning based quantization  estimation
onset times musical score  proceedings  th world multi conference systemics 
cybernetics informatics  sci        vol  x  pp          
heijink  h   desain  p     honing  h          make match  evaluation different approaches
score performance matching  computer music journal               
heskes  t  zoeter  o          expectation propagation approximate inference dynamic
bayesian networks  proceedings uai 
isard  m     blake  a          contour tracking stochastic propagation conditional density 
eccv      pp          
large  e  w     jones  m  r          dynamics attending  track time varying events 
psychological review               
liu  j  s   chen  r     logvinenko  t          theoretical framework sequential importance
sampling resaampling  doucet  a   de freitas  n     gordon  n  j   eds    sequential
monte carlo methods practice  pp           springer verlag 
  

fimonte carlo methods tempo tracking rhythm quantization
longuet higgins  h  c          mental processes  studies cognitive science  mit press  cambridge     p 
marthi  b   pasula  h   russell  s     peres  y          decayed mcmc filtering  proceedings
uai 
metropolis  n   rosenbluth  a   rosenbluth  m   teller  a     teller  e          equations state
calculations fast computing machines  journal chemical physics                
metropolis  n     ulam  s          monte carlo method  journal american statistical
assoc                    
murphy  k  p          dynamic bayesian networks  representation  inference learning  ph d 
thesis  university california  berkeley 
pressing  j     lawrence  p          transcribe  comprehensive autotranscription program  
proceedings international computer music conference  pp           tokyo  computer
music association 
rabiner  l  r          tutorial hidden markov models selected applications speech
recognation  proc  ieee                  
raphael  c       a   mixed graphical model rhythmic parsing  proc    th conf 
uncertainty artif  int  morgan kaufmann 
raphael  c       b   probabilistic expert system automatic musical accompaniment  journal
computational graphical statistics                  
roberts  g  o     rosenthal  j  s          markov chain monte carlo  practical implications
theoretical results  canadian journal statistics           
scheirer  e  d          tempo beat analysis acoustic musical signals  journal acoustical
society america                 
shumway  r  h     stoffer  d  s          approach time series smoothing forecasting
using em algorithm  j  time series analysis                 
tanizaki  h          nonlinear non gaussian state space modeling monte carlo techniques 
survey comparative study  rao  c     shanbhag  d   eds    handbook statistics 
vol     stochastic processes  modeling simulation  north holland 
thom  b          unsupervised learning interactive jazz blues improvisation  proceedings
aaai      aaai press 
toiviainen  p          interactive midi accompanist  computer music journal              
vercoe  b     puckette  m          synthetic rehearsal  training synthetic performer 
proceedings icmc  pp           san francisco  international computer music association 
vercoe  b  l   gardner  w  g     scheirer  e  d          structured audio  creation  transmission 
rendering parametric sound representations  proc  ieee                

  


