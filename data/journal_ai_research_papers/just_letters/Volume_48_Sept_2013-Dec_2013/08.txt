journal of articial intelligence research                  

submitted        published      

the complexity of optimal monotonic planning 
the bad  the good  and the causal graph
carmel domshlak
anton nazarenko

dcarmel ie technion ac il
anton nazarenko gmail com

faculty of industrial engineering   management 
technion   israel institute of technology 
haifa  israel

abstract
for almost two decades  monotonic  or delete free  relaxation has been one of the
key auxiliary tools in the practice of domain independent deterministic planning  in the
particular contexts of both satiscing and optimal planning  it underlies most state of theart heuristic functions  while satiscing planning for monotonic tasks is polynomial time 
optimal planning for monotonic tasks is np equivalent  here we establish both negative and
positive results on the complexity of some wide fragments of optimal monotonic planning 
with the fragments being dened around the causal graph topology  our results shed some
light on the link between the complexity of general optimal planning and the complexity
of optimal planning for the respective monotonic relaxations 

   introduction
in domain independent deterministic  or classical  planning  the world states are represented by complete assignments to a set of variables  the operators allow for deterministic
modications of these assignments  and the objective is to nd a sequence of operators that
sequentially modies a given initial assignment to an assignment that satises a certain
predened goal property  in the last two decades  solvers for this problem have made spectacular advances in their empirical eciency  and this especially in the context of state space
heuristic search planning techniques  this eciency has been made possible largely by the
ability to exploit monotonic  or delete free  relaxations of the planning tasks  mcdermott 
      bonet   gener        homann   nebel        
at a high level  monotonic relaxation replaces the regular value switching semantics of
planning operators with the value accumulating semantics  that is  if an operator switches
the value of a variable v from x to y  then the relaxed version of that operator extends
the value of v from  x  to  x  y   the key point here is that applying operators under value
accumulating semantics does not reduce the applicability of operators in the future  two
properties of monotonic relaxation make it especially valuable to automated planning  first 
while deterministic planning is pspace complete even for rather conservative propositional
formalisms  planning for monotonic tasks is polynomial time  bylander         and thus can
be exploited for deriving heuristic estimates  second  in numerous problems of practical
interest  plans for monotonic relaxations are not that distant from the true plans for these
problems  homann        helmert   mattmuller        helmert   domshlak        bonet
  helmert         hence  starting from the seminal hsp  bonet   gener        and
ff  homann   nebel        planning systems  exploiting  and in particular  explicitly
c
    
ai access foundation  all rights reserved 

fidomshlak   nazarenko

planning for  monotonic relaxations became an important ingredient of most systems for
domain independent deterministic planning   for a comprehensive survey  see  e g   betz  
helmert        
ideally  a planner reasoning about the cost of the plans for monotonic relaxations should
reason about the cost of optimal plans for monotonic relaxations  unfortunately  while
regular planning for monotonic tasks is polynomial time  optimal planning for these tasks
is np equivalent  bylander         and constant factor approximations for this problem are
provably hard as well  betz   helmert         still  admissible heuristic estimates can in
principle exploit tractable fragments of optimal planning for monotonic relaxations  katz
  domshlak         however  to the best of our knowledge  no substantial fragments of
tractability have been revealed for monotonic optimal planning to date 
identifying signicant fragments of tractability for optimal monotonic planning is precisely our focus here  our special interest is in establishing connections between the complexity of optimal planning and that of optimal planning for the monotonic relaxations of
the respective planning tasks  this interest is motivated by the new and important role
of methods that combine tractable fragments of regular deterministic planning with monotonic relaxation heuristics  helmert        keyder   gener      a  katz   domshlak 
      katz  homann    domshlak      a      b  katz   homann         in turn  this
comparative perspective has brought us to consider planning tasks in terms of nite domain
representations that go beyond the standard propositional representation formalisms such
as strips  fikes   nilsson        and adl  pednault         some explanation  and
possibly even justication  for this choice of analysis are in place here 
due to their close relationship to rst order and propositional logics  propositional representations have dominated the area of automated planning since the early days of ai research  for instance  the propositional pddl language is still a de facto standard problem
description language in the planning community  fox   long         however  propositional languages blur a lot of important structure that is present in typical planning tasks of
interest  as we discuss later on  nite domain representations  fdr  that go beyond propositional state variables  backstrom   klein        backstrom   nebel        helmert 
      allowed for much deeper and much more discriminative analysis of automated planning complexity  in turn  some of these formal developments have already been translated
into practical advances in planning  allowing for the introduction of eective enhancements
of monotonic relaxation heuristics  fox   long        helmert        helmert   gener 
      keyder   gener      a  cai  homann    helmert        katz et al       a 
    b   abstraction heuristics  edelkamp        helmert  haslum    homann        katz
  domshlak         decomposition based planning  nissim  brafman    domshlak       
nissim   brafman         search topology analysis  homann         and many others 
nonetheless  under the value accumulating semantics of monotonic relaxation  fdr no
longer maintains its key advantage over propositional representations  because there no
longer seems to be any reason to prefer explicit representation of certain mutual exclusion
relationships between the propositions  therefore  in principle  the results presented in
what follows can be phrased  and sometimes even extended  in the context of propositional
representations such as strips  why  then  have we chosen to view the complexity of
optimal relaxed planning through the lens of fdr  the primary reason is our interest in
comparative complexity analysis of optimal planning and optimal planning for the respective
   

fithe complexity of optimal monotonic planning

monotonic relaxations  departing from previously discovered fragments of tractability for
both satiscing and optimal planning  we approach the following two high level questions 
   for what fragments of deterministic planning  if any  is optimal planning hard but
optimal  monotonically  relaxed planning easy 
   for what fragments of deterministic planning  if any  is optimal planning easy yet
optimal  monotonically  relaxed planning hard 
for regular planning  the best classication we have these days for its worst case time
complexity exploits the properties of some graphical structures induced by the planning
tasks  together with various properties of the fdr state variables such as the size of their
domains  hence  discussing optimal relaxed planning for fdr tasks keeps us in direct
relation to that well explored complexity map of regular deterministic planning  moreover 
we show that some known links between the planning complexity and graph topological
properties of the fdr tasks are even stronger in the case of optimal relaxed planning 
the second reason for our choice is that recent work has already revealed interesting
interplays between  either complete or partial  monotonic relaxation of nite domain variables and graphical structures induced by the fdr tasks  the respective results are in the
context of computational complexity of non optimal planning  katz et al       b   heuristic estimates  keyder   gener      b  katz et al       a  katz   homann         and
search topology analysis  homann         for instance  homann        showed that  if
the causal graph of the fdr task is acyclic  and every variable transition is invertible  then
the h  heuristic induced by optimal relaxed plans from the evaluated states has no local
minima  this result in particular testies that examining monotonic relaxations through
the lens of fdr can lead to some crisp and concisely formulated results  the same can
be found in our work here  while we show how some of our results can be easily reformulated  and sometimes even generalized  in terms of strips  some of our other results do
not conform so easily to strips reformulation 
finally  while the immediate value of our results in this work is mostly theoretical  we
would like to see them as a step towards exploiting optimal relaxed planning to devise
heuristic functions for deterministic planning  some of our results  such as theorem    can
in fact be directly used within the framework of implicit abstractions  katz   domshlak 
       while some other results can possibly be exploited within various frameworks of
partial monotonic relaxation such as  e g   the recent red black planning framework of katz
et al       b      a   to what extent this will actually happen remains  of course  to
be seen  however  the very focus of both implicit abstractions and red black planning on
nite domain task representations should make it much easier to assess the relevance of our
results to these frameworks 

   formalism  background  and related results
we use the notation  n  to refer to the set             n   in directed graphs  the edge from x
to y is denoted by  x  y   and in undirected graphs  the edge between x and y is denoted by
 x  y   by   x   we refer to the representation size of object x  not to be confused with  x  
which denotes the number of elements in set x 
   

fidomshlak   nazarenko

    fdr  mfdr  and monotonic relaxation
here we adopt the terminology and notation of katz et al       b   a planning task
in nite domain representation  fdr  is given by a quintuple    v  a  i  g  cost 
where 
 v is a set of state variables  with each v  v being associated with a nite domain
d v   a partial variable assignment p is a function on a variable subset v p   v that
assigns each v  v p  a value p v   d v  of its domain  a partial variable assignment
s is called a state if v s    v  
 i is an initial state  the goal g is a partial variable assignment to v  
 a is a nite set of actions  each action a is a pair pre a   e a  of partial variable
assignments to v called precondition and eect  respectively 
 cost   a  r   is a real valued  nonnegative action cost function 
auxiliary notation 
 for a partial assignment p and a variable subset v   v p   by p v    we denote the
assignment provided by p to v    for ease of presentation  we sometimes also specify
partial assignments as sets of constructs v  d  in which v  v and d  d v  
 for a variable v  v   by av  a we denote the actions aecting the value of v  that
is  av    a   v  v e a     for a sequence of actions  and a state variable v  v  
by v we denote the restriction of  to the actions in av  
the semantics of fdr tasks is as follows  an action a is applicable in a state s i
s v    pre a  v  for all v  v pre a    applying a in state s changes the value of every v 
v e a   to e a  v   the resulting state is denoted by sjak  by sja            ak k we denote the
state obtained from sequential application of the  respectively applicable  actions a            ak
starting at state s  such an action sequence is an s plan if sja            ak k v g     g 
and it is an optimal s plan if the sum of its action costs is minimal among all s plans  the
computational task of  optimal  planning is nding an  optimal  i plan  in what follows 
 optimal  i plans are often referred simply as  optimal  plans for  
a monotonic nite domain representation  mfdr  planning task is given by a
quintuple    v  a  i  g  cost exactly as for fdr tasks  but the semantics is dierent  
informally  in mfdr tasks the state variables accumulate their values  rather than switching
between them  more specically  an mfdr state s is a function that assigns each v  v a
non empty subset s v   d v  of its domain  an mfdr action a is applicable in state s i
pre a  v   s v  for all v  v pre a    applying an mfdr action a in state s changes the
value of v  v e a   from s v  to s v    e a  v    respectively  an mfdr action sequence
a            ak  applicable in state s is an s plan if g v   sja            ak k v  for all v  v g  
in all other respects  mfdr and fdr semantics are identical 
   it is not entirely clear to whom the original formulation of monotonic relaxation for multi valued variable
domains should be attributed  but it can be traced back at least to the work of helmert        on the
fast downward planning system 

   

fithe complexity of optimal monotonic planning

while fdr planning is pspace complete even for propositional state variables  planning for mfdr tasks is polynomial time  bylander         starting with the hsp  bonet
  gener        and ff  homann   nebel        planning systems  exploiting this attractive property of mfdr for deriving heuristic estimates via the notion of monotonic
relaxation became a key ingredient of many planning systems  given an fdr planning task
   v  a  i  g  the monotonic relaxation of  is the mfdr task       for any
state s of   the optimal relaxation heuristic h   s  is dened to be the cost of the optimal
plan for the mfdr task v  a  s  g  and by  optimal  relaxed planning for  we refer
to  optimal  planning for     if   is a plan for     then   is referred to as a relaxed
plan for  
finally  for both fdr and mfdr  we sometimes distinguish between planning tasks in
terms of a pair of standard graphical structures induced by the description of these tasks 
 the causal graph cg of  is a digraph over nodes v   an arc  v  v    is in cg i v  
v  and there exists an action a  a such that  v  v     v e a  v pre a  v e a   
in this case  we say that  v  v    is induced by a  by succ v  and pred v  we respectively
denote the sets of immediate successors and predecessors of v in cg  
 the domain transition graph dtg v    of a variable v  v is an arc labeled
digraph over the nodes d v  such that an arc  d  d   labeled with pre a  v    v  
and cost a  belongs to the graph i both e a  v    d   and either pre a  v    d or
v  v pre a   
    causal graph treewidth and planning complexity
introduced by halin         tree width went unnoticed until it was independently rediscovered by robertson and seymour        and arnborg  cornell  and proskurowski         it
has since received widespread attention due to its numerous graph theoretic and algorithmic
applications  informally  the tree width of a graph is a measure of how close the structure
of the graph is to a tree  for example  the tree width of a tree is    regardless of its size 
whereas the tree width of a complete graph over n nodes is n     formally  the tree width
of a graph is dened via the notion of tree decomposition as follows 
a tree decomposition of a connected undirected graph g    v  e  is a pair t    where
t    v t   e t   is a tree  i e   a connected acyclic graph  and    v t    v such that 
   for every v  v   the set  t  v t   v   t   in t is non empty and connected 
   for every  v  u   e there is a t  v t such that  v  u    t  
the width of a tree decomposition t   of g is max   t     t  v t       and the treewidth of g  tw g   is the minimum width over all tree decompositions of g  following
what appears to be standard terminology  by tree width of a digraph g we refer to the
tree width of the undirected graph induced by g  berwanger  dawar  hunter  kreutzer   
obdzralek        
with the development of parametrized complexity analysis  downey   fellows       
flum   grohe         it has been shown that many np hard problems can be solved in
polynomial time when restricted to induce certain problem specic graphical structures
of a xed tree width  in particular  constraint satisfaction and constraint optimization
   

fidomshlak   nazarenko

problems over nite domain variables can be solved in time polynomial in the size of the
explicit description of these problems  and exponential only in the tree width of the induced
constraint graph  dechter         since the causal graph captures a high level structure
of the planning problems  one would expect its tree width to play a similar role in the
worst case time complexity of both satiscing and optimal fdr planning  unfortunately 
the results in this direction have mostly been negative 
 under a standard assumption on parametric complexity hierarchy that w     nu fpt
 flum   grohe         chen and gimenez        proved that  for any family of
digraphs c  fdr planning for tasks inducing causal graphs in c is polynomial time if
and only if the size of connected components in c is bounded by a constant  as the
family of all digraphs with tree width of   trivially fails to satisfy the latter condition 
the immediate corollary of this result is that even satiscing fdr planning restricted
to causal graphs with the tree width of   is not polynomial 
 while the construction in the proof of chen and gimenez        uses fdr tasks
with variable domains of parametric size  the work of gimenez and jonsson      b 
shows that the negative result for causal graphs with the tree width of   holds even if
restricted to such planning tasks with xed variable domains  specically  gimenez
and jonsson show that fdr planning over chain causal graphs is np hard even if
restricted to variables with domains of size   
these negative results on the role of the causal graphs tree width in computational
tractability of fdr planning are strong  but apparently tell only part of the story  as
shown by brafman and domshlak               the causal graphs tree width does play
a role in the worst case time complexity of fdr planning  but in a tight interplay with
another parameter called the tasks local depth  informally  local depth of an fdr task 
captures a minmax amount of work required on a single variable in order to solve   since
later we refer to this result of brafman and domshlak  a precise specication of local depth
is warranted here  denoting by p lans   the  possibly innite  set of all plans for an fdr
task   the local depth of  is
  

min

max   v    

p lans   vv

that is   is the maximal number of value changes of a single state variable  along a plan that
minimizes that quantity among the plans for   by theorem   of brafman and domshlak
        fdr tasks  can be solved in time polynomial in      and exponential only in
o tw cg        up to some possible stratications based on succinct representation of
internal variable domain dynamics  such as those suggested by fabre  jezequel  haslum 
and thiebaux         this appears to be the strongest link discovered so far between the
complexity of general fdr planning and the graph topological properties of the causal
graphs  note also that this positive result applies only to satiscing planning  it is applicable
to optimal planning only in very limited settings  fabre et al         brafman   domshlak 
      
   

fithe complexity of optimal monotonic planning

   negative results  the bottleneck of variable domains
our focus here is on connections between the worst case time complexity of optimal relaxed
planning and the structure of the problems causal graphs  note that the causal graphs
of fdr tasks are trivially invariant under monotonic relaxation  since       we have
cg    cg   as we just mentioned  previous works have already revealed certain connections between the structure of the causal graphs  and in particular its tree width  and
the complexity of fdr planning  in what follows  we show that this link is even stronger
and somewhat more intriguing in the case of optimal relaxed planning  having said that 
we begin with a set of negative results which  at least at rst glance  suggest that no such
link is actually likely 
denition   a connected digraph g    n  e  is a fork if it contains exactly one node
r  n with non zero out degree  that is  e     r  n    n  n    r    similarly  g is
an inverted fork if it contains exactly one node r  n with non zero in degree  that is 
e     n  r    n  n    r    the respective special nodes r in fork and inverted fork graphs
are called the roots of the graphs 
considering fdr planning tasks with fork and inverted fork causal graphs  the rst
impression might be that these fdr fragments are restricted enough to allow for polynomialtime planning  this  however  is not the case  even non optimal planning for fdr tasks
with such simple causal graphs is hard  and this even if all variables but the roots are further
restricted to be binary valued  domshlak   dinitz         on the other hand  especially
since non optimal relaxed planning for fdr is polynomial time  these results have no direct
inuence on the complexity of optimal relaxed planning for the respective fdr fragments 
nonetheless  surprisingly or not  this problem is hard 
theorem   optimal relaxed planning is np equivalent even if restricted to fdr tasks
with fork and inverted fork structured causal graphs  moreover  the result holds even if all
state variables but the roots are restricted to binary domains 
proof  the proof is by polynomial reductions from the np equivalent problems of  minimum  directed steiner tree and  minimum  set cover  karp        
directed steiner tree  given a digraph g    n  e  with arc weights w   e  r     a
set of terminals z  n   and a root vertex nr   nd a minimum weight arborescence
 directed tree  t rooted in nr  n such that all terminals z are included in t  
set cover  given a collection c of subsets of a nite set s  nd a minimum cardinality
subset c   c such that every element of s belongs to at least one member of c   
fragment i  given a directed steiner tree problem g    n  e   w  z  nr   the corresponding fork structured fdr task    v  a  i  g  cost is constructed as follows  the
variable set v contains a variable per terminal node in g  plus an extra variable r  that
is  v    r   vz where vz    vz   z  z   the domain of r  d r    n   corresponds
to the nodes of g  and all other variables are binary valued  with d vz             in the
initial state  i r    nr and i v      for all v  vz   the goal is to achieve value   for all
v  vz   for each arc e    x  y   e  the action set a contains a root changing action
   

fidomshlak   nazarenko

ae with pre ae      r  x   e ae      r  y   and cost ae     w e   likewise  for each
terminal z  z  a contains a vz  changing action az with pre az      r  z  vz     
e az      vz      and cost az        this construction is clearly polynomial  the causal
graph of  forms a fork rooted at r  and the variable domains in  are as required by the
theorem  it also holds that 
 i  for any relaxed plan  for   the set of arcs  e   ae  r   in g induces a connected
sub graph g  containing nr such that all terminals z are included in g   or otherwise
at least one of the leaf variables could not have been changed by  to its goal value  
likewise  there is a directed path in g  from nr to every other node n in g   or
otherwise the respective value n of the root variable r could not have been achieved
along    hence  in particular  g  contains an arborescence rooted in nr that includes
all terminals z 
 ii  vice versa  let t be an arborescence of g rooted in nr that includes all terminals
z    z            zm    and let  e            ek   be a topological ordering of the arcs of t   then
ae            aek   az            azm  is a relaxed plan for   and the cost of  is precisely the
weight of t  
hence  optimal relaxed plans for  induce minimum directed steiner trees for g    n  e   w  z  nr  
and vice versa 
fragment ii  given a set cover problem s  c with s                  m  and  c    n 
the corresponding inverted fork structured fdr task    v  a  i  g  cost is constructed as
follows  the variable set v contains a variable per member of c  plus an extra variable r 
that is  v    r  vc   c  c   the domain of r is d r       s  and all other variables are
binary valued  with d vc             in the initial state  i v      for all v  v   the goal is to
achieve value m for the special variable r  for i  s  and each subset c  c such that i  c 
the action set a contains a root changing action ai c with pre ai c      r   i      vc     
e ai c      r  i   and cost ai c        likewise  for each c  c  a contains a vc  changing
action ac with pre ac      vc      e ac      vc      and cost ac        the construction
is polynomial  the causal graph of  forms an inverted fork rooted at r  and the variable
domains in  are as required by the theorem  note that  due to the chain like structure of
the domain transition graphs in   there is no dierence between the plans for  and for
    and it is easy to verify that any plan for  induces a cover of s of the same cost  and
vice versa  hence  optimal relaxed plans for  induce minimum set covers for s  c  and
vice versa 

corollary   optimal relaxed planning is np equivalent even if restricted to fdr tasks
with the causal graph tree width of   
this corollary is immediate from theorem   as the undirected graphs induced by both
forks and inverted forks are a special case of trees and thus have tree width of    at rst
glance  the message of corollary   is discouraging with respect to our agenda  the structure
of the causal graphs does not seem to play a major role in the complexity of optimal
relaxed planning for fdr  our next result  however  seems to be even more discouraging
with respect to the prospects of tractability of optimal relaxed planning for fdr 
   

fithe complexity of optimal monotonic planning

theorem   optimal relaxed planning is np equivalent even if restricted to fdr tasks
with two state variables 
proof  the proof is by a polynomial reduction from the  minimum  directed steiner tree
problem  and in fact  the proof is very similar to that of the fork case of theorem    given
a directed steiner tree problem g    n  e   w  z  nr  with z    z            zm    we compile
it to an fdr task     v    v     a  i  g  cost as follows  the domain of v  corresponds
to the nodes of g  and the domain of v  corresponds to the terminal nodes and the root
node  that is  d v      n and d v      z   nr    in the initial state  both i v      nr and
i v      nr   and the goal is to achieve value zm for v    for each arc e    x  y   e  the
action set a contains a v   changing action ae with pre ae      v   x   e ae      v   y  
and cost ae     w e   likewise  denoting nr by z    for    i  m  a contains a v   changing
action azi with pre azi      v   zi   v   zi     e azi      v   zi    and cost azi       
the construction is polynomial  and its correctness stems from analysis identical to that of
the proof of theorem   

theorem   shows that even the dimensionality of the fdr state spaces plays a secondary
role  if any  in the complexity of optimal relaxed planning  by that  however  it answers
one of the two macro questions on our agenda 
corollary   there exist fragments of fdr for which optimal planning is polynomial time 
while optimal relaxed planning is np equivalent 
this corollary is immediate from theorem   and polynomial time solvability of optimal
planning for fdr tasks with a xed number of state variables 

   positive results i  state variables with fixed size domains
depending on the readers background and intuitions  theorem   can either surprise or seem
somewhat predictable  in any case  it was theorem   that led us to consider a dierent
 and this time fruitful  fragmentation of optimal relaxed planning 
a closer look at theorem   and lemma   reveals that the size of the fdr variable
domains might be crucial in the complexity of optimal relaxed planning  while the proofs
of these two claims rely heavily on the parametric domain size of some of the state variables 
these proofs also imply that optimal relaxed planning is hard even if only a single fdr
variable comes with a parametric domain size  departing from this observation  we now
show that  after all  the topology of the causal graph does play an interesting role in worstcase time complexity classication of optimal relaxed planning for fdr tasks  in particular 
it turns out that bounding the tree width of the causal graph by a constant is all it takes
to achieve polynomial time optimal relaxed planning for fdr tasks with xed size variable
domains 
theorem   for any family of directed graphs c  if the tree width in c is bounded by a
constant  then optimal relaxed planning for fdr tasks with xed size variable domains and
causal graphs in c is polynomial time 
   

fidomshlak   nazarenko

proof  the proof of theorem   is inspired by and closely resembles the approach of brafman
and domshlak        discussed in section      given an fdr task    v  a  i  g  cost 
we compile it into a constraint optimization problem cop     x     over nite domain
variables x   functions   and the global objective to minimize   x    if   is unsolvable  then all the assignments to x evaluate the objective function to   otherwise  the
optimum of the objective is obtained on and only on the assignments to x that correspond
to optimal plans for     that is  to optimal relaxed plans for  
let  v     n     maxvv  d v    and recall that pred v  for state variable v  v denotes
the set of vs immediate predecessors in the causal graph 
 for each state variable v  v   x contains a variable xv that represents the choice of a
subset of actions from av to participate in the plan we are looking for  these possible
choices form the domain d xv   of xv   and each such choice is represented by a set of
size smaller or equal to   with each element of that set being a quadruple
 d  id  a  t  
with d  d v   id   v   pred v   t              n   and  if id   v  then a   a 
av   e a   v    d  and otherwise a    at a high level  if we view state variables as
active decision makers  then d is a value that the relaxed variable v aims to achieve
and accumulate at time point t  either by itself using action a  or by delegating this
task to another variable id  as we show later on  no variable should accumulate more
than  values  and since the accumulated values are never lost  optimal plans for  
cannot be longer than n actions 
 for each state variable v  v    contains a non negative  extended real valued function v from d xv    likewise  for each pair of state variables  v  w  such that the
causal graph cg contains either arc  v  w  or arc  w  v    contains an indicator
function v w   d xv    d xw           to simplify the specication of v w   we
dene a set of auxiliary constraints as follows 
 s    precondition constraint  an assignment v            vn  to x satises s  i  for all
v  v    d  v  a  t   v implies that  for each w  v pre a   
pre a  w    i w     d    d       t    w   t   t  

   

 s    delegation constraint  an assignment v            vn  to x satises s  i  for all v  v  
 d  w    t   v implies that  for some a  av  aw with d  e a  v      w  a  t   w  
 s    goal achievement constraint  an assignment v            vn  to x satises s  i  for
all v  v g  
g v    i v     d    d         v   
   
constraint s  ensures that preconditions of actions to which a variable is committed
are provided on time  constraint s  ensures that the outsourced value achievements are
fullled at the required time points  finally  constraint s  simply veries that the value of
v induced by v is a goal value  importantly  s  corresponds to a set of n unary constraints 
   

fithe complexity of optimal monotonic planning

and s  and s  can both be represented as a set of binary constraints over x   given that 
functions  are specied as

v  v    
cost a  
  v a  v

 
    v   w   satises s  xv   xw    s  xv   xw    s  xv   and s  xw  
v w  v   w    
 
  otherwise

   

where s  xv   xw    s  xv   xw    and s  xv   correspond to the binary and unary constraints
induced respectively by s   s   and s  on the cop variables xv and xw  
let us now take a closer look at cop  constructed as above for the problems in the
scope of theorem   
    the constraint network of cop  corresponds to the undirected graph induced by the
causal graph cg     cg    hence  since the tree width of the latter is bounded by
a constant by the scope of the theorem  so is the tree width of the constraint network
of cop    while nding an optimal tree decomposition of a graph g is np hard 
a tree decomposition of g with width c  tw g  for a low constant c can be found
in time polynomial in the size of g  robertson   seymour        becker   geiger 
      amir         hence  cop  can be solved in time polynomial in the size of its
representation using the standard message passing algorithm for constraint optimization
over trees  dechter        
    recall that the values of the cop variable xv are sets of quadruples  d  id  a  t  of size
   then  the size of the xv s domain d xv   is upper bounded by
  d v      z 
n    av          n    
   z  
   z      z  
d

id

a

   

t

and since    o     we have  d xv      o poly         together with      that implies
that cop  can be solved in time o poly        
we now prove the correctness of this compilation by showing that  if   is unsolvable 
then all the assignments to x evaluate the objective function   x   to   and otherwise  the objective is minimized on and only on the assignments to x that correspond to
optimal plans for    
first  given an assignment    v            vn  to x such that         we show
that  induces a valid plan  for   of cost      note that  since        
by eq    we have  satisfying constraints
s  s  

consider the multi set z   vv   a  t       v  a  t   v   induced by   and let
z     a    t              am   tm     m    z  
be an arbitrary ordering of z such that  for    j   i  m  it holds that tj  ti   for
   i  m  let v be the variable in charge of performing the action ai  in   that is 
 e ai   v   v  ai   ti    v   for each w  v pre ai     eq    in constraint s  implies that either
pre ai   w    i w  or there is some  pre ai   w   id  a  t   w with t   ti   in the latter case 
   

fidomshlak   nazarenko

if id   w  then by the construction of    a   aj for some j   i  and by the denition
of d xw    pre ai   w    e aj   w   otherwise  if id   w for some w   w  then by the
denition of s   pre ai   w    e a   w  for some    w   a   t   w   thus  a   aj for some
j   i  and pre ai   w    e aj   w   therefore  the action sequence
   a            am 
is applicable in the initial state i of     and given that   satisfying s  implies that 
is a plan for     finally  it is immediate from the construction of  and eq    that
cost          
we now show that any optimal plan    a            am  for   induces an assignment
   v            vn  to x such that        cost    by the denition of mfdr 
for    i  m and for each state variable v  v   ija            ai  k v   ija            ai k v  
by optimality of   for    i  m  there exists at least one variable v  v for which
ija            ai  k v   ija            ai k v   in particular  that implies that actions  a            am  
are all dierent  and for each variable v  v   if


 v    ai   ija            ai  k v   ija            ai k v   
then    v    
adopting an arbitrary ordering  v            vn   of the state variables v   for    j  n  let
 vj    aj            ajmj    in turn  for    l  mj   let djl  d vj   be the value achieved and
accumulated for vj by the action ajl   i e   ija            ajl k vj     ija            ajl   k vj      djl    for

   l  mj   if ajl  j 
k    vk   then vj is set to contain  djl   vj   ajl   jl    and otherwise  vj
is set to contain  djl   vk     jl   for k   min  k    ajl   vk   
by the construction of    each action a from  is present in the value of exactly one
variable xv   and by eq     v  v   sums up the cost of a exactly once  hence  if  satises
the constraints s  s  that are enforced by the step functions v w   we have       
cost    the former also directly follows from the construction of    for    j  n 
mj
let vj     djl   idjl   ajl   tjl   l  
  by the denition of the values djl as above  the set of
values  dj            djmj   is exactly the set of values of vj that gets accumulated by the relaxed
plan  from i  and thus satisfaction of s  follows from  being a plan for     again  by
the construction of    the sequence of time points  tj            tjmj   corresponds to the time
points of the rst achievements of  dj            djmj    respectively  along   and for each such
rst achiever ajl along   it is captured and properly scheduled either by vi or by a neighbor
of vi in the causal graph  hence  the constraints s  and s  are all satised as well  this
nalizes the proof for the compilation correctness  and thus of theorem   

note that theorem   in particular answers the second macro question on our agenda 
corollary   there exist fragments of fdr for which  even satiscing  planning is npequivalent  while optimal relaxed planning is polynomial time 
   that corresponds
to the well known fact that  under our notation  optimal plans in mfdr cannot be

longer than vv  d v    n 

   

fithe complexity of optimal monotonic planning

this corollary is immediate from theorem   and the discovery of gimenez and jonsson
     b  that fdr planning over chain causal graphs is np hard even if restricted to variables
with domains of size   
following our strips vs  fdr discussion in the introduction  theorem   trivially
implies that optimal relaxed planning for strips tasks  can be done in time polynomial
in      and exponential only in the tree width of the causal graph  this is actually an
example of a tractability fragment for which one can only benet from switching to a
propositional representation  while the formulation of the result remains the same  the
coverage of the result grows because  if the size of the fdr variable domains is bounded by
   o     then the tree width of the causal graph under strips representation is at most
 times larger than this under fdr  however  it can also be smaller  down to identical 
later  however  we present some results that directly benet from the nite domain input
representation of the planning tasks 
our discussion in the remainder of this section addresses the readers familiar with the
work of brafman and domshlak        in detail  this discussion can be skipped without
any loss of continuity 
at rst view  the compilation in the proof of theorem   brings to mind the compilation in the algorithm
v 
v 
vn
behind the proof of theorem   of brafman and domshlak         one might thus naturally ask whether that
algorithm cannot be used directly for the proof of our
theorem    as it stands  however  the algorithm of
vn  
brafman and domshlak does not yield polynomialtime complexity on those tasks with which theorem  
is concerned  to see why  consider an fdr task    v  a  i  g  cost with v    v            vn     
where  for all vi   d vi             i vi        and g vi        and a    a            an   with
v pre ai        v e ai       vi   vn      and e ai   vi     e ai   vn          the causal graph
of   depicted above  has tree width of    however  for any plan  for     maxvv   v    
n  and the local depth   is n  this is because   cannot be solved without applying each
of the n actions a at least once  and each of these actions aects the value of the variable
vn     hence  nding even a non optimal plan for   using the algorithm of brafman and
domshlak        will take time exponential in      
as a nal note  it actually can be shown that the algorithm of brafman and domshlak
       is optimal and polynomial time on a sub class of mfdr tasks like those in theorem  
but also restricted to single eect operators  it is multiple eect actions that complicate
matters  and require a dierent algorithmic approach to guarantee planning tractability 

   positive results ii  m unfoldable state variables
despite the discouraging results in section    we now return to consider fdr tasks with
parametric size domains  recall that  while the variable values of monotonic relaxation  
correspond to sets of values of the respective variables in   these large variable domains in
  are given implicitly  via the variable domains d v             d vn   of   this conciseness of
representation  however  hides many aspects of the problem structure in   that otherwise
might have be exploited for planning eciency  in particular  reasoning about the domain
   

fidomshlak   nazarenko

transition graphs induced by the fdr tasks has been successfully exploited in complexity
analysis of fdr  jonsson   backstrom        domshlak   dinitz        katz   domshlak 
      gimenez   jonsson      a   in contrast  in monotonic relaxations  the true domain
transition graphs of     denoted henceforth as dtg v       cannot always be represented
explicitly because the number of nodes in these graphs is exponential in       however 
this is not always  or does not always have to be  the case  and below we focus on planning
with such accessible monotonic variables 
denition   given an fdr planning task    v  a  i  g  cost  the eective domain
d  v  of v  v in   consists of all value subsets   d   v     d v     that are reachable
from  i v   in dtg v       that is    d  v  i
 i  i v     and
 ii  for each value d    there is a directed path from i v  to d in the unlabeled digraph
induced by dtg v    such that all the values along that path belong to  
the elements of d  v  are called the eective values of v in    
denition   let  be an innite set of fdr tasks  and  be a property of state variables
that  for each task     partitions the state variables of  into those that satisfy 
 referred as  variables   and those that do not satisfy   we say that  variables in  are
monotonically unfoldable  m unfoldable  if there exists an integer k  n such that 
for every task    and every  variable v of    d  v     o     k   
 in denition   can be any property of fdr state variables  and in particular  any
property dened with respect to the tasks causal graphs  such as root  sink  nodes
whose causal graph in degrees are larger than their causal graph out degrees  etc  informally   variables of a set of fdr tasks  are m unfoldable if  for every task    and
every  variable v of   the relevant subgraph of dtg v      can be described explicitly
in space polynomial in the representation size of   for instance  v is trivially m unfoldable
if the size of its domain in  is bounded by a constant  or even by o log         more generally  let dtg  v    be the digraph obtained from the  labels ignored  domain transition
graph dtg v    by unifying parallel edges  it is not hard to verify from denitions   and  
that v is m unfoldable if and only if the number of arborescence subgraphs of dtg  v   
rooted in i v   and covering g v  if v  v g   is o poly        
we now return to consider fork structured fdr tasks  while in theorem   we considered
fork structured fdr tasks with only root variables being unrestricted  we now consider an
inverse fragment  corresponding to fork structured fdr tasks with only root variables
being restricted  optimal fdr planning for such tasks is polynomial time for  d r    
   katz   domshlak         but it is np equivalent for  d r        katz   keyder        
in contrast  theorem   below shows that optimal relaxed planning for fork structured fdr
tasks is polynomial time for a much wider class of root variables  moreover  a simple
observation behind the construction in the proof of theorem   is later generalized to capture
a much richer fragment of causal graphs 
theorem   optimal relaxed planning is polynomial time for any set of fdr tasks 
with fork structured causal graphs and m unfoldable root variables 
   

fithe complexity of optimal monotonic planning

proof  let    v  a  i  g  cost be a fork structured fdr task with root r and vleafs  
v    r     v            vn    we assume that goal values are specied for all variables in vleafs  
this is because none of the leaves in vleafs   v g  need to change their value at all  and thus
they can be schematically removed from the problem  given such a fdr task   an optimal
plan for its relaxation   can be constructed as follows 
 all the eective values   d  r  consistent with the goal  that is  g r    if
r  v g   are processed one by one  independently  for each such eective value  
we extract the following information 
    for the root variable r  we determine a cheapest path from i r  to  in dtg r      
with    denoting the action sequence inducing that path 
    for each leaf variable v  vleafs   we
 a  schematically remove from the domain transition graph dtg v    all the
arcs labeled with actions a that are not supported by   that is  actions a
with r  v pre a   and pre a  r     and then
 b  determine a cheapest path from i v  to g v  in that arc reduced domain
transition graph  with   g v   denoting the action sequence inducing that
path 
 return the concatenation of action sequences        g v               g vn    where
 
 
n


cost   g vi      
   argmin cost      
d  r 

i  

and cost   for an action sequence  is the sum of the costs of actions along  
the algorithm is polynomial time given an explicit description of the eective part of
dtg r       and thus it is polynomial time if r is m unfoldable  recall that  since the
causal graph is acyclic  no action aects more than one variable  the correctness of the
algorithm stems from a simple observation that  for any relaxed plan  for a fork structured
fdr task      r  v          vn is also a relaxed plan for   and  trivially  of identical
cost  hence  while searching for an optimal relaxed plan for   we can restrict ourselves to
plans of the latter form  and it is immediate from the description of the algorithm that it
nds the cheapest such plan 

as an aside  following our strips vs  fdr discussion  note that theorem   provides
an example for exploiting value grouping induced by the fdr representation of the planning tasks  the simple algorithm in the proof exploits the fact that only the actions that
change the value of a leaf variable depend on its value  and this prevents restrictions from
being placed on either the size of the leaf domains  or on the structure of their domain
transition graphs  of course  theorem   can also be reformulated in terms of strips  yet
this would require the respective partition of the propositions to be given discovered  which
is essentially equivalent to starting with something like fdr input in the rst place 
while the scope of the tractability result in theorem   is fairly limited in terms of
the causal graph structure  the nice property of the sets of optimal relaxed plans for forkstructured fdr tasks  exploited in the proof of theorem    can be generalized to a much
   

fidomshlak   nazarenko

wider fragment of causal graphs  in turn  this generalization allows us to provide our next
tractability result for a wide fragment of optimal relaxed planning for fdr 
lemma   let    v  a  i  g  cost be an fdr task with a directed acyclic causal graph 
and let  v            vn   be an arbitrary topological ordering of v with respect to cg   then 
for any plan  for        v          vn is also a plan for    
proof  directed acyclicity of the causal graph in particular implies that no action aects
more than one variable  the proof of the lemma stems from combining this property with
 i  the fact that  preserves the order of the actions vi as in   and  ii  the core property
of monotonic relaxations   that  for any variable v  any value d  d v   and any state s
of the relaxed task     if d  s v   then d  s  v  for any s reachable from s in    
since cg forms a dag and the state variables are ordered according to a topological
ordering of cg   v pre a  v       v    for all actions a  v    thus  order preservation of
v  along  with respect to  implies that v  is applicable in i  with ijv  k v      ijk v    
and ijv  k vi     i vi   for i      assume now that  for i     v          vi is applicable in
i  and
 
ijk vj    j  i
ijv          vi k vj    
 
   
i vj   
j i
together with the topological ordering of v and order preservation of vi    along  with
respect to   eq    implies that vi   is applicable in ijv          vi k  and
ijv 

 
ijk vj   
j  i  
 
        vi kjvi   k vj    
ijv          vi k vj    otherwise

   

putting eqs    and   together then proves the induction hypothesis  and for i   n  eq   
boils down to
ij k   ijv          vn k   ijk 

denition   let  be an innite set of fdr tasks  we say that the tasks in  are munfoldable if all state variables in  are m unfoldable 
theorem   let  be an innite set of m unfoldable fdr tasks with directed acyclic causal
graphs  if both the tree width and node in degree of the causal graphs in  are bounded by
a constant  then optimal relaxed planning for  is polynomial time 
proof  similarly to the proof of theorem    the proof of theorem   is based on a planningto cop compilation  given an fdr task    v  a  i  g  cost  we compile its monotonic
relaxation   into a constraint optimization problem cop     x     over variables x  
functions   and the global objective to minimize   x   such that  if   is unsolvable 
then all the assignments to x evaluate the objective function to   and otherwise  the
optimum of the objective is obtained on and only on the assignments to x that correspond
to optimal plans for     the specic construction of cops here relies on the property of
monotonic relaxations of dag structured fdr tasks expressed by lemma   
   

fithe complexity of optimal monotonic planning

given an fdr task    v  a  i  g  cost as in the theorem  cop     x     is specied
as follows  for each state variable v  v  
 x contains a variable xv with domain d xv     d  v   that is  the eective domain
of v in     and
  contains a non negative  extended real valued function v over v and its immediate
ancestors in the causal graph  that is  over  xv     xw   w  pred v   
assuming an arbitrary xed ordering  w            wk   of vs immediate ancestors pred v   for
each pred  d  pred v     d  w         d  wk    let dtg v     pred   denote the
restriction of dtg v      to only edges supported by pred   an edge marked with an
action a remains in dtg v     pred   if and only if  for each w  v pre a    v   pre a  w  
pred  w   given that  for each eective value   d  v  and each pred  d  pred v   
v    pred      if  is not reachable from i v  in dtg v     pred    or if g v  is specied
yet g v     otherwise  v    pred   equals the cost of a cheapest path from i v  to 
in dtg v     pred    in what follows  the action sequence inducing that cheapest path is
denoted by   pred   
the properties of cop  constructed as above for the problems in the scope of theorem   are as follows 
    the constraint network of cop  corresponds to  the undirected graph induced by 
the moral graph of the causal graph cg   since both in degree and tree width of cg
are bounded by a constant  then so is the tree width cop of the constraint network  as
we mentioned before  given a graph g  a tree decomposition of a graph g with width
c  tw g  for a low constant c can be found in time polynomial in the size of g and
exponential only in tw g   hence  since cop   o     cop  can be solved in time
polynomial in the size of its explicit representation 
    since  is m unfoldable  the domain size of each cop variable is o poly         together with      that implies that cop  can be solved in time o poly        
    by the denitions of monotonic relaxation and of domain transition graphs  explicit
description of all dtg v      for an m unfoldable fdr task  is polynomial in      
hence  the construction of functional components   and thus of the entire cop    can
be done in time o poly        
    by the construction of cop  and lemma    for any topological ordering  v            vn  
of v   every complete assignment  to the cop variables x such that

v   v    pred v         
vv

induces a relaxed plan
  v     pred v                vn    pred vn    
of cost  for   and vice versa  thus  if   is solvable  then  given an assignment  
to x on which the minimization objective of cop  is obtained  we can derive from it
 in o poly        time  an optimal relaxed plan for   otherwise  if   is unsolvable 
then all the assignments to x evaluate the objective function to  
   

fidomshlak   nazarenko

onml
hijk
v 


hijk
onml
v 


hijk
onml
v 

  d   

d   
d   

d   

d   
d   

d   
d   

onml
hijk
hijk
hijk
  onml
  onml
o
d    qo q
d   
d
bb qqq       bb
mm 
m
m
bb q q q
b
 
m
m
bb   qqqmmmmbbb   
 b
mmqqqq   bb
   bbmmm
q  b
     mmmmm bb        qqqqqbb  
mv
 
hijk
onml
hijk
hijk
  onml
o
  onml
d    qo q
d
d   
m
bb qqq       bb
m
m
 
m
bb q q q
b
 
m
m
bb   qqqmmmmbbb   
 b
mmqqqq   bb
   bbmmm
q  b
     mmmmm bb        qqqqqbb  
mv
 
hijk
onml
hijk
hijk
  onml
  onml
d    o
d    o
d   

d   

 

  d   
 

d   

d   

  d   

d   
d   

 
  d   
 

d   

 

  d   
 

d   
d   

 
  d   
 

 a 

 b 

figure    illustration for the example used in the discussion of theorem   
this nalizes the proof of theorem    and corollary   below generalizes it to digraphs that
are almost dags 

note that theorem   provides yet another example of exploiting value grouping induced by the fdr representation of the planning tasks  consider a planning task family
 n    v  a  i  g  cost in which v    v            vn    for    i  n  d vi      di             di n   
i vi     di     g vi     di n   and actions

a 
 ai k j    vi  di k   vi   di  j     vi  di k      
 
 z
   
 z
 
 i jn
 kn 

pre

e

figure  a illustrates the causal graph and the domain transition graphs for the task      
the causal graphs in  n  form directed chains  and thus both the tree width and node
in degree of the causal graphs in  n  equal    likewise  the eective domain d  vi   of
each vi in  
 n  is of size n  and thus the tractability of optimal relaxed planning for  n 
is directly covered by theorem    in contrast  if each variable value di j is represented by
a separate propositional variable  inducing the causal graph as in figure  b  then both the
tree width and node in degree in the family of the induced causal graphs are of the order
of n  and in fact  the causal graph is not even acyclic  therefore  theorem   is no longer
directly applicable 
corollary   let  be an innite set of m unfoldable fdr tasks  if the size of the strongly
connected components  the tree width  and the node in degree of the causal graphs in  are
all bounded by a constant  then optimal relaxed planning for  is polynomial time 
proof  any fdr task  with a causal graph whose strongly connected components  sccs 
are of size at most k can be compiled into an equivalent fdr task m with a directed acyclic
causal graph by merging the variables of each scc into a single variable  seipp   helmert 
       this compilation can be done in time polynomial in      and exponential only in k 
the causal graph cgm is obtained from the causal graph cg by contracting all nodes of
each scc  since node contraction can only decrease the tree width  we have tw cgm   
   

fithe complexity of optimal monotonic planning

tw cg    and thus tw cgm     o     likewise  if the maximal node in degree in cg
is c  then the maximal node in degree in cgm is ck  and thus it is also o     finally 
the domain of a variable u in m that is obtained by merging some s scc  v u           vku   
k   k  corresponds to the cross product of the domains of these sccs variables  it is
easy to verify from denition   that d  u   d  v u        d  vku    and thus  together
with k   o     m unfoldability of all v u           vku implies  d  u     o poly         tting 
denition   

returning now to the statement of theorem    a few comments on its extensions beyond
corollary   are in place  first  note that theorem   as it is does not generalize theorem   for
fork structured fdr tasks because the latter allows for general  and not only m unfoldable 
leaf variables  however  it is easy to see that theorem   can be stratied to allow for
such generalization  since no other variable depends on a leaf v  all we care about in v is
achieving g v   thus  for any optimal relaxed plan   v induces a simple path  and not a
general arborescence  in dtg v     hence  using binary valued  g v  achieved  yes no 
cop variables xv for the dag leaf v  and specifying the respective functions v using the
procedure in the proof of theorem    the scope of theorem   is extended to generalize
theorem   
second  in the case of dag structured causal graphs  denition   of eective domains 
on which the notion of m unfoldability is based  is overly conservative  instead of deriving
the eective domains for the variables in isolation  we can derive them in a topological order
of the causal graph  given the already derived eective domains of the immediate ancestors 
in specic domains  this can substantially extend the scope of m unfoldability for fdr tasks
with dag causal graphs 
finally  theorem   requires not only the tree width  but also the in degree of the causal
graph to be bounded by a constant  as such an extra condition  the latter is sucient 
but not necessary  below  under the notion of prevail decomposability  we list two local
properties of state variables that guarantee polynomial time optimal relaxed planning on
arbitrary acyclic causal graphs with a xed tree width  it is very likely that other such
helpful properties exist  and thus the boundaries of prevail decomposability can be further
extended  nicely  optimal relaxed planning will remain polynomial time even if dierent
state variables satisfy dierent such properties  and even if some state variables are not
prevail decomposable  but have xed in degree 
denition   let  be an innite set of fdr tasks  and  be a property of state variables
that  for each task     partitions the state variables of  into those that satisfy 
 referred as  variables   and those that do not satisfy   we say that  variables in  are
prevail decomposable if  for every task    and every  variable v of   either
 i  the set prv    pre a  pred v     a  av   of preconditions of actions av on variables
other than v is of size o log         or
   note that it is possible that d  u   d  v u    d   vku    for instance  if v    x  y   d x    d y   
        i    x     y      g    x     y      and a     x     y       x       y     x 
     y       then d  x                   d  y                   but d  xy      x     y       in
fact  this example can be easily extended so that the merged variable xy is m unfoldable  while both
x and y are not 

   

fidomshlak   nazarenko

 ii  the set arbv of arborescence subgraphs of dtg v    rooted in i v   and covering g v 
if v  v g   is of size o log        
we say that the tasks in  are prevail decomposable if all state variables in  are
prevail decomposable 
note that prevail decomposability of type  i  is tangential to the notion of m unfoldability 
neither does the former imply the latter  nor the other way around  in contrast  prevail
decomposability of type  ii  is a direct stratication of m unfoldability because the latter
considers a compacted version dtg  v    of dtg v     and furthermore  allows for a
polynomial  rather than logarithmic  bound on the number of arborescence subgraphs 
theorem   let  be an innite set of m unfoldable  prevail decomposable fdr tasks with
directed acyclic causal graphs  if the tree width of the causal graphs in  is bounded by a
constant  then optimal relaxed planning for  is polynomial time 
proof  here as well  our proof of theorem   follows the planning to cop compilation
methodology  however  the compilation under prevail decomposability must dier from the
one in the proof of theorem   since we can no longer rely on xed in degree of the causal
graphs to derive the xed tree width of the constraint networks from the xed tree width
of the causal graphs  for ease of presentation  we rst specify the compilation assuming
all the state variables satisfy the specic condition  i  of denition    we then extend the
specication to cover the alternative condition  ii  of denition   as well 
for our construction we need to establish a certain graph theoretic formalism and a
respective notation  let g    v  e  be a graph  and let n   v   v be the node neighborhood function of g  that is  n  v     u    v  u   e   the splitting of v  v with
the support s  n  v  transforms g by adding new vertex v  and edge  v  v     and  for all
u  s  removing edge  v  u  and adding edge  v    u   informally  splitting can be seen as
a  non unique  reverse process to edge contraction  and the nodes added to g by splittings
are called stretch nodes  for example  figure  b depicts the graph obtained from the graph
in figure  a by splitting the node v with the support of  x  y  u   n  v     x  y  u  w  
adding a stretch node v     
a graph g  is an expansion of g if g can be transformed to g  by a sequence of splittings 
for example  figure  c depicts the graph obtained from the graph in figure  a by rst
splitting the node v with the support of  x  y   n  v     x  y  u  w   and then splitting v
with the support of  u  w   n  v     v      u  w   more specically  g     v    e    is an
expansion of g    v  e  if and only i there exist functions f   v   v and g   e  e 
such that
 a  for v  v   the subgraph of g  induced by f    v     v   v    f  v      v  is a tree  and
 b  for  v  u   e  if g  v  u      v    u   then f  v      v and f  u     u 
the tree subgraph t   v  of g  induced by f    v  is called the stretch tree of v  there is a
bijective correspondence between the leaves of t   v  and the neighbors n  v  of v via the
function g  for each  v  u   e  there is exactly one edge in e    g  v  u    that directly
connects between t   v  and t   u   in other words  f induces a partition of v    with each
part being the stretch tree t   v  for some v  v   and g maps the edges of g to those edges
   

fithe complexity of optimal monotonic planning

x 

y

 
   
  
v 
     
  



u

w

 a 

x






v   

y

y

x   

  

v   
v

x   

v

w

u   

  
 

u

 b 

v   

y   

v

v   
u

y

x

w

 c 

v   

u

w   
w

 d 

figure    node splitting and graph expansions 
of g  that connect between the parts of this partition  finally  if the node degree in g 
is bounded by    then g  is called sub cubic  for example  the expansion in figure  c is
sub cubic  while the expansion in figure  b is not 
the above terminology is mostly adopted from markov and shi         in addition  we
call an expansion g  of g fully separating if the stretch trees in g  are connected only at
the stretch nodes  and not at the original nodes  of g  that is  g     v    e    is a fully
separating expansion of g    v  e  if there exists a function    v  v  such that  for each
v  v   it holds that   v   f    v  and  for each edge    v   v     e    v   f    v   for
example  the expansion in figure  c is not fully separating  while the expansion in figure  d
is  
given the above notion of graph expansion  if we now have a problem to be solved on a
graph g  and eciency of solving this problem depends badly  possibly exponentially  on the
node degree in g  then we can try to reformulate this problem over a sub cubic expansion
g  of g  however  if the eciency of the problem in question also depends badly on the
graphs tree width  then the tree width of g  should be as close as possible to that of g 
 the tree width of g  cannot be smaller than the tree width of g because g  has g as a
minor   while there are numerous ecient schemes for sub cubic graph expansion  most
of them can create expansions of arbitrarily larger tree width than that of their expandees 
recently  however  markov and shi        showed that this negative side eect can always
be eliminated  and sometimes even eciently 
theorem     of markov and shi        states their main result  there is a polynomialtime algorithm that  given a graph g and its tree decomposition of width w  computes a
sub cubic expansion g  of g with tw g     w      in particular  this result implies that
any graph g admits a sub cubic expansion whose tree width is no more than tw g       and
that this expansion can be constructed eciently for arbitrary graph families with a xed
   without any eective loss of generality  one can assume that   v    v  that is  the nodes in v are never
mapped to stretch nodes  but only to their mirrors in v    however  here we decided to stick to the
explicit use of the  function to avoid confusion between the nodes v and the identically named nodes
in v   

   

fidomshlak   nazarenko

tree width   moreover  it is straightforward to verify that any expansion can be transformed
in linear time into a fully separating expansion  without increasing the tree width and node
degrees  therefore  theorem     of markov and shi        holds even if we request fully
separating sub cubic expansions  
our cop compilation exploits such tree width friendly expansions of causal graphs 
since our focus in theorem   is on digraph families c with the tree width in c being
bounded by a constant  by theorem     of markov and shi         any digraph g  c
can be eciently associated with a fully separating sub cubic expansion g  with tree width
 tw g       note  however  that the construction of g  ignores the orientation of the arcs
in g  while g is a digraph  g  is an undirected graph  and its construction is based on a
tree decomposition of the undirected graph induced by g  since our cop compilation does
depend on the direction of the arcs in the causal graph  we will have to restore in g  the
relevant bits of this information about g 
but rst we give some auxiliary notation 
 given a fully separating expansion g  of  the undirected graph induced by  a digraph
g    v  e   we consider stretch trees t   v  as if rooted in the respective nodes   v  
and by tv  v  we denote the subtree of t   v  rooted at v   t   v  
 recalling that the graphs g of our interest here are dags  and that the leaves of t   v 
are bijectively associated with the neighbors n  v  of v in g  let n in  v   n out  v  
n  v  be the partition of vs neighbors in g into immediate ancestors and immediate
descendants of v  respectively 
out  v  we denote the respective neighbors of
 by nvin  v   n in  v  and nvout
  v   n
v that are associated with the leaves of the stretch subtree tv  v   that is  we have
 of t   v  and some u  t   u  
u  nvin  v   nvout
  v  if and only if  for some leaf v
v





g contains edge  v   u    i e   g  v  u      v   u    

we now proceed with specifying our cop compilation for the fdr tasks as in theorem   
given such a task    v  a  i  g  cost  let g     v    e    be a fully separating  sub cubic
expansion g  of the causal graph cg with tree width  tw cg        the respective
constraint optimization problem cop     x     is specied as follows 
for each v  v   x contains a variable xv that is schematically associated with the root
  v  of t   v   and a variable xv  v for each stretch tree node v   t   v       v    the
domain of the variable xv is
 
      d  v   g v      v  v g 
d xv    
 
   
d  v  
otherwise
the domain of each variable xv  v is
d xv  v           mv  d xv   

   

   while determining optimal tree decomposition of a graph is np hard  it can be done in polynomial time
for graph families having xed tree width  bodlaender        
   requiring the expansions to be fully separating is more of a luxury than a need  relying on this property
simplies the compilation scheme described next  but that scheme can also be modied so to not require
full separation 

   

fithe complexity of optimal monotonic planning

where mv    prv    that is  d xv  v   is a set of some pairs     with         mv and  
d  v   for each         mv   by dtg v       we denote the restriction of dtg v     
to edges supported by   assuming an arbitrarily xed numbering of the elements of
prv    pr            prmv    an edge marked with an action a such that pre a  pred v     pri 
prv remains in dtg v       if and only if  i       for   d  v   by c    we denote
the cost of a cheapest path from i v  to  in dtg v        in case of unreachability 
c       
similarly to the way each node of the causal graphs expansion g  is associated with a
cop variable  it is also associated with a non negative  extended real valued function  for
each state variable v  v  
 i  the stretch tree root   v  is associated with a function v   the scope of v is
q v      xv     xv  v   v   n     v    


where n    v    v is the node neighborhood function in g    note that  n     v    
  because g  is sub cubic  for each   d xv   and each assignment     v   v  v n     v  
to q v      xv   
 
c  h      v   n     v     v   
v       
 
   
 
otherwise
where h   is the hadamard  or entrywise  product of all the indicator vectors
 v  v n     v   in  
 ii  each leaf stretch node v   t   v  is associated with a    indicator function v  v  
the scope of which is
q v  v      xv  v   xu  u   
where u is the leaf node of t   u  such that g  v  u      v    u    here the orientation
of the arcs within the causal graph cg matters  specically  if  v  u  represents a
causal graph arc from u to v   then v  v zeroes on the assignments  v     u   u  
such that
 the vector v enables all and only all the preconditions in prv that are  passively
or actively  supported by the value u of u  and
 the vector u enables all the preconditions pru   since v does not condition the
u changing actions in our dag structured planning task  
that is  for each v   v   d xv  v   and each u   u   d xu  u   


  

u     
v  v  v   v   u   u    
   i  mv    v  i         u  v pri    pri  u   u    


  otherwise
    
note that the value of v  v is independent of the v component of v   v   u   u  
   

fidomshlak   nazarenko

otherwise  if  v  u  represents a causal graph arc  from v to u  then conversely 


   v     




v  v  v   v   u   u    
   i  mu    u  i         v  v pri    pri  v   v    


  otherwise
    
 iii  each internal stretch node v   t   v  is also associated with a    indicator function
v  v   but its scope comprises the variable xv  v   together with all the variables xv  v
that correspond to the immediate descendants of v  in tv  v   that is 
q v  v      xv  v     xv  v   v   n   v     tv  v   
for each v   v   d xv  v   and each assignment     v   v   to q v  v    
 xv  v    v  v zeroes on  v   v     if and only if the vector v enables all and
only all the preconditions in prv that are  passively or actively  supported by all the
immediate ancestors u  nvin  v  via the values these ancestors commit to at the
respective stretch tree root cop variables xu   that is 
 
   v   h    v   n   v     tv  v    v   v
v  v  v   v      
      
  otherwise
in other words  starting with eqs     and     the support provided by nvin  v  to v is
communicated to v by the indicator vectors v in   and it is aggregated summarized
in eq     by the hadamard vector product h    
complexity wise  the properties of the cop  constructed as above are as follows 
    the constraint network of cop  is obtained from the expansion g  by replacing each
 be a graph
subgraph of g  induced by nodes q    with a clique over q     let gq
with nodes q     x  x   and edges  q     q     for  only  all pairs    such that
 is isomorphic to
q     q        by the construction of the cop functions   gq

g   likewise  since  q     q        for all pairs of functions       the tree width
    max  q      together that implies
cop of the constraint network is  tw gq



cop  tw gq
 max  q       tw g   max  q       tw g       tw cg        o    




hence  since nding a constant factor approximation to the graphs tree width is polynomial in the size of the graph and exponential only in its tree width  cop  can be
solved in time polynomial in the size of its representation 
    by m unfoldability of  and eq     for v  v   the domain size of each cop variable xv
is o poly         the domain of each stretch node variable xv  v is a cross product of
two sets  the size of the second set in eq    is o poly        because so is the domain
size of the respective variable xv   the size of the rst set in eq    is   prv   and  by
denition      prv      o log          o poly         together with      this implies that
cop  can be solved in time o poly        
   since theorem   is devoted to directed acyclic causal graphs  we do not address here the case in which
cg contains both  v  u  and  u  v  

   

fithe complexity of optimal monotonic planning

    by the denition of monotonic relaxation and the denition of domain transition graphs 
explicit description of all dtg v      for an m unfoldable fdr task  is polynomial
in       hence  the construction of functional components  as in eqs        and thus
of the entire cop    can be done in time o poly        

we now proceed to prove the correctness of cop     x      that is  we will prove
that if   is unsolvable  then all the assignments to x evaluate the objective function
  x   to   and otherwise  the objective is minimized on and only on the assignments
to x that correspond to optimal plans for    
first  given an assignment  to x such that         we show that  induces
a valid plan  for   of cost      by eqs    and            implies that 
for each v  v and each xv  v in the stretch tree t   v    xv  v        xv     that is 
the relaxation value of v assigned by  to xv is consistently propagated to all the nodes of
t   v   and in particular  to its leaves 
let a leaf node xv  v in t   v  connect t   v  with t   u  for some causal graph neighbor
u  n  v   and let  xv  v     v    xv    if u  n in  v   then by eq      v  v      
implies that v encodes all and only all preconditions in prv that are not disabled by the
relaxation value  xu   of u  otherwise  if u  n out  v   then  by the dag structure of cg  
u has nothing to do with preconditions of actions aecting v     and by eq      v  v      
implies that v     trivially enables all the preconditions in prv  
given that  for each  leaf or internal  stretch node in t   v   let  xv  v     v    xv   
by the conjunctive structure of the preconditions in fdr and the hadamard vector product
in eq      v  v       implies that v encodes all and only all the preconditions in prv
that are notdisabled by the values  xu   of all u  nvin  v   finally  by the denition of graph
expansion  v n     v   nvin  v    n in  v   thus  by eq      v       implies that  xv   is
reachable from i v  in the properly restricted domain transition graph dtg v      xv   
where xv    xu   u  pred v    and that v    equals the cost of the cheapest such
path  the rest follows from the dag structure of cg and lemma    the proof of the
opposite direction is straightforward from the construction of cop  and the serialization
lemma   


in our nal note we return to the denition of prevail decomposability  and specically  to
its second sucient condition that  for all state variables v  v   the set arbv of arborescence
sugraphs of dtg v    rooted in i v   and covering g v  if v  v g   is of size o log        
while this condition was not addressed in our cop construction so far  switching from
the rst to the second sucient condition of prevail decomposability requires only that
the semantics of the indicator vectors  be changed  instead of encoding the support that
pred v  provide to individual preconditions of actions in av   they should encode the support
that pred v  provide to the entire arborescences arbv in dtg v     since the condition
requires  arbv     o log         this support can be encoded and reasoned about eciently 
note that the choice between the two conditions can be made on a variable by variable basis 
and thus the two conditions are not mutually exclusive but complementary 
   

fidomshlak   nazarenko


causal graph
extra condition
xed size
   o   
 d v     o   
   o      dag  d v     o   
   o      dag in degree   o   
   o      dag

fdr
in p 
yes
no
no
no
no

mfdr
in p 
no
yes
yes
yes  if m unfoldable
yes  if m unfoldable and
prevail decomposable

th 
th 
th 
th 
th 

 
 
 
 
 

table    a summary of our main results for optimal mfdr planning  contrasted with the
previously established complexity of the corresponding fragments of optimal fdr
planning  in the table   is a fragment of fdr mfdr planning  characterized
in terms of the causal graph tree width   causal graph in degree  and upper
bound  d v   on the size of the variable domains  m unfoldability and prevail
decomposability are two properties of mfdr tasks that have been introduced and
exploited in this work 

   summary and future work
we took a step towards a ne grained classication of worst case time complexity of optimal
monotonic planning  with a focus on what gets harder and what gets easier when
switching from optimal planning to optimal relaxed planning  in the context of nite domain
planning task representations  along the way  we established both negative and positive
results on the complexity of some wide fragments of this problem  with the negative results
emphasizing the role of the structure of state variable domains  and the positive results
emphasizing the role of the causal graph topology  table   lists our main results for optimal
monotonic planning  contrasted with the complexity of the corresponding fragments of
optimal fdr planning  the key conclusions are as follows 
   optimal planning for monotonic relaxations is hard even if restricted to very simple
causal graph structures  but the complexity there stems from the size of the state
variable domains 
   restricted to planning tasks with constant bounded state variable domains  the problem becomes solvable in time exponential only in the tree width of the causal graph 
while it is known to be very much not so even for non optimal regular planning 
   while the tree width of digraphs is independent of the edge directions  exploiting
the directed structure of the causal graph together with its tree width allows the
computational tractability to be expanded beyond xed size state variable domains 
the latter conclusion opens an interesting venue for further investigation  while we
addressed only directed acyclic causal graphs  the scope of tractability can perhaps be expanded by exploiting some existing directed notions of graph width  johnson  robertson 
seymour    thomas        hunter   kreutzer        berwanger et al          this might
   

fithe complexity of optimal monotonic planning

be especially appealing because the tree width of most standard planning benchmarks under their natural fdr encodings does not appear to be xed across the respective families
of the tasks 
another interesting direction would be to examine the results and techniques introduced here in a wider context  that of the recently introduced framework of red black
relaxations  katz et al       b   in red black  rb  planning  the variables are partitioned
into two sets  the black set adopts the regular  value switching semantics of fdr  while
the red set adopts the monotonic  value accumulating semantics of mfdr  in the context
of satiscing planning  complexity analysis of rb planning complexity through the lens of
causal graph topology has already led to some advances in the practice of heuristic search
planning  katz et al       a  katz   homann         to take a similar step in optimal
planning  admissible heuristics that are based on rb relaxations must be devised  that  in
turn  calls for identifying tractable fragments of optimal rb planning  we are cautiously
optimistic that some of the results and techniques presented in this paper will be found valuable in the context of rb planning as well  for instance  the positive result in theorem  
for fork structured mfdr tasks can be straightforwardly extended to rb tasks with only
root variables taking the monotonic semantics and all the leaves keeping their regular  fdr
semantics  similarly  the positive result in theorem   for dag structured mfdr tasks can
be straightforwardly extended to rb tasks with black painted leaf variables  an interesting
question in that respect is whether computational tractability of optimal rb planning can
be extended to causal graphs in which some internal nodes get to keep their original fdr
semantics 

acknowledgments
the work was partly supported by the israel science foundation  isf  grant          and
the eoard grant fa               

references
amir  e          approximation algorithms for treewidth  algorithmica                 
arnborg  s   cornell  d  g     proskurowski  a          complexity of nding embeddings
in a k tree  siam journal of algebraic discrete methods            
backstrom  c     klein  i          planning in polynomial time  the sas pubs class 
computational intelligence                
backstrom  c     nebel  b          complexity results for sas  planning  computational
intelligence                 
becker  a     geiger  d          a suciently fast algorithm for nding close to optimal
junction trees  in proceedings of the   th conference on uncertainty in articial
intelligence  uai   pp       
berwanger  d   dawar  a   hunter  p   kreutzer  s     obdzralek  j          the dag width
of directed graphs  journal of combinatorial theory  series b                  
betz  c     helmert  m          planning with h  in theory and practice  in proceedings
of the   nd annual german conference on articial intelligence  ki   pp      
   

fidomshlak   nazarenko

bodlaender  h  l          a linear time algorithm for nding tree decompositions of small
treewidth  siam journal of computing                   
bonet  b     gener  h          planning as heuristic search  articial intelligence        
        
bonet  b     helmert  m          strengthening landmark heuristics via hitting sets  in
proceedings of the   th european conference on articial intelligence  pp         
lisbon  portugal 
brafman  r  i     domshlak  c          factored planning  how  when  and when not 
in proceedings of the   th national conference on articial intelligence  aaai   pp 
        boston  ma 
brafman  r  i     domshlak  c          on the complexity of planning for agent teams and
its implications for single agent planning  articial intelligence            
bylander  t          the computational complexity of propositional strips planning 
articial intelligence                   
cai  d   homann  j     helmert  m          enhancing the context enhanced additive
heuristic with precedence constraints  in proceedings of the   th international conference on automated planning and scheduling  icaps   pp       
chen  h     gimenez  o          causal graphs and structurally restricted planning  journal of computer and system sciences                 
dechter  r          constraint processing  morgan kaufmann 
domshlak  c     dinitz  y          multi agent o line coordination  structure and complexity  in proceedings of sixth european conference on planning  ecp   pp         
downey  r  g     fellows  m  r          parameterized complexity  springer verlag  new
york 
edelkamp  s          planning with pattern databases  in proceedings of the european
conference on planning  ecp   pp       
fabre  e   jezequel  l   haslum  p     thiebaux  s          cost optimal factored planning 
promises and pitfalls  in proceedings of the international conference on automated
planning and scheduling  icaps   pp       
fikes  r  e     nilsson  n          strips  a new approach to the application of theorem
proving to problem solving  articial intelligence            
flum  j     grohe  m          parameterized complexity theory  springer verlag 
fox  m     long  d          stan   a hybrid planning strategy based on subproblem
abstraction  ai magazine               
fox  m     long  d          pddl     an extension to pddl for expressing temporal
planning problems  journal of articial intelligence research            
gimenez  o     jonsson  a       a   the inuence of k dependence on the complexity of
planning  in proceedings of the   th international conference on automated planning
and scheduling  icaps   pp         
   

fithe complexity of optimal monotonic planning

gimenez  o     jonsson  a       b   planning over chain causal graphs for variables with
domains of size   is np hard  journal of articial intelligence research             
halin  r          s functions for graphs  journal of geometry            
helmert  m          a planning heuristic based on causal graph analysis  in proceedings
of the fourteenth international conference on automated planning and scheduling
 icaps   pp         
helmert  m          the fast downward planning system  journal of articial intelligence
research             
helmert  m          concise nite domain representations for pddl planning tasks  articial intelligence              
helmert  m     domshlak  c          landmarks  critical paths and abstractions  whats
the dierence anyway   in proceedings of the   th international conference on automated planning and scheduling  icaps   pp         
helmert  m     gener  h          unifying the causal graph and additive heuristics  in proceedings of the   th international conference on automated planning and scheduling
 icaps   pp         
helmert  m   haslum  p     homann  j          flexible abstraction heuristics for optimal
sequential planning  in proceedings of the   th international conference on automated
planning and scheduling  icaps   pp         
helmert  m     mattmuller  r          accuracy of admissible heuristic functions in selected planning domains  in proceedings of the   rd aaai conference on articial
intelligence  pp         
homann  j          when ignoring delete lists works  local search topology in planning
benchmarks  journal of articial intelligence research             
homann  j          analyzing search topology without running any search  on the connection between causal graphs and h    journal of articial intelligence research     
       
homann  j     nebel  b          the ff planning system  fast plan generation through
heuristic search  journal of articial intelligence research             
hunter  p     kreutzer  s          digraph measures  kelly decompositions  games  and
orderings  theoretical computer science                  
johnson  t   robertson  n   seymour  p  d     thomas  r          directed tree width 
journal of combinatorial theory  series b                 
jonsson  p     backstrom  c          state variable planning under structural restrictions 
algorithms and complexity  articial intelligence                   
karp  r          reducibility among combinatorial problems  in complexity of computer
computations  pp         plenum press  new york 
katz  m     domshlak  c          new islands of tractability of cost optimal planning 
journal of articial intelligence research             
   

fidomshlak   nazarenko

katz  m     domshlak  c          implicit abstraction heuristics  journal of articial
intelligence research            
katz  m     homann  j          red black relaxed plan heuristics reloaded  in proceedings
of the  th annual symposium on combinatorial search  socs   pp         
katz  m   homann  j     domshlak  c       a   red black relaxed plan heuristics  in
proceedings of the   th aaai conference on articial intelligence  aaai   pp     
    
katz  m   homann  j     domshlak  c       b   who said we need to relax all variables   in proceedings of the   rd international conference on automated planning
and scheduling  icaps   pp         
katz  m     keyder  e          structural patterns beyond forks  extending the complexity
boundaries of classical planning  in proceedings of the   th aaai conference on
articial intelligence  aaai   pp           
keyder  e     gener  h       a   heuristics for planning with action costs revisited  in
proceedings of the   th european conference on articial intelligence  ecai   pp 
       
keyder  e     gener  h       b   heuristics for planning with action costs revisited  in
proceedings of the   th european conference on articial intelligence  pp         
markov  i  l     shi  y          constant degree graph expansions that preserve treewidth 
algorithmica             
mcdermott  d  v          using regression match graphs to control search in planning 
articial intelligence                    
nissim  r     brafman  r  i          multi agent a for parallel and distributed systems 
in proceedings of the   th international conference on autonomous agents and multiagent systems  aamas   pp           
nissim  r   brafman  r  i     domshlak  c          a general  fully distributed multiagent planning algorithm  in proceedings of the  th international conference on
autonomous agents and multiagent systems  aamas   pp           
pednault  e          adl  exploring the middle ground between strips and the situation calculus  in proceedings of the  st international conference on principles of
knowledge representation and reasoning  pp         
robertson  n     seymour  p  d          graph minors iii  planar tree width  journal of
combinatorial theory           
robertson  n     seymour  p  d          graph minors x  obstructions to tree decomposition  journal of combinatorial theory  series b                 
seipp  j     helmert  m          fluent merging for classical planning problems  in proceedings of the icaps      workshop on knowledge engineering for planning and
scheduling  keps   pp       

   

fi