journal of artificial intelligence research                  

submitted       published     

demand side energy management via multiagent coordination in
consumer cooperatives
andreas veit

andreas   cs   cornell   edu

department of computer science
cornell university
ithaca  ny       usa

ying xu
ronghuo zheng

yingx    andrew  cmu   edu
ronghuoz   andrew  cmu   edu

tepper school of business
carnegie mellon university
     forbes avenue
pittsburgh  pa       usa

nilanjan chakraborty

nilanjan   chakraborty   stonybrook   edu

department of mechanical engineering
stony brook university
stony brook  ny       usa

katia sycara

katia   cs   cmu   edu

robotics institute  school of computer science
carnegie mellon university
     forbes avenue
pittsburgh  pa       usa

abstract

a key challenge in creating a sustainable and energy efficient society is to make consumer
demand adaptive to the supply of energy  especially to the renewable supply  in this article  we
propose a partially centralized organization of consumers  or agents   namely  a consumer cooperative that purchases electricity from the market  in the cooperative  a central coordinator buys the
electricity for the whole group  the technical challenge is that consumers make their own demand
decisions  based on their private demand constraints and preferences  which they do not share with
the coordinator or other agents  we propose a novel multiagent coordination algorithm  to shape
the energy demand of the cooperative  to coordinate individual consumers under incomplete information  the coordinator determines virtual price signals that it sends to the consumers to induce
them to shift their demands when required  we prove that this algorithm converges to the central optimal solution and minimizes the electric energy cost of the cooperative  additionally  we
present results on the time complexity of the iterative algorithm and its implications for agents
incentive compatibility  furthermore  we perform simulations based on real world consumption
data to  a  characterize the convergence properties of our algorithm and  b  understand the effect
of differing demand characteristics of participants as well as of different price functions on the cost
reduction  the results show that the convergence time scales linearly with the agent population
size and length of the optimization horizon  finally  we observe that as participants flexibility of
shifting their demands increases  cost reduction increases and that the cost reduction is not sensitive
to variation in consumption patterns of the consumers 
     ai access foundation  all rights reserved 

fiv eit  x u   z heng   c hakraborty    s ycara

   introduction
two key issues in creating a sustainable and energy efficient society are to increase the penetration
of renewable sources  and to manage supply and demand so as to reduce demand peaks while
maintaining supply and demand balance  one way  which is most commonly used  to achieve
the demand supply balance is to supply all the requested demand whenever it occurs  however 
attempting to achieve demand supply balance by adjusting only the supply side leads to the use
of flexible  usually diesel operated  power plants that can be expensive  inefficient  and emit large
amount of carbon  an alternative to adjusting the supply side only  is to also adjust the demand
of the consumers  palensky   dietrich        via demand response programs  demand response
is defined as the changes in electricity consumption by end users from their normal consumption
patterns in response to changes in the price of electricity over time  albadi   el saadany        
several different forms of demand response programs have been developed  for an overview
see albadi   el saadany         a typical example of an incentive based program  where customers receive payment for their participation  are direct load control programs  where utilities
remotely control the power consumption of consumers appliances by switching them on off  in
small scale pilot studies  direct load control has been successful in reducing peak energy consumption  however consumers were uncomfortable with yielding control of their appliances to utility
companies  rahimi   ipakchi        medina  muller    roytelman         another type of demand management program is price based  where energy rates are variable and follow the real cost
of electricity  the objective of this indirect method is to control the overall demand by incentivizing consumers to flatten the demand curve through shifting energy from peak to off peak times 
a typical example of these programs is time of use pricing  where the price during peak times
is higher than the price during off peak times  recent technological advances in smart meters and
smart appliances have created the potential to enable direct and real time participation of individual
consumers in the energy market and thus make real time price based demand management programs
a reality  however  there are two key problems in realizing this potential  first  despite the presence
of small pilot programs  utilities consider individual consumers of insufficient size to be considered
for demand response services  second  if consumers participate in the market directly  rather than
through the utilities  the stability of the system may be compromised  e g   herding   ramchurn 
vytelingum  rogers    jennings         considering these challenges  mohsenian rad  wong 
jatskevich  schober  and leon garcia        argue that a good demand side management program
should focus on controlling the aggregate demand  which is also important for economic load dispatching  wood   wollenberg        of a group of consumers instead of individual consumers 
in this paper  the problem of coordinating a group of consumers called consumer cooperative is
introduced and studied 
a consumer cooperative  or collective  allows partial centralization of consumers represented
by a group coordinator  mediator  agent  who purchases electricity from utilities or the market on
their behalf  such consumer configurations can potentially increase energy efficiency via aggregation of demand to reduce peak power demand  the coordinator is neither a market maker nor a
traditional demand response aggregator  jellings   chamberlin         since it does not set energy
prices or aims to incur profits by selling to the market  rather  its role is akin to a social planners  in
the sense that it manages the demand of its associated consumer group so that  a  the electricity cost
to the group is minimized  and  b  individual group members autonomously and in a decentralized
manner decide how to shift demands  while maintaining privacy of individual demand preferences
and constraints  the members of such a cooperative are typically geographically co located in close
proximity to one another  for example a small neighborhood of households and or enterprises  in
practice  close proximity is required due to limitations in the distribution infrastructure  geograph   

fim ultiagent c oordination for d emand s ide e nergy m anagement

ically separated system operators  markets  and electricity suppliers  the proposed coordination
algorithm could also benefit already existing structures such as universities  malls  industrial parks 
commercial estates  and large residential complexes  although such organizations may already purchase electricity in a centralized manner  their constituent members  e g  firms in an industrial park 
are not currently coordinated so as to keep their constraints private 
consumer cooperatives offer advantages to both energy utility companies and consumers  from
a utility companys perspective  the consumer groups are large enough to be useful in demand response programs and have more predictable demand shifts compared to individual consumers  barbose  goldman  and neenan        give a survey of utility experience with price based programs
and conclude that most participants were large industrial customers  for individual consumers  participation in such energy groups allows them to retain control of their own appliances  in addition 
the consumers can obtain electricity at better prices than they would have  if they had purchased
electricity individually  the price advantage is due to three reasons  first  the groups size allows
the group to enter into more flexible purchase contracts  so that the price paid by the consumers
reflects the actual cost of production more accurately  this is not the case in current long term fixed
contract structures  kirschen         second  by buying collectively  the group can benefit from
volume discounts analogous to group insurance programs  third  in negotiated electricity contracts 
the price usually consists of two components  one reflecting the actual energy production cost and
the other as a premium against volatility in the energy demand and or supply  buying as a group
can help reduce the premium against volatility  provided that the demands of the group members
are coordinated  making their total demand more stable 
our aim in this paper is to design effective schemes for coordinating the electricity demand of
agents who are purchasing electricity as a consumer cooperative  the technical challenge of this
endeavor is the fact that the central coordinator does not know the constraints of the individual
consumers  and thus cannot compute the optimal demand schedule on its own  furthermore  the
actual cost of electricity consumption depends on the aggregate consumption profile of all agents 
however  the agents may not want to share their demand patterns or constraints with other agents or
the coordinator  therefore  we present an algorithm designed to enable the central agent to coordinate the consumers to achieve the optimal centralized load  while the individual agents decide their
demand shifting autonomously and retain their private knowledge about their demand constraints  
the papers contributions are as follows  first  we present an iterative coordination algorithm
to minimize the energy cost of a consumer cooperative that preserves the privacy of individual
demand constraints and costs of the consumers  second  we prove that the algorithm converges to
the centralized optimal solution and provide computational complexity results  third  we provide
formal arguments on the incentive compatibility of the coordination scheme  fourth  we present and
discuss extensive simulation results based on real world data  a preliminary version of this work
appeared in the work of veit  xu  zheng  chakraborty  and sycara        
this paper is organized as follows  in section   we give an overview of the related work and
point out the differences to the approach in this paper  in section   we formulate the cost optimization problem of the consumer cooperative  then  in section   we introduce the demand scheduling
algorithms for the consumer cooperative  in particular  in section     we introduce the basic iterative algorithm and in section     we prove its convergence to the optimal solution  in section   
we introduce the general iterative algorithm and in section     we prove its convergence in general
   this problem has some surface resemblance to problems where a centralized coordinator determines resource allocations for agents with private preferences  which the coordinator tries to elicit  such problems are typically addressed
via vickrey clark groves mechanisms  our problem differs from those in fundamental ways that will be discussed
in the related work section 

   

fiv eit  x u   z heng   c hakraborty    s ycara

settings  in section      we provide complexity analysis of the algorithms convergence and in section     we provide formal arguments on the incentive compatibility of the consumers  in section  
we evaluate the coordination algorithms using simulations based on real world consumption data 
finally  in section    we summarize the main contributions of this paper and offer a perspective on
future work 

   related work
as mentioned in the introduction  the demand response programs vary from classical direct load
control to price based programs with real time prices  in this paper  we introduce an algorithm
that uses variable price signals to coordinate the energy consumption of a consumer cooperative 
therefore  we restrict this discussion to demand management using variable price signals 
current literature on price based demand shaping mostly operates under the assumption that
it is desirable to have an automated or autonomous system  e g  smart meter  that receives price
signals and uses them to help a consumer schedule its demand so as to minimize its electricity cost 
while satisfying its demand preferences and constraints  there are two types of price signals that
can be used  dynamic and deterministic prices  most literature on price based demand response
programs considers the case of deterministic prices  in which the electricity prices of all time slots
are known before consumption  this case applies to all long term contracts and day ahead markets 
if the planning horizon is sufficiently short  see vytelingum  ramchurn  rogers    jennings       
ramchurn  vytelingum  rogers    jennings         with known electricity prices  consumers can
compute their consumption schedule ahead of time  e g   a daily consumption plan  or an annual
production plan  our paper falls in this category of demand scheduling under deterministic prices 
the approaches for demand scheduling proposed in the literature differ in some important characteristics  first  they differ in the level at which the problem is studied and secondly they differ in
the objective of the demand scheduling  the different levels at which the problem has been studied include the level of the single consumer  the market maker  or the grid operator  the different
objectives include minimizing the cost of a single consumer  minimizing the total cost of power
generation  reducing the peak to average ratio in demand  and optimizing grid stability  there are
only a few papers studying the demand scheduling problem at the level of grid operators  where
the major concern is grid stability  in particular  objectives include the minimization of power
flow fluctuations  tanaka et al          and the minimization of power losses and voltage deviations  clement nyns  haesen    driesen        
most work on demand scheduling is done at the level of the consumers  an important characteristic of this regime is that the electricity prices are often exogenously fixed and not influenced by
the demand scheduling  i e   the consumer is a price taker  almost all papers in this regime focus on
the  micro  demand scheduling of one or multiple appliances in a single residential household or a
commercial building  with the typical objective to minimize the incurred electricity cost  for example  chu and jong        study air conditioning load control  pedrasa  spooner  and macgill       
optimize the operation schedule of various distributed energy resources including space heater and
pool pump  etc  there are other papers studying the problem from different perspectives  for example  philpott and pettersen        and samadi  mohsenian rad  wong  and schober        address
the challenge of the uncertainty in the loads of the consumers energy consumption  this stream
of research is close to our work  since we as well study the demand management at the level of
consumers  however  instead of studying a single consumer  we consider a group of consumers in a
consumer cooperative  who buys the electricity from a utility company under a known price scheme 
our work differs from the above literature in the following aspects  size of shift  system stability 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

indirect control  and  most crucially  information privacy  first  while all the above literature only
considers the control of a single consumer  in practice  it may be difficult for utility companies
or grid operators to deal with individual consumers in such demand response programs  the demand shift of an individual consumer might be too small in magnitude compared to the aggregated
necessary shift  thus  it is unclear whether such a scheme will induce a shift of sufficient size  in
contrast  from the utilitys perspective  the consumer cooperative studied in our work is large enough
to be useful in demand response programs  second  most of the above literature assumes that the
consumers can participate in the markets directly  however  there have been concerns voiced that 
without control by the utility companies  the stability of the system may be compromised with such
uncontrolled distributed interactions  kirschen         in contrast  the demands of consumers in
our consumer cooperative are coordinated by a central coordinator to minimize the electricity procurement cost of the cooperative  buying as a group helps to reduce the demand volatility  and
the coordinated demand management can achieve higher stability of demand and reduce demand
peaks  third  the common assumption in the above literature is that the demand manager has direct
control over the appliances in the household and perfect knowledge about their loads and operation
constraints  however  in our cooperative  the coordinator lacks such control on demand scheduling
for individual consumers  moreover  the demand constraints and preferences are private knowledge
to the individual consumer and not known either to the coordinator or other consumers 
another stream of research related to our work is the demand scheduling at the level of the market maker  in contrast to the previous approaches  in this regime  the coordinator  i e   the market
maker  can set the electricity prices for consumers  and often use the price lever to influence the
demand of a number of consumers  the studies in this stream can be categorized into two groups 
centralized and decentralized  dietrich  latorre  olmos  and ramos        compare demand response programs in an electric system with high wind penetration under two different settings  i e  
centralized vs  decentralized  and show that the centralized approach often reaches higher overall
cost savings  but has the disadvantage that central knowledge of consumers constraints and preferences is necessary  our partially decentralized approach avoids this limitation and keeps consumers
constraints and preferences private while also achieving proven optimality of the solution 
when the coordinator uses prices to incentivize consumers to shift demand  the coordinator
needs to pay close attention to the possibility of a herding phenomenon  whereby agents move their
demand towards the low price times simultaneously and thus cause a spike in demand and bring
instability to the system  to address this issue  in addition to a price signal  some papers adopt
auxiliary methods to make agents gradually change their loads  voice  vytelingum  ramchurn 
rogers  and jennings        charge agents an additional fee based on how much they change their
demand profile from one period to the next  ramchurn et al         introduce an adaptive mechanism controlling the rate and frequency at which the agents are allowed to adapt their loads and to
readjust their demand profile  vytelingum et al         introduce a compensation signal that is sent
to the agents  providing an estimate of how much they should aim to change their behavior  these
approaches may perform well  but  unlike our work  they do not provide any formal guarantees that
their proposed algorithms will converge to the optimal solution  moreover  these approaches require
that the coordinator be a market maker who can charge consumers arbitrarily  e g   by imposing additional fees  a feature that may not be implementable and acceptable in practice  in contrast  our
coordinator is akin to a social planner who must ensure that the total charge for the energy demand
of agents should equal the actual amount to be paid to the energy supplier 
other papers address the decentralized demand side management problem from a game theoretic perspective  they mainly focus on deriving a charging mechanism that can make all consumers
reach a stable demand equilibrium  which achieves a central objective  these papers often share an
   

fiv eit  x u   z heng   c hakraborty    s ycara

underlying assumption that an individual consumers unit electricity cost increases in other consumers aggregate consumption  this assumption holds under the setting that the energy cost in each
period increases with the difference between demand and supply  wu  mohsenian rad    huang 
      or with the peak to average ratio  mohsenian rad et al         nguyen  song    han 
       or the unit market price per period increases with the aggregate demand  vytelingum  voice 
ramchurn  rogers    jennings        atzeni  ordonez  scutari  palomar    fonollosa         in
the work of mohsenian rad et al          a nash equilibrium of demand achieves optimality via a
designed billing strategy under which individual cost is proportional to the total energy cost  however  under this billing strategy  a consumer must have an estimate of other consumers demand
before making its own decision  therefore  to implement the proposed algorithms  the consumers
needs to coordinate in an iterative manner and exchange their demand profiles with each other in
each iteration  which may cause invasions of the consumers privacy  in other works of wu et al 
        nguyen et al          vytelingum et al         and atzeni et al          individual consumers dont need to interact with each other  but only communicate with the central coordinator 
in these papers  the coordinator maintains the equilibrium by designing the unit price  based on the
aggregate demand  the algorithm is often implemented in a distributed and iterative scheme  in
each iteration the agents report their loads to the coordinator and the coordinator updates the price
accordingly  although these papers ensure a minimum information exchange  none of them has
theoretically proven that their algorithms would converge to the centralized optimal solution  in
contrast  our paper not only safeguards the privacy of consumers  but also proves that the algorithm
converges to the centralized optimal solution 
our problem has surface resemblance to problems  where a central coordinator determines resource allocations for agents with private preferences  which the coordinator tries to elicit  such
problems are typically addressed via vickrey clark groves mechanisms  the reason for not considering vcg type mechanisms for our problem is that one of the key requirements of our application is that the coordinator has to pay the supplier for the groups electricity demand at the prices
given by the supplier  thus  the revenue  namely the sum of the payments individual agents make
should equal the actual amount to be paid to the supplier  in other words  in the jargon of mechanism design  budget balance is a key requirement for our problem  it is well documented in the
literature that vcg type mechanisms do not guarantee budget balance  green   laffont       
hurwicz         and it is impossible to design a mechanism that achieves all the three properties 
namely  efficiency  budget balance and strategy proofness  for our problem  in addition to budget
balance  allocation efficiency is also a desired social goal  our algorithm achieves both budget balance  lemma    and allocation efficiency  theorem     although the algorithm cannot guarantee
strategy proofness  due to the impossibility results  we prove that no manipulation strategy exists
that dominates truth reporting  theorem    

   problem formulation
in our model  the consumer group consists of n members with the planning period divided into
m discrete time slots  the number of discrete time slots depends on the market price structure 
which can differ depending on the utility companies  for example  m     for time of use pricing
with different prices during day and night  whereas m      for hourly time of use pricing  let
r be an n  m matrix where each row of the matrix  ri is the electricity demand of the agent i 
   in fact  as has been shown by ausubel and milgrom         in the context of broadcast spectrum allocation  the
revenue obtained from vcg type mechanisms can even be zero  in our case  this would mean the agents would not
pay any money to the coordinator  making it impossible to pay the supplier 

   

fim ultiagent c oordination for d emand s ide e nergy m anagement

  

twolevel threshold rate

  
  

high load

  

 

low load

 
 
 
 
 

high load
 price        cents kwh 

  
  
  
  

threshold hj

total cost

marginal price pm
 j 
j

  

 

twolevel threshold rate

  

 dollars 

 cents kwh 

  

 

low load
 price      cents kwh 

threshold hj

 
 
 

  

   

aggregated demand j

   

 
 

   

 kwh 

 a  marginal electricity prices 

  

   

aggregated demand j

   

   

 kwh 

 b  total electricity cost 

figure    sample two level increasing threshold pricing model as used by bc hydro
i                 n    we call ri the demand profile of agent i  each entry rij is the electricity demand
p
of agent i for time slot j  the total aggregated demand in time slot j is j   n
i   rij   the average
market price of a unit of electricity for the consumer group at time slot j is defined as pj  j   
we assume a typical market price function  where the prices are different in each time slot and
the price has a threshold structure  this means that the marginal electricity prices differ among different demand levels  for each time slot  every unit of electricity consumed below a specified price
threshold is charged at a lower price  while any additional unit exceeding that threshold is charged
at a higher price  thus  the marginal electricity price in a time slot  denoted by pm
j  j    is a nondecreasing function of the total demand  the marginal price at a given demand level is the payment
increment  decrement  for adding  reducing  one unit of electricity  figure  a shows an example of
a two level increasing threshold pricing model adopted from bc hydro   the marginal price of a
ph
j   hj
j
two level threshold structure can formally be written as follows  pm
 
 
 
with
j
j
l
p j  j  hj
l
 
ph
j   pj   where hj is the price threshold in time slot j  let x denote the positive value of a term
x  i e   x    max     x   and x denote the negative value respectively  i e   x   min     x   the
total energy cost for time slot j is thus the integral of the marginal prices  figure  b shows the total
electricity cost for the aggregated demand based on the two level threshold pricing model  the total
electricity cost can be computed as 
 

l
l
pj  j   j   ph
j  j  hj     pj  j  hj     pj hj

   

the demand profile of each agent ri must satisfy its individual constraints  the overall demand
consists of two types of loads  shiftable loads and non shiftable loads  mohsenian rad et al         
mohsenian rad and leon garcia        and wu et al         model the demand constraints of
shiftable and non shiftable loads  an example for non shiftable loads is typically a refrigerator and
   bc hydro is a canadian utility company  this pricing model is obtained from www bchydro com 

   

fiv eit  x u   z heng   c hakraborty    s ycara

shiftable loads include dishwasher  electric vehicles  washer dryer  etc  the appliances are modeled
by a total demand that is required over the course of the planning horizon  upper and lower bounds
on the demand in each time slot as well as earliest start and latest end times  these constraints form
a convex set  for our problem  p
we also assume that the total demand of each agent during the whole
planning period is fixed  i e   m
j   rij   i   where i is the total demand for agent i  further 
we also consider loads  where the demand constraints form a convex set and denote it as xi   this
constraint set is private knowledge and an agent does not share it  neither with other firms nor with
the coordinator  in some application scenarios  when an agent determines its energy demand profile 
it has to consider additional costs associated with the demand schedule  for example  in any given
factory the energy is most commonly used for production  changing the energy demand schedule 
therefore  may mean changing the production process and  thereby  the production cost  for agent i 
this cost is denoted by gi  ri    we assume this cost function to be convex  the overall cost function
p
of each agent is then m
j   pj  j   rij   gi  ri   
with the objective to minimize the sum of all agents costs  the overall energy allocation problem can be written as 
p
pn pm
pj  j  rij   n
min c  r    
i   gi  ri  
i  
j  
pm
   
s t  ri  xi   j   rij   i  
where the energy allocations rij are the optimization variables and r is the matrix of the demand
profiles of all the agents  note that the above problem is defined on a convex
xi   although the
p setp
m
objective function is non linear  it is convex because of the following  first  n
j   pj  j   rij  
i  
pm
j   pj  j   j is convex and non decreasing in j as indicated by equation    together with
pm
pn
j  
j   pj  j   j is convex in rij   i  j   boyd   vandeni   rij   we can conclude that
berghe         since gi  ri   is also convex  the total cost function c  r  is a summation of convex
functions and so also convex  thus  problem   is a convex minimization problem 

   solution approach
although the problem   is a convex optimization problem  since the constraints and preferences of
the agents are private knowledge  the optimal demand profiles cannot be computed directly by the
central coordinator  the objective function  although a sum of the individual costs of each agent 
is coupled  because the price of electricity in any time slot j depends on the aggregated demand
of all agents j   however  since the constraints in problem   are agent specific  they are naturally
separable  therefore  a primal decomposition approach  bertsekas   tsitsiklis        is used to
solve the problem in which the sub problems correspond to each agent optimizing its own energy
cost subject to its individual constraints  the central coordinator has to compute the appropriate
information to be sent to the agents so as to guide the demand pattern towards time slots with lower
prices  this corresponds to the master problem in primal decomposition methods  
since the agents know the electricity market prices  they individually optimize their demand
according to those prices  let the resulting demand profile be called the uncoordinated demand
profile  figure  a depicts such an aggregated uncoordinated demand profile in a setting with three
time slots  it can be seen that the aggregated demand in time slot   is above the threshold      h   
and the aggregated demand in time slots   and   is below      h        h    thus  a shift of
demand from time slot   to the other time slots would reduce the total cost for the group  however 
since the agents dont know the demand of the other agents  they cannot shift their demand  an
intuitive solution approach  for the coordinator  to coordinate the demand would be to inform the
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

 
   

threshold
h 

high price
low price 
 

h 

 

 

 
   
 

h 
 

 

 

   

h 

 

high price

threshold
 
h 

   

 

 
   

 

 

time slot j

 

 

aggregated demand

   

h 

low price

 c  coordinated scenario

 

aggregated demand

   

 

 
   

 b  herding scenario

 

 
aggregated demand j

aggregated demand j

aggregated demand

aggregated demand j

 a  initial scenario

 
   

threshold

 

 

   
 
   

high price
h
low price   
 

h 
 

h 

 
   

 

 

time slot j

 

 

 

 

time slot j

 

figure    a comparison of demand profiles in uncoordinated  herding and coordinated scenarios 
agents about the aggregated demand in each time slot  knowing the market price  the agents could
then solve their individual optimization problems  this approach is problematic  because the agents
dont know the demand constraints and preferences of the other agents in the group  while their costs
strongly depend on the demand of the other agents  for example  all agents knowing the market
price and the current aggregated demand could shift as much demand as possible to a supposedly
cheap time slot  this would lead to load synchronization  herding phenomenon  where all agents
shift demand to the supposedly cheap time slot  resulting in a new demand peak in that time slot
and thus increasing the total cost  the effect of this herding phenomenon is shown in figure  b 
where too much demand was shifted from time slot   resulting in demand above the threshold in
time slots   and    thus  the key challenge is to design the information that the coordinator sends
to the agents  the virtual price signal  to enable the system to minimize the overall cost 
a virtual price signal is not the final price the agents have to pay  but information about what
they would have to pay  given the current aggregated demand  the virtual price signal enables the
agents to foresee the possible price increment reduction caused by their demand shifting  therefore  the virtual price signal for agent i in time slot j  svij  rij  r   is a function of the variable rij  
denoting the new demand of agent i in time slot j  the price signal is computed based on the previous aggregate demand profile r  which is therefore included in the price function  for ease of
readability  time is not made explicit in this notation and will only be used in the proofs  the superscript v indicates the virtual price  in contrast to the real market prices pj  j    to design the virtual
price signal  the coordinator first computes the amount of demand that should be ideally shifted in
each time slot  as shown in figure   a   this amount  denoted by j   j            is the difference
between the total aggregated demand and the price threshold in each time slot  for readability  we
will refer to j as delta increment  noting that the delta could have negative values  i e   it could
be a decrement  to avoid herding  the delta increment needs to be divided among the agents and a
threshold price signal needs to be designed for each agent  so that the price below the threshold is
lower than the price above the threshold  this serves to penalize the total demand in a time slot going above the threshold  thus  the agents know the maximum amount of demand they could shift at
what prices and can solve their individual optimization problem  the exact calculation of the price
signal svij  rij  r  is shown in section        given the price signal  the virtual cost optimization
problem each agent solves is
p
v
min cvi  ri  r     min m
j   sij  rij  r  rij   gi  ri  
p
   
m
s t  ri  xi   j   rij   i  
note that this problem  like the overall problem  is a convex optimization problem and thus solvable  however  because of their individual constraints and cost functions  some agents might not be
able to shift as much demand as was assigned to them by means of the virtual price signal  this
   

fiv eit  x u   z heng   c hakraborty    s ycara

implies that the aggregated demand shift can be less than the amount that could have been achieved 
figure  c shows this case  where the total demand in the second time slot remains above the threshold  because not the whole   could be shifted  in order to shift the remaining demand  another
price signal  dividing the remaining amount  would be necessary  this motivates us to design an
iterative algorithm for the coordinator to update the virtual price signal based on the consumers
feedback and thus gradually adjust the individual demands to the central optimal solution 
    basic coordination algorithm
we present the basic coordination algorithm and the details of the virtual price signal design for the
energy allocation in the setting with a planning horizon of only two time slots  m      and no cost
for shifting demand  g        although called basic setting in this paper  this setting has practical
relevance  because it represents the commonly used time of use pricing schemes that divide the
planning horizon in two time slots  albadi   el saadany         one time slot with typically high
load has high prices and one time slot with typically low load has low prices for electricity 
      overview of a lgorithm
recall that ri denotes the demand profile of agent i and that r is the matrix of the demand profiles
of all agents  let r i be the updated demand profile of agent i after an iteration and r  be the new
demand profile of all agents 
initialization  each agent computes an initial uncoordinated electricity demand profile ri by
solving problem   based on the market prices and sends it to the coordinator 
   the coordinator adds up the individual demands to determine the aggregated demand j for
each time slot j and then calculates the delta increment j of demand to be shifted in or out
of each time slot  finally  the coordinator divides that demand among all agents and computes
the virtual price signals svij  rij  r  for each agent i and time slot j 
   the coordinator sends the virtual price signals to all agents 
   after receiving the virtual price signal  each agent individually calculate its new demand
profiles r i according to the optimization problem   
   the agents send their new demand profiles back to the coordinator 
   the coordinator compares the new demand profiles to the old profiles  if no agent changed its
demand profile  i e   r   r    the coordinator stops the algorithm  otherwise  it sets r   r 
and goes to step     
      c oordination with v irtual p rice s ignal
the virtual price signal for one agent in one time slot is a threshold price function of the demand
in that time slot  the demand up to a specified threshold is charged at a low price and the demand
above the threshold is charged at a higher price  the virtual price signal is therefore parameterized
h
by the low marginal price  pl
j   the high marginal price  pj   and the price threshold  hij  r   that
specifies the demand levels at which the prices apply  the virtual price  svij   for agent i in time slot j
is computed based on these parameters as follows
  pl h  r  ph  r h  r  
ij
ij
j ij
j
rij   hij  r 
rij
svij  rij  r   
   
l
pj
rij  hij  r 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

aggregated demand before iteration

    

agent   demand r

 j

 

   

 
 

   

h 

 

 j

 

   

 

 

    
   
    

    

 

 

  

h  

 

r  

h  

  
 

 

time slot j

h 

   

r  

   
    

 

agent   demand r

aggregated demand j

 

agent   demand before local optimization

r  

   
    
 

h  

    
   
    

  

h  

  
r  

 

 

time slot j

agent   demand before local optimization

 

 

time slot j

figure    division of j among agents for the virtual price signal  the yellow demand belongs to
agent   and the red demand to agent    here   is the amount of demand that can be shifted into
time slot    while   indicates the amount of demand that needs to be shifted from time slot   

agent   demand after local optimization

   

r

    

h

 

   

  

  

    
   
    

 

h

  

r
  

 

 

 

time slot j

agent   demand after local optimization


 j

    

agent   demand r

aggregated demand after iteration

 

   
    
 
    
   

h  

r  

h  

aggregated demand j

agent   demand r


 j

    

r  

   

h 

 

   

 

h 
 

 

   

    
 

 

 

 

time slot j

 

time slot j

 

figure    demand after agents local optimization  agent   cannot reduce its entire demand from
time slot    i e   r     h      because of its own demand constraints  left top plot   thus  the
aggregated demand in time slot   is still below the threshold  i e        h     therefore  the central
coordinator again sends a modified price signal to the agents and the algorithm continues until
agents stop shifting their demands 

   

fiv eit  x u   z heng   c hakraborty    s ycara

l
v
although the prices ph
j and pj are derived from the market prices  sij is called a virtual price
signal  because the threshold hij  r  changes  if the agents change their demand profiles  the
coordinator chooses hij  r    rij to induce the agents to reduce demand or hij  r    rij to
increase demand in one time slot  with ij as the amount the coordinator wants agent i to change
demand in time slot j  the threshold hij  r  is updated based on the demand profiles submitted in
the last iteration 
hij  r    rij   ij
   

thus  the agents know that  at the current market price  they can at most change their demand
in time slot j by ij   for the demand exceeding hij  r   they need to pay a higher price  the
demand  j   the coordinator wants to change in time slot j is calculated as the difference between
the current aggregated demand and the threshold of the market price 
j   hj  j

   

since the coordinator
wants the total demand change of the agents to be less than j   it has to
p
ensure that i ij  j   the allowable shift for an agent is proportional to the agents share of
 r
the aggregated demand in that time slot  i e   ij   pj rijij   figure   shows how the total demand
i
change is divided among the agents in order to create the individual virtual price signals  the left
side shows the initial aggregated demand of two agents  the yellow demand belongs to agent   and
the red demand to agent    since the aggregated demand is below the threshold in time slot    i e  
    h    and above the threshold in time slot    i e       h     the coordinator wants the agents to
shift demand from time slot   to time slot    the amount of demand that can be shifted into time
slot   is     while   is the amount of demand that should to be shifted out of time slot    the right
side shows the individual thresholds of the agents as determined by the central coordinator using
the procedure described above  the allocation of the demand change to the agents is illustrated by
the dashed arrows  the current demand of agent   in time slot   is r   and its threshold for time slot
  is h    the other notations can be interpreted similarly  
      t he agent  s r esponse to the v irtual p rice s ignal
having received the virtual price signal  the agents will independently optimize their demand profiles in order to minimize their cost according to problem    the agents objective function cvi  ri  r 
p
v
  m
j   sij  rij  r  rij   gi  ri   can be written as 
cvi

 ri  r   

m
x



 

l
l
ph
j  rij  hij  r     pj  rij  hij  r     pj hij  r    gi  ri  

   

j  

since the agents have to pay the high price ph
j for demand exceeding their individual threshold 
no agent will shift too much demand  based on a false impression of possible cost reduction  figure   shows the agents demand profiles after their individual optimization  the left side shows the
individual problems of the agents  after they have optimized their demand profile  in comparison to
the right side in figure    it can be seen that agent   shifted the whole allocated amount  but agent  
only shifted some part of it  e g   due to its constraints   the right side in figure   shows the central
problem after the agents individual optimization  it can be seen that there is still demand left to be
shifted from time slot   to time slot    this remaining demand would again be divided among the
agents in the subsequent iteration 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

      payment rule
after the algorithm has converged  the agents have to pay the virtual unit price for their demand in
each time slot  in the last iteration the virtual unit price equals the average unit price for the aggregate demand of the whole cooperative  because no agent changed its demand profile  equation   
with r as final demand profiles of the whole cooperative and ri as final demand profile of agent i 
the payment for agent i is given as
paymenti  

m
x

svij  rij  r  rij

   

j  

    convergence of the basic algorithm
in this section we prove that the basic iterative procedure always converges to an optimal solution
l
in the basic setting with m      gi        and ph
j   pk   j  k  in lemma    we show that the
algorithm strictly reduces cost in every iteration  this fact will be used in theorem   to show that
the algorithm always converges  then  in theorem   we show that  when m      gi        and
l
ph
j   pk   j  k  the converged solution is an optimal solution  subsequently  we show that the
algorithm can get stuck in a suboptimal solution in general settings if m      lemma    or if
gi          lemma    
lemma    the algorithm strictly reduces the total cost in every iteration  c  r      c  r  
proof  lets first introduce some notation that will be used throughout this proof  let r be the total
demand profile at the end of iteration round t and r  be the total demand profile at the end of round
t      similarly  let c r  be the total cost at the end of iteration t and c r    be the total cost at
the end of iteration t      the virtual prices for round t     are computed by the central coordinator
using r  let cvi  ri  r  be the cost for agent i computed according to the virtual price signal for
demands at the beginning of round t     and cvi  r i  r  at the end of round t     
at the beginning of each iteration the total cost for the consumer group based on market prices
 given by the objective function in problem    equals the sum of the individual cost of the agents
p
v
based on the virtual price signals  given by problem     i e   n
i   ci  ri  r    c  r  
n x
m
x

svij

 rij  r  rij  

gi  ri  

i  

i   j  
n x
m
x

n
x

 



 
 hj  j   rij
p
 
rij  rij  
i rij
i   j  



 hj  j   rij
p
  pl
r

r
 
ij
ij
j
i rij

  x
n
 hj  j   rij
l
p
  pj rij  
 
gi  ri  
i rij
i  
 

ph
j

m h
n
i x
x
 

l
l
ph
 

h
 
 
p
 

h
 
 
p
h
 
gi  ri  
j
j
j
j
j
j
j
j
j  

 

   

n x
m
x
i   j  

i  

pj  j   rij  

n
x

gi  ri  

i  

   

fiv eit  x u   z heng   c hakraborty    s ycara

if the algorithm has not stopped  at least one agent has changed its demand profile  i e   i with
r i    ri   agents only change their demand profile  if that reduces their cost according to problem   
thus  given the virtual price  signal for agent i the cost of the new demand profile r i is strictly lower
than of its previous demand profile ri  

cvi r i  r   cvi  ri  r 
    
after all agents
submitted their new demand profile  the new aggregated demand is compn have
 
 
puted as  j   i   rij   next  we show that the sum of the agents individual cost according to the
virtual price signals is an upper bound on the total central cost at market prices  thus  the total cost 
based on the new aggregated demand  is lower or equal to the sum of the agents individual cost 
based on their new demand  this fact is very important  because it prevents the herding behavior 
no solution that reduces the cost for the agents individual problems can lead to a worse solution in
the central problem  this is proved by showing with equations   and   that for every time slot j the
difference between the central cost for the aggregated demand and the sum of the agents individual
cost is less than or equal to    the following is a sketch of the proof omitting some algebraic steps
for ease of readability  consult appendix a for the complete proof  for any time slot  j  we have
n
x

n
x
  
  
 
pj  j rij

svij rij
 r rij

i  

i  

 pn
 


 
rij
 hij  r   j
  

h
pl
rij  hij  r   j
j  pj
  
 i
l
ph

p
r

h
 r 
 
ij
j
j
ij
i


 
h
 
pl
rij
 hij  r 
 
j  pj

i  r   h
pn ij ij
   h
i  rij
ij

hp
n

i  
  hpn


i  

l
ph
j  pj



  hj
 hj

    

 j   hj
 j  hj


 
pn v   
  j  it also holds for the sum of all time slots 
 
 
since i   pj j rij  i   sij rij  r rij
p
v
 
c  r     n
i   ci  ri  r  
from equations       and    we can conclude that 
pn

n
n
 x
 x
c r  
cvi r i  r  
cvi  ri  r    c  r 
i  

    

i  

thus  the total cost is strictly reduced in each iteration 
theorem    the basic iterative algorithm for solving problem   always converges 
proof  from the definition we have that problem   is convex and a lower bound on the total cost can
be obtained by the sum of the individual initial demand profile costs at market prices  from lemma
  we have that the algorithm reduces the total cost in each iteration  thus  it can be concluded that
the algorithm converges 

p
pn v
n
lemma    the real market cost  n
i   pj i   rij rij   equals the virtual cost
i   sij  rij  r  rij
in a time slot j  if either i  rij  hij  r  or i  rij  hij  r  
proof  if i  rij  hij  r   then j  hj and from the first case in equation    follows the cost are
equal  if i  rij  hij  r   then j  hj and from the second case in equation    follows the cost
are equal 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

theorem    the solution r of the basic algorithm is optimal  in either of the following cases
a  j  r satisfies j    hj with no restrictions on m and gi   
b  r satisfies j  s t  j   hj and m      gi        and the high price in any time slot is
l
greater than the low price in any other time slot  i e   ph
j   pk   j  k
proof  we prove by contradiction that when the algorithm has converged to the solution r that
satisfies case a  there is no other solution r  with lower cost  suppose there exists such a solution
r    i e   c r      c r   we will show that this contradicts the convergence conditions of the
algorithm that i  ri is the solution of the agents individual problem  ri   arg minxi xi cvi  xi  r  
denote r       r       r              a linear combination of r and r    since the central
cost function is convex and c r      c r   we also have c r        c r   if j  r satisfies
j    hj   then for the demand in the beginning of the iteration rij we have j either i  rij   hij  r 
or i  rij   hij  r   because if j     then i  ij     and similarly if j     then i  ij     
 
 
it follows            s t  j  either i  rij
    hij  r  or i  rij
      hij  r  


pn
 
v
  c r       moreover  we have
therefore  by lemma   
i   ci ri     r
p
v
c r        c r  and from equation   we also have n
i   ci  ri  r    c r   it follows 
v
v
i  s t  cvi r 
i     r   ci  ri  r   which conflicts with ri   arg minxi xi ci  xi  r   i e   ri is
not the solution of the agents individual problem 
we prove by contradiction that when the algorithm has converged to the solution r that satisfies
case b  there is no other solution r  with lower cost  assume there exists a solution r  with
c r      c r   let the   time slots be  j  k   where  j   j and  k   k  without loss of
m
generality   note that pm
j  j     pk  k    because otherwise the new cost would not be lower  if
h
l
m
j   hj   k   hk then pm
j  j     pj  as j decreases  and pk  k     pk  as k increases  
l
m
m
from the market price structure we have ph
k   pj   it follows pj  j     pk  k    which leads to
m
l
h
a contradiction  if j    hj   k   hk and if j   hj then pj  j     pj and pm
k  k     pk thus
h
h
h
m
h
m
m
pm
j  j     pk  k    if j   hj then pj  j     pj and pk  k     pk   we have pk   pj   because
otherwise a shift from j to k would be beneficial for at least one agent and the algorithm would
m
not have stopped  it follows pm
j  j     pk  k    which again leads to a contradiction  the case of
j   hj   k    hk works similarly 
it follows that r is the optimal solution  as no solution with lower cost exists  thus  the proposed iterative algorithm converges to the optimal solution  since the problem is convex that solution is also the global optimal solution  boyd   vandenberghe        
lemma    the basic algorithm could converge to a suboptimal solution r in settings  where r
satisfies j  s t  j   hj   m     and gi        
proof  we now prove by presenting a counterexample that the basic algorithm can converge to a
suboptimal solution in settings  where r satisfies j  s t  j   hj   m     and gi         consider
a population of   agents  n      and a planning horizon of   time slots  m      the agents
constraints are in a form so that in the converged solution the aggregated demand is below the
threshold in one time slot  directly at the threshold in another time slot and in one time slot above
the threshold 
let the price function for the three time slots be given as 
h
l h
l h
 pl
    p              h         p    p              h         p    p              h       

   

fi 
 

p h  

p h  

p h  

p l  

p l  

p l  

 kwh 

  

demand agent  

demand agent  

 kwh 

v eit  x u   z heng   c hakraborty    s ycara

 
 
 

 

 

 

  
 
 
 
 
 

 

 kwh 

  
 
 
 
 
 

 

 

 

 

time slot

demand agent  

demand agent  

 kwh 

time slot

 

time slot

  
 
 
 
 
 

 

 

 

time slot

 b  optimal solution r 

 a  converged solution r t  

figure    converged and optimal solution for the example in lemma    the top row shows the
demand of agent   and the bottom row the demand of agent    the dashed lines indicate the upper
and lower bounds of the demands of the agents in a time slot  the solid black lines show the price
thresholds for each time slot 
the individual constraints on the agents demand are   a  upper and lower bounds on the demand
in each time slot and  b  constant total demand over all time slots  specifically 
r            r            r            r     r     r           
r            r            r            r     r     r           
let r t  denote the demand profile of the agents in the tth iteration and let t     be the initial
iteration and t   t be the final iteration at convergence  at the beginning the agents compute their
   
   
initial demand profiles based on the market
prices r               r               the cost based

on the initial demand profiles is c r          at convergence  the profiles of the two agents are
 t  

 t  

r               r               see figure  a for a graphical representation   the cost based on
these demand profiles is c r t         however  a different demand profile of the agents exists
with r                r                see figure  b for a graphical representation   this profile is
feasible and leads to lower total cost  i e   c  r          it follows that the algorithm has stopped in
a suboptimal solution 

lemma    the basic algorithm could converge to a suboptimal solution r in settings  where r
satisfies j  s t  j   hj   m     and gi         
proof  in appendix b a counterexample is presented  proving that the basic algorithm can converge
to a suboptimal solution in settings  where r satisfies j  s t  j   hj   m     and gi         
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

   general coordination algorithm
in the previous sections we introduced a basic iterative coordination algorithm for optimal energy
allocation in the basic setting with a planning horizon of only two time slots  m      and no cost
for shifting demand  g        moreover  we presented counter examples showing that  in general
settings with m     or g         the algorithm can get stuck in a suboptimal solution  in this
section  we present a general coordination algorithm for the energy allocation in general settings
with more than two time slots and non zero individual costs for shifting demand 
    the additional phase
the reason for convergence to a suboptimal solution is that the coordinator cannot determine the
agents marginal valuation for their demand  if the aggregated demand in some time slot is at a
threshold  the agents might have different marginal valuations  so that a shift from an agent with a
lower valuation to an agent with a higher valuation might be beneficial  however  this opportunity
for improvement cannot be realized  because the coordinator does not know the marginal valuations
of the agents 
we now introduce an additional phase to the algorithm to address this problem  when the basic
algorithm has converged  the coordinator checks whether the aggregated demand is at the threshold
for at least one time slot  if that is not the case  the algorithm stops and the solution is optimal 
however  if the demand is at the threshold in some time slot  the coordinator initiates another phase 
the basic idea is that  besides the virtual price signal  the coordinator sends an additional query
to the agents  requesting their valuations for an  increase and  decrease of threshold in the time
slots  where the aggregated demand is at the threshold  then  the coordinator uses this information
to adjust the virtual price signals 
 
let vij
denote the value for agent i of an  increase of its threshold in time slot j  let further
ij 
r
be the demand profile  where in the resulting price signal for agent
in time slot
 i the threshold

j 
v
ij 
ij 
be its virtual cost 
j is increased by   i e   hij  r     hij  r      moreover  let ci ri  r
where the threshold in time slot j is increased by  
definition    agent is marginal valuation for an  increase of the threshold in time slot j is the
difference in its virtual cost between the original virtual problem and the virtual problem with an
 increased threshold in time slot j  the valuation for an  decrease is defined analogously 







j

 
ij 
 
v
ij
vij
 r    cvi rj 
 r

c
r
 r
 
v
 r 
 
c
r
 r
 ci r i  r  
i
i
i
i
ij
i

    

when the agents receive their virtual price signal and the query for their marginal valuations 
they first compute their optimal demand profile r i   based on the price signal  second  they compute
 

their marginal valuations vij
 r  and vij
 r  for every time slot  with the aggregated demand at
 
the threshold  let the vector vi consist of the valuations for  increments and vi for decrements
respectively  finally  the agents send ri   vi  and vi back to the coordinator 
having received the agents information  the coordinator computes the virtual price signals for
the next iteration  if the aggregated demand is at thenthreshold 
it finds the agents with the lowest
o
 
cost for an  increase of the threshold  l   arg mini vij and the lowest cost for an  decrease of
n o


 
the threshold  k   arg mini vij
  if the combined cost is negative vkj
  vlj
     a beneficial shift
   

fiv eit  x u   z heng   c hakraborty    s ycara

from agent l to agent k exists  in that case  the coordinator updates the thresholds of agents l  k as
lj     kj    
the algorithm stops  if the demand is not at the threshold in any time slot or if for all time slots at

 
the thresholds no pair  l  k  exists with vkj
  vlj
     it follows  when the algorithm converges 
in every time slot with the aggregated demand at the threshold  j   hj   for all agents  the cost
reduction of an  increase of the threshold is less than the additional cost from a  decrease of the
threshold for all other agents  i e  
 

vlj
 vkj
  l  k           n   and j s t  j   hj  

    

otherwise  the coordinator would change the price signals and the algorithm would not stop 
    general algorithm
the general algorithm is designed as an iterative algorithm  where the coordinator updates the virtual
price signals based on the consumers feedback and thus gradually adjusts the individual demands
to the central optimal solution  the overall algorithm is shown in algorithm    each iteration
consists of two steps  first  the central coordinator aggregates the demand submitted by the agents
and computes virtual price signals for each agent  the virtual price signals are computed in the
subroutine calculatevirtualpricesignals  algorithm     second  the individual agents use the
virtual price signal to solve their individual cost optimization problem and compute their marginal
valuation for their electricity demand and report them to the coordinator  the agents response is
computed in calculatedemandprofileandvaluation  algorithm    
the general algorithm first only runs the basic algorithm until convergence and subsequently
performs the additional phase  if necessary  in particular  the additional phase is performed  if the basic algorithm has converged  algorithm   line    and in at least one time slot the aggregated demand
is not at the threshold  algorithm   line     the algorithm reaches the optimal solution when r  
 

r  and either j    hj   j or in the additional phase vlj
 vkj
  l  k           n    j s t  j   hj  
    convergence of the general algorithm to an  optimal solution
please note that theorem   still holds for the general algorithm  because the algorithm still reduces
the total cost in each iteration  thus  the extended algorithm converges  in theorem   we prove that
the solution of the general algorithm lies within an  neighborhood of the optimal solution 
theorem    the converged solution r of the general algorithm lies within an  neighborhood of the
optimal solution r   where  is the amount for which the agents compute their marginal valuations 
proof  we now prove by contradiction that when the general algorithm has converged to the solution r  then no other solution r  exists with lower cost with respect to the central problem  
outside of an  neighborhood around r  suppose there exists a solution r  having a lower total energy cost than r  i e   c r      c r   we will show that this contradicts the convergence
conditions of the general algorithm that i  ri is the solution of the agents individual problem 
 

ri   arg minxi xi cvi  xi  r   and that vlj
 vkj
  l  k           n   and j s t  j   hj  
the only case left from theorem   is that j  j   hj   which implies i  rij   hij  r  
and that
fi
fi
fi
    h  r  and k  k  r     h  r   where l  k s t  r    r fi 
l  k      s t  l  l  rlj
fi lj
lj
kj
lj fi
kj
fi
fi
fi  
fi
  firkj
 rkj fi    we will show that this case conflicts with the convergence conditions  too 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

algorithm    overall algorithm 
data  scenario with electricity contract and agent definitions 
result  optimal demand schedule r  
 
 
 
 

 
 

 
 
 
  
  
  
  
  
  
  
  
  
  
  
  

initialization  all agents compute an initial energy demand profile ri by solving problem  
based on the market prices and send it to the coordinator  
addp hase   f alse 
while demand schedule r is not optimal do
coordinator calculates the price signals using algorithm   
svij  rij  r    i  j  calculatevirtualpricesignals  ri   vi    vi   addp hase  
the coordinator sends the virtual price signals to all agents 
agents calculate demand profiles and valuations for all time slots  j  using algorithm   
i  r i   vi    vi  calculatedemandprofileandvaluation  svij  rij  r   addp hase  
the agents send their new demand profiles and valuations back to the coordinator 
if algorithm has converged  i e   r   r  then
if j    hj   j then
the demand schedule r  is optimal 
else
 

if addp hase and vlj
 vkj
  l  k           n    j s t  j   hj then
the demand schedule r  is optimal 
else
start additional phase  i e   addp hase   true 
end
end
else
r  r   
end
end

fi
fi
fi
fi  
    rlj fi  
we start with the case in which  l     k       then we have           s t  firlj
fi
fi
fi  
fi
firkj     rkj fi     moreover  denote r      s t  
  
rit


    

 
rit
   if i  l  k  t   j
rit
otherwise

a demand profile reflecting the changes in demand in time slot j so that in the resulting individ 
 
ual problems again all agents have their demand on the threshold  rlj
  hlj  r     and rkj
 
  
hkj  r    thus  with lemma   we get that the sum of the virtual cost is equal to the central cost 
n
x







 
 
v
v
  
  
cvi r 
  
 r
 
c
r
  
 r
  
 
c
r
  
 r
  
l
k
i
l
k

i   i  l k

 

c r        c r   

n
x

cvi  ri  r 

i  

   

fiv eit  x u   z heng   c hakraborty    s ycara

algorithm    calculation of the virtual price signal by the coordinator 
 

 
 
 

calculatevirtualpricesignals  ri   vi    vi   addp hase  
data  demand profiles and valuations of all agents  ri vi    vi   i 
result  virtual price signals for all agents  svij  rij  r    i  j 
p
compute the aggregated demand  j  n
i   rij  
compute demand to be shifted in each time slot  j  hj  j  
 r
divide that demand among all agents  ij  pj rijij  
i

 
 
 
 
 
  
  

if addp hase then
n
o
 

find time slot j and agents l  k s t  min vlj
 vkj
 
 

if vlj
  vkj
    then
adapt demand to be shifted for agent l  lj   and agent k  kj   
end
end
compute thresholds based on demands to be shifted  hij  rij   ij  

algorithm    calculation of the individual demand profiles and marginal valuation of energy
for agent i 
  calculatedemandprofileandvaluation  sv
ij  rij  r   addp hase  
data  virtual price signal svij  rij  r   j              m  
result  new demand profile r i and valuations vi    vi  
 
 
 
 
 
 
 

compute new demand profile r i according to virtual price signal 
ri   arg minxi xi cvi  xi  r  
if addp hase then
foreach time slot j at the threshold  rij   hij do



 
ij   cv  r   r  
compute valuation of increased threshold  vij
 cvi rj 
 r
i i
i


ij  cv  r   r  
compute valuation of decreased threshold  vij
 cvi rj
i i
i  r

end
end

which implies either
n
x



cvi r 
i     r  

i   i  l k



n
x

cvi  ri  r 

i   i  l k



v
i  s t  cvi r 
i     r   ci  ri  r 

which conflicts with the convergence condition ri   arg minxi xi cvi  xi  r  
or







 
v
  
  
cvl r 
  
 r
  
 
c
r
  
 r
  
  cvl  rl  r    cvk  rk  r 
k
l
k


h 

i
  
  
cvl r 
    cvl  rl  r     cvk r 
    cvk  rk  r 
l     r
k     r

   

fim ultiagent c oordination for d emand s ide e nergy m anagement

fi
fi




fi  
fi
      is equal to cv rj   rij 
for firkj
    rkj fi    we get that cvl r 
  
 r
and
l
l
l




      is equal to cv rj  rij   thus  with equation    follows
cvk r 
k
k     r
k
 

vlj
 r    vkj
 r 

 

which conflicts with the convergence condition  l  k              n    vlj
 r   vkj
 r  
for the general case of  l     k      we can get
n
x




 x
 x

  
  
  
    
cvk r 
cvl r 
cvi r 
i     r  
k     r
l     r

i   ilk
 

 

kk

ll

c r        c r   

n
x

cvi  ri  r 

i  

which implies either
n
x
i   ilk
 



i  s t  cvi

n
x



cvi r 
  
 r
 
i

cvi  ri  r 

i   ilk
 



r 
i



    r  

cvi

 ri  r 

which again conflicts with the convergence condition ri   arg minxi xi cvi  xi  r  
or
x


 x

 x
x
 
v
  
  
cvk  rk  r 
cvl r 
  
 r
  
 
c
r
  
 r
  
 
cvl  rl  r   
k
l
k

ll



x
ll

kk

cvl



ll

kk

 
 
 x

 x
x
  
  
r 
   
cvl  rl  r    
cvk r 
   
cvk  rk  r 
l     r
k     r
ll

kk

kk

since the amount of demand increased in time slot j is equal to the demand decreased  and the cost
decrease on the lhs is greater than the increase in cost on the rhs  there exists a pair of agents 
l  k such that the marginal cost decrease of l is larger than the marginal cost increase of k
 

 l  l  k  k  vlj
 r    vkj
 r 

 

which conflicts with the convergence condition  l  k              n    vlj
 r   vkj
 r  

the solution r lies within an  neighborhood of the optimal solution r   where  is the amount
for which the agents compute their marginal valuations  when no beneficial shift of the size greater
or equal to  exists any more  the algorithm stops  however  a beneficial shift smaller than  might
still exist 
    convergence time of the algorithm
in this section  we give an upper bound on the number of steps the algorithm needs to converge 
first  we give a bound for the basic algorithm in lemma   and the extended phase in lemma   
second  we give a bound for the general algorithm in theorem   
   

fiv eit  x u   z heng   c hakraborty    s ycara

lemma    the basic algorithm converges within a maximum of d log   n e steps  where n is the
number of agents and  is the distance of the converged solution to the optimal solution of the basic
algorithm 
proof  we prove this by showing an upper bound on the number of iterations needed in one time
slot  say  time slot j  to get from the initial demand level into the neighborhood of the optimal
demand level of the basic algorithm  this is sufficient  because when the demand in the last time
slot has reached its optimal level  the demand in all other time slots also reached their optimal level 
in this proof we will consider a time slot with its initial demand below the optimal demand  this
is sufficient  because every shift consists of a demand decrease in at least one time slot and also an
increase in at least one time slot  thus  when all time slots that were below their optimal demand
level  reached their optimal level  the remaining time slots also reached their optimal levels 
since all variables in this proof are for time slot j  we omit the subscript j for increased readability  let dt be the difference between the optimal aggregated demand and the aggregated demand
after iteration t  since the demand is assumed to be below the optimal demand  dt      without
loss of generality  assume the initial value of dt is    d       and the optimum is    for each
agent i  its initial demand rij      the worst case is that only one agent  e g   agent    can increase
its demand  in this case  only agent   can increase its demand in each iteration  and its increment
equals the amount of demand shift assigned by the coordinator 
we denote at as the increment of agent  s demand in iteration t and ct as agent  s demand
after iteration t  c        with n denoting the total number of agents  the demand shift assigned
 r
to agent i is given based on the definition of the price signal by ij   pnj ij   then  we have for
i   rij

agent  s increment

ct  dt 
 
    
n      ct 
agent  s demand after iteration t is its initial demand plus its increments in the first t iterations 
similarly  the difference dt is the initial difference minus agent  s increments 
at  

ct      

t
x

al   dt     

l  

t
x

al  at   ct  ct    dt   dt    ct      dt  

l  

by substituting the above into equation     we have
    dt    dt 
n      dt 
 
   dt   dt 
 n     dt 
 
n      dt 

dt   dt   
 
 n       dt   dt      dt dt   dt 

dt
since n     dt          we get



 n     dt 
n   n
dt  
 dt  
n
n


l
m
log 

thus        t   loglogn    log n
log n      s t   t   t   we have dt     moreover 
n

since logarithm is strictly increasing and concave  we have log n  log  n      
      t   d log   n e  s t   t   t   we have dt    
   

 
n 

thus 

fim ultiagent c oordination for d emand s ide e nergy m anagement

lemma    the extended phase converges at maximum within a number of
 

l

 c   c  
v

m

steps  where



c is the total cost in the solution from the basic algorithm  c is the total cost in the optimal
solution and v is the minimum value for the marginal valuations of an  increase and decrease of
the threshold in one time slot 
proof  we will prove this by showing an upper bound on the number of iterations needed to reduce
the total cost from the solution of the basic algorithm  i e   c    to the total cost of the optimal
solution  i e   c   in each iteration of the extended phase  the thresholds are adapted for two agents 

 
say k  j  thus  the total cost is reduced by vkj
  vlj
 equation      let v be the minimum value

 
for vkj   vlj   then  as long as the algorithm does not converge  after each iteration  the total cost is
l    m
reduced at least by v   thus  the algorithm stops at most within  c vc   steps 
theorem    the time complexity of the general algorithm lies is o n    c   c     i e   the algorithm is linear in the number of agents and pseudopolynomial in  c    c    
proof  from lemma   we get the upper bound on the number of iterations of the basic algorithm
as dn log e  with  log  being a constant  which is independent of n   the time complexity of
the basic algorithm is o n
l      from
m lemma   we get the upper bound on the number of iterations of
 c  c  
the extended phase as
  the cost difference  c   c   does not depend on n or m   but
v
on the specific characteristics of the agents  the minimum valuation v is proportional to the size
of the threshold increment decrement   thus v is a constant for any constant choice of   thus 
the bound of the extended phase is pseudopolynomial in  c   c   
    incentive compatibility
in general  for allocation problems  there are three key properties of interest  namely  efficiency 
strategy proofness  and budget balance  in the context of our problem  efficiency implies that the
overall electricity consumption cost is minimized  strategy proofness implies that telling the truth
is the dominant strategy for the agents and hence they report truthfully  budget balance implies
that the total amount paid by the members of the cooperative is equal to the actual electricity consumption cost  there are two well known facts about these three properties in the literature  first 
if the allocation is efficient  the only way to implement payments that guarantee strategy proofness
is to use vcg type mechanisms  see the work of green and laffont         hurwicz         second  as green and laffont        and hurwicz        also prove  payments obtained by vcg type
mechanisms cannot achieve budget balance  thus  it is impossible to design a mechanism that
achieves all the three properties  namely  efficiency  budget balance and strategy proofness 
as we have stated in our discussion in the related work section  budget balance is a key requirement of our problem from the application point of view  furthermore  allocation efficiency is a desired social goal  our algorithm achieves both budget balance  lemma    and allocation efficiency
 theorem     therefore  from the impossibility results  we cannot achieve strategy proofness  i e  
truth telling cannot be a dominant strategy  however  we believe each agent may choose to truthfully respond  because agents cannot anticipate the future development of the algorithm and  as we
prove below  no manipulation strategy exists that dominates truth reporting  therefore  we define a
notion of weak incentive compatibility 
definition    an algorithm satisfies weak incentive compatibility or is weakly incentive compatible 
if and only if no strategy dominates telling the truth in the algorithm 
   

fiv eit  x u   z heng   c hakraborty    s ycara

theorem    the general algorithm is weakly incentive compatible 
proof  in our algorithm the agents have two possible ways to deviate from truthful reporting  first 
they could report a demand profile that does not minimize their individual cost according to the
current virtual price signals with the intent that this misreporting would benefit them for the final
payment  second  they could report marginal valuations that differ from their true marginal valuations  for our analysis we assume rational agents  i e   agents always prefer lower cost 
note that in the payment rule  equation    each agent pays for its electricity demand based on
its final price signal  in each iteration  a truthful demand report minimizes an agents cost given
the price signal  therefore  if an agent does not report truthfully at the final price signal  i e   final
iteration  it will incur a higher cost  furthermore  agents do not know whether any given price
signal is the final price signal or not  this is  because agents have limited knowledge and do not
know the demand profiles of other agents or their constraints and preferences  thus  manipulation
at any iteration may result in higher cost than a truthful report  therefore  no manipulation strategy
involving misreported demand profiles dominates truthful reporting 
regarding the reporting of the marginal valuations  definition     it is obvious that deflating its
valuation hurts the agent  we now demonstrate with an extension of the example from lemma   
that deviating from truth revelation through inflating the reported marginal valuation can also hurt
an agent  the aggregated demand is at the threshold in time slot   so that the coordinator asks for
the agents valuations for an  increase of the threshold  without loss of generality assume      
 
l
  ph
agent  s true valuation is  reduce in time slot   and increase in    v  
   p      and agent  s
 
l
is  reduce in time slot   and increase in    v     ph
   p       lets assume agent   misreports its
 
valuation so that v        then  the coordinator increases the threshold in time slot   for agent  
and decreases the threshold for agent    it follows that agent   has to shift demand from time slot  
to time slot   and that agent   can now shift demand from time slot   to time slot    this leads
to the demand profiles  rdeviate
             rdeviate
             however  this profile does not
 
 
only lead to an increase in total cost  but also to an increase of the individual cost for the deviating
agent    table   shows the individual cost   since misreporting the valuations may result in higher
electricity cost than a truthful report for the misreporting agent  no manipulation strategy involving
misreported marginal valuations dominates truthful reporting 
cost
truthful reports
agent   deviates

agent  s cost
      
      

agent  s cost
      
      

total cost
  
  

table    cost of different demand profiles for individual agents 

   simulation
we perform simulations based on real world consumption data to  a  characterize the convergence
properties of our algorithm and  b  understand the effect of different parameters that characterize
the electricity demand profile on the cost reduction through coordination by our algorithm  the
results show that the algorithm scales linearly with the number of agents and time slots  further 
we observe that as the participants flexibility of shifting their demands increases  cost reduction
   since agent  s deviation increases both agent  s as well as agent  s cost  one might argue that increasing the other
agents cost could also be an incentive for deviation  however  note that the cost of an agent is not visible to others 
therefore  we believe that each agent may choose to report truthfully 

   

fielectricity price  euro cents kwh 

m ultiagent c oordination for d emand s ide e nergy m anagement

dayahead
spot market
price

 

 

 

 

 

 

 

 

  

  

  

  

  

  

  

  

time slot

figure    day ahead spot market prices from epex spot for an average tuesday in     
increases as well and that the cost reduction is not very sensitive to whether the consumers use more
electricity during the evening or during the day 
    datasets
cer electricity consumption data  we use real electricity consumption data to generate consumer demand profiles  the data was gathered by the irish commission for energy regulation
 cer  in the context of a smart metering study  in this study  the electricity consumption data of
    small and medium enterprises and        private households was collected over a period of
about     years  the observation period is divided into time intervals of    minutes  one data
point represents the average electricity consumption in kilowatts of one participant during a   
minute interval  in particular  we used the data from    enterprises  the participating enterprises
also answered questionnaires about  among others  their number of employees and typical hours of
operation  we will refer to this data set as the cer data set   
eex electricity prices market data  we generate the cooperatives electricity prices using real
day ahead market electricity prices  gathered from the european energy exchange  eex   which
is the leading energy exchange in europe  in particular  we use the average hourly day ahead
prices from the epex spot market from the    tuesdays from january  st      to may   th      
figure   shows the average day ahead spot market prices of the observation period  we will refer
to the hourly market price data as the eex data set   
    simulation parameters
as of the model in the work of mohsenian rad et al          wep
define each agent by its predetermined total electricity demand over the planning horizon  i   m
r   and by upper and lower
h j   iji
bounds on the electricity demand in each time slot  i e   rij  rij   rij   regarding the individual cost functions gi   we assume gi      because we do not have data on industry specific cost
functions 
   the data set is available at http   www ucd ie issda data commissionforenergyregulation  
   the data is available at http   www eex com en market   data 

   

fiv eit  x u   z heng   c hakraborty    s ycara

      m odeling the c omposition of c ooperatives  
agents can have a variety of different demand characteristics  to reflect this diversity  we use
the cer data set to identify two classes of consumers with similar characteristics  to group
consumers with similar characteristics  we clustered the participants of the study using k means
clustering based on the information from the questionnaires and the electricity consumption data 
in particular  we used the consumption profiles of tuesdays  because tuesday is the most average
work day  here  class   represents consumers consuming most of their electricity during the day 
whereas class   represents consumers having a stable consumption during the day  but have a higher
consumption at night  based on these classes  cooperatives with varying compositions can be simulated  the parameter p fracagent defines the composition of the cooperative by specifying the
fraction of agents from class    and class   by    p f racagent  
      g enerating the n ominal d emand of agents  
an agents nominal demand is the value around which the agent can vary its demand  we simulate
scenarios with m               time slots and use time intervals of        and     minutes  which
we generate by interpolating and averaging the data points from the two data sets  then  j    
represents the first and j   m the last time slot of the day  to get different agents  the nominal
demand for each agent and time slot is the outcome xij of the random variable xcj   let y cj be

the mean of the average demands of all participants in class c in time slot j and let s y cj be the
corrected sample standard deviationof their average
 demands  thenominal demand is drawn from
the uniform distribution xcj  u y cj  s y cj   y cj   s y cj   the distributions of xcj for
the two classes
are shown in figure    the total demand of an agent for the whole day  is computed
p
x
by i   m
j   ij  
      m odeling the f lexibility of c onsumers  
agents can have different flexibilities of changing their demand profiles  here  this ability is expressed through the agents upper and lower bound constraints on their electricity demand in each
time slot  the parameter p flexshift defines the flexibility of the agents by specifying the percentage  by which agents can vary their demands above and below their nominal demand  thus  the
larger p f lexshif t  the further apart are the upper and lower bounds  the parameter is the same
for all agents and fixed for one scenario  based on the flexibility and the nominal demand  the upper
and lower bounds can be computed as
rij   xij     p f lexshif t 
rij   xij      p f lexshif t 

    

      m odeling the e lectricity p rice  
the cooperatives electricity price function in each time slot is defined by the marginal price for the
h
low load  pl
j   and for the high load  pj   and the price threshold  hj   specifying at which demand
levels the marginal prices apply  we use the prices from the eex data set as exemplar prices to
h
generate pl
j and pj   let mpj be the average spot market price from epex spot in time slot j  we
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

  

  
exemplary
nominal
demand

  

  

electricity demand  kw 

electricity demand  kw 

  

distribution
of nominal
demand

 

 

 

  

 

 

 

 

 

 

 

 

 

 

 

  

  

  

  

  

  

  

 

  

 

 

 

 

time slot

 

  

  

  

  

  

  

  

  

time slot

 a  class     day consumer

 b  class     night consumer

figure    distributions of the nominal demand for the two different consumer classes 
compute the marginal electricity prices as
pl
j   mpj
ph
j   mpj  

max

x       m  

 mpx   

min

x       m  

    

 mpx  

we keep these marginal prices fixed across all simulations  however  the price thresholds may
vary across the different simulation scenarios  for example  the price threshold could be above
the aggregated nominal demand so that the demand can be increased or it could be below so that
the demand should be reduced  the parameter p distthresh defines the distance between the
aggregated nominal demand and the price thresholds by specifying the percentage the thresholds
are above or below the aggregated nominal demand  with a negative value of p distt hresh  the
thresholds lie below and with a positive value they lie above the aggregated nominal demand  for
each scenario there is only one fixed value for all time slots  figure  a illustrates scenarios that have
different values of p distt hresh  in addition  the price thresholds could either be different in each
time slot  e g   following the profile of the aggregated nominal demand  or could be the same for
each time slot  flat thresholds   here  we compute flat thresholds by defining them as the moving
average of the aggregated nominal demand  the parameter p flatthresh defines the flatness of
the threshold by specifying the width of the interval over which the thresholds are flattened by a
moving average  for p f latt hresh     the thresholds follow exactly the aggregated nominal
demand  whereas for p f latt hresh   m the thresholds are the same in every time slot  figure  b
illustrates scenarios with different values p f latt hresh  the thresholds are computed by
 
hj  
     p f latt hresh

j p f latt
x hresh
jp f latt hresh

 
     p distt hresh 

x

xij

    

i

      s imulation s cenarios  
to create different scenarios  we vary the input parameters as follows  p f racagent                
          p f lexshif t                   p f latt hresh               p distt hresh       
   

fiv eit  x u   z heng   c hakraborty    s ycara

   

   
values for
p distthresh
   

   

 
   

   

   

   

   

 

 

   

   

aggregated demand  kw 

aggregated demand  kw 

values for
p flatthresh

 
  

   

   

   

 

 

 

 

 

  

  

  

  

  

  

  

 

  

time slot

 

 

 

 

 

  

  

  

  

  

  

  

  

time slot

 a  price thresholds for different values of p distt hresh   b  price thresholds for different values of p f latt hresh 

figure    price thresholds for different values of the parameters p distt hresh and p f latt hresh 

                    agents                         m               and                this
leads to      different scenarios  we define the algorithm to be converged  when the cost reduction
in one iteration gets less than           i e   c  r    c  r                
    simulation results
we first present the effects of the different parameters on the cost reduction through the algorithm
and subsequently discuss the convergence time 
definition    the cost reduction is the difference between the cost of the uncoordinated profile c 
 chosen by each agent when optimizing its cost according to the market price  and the
coordinated

profile c as a percentage of the cost of the uncoordinated profile  i e   cr   c c c      
figure   shows a subset of the results for p f racagent               m        agents     
and       figure  a shows the cost reduction in cooperatives only consisting of consumers mainly
consuming electricity at night  figure  b shows the cost reductions in cooperatives that consist of
both consumer classes in equal proportions  finally  figure  c shows the cost reductions in cooperatives consisting of only consumers with their main demand during the day  the x axis represents
the flexibility of shifting demand  the y axis the flatness of the thresholds and the z axis the height
of the thresholds  in all figures are scenarios with high cost reduction  white  and scenarios with
less cost reduction  dark red   over all scenarios  we observed a mean cost reduction of       
with results varying from    to        however  the sampled cases represent all combinations
of the input parameters and we cannot say how realistic individual settings are  for example  in
many scenarios no optimization is possible and we put in a cost reduction of     no optimization
is possible  if the price threshold provided by the supplier is higher than the sum of the agents upper
bound constraints or if the price threshold is lower than the sum of the lower bound constraints  not
taking into account those scenarios  we observe a mean of        moreover  looking at the cost
reduction from the initial nominal demand profile  we get a mean of       with results up to       
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

   

    

    

    

    

   

    

    

    
   

   
    

 
    
   

   

p flexshift

 

  

    
   

  
 

p flatthresh

    
   

    
   

    

    
   

   

    
 

   

    
   

p distthresh

    

p distthresh

   

 

    

   

    

   

p distthresh

    

   
   

 

  

 

p flatthresh

p flexshift

    
   

  

   
   

p flexshift

 

  

  
 

p flatthresh

 a  only consumers who mainly con  b  consumers from both classes have c  only consumers who mainly consume at night  p f racagent     
equal fractions  p f racagent       sume during day  p f racagent     

figure    the cost reduction through the algorithm as a function of the four input parameters 
p f racagent  p f latt hresh  p distt hresh and p f lexshif t  scenarios with high cost reduction are white and scenarios with less cost reduction are dark red 
      s ensitivity a nalysis
the purpose of this sensitivity analysis is to understand the effect of the different input parameters
on the cost reduction through our algorithm  for the sensitivity analysis we perform a multiple
linear regression  as dependent variable  criterion  we choose the cost reduction  definition     as
independent variables  predictors  we choose the smallest interpretable model that provides a good
adjusted r squared  the resulting model is shown in table    the model explains        of the
variance with an adjusted r squared of         the remaining variance cannot be explained by the
model  because the agents demand constraints are generated randomly 
predictors
p f racagent
p f latt hresh
p f lexshif t
 p distt hresh 
p distt hresh  p f lexshif t
p f racagent  p f latt hresh

coefficient
      
      
      
       
      
       

stand  error
      
      
      
      
      
      

p value
      
    e   
    e   
    e   
    e   
      

table    multiple linear regression model  adjusted r          
result    as agents flexibility of shifting their demands increases  cost reduction increases  i e  
p f lexshif t    g   
the multiple linear regression model summarized in table   shows that the effect of p f lexshif t
is highly significant with p         the positive value of the coefficient          shows that an
increase of the flexibility leads to increased cost reduction 
intuitively  with higher flexibility  more demand from time slots with high prices can be shifted
to those with lower prices  consequently  higher cost reduction can be achieved  for example  if
p f lexshif t      no demand can be shifted and no cost reduced  however  another reason for the
high cost reduction is that the uncoordinated profile before the algorithm has higher cost  recall
that for the uncoordinated demand profile the agents optimize their demand according to the hourly
   

fiv eit  x u   z heng   c hakraborty    s ycara

   

   

   

   

   

aggregated
nominal demand

   

aggregated
optimal demand

aggregated demand  kw 

aggregated demand  kw 

price thresholds

   
   
   
   
   
   

   
   
   
   
   
   
   

 

 

 

 

 

  

  

  

  

  

  

  

   

  

time slot

 

 

 

 

 

  

  

  

  

  

  

  

  

time slot

 a  lower flexibility  p f lexshif t       

 b  higher flexibility  p f lexshif t       

figure     example scenarios with different flexibilities for the agents of shifting their demands 

market prices  consequently  the higher the agents flexibility  the more they adapt their demand
schedules to the hourly prices  however  since not being coordinated  all agents shift as much
demand as possible to cheap time slots  this leads to load synchronization  so that the total demand
in the former cheap slots exceeds the thresholds  leading to higher costs  herding behavior   thus 
high flexibility of uncoordinated consumers leads to highly synchronized demand  these high initial
costs allow for more cost reduction through the algorithm  figure    illustrates settings with low
 p f lexshif t        and high  p f lexshif t        flexibility  the figure shows clearly that the
initial demand peak is higher in the scenario with more flexibility  recall from figure   that slots
           and    are relatively low priced slots with    being the lowest  the area between the
red dashed curve of the uncoordinated demand profile and the coordinated demand profile in gray
multiplied by the respective marginal prices shows the cost reduction through coordination  with
the increasing freedom in figure   b it can be seen that the area between the two curves increases 
the reason the height of the peak stays the same  is that at first the agents shift as much demand
as possible from time slots with aggregated demands above the thresholds  peaks  to time slots
with demand levels below the thresholds  when all agents reach their upper bounds in those time
slots  they shift the remaining demand to the time slots with the lowest prices above the threshold 
according to the hourly prices  the cheapest remaining time slot is     since the freedom allows
demanding most of the remaining electricity in that time slot  the height of the peak does not change 
result    as the absolute distance of the demand thresholds to the aggregated load profile
decreases  cost reduction increases  i e    p distt hresh     g   
the multiple linear regression model summarized in table   shows that the effect of  p distt hresh 
is highly significant with p         the negative coefficient           shows that the further away
the thresholds are from the aggregated load profile the less cost reduction can be achieved 
figure    illustrates settings with low  p distt hresh         normal  p distt hresh     
and high  p distt hresh        thresholds  the cost reduction is limited by how much the agents
can decrease demand above and increase below the thresholds  the demand above the thresholds
is represented by the area between the initial demand profile  red dashed line  and the thresholds
 yellow flat line  above the thresholds  and the unused demand below the thresholds by the area
between the two lines below the thresholds  these amounts are also affected by the flatness of
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

   

   

   

   

   

   

aggregated
nominal demand

   

aggregated
optimal demand

aggregated demand  kw 

aggregated demand  kw 

price thresholds

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
   

aggregated demand  kw 

   

   

   
 

 

 

 

 

  

  

  

time slot

  

  

  

  

  

   

   
 

 

 

 

 

  

  

  

time slot

  

  

  

  

  

   

 

 

 

 

 

  

  

  

  

  

  

  

  

time slot

 a  thresholds below the average load  b  thresholds at the average load  c  thresholds above the average load 
p distt hresh       
p distt hresh     
p distt hresh       

figure     example scenarios with different heights of the price thresholds 

the thresholds  i e   the flatter the thresholds  the larger the two areas become  thus  with flatter
thresholds the cost reduction increases as well  the regression model supports this  because the
parameter p f latt hresh has a positive coefficient          and is highly significant with p        
however  the cost reduction in the scenario with high thresholds in figure   c is greater than
in the case of normal thresholds in figure   b  that happens  because the flexibility of shifting
demand is a limiting factor  since the absolute distance between the upper and lower bounds is
smaller in time slots with low demand  the demand hits the upper bounds in those time slots before
it reaches the lower bounds in the time slots with high demand  in this situation  an increment
of the thresholds leads to more time slots below the thresholds and thus more possibilities to shift
demand  consequently  if the flexibility is a limiting factor  the cost reduction increases  if the
thresholds are slightly increased  this is supported by the regression model  because the interaction
term p distt hresh  p f lexshif t is highly significant with p        
result    we observe similar cost reductions in groups with mostly consumers from one class
and groups with agents from both classes in similar fractions 
the multiple linear regression model in table   shows that the parameter p f racagent is not a
significant predictor for the cost reduction with p         this supports the observation that we can
see cost reductions from the coordinated behavior in each of the two classes  day consumers and
night consumers  as well as mixed groups  figure    illustrates settings with only night consumers
 figure   a   a mixed group  figure   b   and only day consumers  figure   c   however  in these
examples  with an increasing fraction of day consumers  the cost reduction decreases to a larger
extent than indicated by the parameter p f racagent in the regression model  this effect is due to
an interaction effect between the composition of the cooperative and the flatness of the thresholds 
the multiple linear regression model shows that the interaction term p f racagent  p f latt hresh
is a significant predictor with p         the negative value of the coefficient        e     shows
that as the flatness of the thresholds increases and the fraction of day consumers also increases 
cost reduction decreases  in figure    it can be seen that the thresholds are lying outside of the
agents demand bounds in many time slots  because the thresholds are the same in each time slot  in
this situation not the thresholds  but the demand bounds limit the potential cost reduction through
coordination  consequently  as the thresholds get flatter  they get out of reach of the agents demand
bounds  since the load profiles of day consumers have a more significant difference between peak
and low load  this effect is stronger for groups with a larger fraction of day consumers 
   

fiv eit  x u   z heng   c hakraborty    s ycara

   

   

   

price thresholds

   

aggregated
nominal demand

aggregated demand  kw 

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
   

   

   

aggregated
optimal demand

   

aggregated demand  kw 

   

   

aggregated demand  kw 

   

   

   
 

 

 

 

 

  

  

  

time slot

  

  

  

  

  

   

   
 

 

 

 

 

  

  

  

  

  

  

time slot

  

  

   

 

 

 

 

 

  

  

  

  

  

  

  

  

time slot

 a  only consumers who mainly con  b  consumers from both classes have c  only consumers mainly consuming
sume at night  p f racagent     
equal fractions  p f racagent        during the day  p f racagent     

figure     example scenarios with different compositions of the consumer cooperative 
      c onvergence p roperties of the a lgorithm
let the first iteration be the submission of the agents uncoordinated initial demand profiles  then 
in the second iteration the coordinator sends the first virtual price signals to the agents  recall
that in the beginning the basic algorithm is performed and after the basic algorithm converged  the
additional phase is started  if necessary  also recall that we defined the algorithm to have converged 
when the cost reduction in one iteration gets less than           i e   c  r    c  r                
in our simulations  the basic algorithm converges in average within      iterations  in the cases that
need the additional phase  the general algorithm converges in average in additional       iterations 
the experiment was setup using one hp pavilion dmt       with an intel core i     m with
two cores operating at    ghz and   gigabyte of ddr  physical memory  using this setup  one
iteration of the basic algorithm took on average       seconds and one iteration of the extended
phase took on average       seconds  looking at the agents demand profiles at convergence  we
observe that for each agent in average in       of the time slots the demand bounds are tight  in all
sampled scenarios  there is at least one time slot  where the demand bound is not tight  because the
agents have to satisfy their constant total demand over the whole planning horizon 
definition    the convergence accuracy is the difference between the cost of the converged solution
and the optimal solution as percentage of the difference between the cost of the uncoordinated profile
t  c r  
and the optimal solution  i e   c r
     
c r   c r  
result    in our simulations  the basic algorithm achieves the optimal solution in       of all
sampled scenarios 
we found that in       of all sampled cases the basic algorithm achieves the optimal solution  in
the remaining scenarios the basic algorithm comes in average       close to the optimal solution 
this indicates that in most cases the basic algorithm can provide good results 
result    our simulations indicate that larger step sizes    lead to faster convergence at the
cost of small reductions in accuracy 
the parameter  defines the step size of the extended phase  intuitively  larger steps lead to a faster
convergence  at a cost of reduced accuracy  table   shows the convergence accuracy and the average
number of iterations until convergence for varying                the number of agents and time
slots are fixed as n      and m       the results indicate that as  increases  the number of
iterations until convergence as well as the accuracy decreases  however  the reduction in accuracy
is very small and the algorithm achieves good results for all   our results indicate that in order
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

to achieve accurate solutions within few iterations  the step size should be adapted at run time  in
particular  the value of  should be reduced over time 


convergence accuracy

   
 
 

     
     
     

number of iterations
until convergence
    
    
    

table    convergence accuracy and time for varying step sizes
result    our simulations indicate that the convergence time scales linearly with the agent
population size and number of time slots 
to analyze the influence on the convergence time of the algorithm  we vary the number of agents
from    to     and time slots from    to     table  a shows the convergence accuracy and table  b
the number of iterations until convergence  the step size is fixed at       the results indicate that
the number of iterations until convergence increases linearly with the number of agents and time
slots  the accuracy does not change much  as we increase the agent population and time slots 
ptime
p slots
agents pppp

pp

  
  
  
  
   

  

  

  

     
     
     
     
     

     
     
     
     
     

     
     
     
     
     

 a  convergence accuracy

ptime
p slots
agents pppp
  
  
  
  
   

pp

  

  

  

   
    
    
    
    

  
    
    
    
    

    
    
    
    
    

 b  number of iterations until convergece

table    convergence accuracy and time for varying number of agents and time slots

   conclusion and future work
in this paper  we presented an iterative coordination algorithm to minimize the energy cost of a
consumer cooperative  given that information about the agents individual demand constraints and
preferences remains private  we proved that the algorithm converges to the optimal demand schedule and presented results on the time complexity of the iterative algorithm and the agents incentive
compatibility  additionally  we conducted evaluations on the algorithm using multiagent simulation based on real world consumption data  through simulations  we characterized the convergence
properties of our algorithm and the effect of differing demand characteristics in the cooperative and
price functions on the cost reduction through our algorithm  the results show that the convergence
time scales linearly with the population size and length of the optimization horizon  finally  we observe that as participants flexibility of shifting their demands increases  cost reduction increases and
that the cost reduction is not very sensitive to variation in consumption patterns of the consumers 
this work can be extended in several directions  future work can investigate settings in which
the agents might not be able to compute a guaranteed optimal solution of their individual problem 
but only a provably good approximation  this could apply to settings with more detailed load
   

fiv eit  x u   z heng   c hakraborty    s ycara

models for the agents  the overall demand can come from two types of loads  shiftable loads
and non shiftable loads  these loads can be divided further into interruptible and non interruptible
loads  in addition  these loads can be subject to temporal constraints  this can lead to the situation
where the individual problems for the agents are no longer convex  and thus no agent can solve its
individual problem optimally  luo  chakraborty  and sycara        present a distributed iterative
algorithm for the generalized task assignment problem in the context of a multirobot system  mrgap   based on the  approximate  best responses from the agents  this algorithm has a provable
approximate ratio  it would be interesting to investigate such a distributed algorithm in the context
of this problem 
in this paper  the demand of the cooperative in each time slot solely consists of the aggregated
demand of the agents  future work can consider problems with generation and  or storage  that can
be centralized  i e   owned by the cooperative  or distributed  i e   owned by an individual agent  
another avenue of future work is to consider a problem formulation where the cooperative faces
uncertainty in electricity prices  for example  consider a    hour planning horizon and instead of
a long term contract the electricity is bought from an hourly spot market  here  for scheduling
demand  one only knows the price for the next hour and the prices for the future hourly time slots
are uncertain  the spot market electricity price depends on many factors that are not controlled
by the coordinator  hence  for planning purposes  the prices can be assumed to be an externally
specified stochastic process  under this assumption  the goal would be to design algorithms for    
determining policies  for generation  storage  and price signals to be sent to the firms  for the central
coordinator and     determine the schedules for the individual firms  such that the expected cost of
buying electricity is minimized 

acknowledgements
this work was partially supported by nsf award iis         

appendix a  proof  virtual cost is an upper bound on the total cost
proof  here  we give the full proof showing that the sum of the agents individual cost according to
their virtual price signals is an upper bound on the total central cost at market prices  we prove this 
by showing with equations   and   that for every time slot j the difference between the total cost
for the aggregated demand and the sum of the agents individual cost is lower or equal to    since it
is true for every time slot  it is also true for the sum over all time slots 
the central cost for the aggregated demand is given in equation   as
n
x

  
pj  j rij
  j

i  

 

 
  ph
 j  hj   pl
  pl
j
j j  hj
j hj
 

h
 
l
 
pj j  hj   pj hj j   hj

 
 
l
 j  hj
pl
j j  hj   pj hj
 p
 pn

n
 
ph
rij
 hij   i   pl
j
j hij

p
  pi  
n
n
l
 
  i   pl
j hij
i   pj rij  hij
   

 j   hj
 j  hj

fim ultiagent c oordination for d emand s ide e nergy m anagement

the sum of the agents individual cost is given in equation   as
n
x

  
 
sij rij
rij   j

i  

 

n h
x

 
ph
rij
 hij
j

 

 
  pl
j rij  hij



  pl
j hij

i

i  

for the difference of the two costs we get 
n
x

n
x
  
  
 
pj  j rij

sij rij
rij   j

i  

i  
p
i
h

 

n
l
 
l
 
h
l
 
h

h

h

p
r

h

p
r
h

p

h
 
p
r
p
ij
ij
ij
j ij
ij
j
ij
j
j ij
ij
j
i  
i
  pn h

 

l
 
l
h
 
l
 
l

rij  hij  pj rij  hij  pj hij
i   pj rij  hij   pj hij  pj

since

pn 
i  

 j  hj


pn  l 
pl
h
and

ij
j
i   pj hij equal each other out they and can be removed 

p
h


 i
 n ph r   hij  ph r   hij    pl r   hij 
j
ij
j
ij
j
ij
i  
  pn h

 
 i
l
 
h
 
l
 

p
r

h

p
r

h

p
r
ij
ij
j
ij
j
ij
j
ij  hij
i  

lets now write
p
analog as n
i  r 

 j   hj
 j  hj



 


pn l   
pn
h r   h
h r   h
p
r

h
p
p
and
as
 
ij
ij
ij
ij
ij
ij
i   j
i   j
i  rij  hij j


pn
pn
pn
h
 
rij  hij   lets also write i   as i  r   hij   i  r  hij  
hij pj

pn

ij

 

 j   hj

ij

ij

 n
n


 h  


p  h  
p

h
 
l
 


i  r   h pj rij  hij  pj rij  hij   i  r  h pj rij  hij  pj rij  hij
ij






i 

ij

n
p
   h
rij
ij

ij

i 

for  j   hj the terms

pn
i 

  h
rij
ph
ij
j

 

i  r   h
pn ij ij
   h
i  rij
ij



 
l
 
pl
j rij  hij  pj rij  hij



other out and can be removed  for  j  hj remove
 pn



  h
rij
ij



   h
rij
ij

ij

n
p

 l  


 
pj rij  hij  ph
rij
 hij  
j

 
i  rij

pn

   h
rij
ij

 h  


 
pj rij  hij  pl
j rij  hij


 l  
 
pj rij  hij  ph
rij
 hij
j

 j   hj
 j  hj

 j   hj


h
 
pl
rij
 hij
 j  hj
j  pj
 p
  

n
h
l
 j   hj
i   pj  pj  rij  hij 
  pn
 
l
h
 
rij
 hij
 j  hj
i   pj  pj
h p
i



n
h
l
 

rij
 hij
    j   hj
i   pj  pj
h
i
 


p
 
n
l
h
 

rij
 hij
    j  hj
i   pj  pj
 

i  r   h
pn ij ij
   h
i  rij
ij

l
ph
j  pj



   

 j  hj



h r   h
p
ij equal each
ij
j
i 


l
 
hij pj rij  hij respectively 

and 
pn





l and pl  ph out 
factor ph

p
j
j
j
j
 pn

 j   hj

 
rij
 hij



fiv eit  x u   z heng   c hakraborty    s ycara

since this inequality is true for every time slot  it also holds for the sum over all time slots  it follows
that the sum of the agents individual cost according to their virtual price signals is an upper bound
p
 
on the total central cost at market prices  c  r     n
i   ci  ri   
n x
m
x

n x
m
x
  
  
 
pj  j rij
  gi  r i   
sij rij
rij   gi  r i  

i   j  

i   j  

appendix b  proof by counterexample  basic algorithm can converge to a
suboptimal solution in case of gi        
we present a counterexample to prove that the basic algorithm can converge to a suboptimal solution
in general settings with gi          consider a population of   agents  n      and a planning
horizon of   time slots  m      the agents constraints are such that in the converged solution  the
aggregated demand is equal to the threshold in one time slot  let the price function be given as 
h
l h
 pl
    p              h         p    p              h      

the individual constraints on the agents demand are 
r            r            r     r          
r            r            r     r           

the agents individual cost associated with the demand schedule is given as 

g   r      r 

 
 




  g   r      r 

 
 



   

at the beginning  the agents compute their initial demand profiles based on the market prices r   

   
        r            the cost based on these demand profiles is c r          
 t  

 t  

at convergence  the final profiles of the twoagents are r                r                the
cost based on these demand profiles is c r t           
however a different demand profile of the agents exists with r             r             this
profile is feasible and leads to lower total cost  i e   c  r           it follows that the algorithm has
stopped in a suboptimal solution 

references
albadi  m     el saadany  e          demand response in electricity markets  an overview  in
power engineering society general meeting        ieee  pp      ieee 
atzeni  i   ordonez  l   scutari  g   palomar  d     fonollosa  j          demand side management
via distributed energy generation and storage optimization  ieee transactions on smart grid 
             
ausubel  l  m     milgrom  p          the lovely but lonely vickrey auction  combinatorial
auctions       
barbose  g   goldman  c     neenan  b          a survey of utility experience with real time
pricing  tech  rep   ernest orlando lawrence berkeley national laboratory  berkeley  ca 
usa 
   

fim ultiagent c oordination for d emand s ide e nergy m anagement

bertsekas  d  p     tsitsiklis  j  n          parallel and distributed computation  numerical methods  prentice hall  inc   upper saddle river  nj  usa 
boyd  s     vandenberghe  l          convex optimization  cambridge university press 
chu  c     jong  t          a novel direct air conditioning load control method  ieee transactions
on power systems                  
clement nyns  k   haesen  e     driesen  j          the impact of charging plug in hybrid electric
vehicles on a residential distribution grid  ieee transactions on power systems            
    
dietrich  k   latorre  j   olmos  l     ramos  a          demand response in an isolated system
with high wind integration  ieee transactions on power systems              
green  j     laffont  j  j          characterization of satisfactory mechanisms for the revelation of
preferences for public goods  econometrica  journal of the econometric society         
hurwicz  l          on the existence of allocation systems whose manipulative nash equilibria are
pareto optimal  in  rd world congress of the econometric society 
jellings  c  w     chamberlin  j  h          demand side management  concepts and methods 
pennwell books  tulsa  ok  usa 
kirschen  d          demand side view of electricity markets  ieee transactions on power systems                
luo  l   chakraborty  n     sycara  k          distributed algorithm design for multi robot generalized task assignment  in proceedings of ieee international conference on intelligent
robots and systems 
medina  j   muller  n     roytelman  i          demand response and distribution grid operations 
opportunities and challenges  ieee transactions on smart grid               
mohsenian rad  a   wong  v   jatskevich  j   schober  r     leon garcia  a          autonomous
demand side management based on game theoretic energy consumption scheduling for the
future smart grid  ieee transactions on smart grid               
mohsenian rad  a     leon garcia  a          optimal residential load control with price prediction in real time electricity pricing environments  ieee transactions on smart grid       
       
nguyen  h  k   song  j  b     han  z          demand side management to reduce peak to average
ratio using game theory in smart grid  in ieee conference on computer communications
workshops  infocom wkshps   pp        ieee 
palensky  p     dietrich  d          demand side management  demand response  intelligent energy
systems  and smart loads  ieee transactions on industrial informatics               
pedrasa  m   spooner  t     macgill  i          coordinated scheduling of residential distributed
energy resources to optimize smart home energy services  ieee transactions on smart grid 
             
philpott  a     pettersen  e          optimizing demand side bids in day ahead electricity markets 
ieee transactions on power systems                
rahimi  f     ipakchi  a          demand response as a market resource under the smart grid
paradigm  ieee transactions on smart grid             
   

fiv eit  x u   z heng   c hakraborty    s ycara

ramchurn  s   vytelingum  p   rogers  a     jennings  n          putting the smarts into the
smart grid  a grand challenge for artificial intelligence  communications of the acm        
     
ramchurn  s  d   vytelingum  p   rogers  a     jennings  n          agent based control for decentralised demand side management in the smart grid  in the   th international conference
on autonomous agents and multiagent systems volume    pp      
samadi  p   mohsenian rad  h   wong  v     schober  r          tackling the load uncertainty
challenges for energy consumption scheduling in smart grid  ieee transactions on smart
grid                 
tanaka  k   uchida  k   ogimi  k   goya  t   yona  a   senjy  t   funabashi  t     kim  c         
optimal operation by controllable loads based on smart grid topology considering insolation
forecasted error  ieee transactions on smart grid               
veit  a   xu  y   zheng  r   chakraborty  n     sycara  k          multiagent coordination for energy consumption scheduling in consumer cooperatives  in proceedings of   th aaai conference on artificial intelligence  pp           
voice  t   vytelingum  p   ramchurn  s   rogers  a     jennings  n          decentralised control
of micro storage in the smart grid  in proceedings of   th aaai conference on artificial
intelligence  pp           
vytelingum  p   ramchurn  s   rogers  a     jennings  n          agent based homeostatic control
for green energy in the smart grid  in first international workshop on agent technologies for
energy systems  ates       
vytelingum  p   voice  t   ramchurn  s   rogers  a     jennings  n          theoretical and practical foundations of large scale agent based micro storage in the smart grid  journal of artificial intelligence research                
wood  a     wollenberg  b          power generation operation and control  john wiley   sons 
wu  c   mohsenian rad  h     huang  j          wind power integration via aggregator consumer
coordination  a game theoretic approach  in innovative smart grid technologies  isgt  
     ieee pes  pp      ieee 

   

fi