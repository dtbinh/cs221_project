cs      machine learning final project  december     

 

predicting the strength of magic  the gathering
cards from card mechanics
dustin fink  benjamin pastel  neil sapra

i  i ntroduction
magic  the gathering is a trading card game  played
by millions of players and with over        unique cards 
in addition to products distributed by the games publisher 
wizards of the coast  magic also has a rich secondary
market where individual cards are sold  the card values vary
significantly  from a few cents to over          the price
of a magic card is dependent on its tournament playability 
rarity  and collectability  however  the playability of a card is
often misjudged when first released and so many cards are
valued lower than their eventual worth  here we develop a
discriminative regression model to predict the market price
of magic cards  our model assesses the value of a card by
analyzing only features intrinsic to the card  such as its power 
toughness  mana cost  and rules text  descriptions of these card
fields can be found in the appendix   this provides a model
which not only enables prediction of card value of products
released in the future  but also provides insights  through the
most relevant features  to what strategies and abilities in magic
are most effective 

ii  r elated w ork
previous applications of machine learning to magic  the
gathering have worked on predicting the worth of cards in
terms of price and tournament playability  pawlicki et  al 
used logistic regression and support vector machines to predict
price based on price history and tournament playtime     
while hau et  al  looked at the synergy of a deck based
on the performance of similar decks      however  because
both of these projects relied heavily on features that were not
part of the cards themselves  they have limited application to
new cards which do not yet have price history or tournament
playtime  in order to predict the price of new cards  we restrict
our feature set to features of the cards themselves 

features were extracted using an in house feature extractor 
we began with basic numerical card attributes such as
the in game resource cost  power  toughness  and length of
rules text  as well as crossings of these features determined
by the domain expertise of one of the authors  however 
we discovered that the predictive power of these attributes
was surprisingly limited  yielding models with only      improvement on training set rmse against randomly generated
features 
as the strength of a card inherently lies in how it interacts
with the gameplay  we eventually developed methods to extract
features from the rules text  this part of the card is written
in  mostly  natural language and may specify arbitrary effects
on the gameplay 

iii  dataset and f eatures
we obtained data for        unique cards through the mtg
json database      we removed sets of cards known to have
inflated price due to their collectability or scarcity  along with
two joke sets  price of the cards  as of    november      
was obtained through mtgstocks      as the the range of card
prices spans several orders of magnitude  we considered the
natural logarithm of the card price as our response variable 
rather than the card price alone  figure    

after mixed results with several ad hoc methods based on
gameplay mechanics  we hit an order of magnitude improvement with n grams  specifically  we generated a feature for
each consecutive sequences of words  numbers  or symbols

fics      machine learning final project  december     

that appeared anywhere on any card  and gave each card a
value of   for all sequences present and   otherwise     
we found that n    was sufficient to capture most useful
features  while still being computationally feasible 
n grams provided over         features  and so a method of
feature selection was required to make the model tractable as
well as to prevent overfitting  we implemented and compared a
variety of feature selection methods  including forward search 
filtering features with low mutual information  and keeping a
large number of features but regularizing them at the model
level  surprisingly  we found that two ad hoc filtering methods
outperformed all the other combinations we tried 
the first filter was to set a threshold r  and remove all
features present on fewer than r cards  low values of r
performed well on training but overfit  empirically  we found
r       performed well  however  even with arbitrarily high
r  the model continued to overfit on features which differed on
only a few cards  for example  search your library and your
library for are common phrases that are present on more than
    cards  however  there are exactly   cards which contain
the former but not the latter  so by assigning an extremely
large positive theta to the former and a slightly larger negative
theta to the latter  the model was able to fit an arbitrary value
to those   cards  which generalized poorly to the test set 
accordingly  we set a second filter t  such that if two features
were identical across all but t cards  one of the features was
dropped  the value of t was similarly evaluated and set to
t       
iv  m ethods
after performing feature selection  all cards were converted
into feature vectors x         xm   which formed the rows of the
feature matrix x  with an additional intercept term  the log
of the price of the cards formed the output vector  y   we used
the normal equations
    x t x   x t  y

 

magic players often evaluate cards by comparing similar
cards with slightly different attributes or in game resource
cards  we tested two different methods to capture this locality
in our model 
first  we tried locally weighted linear regression  we used
the normal equations  with euclidean distance between the
features and a bandwidth  equal to half the range of the
euclidean distances  this method did improve the test rmse 
but the improvement was so minimal we decided it did not
justify the increase in training time and complexity 
second  we conjectured that a model could use the price of
similar cards as a reference point  and adjust the price for a
new card based on the differences  therefore  we implemented
a method to find the k nearest neighbors of a card and found
the average price of those neighbors      then we trained a
model with the differences between a card and its neighbors
features as inputs  and the difference between a card and
its neighbors prices as output  to predict an unseen card 
we found the average price of the k nearest neighbors  and
adjusted with the model output  this approach was somewhat
effective  but could not outperform our original approach  and
we decided it did not justify the increase in training time and
complexity 
vi  r esults and d iscussion
on a training set of       cards and testing set of     
cards we achieved an rmse of       log dollars         on
the training set and       log dollars         on the test set 
for cards over        the rmse was      log dollars         
this was a        improvement over a random feature matrix
for the training set  and a        improvement for the test set 
we also evaluated the model as a classifier  and calculated
its accuracy in terms of evaluating cards above or below a
dollar  it had an accuracy of      an improvment over the
baseline     acheived by randomly guessing based on the
prior frequency of being above or below a dollar 

to obtain a feature vector  that would reduce the root mean
squared error  rmse  between the predicted log price of the
cards x and their actual log price  y   thus our final model
predicted the price of card i as h  xi     t xi  
to evaluate our model  we calculated rmse on an unseen
test set  additionally  to check that our results were not just
predicting the average value  we compared our results to the
training error of a linear model trained on a random feature
matrix 
to investigate whether we should implement a more complex model such as support vector regression  we crudely
approximated some of the benefits of support vector regression
with a non linear kernel by crossing all of our features together
in several ways  we found no performance improvement or evidence of promising features in these cross features  therefore
we decided to focus our resources on feature generation and
selection 
v  other attempts
two additional methods deserve mention that we implemented but ultimately abandonded 

a benefit of using a card based method was the potential
to uncover game mechanics from analysis of the magnitudes

fics      machine learning final project  december     

of thetas associated with the features  aside from the rare
           and mythic rare             rarities  the
model learned which mechanics provide powerful effects in
the game such as searching the library             and
gaining additional effects from spells and abilities such as
drawing additional cards per turn 

 

viii  a pendix   e lements of a m agic   t he
g athering c ard

vii  c onclusion and f uture w ork
while card prices for magic  the gathering are driven
by other factors such as market supply and demand and
tournament popularity  there is signal in the text of the card
itself to help predict price  the usefulness of the n gram
features revealed the importance of card abilities such as
searching your library and drawing cards over card power and
cost  which are high for some good cards and low for others  it
is surprising that numerical features such as power  toughness 
and mana cost were poor signals  even when crossed with
each other  locally weighted linear regression and nearest
neighbors were attempts to compare cards with many of the
same features that differed along these lines  but neither of
these methods proved very helpful  a more robust crossing of
these features with the n grams may have improved the results 
but additional care would be needed to avoid overfitting  while
n grams worked as a proxy for card ability  a robust card
parser that codified the rules of the game could drastically
improve results  this may prove more feasible for online card
games like hearthstone  where card rules are already codified
by the system  additional avenues for research would include
combining this project with previous projects  to determine
how these features interact with price history and tournament
play  however  the greatest use of this kind of prediction will
be figuring out which of the hundreds of new cards may be
worth something  and for that  focus on card specific features
is necessary 

acknowledgment
the authors would like to acknowledge sam corbett davies
for helpful discussion and advice throughout the project  in
addition  we would like to to thank professor ng and the rest
of the ta team for the fantastic quarter 

r eferences
    pawlicki et  al  prediction of price increase for magic  the gathering
cards  stanford university cs    projects       
    hau et  al  prediction of price increase for magic  the gathering cards 
stanford university cs    projects       
    moura  sergio  mtg json  n p   n d  web  sept       
 www mtgjson com   
    quantitative methods  inc  n d  web  sept        www mtgprice com   
    this outperformed variations such as using the number of times a
particular sequence appeared as the feature value  disallowing numbers
and symbols  etc 
    finding the k nearest neighbors required significant optimization to be
computationally tractable  we eventually found a matrix multiplication
approach that was efficient to compute in matlab 

a magic card has many fields which describe how the card
is played and interacts with the mechanics of the game  at
the top of the card is the cards name and mana cost  the
amount of resources required to pay for the spell  in the
middle frame we find the cards type  land  creature  artifact 
enchantment  planeswalker  instant  and sorcery  as well as
the sub type which provides additional description  relevant
for certain abilities  the third panel contains the rules text
which describes how the card interacts with the game or the
abilities it has  in the bottom right hand corner of creature
cards is an indicator of the power and toughness of the
creature  lastly  at the bottom information about the cards
illustrator is given  as well as copyright information 

fi