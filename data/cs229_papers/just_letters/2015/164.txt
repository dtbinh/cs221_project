predicting business ratings on yelp
travis gingerich

yevhen bochkov

travisg stanford edu

ebochkov stanford edu

abstractmatrix factorization is an extensible method for
predicting ratings in a user item matrix  this paper explores
the use of matrix factorization in predicting business ratings on
yelp 

i  i ntroduction
recommender systems are vital for many modern services 
good personalized recommendations add another dimension to
the user experience  enhancing user satisfactory and loyalty 
most recommender systems are based on one of two strategies  the first is called content filtering and is based on
analyzing an explicit product profile  an alternative to content
filtering is collaborative filtering  which relies only on past user
behavior  previous transactions or product ratings  without requiring the creation of explicit profiles and called collaborative
filtering  collaborative filtering analyzes relationships between
users and interdependencies among products to identify new
user item associations 
there are two approaches in collaborative filtering  neighborhood methods and latent factor models  neighborhood
methods are focused on computing the relationships between
items or between users  latent factor models try to explain
user preferences  ratings  by characterizing both items and
users on some limited number of factors inferred from the
rating patterns  these factors can be fetched from the some
low dimensional user item space representation 
some of the most successful realizations of latent factor
models are based on matrix factorization  such methods combines good scalability with predictive accuracy and in this
work we will focus on them 
the problem can be formalized in following way  given
matrix r  rmn of user ratings of items  where m   number
of users  n   number of items  rui    u  i   k  rating of u
user of i item  k   set of given ratings  u      m   i      n  
required give estimation rui   such that  u  i    k 
ii  r elated w ork
a general overview of approaches to matrix factorization
method is described in      including information on basic
variations such as including bias terms and additional features 
increasing of types of information available for analysis
leads to new methods that try to leverage these rich information sources to improve performance  some works try to
design a specific model for each scenario  which demands
great efforts in developing and modifying models  others try
to extend matrix factorization model by incorporating different
sources of information into it  thus  an abstract framework
called feature based matrix factorization model is presented

in      it allows the creation of additional matrix factorization
models that utilize new types of information by defining new
features  without modifying the underlying algorithm or code 
recently  the incorporation of social relationships within
the framework of recommender systems using collaborative
filtering and matrix factorization has emerged  a method
that represents social constraints on recommender systems is
discussed in      it shows how to design a matrix factorization
objective function that includes social regularization term  the
goal of which is to limit the amount of variation in ratings
between users that have meaningful social connections 
another approach that allows the combination of different
information sources is described in      to take advantage of
the heterogeneity of the information network  the authors first
diffuse user preferences along different meta paths in the network  or with other attribute based item similarity semantics 
then matrix factorization techniques are used to calculate the
latent features for users and items accordingly  each set of
latent features represent one recommendation factor with a
specific semantic  a bayesian ranking based recommendation
model is then used to combine these recommendation factors 
iii  dataset and f eatures
we choose the yelp dataset     for our research as a modern 
information rich dataset  it includes following entities  businesses  items   users  reviews  ratings   tips  and check ins 
businesses are characterized by location information  city 
state  address  coordinates   neighborhoods  average rating  review count  working schedule  category  what kind of business
  restaurant  dental clinic  and various additional attributes
 these vary greatly in type  for example  they range from
accepts credit cards to good for kids  
users are characterized by review counts and average ratings  votes  votes of users reviews by other users   lists of
friends  and lists of compliments 
a review is a rating of a business by a user  it also contains
review text and a count of different kind of votes of this review
by other users 
we used a subset of the yelp dataset challenge data to
perform our analysis and training of the models  allowing
us to iterate over models more quickly and allowing easier
development and experimentation  in order to ensure reasonable overlap between users and businesses and to maintain
a reasonable number of social connections within the subset 
we chose a portion of reviews by geographic location  taking
the set of all reviews in the state of pennsylvania  some
statistic about selected subset is presented in table i  review

fitable i
w orking dataset statistic
number of users
number of businesses
number of ratings
avg number of ratings per business
avg number of ratings per user
avg number of friends per user

     
    
     
           
           
           

fig     number of friends per user

hide a number of known ratings from this matrix  and attempt
to reproduce them using several methods 
a  baseline method

fig     number of reviews per business

distributions and friend count distributions can be found in
figures   and    as we can clearly see  a key feature of the
data is sparseness of reviews 
iv  m ethods
as discussed in the introduction  business ratings are formulated as a r  rmn matrix  where m is the number of
users and n is the number of businesses in the dataset  we

in order to interpret the success of our algorithms  we use
a relatively simple baseline metric that we expect our more
advanced methods to out perform  a first order approximation
of the ratings of all businesses would be to predict the average
rating over all reviews  beyond this  one would expect each
business to have an average rating around which individual
users ratings could vary slightly  additionally  its reasonable
to expect that individual users would tend to have a bias in
terms of how positively or negatively they rate businesses 
across all businesses that they rate 
taking this into account  the following simple baseline
metric  suggested in     
rui      bu   bi

   

this states that the predicted rating rui for business item i by
user u is given by the sum of the global review average score
  plus bias terms bu for each user  and bi for each business 
these are given by the following equations 
p
 
    k 
r
prui k ui
bu    k u   rui ku rui  
   
p
bi    k i   rui ki rui  
where k is the set of all known ratings  ki is taken to be the
set of all known ratings of business i  and ku is taken to be
the set of all known ratings by user u 
b  basic matrix factorization and matrix factorization with
biases

fig     number of reviews per user

matrix factorization is a technique that aims to produce
a more nuanced prediction of the ratings of businesses by
users by identifying a set of latent factors that describe both
each users preferences and each business characteristics  the

figeneral idea is that the known entries in the user item rating
matrix r can be approximated by the product of two matrices 
p  rmf and qt  rf n where f is the number of chosen
latent factors  the matrices p and q are chosen to minimize
some error function on the predicting rating matrix  which is
found as follows 
r   p qt
   
while there is a strong conceptual case for this model  it
does fail to account for the biases that result in the success
of the baseline metric identified in equation    incorporating
these biases results in the following formulation 
rui      bu   bi   ptu qi

   

where once again   is the average review score over all
known reviews  and bu and bi are bias terms for each user
and item business  respectively  in this model  bu and bi can
either be calculated as given in equation    or they can also
be fit to the data to minimize some error measure 
c  feature based matrix factorization
   problem formulation  a useful framework for conceptualizing the model given in equation   is feature based matrix
factorization  as presented in      the model is formulated as
follows 
x  g 
x  u 
x  i 
rui       
bj j  
bj j  
bj j   
j

j

j

x
x
 
pj j  t  
qj j  
j

   

j

similarly  in this formulation  is the global average  and pj
and qj are user and business item latent factors  the bj terms
represent biases  this formulation introduces the concept of
additional features for users and items  as well as global
features  the global  user  and item features are represented
by the j   j   and j terms  respectively 
the advantage of this formulation is that it can be used to
represent many variations of matrix factorization  for example 
in order to implement the basic matrix factorization equation
 with bias  given in equation    the following parameterizations of j   j   and j suffice 
 
 
  k u
  k i
     k  
  k  
   
  k    u
  k    i
we use this formulation to create a model using basic matrix
factorization  with bias  
two additional models we evaluate use this same framework  with the addition of additional item business and user
features  in adding additional features concerning the business 
we take the top    most frequently occurring business categories in the training set and add additional business features
 corresponding to these categories  that is  for business i 
we set


k i
 
   
k   w  c i   k  ci


 

table ii
m odel performance
model
baseline
mf
rmf
bmf
umf

train
     
     
     
     
     

test
     
     
     
     
     

   
     
     
     
     
     

    
     
     
     
     
     

     
     
     
     
     
     

     
     
     
     
     
     

   
     
     
     
     
     

where w is some weight controlling relative contribution of
the business latent factors and the latent factors representing
business categories  and ci is a set of indices corresponding
to business categories 
the third model we implement incorporates information
about the social network present on yelp into our minimization
formulation and our predictions  taking inspiration from     
for user u we set


k u
 
 
k  f  u 
   
k   w  f  u  


 
where f  u  is the set of friends of user u and w is some
weight  in a similar manner to the method taken in      this
models the assumption that friends have similar tastes by
introducing factors that encourage friends predicted scores
to not vary too far from each other 
   fitting parameters  in order to find the biases and latent
factors  we use batch stochastic gradient descent as suggested
in      we also incorporate a momentum term  incorporating
a fraction of the previous update vector in each iteration  to
speed learning  as suggested in      in addition  we incorporate
regularization terms to mitigate overfitting  an additional step
we take to avoid overfitting is stopping the stochastic gradient
descent process early  as suggested in      parameters for
learning rate  momentum  regularization  and the number of
iterations after which to halt gradient descent were set by
testing performance on a subset of the data not used for
training or final testing  batch size was set at      by profiling
the program and optimizing for execution time 
d  evaluation
model performance is evaluated using the rmse 
v
u
u  x
rm se   t
 rui  rui   
n

   

 u i s

where s is the set of ratings in the test set  simple cross
validation was used to train test the data  we select approximately     of the ratings to be withheld as a test set  instead
of selecting at random across all known reviews  we selected
    of reviews on a per user basis  ensuring even distribution
of the test set across users with different numbers of reviews 
v  r esults
a  model error
the final results from the   methods discussed are given
table ii  the models shown are the baseline model  baseline  

fithe basic matrix factorization model with bias but without
regularization  mf   the basic matrix factorization model
with bias and regularization  rmf   matrix factorization with
business features  bmf   and matrix factorization with user
friendship features  umf   we evaluated each method on the
training set  the test set  and several subsets of the training set
that only include users and businesses with certain numbers
of reviews 
b  parameters
as mentioned in section iv  parameters were set by evaluation on a subset of the data  for all matrix factorization
methods  the number of latent factors was set at  
   baseline  the baseline metric has no parameters to set 
   matrix factorization  the learning rate was set to
        with a momentum term of      batch stochastic
gradient descent was run for     iterations 
   matrix factorization with regularization  the learning
rate was set to         with a momentum term of      the
regularization term for updates to p and q was set at      
and the regularization term for updates to the bias terms was
set at        batch stochastic gradient descent was run for    
iterations 
   matrix factorization with business category features 
the learning rate was set to         with a momentum term
of      the regularization parameter for updates to p and q
was set at       and the regularization for the bias terms was
set to        batch stochastic gradient descent was run for
    iterations  the parameter w weighting business features
in equation   was set to      
   matrix factorization with user friendship features  the
learning rate was set to         with a momentum term of     
the regularization parameter for updates to p and q was set at
      and the regularization for the bias terms was set to       
batch stochastic gradient descent was run for     iterations 
the parameter w weighting user features in equation   was
set to     
c  discussion
   baseline  the baseline metric performs surprisingly well
on the data set as a whole  especially when error is measured
on reviews for which both the user and business have at least
   known reviews  this illustrates that bias explains a surprisingly large portion of reviews  although the baseline model
performs worse than all other models evaluated  it performs
extremely poorly when predicting ratings for businesses and
users with low numbers of reviews      reviews  
an interesting characteristic of the baseline model is that it
performs much better on the training set than it does on the
test set  in general  this indicates that a model is overfitting the
data  initially  this appears to be a surprising finding  as the
baseline model has a relatively low number of parameters to
fit to the data  however  the high error on predicting ratings
with a low number of known ratings for the target user or
business hints that overfitting may still be possible  as even
though there are very few parameters to fit to the data  there
are also very few data points to fit the parameters to 

   matrix factorization  the matrix factorization method
performs significantly better than the baseline model across
all portions of the test set for which error was evaluated  it
performs significantly better than the baseline method for users
and businesses with low numbers of known reviews  it also
overfits to the data to a lesser degree  although this model
has more parameters in terms of the latent factors that can
be fitted to the test set  stopping gradient descent after a fixed
number of iterations seems to mitigate their effect  in addition 
the process through which latent factors are set allows the
model to more accurately represent users interests and business
characteristics even with a low number of known ratings for
a particular user or business 
   regularized matrix factorization  surprisingly  adding
regularization to the basic matrix factorization model did not
significantly alter performance  it did increase performance
slightly when predicting ratings for users businesses with a
large number of known ratings  it may be that the strategy
of halting gradient descent early already provides enough
protection against overfitting 
   matrix factorization with business features  when fitting
parameters to the matrix factorization with business features
model  it became apparent that the model is prone to overfitting  initially  the top    business categories were used  and
the category features were given a weight of   in equation
   equal to the weight of features specific to the business  
resulting in a training error of       and test error of       
clearly indicating that overfitting was occurring  the number
of business categories and the weight given to the business
category features were both reduced in order to reduce overfitting  the final results shown in table ii show that the model
is likely no longer overfitting to the test data  as the testing
and training error are very close 
unfortunately  these features did not improve the model
significantly  overall test error was reduced slightly  as was
test error on ratings for businesses and users with       known
ratings  it is likely that the latent factors captured by the model
already account for a significant portion of the rating variation
that could be attributed to business category 
   matrix factorization with user friendship features  similarly to matrix factorization with business features  adding
features representing users friendships did not significantly
improve results of the model  this could be attributed tos
several reasons  one reason is sparsity of the friendship graph 
the majority of users have a very low number of friends 
as shown in section iii  another potential reason is that
social connections on yelp are not particularly meaningful and
may not reflect real world associations that would influence
users tastes  the authors of     similarly found that social ties
themselves were not particularly useful  and more complex
measurements of social connections were required to improve
results meaningfully 
vi  c onclusion and f uture w ork
matrix factorization methods clearly provide a highly extensible  useful method to predict user item ratings  on this

fiparticular dataset  matrix factorization provided a clearly superior method of predicting user ratings of businesses than a
baseline model taking into account global  user  and business
rating biases  incorporating business category features into the
model resulted in a marginal improvement in rating prediction 
while incorporating information about user friendships did not
significantly alter the models performance 
future work could take several directions  it is likely
worthwhile to continue investigating improving the model
using additional business and user features  while business
categories were somewhat useful in predicting ratings  the
dataset provides many additional features about businesses that
could potentially be included in the model  in addition  while
raw user friendship information was not useful in improving
results  more nuanced analysis of social connections could
still prove to be useful  one area that could be investigated
is the inclusion of tie strength between users in terms of
metrics such as embeddedness or other metrics that attempt to
characterize how strong a particular social tie is  an additional
source of features that was not evaluated in the scope of this
paper is the inclusion of textual features from reviews written
by users for businesses  methods such as topic modeling
could be investigated to extract features about user preferences
and business characteristics from the review text itself  these
features could prove to be useful in predicting ratings 
r eferences
    t  chen  z  zheng  q  lu  w  zhang  and y  yu  feature based matrix
factorization  arxiv            cs   sep       
    y  koren  r  bell  and c  volinsky  matrix factorization techniques for
recommender systems  computer  vol      no     pp              
    s  funk  netflix update  try this at home     dec        online  
available  http   sifter org simon journal          html   accessed    dec       
    optimization  stochastic gradient descent  deep learning tutorial   online   available  http   ufldl stanford edu tutorial supervised 
optimizationstochasticgradientdescent    accessed     dec       
    h  ma  d  zhou  c  liu  m  r  lyu  and i  king  recommender
systems with social regularization  in proceedings of the fourth acm
international conference on web search and data mining  new york 
ny  usa        pp          
    yelp dataset challenge  yelp   online   available  http   www yelp 
com dataset challenge   accessed     dec       
    xiao yu  xiang ren  yizhou sun  bradley sturt  urvashi khandelwal  quanquan gu  brandon norick  jiawei han  recommendation in
heterogeneous information networks with implicit user feedback  in
proceedings of the  th acm conference on recommender systems  new
york  ny  usa        pp          

fi