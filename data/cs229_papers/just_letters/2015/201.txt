rossmann store sales prediction
tianyang zhuyuanliu

abstract
in this project  we applied machine learningtechniques to a realworldproblemof predictingstores sales 
this kind of predictionenables store managerstocreateeffective staffschedulesthatincreaseproductivity
and motivation   we used popular  open  source  statistical programming  language r  we  used feature
selection  model selection to improve our  prediction result  in view of nature ofourproblem  rootmean
squareerror rmse isusedtomeasurethepredictionaccuracy 

introduction
rossmannisachaindrugstorethatoperatesin europeancountries weobtainedrossmann    
germanystoressalesdatafromkaggle com thegoalofthisprojectistohavereliablesalespredictionfor
eachstoreforuptosixweeksinadvance thetopicischosen becausetheproblemisintuitiveto
understand wehaveawellunderstandingoftheproblemfromourdailylife whichmakesusmorefocused
ontrainingmethodology 

theinputtoouralgorithmincludesmanyfactorsimpactingsales suchasstoretype date promotionetc 
theresultistopredict    storesdailysalenumbers generalizedlinearmodel glm andsupporting
vectormachine svm regressionwereusedtotrainmodelandpredictsales 

dataset and features
trainingdataiscomprisedoftwoparts onepartishistoricaldailysalesdataofeachstorefrom          
to           thispartofdatahasabout millionentries dataincludedmultiplefeaturesthatcouldimpact
sales table describesallthefieldsinthistrainingdata 


fieldname

description

store

auniqueidforeachstore integernumber

dayofweek

thedateinaweek   

date

informatyyyymmdd

sales

theturnoverforanygivenday integernumber thisiswhattobepredict 

customers 

thenumberofcustomersonagivenday integernumber thisisnotafeature basedonthetest
datafromkaggle thisfeatureisnotincludedintestdata  

open

anindicatorforwhetherthestorewasopen   closed   open 

promo

indicateswhetherastoreisrunningapromoonthatday   nopromo   promo 

stateholiday

indicatesastateholiday normallyallstores withfewexceptions areclosedonstateholidays 
notethatallschoolsareclosedonpublicholidaysandweekends a publicholiday b easter
holiday c christmas   none

schoolholiday

indicatesifthe store date wasaffectedbytheclosureofpublicschools   schoolholiday   
notschoolholiday

table  historicalsalesdatatablefeatures


 

fithesecondpartoftrainingdataissupplementstoreinformation ithas    storeinfoentries whichlisted
thestoretype competitorandadifferentkindpromotioninfo table belowdescribesallthefieldinthisfile 


fieldname

description

store

auniqueidforeachstore integernumber

storetype

differentiatesbetween differentstoremodels a b c d

assortment

describesanassortmentlevel a basic b extra c extended

competitiondistance

distanceinmeterstothenearestcompetitorstore

competitionopensincemonth

givestheapproximateyearandmonthofthetimethenearestcompetitorwas
opened

competitionopensinceyear
promo 

promo isacontinuingandconsecutivepromotionforsomestores   storeisnot
participating   storeisparticipating

promo sinceweek

describestheyearandcalendarweekwhenthestorestartedparticipatingin
promo 

promo sinceyear
promointerval

describestheconsecutiveintervalspromo isstarted namingthemonthsthe
promotionisstartedanew e g  feb may aug nov meanseachroundstartsin
february may august novemberofanygivenyearforthatstore

table  storeinformationdatatablefeatures


wedidseveralthingstocombinefeaturesandcreatefeaturesdirectlyrelatedtosalesnumber theworkwe
didis 
   thesupplementstoreinformationcantbeuseddirectly wemergedstoreinformationandhistorical
salesdata storytypeandassortmentismergedintoeachentryofhistoricalsalesdata
   combinepromo  promo sinceweek promo sinceyearandpromointervaltoapromotion 
indicatorinhistoricalsalesdata theindicatorindicatesonacertaindaywhetheracertainstoreis
onpromotion  
   similarly wecombinedcompetitiondistance competitionopensincemonth 
competitionopensinceyeartoacompetitorindicator theindicatorindicatesonacertainday
whetheracertainstorehascompetitor 
   sincecompetitiondistanceisprovided weusedcompetitiondistancetotrainmodel insteadof
competitiorindicator foranydateandanystorewhichdoesnthascompetitor competitor     we
assigncompetitiondistanceasalargenumber       thismethodenableustouseonlyone
competitiondistancefeature italsomodelsthenocompetitorcasebyweakening
competitiondistanceimpact 
   historicalsalesdatasethasdatefeature wecreatedmonthandyearfeaturebasedondate
feature monthandyearisusedasfeature sincetheycorrelatedwithsalesdata 

thefinaltraining testdatasetusedincludesthefollowingfeatures 



storeid
dayofweek


open

stateholiday


promo indicator

storetype

 

fi


month
year


schoolholiday

promo


assortment

competitiondistance 

methodology
westartwithglmwithpoissonfunctiontotraindata poissonfunctionisknowntobeagooddistribution
modeltomodelcustomernumberandsales    beforetrainingpoissonglmmodel wefirstdidanalysison
allthefeaturesavailabletochoosethesignificantfeaturesandtrytomakesureallthefeaturesarerelatively
iid 

feature selection
theinputfeatureshavemanycategoryfeatures categoryfeatureshouldbetreatedasfactorintraining 
toomanyfactorsincreaseruntimealot wetriedtocombinesimilarcategoryfeaturesasmuchaspossible 
welookedatfeaturedistributionvssalesandcombinefeatureswithsimilardistribution twoexamplesare
listedbelow 

dayofweek feature 
removingstoreclosedataandplottingmonthroughsunssalesdatadistribution fromtheplot wecantell
thattuethroughfrissalesdistributionsareveryclose mon satandsunssalesdistributionsareunique 
indatabase dayofweekisrepresentedasnumericnumber   fromintuitive weknowthatthereisno
linearrelationshipfrom  numbertosalesdata wetreatdayofweekasfourfactors mon 
weekday tuefri  sat sun 


figure  salesdistributionofeachweekday

holiday features 
stateholiday schoolholidayandopenarehighlycorrelatedfeatures theydontmeetiidassumption 
removingstoreclosedataandplottingstateholidaysalesdistribution stateholidaya b cssales
distributionisnotsimilar however stateholiday  bonlyhas   datapoints stateholiday  conlyhas
  datapoints sincethetrainingdatapointsarenotlarge wecombinedstateholidaybandcasone
category 

 

fifigure  salesdistributionofeachstateholiday


competitiondistance feature 
wedidcorrelationcalculationbetweensalesdataanddifferentmathtransfersofcompetitiondistance we
foundthat  sqrt competitiondistance hasthebestcorrelationvalue 


result evaluation metrics 
rsme rootmeansquareerror methodisusedtoevaluatethepredictionquality wetookthepercentage
errorofpredictedsaledatatorealsaledataandthencalculatedthestandarddeviation equationisshown
below 



result and analysis
glm regression 
feature exploration 
westartedwithtakingthefeaturesasis usingdayofweek promo schoolholiday stateholidayas
featurevectorfeedintoglmregression realizingthatinchristmasseason thesalesaremuchhigherthan
whatthemodelpredicted weaddedweekofyearfeaturetothemodel bytreatingtheseasfactors
insteadofnumericnumbers wecanachievebettertrainingandtestingerror wealsonoticedthatalthough
mostofthestorescloseonstateholidays thesalesnearstateholidaysarehigherthannormal therefore 
weaddedflagonwhetheradateisbeforeorafteraholiday withthat welowerthetestingerrorfurtherby
      



a basicfeatures

trainingerror

testingerror

       

       

 

fib treatdayofweekandweekofyearasfactor

       

       

c addingyear weekofyearasfactor

       

       

d flagifbeforeandafterholidays

       

       

table  trainingandtestingerrorwithdifferentfeaturesaddedtoglmregression
table showstheresultswithusingdifferentsetsoffeatures resultsshowthataddingmorerelated
featuresgivesbetterfittingandsmallertestingerror 


 a 




 b 

figure  glmtestingresultwithandwithoutfeatureengineering onestore  
 a testresultwithbasicfeaturesusedasis b testresultafteraddingmorefeaturesthatarerelatedtorealistic
problem 

figure isanexamplefittingresultfromonestore figure  a iswithoutfeatureengineeringwhichhasbig
differencebetweenrealsalesnumberversusprediction especiallyonpeaksanddips figure  b isthe
resultsafterfeatureengineeringplottedonthesametestset whichshowsmuchbetterfitbetweenthereal
andpredictionnumbers 

 

fi

different glm functions 
weexploredglmwithdifferentfunctions poissonfunctionshowsthebestresultonbothtrainingand
testing however thedifferenceisverysmall wecontinuedusingpoissonfunctionfortherestofourglm
experiments table showsthetrainingandtestingerrornumberswithrespecttodifferentfunctionused 


function

trainingerror

testingerror

poisson

       

       

gaussian

       

       

gamma

       

       

quasi

       

       

table  trainingandtestingerrorwithdifferentfunctionsusedinglmregression



svm regression 
kernels selection 
weexploredsvmregressionusinge    packageinrwithdifferentkernels resultsareshownintable
  


function

trainingerror

testingerror

radial

        

         

linear

         

         

sigmoid

         

         

polynomial

         

         


table  trainingandtestingerrorwithdifferentkernelsusedinsvmregression


radialkernelgivesthebestresultinthisproblem sigmoidisnotfitinthisproblem linearorpolynomial
kernelisdifficulttofitthetrainingdataverywellwithoutselectingaverybigcost 


cost and gamma 

thecostparameterrulestheerrorofthecuttingplane highercostforcesthecreationofamoreaccurate
model    however thecreationofamoreaccuratemodelmaynotgeneralizewell amodelthatfitsbetter
thetrainingdataisdonebyaddingmoresvuntilachievingaconvexhullofthedata thisreducedthe soft
margin ofthemodelandcouldresultinverybadtestingerror 

figure  a showsthetrainingerrorandtesterrorwithrespecttodifferentcostvalues wecanclearlysee
thatthehigherthecost thelowerthetrainingerror testingerrorreduceswhenmodelhasbetterfitting but
increasesagainifthecostittoolarge resultinginoverfitting 


 

fithegammaparameterdefineshowfartheinfluenceofasingletrainingexamplereaches itcanbeseenas
theinverseoftheradiusofinfluenceofsamplesselectedbythemodelassupportvectors thebehaviorof
themodelisverysensitivetothegammaparameter ifgammaistoolarge theradiusoftheareaof
influenceofthesupportvectorsissmall anditonlyinfluencethesupportvectoritself inthatcase little
regularizationwithcostwillbeabletopreventoverfitting ontheotherhand ifgammaisverysmall the
modelistooconstrainedandfailstogeneralize theregionofinfluenceofanyselectedsupportvector
wouldincludethewholetrainingset 


 a 

 b 

figure  experimentonsvmparameters
  a trainingandtestingerrorbychangingcostvalue  b trainingandtestingerrorbychanginggamma  


byselectingrelativebiggergammaandcost wecanachieveverylowtrainingerror butbadtestingresult
duetotheoverfittingproblem asshowninfigure    a isthebeautifullyfittedtrainingresult and  b is
thetestingresult whichdoesntpredictthenumbersverywell 


 a trainingresults

 b testingresults


figure  overfittingtrainingandtestingresults onestore  



 

ficarefullyselectcostandgammagivesmuchbettertestingresult  trainingerror           testingerror 
          asshowninfigure  


 a trainingresults

 b testingresults 


figure  abettersvmfittingresultsontrainingandtestingdata onestore 



cross validation 
  foldcrossvalidationwasusedtotuneourmodel wetookevery monthshistoricalsalesrecordasa
folder andseparateditfromtrainingsetandlearnthemodelfromrestofthetrainingdata thentestonthe
folder loopingthroughallthefolders wetunedtheparameterswheneverseeinganabnormallybigerror 
ourfinalmodelranonthetestdatawasanaverageofall  modelsthatwelearnedfromthetrainingdata 

future work
webelievethesalesnumberofaparticulardayisalsorelatedtothesalesnumberbeforethatday adding
timeseriestothemodelcanimproveaccuracy    wewilltryaddingtimeseriestothefeaturevectortosee
whatwecanachieve differentmachinelearningalgorithmsuchasrandomforestorrnncanalsobe
interestingtoexplore 

conclusion
wedidanothertrainingwithourbestmodelonkaggle comprovidedtestdata thetesterrorfeedbacked
fromkaggle comis        fromourstudy thefeaturetreatmenthasalargeimpactontrainingmodel
quality oncefeaturesarechosenandformattedcorrectly thepredictionerrorimproveddramatically model
wise glmpoissonmodelhasthebestpredictionaccuracy mainreasonisthatthesalesisdirectlyrelated
tonumberofcustomers poissondistributionisagoodmodelforcountdata numberofcustomervisits  
timefactoralsoplayedamajorroletoimprovepredictionaccuracy byaddingbeforeandafterholiday
feature thepredictionerrorreducedby      

reference
  datasource 
www kaggle com
  cs   machinelearninglecturenote
  rprogrammingsite 
https   cran rproject org 
  j fan q yao nonlineartimeseries nonparametricandparametricmethods springerseriesin
statistics springer newyork      

 

fi  http   scikitlearn org stable auto examples svm plot rbf parameters html
  poissondistribution
https   en wikipedia org wiki poisson distribution

 

fi