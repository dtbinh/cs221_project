a pairs trading strategy for goog googl using machine learning
jiayu wu
december        
abstract
we apply the spread model  the o u model and svm to build a pairs trading strategy for goog googl 
there are two parts of the project that we think are novel after reviewing past related work  first  we model
not only price spread but also several selected technical indicators spread  second  we use two new metrics for
measuring our trading strategy instead of the traditional back testing method because we want to focus more on
future prediction rather than return prediction  and to achieve that  we also propose two algorithms to reconstruct
the data set  we outline the process of how our strategy is executed and  at the end  show that our strategy
delievers a good win rate 

 

introduction

one important thing for a pairs trading strategy is to
select a proper pair of financial instrucments  for example  if the price of security a always rises when the price
of security b rises  it seems that a and b may be used
for pairs trading  however  the explicit relation between
prices may not be good enough for a good pair  the good
pairs should share as many the same intrinsic characteristics as possible  goog googl are both shares of
google inc   now alphabet inc   but with different vote
rights  googl represents class a shares while goog
represents class c shares  only class a shares have voting rights  therefore  generally  the price of googl is
slightly higher than that of goog  other than voting
rights  they are essentially the same since their prices are
based upon the same fundamentals 

pairs trading is a popular trading strategy in the last
three decades after it was first used by morgan stanley
in     s  pairs trading means to utilize a pair or a bag of
related financial instruments to make profits by exploiting
their relations  one important feature of pairs trading is
that it is market neutral  which is particularly appealing
in the current volatile and unpredictable macro economic
environments 
in this project  we will use the spread model  the ou mean reverting model  and svm to build a trading
strategy and apply the strategy to goog googl  we
will first illustrate the spread model and the o u meanreverting in detail  unlike most previous work that only
takes price spread into consideration  we will also use
the spread model and the o u mean reverting model to
model the two securities technical indicators  in other
words  we extend the concept of spread by also investigating technical indicators spread  we will construct
trading signals by processing different kinds of spreads
and then use these trading signals as input features for
svm classification  instead of using the traditional backtesting method to test our trading strategy  we will use
svm binary classification to measure our trading strategy  to achieve that  we will reconstruct the original pricing feeds to labeled examples  and there are two methods
we use to reconstruct the labeled examples  one for measuring the strategys ability to seize profit opportunities 
and the other for measuring the strategys ability to make
directional predictions 

 

related work

in statistical arbitrage using pairs trading with support
vector machine learning  gopal rao madhavaram compares o u model  mean reverting process  and svms
performance on pairs trading  more specifically  index
arbitrage  using constituents stocks to predict the corresponding index  his results show that svm achieves
a slightly better performance than the mean reverting
model 
there are also some cs    projects from previous
years that have interesting methods and results related
to pairs trading  in machine learning in pairs trading
strategies  the authors first use linear regression to com 

fipute and generate trading signals and obtain a sharperatio of      from back testing and they also propose a
trading strategy using em algorithm and kalman filter 
moreover  in machine learnig in statistical arbitrage 
the authors investigate index arbitrage  and they first use
pca to select first    components out of     candidates
 constituents of ftse     index   and then use o u
model to produce a mean reverting process  which helps
to create the trading signal  their back testing shows
that their trading strategy can make reasonable profits 

two stock prices may not fluctuate in the same range  furthermore   may change over time because of change of
some intrinsic characteristics of either company or change
of overall stock market regime  however  in this project 
we assume  is a constant term over the duration of the
dataset 
in this project  we will use close   open as dat  or
dbt    open as at  or bt   for linear regression 

   

o u model

now we investigate the residual term from the above
spread model  we will use ornsteinuhlenbeck process
  dataset
to model the residual term because the o u process is a
stochastic process such that the object modeled by the
we obtain the data set from quantquote com  the time  process always drifts towards its long term mean  the
frame for our data set is   min  ranging from            residual term  namely the spread  has very similar propto            
erty according the assumption of pairs trading  the residfirst we need to do some data preprocessing because ual term xt from the above spread model satisfies the
pairs trading require the data of the two securities must following stochastic differential equation 
be consistent  by consistent we mean that the date and
dxt      xt  dt   dwt
   
time of every feed of both securities should be a exact
match  however  in our data set  both securities have
where    and  are the paramters we want to essome missing bars  most of which are time intervals with
timate
later using linear regression  wt denotes wiener
no trading volume  explained by quantquote com  thereprocess 
which suggests that the probability distribution
fore we wrote some python script to fill up the missing
of
w
is
a
normal distribution with mean     and variance
t
bars using last close price and volume      these missing
 
t 
bars are about      of the entire data set 
by integrating      we have
the original data set has        feeds for goog 
       feeds for googl  after preprocessing  the data
xt     a   bxt   t  
   
set we use has        feeds for both securities 
data example   date            time        where
open          high          low          close 
a       et  
        volume        
b   et

 
   

pairs trading model

v ar       

spread model

we can obtain the above parameters from running a
linear regression on xt   against xt   and then we can
have obtain estimates for the parameters in the original
o u process equation 

the canonical pairs trading spread model is as follows 
dbt
dat
  dt   
  dxt
at
bt

   e t
 

   

where at is the price of security a at time t  bt is the
price of security b at time t  xt is the residual term  which
has the mean reverting property because mean reverting
spread is the basic assumption of pairs trading and the
t
drift term dt   dm
mt   which is neglectable compared to
the return of either security  the above model shows that
the stock price of the two securities is linear related  the
 here helps solve the normalization problem since the

   log b  

eq
 

 
t

a
 
 b
r
v ar   
 
   b 
r
p

v ar  

  v ar xt    
 
   b 
 

fi 

pairs trading model   a modified version

same time in most cases 
  rsi   relative strength index 

in this project  we extend the above pairs trading model
to also take technical indicators into consideration 
most of the previous work only consider the spread of
price  it is possible that some indicators of the two securities may also provide as much useful information as their
prices  moreover  two candidates for a good pair should
not only exhibit similar price movement but also similar
movements for some technical indicators  therefore  we
want to investigate the difference of indicators like we do
for the price spread 
now the challenge is to figure out what indicators to
use  a good indicator for this project must exhibit similar behaviours for both securities  therefore  empirically 
we selected the following   indicators 
  sma   simple moving average 

rsit         

   
 
    rst

average of  lengthperiod up closes
where rs   average
of  lengthperiod down closes  
rsi is good at indicating whether the stock is in oversought or overbought condition  we use rsi because we
believe the two securities  goog and googl  tend to
be in the same condition 
the  length parameter will be discussed in evaluation metrics section 

 

svm

support vector machine  svm  is a popular and effective
machine learning algorithm for both classification and regression  the idea of svm is to construct a hyperplane
t
x
to seperate the two classes of data with the gap being as
sm at  
piclose
wide as possible 
i t length  
the goal is do the following optimization 
m
p
i
min w b    kwk    c
we choose sma because it is simple to compute and also
i  
helps incorporate information from previous  length time
s t  y  i   wt x i    b      i   i           m
periods 
i     i           m 
  wma   weighted moving average 
alternatively  we can use the following dual form 
m
m
p
p
t
x
max w     
i    
y  i  y  j  i j hx i    x j  i
close
w m at  
w i pi
i  
i j  
i t length  
s t     i  c  i           m
m
p
i y  i      
i t length 
where wi  
t
i  
p
j t length 

j t length  

wma is also a technical indicator related to average
  trading strategy framework
price but it differs from sma in that it assign weights to
prices  the further away from the current time  the less the trading strategy is executed as follows 
weight that price has 
  mfi   money flow index 
   run linear regression to get spread model residuals 
   construct xt s using residuals from the previous step
   
t
p
m f it         
 
    m oneyf lowratiot
according to xt  
dxt  
i t 

where
m oneyf lowratiot  
m oneyf lowt
m oneyf lowt

is

high
low
close
pt 
 pt 
 pt 
 
 

   run lag   auto regression on xt s to get parameters
according to o u model  
   use parameters obtained from the previous steps to
compute t scores for price and selected indicators 
   train svm with the modified data set  we will talk
about data set reconstruction in evaluation metrics
section  
   apply the trained model to test data set  namely to
make trading decisions  which is either make a bet or
stay calm and do nothing 

 lengthperiod p ositive m oneyf lowt
 lengthperiod n egative m oneyf lowt  
pthigh  ptlow  ptclose
 
volume 
 
 
pthigh  ptlow  ptclose
positive if
 
 

mfi takes volume into consideration so that we can also
see volumes impact on the final results  since goog
and googl are influenced essentially by the same factors  money should flow in or flow out both stocks at the
 

fi 

trading signal

end for
if profit then
labelt     
else
labelt    
end if
end for
 length is set to   because we want to profit in the near
future before our patience goes out   threshold should
be set according to transaction cost in real world trading
system  for this project  we set  threshold to be     
because the resulting labels are balanced  which means
around half of the data has a label      and another half
has a label of      in order for svm classification to
work well 
another metrics we use is to examine whether the
trained model can predict the correct moving direction of
t scores in the next time interval  the data reconstruction algorithm is as follows 
for each time t do
if  dxt      dxt     then
labelt     
else
labelt    
end if
end for
for metrics   reconstruction  we have       examples
with label             examples with label      for metrics   reconstruction  we have       examples with label
            examples with label    
now the problem is transformed to a binary classification problem  where      means make a bet and    
means stay calm and do nothing  furthermore  now
the input features for each time t is a vector of t scores
defined in last section  e g 

we give the following definitions for constructing the feature space for svm classification 
here we define t score for each feature 
tprice    

xtprice  price
price
eq

 

by the definition  we can see that t score is standardized version of xt   we use the absolute value here
because in this project we focus on the absolute value of
the spread not its sign 
likewise  we define the following t scores for other
x sma 
technical indicators  tsma     t smasma    twma  
eq

 

xtwma wma
   tmf i
wma
eq

  

xtmf i mf i
   trsi
mf i
eq

  

xtrsi rsi
  
rsi
eq

t scores will be used as feature input for svm binary
classification  next section  

 

evaluation metrics

we use a different evaluation metrics rather than traditional back testing in this project  instead  we use binary
classification to evaluate the trading strategy  for classification purpose  we need to reconstruct the data set
according to the following algorithm  the trading logic
behind this algorithm is that pairs trading is statistical
arbitrage  and that means the value investing rule should
not be applied here  therefore  the goal of this trading
strategy is to profit in a short period of chosen trading
time frame  and only if the spread can narrow to an extent defined by  threshold in a short period  is the trading
strategy willing to take the risk and make a bet  notice
here we use the absolute value of xt because we only
care about betting on that the spread will narrow in the
future  the sign of spread only becomes relevant if we
want to decide which security to long and which security
to short  but for this project  we want to focus on building
a trading strategy that bets on the direction of spreads
change 
for each time t do
profit   false
for each of the following  length time intervals 
dxt i do
if  dxt i       threshold   dxt   then
profit   true
break
end if

 
 
 tprice
          tsma
         
 
 
        trsi           tmf i         

 
twma

 

notice that this is an example before feature rescaling
since we will later rescale each feature for svm to work
well 

  

results

we first split each reconstructed data set into training
data set       and test data set        then use scikitlearn package to train a binary classification svm model
with a linear kernel  finally  we apply the trained model
to test data set  and obtain the following results for each
 

fiby investigating the models predictions in more
detail  we have an interesting finding  which we call
opportunity w indow  for example  if  xt   is   or very
close to    then for a trade made in any of the previous
 length time periods  the trade is a succesful bet given
the algorithm in evaluation metrics section  then the
 length time periods preceding the time t when  xt   
which is equal to   or very close to    occurs form a
opportunity w indow  therefore  if we can have a powerful prediction on when  xt   is   or very close to    we
can freely enter trades during the preceding  length time
periods  this also explains that in the metrics   reconstruction data set  consecutive examples label tend to be
the same because these examples share the same small
 xt   in their following time periods 

metrics 
metrics   
positive
negative
total
positive
t p        f n             
negative f p        t n             
total
    
     
n
accuracy precision recall
f measure auc
      
      
             
      
metrics   
positive
negative
total
positive
t p        f n             
negative f p        t n             
total
    
     
n
accuracy precision recall
f measure auc
      
      
             
      

  

results from metrics   show that our trading strategy is able to moderately beat the market with a winrate of         win rate is defined as  profit trades   total
trades made   which is  true positive   positive predictions    moreover  the results for metrics   also exhibit
risk averse property of the trained svm model  while
the test data set is well balanced  half positive labels
and half negative labels   the model made      positive
predictions and       negative predictions  in addition 
the model missed      profitable trades and had     
loss trades  from the above two sets of statistics  we
can see that the model would rather miss a profitable
trader to avoid a possible loss trade  from the confusion matrix  we can also know that the model successfully
seized         tp  tp fn   of available profit opportunities and avoided         tn  tn fp   of possible
loss trades  therefore  our strategy may be a better candidate for conservative investors than for risk seeking investors 
results from metrics   show that the ability of our
strategy to predict future direction of spread change is
slightly better than the ability of our strategy to make
profitable trades  because all statistics except f measure
are better than those of metrics    it is also expected
because even for human traders  making directional predictions is generally easier than making profitable trades 
the results also suggest that our trading strategy can also
be used as a technical indicator for pairs trading purpose
because it can give a prediction on whether the spread
will narrow in the next time period 

conclusion

in this project  we utilize both price and technical indicators for our pairs trading strategy while most of previous
work only uses price to build pairs trading strategy  we
also devise two new metrics to measure our strategy because the traditional back testing for return prediction
is not our focus and can be not very useful since it involves much more practical problems  such as slippage
and transaction cost  instead  we want to focus more on
directional prediction  the results show that our strategy
is moderately predictive  and has slightly better performance on predicting spread change direction than predicting profitable trades  for future work  we can include
more features in our model  and may do pca to select
most useful technical indicators for pair trading purpose 
moreover  the  in the spread model may change over
time  but in this project  we treat it as a constant over
the time duration of our data set  the performance may
be improved if we design a update rule to update  for
every n period of time 

  

references

    gopal rao madhavaram  statistical arbitrage using
pairs trading with support vector machine learning
    yuxing chen  weiluo ren  xiaoxiong lu  machine
learning in pairs trading strategies 
    xing fu  avinash patra  machine learning in statistical arbitrage 

 

fi