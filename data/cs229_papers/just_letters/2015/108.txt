cs    final project  december         

learning the topology of the genome from protein dna
interactions
suhas s p  rao  sunet id  suhasrao
stanford university

i 

introduction

a central problem in genetics is how the genome  which
measures   meters from end to end when stretched out 
fits inside the nucleus of a cell that has a diameter on
the order of microns wide   the cell has to be able to
access precise portions of the genome with high temporal
and spatial precision in order to be able to turn on and
off genes in a cell type specific manner  respond to external stimuli and regulate the functional state of the cell 
this requirement for tight control of information retrieval
from the genome implies a significant need for a deeply
structured organization of genome topology  but yet our
knowledge of the structural principles of the genome have
been limited in the size scales between single nucleosomes
      base pairs of dna  and whole chromosomes         
million base pairs of dna  
we recently generated three dimensional maps of
the human genome at unprecedently high  kilobase  resolution      these maps allowed us to uncover many
structural principles of the genome  including the positions of all chromatin loops across the genome  chromatin
loops  roughly        across the genome  bring together
small pieces of dna  hundreds to thousands of base pairs
long  that are separated by long one dimensional distances
along the genomic polymer  the anchors of the loops are
enriched for non coding regulatory elements  and as such
these loops play an important role in controlling the transcriptional output of the cell  acting as switches to turn
genes on and off and setting up contact domains  intervals of chromatin forming preferential contacts within the
interval  that act as insulated regulatory neighborhoods
in the nucleus     
we have shown that these loops are set up by at
least two proteins  ctcf and cohesin      nearly all loop
anchors       by a conservative estimate  are bound by
ctcf and the cohesin subunits  rad    smc   etc   as
measured by chip seq experiments  that measure proteindna interactions across the genome   since ctcf recognizes a specific    basepair motif  we were able to integrate
protein binding information and the motif information to
localize the majority of loop anchors down to single base
pair resolution  additionally  the ctcf motif is asymmetric  it has a direction along the  d genome polymer 
for any pair of loop anchors that form a loop  the random expectation would be that any orientation of two
motifs relative to each other would be equally probable
 the motifs pointing towards each other  pointing away
from each other  both pointing to the left  both pointing to
the right   however  we found that nearly all loops       

occurred between motifs pointing towards each other  the
convergent orientation       the precision and accuracy
of our loop annotations has been verified via extensive
genome editing experiments  by adding as little as one
base pair to a ctcf motif annotated as a loop anchor  we
were able to re fold the genome on the scale of millions of
bases     
ii 

related work

while we have systematically mapped loops genome wide
in roughly a dozen different cell types  there is great need
for a effective method to predict the positions of loop
anchors and loops  knowledge of looping patterns in a
cell type is crucial to decoding the regulatory network
of that cell type  but making high resolution maps of
the  d genome remains a fairly expensive endeavor  at
least relative to the cost of mapping protein binding sites
across the genome   we have recently shown that maps
of the  d genome can be fairly accurately recapitulated
simply with a knowledge of where loop anchors are     
protein dna interactions  both transcription factors and
histone modifications  have been mapped in detail in a
number of cell types by large numbers of groups around
the worlds  including major consortiums like encode
and the nih epigenomics roadmap initiative     
prior studies have attempted to use protein dna
interaction data to predict genome structure at low resolutions      but no one has attempted to learn the positions
of chromatin loops using protein dna interaction data 
since we have identified proteins  ctcf and cohesin  that
tend to always be present at loop anchors  using proteindna interactions to infer loop anchor positions  and potentially pairings  seems like a promising approach to be
able to infer genome topology across a number of cell
types  however  knowledge of just ctcf and cohesin
binding sites is not enough  as only a small fraction of
ctcf and cohesin binding sites actually participate in
looping interactions  between        of binding sites      
here  we propose to use protein dna interaction data
sets to both learn distinguishing features of loop anchors
and predict their positions genome wide 
iii 

data

gold standard chromatin loop annotations for the
gm      cell line  a human b lymphoblastoid cell line 
were obtained from      by combining these annotations
 

fics    final project  december         

with ctcf  rad   and smc  chip seq data from encode      we identified      high confidence loop anchors  down to motif resolution  as well as        ctcf
sites that do not participate in loop interactions  for simplicity  ctcf sites that were not unique inside loop anchors were left out of the analysis  even when the correct
looping ctcf could be identified via the convergent rule
     
figure    example of a chromatin loop

included the nucleosome signal    bp upstream of the site 
   bp downstream of the site  and the difference in the
two signal  again decile binned as with the ctcf cohesin
chip seq signal   finally  in addition to protein dna interaction features  we included a few sequence features 
log likelihood motif match scores against two different
position weight matrices for the ctcf motif and phylop     vertebrate conservation scores  downloaded from
ucsc  averaged over the bases in the ctcf motif corresponding to a ctcf binding site  these signals were also
decile binned as above 
iv 
iv   

methods

models

as a first attempt  we trained a gaussian naive bayes
classifier  sklearn naive bayes gaussiannb   a
logistic regression classifier  sklearn linear model
 logisticregression  and three different svm classifiers  sklearn svm  svc  using a linear  polynomial
and rbf kernel on our data      we randomly selected
    of our annotation to hold out as a test set  using the
remaining     as our training set  keeping the proportion
of positive and negative examples balanced between the
training and test set  

legend  an example of what a chromatin loop looks like in a
dna dna interaction dataset  heatmap   the circled focal
peak represents a chromatin loop  protein dna interaction
tracks shown for ctcf and cohesin above and to the right
of the heatmap  illustrate the relationship between protein
binding and  d genome structure  and thus the potential to
predict dna dna interactions using only protein binding and
sequence information   reproduced from     
for features  we downloaded chip seq data for    transcription factors and histone modifications as well as
dnase accessibility data from encode      for ctcf
and cohesin  rad   and smc   chip seq data  in order
to retain information about strength of protein binding 
we discretized the data by calculating average protein
binding signal over each of the sites in our gold standard
annotation  and then converting the signal to a       value
by dividing the distribution of signals into deciles  for
all other transcription factors histone modifications  we
discretized the data simply by peak calling  i e  binary for
peak or no peak   for the sites in our annotations  feature
xi     if there was a peak overlapping the     bp window
surrounding the site and   otherwise  to deal with multiple replicates of a particular protein  signals from replicate
chip seq experiments were averaged and peaks called in
any chip seq replicate were included  even if they were
not called in all of the replicates   in addition  we used
data from an experiment that measured nucleosome positioning genome wide  for each ctcf binding site  we
 

gaussian naive bayes  assuming that the features were
conditionally independent given the looping status of a
ctcf binding site  we maximized 
m

  y    j y      j y       log

 p   x  i     y  i    

i   

for all parameters y   p y       i y     p  xi  
   yi       i y     p  xi      yi      where i is the
number of training examples  in this case roughly
        and j is the number of features       note that
in this case  for some of the  j s  corresponding to the
decile binned signals   there were actually   parameters 
rather than just    since the feature could take on any
value from      also  note that the assumption of
conditional independence given y employed in the
naives bayes algorithm is actually highly problematic in
this case  as many of the features are highly correlated
with one another  for instance ctcf and cohesin binding  
logistic regression  we employed logistic regression with
l  regularization  i e  we maximized 
 
m

       log

 p   y  i     x  i       

        

i   

   h   x   y     h   x    y and
this fits a sigmoid function to
   e
our data to separate in into two categories  looping or
non looping   l  regularization  the         term above 
was introduced to penalize overfitting 
where p y i    x  i 
 
h   x    
 
 t x

fics    final project  december         

support vector machines  we trained l  regularized
svms by solving the following optimization problem  the
dual formulation of the problem is given  
m

max w     

 

m

 i    

i   

y  i   y   j    i  j h x  i     x   j   i

i j  

s t     i  c  i              m

v 
v   

results

classifier results

we first implemented five different learning algorithms
on our training set  using all of the features   to get an
initial sense of performance of the various algorithms 

m

  i y  i      

table    initial classification results

i   

where h x  i    x   j  i varied between the following 

h x  i    x   j  i     x  i   t x   j  linear kernel
h x  i    x   j  i     x  i   t x   j    x    polynomial kernel
 
   x  i   x   j     
 i     j  
h x   x i   exp 
gaussian kernel
  

different kernels and different parameters for c  the
penalty parameter  and   the kernel coefficient  were
utilized to maximize the separability of the data  both because it was not known whether the data was linearly separable  and because it was possible that there were errors
in the training set that could render the data not separable 
 
for an initial pass  we used c     and      of features
 
iv   

grid search

to optimize the hyperparameters for our rbf kernelized
svm classifier  we performed a grid search over various
values for both c and   specifically  we ran our classifier
on the training data for values of c     i        i   
and      i        i     we chose the parameters that
minimized the generalization error on our test set as the
optimal parameters for our classifier 
iv   

feature selection

to identify features that were predictive of loop anchor potential  we performed both backwards search and feature
filter selection on our    features  more specifically  we
performed recursive feature elimination  rfe   by training
a linear svm classifier on our data  choosing the feature
with the lowest weight  removing it from out feature set 
retraining the classifier and repeating until we pruned our
list down to   feature      we also experimented with first
throwing out low variance features  for example  features
that had the same value on      of examples  before
performing rfe  we also calculated the mutual information between each feature and our loop anchor annotation 
since we were ranking features with different domains
 i e  binary features and decile clustered features  and the
mutual information is generally higher for features with
higher numbers of clusters  we also calculated an adjusted
mutual information accounting for chance using sci kit
learns adjusted mutual info score function     

model
nb
lr
svm  l 
svm  p 
svm  rbf 

train err

test err

sens

prec

    
    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    
    

legend  nb  nave bayes  lr  logistic regression  l  regularization   svm  l   svm with linear kernel and c    svm  p  
svm with polynomial kernel  degree    and c    svm  rbf  
svm with rbf kernel and c   
logisitic regression and the various svm classifiers
performed similarly  showing a sensitivity of about    
and a precision of about      see figure   and figure    
 we chose to measure precision rather than specificity
as precision provides a better idea of the utility of the
list for predictions of genome topology   the naive
bayes classifier had a much higher sensitivity  correctly
classifying nearly all of the looping ctcf sites  but a
much lower precision of about      this is likely due  as
noted above  to the incorrect assumption of conditional
independence of the features given information about
propensity to form a chromatin loop 
we noted after this initial classification attempt that we
had made an incorrect assumption about our dataset 
namely  we had assumed that any ctcf that is not
seen participating in a chromatin loop is thus a negative
example  however  we have recently provided evidence
that chromatin loops form through a process of extrusion 
that is a complex binds two places close together and then
slides in opposite directions until it hits two correctly
oriented ctcf sites capable of acting as brake points
and participating in the formation of a loop      loop
formation through extrusion suggest that only ctcf sites
contained within an extant loop  i e  sites that would
have been passed over by the extrusion complex  can be
correctly considered as negative examples  ctcf sites
outside of loops would not have been sampled by the
extrusion complex and hence their propensity to form a
loop cannot be ascertained  when we restricted our data
set to only include negative examples that were ctcf
sites not participating in a loop but contained within a
loop  our performance jumped  for all classifiers  

 

fics    final project  december         

figure    chromatin loop formation through extrusion

kernel coefficient    optimal performance  minimized
test error  was seen for parameter values c       and
          when c was very small  we saw that all examples were classified as negative examples  likely because
the data was not linearly separable  for our best classifier 
we saw a sensitivity of     and a precision of     
figure    grid search heatmap

intensity  redness  indicates greater generalization error  each
pixel indicates the generalization error using a particular value
of c and  
legend  an illustration of the extrusion model for chromatin
loop formation  a complex binds to two places on dna that
are very close together and then slides in opposite directions
until it hits two correctly oriented ctcf sites that act as brake
points  forming a loop  reproduced from      
on average  our logistic regression and svm classifiers
demonstrated a sensitivity of about      a     increase
in performance  and a precision of about      a   
increase in performance   in general  our classifiers did
not seem to be overfitting the data  similar training errors
and test errors were seen for all classifiers  for further
analyses  we utilized the svm  rbf  classifier 
table    classification results after dataset modification
model
nb
lr
svm  l 
svm  p 
svm  rbf 

train err

test err

sens

prec

    
    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    
    

legend  nb  nave bayes  lr  logistic regression  l  regularization   svm  l   svm with linear kernel and c    svm  p  
svm with polynomial kernel  degree    and c    svm  rbf  
svm with rbf kernel and c   

v   

hyperparameter optimization

to optimize the hyperparameters for our support vector
classifier  we performed a parameter sweep through a
range of values for the penalty parameter  c  and the
 

table    confusion matrix for svm rbf classifier
positive  truth 

negative  truth 

    
   

   
    

positive  predicted 
negative  predicted 

v   

feature selection

we ranked features based on their mutual information
 or adjusted mutual information  with the loop anchor
annotation  see table     as expected  features related
to ctcf and cohesin ranked highly among the features 
we also see that the proteins znf    and yy  are highly
ranked features  previous studies have suggested a
relationship between znf    and yy  and ctcf  but
the ability of yy  and znf    to discriminate between
looping and non looping ctcf binding sites is promising 
surprisingly  binding strength of ctcf and cohesin
appeared to be highly discriminating features between
looping and non looping ctcf binding sites 
we also attempted to rank features using recursive feature
elimination  this method did not seem to work  on
initial glance  the results seemed promising  as some
of the highly ranked features were the same  smc 
peak presence  smc  binding strength  rad   binding
strength   and others were intriguing  for example
polr g binding  as polr g transcribes trnas and
house keeping genes which have been suggested to have
an insulating role   however  on further examination  it
became clear that many of the features highly ranked by
recursive feature elimination had extremely low variance

fics    final project  december         

across the training data  for example  the feature ctcf
peak had the value   for all examples by definition  we
are predicting the looping propensity of ctcf binding
sites   even after removing low variance features  the
results for recursive feature elimination still showed worse
performance that ranking using mutual information 
table    feature rankings
ranking
 
 
 
 
 
 
 
 
 
  

feature  mi score 

feature  rfe  

smc  bs

smc  peak
ctcf peak
smc  bs
pbx peak
brca  peak
ebf  peak
polr g peak
nfya peak
h k  me  peak
rad   bs

rad   bs
ctcf bs
smc  peak
rad   peak
znf    peak
conservation
motif   strength 
dnase peak
motif   strength

separating hyperplane  this was striking  there was no
reason to believe that with features like ctcf and cohesin
binding strength  at some point increasing strength of
binding would decrease looping probability  thus  we
hypothesized that this may be a misclassification error in
the data set  to test this  we chose    of false positive
examples randomly and examined them in the dna dna
interaction data from      we found that    out of    false
positive examples were actually misclassification errors 
i e  a loop hadnt been called in the dna dna interaction
data where there should have been a loop  or the association between a called loop and a particular ctcf binding
site wasnt properly made due to details in how the ctcf
to loop anchor mapping was performed  thus  it is likely
that the precision of our classifier is actually closer to     
 it is possible that many of the false negatives are a result
of misclassification errors as well  
figure    precision vs  number of features

results of filter feature selection  feature  mi score  are the top
   features ranked by mutual information between the feature
and loop anchor annotation  feature  rfe  are the top    features ranked using recursive feature elimination  bs binding
strength 
figure    sensitivity vs  number of features

vi 

performance for our svm rbf classifier using the mi feature ranking plateaued at about   features  indicating that
most protein binding data other than ctcf and cohesin
is really unnecessary for predicting the probability of a
ctcf binding site to loop or not  see figure   and    
v   

false positives

we wondered why there was such a high false positive
rate for our classifier  when we examined the distance
from the separating hyperplane for false positive examples versus examples that were true positives  we found
that the false positives were on average further from the

conclusion

here we present a classifier that can accurately and sensitively predict the positions of chromatin loop anchors
given limited protein dna interaction data sets  it is easy
to imagine extending this work to predict pairings of loop
anchors as well  for instance  one can use probabilities of
looping assigned by our classifier as inputs into another
classifier  where features would be the probability of site  
to form a loop  the probability of site   to form a loop  and
the probability that an extrusion complex will get stuck
somewhere in between site   and site  im       p sitei   
where i represents all the ctcf binding sites in between
site   and site   and p sitei   represents the probability that
sitei forms a loop  extending this work in that direction
would allow for extremely powerful and interesting comparative analyses to be performed between cell types in
an extremely cost effective manner to better understand
the role of chromatin organization in development and
gene regulation 
 

fics    final project  december         

references
    rao  suhas s p   huntley  miriam h   durand  neva c   et al           a  d map of the human genome at kilobase
resolution reveals principles of chromatin looping   cell                
    sanborn  adrian l   rao  suhas s p   huang su chen  et al           chromatin extrusion explains key features of
loop and domain formation in wild type and engineered genomes   pnas      e          
    encode project consortium           an integrated encyclopedia of dna elements in the human genome   nature
           
    zhu  jiang  et al           genome wide chromatin state transitions associated with developmental and environmental cues   cell              
    pedregosa  f  et al           scikit learn  machine learning in python   journal of machine learning research    
          
    guyon  i   et al           gene selection for cancer classification using support vector machines   mach  learn           
        

 

fi