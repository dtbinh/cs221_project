portfolio recommendation system
stanford university
cs     project report     
berk eserol

introduction
machine learning is one of the most important bricks that converges machine to human and beyond  considering the
last twenty years improvement in the area  it is easy to foresee that machine learning will continue being valuable for
daily life  the improvement of machine learning can be attributed into four main reasons  technical achievements in
the area      growth of machine capacities and capabilities      advance connectivity and spreads of service
technologies     and massive increase of the data amount      horvitz       
using the power of machine learning to analyze the historical data  future predictions and projections can be performed
on many different subjects  even though  it is affected by various different external events  in this application project 
stock market prices are tried to be predicted using only their historical data and a portfolio recommendation result is
generated via the output of the regression and scoring  the aim is to recommend a portfolio with high accuracy profit
return  the system is designed to produce result on any market structure that can be represented with similar data  for
the project  historical nasdaq stock prices are used 

related work
stock market can be associated with various different events and data  earning announcements are one of the key
events that affects the stock prices  using company earnings data with gaussian kernelled svm can lead predictions
with     accuracy  pouransari h   chalabi h         other financial assets such as currency and underground
resources can be another source of information and increase predictions up to       for some markets  shen s   jiang
h   zhang t         additional features can enhance the prediction for      or    days results up to     accuracy  di
x         algorithm selection is another factor on the accuracy      accuracy is achievable with neural networks
 lin h         increasing the prediction range  for example    days with svm can produce more accurate results up
to      dai y   zhang y         other than regression approaches  without predicting the price but classifying the
stock as positive negative with svm and creating an equally distributed portfolio can return nearly    higher than
the market average  ark s   erylmaz b  and goldberg a       

dataset and features
all available historical price data for most of the companies that have stocks tradable through nasdaq is collected   
the data contains daily values from the beginning of its trade date to a recent date  ideally one day before the
calculation   each day data is in the following format 
msft

 

year
    

month
  

day
  

open
       

high
       

low
       

close
       

volume
        

yahoo finance service and herval yahoo finance open source project  https   github com herval yahoo finance  is used for data retrieval 

 

ficurrently the system has      company histories from their first day on nasdaq to             the data can be
updated with most recent values to increase accuracy before the calculation 
the systems expects a set of inputs and use them to fill the feature vectors or as parameters  the expected inputs are
the following
 

 

 

 

set of nasdaq stock names 
instead of running on all      companies  the system considers only the given set of stocks and
only uses them in the recommended portfolio 
budget 
budget is the maximum amount of total stock price in the recommendation  the sum of the
recommended stock price does not exceed the given budget amount 
keep time interval  kti  
the maximum intended time to keep the purchased stock  the keep time interval affects the
features as a parameter  it can be minimum one day and maximum one year in the type of day
count 
history interval  hi  
history interval is used to trim the historical data to be considered  the data with the date outside
of this interval is not considered 

using the data bordered with inputs and using the parameters  the feature vector is filled such that
 
 

 
interval
start
price

 
interval
maximum
price

 
interval
minimum
price

 
interval
volume
average

 
interval
start
day

 
interval
start
month

 
interval
start
year


interval
close
price

the interval is referring to the two times of the keep time interval  the data set is created by an interval length sliding
window for every data day 

methods
as a preprocessing according to the given input parameters  for every historical day of the given companies  a new
data point is created in the form of the feature vector  the interval is considered as two times of keep time interval in
order to make a better prediction  as an example  if the given interval is five days  then the data points are generated
according to ten days intervals  the last day is considered as a new point  half of the interval  and the gain is
calculated accordingly 
as a learning method  locally weighted linear regression  lwr  is used minimizing
    

 
 

  
   

      
      

 

where the weights are calculated as       exp 

       
  

 

 is the bandwidth parameter 
the bandwidth parameter is used to prevent overfitting and underfitting  the  is calculated using the normal equations
           

 

fitrain is performed during the query time for the new point and predicted interval close price is determined  the
difference between last close price and predicted interval close price is the initial score of the stock  if the initial score
of a stock is negative then it is removed from the recommended bundle  rb   the positive initial score stocks are
rescored between        based on their initial scores such that total second scores of the stocks in the recommended
bundle is    the budged is distributed proportional to the second scores of the recommended bundle stocks 

results
the calculation of the training error is performed on the same data changing the latest date of the system into an earlier
date and comparing the result with actual results  using the leave one out cross validation  error values are calculated
for meaningful subsets of the feature set and best result is achieved with using the all predefined features  the
bandwidth parameter is used as another variable for minimizing the training error  best at      
the titles of the graphs represent the given input to the system in the orders of kti budget hi  each graph has four
dates  execution of the system  of recommendation results indicating the day of the market buy order requested  the
stocks are assumed sold kti days later and the charts show the virtual profit in terms of dollars after kti days of the
given date  the following system training errors  profit errors  are calculated according to the virtual profit of each
stock that appears in the recommended bundle  rb   the result considered as error if it appears in the recommended
bundle and the virtual profit is not positive after kti days such that
    
  
            
            
             
             

          
    
    
    
    

 


  

             

          
    
    
    
    

  
          
    
    
    
    

          
    
    
    
    

using these    executions of the system with the predefined trending set of stocks  the average profit error is       
 profit accuracy is          the total virtual profit combining the result of four execution of the system per given set
of inputs are the following 
total virtual profit

            
        

            
        

             
        

             
        

a set of    trending stocks  msft  googl  aapl  txn  gt  intc  adp  atri  casy  cost  cinf  clbh 
is selected as an example user input  four executions of the system with different buy market order date results are
represented in each charts  positive results are considered as correct and negative results are considered as errors 
detailed virtual profit results after kti days later are shown separately 
            
msft
googl
aapl
txn
gt
intc
adp
atri
casy
cost
cinf
clbh

 

          
 
        
 
 
 
 
 
        
 
 
 
 

          
 
 
 
        
        
 
       
        
        
 
 
 

          
 
 
 
 
 
      
        
       
 
        
        
 

          
        
        
        
        
        
        
        
 
     
 
        
 

fi            
msft
googl
aapl
txn
gt
intc
adp
atri
casy
cost
cinf
clbh

          
 
       
 
 
 
 
 
 
 
 
 
     

          
 
 
 
 
        
 
 
     
 
 
 
    

          
 
 
 
        
 
       
        
        
 
        
 
 

          
      
 
        
     
 
        
        
 
 
 
     
   

             
msft
googl
aapl
txn
gt
intc
adp
atri
casy
cost
cinf
clbh

          
 
 
 
 
 
 
 
 
 
 
 
       

          
 
 
 
 
          
 
 
 
 
 
 
     

          
 
 
 
          
         
 
          
 
 
 
 
 

          
 
 
          
         
 
         
         
 
 
          
         
 

             
msft
googl
aapl
txn
gt
intc
adp
atri
casy
cost
cinf
clbh

          
 
 
 
 
 
 
 
        
 
 
 
 

          
 
 
 
 
 
 
 
 
 
 
 
       

          
 
 
 
 
 
 
 
 
 
 
 
      

          
 
 
        
       
        
      
        
 
 
        
 
 

conclusion and future work
the portfolio recommendation system shows that adding a portfolio layer on top of the stock regression results is
increasing the success rate  profit accuracy  up to         when success is calculated by the profitability of the
recommendations  moreover  it helps to reduce the risk by distributing the budget over a set of stocks and tries to
minimize the reflection of the regression errors to the profit 
the project can be enriched with additional features and alternative algorithms  another suitable algorithm for the
problem would be svr instead of lwr  some other hybrid solutions can also be applied such as determining the
positive stocks with svm and rate them with a regression algorithms 

 

fireferences
horvitz  e        machine learning  reasoning  and intelligence in daily life  directions and challenges  technical report tr          microsoft research 
pouransari h   chalabi h        event based stock market prediction  stanford university
di x        stock trend prediction with technical indicators using svm  stanford university
lin h        feature investigation for stock market prediction  department of aeronautics and astronautics  stanford university
dai y   zhang y        machine learning in stock price trend forecasting  stanford university
ark s   erylmaz b   goldberg a        supervised classication based stock prediction and portfolio optimization
shen s   jiang h   zhang t        stock market forecasting using machine learning algorithms

 

fi