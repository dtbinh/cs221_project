cs     final project report 

drugs store sales forecast using machine learning
hongyu xiong  hxiong    xi wu  wuxi   jingying yue  jingying 

  introduction
nowadays medical related sales prediction is of great interest  with reliable sales
prediction  medical companies could allocate their resources more wisely and make better profits 
we join a kaggle competition to predict the everyday drug sale for each store based on the store 
promotion and competitor data  we aim to apply different machine learning techniques to tune
the model and make predictions on drug sales using time series analysis 

  data
the kaggle website provides us training data of      rossmann stores daily sales dated
back to       with           entries in total  the training data includes features of promotion
and competitors information  since we are not able to access to the real sales amount for testing
during kaggle competition  we decide to use     of the contest given training data as the
training set for our model  the rest     as test set for cross validation  for now  the cross
validation will be our estimated test error 

  method and results
since the problem involves time series data  we intend to use time series analysis model
to deal with it in the first place  we establish auto regression  ar  model and train it using the
data we have to get the parameters  we test ar models with different order numbers  and
calculate the test errors 
in the time series analysis part  we predicted each store s sale based on just its past data 
now we want to see how stores are different according to their different features  first  we
establish a time independent model by averaging the daily sales per store and collapsing the time
dimension  in this frame we use random forest to select features and then use support vector
regression to fit different features  such as assortment type and competitors  to each store s
mean sales 
finally  we manage to generalize the time series model to predict several stores at a time 
instead of one by one in the first section 
    time series analysis
in order to get a big picture  we first plot several stores daily sales with respect to time
evolution  from the plots  we recognize that it s a time series data and for a certain store  its daily
sales evolve periodically with a period of a year  for example  according to figure    we can see
that there will be sales peaks at certain dates around january and may  but in general the sales
keep at a constant level 
      auto regression  ar  model

fics     final project report 
since the prediction for the daily sale for each store from past data seems to be a time
series problem  we manage to solve this problem by building a time series analysis model  the
basic method we are using is auto regression  ar  model 
p

x t    i x t i    t
i   

we looked online and discovered a package called  forecast  in r  which does autoregression  we made some revision so the program could do what we want  to use this model 
we pre process the data to make weekly sales as a time unit  the first reason we want to do that
is because that  zero sunday sales  makes it hard to use daily sales as a time unit  and monthly
sale would kill all the detail patterns  the second reason is that we plot sales at different days in a
week through time  and discover that they basically follow the same pattern  figure     since we
condense the daily sales to weekly sales at the beginning  after we predicted the weekly sales we
still have to regenerate sales on each day in that week  we assume a normal distribution n     
with  equal to the weekly sales and variance   to be trained  we compare ar models with
order p                   to see which order number fit best 

figure   sales of store  on different days of the week
      cross validation
for each order p  we train parameters       and  with     of the data and cross
validation with the remain     to get the test error  the cost function we are using is the sum of
the square of the difference between predicted and real daily sales of store   the table below is
the comparison among test errors using different order number 
order p 
test error 
        

  
       

  
        

  
       

   
       

   
       

as we can see order number p     yields the lowest test errors  we plot the predicted
sales of store   figure     if we compare fig   and fig    we can see the model capture the
general pattern of the store  s daily sales 

fics     final project report 
specifically speaking  for sales on tuesday  wednesday and thursday  our predictions
are within     of the real daily sales  however  it gives conservative predictions for mondays
and fridays  when sales are apparently higher compared to other days in a week 

figure   sales of store  at daily base

figure   predicted daily sales of store 

    random forest
since there are so many factors influencing the sales  such as store types  promotions 
competitors  and even holidays  we are trying to identify the most important features that
influence the sales  we use random forest to do that  in order to decrease the amount of data to
test the model and the program  we average the daily sales for each store  so the amount of data
decrease from a million to a thousand 
in the raw data provided  five parameters have missing data points  we first combine
competitionsincemonth and competitionsinceyear to a new variable competitionexistmonth  similarly 
we create a new variable promoexistmonth from four promotion variables  we also scale the variable
competitiondistance by     

figure   feature selection through random forest
we built a model using the  random forest  package in r  our model was built on    
trees and   variables in the  store csv  and the mean of sales for each store as the response
variable  we used na omit for the missing values and generated the variable importance plot for
the feature selection  the out of bag errors were traced for the model 

fics     final project report 
it seems that the out of bag errors are pretty small  but we will have to dig more into the
data and model fitting to find out if it s overfitting  the variable importance plot is as following 
as you can see from the plot  the feature assortment is the most important variable
because including it could make the biggest reduction in the mse  also notice that
competitionexistence is the least important one among all variables in the store characteristics 
    support vector regression  svr 
we used support vector regression  svr  method to find relation between each store s
mean sales and different kind of features  svr is a variation of support vector machine  svm  
the essence of svm is to find a classification boundary with maximum margins to the feature
points  by similar token  svr is to find a regression curve with minimum margins to the feature
points  we used the standard liblinear    package in matlab to implement svr 
min w b
s t 

 
 

 
 i  
t  i  

 y   x  b  
 t  i  
 i  

 x   b  y  

for i               m

according to the data  there are four different store types  a  b  c  d  and three different
assortment types  a  b  c   in total   combinations  aa  ac  ba  bb  ca  cc  da  dc   we ran svr
algorithm with linear kernel according to different combinations 
test error 
       
linear 

 a  a  

 a  c  

 b  a  

 b  b  

 c  a  

 c  c  

 d  a  

 d  c  

     

     

     

        

      

      

      

     

linear   
parabola 
sqrt   
parabola 

     

     

    

        

      

      

      

     

     

     

       
   

        

      

      

      

     

    extension for time series model
in this model we used a method similar to seasonalized times series regression  in which
prediction of sales y   tsi  we adjusted this equation to y   tdi  in which y means the
daily sale prediction  t means the sale trend  and di means daily sale index  to obtain t  we
linearly fitted of all historical sales data of a single store with equation y   a   bt  in which a  
 

  and b  

   

  then to predict sale at time t     t t     a   bt     di was obtained from

historical data  and the     days in a year each has a different di  for example  if we wish to get
di for january  nd  we got historical sales on january  nd  say s    s    s    at time point t    t     t    
respectively  and linearly fitted sales y    y    y    then di  

    
    

 

  
  

 

  
  

  di reflects the sales

fluctuations at different periods within a year  we take considerations for zero sales cases  and if
s       we just ignores it when calculating di  instead in the final prediction we assigned sales
on sundays to be zero  based on observations of historical data  and holiday dates with all
historical sales data equal to zero  like january  st  were also predicted to be zero  we used    
historical data for training  and     for testing  and the cost functions for    stores were listed 

fics     final project report 
 
test error 
       
 
test error 
       

store  
       

store  
       

store  
       

store  
       

store  
       

store  
       

store  
       

store  
       

store  
       

store   
       

figure   comparison between raw and predicted sales of store       
  conclusion and prospective
we use ar model to predict the sales with small discrepancy to the test data  and we use
rf and svr to find relations between store mean sales and other features  there are certainly
rooms for improvements  we can make further predictions on daily sales using svr  even
though we found the relations between the features  and make fairly good predictions on average
sales for each store  we think next we could try to use svr see how the parameters set in ar
change according to features  by doing so  we could automate the process of making predictions
on daily sales for all the stores in the time series model 

reference 
    wensen dai et al  a clustering based sales forecasting scheme using support vector
regression for computer server  procedia manufacturing                   
    marco hulsmann et al  general sales forecast models for automobile markets and their
analysis  transactions on machine learning and data mining vol     no                 

fi