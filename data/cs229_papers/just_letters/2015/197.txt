quantifying decision impact in moba games

edward gan
justin huang
frederic ren

egan    stanford   edu
jthuang   stanford   edu
fren   stanford   edu

abstract
in this project we quantify the importance and effectiveness of item purchase decisions in league
of legends  focusing on the early game  we find
that stepwise sequences of classifiers are unable
to take advantage of the information provided by
early game item choices in general  suggesting
that items as a whole are fairly well balanced 
however  a more refined propensity score matching is able to detect a mild but significant effects
for specific items 

   related work
the concept of instrumental variables is useful for understanding the independent impact that item decisions have
on a match  in our setting  gold  xp and champion choice
are instrumental variables which give us a handle on an
underlying game state  since game state is a confounding
variable for both match result and item choice 

   introduction

in  foster         the authors discuss how   stage least
squares   sls  can be used to account for confounding
variables by first modeling results w r t  only the instrumental variables  however  the specific formulas used do not
generalize to svms  trees  etc    so we combine their high
level approach with ideas from forward feature selection
 guyon   elisseeff        to formulate  sls like staged
classifier models described in section     

moba games such as league of legends offer a unique
mix of challenges to their players  league of legends
 league  in particular is a game between   human teams
of   players  at a strategic level players must choose between different champion  character archetype  and item
 equipment  options while at a tactical level players must
maneuver around and eliminate the opposing team 

within the domain of predicting match results  the authors
in  joseph et al         used a variety of methods on a high
dimensional feature set similar to ours  including decision
trees  but did not obtain very high predictive accuracy with
any of the methods  thus  we do not expect very high
win loss accuracy either but that is not necessary for our
research question 

the strategic choices are especially difficult since they
must take into account the current game state but have
no immediate impact on their own  players often wonder which of the many strategic decisions they made contributed the most to a win or a loss  in this project we focus
on understanding the causal effect different item purchases
have on the result of league games 

in the specific area of analyzing items in league of legends 
the state of the art metric is raw winrate for each items  as
can be seen in third party apps endorsed by riot such as
 kateofspades   kai   we believe that our methods will
be able to give more realistic insight since they will take
confounding variable into account 

we examine the relative importance and effectiveness of
different item purchases player make  we construct a variety of classifiers which try to predict win or loss based on
team champion choices  player gold and experience levels  and player item choice to isolate the effect of item
choice  we also use propensity score matching to correct
for confounding variables while predicting win rate based
on whether or not a certain item was bought 

cs    final project      

there is substantial literature on the combination of machine learning and traditional econometric techniques to
yield causal estimates   athey   imbens        discusses empirical methods for combining propensity score
matching and machine learning tools such as cross validation to estimate treatment effects  particularly in observational studies with heterogeneous users   athey   mobius 
      is an example of an observational study that employs
propensity score matching  the authors aim to estimate
the causal effect of adding local news content to google
news feeds  where opting into local news is a choice that
users make  they build a propensity score model of opting into local news as a function of past browsing behavior

fiquantifying decision impact in moba games

and condition on this information to match users and form
a quasi experiment to test effects on readership 

   data
the riot api  rio  gives us access to a variety of information on a given league match  but does not provide direct
access to recent matches  so we began by crawling playerto player connections to obtain a list of       north american players in silver tier  all players in silver tier are
ranked to have roughly the same  mid level amateur  skill
level  up to    recent matches were pulled for each player
for a total of        matches 
each match is played between two teams of    and each
player makes their own item purchase decisions  since
we are modeling individual player choices  we extracted
a single sample from each match for a total of        data
points  extracting more data points from each match would
introducing misleading correlations in the data 
we extracted a number of both categorical and numerical
features for each match from the json provided by the api 
category
ally champions
opponent champtions
items total
items      minutes
gold   x min
xp   x min
win   loss

example features
ally alistar     ally elise        
opp alistar     opp elise        
boots     longsword        
boots        longsword           
gold        gold             
xp        xp            
win   

each team consists of   out of     possible champions 
and similarly each player can purchase any number of distinct items  we encoded the presence or absence of each
champion on each team as a binary feature  for a total of
        features  similarly whether or not the player had
bought each item by specific points in time is encoded as a
binary feature  cumulative gold and xp numerical values
were measured at   minute intervals and each value represented by its own feature 

   methods
     predictive classifiers
our method for quantifying the overall impact of item purchases is inspired by both forward search feature selection
and   stage least squares modeling  the goal here is to
limit the effect of game state  which is a confounding variable since it influences both the final outcome of a match
and the items one might choose or be able to buy 
in section     we limit ourselves to the first    minutes of
the game to limit variation in game state  and we use champion choices and gold and xp values at    minutes as in 

strumental variables to stand in for the game state  then  to
distinguish the effect of item choices from these  we build
three successive models which take into account more features roughly in the order they begin to have an impact

champion
selection
 c 

gold   xp
 gs 

model   
win   c

model   
win   c   gs

early item
purchases
 ip 
model   
win   c   gs   ip

figure    successive classifier models

figure   illustrates how each model takes an additional set
of features into account  model   only takes champion
choice into account  model   adds gold and xp data  while
model   includes all of the above as well as item choice
data  we hope to quantify the overall impact of item choice
with the difference in predictive power between model  
and model   
impact  model   acc  model   acc
the specific algorithms we used for each model were l regularized logistic regression  l  regularized linear svm 
and adaboost decision tree ensembles  the logistic regression minimized the error 



pn
 w    c i log exp yi xit w   c    
regularized linear svm minimizes the error 
pn
  t
i   i
 w w   c
where yi  wt xi   b      i  
adaboost trees calculate weights  for decision trees ht  x 
and then classifies based on the sum of the weighted tree
decisions 
p
t  log   t  ht  x 
     propensity score matching
a more principled way of isolating causal effects for specific item choices is propensity score matching  psm  
psm is a method for estimating treatment effects in
datasets where assignment to a binary treatment is endogeneous  our example of this is the purchase of an expensive
item  treatment  in league of legends  expensive items
are frequently only affordable to the team that is ahead 
and thus their purchase might be correlated with winning
the game even when their actual effect is minor 
the goal of propensity score matching is to estimate the
effect of binary treatment x on outcome y in the presence of endogeneous variables z  the concern is that z 
which in our case are game state variables  have an effect

fiquantifying decision impact in moba games

the following provides a  hypothetical  graphical illustration of propensity score matching  table   is hypothetical representative data  where the expensive item mejais
soulstealer is more commonly bought by the winning team 
regression of this dataset would assign coefficients which
conflate the role of mejais soulstealer on game outcome
when gold lead is correlated with both item purchase and
winning the game  table   shows what the dataset might
look like after the matching process has concluded  we see
that both observables and propensity scores are approximately balanced  within some tolerance  between the treatment  mejai purchased  and control  mejai not purchased 
groups 

       l inear m odels
we started by evaluating the performance of regularized logistic regression and linear svms  we evaluated each classifier by its overall accuracy via   fold cross validation  l 
loss yielded the best results for logistic regression while l 
loss worked best for svms  we also tried a variety of regularization parameters c ranging from  e   to  e   and c  
was close to optimal 
in figure   we compare the accuracy of logistic and linear
svm classifiers for the models described in section     
the two methods perform very comparably  champion
choice in model   gives us reasonable predictive power 
adding in game state in model   helps us significantly  but
further adding in early game item choice in model   does
not improve performance 

model accuracy for linear clasifiers
logistic
svm

    
    
  fold cv accuracy

on the game outcome y and influence the item choice x 
then our typical ordinary least squares assumptions would
be violated  as the error term  in the estimated model of
y      x    is now correlated with x  psm handles
this endogeneity by modeling the probability of being allocated to the treatment x  buying item  via logistic regression on z  game state   the logistic regression of x on
z yields propensity scores p  x   x z  for each observation  observations are then paired based on propensity
scores via nearest neighbors  such that observations i  j in
which xi     are paired with those in which xj    
and p  xi  zi    p  xj  zj   and covariates z are counterbalanced across the entire group  this procedure yields a
new dataset where xz  allowing unbiased estimates of
the causal effect of x on y via ordinary least squares regression 

    
    
    
    
    
    

 

 

model

 

table    representative  unmatched  data

id
  
  
   
  

mejai
 
 
 
 

gold
     
     
    
     

p  x z 
   
   
   
   

table    propensity score matched data

id
  
   
   
   

mejai
 
 
 
 

gold
     
     
    
    

p  x z 
   
   
   
   

figure    linear classifier performance

table   presents the confusion matrix for logistic regression
evaluated on a separate test set  the results for linearsvm
are very similar and the two methods appear to do slightly
better predicting games where the player won 
table    linear model confusion matrix

win
loss

predicted win
   
   

predicted loss
   
   

       n onlinear models

     predictive classifiers

though item choice did not improve predictive performance in linear models  we hoped to see more significant
results for nonlinear models which could take into account
the situation effectiveness of different items 

as described in the methods  we tried to predict match wins
in terms of various subsets of the champion  early game
state  and early item features 

in figure   we compare the accuracy of svm using linear 
degree   polynomial and degree   radial basis function kernels  for the models described in section      the numbers

   results

fiquantifying decision impact in moba games

model   accuracy wrt tree depth
    
    
  fold cv accuracy

here are slightly different than in the previous figure since
they were obtained from an independent experiment  the
linear kernel has the highest accuracy  though it only outperforms the degree   rbf slightly       for model     the
degree   polynomial kernel is significantly worse than the
other two  again  adding game state in model   improves
accuracy by      for the linear kernel  further adding item
choice in model   only improves performance by      

    
    

    

linear
polydeg 

  fold cv accuracy

    

    

svm kernel comparison
    

    

    

 

 

radialdeg 

    

 
tree depth

 

 

figure    adaboost depth parameter tuning

    

    

overfitting for depth   adaboost

   

test set
training set

    
 

 

 

   

figure    accuracy of svm kernels

along the same vein  we also tried decision trees to see
if we could identify context dependent item choice impact  we evaluated random forests  gradient boosted decision trees  as well as adaboost tree ensembles  for depth
d        the adaboost algorithm had the best accuracy on
  way cross validation 
to find the optimal tree depth in figure   we compare  
way cv scores for model    win  champions   state  
items  and see that depth   trees perform the best  increasing the depth yields higher training accuracy but worse test
accuracy  for instance  in figure   we compare training and
test accuracy for depth   and see that there is substantial
overfitting even in model   
the breakdown of the impact provided by the champion
choice  state  and items is then given in figure    the results
are very similar to what we saw for linear classifiers 
       p redictive c lassifier a nalysis
it appears that any additional predictive power provided by
item choice is outweighed by the overfitting that occurs 
this is especially true for decision trees where any additional depth beyond d   yielded worse results  both decision trees and kernel svms were unable to learn any of the
truly nonlinear effects of item choice  we tried to reduce
dimensionality the by considering only the most frequently
purchased    items and most frequently played    cham 

raw accuracy

model

   
   
   
   

 

 

model

 

figure    adaboost overfitting at depth  

pions but the results did not improve  principal component
analysis was not helpful because each feature only accounts
for a small independent fraction of total variance 
     propensity score matching
we implement propensity score matching on our dataset
in order to estimate the causal impact of items chosen to
be most predictive of winning games via logistic regression  we balance selection into purchasing these items
across the observed covariates related to game state  gold  
gold    xp   xp    champion  role  lane  xp differential 
damage differential  logistic regression is used to generate propensity scores and observations are paired based
on nearest neighbors using propensity score  the below
diagram displays propensity scores both before and after
propensity score matching  we see that the distribution of
propensity scores is much more similar between treatment
and control groups after matching 

fiquantifying decision impact in moba games

the relative coefficients weightings and sign are noteworthy 

model accuracy for depth   adaboost trees
    

  fold cv accuracy

    
    
    
    
    
    
    

 

 
model

 

the negative logistic regression coefficient on hunters potion  for example  would suggest that the item is commonly
bought by the losing team  on the other hand  the positive psm coefficient on the item would suggest that in
similar situations with comparable champions and game
state  players who bought hunters potion fared better  this
agrees with general player intuition on the item  as hunters
potion is considered a catch up item that provides good
value when behind but lesser value when already winning
the game 

   conclusions
figure    adaboost results

predictive classifiers introduced in section     overfit and
perform poorly in taking advantage of item choice data 
this suggests that items as a whole are fairly well balanced
so that it is hard to distinguish truly powerful items from
noise 
nevertheless  when we focus on specific items  even after correcting for endogenous confounding variables in the
game state using propensity score matching  we see that
certain items such as the infinity edge appear to have a
modest but significant impact on the game 

references
figure    propensity scores before and after matching

we then use least squares regression on the matched dataset
in order to estimate a causal effect of item purchase on subsequent game outcome  since this process is relatively time
intensive and must be performed with a covariate item at a
time  we decided to look at the most predictive items found
via regularized logistic regression and compare those coefficient estimates with the coefficients we find from psm 
table    psm vs logistic regression item coefficients

item id  name 
      infinity edge 
      enchantment  alacrity 
      stalkers blade 
      manamune 
      hunters potion 
      enchantment  captain 

psm
      
      
      
      
      
      

raw
     
     
     
     
      
      

from table    we see that items do not always map well
from their logistic regression coefficient to their psm coefficient  while we cannot directly compare the magnitudes 

riot games api  https   developer riotgames 
com api methods  accessed             
athey  susan and imbens  guido  machine learning methods for estimating heterogeneous causal effects       
http   arxiv org abs            
athey  susan and mobius  markus  the impact of news
aggregators on internet news consumption  the case of
localization  working  technical report       
foster  e michael  instrumental variables for logistic regression  an illustration  social science research    
                    issn         x  doi  http 
  dx doi org         ssre           
guyon  isabelle and elisseeff  andre  an introduction to
variable and feature selection  j  mach  learn  res     
          march       issn           
joseph  a   fenton  n  e   and neil  m  predicting football
results using bayesian nets and other machine learning
techniques  know  based syst                 november       issn           
kateofspades and kai  praetor  ripples item analysis 
http   maryschmidt github io ripples  
accessed             

fi