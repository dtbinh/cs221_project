   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

pileup subtraction and jet energy prediction using machine learning

vein s kong
stanford university

skong   umich   edu

jiakun li
stanford university

jiakun   stanford   edu

yujia zhang
stanford university

yujiaz   stanford   edu

abstract
in the large hardron collider  lhc   multiple
proton proton collisions cause pileup in reconstructing energy information for a single primary
collision  jet   this project aims to select the
most important features and create a model to accurately estimate jet energy  different machine
learning methods were explored  including linear regression  support vector regression and decision tree  the best result is obtained by linear regression with predictive features and the
performance is improved significantly from the
baseline method 

   introduction
with the development of the large hadron collider  lhc  
we are able to collide particles in a highly contained and
powerful environment  this allows us to observe the activity of proton proton collisions which produces jets  caused
by the formation of hadrons from quarks and gluons 
these jets give an indication of how much energy is produced on each collision  in the lhc  each event consists
of multiple collisions  which cause pileup particle interferences  making it hard to get the precise information from
the jets  currently its around    collisions per event  in the
future  there may be up to     collisions per event making
denoising of the data an important aspect for future lhc
research  there currently are some ways to reduce the
noise  but the method of mean centering the signal noise
ratio only works well in a few conditions  is there a novel
machine learning approach that can learn and identify irrelevant particles and remove their influence 

the objective of this project is to create a more accurate
model to estimate the true jet energy from the pileup noise
and identify the most predictive features in pileup subtraction  machine learning techniques such as linear regression  support vector regression and decision trees algorithms are tested and compared  all the regression models
outperform the current area based correction approach 

   related work
matteo cacciari and gavin p  salam  matteo cacciari 
      proposed an area based approach to subtract pileup
effects  a jets truth momentum is given by subtracting the
product of jet area and pileup momentum per unit area from
the measured momentum  however  this approach suffers
from inaccuracy by assuming pileup particles are uniformly
distributed within each event and the pileup effect is only
dependent on the jet area   peter berta        and  cacciari
et al         et al has developed algorithms using particle
level detail  but the approach is similar to  matteo cacciari 
        daniele bertolini        
     key metric
we will use the mean and the variance of the absolute error
as our metric 
n

error  

 x
 i 
 jptpred  tjpt i   
n  

   

n

 
error
 

 x
 i 
  jptpred  error    
n  

   

where jptpred is the predicted jet energy and tjpt is the true
jet energy 

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fipileup subtraction and jet energy prediction using machine learning

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

     area based approach
the current area based method is defined as follows 
jptpred   jptnoarea    a

   

where jptnoarea denotes observed raw jet energy   denotes
average energy density and a denotes area of the jet  which
is set at cirlce of     radius  cacciari et al         
the following table compares the offsets before and after the area based correction  it shows that the area based
method reduces the mean of the offsets closer to   but variance is still large
stats

before ab

after ab

mean
variance

     
      

    
     

table    key metric for area based approach

figure   shows the distribution of the gaps between the
estimated jet energy and the true energy before and after
the area based correction  the distribution after area based
method is shifted closer to the true jet energy but the two
distributions are very similarly shaped  suggesting that the
area based method just subtracts a constant value 

figure    distribution of offsets

     relative importance of features
jptnoarea  which indicates the raw energy observed  is
assumed to be the most important feature of our models
as we are trying to predict the energy itself  to identify
the other most relevant features  we ran a quick test on the
offset of corrected jpt vs  one feature 
we can see that only sumtrkpu has a linear relationship
with  jpt   tjpt   this means that when there are more
charged pileup particles within the jet area  the area based

figure    prediction offset vs key features

approach tends to underestimate the jet energy  this finding suggests sumtrkpu should be taken into account to attain better performance in estimating jet energy 

   dataset
we worked with the slac scientists who provided us with
the dataset of       observations  each has a true jet energy  the number of collisions and    features  the sample
is produced with the monte carlo generator pythia    simulating proton proton collisions at sqrt s  equals    tev 
where s is the squared sum of the momenta of the colliding
particles 
the effect of pileup from multiple collisions in one crossing of the collider beams is simulated by adding particles
from additional pythia   collisions  the number of additional pileup interactions per bunch crossing is varied between    and     the fastjet  v       software is then used
to build anti kt    jets with r       two different set of jets
are reconstructed  the first set only uses particles from the
hard scatter event  and defines the hard scatter  or truth  jets
in the event  the second set is constructed using all particles in the event  including both hard scatter and pileup 
the jet area pileup subtraction correction is applied  this
is the collection of reconstructed jets  reconstructed jets
are then associated with truth jets based on a momentum
fraction criterion 
the pileup noise level is dictated by the number of
proton proton collisions  npv   in physical studies the actual number of collisions is an estimated value obtained
by counting the number of vertices reconstructed from
charged particle tracks  thus using npv as an input parameter can be an additional source of error in real application 
our training set was built out of     randomly sampled
data for each number of collisions  npv  and the rest was
used as the testing set  since our model is trained across

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fipileup subtraction and jet energy prediction using machine learning

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

different npvs  it should be able to operate without the
knowledge of the number of collisions 

that are closer to the query point 
       r egularized l inear r egression

     definition of key features
jpt   jet transverse momentum
jptnoarea   the raw observed jet transverse momentum including pileup energy contamination
sumtrkpv  total pt of charged particles in the jet from the
hard scatter  signal vertex 

we also worked on getting results for linear regression with
parameterization using ridge and lasso techniques 
lasso uses the l  norm of the weight vector as the regularization term  the lasso objective function is
min


m
n
x
  x  i 
 y  x i      
 j  
 m  
j  

sumtrkpu  total pt of charged particles in the jet from additional pileup vertices
rho  event pt density
jeta  jet psedorapidity  spatial coordinate describing the angle of a particle relative to the beam axis
sigma  rms of rho  measure of how large the point topoint fluctuations of pileup are in the event 

subject to

   training models
we tried three regression models linear regression  support vector regression and cart trees and compared
their performance 
     linear regression
the linear regression assumes the true jet energy tjpt to
be a linear combination of the input features xi with an
intercept term 

j  

 j     c

the ridge is very similar to lasso except it uses the l 
norm 
min


area  jet area   r    with r      jets are roughly circles
of radius r     
ptx  jpt computed in circles of radius x      corrected by
rho   area

pn

   

m
n
x
  x  i 
 y  x i       
j 
 m  
j  

subject to

pn

j  

   

 j      c

the result of regularized linear regression is the same as
the basic regression  the  parameter for regularization
was essentially    since regularization penalizes overcomplicated models  it reconfirms that our model is not
overfitting 
     support vector regression
support vector regression  svr  applies the kernel
method to train the model in a high dimensional feature
space without incurring additional computational cost  we
attempted support vector regression with gaussian kernel
and linear kernel to explore the influence of high order features and the interaction between features 
     cart tree

tjpt 

n
x

xj  j     

   

i j

it learns the coefficients of different features by minimizing
the sum of the square error across the training set  out of
the total    features    features are collision properties and
the other    features describe the jet energy distribution
within the circles of different sizes  we did an exhaustive
search on all features combinations for the first   features
and applied forward searching on the remaining ones  the
best feature combination for linear regression is given by
jptnoarea  sumtrkpu  sumtrkpv and pt   
based on the feature selection result obtained from simple linear regression  we ran a locally weighted regression
model which assigns higher weights the training data points

the regression tree is built out of the cart algorithm  in
each step  the tree splits the dataset into two subsets and
it always finds the best variable and the best position to
split on that variable which minimizes the mean square error across the training set  since the cart algorithm is
always choosing the best split  it is resistant to irrelevant
features  so we trained the decision tree model on all the
features 

   results
figure   summarizes the results for different models by
plotting the two metric values in x and y axes  the top
right dot corresponds to the baseline performance  which
is the area based approach  the blue cluster in the middle denotes the results obtained by linear regression with

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fipileup subtraction and jet energy prediction using machine learning

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

jptnoarea and rho area  in this case  linear regression outperforms the baseline method  this is because instead of
assuming uniformly distributed pileup  linear regression
learns about the relationship between average pileup density and total jet energy while constructing the model with
training data  it takes that information and stores them in
the coefficients as shown in table    also  note that jeta
and sigma sqrt area  do not improve the linear regression
performance  meaning detailed information about jet is not
significant in predicting jet energy 
 intercept 

jptnoarea

rho area

   

    

    

noarea and then subtract out the pileup from other jets
by sumtrkpu and to compensate for the error from oversubtraction with sumtrkpv and pt    ptx indicates the energy in certain radius and the available values range from  
to     pt   is the most important one because the medium
radius balances between jet energy and pileup addition 
locally weighted linear regression was also applied with
the best feature set  yellow triangle   it does not outperform regular linear regression  moreover  the training error
decreased whereas the testing error increased  which indicates possible overfitting 
support vector regression was also explored with gaussian
and linear kernels  the best performance is obtained with
linear kernel and also coincides with linear regression result using feature set    this indicates that the relationship
between features and jpt prediction is mainly linear  high
order features and feature interactions do not play a significant role in jpt prediction 

table    area based parameters

figure    performance comparison for different models

the blue dot numbered   in the bottom left represents linear
regression with jptnoarea and sumtrkpu  which has significant better performance than using rho area  this is because sumtrkpu is the energy of charged particles in the
pileup and the ratio between charged and neutral particles
in an event is roughly      therefore sumtrkpu helps predict the amount of pileup observed and has more relevance
compared to rho area  taking sumtrkpv into account further improved the performance  blue dot     sumtrkpv denotes the amount of charged particles in the jet  thus gives
us more information about jet energy 

the result for cart tree is shown by the green rectangle  it
performs better than area based approach and linear regression with jptnoarea and rho area  figure   ranks the top   
most important features in building the tree  the feature
of the highest importance is sumtrkpv and all the features
that follow are the jet energy within different subareas  the
decision tree uses the energy of charged particles in the jet
area as the basis and reconstruct the true jet energy with
the information within different radii  unlike linear regression which discovers and utilizes the linear relationship between specific features and the jet energy  the decision tree
performs prediction by fitting a piece wise function of subarea information without the knowledge of the observed jet
energy 

the overall best performance is given by linear regression
with jptnoarea  sumtrkpu  sumtrkpv and pt    blue dot    
the coefficients for the four features are listed in table   
 intercept 

jptnoarea

sumtrkpu

sumtrkpv

pt  

         

         

          

         

         

table    coefficents for the optimal linear regression model

intuitively this makes sense  the estimate is based on jpt 

figure    top    variable importance ranking from cart tree

to summarize the overall achieved performance  figure  
shows a comparison between the best obtained model and
the baseline method  area based approach   the red bar is
a histogram plot of the prediction error based on the best

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fipileup subtraction and jet energy prediction using machine learning

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

model  the mean and variance is summarized in table   
the trend curve for both distributions are constructed assuming normal distribution with the measured mean and
variance  it is observed that compared to baseline  our
model improved both mean and variance of the prediction 

acknowledgments
we would like to thank professor ariel schwartzman and
dr  francesco rubbo for the guidance and support throughout the project 

references
cacciari  matteo  rojo  juan  salam  gavin p  and soyez 
gregory  quantifying the performance of jet definitions
for kinematic reconstruction at the lhc  journal of high
energy physics                     
cacciari  matteo  salam  gavin p  and soyez  gregory 
softkiller  a particle level pileup removal method  the
european physical journal c                  
daniele bertolini  philip harris  matthew low nhan tran 
pileup per particle identification  jhep                
     
matteo cacciari  gavin p  salam  pileup subtraction using
jet areas  phys lett b     pp               
figure    linear regression vs area based

stats

area based

linear regression

mean
variance

    
     

    
    

table    key metrics comparison for area based approach and optimal linear regression model

   conclusion and future work
we worked with simulation data and identified relevant features for jet energy prediction  linear regression  support
vector regression and decision tree algorithms were applied
and linear regression produced the best result based on both
mean and variance metrics 
our work shows that there could be large improvements
made to the current area based approach  linear regression
with the four features listed in table   seems to give us
great results  it seems like using machine learning techniques in pileup subtraction has great potential 
future work would be to include running linear regression with a different dataset  the dataset will be generated
where the jets are produced in association with a higgs
boson so that we can test the improvement in a scenario
where the precise estimation of the jet energy is crucial 
we can also test our dataset on low energy jets to see how
our model works with data with the values      tjpt      

peter berta  martin spousta  david w  miller rupert leitner  particle level pileup subtraction for jets and jet
shapes  jhep                       

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fi