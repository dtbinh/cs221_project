 

cs     final project

classification of subject motion for improved reconstruction of dynamic
magnetic resonance imaging
feiyu chen
department of electrical engineering

abstract
subject motion is a significant problem in magnetic resonance imaging  mri   in this project  unsupervised learning using kmeans clustering  and supervised learning using logistic regression  lr  and support vector machine  svm  are implemented
and applied to solving     classification of mr images with without motion  and     estimation of current motion state based
on previous low frequency navigator signals      mr images with labeling of motion no motion and       navigator signals
are collected as the training and testing data  over    features were designed and manually selected for each learning approach
based on principle component analysis  pca   results show that  for unsupervised learning  the k means algorithm achieves
an accuracy of      for classification of mr images and a root mean squared error  rmse  of      in prediction based on
navigator signals  for supervised learning  svm using gaussian kernels achieves the best accuracy of      for classification
of non motion and motion images  and a rmse of       for estimation of motion states based on navigator signals  these
approaches provide a possibility for advanced reconstruction algorithms to perform more accurate motion corrections with or
without a large training set  and may improve the quality of clinical images 
introduction
among all the medical imaging modalities  mri is one of
the best candidates for evaluation and diagnosis of
diseases  because of its high spatial resolution  good softtissue contrast and no ionizing radiation  however  mri
requires relatively long scan times  and therefore is more
sensitive to subject motion during exams  subject motion
can create imaging artifacts such as imaging blurring 
ghosting  and reduced snr  and degrade image quality 
this limits its wide use in clinical diagnoses  in order to
overcome this disadvantage  several approaches have been
developed for improving speed and reducing motion
artifacts during reconstructions of acquired mri signals 
however  these approaches require classification and
estimation of motion  which is usually difficult to achieve 
the fundamental goal of this project is to classify the
images with without motion based on dicom images 
the second objective of this project is to estimate the
current motion state based on previous information on
patient positions  with the help of unsupervised and
supervised learning models  hopefully mri scanners can
automatically determine the significance of motion
artifacts  and perform appropriate corrections and
reconstructions based on prior information of motion 

has not been applied to prediction of motion states and
subject positions  which is the main focus of this project 
dataset   features
   motion artifacts in mri
a good understanding of the motion artifacts in mri is
helpful for designing features for learning  as data are
directly acquired in the frequency domain in mri  motion
artifacts of the displayed images are different from
common motion artifacts in optical photos  according to
the fourier transform theories  subject motion will cause
phase shift in the frequency domain  assuming several
parts of the data in frequency domain are corrupted by
motion  the image will show motion artifacts as blurring
and ghosting  which contain shifted replicas of the original
image without motion  as shown in fig   

fig    illustration of motion artifacts in abdominal mri

related work

   low frequency navigator signals for motion

both unsupervised learning and supervised learning have
been applied to solving mri problems  however  only
unsupervised learning has been used to classify mr images
for cardiac perfusion applications     few attempts have
been made to classify abdominal images and mixed images
with different body parts  supervised learning approaches 
such as support vector machine  svm   have been used to
classify functional mri data of brain states        however  it

low frequency signals are acquired before and after each
image frame as navigators for the real time motion state  as
the distance of subject motion can be estimated directly
from the phase of the low frequency signal  fig     
however  in contrast enhanced dynamic mri  many other
factors contribute to the motion estimation  among which
contrast change is the most significant one  this leads to
wrong estimation of current motion state  in this project 
this problem would be solved based on previous non 

fi 

cs     final project

contaminated signals  which would be beneficial for
clinical imaging 

the features being tested include 

   

estimation of motion severity

 

    a vector of previous signal values 

   

    the range of previous signal values 

 

    the mean of previous signal values 

   
 

    the slope from the beginning to the end 

   

    the center value of previous signals 

 
   

    the coefficients of  d polynomial fitting 

 
   
 

time points before the current point are extracted in a
sliding window pattern 

   

    
    
    
time per acquisition

    

    

fig    illustration of low frequency navigator signals in mri

   samples of images and navigators
for the first objective of the project     images with
motion and    images without motion were collected in
experiments conducted at stanford  and online searches of
public mr images  two sets are formed based on these
images  the first set contains images with similar regions
of the abdomen  the second set contains images with
different body parts  including the brain  the liver  the
pelvis  and the heart  for the second objective       
navigator signals are acquired in a continuous scan with
free breathing  where one breathing period is      time
points 

    the index of points with max and min values 
    the beginning slope and ending slope 
    the coefficients of linear fitting 
    normalizations
analysis  pca 

and

principle

components

after extracting the features  the values of each feature are
normalized with the statistical average   and standard
x
deviation   with x    
  pca is subsequently



performed on all training data to project the features onto
a subspace with maximized differences and efficiency  a
threshold of    energy of the first principle component is
used to determine the new feature space with reduced
dimension 

   pre processing and features
    images

methods

pre processing of images includes the following steps 

   learning models

 a  resize images into the same size of         
 b  divide each image equally into blocks 
 c  compute the features for each block 

    unsupervised learning using k means clustering

    the standard deviation of pixels in a block 

the unsupervised learning model being implemented is the
k means method  this method uses the geometric
distance between samples as the metric for classify and
cluster a set of samples in an iterative way  for
classification of images with motion and without motion 
the number of clusters is set to be two  for estimations of
the severity of motion  the number of clusters is set to the
number of discretized states 

    the number of points on edges 

    supervised learning using lr and svm

    the sum of intensity for the     center of images 

lr uses the sigmoid function as the regression model to fit
the labels with input features  it is implemented in
matlab using the stochastic gradient ascent algorithm
with coefficient         svm uses support vectors to
determine the boundary between classes with different
labels  the kernels in the dual optimization problem of
svm determine the hyperspace of features  linear kernels
 svml  and gaussian kernels  svmg  are two common
kernels and are implemented in this project  the
liblinear and libsvm toolbox    are used as
implementations of svml and svmg  respectively 

the features being tested include 
    the mean value of all the pixels in a block 
    the rank of the image  estimated from the singular
value decomposition  svd  

    the sum of intensity for the edges of the image 
    the ratio between   and   
    the total variation of the image 
    the ratio between the center intensity and edge
intensity of the frequency domain 
     the top     eigenvalues of the image 
     phase of the fourier transform of the image 
    low frequency navigator signals
before extracting features of navigator signals  they are
first discretized into         or    states  the previous    

   evaluations
    evaluation of classifications based on mr images

fi 

cs     final project

evaluations of the learning theories are conducted based
on the true positive  tp   true negative  tn   false positive
 fp   and false negative  fn  counts in leave one out
crossing validation experiments  as the size of training data
is relatively small  the accuracy  specificity  and sensitivity
of the learning theory are further computed based on these
indices 

    supervised learning using lr and svm

    evaluation of classifications based on lowfrequency navigator signals

table   supervised learning for classification of mr images with
motion and without motion

since the number of states is much greater than two  using
true and false cannot comprehensively show the accuracy
of each learning model  therefore  the root mean squared
error  rmse  is calculated between the estimates and the
reference labels in two fold cross validation experiments 
due to the large size of training data  the rmse is
normalized with the total number of states to provide a
fair comparison between different discretization of motion
states 

 s

est

 strue   

 

n test  n states

where s means the signal  ntest is the length of test data 
and nstates is the number of discretized states 

images

dataset    abdominal images
only

dataset    images with
variety of regions

features

           

                

 blocks

           

               

models

lr

svml

svmg

lr

svml

svmg

tp

  

  

  

  

  

  

tn

  

  

  

  

  

  

fp

 

 

 

 

 

 

fn

 

 

 

 

 

 

sensitivity

   

   

    

   

   

   

specificity

    

    

    

   

   

   

accuracy

   

   

    

   

   

   

    analysis of accuracy
      errors in unsupervised learning with k means

results   discussion
   classification of images with and without motion
the accuracy of each learning approach is evaluated for    
a set of abdominal images  and     a set of images of
different body parts  all learning approaches achieve
similar performance for the first dataset  compared with
unsupervised learning using k means  supervised learning
approaches generally achieve higher accuracy of      for
the images of different body parts 
    unsupervised learning using k means
the k means approach reaches an accuracy of     for
both cases  as shown in table    compared with the first
dataset  k means for the second dataset has higher
sensitivity        but lower specificity       
table   unsupervised learning for classification of mr images
with motion and without motion
images

dataset    abdominal
images only

dataset    images with
variety of regions

features

           

             

 blocks

           

             

tp

  

  

tn

  

  

fp

 

  

fn

 

 

sensitivity

   

    

specificity

   

   

accuracy

   

   

the main error of k means for classification of the second
dataset comes from mislabeling of points on the boundary
of the two classes  as shown in the red ellipsoid in fig    
the scatter plot of correct labeling also reveals it is
difficult to separate the two image classes using only these
two features  because of the mixture of labels in the center 
correct labeling for reference 

feature component   

rmse normalized  

all the three supervised learning approaches perform well
for the first dataset  svm with gaussian kernels achieves
slightly higher accuracy     higher   for the second
dataset  the three approaches achieve similar accuracy of
      however  svml achieves higher specificity       
while svmg achieves higher sensitivity       

k means clustering results 

without motion
with motion

feature component   

feature component   

fig    illustration of k means clustering for mr images
with without motion in the second dataset  the x and y axes
denote the two major feature components

      analysis of  blocks for supervised learning
the size total number of blocks influences the accuracy of
all supervised learning methods  as shown in fig     both
svml and lr show fluctuations of accuracy with changes
of the number of blocks  while the accuracy of svmg
remains stable for different number of blocks  however 
all the three approaches show a trend of accuracy increase
with increasing number of blocks  a possible reason is  the
efficiency of information increases with increased number
of blocks  which provides more features for training and
classification 

fi 

cs     final project

    supervised learning using lr and svm

    

supervised learning approaches achieve higher accuracy of
less than     compared with the k means approach 
svmg achieves the lowest rmse among all the three
supervised learning approaches  while lr performs better
than svml  table     the signal evolution curves also
show svmg fits the curve better than lr  lr has higher
accuracy and less noise than svml at the peaks and
troughs of the curve  fig     

accuracy of classification

    

   

    

    

lr
svmg
svml

    

    

 

 

 

 

 

  

  

  

k means clustering for    states 
kmeans clustering for    states

  

number of groups in each side

prediction
true value

  

fig    the accuracy of classification varies with changes in
number of blocks in each side

  
  
  

      training set size for supervised learning

  

training set size is another key factor for the accuracy of
supervised learning  as shown in fig     all the three
learning approaches demonstrate a tendency of accuracy
increase with increased training set size  when the training
set size is less than     there are fluctuations in the
classification accuracy for all three methods  therefore  it
is necessary to maintain a training set size of over    
    

  
 
 
 
 
 

 

   

    

    

    

    

    

    

    

    

    

logis c regression for    states 
logistic regression for    states
prediction
true value

  
  
  
  

accuracy of classification

   
  
  

    

 
 
 

   
 

lr
svmg
svml

    

   

 

 

   

    

    

    

    

    

    

    

  

  

  

  

  

  

  

  

   

    

svm using linear kernels for    states 
support vector machine for    states
prediction
true value

  

  

    

   

training set size

  

fig    the accuracy of classification varies with changes of the
training set size

   estimation of the position of motion based on lowfrequency navigator signals

  
  
  
  
 
 

    unsupervised learning using k means

 

as there are multiple classes in this classification problem 
and the differences between difference classes are relatively
small  unsupervised learning may encounter some difficulty
in generating appropriate clusters  however  with
appropriate features  the k means approach achieves a
rmse of less than     for       testing data points with
feature set            as shown in table    the curve in
fig   also shows k means can follow the signal evolutions
well  despite some minor delays in the decreasing periods 
table   rmse for estimation of motion states based on
navigator signals and       training data
 states

features

k means

lr

svml

svmg

  

         

     

     

     

     

  

         

     

     

     

     

  

         

      

     

     

     

 
 

 

   

    

    

    

    

    

    

    

    

    

svm using gaussian kernels for    states 
support vector machine for    states
prediction
true value

  
  
  
  
  
  
 
 
 
 
 

 

   

    

    

    

    

    

    

    

    

    

fig    illustration of estimation based on low frequency
navigator signals in mri using k means  lr  svml  and svmg
for signals with    discretized states

fi 

cs     final project

    analysis of performance
      analysis of the size of prior information
the size of prior information  i e   the length of time series
being used to generate features  may have an effect on the
accuracy of learning models  in specific cases with periodic
motion  the period of breathing is      time points  which
makes the choice more important  as shown in fig     only
lr shows an improvement of accuracy  rmse decrease 
with increasing length of prior information  k means and
svmg remains insensitive to the size of previous points 
and svml shows significant fluctuations with this change 
    

lr
svmg
kmeans
svml

rmse of estimation

    

    

   

    

    

    

    
   

   

   

   

   

   

   

   

   

    

    

    

size of previous points used

fig    changes of rmse with increasing size of prior
information   points used for feature extractions  using a
training set size of      for estimation of motion states based on
navigator signals

      analysis of training set size for supervised
learning
the relationship between the rmse of testing data and
training size is shown in fig     as the training size
increases  the rmse of lr  svml  and svmg for
supervised learning decrease  among the three supervised
learning methods  svmg preserves the highest accuracy
even with few training data 
lr
lr
svmg
kmeans
svmg
kmeans
svml
kmeans

rmse of testing data

    

conclusion   future work
   choice of learning models for motion classification
and estimation
if a large amount of training data with correct labeling is
available  supervised learning should be used for both
classification of images with without motion and
estimation of motion states based on navigator signals 
among the three supervised learning approaches  svm
with gaussian kernels provides the most stable and
accurate labeling for both cases  lr has slightly worse
performance than svmg  but it s also easier to understand
and implement 
if a reasonable amount of training data cannot be achieved 
the k means approach can give acceptable classification of
images with without motion  and good estimation of
motion states  while its accuracy is not as good as
supervised learning algorithms  it is not susceptible to the
length of time points used to generate features when doing
estimation based on navigator signals 
   limitations of current approaches
first  the size of training sets for classification of images
with without motion is limited  since no big public
database is available online  this limits the performance of
all the three supervised learning approaches  fig     
second  there are many kinds of subject motion during
clinical studies  therefore  a multi level classification may
be useful to improve the accuracy  third  due to hardware
limitations  the motion signal can only be discretized to   
states  more states would be beneficial to subsequent
motion corrections and reconstructions 
   future work

    

   

similar or fluctuates slightly as the number of states
increases  this shows the number of discrete states has
little impact on the estimation accuracy 

future work can be done in     exploring more advanced
learning models      collecting more samples of images
with without motion  and     conducting motion
correction based on the results of classification and
estimation of motion to see how machine learning can
help with motion corrections and reconstructions of mr
images 

svml

    

    

    

    

    

    

    

    
    

    

    

    

    

    

    

    

    

     

training size

fig    rmse of the testing data with increasing training size
using     points of previous signals for estimation of motion
states based on navigator signals

      number of discretized states
according to table    for unsupervised learning with kmeans  the estimation accuracy increases with the number
of discretized states  however  for all three supervised
learning approaches  the estimation accuracy remains

references

    stegmann  mikkel b   hildur lafsdttir  and henrik bw larsson 
 unsupervised motion compensation of multi slice cardiac perfusion mri  
medical image analysis                     
    mouro miranda  janaina  et al   classifying brain states and determining the
discriminating activation patterns  support vector machine on functional mri
data   neuroimage                      
    wang  ze  et al   assessment of functional development in normal infant
brain using arterial spin labeled perfusion mri   neuroimage                     
    chih chung chang and chih jen lin  libsvm   a library for support vector
machines  acm transactions on intelligent systems and technology                      software available at http   www csie ntu edu tw  cjlin libsvm

fi