fast detection of risk signals in post marketing drug surveillance
using costs in claims data  a machine learning approach
yihan guan   yiliang jin 
december        
abstract
we investigate a machine learning approach to fast detection of risk signals in post marketing drug surveillance using costs in
health care insurance claims data  we show that by employing a locally weighted linear regression model to predict post drug cost
distribution of a population taking a well known risky pain killer  vioxx   the safety signal can be discovered four months earlier
compared to a recent study using the same datasets  this project demonstrates the potential value of machine learning algorithms
in improving real time post marketing drug surveillance 
  introduction
traditional post marketing drug surveillance systems using health care insurance claim data monitor procedure codes and
diagnoses codes to detect adverse drug events  ades             one recent study     designed an active post marketing drug
surveillance system from a new anglemonitoring costs in health care insurance claims data  comparing post treatment cost
profiles of populations using alternative drugs based on risk adjusted group sequential analysis  and detecting increased spending
related to drug side effects  they showed that signals of excess risks can be detected earlier by tracking costs than by tracking
procedure diagnoses codes  however  in that study  the expected cost distribution of the population under surveillance was
constructed empirically rather than employing any learning method  furthermore  the effectiveness of this empirical method has
not been evaluated  error in predicting post treatment cost distributions could possibly delay the detection of a true risk signal  to
address this concern  the present project explores a machine learning approach to find the best prediction model of the
post treatment cost of the population taking the drug under surveillance  which can potentially facilitate fast signal detection  the
primary objective of this project is to find a supervised learning algorithm that works most effectively in predicting post drug cost
distribution  we further implement risk adjusted group sequential analysis to evaluate whether the learning algorithm improves
the timeliness of detecting a known risk signal 
  methods
    dataset description and features
in this project  two pre processed health care insurance claims dataset are used  the first dataset corresponds to a population
taking a top selling and well known safe pain killer  naproxen  this dataset has cost information of        individuals  the
second dataset corresponds to a population taking another top selling pain killer vioxx  vioxx was withdrawn from the market in
september      for its increased risk of heart attacks and strokes  this dataset has cost information of       individuals  notice
that these two datasets are mutually exclusive  i e   members who took both drugs are excluded from both datasets  the detailed
population selection rule can be found in      an example of one line of record in our datasets is shown in table   
member id

drug start date

gender

age

pre drug monthly cost     

post drug monthly cost     

xxxxx

         

male

  

   

    

table    an example of a record in the datasets
features of each member are gender  age  and pre drug monthly cost  to categorize a members post drug cost as either high or
low  we adopt the following decision boundary developed in     
high post drug cost     post drug cost   max        pre drug cost  
 

department of management science  engineering  email  yihan stanford edu

 

department of computer science  email  yljin stanford edu

 

pre drug cost is defined to be a member s average monthly cost during the six months before his her first prescription of the drug 

 

post drug cost is defined to be a member s average monthly cost during the six months after his her first prescription of the drug 
 

fi    supervised learning algorithms to predict post drug cost distribution
      classification
one way to obtain the post drug cost distribution is to first apply a classification algorithm to predict the binary post drug cost
   high    low  for each member in the test set  where gender  age  and pre drug cost are used as input features  as a next step 
members with post drug cost labels are stratified into risk groups according to their gender  age and pre drug cost  then we obtain
the distribution of high post drug cost members in each risk group  which will be used in group sequential hypothesis testing 
figure   illustrates the procedures in using classification algorithms 
features of individuals  gender  age  pre cost
training set 
 features  label 

learning
algorithm

h

stratify people into
subgroups  derive the
distribution of high post cost

predict post cost     
for each individual

testing set 
 features 

figure    procedures in using classification algorithms
specifically  features are defined as the following 


gender            male    female  



age                       year old          year old          year old        year old or above  



pre drug cost is discritized into   buckets                                                                           and
             so that the number of members in each bucket is roughly balanced 

      linear non linear regression algorithms
an alternative way to obtain the post drug cost distribution is to use a regression algorithm  specifically  we first stratify members
into risk groups according to their individual features and obtain an id of each risk group as the group feature  next  a regression
algorithm is applied to predict the probability of each group having high post drug cost  figure   illustrates the procedures of this
method 
feature of subgroup  subgroup id

stratify people
into subgroups

training set 
 features  probability
of high post cost 

testing set 
 features 
learning
algorithm

h

predict the probability
of high post cost

figure    procedures in using regression algorithms
   learning algorithm selection
to find a suitable supervised learning algorithm to accurately predict the post drug cost distribution  we experiment several
algorithms on the first dataset  hold out cross validation      of the dataset is used as a training set  and     of the dataset is
used as a test set  is used to compare the performances of different algorithms 
    classification algorithms
      logistic regression and gaussian discriminant analysis gda 
for logistic regression and gaussian discriminant analysis  linear boundary case   the input features are defined as a vector
 

excluded from the datasets are members with pre drug costs over        the rationale for this exclusion is that members with high pre drug

cost have considerable pre treatment conditions  and thus it could be argued that the effects under study are due to confounding factors rather
than the treatment drug  in addition  these members show high variance in their health service utilization  which can translate into unstable
statistical estimates     
 

fix   x  x   x    t   where x   x   x  are gender  age  and pre drug cost  respectively 
      naive bayes and support vector machine  svm  with linear kernel
to apply naive bayes with laplace smoothing and svm algorithm  the input feature vector x  r   can be written as the
following  based on the definitions of features in section       
age

gender

x  

 

 

 

 

 

 

pre cost

   

 

 

 

 

  

t

   

 

 

 

      hold out cross validation
in this section  we use hold out cross validation to compare the performance of the above classification algorithms in predicting
post drug cost distribution  the training set consists of     of the dataset  randomly selected   and test set consists of the rest    
of the data set  the results of hold out cross validation is shown in table   
learning algorithm

logistic regression

gda

naive bayes

svm

hold out cross validation error

      

      

      

      

table    cross validation result of four classification algorithms
the learning curves of logistic regression and gda are plotted in figure    we observe that these two prediction models both
have high bias  which is likely to be caused by the fact that there are too few features  however  due to the limitation of the
current dataset  more features are not accessible to us 
learning curve of logistic regression

learning curve of gda

    

    

    

    

    

    

   

   

    

    

    

 

    

    

    

training error
test error

error

error

training error
test error

    

    

    

 

size of training set

    

    

    

    

    

size of training set

figure    learning curves of logistic regression and gda
    linear non linear regression
to tackle the problem of overly high bias  we consider applying linear and nonlinear regression algorithms  since the ultimate
goal of this project is to detect the risk signal in a series of group sequential hypothesis testing which only requires to know the
predicted distribution of high post drug cost in risk groups  linear non linear regression can be utilized to predict the probability of
each risk group having high post drug cost  namely  we focus on each risk group  instead of predicting each individuals post drug
cost as in section     
      regression models
as described in section        the input feature is the id of risk groups  unweighted regression and weighted regression are
experimented  respectively 


unweighted regression  linear  quadratic  cubic and  th order polynomial models are considered to fit the training set 



weighted regression  locally weighted linear regression is used to fit the training set  where the local weight is defined as 
   x  x i      
w i    exp  

    

 

where  is set to be     
 

fi      reducing variance  choosing an appropriate number of risk groups
as described in section        the entire population can be stratified into               risk groups  the left panel in figure  
depicts the probability of having high post drug cost of each risk group given by unweighted regression models  and the right
panel plots the fit given by weighted linear regression model  evidently  high variance appears in both the training data and the
test data under all regression models that are considered  this comes from the fact that many risk groups only contain few people
 less than     which makes the estimates not reliable 
weighted linear regression

unweighted regression

   
training data
linear
quadratic
cubic
 th degree
testing data

   

   

probabiliy having high post cost

probability having high post cost

 

   

   

 

   
   
   
   
 
    

 

  

  

  

  
   
subgroup

   

   

   

training data
weighted linear regression
testing data

 

 

  

  

  

  
   
subgroup

   

   

   

figure    probability of having high post drug cost in     risk groups
therefore  to ensure each group has a good sample size  we combine all age groups  namely we only use gender and pre drug cost
to define risk groups and get    risk groups  eight female and eight male groups   the left panel of figure   demonstrates the fit of
the eight female groups using unweighted regression models  and the right panel shows the fit of the same groups using the
weighted linear regression model  it can be seen that the weighted linear regression and the  th order polynomial regression model
fit the training set well  on the other hand  the weighted linear regression fits the testing set best 
weighted linear regression

unweighted regression
   

probability having high post cost

probability having high post cost

   

    

   
training data
linear
test data
quadratic
cubic
 th polynomial

    

 

     

 

 

 

 

 

 

 

 

 

    
    
    
    
   
    
training data
weighted linear regression
test data

    
    
    

 

 

 

 

 

 

 

 

 

pre cost group

pre cost group

figure    probability of having high post drug cost in eight female risk groups
      choosing the best prediction model  hold out cross validation
to choose the one that performs the best  we compare five regression models via hold out cross validation  table   implies that
the locally weighted linear regression has the smallest variance both for female and male groups  hence  we choose this model to
construct the expected post drug cost distribution of vioxx group  and implement group sequential analysis to see how early the
sequential tests can raise the signal of excess spending in vioxx group 
male

         

linear

         

         

unweighted

quadratic

         

         

regression

cubic

         

         

 th order polynomial

         

         

locally weighted linear regression
variance

female
  

       

table    cross validation result of regression models

 

the null hypothesis of the sequential tests is that vioxx group has the same post drug cost distribution as naproxen group  hence naproxen

group serves as a baseline  whose post drug cost distribution is regarded as the expected post drug cost distribution of vioxx group 
 

fi   group sequential analysis
detailed descriptions of the group sequential analysis can be found in      briefly     monthly hypothesis tests are conducted on
accumulating vioxx data from july   st       to july  st        at each month  t   the p value of a chi square goodness of fit test
p value t  is compared to a significance level  t  which is given by alpha spending function approach     so that the overall
significance level of these    tests are controlled at       a signal is detected at t once p value t  falls below  t   using the locally
weighted linear regression model to calculate the expected post drug cost distribution of vioxx group  we detect the risk signal in
the   th month since the testing starts  in the previous work where an empirical method was used to calculate the expected
post drug cost distribution of vioxx group      the signal was found in the    th month  figure   compares the group sequential
testing results of the present work  blue dashed curve  to those of the previous work  green dashed curve   consequently  the
locally weighted linear regression model speeds up the signal detection by   months  which is a remarkable improvement in the
context of post marketing drug surveillance 
 

  

  

  

  

  

  

  

p value t  obtained by empirical method
p value t  obtained by weighted regression
alpha t 

  

  

  

  

 

 

  

  

  
month

  

  

  

  

figure    group sequential testing results
   conclusion
this project demonstrates the potential value of machine learning algorithms in improving real time post marketing drug
surveillance  we show that by employing a locally weighted linear regression model to predict post drug cost distribution of the
population taking a risky drug  the safety signal can be detected considerably faster compared to a recent study using the same
datasets  rapid signals detected by our method can trigger timely investigation for underlying reasons of excess spending  if the
excess spending is indeed caused by adverse drug events  our method can potentially save lives and reduce health care costs 
references
  

j  a  berlin  s  c  glasser  and s  s  ellenberg  adverse event detection in drug development  recommendations and
obligations beyond phase    am j public health                   aug      

  

m  v  bjarnadottir  data driven approach to health care  applications using claims data  ph d  thesis  massachusetts institute
of technology       

  

m v  bjarnadottir  y  guan  follow the money  monitoring cost in health care claims data for real time post marketing drug
surveillance  working paper       

  

j  s  brown  m  kulldorff  k  a  chan  et al  early detection of adverse drug events within population based health networks 
application of sequential testing methods  pharmacoepidemiol drug saf                         

  

j  s  brown  m  kulldorff  k  r  petronis  et al  early adverse drug event signal detection within population based health
networks using sequential methods  key methodologic considerations  pharmacoepidemiol drug saf                      

  

d  l  demets and k  k  g  lan  interim analysis  the alpha spending function approach  stat med                      
     

 

fi