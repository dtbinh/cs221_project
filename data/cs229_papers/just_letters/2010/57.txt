 

machine learning approaches to automatic bi rads classification of
mammography reports
bethany percha
i  introduction
the average american radiologist interprets at least
      mammogram reports each year  or approximately
one new mammogram every    minutes      because radiologists interpret so many mammograms and because the
proper interpretation of a screening mammogram is often
a matter of life or death for the woman involved  various
attempts have been made to streamline the mammography reporting process and introduce consistent structure
and terminology into mammography reports 
one important advance is the bi rads assessment coding scheme  figure     a seven level classification used to
summarize a report and classify it into a distinct category
based on the radiologists overall assessment of the case 
the bi rads assessment codes are designed to be translatable across physicians and institutions  and to serve as
a basis for clinical follow up  they also provide a convenient tool for researchers  since the codes are machineinterpretable and can be used in lieu of unstructured textbased diagnoses in large scale clinical studies 
  incomplete
  negative
  benign finding s 
  probably benign
  suspicious abnormality
  highly suggestive of malignancy
  known biopsy   proven malignancy
fig     the seven possible bi rads assessment codes and their
meanings 

in theory  two radiologists who independently assess the
same mammogram will produce reports with very similar
terminology and identical bi rads codes  and in fact 
if radiologists use consistent terminology to describe what
they see  it should be possible to assign the bi rads codes
automatically  a computer should be able to read the
report and predict the code based on the radiologists description of the image  a learning algorithm that could
perform this task would be useful in three ways 
   quality control  the bi rads class represents the
radiologists overall impression of an image  and the
rest of the report contains a description of what the
radiologist saw  if two radiologists use very similar
terminology to describe an image but assign it to different classes  it means that either the bi rads class
boundaries are unclear or at least one of the radiolodepartment of biomedical informatics  stanford university  stanford  ca            e mail  blpercha stanford edu  this report was submitted as my final project for cs                autumn      

gists was using insufficiently precise terms to describe
the image 
   training software  a large part of radiology residents
training consists of learning to describe image features
in a consistent way so that other physicians can easily
interpret the report  a learning algorithm could be
used to develop software that could provide real time
feedback to radiology residents  i e  doctor  your
description of this mammogram seems to correspond
to bi rads class    do you agree  if not  please
modify your description   
   feature selection  the algorithm could be used to
help find the words and phrases most indicative of
each class and make radiologists aware of the terms
their colleagues are using to describe the various
classes  thereby increasing consistency in reporting 
in this report  i describe a machine learning approach
to the automatic bi rads classification of mammography reports based on fairly extensive preprocessing followed by the application  and optimization  of several supervised learning techniques  including multinomial naive
bayes  k nearest neighbors  and support vector machines
 svm  
ii  preprocessing
a  constructing the training corpus
a total of        mammography reports were extracted
from the radtf database at stanford university  the
radtf database was designed by radiologists bao do and
daniel rubin and serves as an educational tool for the
training of radiology residents  of these reports        
were diagnostic mammograms  not readings of mammograms from outside facilities  descriptions of ultrasoundguided biopsy procedures  or analyses of extracted tissue
specimens   of the diagnostic mammogram reports        
contained bi rads codes  older reports frequently do not
have them  and were unilateral  single breast  mammography reports  these        unilateral  diagnostic reports
constituted the training corpus 
b  report structure
mammography reports present an ideal corpus for work
at the interface of machine learning and natural language
processing  because of the large number of mammograms
conducted each year  both in the united states and around
the world  physicians have established fairly strict guidelines for the structuring of these reports  the reports usually consist of three sections 
history begins with report type  such as unilateral
diagnostic mammogram  patients personal and
clinical history  including age  cancer status  fam 

fi 

fig     distribution of reports in training corpus by bi rads outcome class 

ily history  medications  and previous radiological exams surgeries are described 
findings includes a description of the breast tissue
density and any defining features  such as scars from
previous biopsies  location and characteristics of any
masses are described  including size  position  and nature of margins  edges  
impression contains one or more bi rads assessment codes and the radiologists impression of whether
the patients condition warrants additional clinical
follow up 
most of the relevant description of the breast tissue and
any abnormalities is in the findings section of the report 
while the final bi rads classification is typically located
at the beginning of the impressions section  this is extremely convenient from the standpoint of classifier training  since the impressions sections can easily be removed
from the report and parsed to determine the bi rads
assessment class  outcome variable   while the findings
sections can serve as the input features for the classifier 

fig     preprocessing pipeline for mammography reports  the processed findings sections were then converted into feature vectors
with components equal to the number of times each stem appeared
in the report 

the bi rads outcome class was obtained for each report by searching the impression section for the term
bi rads or birads  not case sensitive  and using the
first number found after the term as the category  this
method worked surprisingly well   out of     randomlychosen reports confirmed by hand       were classified
correctly  the numbers of reports in each bi rads outcome category are shown in figure    the vast majority
of mammograms were negative for cancer 

found in the corpus  one per line  was a document over
    pages long  furthermore  many of these words were
actually abbreviations or shorthand forms of longer words 
for example  the terms abnl  abnormal  and a dozen
or more misspellings and concatenations all referred to the
same thing  i constructed my own spell checker to deal
with the misspellings and concatenations  and to expand
the abbreviations  but the process was laborious 
briefly  the preprocessing procedure consisted of first extracting the findings sections from the reports  eliminating numbers and punctuation  spell checking the text  and
expanding the abbreviations  stop words  high frequency
words with little information content  such as and and
of  were removed  and a porter stemmer     was applied
so that variants such as asymmetric and asymmetry
would appear as a single feature in the feature vector  the
original and preprocessed versions of a sample report are
shown in figure    a corpus wide histogram of the remaining word stems  ordered by frequency  is shown in
figure    all of the preprocessing for this project was
done using custom scripts in python  version          

d  further preprocessing

e  construction of feature vectors

a significant amount of further preprocessing was required before any machine learning techniques could be
tried  a summary of the preprocessing procedure is shown
in figure    one major problem with these reports was the
amount of misspelled and concatenated words  raw radiology reports are usually spoken aloud  recorded  and later
transcribed into text by assistants  this can lead to many
unusual typographical errors  a list of all the unique words

after preprocessing  the entire corpus of findings sections consisted of patterns of       unique stems  the
processed reports were then converted into feature vectors 
where each element was the number of times a given stem
appeared in a report  interestingly  many of the reports
used identical terminology  figure   shows four template
findings sections that together accounted for the majority
      of all bi rads class   reports 

c  assigning outcome classes

fipercha  bi rads classification of mammograms

 

nal feature space  svms outperformed both naive bayes
and knn  achieving       classification accuracy on   fold cross validation  liblinear offers two options for
dealing with multiple outcome classes  one based on the
standard l  norm penalized svm and the other based on
a sequential dual formulation by crammer and singer     
but these showed no difference in performance  a grid
search     was used to optimize the cost parameters for the
svms  all results shown in figure   are for the optimized
classifiers 
c  feature weighting

fig     word stems ranked by frequency in the training corpus 

freq 
    

    

    
    

text
breast tissue is of scattered fibroglandular density  there are no mammographic features of
malignancy 
breast tissue is heterogeneously dense which
decreases mammographic accuracy  there are
no mammographic features of malignancy 
breast tissue is largely fatty replaced  there
are no mammographic features of malignancy 
breast tissue is dense which decreases mammographic accuracy  there are no mammographic
features of malignancy 

fig     four common findings sections for bi rads   reports 
these exact combinations of words were used in over     of birads   reports 

iii  classification
a  multinomial naive bayes and k nearest neighbors
once the feature vectors were constructed  multinomial naive bayes and knn  best performance  k      
classifiers were used to classify the reports using    fold
cross validation  the naive bayes and knn parts of the
analysis were done in weka  version             standard naive bayes  which used binary instead ordinal features  achieved       cross validation accuracy  multinomial naive bayes achieved       accuracy  and knn
achieved       accuracy  a learning curve for the multinomial naive bayes classifier showed that the misclassification error was the result of high bias  underfitting  
the classifier performed just as well using only     of the
training data  and its performance leveled out when larger
training sets were used  as a result  the goal of subsequent analyses was to obtain a larger and more optimal
set of features 
b  support vector machines
with the goal of eventually moving to a higherdimensional feature space  support vector machines were
also used to classify the reports  the first trials were
performed using liblinear      which did not increase
the dimensionality of the feature space  liblinear uses
only a linear kernel  but did show that even in the origi 

in document classification  it is common to weight the
features  words or word stems  using some measure of
their importance  usually this measure is based on term
frequency in the corpus  but there are many options 
two forms of term frequency weighting were used in this
project  standard tfidf weighting and tfcnfx weighting  which is known to outperform tfidf in some cases
     the weight of term i in document j is given by 
tfidf  wij  

tfij  log n ni  
len j 

tfij  log n ni  
tfcnfx  wij   qp
len j 
 
k    tfkj  log n nk   
where len j  is the length of document j  tfij is the number of times term i appears in document j  n is the total
number of documents  and ni is the number of documents
in which word i appears  standard tfidf weighting actually decreased the performance of the svm classifiers 
although it increased the performance of the knn classifier  figure     tfcnfx weighting  on the other hand 
always increased classifier performance  the linear svm
still performed best at this point  with       accuracy on
   fold cross validation 
d  polynomial kernel
although the linear svm performed well  transforming
the data into a higher dimensional feature space still held
promise for reducing misclassification error  the degree  
polynomial kernel is often used in text classification because its feature space is the space of all one  and two word
phrases contained in the document  the liblinearpoly  library is nearly as fast as liblinear and uses
the degree   polynomial kernel  it was therefore employed
to test whether transformation into a higher dimensional
feature space could improve performance  in fact  after optimization the polynomial svm classifier performed nearly
   better  achieving       accuracy on    fold crossvalidation  see figure    
e  feature selection
to obtain a set of features that would optimize the performance of the degree   polynomial classifier  the features were ranked using chi squared attribute evaluation in
weka  subsets of features of different sizes were then used

fi 

technique
naive bayes
multinomial naive bayes
k nearest neighbors  k    
support vector machines
liblinear  l  norm  one against one 
liblinear  multiclass crammer 
liblinear poly   polynomial kernel  degree   

percent accuracy
no weighting tfidf tfcnfx
    
    
    
    
    
    
    
    

    
    
    

    
    
    

fig     comparison of    fold cross validation accuracy for various classification techniques  the best performing technique was a svm
 l  norm  one against one for multiple outcome classes  that used a second degree polynomial kernel 

v  some informative errors

fig     performance of degree   polynomial classifier vs  number of
features used in classification  features were initially ordered using
chi squared attribute evaluation 

to train the classifier and its performance was evaluated
using    fold cross validation  the results of this analysis
are shown in figure    the classifier achieves optimal performance using only the top     features  although performance does not decrease when additional features are
included  confusion matrices for the optimized classifier
are shown in figure   
iv  most informative features
the list of the most informative features chosen by chisquared attribute evaluation is interesting in its own right 
the top    features are shown in figure    the stem incomplet was most informative because it is seldom if ever
used outside the context of bi rads class    incomplete 
reports  although common  the stem breast was informative because it served as a proxy for the overall length
of the report  shorter reports tended to describe mammograms that were negative for cancer  while more serious
cases warranted more description  stems used to describe
previous biopsies  such as scar and stabl  helped distinguish reports from class    which often includes patients
with fibrocystic breast disorders that lead to repeated biopsies for benign cysts  terms referring to widespread or illdefined masses or calcifications  pleomorph  calcif  or
those used to localize masses within the breast  oclock 
nippl  usually correspond to bi rads class       or   

figure   shows that the classifier performed very well on
certain classes of report and less well on others  it was excellent at splitting class   and   reports off from the others 
this is likely because class   reports contained the telltale
stem incomplet and class   reports often used identical
terminology  figure     the classifier also performed well
on class   reports  though it sometimes mistook a report
of a benign lesion as a fully negative  class    report 
class   reports  probably benign  were only classified
correctly      of the time  reflecting the inherent ambiguity of that class and the fact that it is  in some respects  the
most dangerous class for a patient to be in  many of the
reports in class   used terminology that sounded as harmless as a class   or even class   report  which is why      
of class   reports ended up in class   and another      
ended up in class    however        of class   reports used
terminology that sounded more sinister than a description
of a benign cyst  some of this could be due to negation  for
example  one misclassified report included the phrase  no
new focal dominant mass  architectural distortion  or suspicious microcalcifications are identified  which was full
of class     terms once the stop word no was removed 
class   reports were all classified as class    which again
reflects the fuzzy conceptual boundary between suspicious
abnormality and highly suggestive of malignancy  in a
way  class   is really a subset of class    and is assigned
very infrequently  perhaps only to emphasize the fact that
the patient needs clinical follow up as soon as possible 
perhaps the most interesting result of all was how frequently class   reports were misclassified        of the
time   the reason appears to be that the patients involved
have already been diagnosed with breast cancer and are
usually undergoing treatment  the mammograms are used
to monitor the course of treatment  and often the radiologist does not describe the cancerous lesions in full detail 
in addition  patients who are in remission from breast cancer are still assigned to class    so some class   reports can
actually sound quite optimistic 
vi  conclusions and future directions
in conclusion  it is indeed possible to classify mammography reports into bi rads classes using a bag of words

fipercha  bi rads classification of mammograms

class
 
 
 
 
 
 
 

 
    
  
  
  
  
 
 

 
  
     
   
  
  
 
 

classified as     
 
 
 
  
 
  
   
  
 
    
 
  
   
  
  
  
 
   
 
 
  
  
 
  

 

class
 
 
 
 
 
 
 
 

 
 
 
 
 
 
 
  

 
 
 
 
 
 
 

 
    
   
   
   
   
   
   

 
   
    
    
    
   
   
   

classified as     
 
 
 
   
   
   
   
   
   
    
   
   
    
   
    
    
   
    
   
   
     
    
   
    

 
   
   
   
   
   
   
   

 
   
   
   
   
   
   
    

fig     final confusion matrices for the liblinear poly  classifier using the top     features  the left matrix includes absolute numbers
of reports  while the right matrix shows the distribution of classifications  in percentages  for each real bi rads class  the diagonal elements
of the matrices  correct classifications  are bolded 

rank
 
 
 
 
 
 
 
 
 
  
  
  
  
  
  
  
  
  
  
  
  

stem

most common context

incomplet
nippl
evalu
breast
featur
malign
neg
stabl
mammograph
calcif
left
marker
right
echoic
biopsi
hypo
oclock
post
scar
pleomorph
mass

incompletely evaluated
x cm from the nipple  describing a mass  
incompletely evaluated
 many contexts  
no mammographic features of malignancy
no mammographic features of malignancy
breast is negative
stable post biopsy change
no mammographic features of malignancy
calcifications
 many contexts  
scar marker  post biopsy marker 
 many contexts  
hypoechoic mass
post biopsy change
hypoechoic mass
 describing mass location  
post biopsy change
scar marker  post biopsy marker 
pleomorphic calcifications
 many contexts  

occurrences per report by class
 
 
 
 
 
 
 
   
   
   
       
   
   
   
   
   
   
   
   
   
   
   
   
       
   
   
   
   
   
   
   
   
   
   
       
   
   
   
   
   
       
   
   
   
   
   
   
   
   
   
   
   
   
       
   
   
   
   
   
       
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
       
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   

fig     the most informative features  along with the mean number of times they appeared in a report from a given class 

approach to the report text combined with a machinelearning algorithm based on an svm in a high dimensional
feature space  such an algorithm would probably prove
most useful in the context of training software  especially
for teaching residents how to unambiguously differentiate
benign and suspicious lesions  it could also be useful in
decision support software  allowing radiologists to determine whether their descriptions and recommendations for
clinical follow up are consistent with those of hundreds of
other physicians 
the most severe bottleneck in this project occurred at
the preprocessing stage  and was the result of the large
number of misspellings  concatenations  and abbreviations
found in these reports  the homemade spell checker used
for this project is not a sustainable solution to this problem  since the number of errors appears to increase linearly with the size of the training set  string kernels could
provide a potential solution to this problem      and may
constitute the next phase of this project 
vii  acknowledgements
i am extremely grateful to bao do and daniel rubin
for helping me obtain the original mammography reports

from the radtf database  thanks guys 
references
    smith bindman r  miglioretti dl  rosenberg r  et al  physician
workload in mammography  am j roentgenol                 
     
    han b  obradovic z  hu zz  et al  substring selection for biomedical document classification  bioinformatics                 
     
    beazley d  python essential reference  sams       
    hall m  frank e  holmes g  et al the weka data mining
software  an update  sigkdd explorations  volume     issue
        
    fan re  chang kw  hsieh cj  et al liblinear  a library
for large linear classification  journal of machine learning
research                  
    keerthi ss  sundararajan s  chang kw  et al a sequential dual
method for large scale multi class linear svms  proceedings of
the   th acm sigkdd international conference on knowledge
discovery and data mining       
    hsu cw  chang cc  lin cj        a practical guide to
support vector classification  from the liblinear website 
http   www csie ntu edu tw cjlin  accessed          
    salton g  buckley c term weighting approaches in automatic
text retrieval  information processing and management vol     
no    pp                
    lodhi h  saunders s  shawe taylor j  et al text classification
using string kernels  journal of machine learning research    
             

fi