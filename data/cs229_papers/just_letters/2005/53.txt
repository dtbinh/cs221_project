jonathan pines
nathan marz
cs    final project         

beat cal  machine learning in football play calling
goals and applications
our overall goal is to successfully predict the offensive play calling decisions of
college football coaches  we will attempt to make such predictions on the basis of data
from past games and from previous plays in the current game  while there is extensive
literature on machine learning in some other sports such as baseball  football has been
relatively neglected  furthermore  most machine learning applications to sports focus on
game results and player performance rather than plays or coaching decisions  we hope
that with this novel approach we will find new and useful results for the following two
applications 
    to assist a football coach in making defensive play calling decisions
appropriate to the expected offensive play 
    to assist individuals in live sports betting  a service that casinos intend to
introduce for football in the near future 

data acquisition
we got all of our game data from the yahoo  sports web site
 http   sports yahoo com ncaaf teams   we wrote a  java  program to navigate the site
and find the urls of play by play summaries for all games in the current ncaa
division   a football season 
we then wrote a  ruby  program that takes as input the url of a play by play
summary  loads the page source  and parses the game data into a useful format for
machine learning and in particular for the matlab load function  the features we
used for each play are as follows  each represented as an integer  
features  input  
quarter   time left
score for each team
down   yards to go
position on the field
classifications  output  
play  run or pass 
direction  left  right or center 
yards gained
in the end  we focused our analysis on the pacific    conference  for each pac   
team  arizona  arizona state  cal  oregon  oregon state  stanford  ucla  usc 
washington  washington state   we stored each game in a file with one line per offensive
play for that team 

fidata analysis
there is myriad of questions we can hope to answer with this data 
given the input features for a specific game situation  for example  we might ask 
    what play is most likely to be run next 
    what plays are likely to be successful 
more generally  we might ask 
    how much does a particular coach vary his strategy 
    which styles of play work well against which teams 
we would also hope to estimate our level of confidence in any answers we come up with 
especially if the application is to betting 
in this project we will restrict our attention to the first of these questions  play
calling  and leave the rest for future research 
there are also numerous machine learning algorithms suited to finding
satisfactory answers to such questions  because there is no literature on play calling
prediction  we had no solid basis for evaluating our results  our only practical
benchmarks were human prediction and basic statistical data  thus  we spent a good deal
of our time exploring different possibilities using simple logistic regression to classify
plays as runs or passes so as to explore how the features relate to one another and to the
final play call 
in some situations  we found logistic regression to be surprisingly successful  and
in fact  in many cases a simple linear model worked best  we also considered and
implemented  with varying success  a few more complicated algorithms for a variety of
outputs  in the end our best results came from a couple forms of logistic regression 
logistic regression for binary classification of plays
perhaps the most basic question to ask about the data is  can we predict  based on
the input features  whether a given play will be a run or a pass  our simplest attempt at
answering this question was using logistic regression on what we expected to be the two
most relevant input features  down and yards to go  we quickly realized that because
dependence on downs is not linear  our results would be much improved if we trained
newton raphson  or any algorithm on any set of features  for that matter  separately
for each down  with only one feature  yards to go  left  this basically amounts to picking 
for each down  a cutoff in the number of yards to go between run and pass plays  i e  the
prediction is something like pass with   or more to go  run otherwise  with just this  in
some situations for some teams  we were able to achieve over     accuracy  even when
the statistics  i e  go with the play that has been seen most often on that down  result in a
much higher error rate  this is an indication that some coaches in some situations make
decision in a very well defined way  a fact that is not obvious from simply looking at
statistical data on the ratio of run plays to pass plays 
one interesting piece of information we can extract from these initial data is the
actual cutoff for different teams on different teams  that is  we can say  for example  that
on  rd down arizona almost always runs with   yard to go and almost always passes with
more to go  by comparing the cutoffs and errors  we can gauge both the consistency and
the risk taking propensity of different teams 

fiwe also separately calculated the errors on running plays and passing plays  we
found that the algorithm tends to misclassify a lot of passes on  st down and a lot of runs
on  rd down  combined with the fact that teams pass a lot more on later downs  this
makes sense  the outputted line is heavily weighted by the type of play that occurs most
often 
next we added other relevant features to the binary classifier  time in game  score
differential and position on field  one interesting trend we found was that while adding
these features significantly reduces the error rate for  st and  nd down  it does not make
much difference for  rd down  this tells us that on  rd down  coaches decide on the play
primarily based on the number of yards to go for first down while on other downs they
take more criteria into account  the error rates for logistic regression  on all features 
with and without separate analysis for downs are as follows 
all downs trained together with down as a feature 
 
 
 

ariz
     
     
     

azst
     
     
     

cal
     
     
     

ore
     
     
     

orst
     
     
     

stan
     
     
     

usc
     
   
     

ucla
     
     
     

wash
     
     
     

wast
     
     
     

ore
     
     
   

orst
     
     
     

stan
     
     
     

usc
     
     
     

ucla
     
     
     

wash
     
     
     

wast
     
    
     

downs trained separately 
 
 
 

ariz
     
     
     

azst
     
     
     

cal
     
     
     

separate training of downs is better in a fair number of cases  although not as
pronounced as we had expected  this is likely due to the increase in variance with a
smaller sample size  training only on  rd down means the sample size is less than     the
size of training on all downs at once 
for comparison  the baselines  by predicting highest frequency play per down  are
as follows 
 
 
 

ariz
     
     
     

azst
     
     
     

cal
     
     
     

ore
     
     
     

orst
     
     
     

stan
     
     
     

usc
     
     
     

ucla
     
     
     

wash
     
     
     

wast
     
     
     

logistic regression beats the baseline by a good margin in almost all cases  we
also tried adding some new attributes that could be calculated from the features  two
examples are  average gain per run play or pass play in the current game  and play called
on the last few plays  surprisingly  most of these attempts gave us significant insight and
improved error rates only slightly 
by comparing parameters found for different teams and testing error rates for a
teams parameters on other teams  we were able to examine differences in play styles 
with more analysis we could characterize these differences in concrete and useful ways 

finon binary classification
next  we expanded the classification output to account for the length of the pass 
the output was   for a run    for a pass of under    yards    for a pass of    to    yards 
and   for a longer pass  our approach to this classification problem was to separately
apply binary classification to each output category as compared with all the other
categories combined  that is  we separately found the probability that the play is a run as
opposed to a pass  a short pass as opposed to a run or longer pass  and so on  the output
of our algorithm was   separate weight parameters  theta  corresponding to the  
categories  given a new example  we compute the probability of it being each category
using our four thetas that were computed  we first tried choosing the category that had
the highest probability  but this turned out to be a bad approach  this is because of
reasons similar to the voters paradox  subdividing the pass category lowers the chance
that any given pass category is correct  so that the algorithm predicts run almost
exclusively 
we fixed this by doing hierarchical classification  first we used logistic
regression as above to classify the data on just run vs  pass  then  we took only the data
for passes and tried to differentiate the three kinds of pass plays as follows 
for each category c of pass play
set labels of pass plays with category c to  
set labels of all other pass plays to  
run logistic regression on the features with these labels and save
the parameters found
then  to make a prediction  we test the features against the parameters for each category
and choose the category which outputs the highest probability  for pass plays  the results
of this approach are 
regression 
frequency 

ariz
      
      

azst
      
     

cal
     
     

ore
     
     

orst
     
     

stan
     
     

usc
     
     

ucla
     
     

wash
     
     

wast
      
      

frequency prediction just uses whichever pass distance has occurred most
frequently in the past  for most teams  regression is a significant improvement to the
frequency prediction  also  it is roughly evenly distributed across all downs and all
categories predicted  we also tried predicting play direction  left  center  right  with little
success 
other algorithms
a few natural possibilities for algorithms and approaches to this task would be 
svm with nonlinear kernel  we tried linear and got no good results 
hmm or crf  perhaps with models for team attitudes as hidden states and
situation play pairs as observables  thus in a given game the algorithm would attempt to
find the most probable attitudes to explain a coachs current style of play  which would
give a more accurate model for prediction  such algorithms might do a better job of
accounting for variations in a teams strategy over time and against different opponents 
because we expect  intuitively and from examining the data  that dependence on
most of our features is linear  especially for such features as yards to go  time left and

fiscore differential  it seems that svm and some other algorithms would be unlikely to
provide better results than logistic regression  on the other hand  a completely different
approach such as crf might give completely new insights into the data 
our expectation that dependencies are linear is consistent with our findings that in
addition to having reasonably good error rates logistic regression makes intuitive
predictions in many situations  as a simple example  it predicts run on  rd and very short 
and pass for very long plays  getting down in score makes it predict pass a lot more 
which also makes sense 

analysis  where does the error come from 
we have certainly had some success in prediction  but most of our predictions still
have what might seem to be large error rates  there are a number of reasons why the
error in these predictions is so high  first and foremost  there is inherent randomness in
how a coach makes his play calling decisions  no coach follows a well defined formula
for decision making  and furthermore  one of the primary intermediate objectives of a
good coach is to gain an advantage by surprising the opponent  nevertheless  we believe
there is much room for improvement in play call prediction  and particularly in the realm
of machine learning  as discussed in the following section 

future possibilities and gambling application
we have only begun to scratch the surface of possibilities for play prediction and
analysis in football  there seems to be virtually no literature on the topic  but perhaps
unjustly so  we believe that with more detailed data about players  formations  and other
factors  as well as different algorithms  models and approaches  very accurate playpredictors could be built 
recently several major casinos in nevada and elsewhere have announced their
intention to initiate a program for live betting on college and professional football games 
this would include exactly the kind of scenarios we are analyzing  namely  betting on
individual plays  a casino gambler could thus use our analysis to place bets on plays that
he knows to be likely where other gamblers using personal knowledge  intuition and
statistics might get the odds wrong 

summary
it is clear that a program with the ability to predict play calling better than a
knowledgeable person with access to statistics would be of great value to a coach  any
information a coach can get about the likely behavior of his opponent can provide a
crucial edge  since he can call a defensive play that will cover the likeliest possibilities 
the application to gambling is even more direct  if a person knows that the probability of
a play occurring are even slightly better than the odds given by the casino  he stands to
make tremendous gain 
as a final point of interest  our results show no well defined correlation between
predictability of play calling and success of the team  we are able to predict great teams
such as usc and poorer teams with comparable accuracy  and in the future  we hope that
this fact can be used to tip the odds in favor of the former underdog and perhaps help
stanford to win big game 

fi