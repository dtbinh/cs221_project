cs    project  musical alignment discovery
woodley packard
december         

introduction
logical representations of musical data are widely available in varying forms  for
instance  midi files are ubiquitous on the internet   matching acoustic recordings of
musical performances are also available from cd stores  online music stores  or other
repositories  however  due to variation in tempo and dynamic in performances  the
time series alignment between logical and acoustic data is usually nonobvious 
my project aims to automatically discover that alignment  i chose to restrict my
explorations to the music of mozart  because i have access to a large homogeneous
library of both logical and acoustic data for that particular composer  one advantage
of this restriction is that the set of musical instruments is limited to a few dozen  i
take advantage of this by extracting models for the sound of each relevant instrument
 overtone coefficients  
this chart shows a high level outline of the systems architecture 

r

a

w

d

a

u

d

i

i

g

i

t

a

o

s

p

e

c

u

d

r

t

a

s

l

p

a

e

t

i

o

n

c

o

r

t

t

a

o

r

m

e

a

s

a

l

t

a

d

v

a

l

i

i

g

e

t

n

r

m

b

a

t

s

n

r

t

r

a

a

u

e

m

e

m

n

e

t

t

r

s

a

i

e

s

n

e

p

d

c

a

i

a

n

e

t

s

d

d

s

l

o

n

c

o

m

r

t

o

e

t

s

h

i

u

n

l

t

g

 

s

data sets
the logical note data input to my project is an accurate textual representation of
a physical printed page of musical score  extracted  by a different project  from
the comprehensive neue mozart ausgabe  a complete edition of scores to mozarts
music   these data are handled by an external interpreter 

 

fiinput note data
by modifying the playback facilities of the interpreter  i preprocessed the music into
a table of note data containing  for each note in the piece  the logical start time  the
pitch  the volume   the instrument  the duration  and the measure number 
the acoustic data came from a commercial compact disc recording of the symphony  i extracted a spectrogram  see image  from the digital samples using a
gaussian window size of      samples and a step of     samples  the data were at
      hz 

acoustic spectrogram

generative model
using the note data table  i constructed an estimation of a logical spectrogram
by computing the frequency fm for each note and contributing an exponentially
decaying rectangle at each overtone of the fundamental  i used an equal tempered
scale  using the following equation for the fundamental frequency     
fm         

mm   
  

where m    is the midi encoding of middle a 
 

fileft  uniform predicted spectrogram  right  with learned instrument spectra
for the initial alignment  i assumed the spectral properties of all instruments
were identical  namely five exponentially decaying evenly spaced overtones  then 
assuming the alignment was correct  i applied a linear regression to find the maximum likelihood spectral characteristics of each instrument given the observed spectrogram  the parameters my system learned were the coefficients of the first five
overtones for each instrument  these parameters also implicitly included an overall
scaling factor accounting for the difference between the suggested dynamics  loudness  in the score and the average recorded dynamics for each instrument 
after estimating the instruments spectral properties  i used them to build a
superior predicted spectrogram from the logical note data  then i realigned  producing new training data for the instrument property estimation  etc  by repeating
this process  similar to em   my system was able to learn the properties of the
instruments with higher accuracy  the parameters converged after three such iterations 

spectral overtone coefficients learned for several instruments
i assumed the existence of a similarity metric f  x  y  comparing a logical
spectrogram slice to an acoustic spectrogram slice  i tried several metrics for this
purpose  including l  distance  a gaussian kernel  and a simple dot product  representing the cosine of the angle between the two spectra   the simple dot product
performed noticeably better than the other candidate metrics 
 

fialignment
the literature contains many records of experiments of this type using hidden
markov models  hmms   e g                 alternative approaches have been studied
with varying degrees of success  e g      investigates a discriminative learning approach   but most other models require supervised learning  by contrast hmms can
learn to align time series in an unsupervised fashion  treating the predicted logical spectrogram as a linear hmm with output likelihoods given by the similarity
metric  i used the viterbi algorithm to compute the highest likelihood alignment
between the logical spectrogram and the acoustic spectrogram 

top  typical alignment  bottom  a bad spot
in the example pictured  there were roughly   times more spectral slices than logical
slices  the aligned image shows the original acoustic spectrogram in blue  with the
hypothesized alignment of the logical spectrogram overlayed in green  the red lines
on the aligned image indicate transitions between logical spectrogram slices  as can
be seen  the alignment found in the case on top is reasonable 
one problem with hmm alignment is that there is no good way to specifying a
preferred number of times to stay in a given state  as such  the alignment tends to
be locally uneven  even if globally it is a good fit  this can be seen in lower segment
above  on average  only    of the slices are transitions  red   but in this particularly
bad segment  the variance is very high 
to solve this problem  i built a confidence metric to discern which segments of
the alignment were smooth and which segments were not  the confidence metric
m t  observes the deviation d t  between the instantaneous tempo of the alignment
and the local average tempo 
fi
fi


fi
fi f  t   n   f  t  n 
d t  

fi
fi
 f  t fi  
m t    exp   
d t    fi
 n
 

where f is the viterbi alignment  n is a parameter controlling the breadth of the
local average  and    is a normalizing constant to put the metric in a useful range 
in situations with high variance  the deviation is large and so the confidence metric
is near    and in situations with low variance the confidence metric is near   
 

fithe term f   t  in the above equation for d t  requires slight explanation  since
the available representation of f  t  is not a continuous function  instead it is a discrete mapping from audio cd time slices to note data time slices  i used a numerical
differentiation technique to estimate f   t  for the underlying latent continuous alignment function 
smoothing is applied to areas with low confidence  by mixing the aligned values
with linear predictions from nearby high confidence areas 

results and applications
the result of the entire process is an alignment function mapping from audio cd
time codes to note data time codes  not having a hand aligned test set  i am unable
to provide a numerical accuracy measurement      and     also found it difficult
to measure accuracy numerically  although     invented a  somewhat discouraging 
metric and     has a metric based on hand aligned test data  however  i built
a tool to visually inspect the learned alignment between the spectrograms  the
visualization made it clear that the alignment is generally quite accurate  more
specifically  it is quite good at lining up passages with quickly changing tonalities
and moving notes  slow changing segments with little tonal  and hence spectral 
variation sometimes cause reduced accuracy  but even in such cases the proposed
alignment tends to be within a small fraction of a second of the intuitively best
alignment 
one possible application of this technique is  as i already explored  automatically
learning characteristics of musical instruments  abstract spectral characteristics of
musical instruments could be used in musical synthesis or completely automatic
music recognition  other potential applications include enhancing playback in score
studying and browsing  and augmenting a musical listening experience with visual
information about the music 

references
    campbell  jim  the equal tempered scale and peculiarities of piano tuning 
http   www precisionstrobe com apps pianotemp temper html
    raphael  christopher  automatic transcription of piano music  proceedings of ismir       
    orio n   dechelle f         score following using spectral analysis and hidden markov models 
proceedings of the icmc          
    cano p   loscos a   bonada j         score performance matching using hmms 
proceedings of the icmc                
    shalev shwartz s   keshet j   singer y         learning to align polyphonic music 
proceedings of ismir       

 

fi