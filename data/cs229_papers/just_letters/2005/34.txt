failure diagnosis for configuration problem in storage system
chung hao tan
ibm almaden research center
chungtan us ibm com

abstract
configuration problem in storage system is one of the
well recognized issues in todays enterprise environment 
traditional approaches usually reply on deep knowledge of
the underlying system  however  such solution usually cannot scale up when the system become large and complex 
recent research work has started using machine learning
techniques to improve the overall performance of the diagnosis process  in this project  we try to identify the proper
procedure to transform a configuration problem into a machine learning problem  which lays down the foundation of
our future work in the area of configuration and change
management 

   introduction
one of the key challenges in the current enterprise storage environment is to quickly identify the root cause of the
failure so that the system down time can be reduced  some
storage management products      have partially addressed
this issue by providing an aggregated view of the system
status across multiple layers and components  however 
even with the help from such management tools  fault localization in a complex storage environment is still a timeconsuming task which requires an experienced administrator to manually interpret a vast amount of diagnosis data  as
a result  an automated failure diagnosis tool which requires
less human intervention would be necessary in a mission
critical environment 
traditional fault isolation techniques usually rely on
manually built system model       which is either difficult
or impossible to be created in a dynamic  multi vendor environment  recent studies have shown the promise of the
black box approach                           that is  can we
perform failure diagnose by observing the system behavior
without knowing too many details about it  not surprisingly  machine learning techniques are widely used in such
setup 
in this project  we try to identify the key elements and the

proper procedures in a black box approach that automates
the fault diagnosis process  specifically  we focus on solving san  storage area network  configuration problems
which display complex characteristics such as multi tier relationship  interoperability  policy and security  the motivation behind this is that the configuration problem has been
recognized as the top reason for system crash             
which also matches to our observation in the storage environment 
our goals contributions are as follows 
   we survey a wide range of recent papers in the area
of fault diagnosis  since this project is conducted for
the machine learning course  we emphasize on those
papers that use machine learning techniques 
   we show solutions that can transform a configuration
problem into a machine learning problem in a blackbox approach  we highlight their objectives and limitation 
   we identify future research work that may advance
from previous work  for example  multi fault diagnosis is still an open research problem 
to our knowledge  this is the first work that uses machine learning techniques to automate the failure diagnosis
process for the san configuration problem  we intend to
continue the work after the course  we learn the necessary
background and obtain insightful ideas through the work
of this project  in the followings  we describe the related
work in section    some suitable learning approaches are
explained in section    experimental results are shown in
section    and we list our future work in section   

   related work
failure diagnosis in the distributed system has been studied quite long       traditional approaches usually rely on
explicit modeling of the underlying system  one widely
used technique is the knowledge based expert system  e g 
help desk   such approach may work well in a controlled 

fistatic environment  however  as the complexity of the system keeps growing  it becomes impossible to encompass all
the necessary details  for instance  the device interoperability matrix is so dynamic that no one can ever build a
complete matrix  applications on top of the network add
another layer of complexity  e g  disk traffic and tape traffic cannot flow through the same hba  
recent research has focused on the black box approach
in order to handle the complexity and the non deterministic
behaviors of the managed system  one typical setup is the
symptom based approach  by observing system states from
the results of probings  a symptom based approach tries to
predict the cause of failure from past experience  unsurprisingly  machine learning techniques are adopted in most
recent papers in the black box approach  among those various learning algorithms  decision tree      nave bayes
classifier                      bayesian network         and
clustering                are widely used due to their advantages of interpretability  i e  easy to explain the learning
results  and modifiability  i e  easy to incorporate expert
knowledge into the model           these two properties
make these algorithms attractive to the human operators in
practice 
in machine learnings perspective  failure diagnosis can
be viewed as an anomaly detection problem                  
especially if the majority of the training samples are negative case  i e  good case   the key idea is to describe what
a good data looks like  then an anomaly is the case that it
cannot fit into any of those good models  the concept of
feature selection and model selection are also explored in
several recent papers           we will discuss those machine learning approaches in more details in the next section 
history based approach is another useful technique
which reduces the solution space significantly           the
idea is to compare two snapshots of the system states  one
from current non working state and the other from last
known working state  then there is a good chance that
the failure comes from one of the changes in the difference 
two assumptions are usually made in this approach  first 
the difference between two snapshots are not many  second  constantly changing element is usually not the factor 
we can also make the comparison between similar systems 
which may increase the accuracy by taking advantage of
large number of samples  but it add additional complexity
due to the difference between system 
how to increase the overall usability in the diagnosis process is one of the interesting topics in this field 
for example  an integrated visualization environment usually increases administrators confidence on the learning results      a knowledge database can assist human operators
to make the final decision when the program cannot do any
further diagnosis       proactive approach      is also a

figure    modeled as decision tree
useful technique to avoid the problem in advance 
diagnosis of configuration problem has been studied
in several areas such as windows registry             
    router configuration     and general internet application       other recent research focus on either performance
problem         software failure        or general fault localization techniques                 

   machine learning approach
before further discussion  lets see some real examples
of san configuration problems collected from the field  table   shows three cases which we consider them difficult
to diagnose  for instance  in case   we see an error code
which indicates a hardware fault  however  the real cause
is actually from a misconfiguration at the host side  an inexperienced administrator may look into the problem in the
wrong direction  to help out this situation  our goal is to
give a short list of possible reasons to the users  so that they
can spend less time in the diagnosis process 
machine learning techniques can help achieve the goal
at both the design time and the runtime  at the design time 
which can be viewed as a proactive approach  we try to discover some diagnosis rules that are not trivial  decision
tree algorithm      see figure    is an ideal solution that fits
into this domain  in addition  we can also optimize those diagnosis rules by using the concept of feature selection and
model selection  we run a preliminary experiment to validate this approach  see section    
furthermore  at the runtime  a reactive approach  we try
to predict the source of failure by taking advantage of past
experience or similar configuration from the peers  we can
view it as a classification problem in machine learnings terminology  the most commonly used technique is the nave
bayes classifier                      figure     we can think
it as a symptom fault map where each edge represents the
conditional probability between the symptom and fault  we
usually make some assumption on the prior and even on the

ficase
 
 

 

symptoms
   numerous tsm error code anrxxxx  hardware fault 
   loss of tape drive and later re discover it incorrectly
   numerous and random loss of external disk  windows and aix 
   occasional loss of data  windows only 
   rebooting windows server takes     minutes
   severe performance reduction
   see     complete i o failure     in the log

fault  reason of failure 
disk traffic and tape traffic are on the same
hba
  entity in a single zone is too large

  path between host and device is too large

table    examples of san configuration problem

figure    modeled as nave bayes classifier

figure    modeled as clustering

   experimental result

figure    modeled as bayesian network

conditional probability  sometimes  em algorithm is used
to train the model          some previous work also use
bayesian network          figure    to incorporate prior
knowledge of the system model  e g  iso osi network
model  
we can also perform the classification by clustering    
            figure     for example  in the the anomaly detection approach we generate a set of good clusters  then
anomalies are those samples that cannot fit into any of those
good clusters 
we review some learning algorithms that are suitable for
the configuration problem in this section  next  we will
show a concrete example of solving probe selection problem by using a machine learning approach 

configuration problem is different to other type of problems  such as performance problem  is in the sense that the
number of variables are usually quite large  e g  there are
about   k registries in a fresh windowsxp installation  
however  once the system is settled down  the configuration
usually doesnt change often  note that these two properties
bring undesired effects to the learning results  i e  number
of features and number of training samples  
on the other hand  the cost of running a probe in order
to gather system state is usually un ignorable  ideally  we
want to run a minimum set of probes to diagnose a particular
failure  but we usually dont know how to select such set 
optimization is even more difficult if we want to diagnose
multiple failures simultaneously 
one possible solution for this problem is to treat it as a
feature selection problem in machine learning  we run a
simulated experiment to validate this concept  we generate
the sample data by using the multi variate bernoulli event
model  given p  y              those data are trained and
test by nave bayes classifier with hold out cross validation
           the greedy forward search procedure is used
to generate the set of probes 

fiistrators into the decision process  in particular  machine
learning technique  e g  data clustering  can play a role during the query on knowledge database 
there are still a lot of open research problems in the area
of failure diagnosis  such as root cause analysis for multifault in a multi layer environment  more importantly  we
still dont have a truly automated tool that can simplify administrators jobs in practice  which motivates us to continue this work 

probe selection as feature selection using nb
    

   

error rate

    

    
p y          with      samples
    

   conclusion
    

 

 

  

  
  
number of probes features 

  

  

figure    probe selection as feature selection

figure   shows the result  where x axis is the number of
probes  i e  features  and y axis is the error rate  we can
use this information to better decide the number of probes
necessary to localize the fault  we can also come up with
the set of probes that has better accuracy  potentially  we
can even discover those hidden features that have significant
impact 

   future work
the primary reason which we cannot run the experiment
on the real configuration data is because it is still not publicly available  we cannot obtain a statistically large set of
training samples from our lab environment because its configuration doesnt change too often and thus it cannot provide a meaningful result to support our arguments  our top
priority is to start collecting real configuration data from the
field  e g  from ibms data center  
in this paper  we focus on solving the configuration problem by using machine learning approaches  however  we
believe a combination of learning based approaches and traditional deterministic approaches may get better results in
practice  for example  we can run pre defined diagnosis
scripts for those well known problems first in a multi phase
design  we then use machine learning approach to capture
those hidden relationship in the data  or encode rules that
are difficult to define  how do we combine different approaches together is one of our future work 
in addition  many previous studies have shown that an integrated fault diagnosis environment  e g  knowledge database  gui  is an essential component to improve the overall
diagnosis experience  the goal is to implicitly pull admin 

in this project  we review a wide range of recent papers
in the area of failure diagnosis  we focus on machine learning approach and provide a concrete example of probe selection by the simulation experiment  we also highlight the
future research work that may distinguish ourselves from
the previous work  we will continue this project since this
is a real challenging problem in both industry and research
community 

   acknowledgments
we wish to thank sandeep gopisetty  prasenjit sarkar
and kaladhar voruganti from ibm almaden and andrew
ng from stanford for inspiring this research  we would
also like to thank eric butler  roberto pineiro and ramani
routray from ibm almaden for their helpful comments 

references
    m  k  aguilera  p  reynolds  and a  muthitacharoen  performance debugging for distributed system of black boxes 
in proc    th acm sosp  october      
    a  beygelzimer  m  brodie  s  ma  and i  rish  test based
diagnosis  tree and matrix representations  in proc   th
ifip ieee im  may      
    p  bodik  g  friedman  l  biewald  h  levine  g  candea 
k  patel  g  tolle  j  hui  a  fox  j  michael  and d  patterson  combining visualization and statistical analysis to
improve operator confidence and efficiency
for failure detection and localization  in proc   nd ieee
icac  june      
    m  chen  e  kiciman  e  fratkin  a  fox  and e  brewer 
pinpoint  problem determination in large  dynamic internet
services  in dsn  june      
    m  chen  a  x  zheng  j  lloyd  m  jordan  and e  brewer 
failure diagnosis using decision tree  in proc   st ieee
icac  may      
    i  cohen  m  goldszmidt  t  kelly  j  symons  and j  s 
chase  correlating instrument data to system states  a
building block for automated diagnosis and control  in proc 
 th usenix osdi  december      

fi    i  cohen  z  steve  m  goldszmidt  j  symons  t  kelly  and
a  fox  capturing  indexing  clustering  and retrieving system  in proc    th acm sosp  october      
    k  el arini and k  killourhy  bayesian detection of router
configuration anomalies  in proc  acm sigcomm workshop on mining network data  august      
    a  ganapathi  y  m  wang  n  lao  and j  r  wen  why pcs
are fragile and what we can do about it  a study of windows
registry problems  in dsn  june      
     g  hamerly and c  elkan  bayesian approaches to failure
prediction for disk drives  in proc    th icml  june      
     ibm 
tivoli productivity center 
http   www   ibm com servers storage software center index html 
     e  kiciman and y  m  wang  discovering correctness constraints for self management of system configuration  in
proc   st ieee icac  may      
     k  nagaraja  f  oliveria  r  bianchini  r  p  martin  and
t  d  nguyen  understanding and deailing with operator
mistakes in internet services  in proc   th usenix osdi 
december      
     i  rish  m  brodie  and n  odintsova  real time problem
determination in distributed system using active probing  in
proc   th ieee ifip noms  april      
     a  singh  m  korupolu  and k  voruganti  zodiac  efficient impact analysis for storage area networks  in proc   th
usenix fast  december      
     m  steinder and a  s  sethi  end to end service failure diagnosis using belief networks  in proc   th ieee ifip noms 
april      
     m  steinder and a  s  sethi  non deterministic event driven
fault diagnosis through incremental hypothesis updating  in
proc   th ifip ieee im  may      
     m  steinder and a  s  sethi  a survey of fault localization
techniques in computer networks  science of computer programming           
     i  steinwart  d  hush  and c  scovel  a classification framework for anomaly detection  journal of machine learning
research     march      
     p  n  tan  s  michael  and k  vipin  introduction to data
mining  addison wesley       
     h  j  wang  j  c  platt  y  chen  r  zhang  and y  m  wang 
automatic misconfiguration troubleshooting with peerpressure  in proc   th usenix osdi  december      
     y  m  wang  c  verbowski  j  dunagan  y  chen  h  j 
wang  c  yuan  and z  zhang  strider  a black box  statebased approach to change and configuration management
and support  in proc    th usenix lisa  oct      
     a  whitaker  r  s  cox  and s  d  gribble  configuration
debugging as search  finding the needle in the haystack  in
proc   th usenix osdi  december      
     s  zhang  i  cohen  m  goldszmidt  j  symons  and a  fox 
ensembles of models for automated diagnosis of system performance problems  in dsn  june      

fi