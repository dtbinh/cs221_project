cs    project report 
automated photo tagging in facebook
sebastian schuon  harry robertson  hao zou
schuon  harry robertson  haozou  stanford edu

abstract
we examine the problem of automatically identifying
and tagging users in photos on a social networking
environment known as facebook  the presented automatic facial tagging system is split into three subsystems  obtaining image data from facebook  detecting
faces in the images and recognizing the faces to match
faces to individuals  firstly  image data is extracted
from facebook by interfacing with the facebook api 
secondly  the viola jones algorithm is used for locating and detecting faces in the obtained images  furthermore an attempt to filter false positives within the
face set is made using lle and isomap  finally  facial
recognition  using fisherfaces and svm  is performed
on the resulting face set  this allows us to match faces
to people  and therefore tag users on images in facebook  the proposed system accomplishes a recognition accuracy of close to      hence rendering such
systems feasible for real world usage 

 

figure    schematic of the facebook crawler

 

collecting data from facebook

to implement an automatic image tagging system  one
first has to acquire the image data  for the platform we
have chosen to work on  namely facebook  this task
used to be very sophisticated  if not impossible  but
with the recent publication of an api to their platform 
this has been greatly simplified  the api allows third
party applications to integrate into their platform and
most importantly to access their databases  for details
see figure   and       we have set up an application on
this platform  which allows the user to gather image
data on himself and his friends  this data is in turn fed
into the image processing pipeline to learn the users
faces 
the facebook platform allows for users to upload
pictures and tag people on these images  here tagging
means the process of placing a box around the persons faces in the image and identifying them  figure
  shows an example of a placed tag  in facebooks
current tagging implementation  a constant sized rectangle is placed over a persons face  and only the center
of the box is stored 
to date  these tags must be manually placed by users
who recognize the faces of their friends in an image 
we want to improve on this and have the tagging operation performed automatically when a picture is added

introduction

recently image sharing on the social network platform
facebook has become very popular  here photo albums are combined with social networking  so individuals can be marked in uploaded pictures  this marking
is refered to as tagging on facebook  currently this
task is done manually  but with a exponentially growing number of images  an automatic solution is desirable  we break this task into three sub tasks  namely 
data collection  face detection and face recognition 
the papers structure follows this processing pipeline 
thus section   outlines our method for obtaining images from facebook  we extract faces from these images in section    and finally perform face recognition
in section    we present our conclusions and ideas for
future work in section   
 

fiing steps  depending on the learning algorithm  different post processing steps may be applied later  but the
most crucial is the reduction of the images to snapshots
of faces 
our face detection task can be characterized by two
properties  firstly  it needs to be very robust  since
individuals may appear with turned or partly occluded
faces  secondly  we need an algorithm which performs
the detection process with low computational requirements  since a large number of images needs to be processed and the user will not tolerate waiting a long time
for his images to be tagged 
we experimented with two different algorithms for
the face detection task  one based on haar features by
viola and jones     and one based on fixed size  separable patches named fdlib      the results of both
algorithms are given in table    we notice first of all
that for about    percent of the tags no face could be
figure    a typical tagged facebook photo
recognized  this is partly due to non available images
 i e  download error  privacy retriction   which account
for about one quarter of the missed faces  the other
three quarters are situations where the algorithm was
not able to detect a face  here often the algorithm is to
blame  but in a significant amount of cases  people just
tagged non face objects as people 
both algorithms detect roughly the same amount
of
faces  with viola jones yielding a higher rate on
figure    a typical set of detected faces for a facebook
faces
which actually belong to the person indicated   
user
the other two categories for returned images are
ones which feature the face of a different person and
to the platform  however  the tags already placed by ones with no face at all  the latter is due to misusers are very useful for the learning process  since classification of an object as a face  whereas the forthey supply the algorithm with numerous training ex  mer is due to the presence of multiple people on an
amples of a persons face  if we were limited to profile image  both error categories will have consequences
pictures  we would have only one training image per of varying severity  depending on whether face detecperson  
tion is used to find faces in a newly uploaded picture
for our current training set  our crawler extracted or generate training data from existing pictures  
data for     individuals from the facebook platform 
given the results in table    we selected viola jones
this includes    profile images plus      photos for face detection  since it not only yields a higher rate
which contain at least one tag  in total      tags have of correct faces detected  but also has an optimized
been collected  hence some of the photos contained implementation in intels opencv library      the remore than one person 
sults can be improved further if both algorithms are run
examining the data  it is notable that for about    in parallel and faces are only chosen if they are found
percent of the users  we have less than five images  by both algorithms  furthermore viola jones allows
which will make the learning process hard  also  peo  for adjustment of the weights of its weak classifiers 
ple strike very different poses and are taken from dif  so the algorithm could be adapted to typical poses of
ferent angles  which will be an additional challenge for facebook users 
the recognition task  see figure   for some examples  
face detection errors within the training set lead to
inferior recognition rate in the following face recognition  these images can be considered as outliers  and
  face detection
we attempt to filter them out 
two recently introduced algorithms  locally linear
after the data  i e  images  tags and user information 
  for error evaluation  all face data was hand labeled  so a certain
has been crawled and downloaded  it needs to be processed to put it in an appropriate format for the follow  error due to human involvement should be assumed 
 

fiviola jones
fdlib

total tags
    
    

total faces detected
    
    

face person identical
    
   

face person mismatch
   
   

no face present
   
    

table    face detection results
embedding  lle      and isometric feature mapping
 isomap       have acquired a growing interest among
researchers because of their excellent performance in
dimension reduction for nonlinear data  the key idea
here is that all faces of a person lie on a manifold 
whereas outliers are detached from the manifolds surface  so far this approach has mainly been applied to
facial expressions     
lle computes low dimensional  neighborhoodpreserving embeddings of high dimensional inputs expected to lie on the manifold  isomap is also a nonlinear dimensionality reduction algorithm  but unlike
lle  it performs low dimensional mapping by tracing
the shortest paths confined to the manifold of observed
inputs  since both algorithms are unsupervised ones 
they do not require a training phase 
for lle  the number of nearest neighbors  the most
important parameter for the algorithm  is chosen to be
seven after trial and error for the facebook images 
which is at the lower bound of the recommended range
     the original dimension of an image is    by    
a total of      dimensions  which we map to two dimension data using lle and isomap  the outlier classification is performed by calculating the center of the
low dimensional data  and labelling images beyond a
certain distance as outliers  in table   we have listed
the reduced error rates achieved  we only obtained a
marginal reduction in error rate by employing lle and
isomap  therefore further research is needed on how
to eliminate outliers  or how the later face recognition
algortihms can be made more robust towards outliers 
original
     

lle
     

per person  the first serves primarily to evaluate the
algorithms  the second is typical of the set of all photos accessible in the peer group of a user  both sets
were randomly divided into training and test sets with
an       ratio  we separated each set into two further
sets  one brute set containing the raw data generated
by the face detection step  and one hand filtered set
from which outliers have been removed manually 
there is an abundance of face recognition algorithms available to choose from  and the face recognition problem has been well studied  however  our
usage does not correspond to their usual test cases 
face recognition algorithms are generally evaluated by
their performance on a few photo databases available
to the academic community  which are made up of perfectly lit and framed photos  in contrast  the task we
present features numerous poorly lit and chaotically
taken snapshots 
hence several algorithms were tested  the following algorithms were evaluated on the described test
sets 
 eigenfaces
 fisherfaces
 support vector machines
in the following two subsections we will present the
performance of these algorithms 

   

isomap
     

we initially attempted to use the eigenfaces algorithm
on the detected facebook images  eigenfaces uses
the principal component analysis  pca  to choose a
dimension reducing linear projection that maximizes
the variance of all the projected samples  however 
the mapping direction selected by pca does not take
into consideration the datas class structure  or the fact
that the maximum variance direction achieved for all
data points may not be good for classifying points into
different classes  the eigenfaces algorithm fails completely for the facebook images  and returns an almost
random recognition rate in our tests 
another algorithm  fisherfaces  which use fishers
linear discriminant and takes into consideration both
the between class covariance  or scatter  matrix and

table    error rates before and after lle and isomap
filtering

 

eigenfaces and fisherfaces

face recognition

having extracted the faces of each person  we can use
them as training data to be able to identify faces in
uploaded images  to evaluate our recognition performance  we have created two sets from the crawled
data  a reduced set  with six people and    photos per
person  referred to as   people   and a real world
set  with over    people  and from    to     photos
 

fikernels making an appropriate choice of kernel is
key for the svm  three types of kernels were evaluated  linear  polynomial  with degree     and radial
basis function  rbf     while the rbf kernel can produce the richest behavior  in practise our most severe
problem by far was overfitting the training data  hence
the simpler models actually gave better results  refer
to section       for details  

in class covariance matrix  tries to find a mapping direction that maximizes the variance between different classes  and is thus more suitable than eigenfaces
for classification problems  the recognition rate for
fisherfaces  shown in table    is elevated compared to
eigenfaces but still low  this was to be expected as
eigenfaces is a special case of fisherfaces and generally has lower performance     
  person set
brute hand filtered
     
     

real world set
brute hand filtered
    
    

cost coefficient and termination criterion to determine values adapted to our case  we scripted a grid
search  running the algorithm for each  c    tuple on
a logarithmicly scaled grid and returning the values
which gave the least leave one out cross validation error  the grid search is extremely costly in execution
time  so we ran it once over a random sub sample of
the full training set  and kept the resulting parameter
values  c                 the same procedure has
been used to find the optimal rbf coefficient  

table    fisherfaces recognition results

   

support vector machines

the results obtained by support vector machines
 svm  are significantly better than those of fisherfaces  in the following paragraphs we outline our svm
approach 
     

     

implementation

looking for a fast implementation  we initially based
our classifier on the open source c   library libsvm
     which has the advantage of being optimized  stable
and relatively well documented  eventually we built
our own system in c   to address our needs better and
to be able to deploy our system on the facebook platform 

pre processing

training an svm directly on raw images is not very effective in most cases  therefore various pre processing
steps were evaluated to improve the overall performance 

     
transforms there are a variety of tranformations
that can be applied to images to extract features which
are more relevant for face recognition  in particular we
investigated the use of haar wavelet transformation  it
is one of the oldest and most basic transformations 
obtained by convolving the image matrix with a step
function  although haar features have demonstrated
their power  i e  with the viola jones algorithm used
for face detection   they did not lead to superior results 

results

using the pre processing and choice of parameters described above  tables   and   reports the accuracy in
face recognition 

brute images
hand filtered
haar wavelet

linear
     
     
     

polynomial
     
     
     

rbf
     
     
     

table      person training set results
scaling it is desirable to scale all the features to occupy a constant interval  e g            this is not
really an issue for raw images  where the features are
pixel values in            but is important if a transformation has been applied 

brute images
hand filtered

linear
     
     

polynomial
     
     

rbf
     
     

table    real world training set results
     

parameters

the most significant figure is the       accuracy on
the
large training set  one has to keep in mind random
when it comes to actually training a svm  the key paidentification
yields accuracy of below    for this set 
rameters are the kernel used  the cost coefficient c and
  the radial basis function is defined by  k x   x    
the termination criterion   these were selected as foli
j
lows 
exp  kxi  xj k   
 

fiand given the challenging nature of the images this rate
is remarkable 
for the other figures  the most striking observation
is that the more complex the kernel  the worse the results  one would expect a more sophisticated kernel to
yield better results  but our results indicate the reverse 
this is probably because our svm tends to overfit the
training data  with the number of support vectors of the
same order as the number of training examples  that
can be explained by the nature of our training data 
our base training examples are extremely diverse  containing photos of the same person with different poses 
lighting conditions  focus and or apparel  the frontier
between classes is therefore very hard to define 
the second observation is the impact of preprocessing the data  applying the haar wavelet transformation has little impact  this is most likely due
to the fact that the  d haar wavelet transform used
fails to expose more significant features  contrast here
viola jones  where  d haar wavelets are used   a far
greater gain in accuracy is achieved by hand filtering
outliers  it yields a substantial improvement in terms
of accuracy on the large training set  its lack of impact
on the   person training set is due to the fact that those
training images were already of above average quality 
and so few were filtered out  

 

photo increases the probability of the presence of the
other  the integration of such priors promises to significantly increase the recognition rates by fully leveraging the strengths of the facebook platform  another
avenue we wish to explore is returning a set of most
likely matches  instead of the one most likely  this
will clearly increase the probability of the correct person being among our results  and could thus increase
the usability of our application 

references
    p n  belhumeur  j  hespanha  and d j  kriegman  eigenfaces vs  fisherfaces  recognition using class specific linear projection  proc  eccv 
pages            
    c  c  chang and c  j  lin  libsvm  a library for
support vector machines       
    facebook
developer
documentation 
http   developers facebook com        
    w  kienzle  g h  bakir  m  franz  and
b  scholkopf 
face detection efficient and
rank deficient  advances in neural information
processing systems                  
    open source computer vision
http   opencvlibrary sourceforge net  

conclusion

library 

    l k  saul and s t  roweis  think globally  fit
automatic tagging in facebook is challenging from
locally  unsupervised learning of low dimenboth the face detection and the face recognition standsional manifolds  journal of machine learning
points  the huge variations in pose  facial appearance 
research                    
lighting conditions and image quality all affect facial
detection accuracy  we find viola jones face detec      s  schuon  locally linear embedding and its
tion to be the most successful algorithm on facebook
application 
thesis  technische universitaet
data  while outlier filtering with lle and isomap has
muenchen       
little effect  for face recognition  algorithms which are
reported to have high recognition rate for standard aca      j b  tenenbaum  v  de silva  and j c  langford  a
global geometric framework for nonlinear dimendemic face databases  such as fisherfaces  gave poor
sionality reduction  science                   
results on our facebook database  using svm  we
     
achieved a final recognition rate of close to      a rate
which makes a publicly deployed facial tagging appli    p  viola and m  jones  rapid object detection uscation feasible 
ing a boosted cascade of simple features  proc 
for our automatic tagging system to be widely
cvpr                 
adopted  the most important factor is still the detection and recognition rate  in our future work  we seek
to continue improving the facial detection and recognition rate by developing and optimizing image processing algorithms adapted to facebook data  additional information from facebook can also be utilized
to boost the recognition rate  for example  if two people  close friends  consistently appear in photos together  then the recognition of one of them in a new
 

fi