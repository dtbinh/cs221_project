forecasting purchasing behavior using fmri data
logan grosenick

abstract

despite growing interest in applying machine learning to neuroimaging data  few
studies have gone beyond classifying sensory input to using brain data to forecast
behavioral output  with spatial resolution on the order of millimeters and temporal
resolution on the order of seconds  functional magnetic resonance imaging  fmri 
is a promising candidate for such applications  however  fmri data s low signal tonoise ratio  high dimensionality  and extensive spatiotemporal correlations present
formidable analytic challenges  here  we apply penalized discriminant analysis to
a previously acquired data      to investigate using fmri activation in three regions
 the nucleus accumbens  nacc   medial prefrontal cortex  mpfc   and insula  to
forecast purchasing behavior and generate an interpretable spatiotemporal model 
   introduction
event related functional magnetic resonance imaging  fmri  has revolutionized
cognitive neuroscience  currently  among neuroimaging techniques  only fmri allows investigators to visualize changes in subcortical activity at a temporal resolution of seconds and a spatial resolution of millimeters       with fmri  investigators
visualize changes in vascular oxygenation  hereafter   activation   that occur    s
after changes in neural activity  this activation correlates closely with postsynaptic
changes in dendritic potentials       although the fmri signal lags behind these
postsynaptic changes  the lag can be modeled and deconvolved  allowing secondto second temporal inference  nonetheless  many fmri methods have only recently
adapted to take advantage of this greater temporal specicity 
traditionally  subcortical circuits have been of great interest to aective neuroscientists  since appetitive and aversive behavior can be unconditionally elicited
from subcortical regions via electrical stimulation       a little more than a decade
of fmri research has begun to validate some of these ndings in humans  suggesting that a subcortical circuit including the nucleus accumbens  nacc  plays a role
in anticipation of gains  while a circuit including the deep cortical region of the
insula plays a role in anticipation of loss       additionally  a region in the mesial
prefrontal cortex  mpfc  appears to play a role in correcting erroneous gain predictions       together  these ndings implicate these ancient parts of the brain in
the representation of expected value and related choice      
the ability to visualize anticipatory activation allows a reversal of the traditional logic of neuroimaging design and analysis  instead of examining how sensory
input inuences brain activation  investigators have the potential to examine how
brain activation inuences subsequent motor output 

the goal of this work was

to advance single trial fmri forecasting of purchasing behavior by simultaneously
yielding good classication rates and interpretable coecients in space and time 

 

fiforecasting purchasing behavior using fmri data

 

we reanalyzed previously collected data using set of penalized discriminant analysis
 pda      models that both constrain correlated coecients and perform automatic
variable selection  pda enet   we compared classication rates and model coefcients from these models against those obtained via logistic regression  lr   linear
discriminant anlysis  lda   and linear support vector machine  svm  
   data
during scanning     subjects participated in a  save holdings or purchase 
 shop  task  in each of    task trials  subjects saw a labeled product  product
period    sec   saw the product s price  price period    sec   and then chose either to
purchase the product or not  by selecting either  yes  or  no  presented randomly
on the right or left side of the screen  choice period    sec   before xating on a
crosshair    sec  prior to the onset of the next trial  subjects chose from    items
twice and then chose from a second set of    items twice  two presentations of   
unique items total   with each set in the same pseudorandom order  to examine the
eects of item repetition  item sets were counterbalanced across subjects   for more
details on data collection and preprocessing see       for spatiotemporal analysis 
we dened a

n  p data matrix x with n corresponding to the number of trial
p input variables  each of which was a particular voxel from an

observations of the

roi at a particular time point  this resulted in a total of     input variables per
trial  augmented to     input variables with xed eects 
   penalized discriminant analysis
voxel wise fmri data has high dimensionality and strong correlations between
contiguous measurements in space and time  application of standard logistic regression  lr  or linear discriminant analysis  lda  to fmri data thus suer from
poor or degenerate covariance matrix estimates  which can limit model generalizability to new data and limit coecient interpretability     

appropriate penal 

ization of the covariance matrix  however  can improve generalizability and yield
interpretable models           

further  automatic variable selection is desirable

given the large number of correlated input variables  such variable selection should
aid in both interpretation and in the model s generalization to new data 

mod 

ern regression tools exist for both penalizing and performing automatic variables
selection  but we must modify them to perform binary classication 
the  optimal scoring   os  procedure        modies a regression model  with
continuous valued outputs  so that it can classify a vector of categorical outputs
by simultaneously optimizing over a function

 g    g   r 

g

we may then write our

penalized regression coecient estimates in  lagrangian  form as 

   arg min    g   xt        j  

     

 

subject to n
   g           where  g  is a real valued vector  xt is the transpose
of our input matrix   is the vector of coecients  the function j   is a penalty
 
function in terms of     is a penalty parameter  and         is the l  norm 
one natural choice for our regression method in our pda is the lasso      

 

j           in equation        where         is the l  norm  when the
number of non zero coecients in the model is expected to be sparse   n for p   

which uses

n   

the lasso      is attractive because it performs variable subset selection and

is easily computed using the lars algorithm     

fiforecasting purchasing behavior using fmri data

 

although the lasso performs well in variable selection and prediction  it also

n   p 
n   p  and is not well 

has limitations  particularly in the case of correlated input variables or when
specically  the lasso can select at most
dened unless the

l   norm

n

variables when

of the coecients is below a certain value       given a

group of highly correlated input variables  the lasso is likely to randomly select
just one variable from the group  generating unstable results over multiple ts and
failing to capture correlated groups of relevant variables       it s performance also
suers given correlated inputs  for instance  ridge regression empirically dominates
the lasso even in typical

n  p

regression settings with correlated inputs      

further  lasso loses it s desirable  oracle properties      given grouped inputs      
a generalization of the lasso called the elastic net  enet  addresses the
grouped variable problem by implementing a hybrid penalty with both ridge and
lasso properties       enet coecient estimates are given by 
     

 en et  

p
         arg min   y  xt                          


which  as detailed in      theorem    can be rewritten as 

     



en et

  arg min 

t





xt x     i

     



   yt x          

      

xt x    yt x          

where standard lasso estimates obtain when
     

 lasso   arg min  t


thus enet is like a stabilized version of the lasso  with the estimate covariance
t
matrix    x x shrunk towards the p  p identity matrix i as   increases      
conversely  letting

     

results in a special case of enet called  univari 

ate soft thresholding   ust      

 ust   arg min  t    yt x          

     



which can be equivalently written as 

ust
j
 

     

for

j           p  




 
t
 xtj y  
sign xj y
   

these estimates are of particular interest in the case of fmri

analysis  as they are equivalent to a thresholded mass univariate glm map      this
provides a direct bridge between the coecients for the family of enet methods
and statistical parametric maps popular in fmri analyses 
inputs were centered and standardized to have equal variance and an intercept
of zero  to t the pda and svm models  we used the freely available elastic net
and svmpath packages in r          the elastic net package uses the en lars

   regularization

path in about the time required

we t models for each value of

                                 

algorithm which ts the entire
for an ols t 

the en lars algorithm allowed easy tting of all models over a   fold internal
cross validation to estimate values for

         

each of these   internal cross 

validations was nested within the training set of a larger   fold cross validation
used to estimate out of sample error rate with the estimates of

        

chosen via

internal cross validation  logistic regression  lr  and lda were run in matlab 

fiforecasting purchasing behavior using fmri data

 

table  

   results and discussion
six classiers  lr  lda  linsvm  and   pda models  were applied to the data 
yielding the held out test rates and associated binomial p values shown in table   
all models classied above chance for the combined data and the  st presentation
data  p         the pda models  but not the others  also classied above chance for
the  nd presentation data  of the pda models  t tests showed that the pda enet
had signicantly higher rates than lda on all three datas  p          additionally 
pda lasso and pda ust had signicantly higher rates than lda on the  nd
presentation data  p          and pda lasso had higher rates than lda on the
 st presentation data  there were no signicant dierences between rates for lda
and either svm or lr on any data 

rates were signicantly higher for the  st

versus the  nd presentation data across all six models 
pda enet was freely optimized over the
timal solution values ranging from

     

 the approximate pda ust solution  
cv for all three datas were close to

 

parameter  which could take op 

 pda lasso solution  to

since the values for

      

 

         

chosen via   fold

the optimized pda enet solution

appeared to balance characteristics of both pda lasso and pda ust models 
critically  in addition to yielding the best classication rates to date for such
data  the pda models also increased coecient interpretability  the pda models
used here automatically selected a set of spatiotemporal inputs for classication 
zeroing the coecients of remaining inputs 

comparison models  i e   lr  lda 

svm  did not perform automatic variable selection and so assigned non zero coefcients to all spatiotemporal inputs  this  and the lack of regularization in the lr
and lda case  made the lr  lda  and linsvm coecients quite uninterpretable 
for purposes of interpretation  we plotted the pda model coecients as heat
maps organized spatially by region and temporally by time point in each trial
 figure    

below each heat map  average values within each region are plotted

over time  product  price  and purchase periods are also diagrammed 
for the rst presentation data  all pda models showed a strong contribution of
the left nacc starting during product presentation and continuing through price

fiforecasting purchasing behavior using fmri data

 

figure    

presentation 

the right nacc contributed more during price presentation 

the

mpfc s bilateral contribution was strongest during price presentation and the left
mpfc continued to contribute during the choice period  while all pda models
showed similar nacc and mpfc contributions  the insula contribution varied across
models  specically  the insula s contribution was clearest during the price period
in the pda lasso model but no longer evident in the pda ust model  since
insula contributions were most apparent in pda lasso and pda enet models 
they may have resulted from interactions with other input variables  see also      
all pda models t to the second presentation data indicate that the regions
of interest contributed dierently in this model than they did in the model t to
the rst presentation data 

the insula contributed more robustly  both in the

price and choice periods  across all three models  seemingly independent of the
contributions of other inputs 

in contrast  nacc and mpfc contributions were

weaker and less coherent in space and time than for the rst presentation data 
these ndings suggest that initial purchasing decisions may utilize dierent neural
circuits than repeated purchasing decisions  further  they show that pda enet is
a viable option for single trial based forecasting of purchasing behavior  and yields
interpretable coecients in space and time 

fiforecasting purchasing behavior using fmri data

 

references

    d l  donoho  de noising by soft thresholding  ieee transactions on information theory 
                   
    bradley efron  trevor hastie  iain johnstone  and robert tibshitani  least angle regression 
annals of statistics                     
    jianqing fan and runze li  variable selection via nonconcave penalized likelihood and its
oracle properties  journal of the american statistical association                         
    jerome h  friedman  regularized discriminant analysis  journal of the american statistical
association                       
    k j  friston  a p  holmes  k j  worsley  j  p  poline  c d  fritn  and r s j  frackowiak 
statistical parametric maps in functional imaging a general linear approach  human brain
mapping                    
    a  n  hampton and j  p  o doherty  decoding the neural substrates of reward related decision
making with functional mri  proceedings of the national academy of science               
     
    trevor hastie  andreas buja  and robert tibshirani  flexible discriminant analysius by optimal scoring  journal of the american statistical association           
    trevor hastie  andreas buja  and robert tibshirani  penalized discriminant analysis  the
annals of statistics                    
    trevor hastie  saharon rosset  robert tibshirani  and ji zhu  the entire regularization path
for support vector machine  the journal of machine learning research                   
     s  a  heuttel  a  w  song  and g  mccarthy  functional magnetic resonance imaging 
sinauer associates  inc  sunderland  ma       
     b  knutson  g  w  fong  s  m  bennett  c  m  adams  and d  hommer  a region of mesial
prefrontal cortex tracks monetarily rewarding outcomes  characterization with rapid eventrelated fmri  neuroimage                  
     b  knutson  s  rick  g  e  wimmer  d  prelec  and g  loewenstein  neural predictors of
purchases  neuron                  
     b  knutson  j  taylor  m  kaufman  r  peterson  and g  glover  distributed neural representation of expected value  journal of neuroscience                    
     c  m  kuhnen and b  knutson  the neural basis of nancial risk taking  neuron            
     
     n  k  logothetis  the neural basis of the blood oxygen level dependent functional magnetic resonance imaging signal  philosophical transactions of the royal society of london 
                   
     j  pankesepp  aective neuroscience  the foundations of human and animal emotions  oxford university press  new york       
     robert tibshirani  regression shrinkage and selection via the lasso  journal of the royal
statistical society  series b                     
     peng zhao and bin yu  on model selection consistency of lasso  technical report  statistics
deparment uc berkeley       
     hui zou and trevor hastie  regularization and variable selection via the elastic net  journal
of the royal statistical society  series b                     

fi