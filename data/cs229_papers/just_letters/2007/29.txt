cs    final project
control of an autonomous helicopter in autorotation
timothy hunter
autonomous helicopters have been studied for years because they represent an interesting class of
unmanned aerial vehicles  uavs   recent works  abb      have successfully shown that unmanned
helicopters can accomplish the most dicult acrobatic gures and can be controlled in dicult
attitudes by learning from a human model  in the wake of these studies  the present work is
interested in handling an unusual conguration such as landing with the engine disabled  i e  in
autorotation   the ultimate goal that we xed to ourselves is to build a controller that would handle
the approach and the landing at a given point without the engine at any time  in the course of
this class project  we built upon the previous works made by the stanford ai robotics lab  by
customizing the remote controlled helicopter used for  pieter  we were able to perform successfull
autorotations without the nal landing  and we laid out the ground for future works on the landing
itself 
a 

introduction

even if modern uavs have become very reliable over
the time  their inherent mecanical complexity make them
prone to failures while in ight  the engine failure is the
most common mecanical failure for helicopters  see for
example padeld      and pilots are trained to deal with
this situation  in this case  the blades  instead of pulling
the helicopter up in the air  are used as a break to slow
down the fall of the machine  this steady state is called
autorotation  a helicopter uav is usually considered as
expandable and its irremediable loss is the usual outcome in case of such a failure  however  now that uavs
are loaded with expensive sensors and y over densely
populated areas  it seems worth trying to recover from
such delicate congurations  since a human pilot can
safely land a remote controlled helicopter without its engine and since to our knowledge this had never been attempted before for small scale helicopters  it seemed interesting to try to give this task to the computer as well 
the helicopter dynamics in normal conditions is now
well understood and well simulated in nearly all the
range of maneuvers  however  the understanding of the
dynamics during autorotation requires a ne model of the
air circulation around the blades and is much more complicated  instead of attempting to build such a model
from theoretical consideration  we built a simple model
from ight data  this model is a linear model of nonlinear features  and thus can be used through standard
techniques to derive a controller from it 
a crucial factor is the speed of the blades  counted in
number of rounds per minutes  rpm   due to the air drag 
the rpm number tends to go down  if the blades turn too
slowly  the helicopter cannot sustain itself and follows a
free fall path  thus the capture and the identication of
an optimal autorotation blade speed was an important
part of our work 
we followed the following pattern in our work  we rst
recorded a number of autorotations made by our pilot 
using this data  we built a model for the steady state
part of the ight in autorotation and identied what we

considered as critical parameters for the controller  using the model and the parameters  a controller was automatically derived  tested in simulation and then in a full
experiment 
b 

modelization

we use the usual representation of a helicopter as a  
degrees of freedom solid object controlled by   inputs  
padeld     is a reference text on the helicopter dynamics  we also add as a state the rpm of the blades  the
inuence of the wind is neglected  thus our model has
   states and   inputs 
a helicopter usually a non linear behaviour due to the
relations between the angles and the velocities  following
the approach seen in abb      we build a model that predicts the physical acceleration in the body coordinates 
and which is usually a simple function of the other parameters in the body frame  according to physics  if we
know the acceleration  we can then predict the state using the equation
  b    
 b 
  b  
 b 
x

x
x
 

 y    r 
  t  y  
    y 
z t
z t 
z t 



t 

where r is the rotation matrix that maps the body coordinate frame at time t to the body coordinate frame at
time t      and depends only on the angular velocity at
time t   we have a similar equation for the angular velocities  thus we have a non linear model  even though
the accelerations are predicted using linear equations  
which means we cannot use standard frequency analysis
methods and instead rely on quadratic optimization 
we performed the following data tting 
t

ut   gu  t   cu   ut   

t

vt   gv  t   cv   vt   

wt   gw  t   cw   wt icol   

t

fi 
and

d 

t

pt   cp   pt ilat   

qt   cq   qt ilon   

t

rt   cr   rt icyc   

t

we express the acceleration in the body coordinates
at time t  from which it is easy to nd the acceleration
t
 x y z  in the reference earth frame by a rotation and
compute the velocity at time t      note that we substract the eect of the gravitation in our model  indeed 
gravitation has such a strong  and known  inuence that
it can be left out in the model tting and integrated back
in the simulation 
our simulation showed us that the blade speed had
only a small inuence on the other parameters  the blade
speed  expressed in rpm  follows the following model 
 p
t
q
 
 
 
 
vb   cb  vb u   v w icol ilat   ilon

c 

the controller was automatically generated using linear quadratic regulatic  thanks to the fact that our estimates of the accelerations are expressed as linear combinations  of non linear features   note that were are
evaluating a steady state model in which we do not care
about the position  we only want to regulate the blade
speed  the velocity and the attitude in a rst time   by
looking at the ight records  we identied an constant
value for the collective pitch 
ilon
ilat
icyc
icol

 
 
 
 

 
 
 
    

 we maintain a positive collective pitch throughout the
descent  the target model was the following
ztarget
xtarget
vblade
      

data collection

the helicopter used in this experiment is equipped
with a maxstream imu  instrumentation measurement
unit  that gives the angular accelerations and the attitude of the helicopter in the body frame at a rate of
  hz  the position was measured either with a gps or
with a setup of   cameras on the ground that tracked the
helicopter  the gps was eventually disabled because its
weight would penalize the performance of the helicopter
and furthermore the signal would be unreliable close to
the ground  due to obstructions by ground objects  
the blade speed is captured by a magnetic sensor positioned on the main gear of the helicopter  in order to
relay this data to the ground  we programmed a microprocessor that digitizes the information on board  this
processor transmits the rpms at a rate of about   hz
though a radio serial link  the blade speed we get from
this setup is accurate up the millisecond  for a practical
working limit of    milliseconds  and does not need to be
ltered 
the camera setup used for estimating the position is
unfortunately not robut enough close to the ground  the
helicopter is identied by centroid separation from the
background  however  because of the way the cameras
adapt to the luminosity  this setup works well when pointing either on the sky or on the ground  but not when
both backgrounds are present  as a rst workaround  we
mounted an ultrasound sonar that was shown to provide
accurate measurements of the distance to the ground for
distances of up to   meters  at a sampling rate of   hz  
this sonar shares the microprocessor unit used for the
blade counter to digitize and relay the information packets 

controller

 
 
 
 

  m s
   m s
     rpm
         

i e   we want to have a constant velocity  blade speed and
a level angle during descent  the blade speed and the
velocities were identied by by looking at the data of
previous ights 
note that we are building a model for the steady state 
since of course the helicopter is not at the beginning in
this steady state  the penalities introduced in the lqr
model had to be adjusted with respect to this fact  in
particular  the blade speed target had to be severely penalized  indeed  this parameter is already an order of
magnitude above the other parameters and the helicopter
would try to gain some forward speed at all cost in order
to build a good blade speed  this induced in the rst second of autorotation a dangerous free fall like behaviour 
note also we are not specifying a position target right
now  this is a point to consider in further research 
e 

results

the following parameters were used to modelize our
uav helicopter 
cp
cq
cr
cu
cv
cw
cb

 
 
 
 
 
 
 

                        
                         
                         
        
                
                         
                                      

fi 
this model yielded good results both in simulation and
in practice  the rpm model was very accurate as shows
graph     wich represents the simulated value of the rpms
 single value simulation  against the actual one during
one ight  as one can see  the values match closely 

the dotted plot is the actual ight data whereas the
plain plot is the simulated  open loop  altitude  also
shown is the mean square error usually obtained for this
simulation 
 

    

   

simulation

    

flight data

 
ms error  m 

    

blade speed  rpm 

    
    
    

   
 
   

    
 

    
   

    
    
    

 

   

   
time        sec 

   

   

the rst thing to notice is the range covered by the rpm
throughout the ight  wich further justies our choice to
model this feature  however  it was not found to inuence our model for the accelerations in a signicant way 
it may be interesting to further rene the analysis of data
to nd a direct inuence of the rpms on the acceleration
 as it exists in theory  
we validated our model with a full open loop simulator
that uses the physical model described by equation     
the simulator yielded good results in the steady part of
the autorotation  especially for the critical parameters
such as the altitude 
  

  

altitude  m 

  

 

   

   
   
time        sec 

   

   

note how the the two curves drift apart at the end of
the ight  not only does the pilot add some power and
reengage the engine  but also the ground eect becomes
increasingly important  at low altitudes  the air ow is
blocked by the ground  and this eect becomes a major
contribution to the sustentation of the aircraft  indeed 
our pilot could sustain the helicopter in hovering ight
for a few seconds and with the engine cut o by using
the ground eect 
the best test we can submit our controller to is the
control of the real helicopter  the uav was programmed
to begin in stationary ight at altitudes ranging from   
meters to    meters  in order to stay inside the vision
system   then the autopilot would disengage the engine from the blade gears and reach a new steady state
in autorotation  when the helicopter would go out of
the vision system  the pilot would take back the commands and reengage the engine  this experiment was
repeated successfully   times with slight variations each
time on the initial attitude and the target in order to
have a practical idea of the robustness of the controller 
after the controller penalty parameters had been properly adjusted  the helicopter would y successfully  see
the videos  

  
f 

 

  

  

 

   

   
   
time        sec 

   

   

conclusion and future plans

in the course of this project  we were able to accurately
predict the state of the helicopter during its descent in
autorotation by building a model from ight data  this
model showed good accuracy for the steady state part of
the autorotation ight and enabled us to derive a working
controller from it  this controller was successfully tested
on the real uav helicopter and demonstrated great accuracy and stability once the control targets and penalties

fi 
had been rened 
the practical results we obtained show that controlling a helicopter in steady state autoroation is not very
dierent from the techniques employed for normal ight 
our future work will concentrate on the landing itself
wich presents dierent challenges  since we can precisely
guide the helicopter before te landing stage  an easy solution would be to always guide it to the same conguration and apply a dened sequence of controls from
that point  however  it will be interesting to see how the
helicopter can be controlled up until the landing from different states  we have already begun to lay the ground
for this work with the sonar implementation 
g 

critical moments  i also want to express all my gratitude to pieter abbeel for his mentorship thoughout this
project  and his profound insight of dynamics and control  some technical details would have stopped short
this project without the expertise of morgan quigley and
the coding skills of adam coates  finally  i was able to
work on excellent data thanks to garett  our pilot  who
recovered the helicopter more than once from perilous
situations 

acknowledgements

my rst thanks go to professor ng for the idea of the
project and his kind words of encouragements at some

    modeling vehicular dynamics with application to modeling
helicopters  nips       
    g d  padeld  helicopter ight dynamics       

    r r  padeld  learning to y helicopters       

fi