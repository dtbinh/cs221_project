towards urban vehicle autonomy  estimating urban congestion from taxi
pickups and deliveries
federico rossi

sumeet singh

abstract while there are several advantages that can be
attributed to the use of autonomous vehicles for personal
mobility  their overall impact on surrounding traffic and levels
of congestion is as of yet  poorly understood  a crucial stepping
stone towards a better understanding of the relation between
large fleets of autonomous vehicles and urban congestion is
the creation of a predictive model of urban congestion  in this
paper  we present a geospatial  time variant predictive model
for urban traffic congestion within manhattan using a machine
learning approach  the model relies on taxi data collected in
new york for the month of february      and encompasses
features such as number of taxis on the road  time of day 
weather  and day of the week and predicts the average speed in a
given region  using a multi class support vector machine with a
gaussian kernel resulted in an average rms error under   mph
with a classification accuracy between         for central
manhattan  the relatively high prediction accuracy suggests a
strong correlation between the taxi data and the macroscopic
traffic pattern and congestion in most of manhattan  this model
constitutes a first step towards analyzing congestion resulting
from a fleet of autonomous vehicles 

i  i ntroduction
autonomous vehicles have been claimed to offer many
potential benefits to urban personal mobility  including lower
cost to the user  better vehicle utilization  more efficient
urban land use  and increased safety  while many of these
claims are logically sound  it is far less clear what the effects
of vehicle autonomy will be on traffic congestion  one of
the most promising uses of autonomous vehicles is one way
vehicle sharing  or equivalently  autonomous taxi service 
with this in mind  some have argued that autonomous
vehicles will in fact increase urban traffic congestion due
to many empty vehicle trips  when the vehicle travels from
a passenger destination to the next pickup location  on the
other hand  autonomous vehicles  when routed intelligently 
may help alleviate traffic congestion and decrease overall
travel times  since the number of autonomous taxis in the
city may represent a significant portion of all urban traffic 
a predictive model of urban congestion must first be created
that takes into account not only how vehicles respond to
traffic  but how a fleet of vehicles generate traffic  in this
report  we focus on the creation of such a congestion model
using existing taxi data from new york city  specifically
manhattan  as a case study 
congestion data is often directly gathered from probe
vehicles  induction loops embedded in asphalt or surveillance
federico rossi  sumeet singh and rick zhang are with the autonomous systems laboratory  department of aeronautics and astronautics 
stanford university  stanford  ca          frossi   ssingh   
rickz  stanford edu

rick zhang

cameras  while these approaches offer data with high spatial
and temporal density  they present significant drawbacks 
deployment of dedicated infrastructure or repurposing of
existing facilities typically has a very high cost  while probes
offer no information about traffic density and do not scale
well because of privacy concerns  furthermore  these forms
of data do not provide information on how large taxi fleets
contribute to congestion  on the other hand  large cities
routinely collect data from their taxi fleets including pickup and delivery locations  trip distances  and travel times 
the taxi traffic in a large city such as new york arguably
presents a strong correlation with the overall traffic flow and
reflects macroscopic mobility patterns  however  since the
route taken by each taxi is usually not recorded  congestion
information can only be indirectly estimated  to build our
congestion model  we used a database of pick up and delivery locations and times of all nyc taxis for the month of
february       obtained through the freedom of information
act  the challenge intrinsic in estimating congestion from
pick up and delivery pairs is the reconstruction of routes
from their endpoints  in an urban center  each taxi may
choose to take one of many routes with the same manhattan
distance from start to end points  since exact routes taken
cannot be determined from the data  we employ a simple and
computationally efficient model that discretizes the city into
a grid and estimates local average velocities in each part of
the city  we then correlate the local velocity estimates with
features such as local taxicab density  time and day of the
week  and weather conditions 
the rest of this report proceeds as follows  section ii
briefly outlines the existing literature in congestion modeling 
section iii describes the modelling approaches we have
taken  section iv discusses the performance of our model
and section v summarizes our results and outlines next steps
to be taken 

ii  r elated w ork
the problem of estimating traffic congestion on highways
has seen significant interest in the scientific literature since
the     s  in particular the bureau of public roads  bpr 
model  which correlates traffic flow and road congestion as
measured by the time required to cross a given road segment
     has been used in scientific studies and highway planning
with remarkably accurate results  the bpr model estimates

fithe time sa required to cross a given road segment as
    
va
sa  va     ta         
ca

   

where ta is the free flow transit time  defined as the transit
time in absence of any vehicular traffic   ca is the route
capacity  measured in terms of traffic flow  and va is the
actual traffic flow on the route considered  experimental
observations show that traffic congestion often manifests
itself in three phases 
 free flow  in which vehicles do not interact with one
another and move at the free flow velocity  loosely
correlated with the speed limit of the road  
 synchronized flow  a transition region between free flow
and traffic jam 
 traffic jam  characterized by a downstream front moving at low  constant speed 
we refer the reader to     for an excellent review of the state
of the art in highway traffic congestion modeling  urban
traffic congestion  on the other hand  is less understood
and very much a subject of active research  sheffis book
    offers a comprehensive  if dated  review of modeling
approaches to urban traffic  a graph abstraction with variable
link weights is typically employed  reducing the problem to
congestion estimation and optimal routing on graphs  it is
unclear whether highway congestion models are applicable
to urban transportation  sheffi suggests existence of a connection between traffic flow and congestion  as measured by
the average speed  but does not propose any analytical shape
for this function  recent works represent urban congestion
through markov models           these models offer very
good estimates of overall traffic from limited data points 
but they lack predictive power  making them unsuitable for
estimating the impact of intelligent fleet routing on overall
traffic congestion  most existing works base their estimates
on high fidelity data collected from gps equipped probe
vehicles  induction loops embedded into the ground and
traffic cameras      data collected through these means has
high spatial and temporal resolution  on the other hand 
scalability and cost of deployment are major issues barring
widespread adoption  to the best of our knowledge  our
work is the first to estimate traffic congestion based on lowresolution taxi pickup and delivery points 
iii  m ethodology
a  local velocity estimation
prior to investigating possible machine learning algorithms
to predict local traffic congestion  our first step is to extract the local average velocity and the local taxi density 
average velocity is the primary congestion indicator  while
the number of taxis in each part of the city is an important
feature when estimating congestion since it is related to the
overall vehicle density  the raw nyc taxi data is sorted
chronologically and pruned to isolate trips that are only
within manhattan  figure   shows the pickup and delivery

locations within the peninsula between midnight and   a m 
on february  st  based on the raw data  we estimate that
around     of the    million taxi trips in our database are
solely within manhattan  having isolated trip data to within

 a  pickups

 b  deliveries

fig     pickup and delivery locations in manhattan for a  
hour interval
manhattan only  we subdivide the area into a rectangular
grid with    m by    m cells and approximate vehicle
trajectories using straight line paths  as the given problem
is inherently time varying  the data is further segmented into
hour long blocks so that local congestion information for a
given grid element can be extracted  the task is then to find
the number of taxis that passed through a given grid element
within each hour and the subsequent average velocity within
that area  the average velocity for a grid element is found
by calculating a weighted average of the velocities of all
taxis that passed through it within a specified time span 
the velocities of all taxis are then approximated as being
constant along their routes and found by dividing the total
trip distance by the total trip time  the weight assigned to
each trip equals the length of the section of the trip within
the grid element divided by the net euclidean distance  thus 
vij  
 k 

 k 

 k 

wij v  k 
p  k 
k wij

p

k

where wij   lij  l k  is the assigned weight for the k th
trip in the  i  j th grid element  vij is the average velocity
 k 
within grid element  i  j   lij is the length of trip k within
th
the  i  j  grid element  l k  is the total euclidean trip
length and v  k  is the average speed of the k th trip  the

fi  

average speed

  

    
normalized traffic speed

sum is over all trips through the given grid element  by this
method  a higher confidence is assigned to trips that spent a
greater proportion of their trip within the given grid element 
a modified version of the fast voxel traversal algorithm
for line tracing     is used in performing the calculation 
a sample output from one such data run is shown in fig 
   as can be seen  there is a distinct correlation between

    
    
    
    
    
 
 

  
  

bpr model
bpr model with offset

                   
   
normalized number of taxis

    

fig     fitting speed vs  number of cars to the bpr model

  
  
 
 
 

    

    
    
number of cars

    

fig     sample output for a cell in midtown manhattan
the number of taxis within a given grid element and the
resulting average velocity within that area  having obtained
our congestion indicator values  we are able to proceed with
identifying trends within the data and applying machine
learning techniques to predict congestion 
b  regression
our baseline approach is to fit the state of the art bpr
congestion model to traffic data for a select number of cells 
we do not account for features such as time of the day or day
of the week  consistently with bprs hypotheses that congestion is uniquely determined by the number of cars and the
road capacity  here  considered constant within a single cell  
results for cell         located in midtown manhattan  are
shown in fig     they are rather underwhelming  with a rms
error of      mph  in particular  bpr grossly overestimates
congestion for high traffic volumes 
in highway models  average speed drops to zero in a traffic
jam  manhattan data  on the other hand  shows the jam region
moving at a constant  positive speed  we therefore modify
the analytical bpr equation  adding an offset term to account
for this effect  the fit  also shown in figure    is better but
still far from optimal  with an rms error of      mph after
training on the whole dataset  furthermore  the algorithm has
clear difficulties predicting the onset of the synchronous flow
phase  placing it around      cars per hour earlier than it
should 
the most probable cause of failure is the fact that  while
traffic may uniquely depend on the number of cars on the
road  the fraction of taxis is not constant throughout the day 
informally  taxis make up a significantly higher fraction of
traffic at night and outside rush hour  however  controlling
for the time of the day is not possible  the number of taxis

is strongly related to the time of the day  resulting in very
poor data on a per hour basis  this will be discussed in
more detail in section iii c  more powerful methods are
therefore required to explore the complex dynamics of urban
congestion and the correlation between average speed and
number of cars  weather  time of the day and date 
c  classification
a  feature selection  underwhelmed by the results of
the regression  we approach the problem from a different
angle  rather than relying on continuous classifiers  we
discretize the number of vehicles and the average velocity 
then try to estimate the discretized average velocity within
each cell as a function of the number of taxis  time of
the day  weekday weekend  boolean   and weather  figure
  shows the distribution of the average speeds as well
as number of taxis in a cell in midtown manhattan as it
changes throughout the day  we can also clearly see the
drastic difference between weekdays and weekends  note
that the single outlier which seems to exhibit a weekend
distribution on a weekday was presidents day on february
  th   as discussed in section iii b  the actual number of
vehicles on the road  vehicle density  should be a good
predictor of congestion  theoretically  this may be calculated
by dividing the number of taxis by the fraction of total
vehicles that are taxis  however  this fraction is unknown
and does not remain constant throughout the day  and is not
the same in different parts of the city   by using the time of
the day as a separate feature  the classifier may be able to
extract more information about the fraction of total vehicles
that are taxis 
weather conditions  obtained from weather underground
     are used because rain or snow may cause slower speeds
on the road  weather  considered uniform across nyc  is
classified as clear  raining or snowing and updated hourly 
average speed is discretized in three bins  roughly corresponding to free flow  synchronized flow and traffic jam  the
number of cars is discretized in    bins  the features are
assembled into a feature matrix and fed into classification
algorithms to estimate the local average velocities 

finumber of taxis

    
    

weekdays
weekends

    
    

average speed  mph 

 
 

 

  
  
time of day  hr 

  

  
  
time of day  hr 

  

  
  
  
 
 

weekdays
weekends
 

twofold improvement over bpr regression  the widening of
the gap between the training and test learning curves  shown
in fig     suggests that the algorithm may be entering a high
variance regime  which warns us against considering new
features  in particular  adding spatial information to each
cells features and performing a global estimate of traffic
flows results in disastrous performance  while data within
each cell is predictable  correlations between neighboring
cells  which can have different traffic capacities  are not
understood by the svm algorithm  which is unable to
interpret geospatial information and performs only slightly
better than random in this case 
   

fig     number of taxis and average speeds throughout the
day  for both weekdays and weekends

  

error

b  algorithm selection  several classification algorithms were evaluated on a small number of cells  sample
cells were selected based on the quality of their data  specifically  we sought cells whose features and labels represented a
good cross section of the overall dataset  with high variance
both in the number of vehicles and in the range of average
speeds  algorithms are benchmarked and tuned on these
cells  their performance is then validated on the whole
dataset 
nave bayes was first trained on the number of cars
alone to assess baseline performance  classification accuracy
for sample cell        is between     and      far from
acceptable  the corresponding rms error  measured as the
difference between the actual average speed and the center of
the bin where the sample was classified  averages     mph 
training nave bayes with a richer feature set  including
weather conditions and whether the day in question is a
weekday or a weekend  leads to test accuracy consistently
between     and     and rms error averaging     mph 
in both cases        cross validation is employed  time of
the day is not included in features because of its strong
correlation with the number of cars  and since nave bayes
assumes all features to be conditionally independent 
inspection of the training curves  shown in fig     suggests
that nave bayes operates in an high bias regime  we
therefore switch to an svm classifier  which explores a wider
solution space 
linear svm performs exceedingly poorly  its failure is
most likely caused by the fact that features are not linearly
separable in any meaningful way  even with l  relaxation 
in their original space 
nonlinear svm  on the other hand  achieves accuracy
significantly higher than nave bayes  direct experimentation
shows that a gaussian kernel with a one against one
multiclass svm model     consistently offers the best testing accuracy  classification accuracy for sample cell       
is consistently between     and      with       crossvalidation  and the rms error averages     mph  a nearly

test error
training error

  
linear svm  cars  weather and weekend

  
  

naive bayes    cars only
naive bayes  cars  weather and weekend
nonlinear svm  cars  weather and weekend

 
  

  
  
  
  
  
fraction of data used for training

  

fig     learning curves for nave bayes  linear and nonlinear
svm for sample cell       

iv  r esults
the nonlinear svm algorithm with gaussian kernel and
pairwise comparisons is applied to all the cells in manhattan
to estimate local average speeds  the performance of the
classifier is evaluated using       simple cross validation
     training      testing   and the testing accuracy is
shown in figure  a  for most regions of manhattan  the
classifier identifies the correct phase of traffic flow with    
to     accuracy  the accuracy drops down to around    
in the northern parts of manhattan  north of central park 
due to the lack of sufficient data  from figure    it is clear
that relatively few taxi trips begin or end north of central
park  in these regions  the number of taxis become a poor
predictor of overall vehicle density 
figure  b shows the rms error between the vehicle speeds
and the predicted average speed  average of each bin   for
most of the city  the estimated average speed is within   mph
of the actual speed  errors are higher in the northern parts of
the city due to the lack of data  as discussed  together  these
figures show that our model accurately captures the traffic
levels of manhattan around and south of central park 
figure   shows average speed data plotted against the
number of taxis as well as predicted average speeds  color

fi  
  

   

  

  
  
  
  

   

  

  
  

   

  

  
  
  
  

   

  

  
  

  

   

  

  

  
  

  
  

  
  
  

 

  

 

  

 

 

 

 
 

  
 

  

 

 a  classification accuracy

 

  

 

         
 
       

  

 

  

   
   

 

traffic speed  mph 

    

   

 
 
         

  
  

    
    
    
avg  number of taxis

    

fig     performance of the nonlinear svm classifier for one
cell  the horizontal dashed lines mark the boundaries of each
speed bin  the colors represent the predictions made by the
classifier  a correct prediction is made if the data point lies
within its predicted bin 

 b  rms error

fig     classification results for the whole manhattan grid 
nonlinear svm classifies the discrete congestion indicator 
related to congestion phase  with     to     accuracy
around and south of central park  the resulting estimated
traffic speed is consistently within   mph of the actual one 

coded into   bins  for cell         the three speed bins
roughly correspond to the three phases of traffic flow  and the
classifier is able to correctly classify most data points  even
outliers with very low speeds and low number of taxis  

number of cars on each segment of the road network by using
routing heuristics that mimic driver behavior to reconstruct
routes in a realistic yet computationally efficient way 
this predictive model allows us to perform high fidelity
simulations of trips within manhattan that take into account
urban traffic congestion  as new personal mobility solutions
become practical with the help of vehicle autonomy  for
example  autonomous mobility on demand systems       
this model can be used to evaluate the impact of these
mobility solutions on urban congestion 
r eferences

v  c onclusions and f uture w ork
in this report  we detail the derivation of a predictive
model of urban traffic based on data from pickup and delivery
locations of taxi trips  after showing that the standard bpr
congestion model is not suitable for estimating urban congestion  we propose a classification based approach  our model
locally estimates a discrete congestion indicator  related to
the three phases of traffic flow   then reconstructs the average
traffic speed  our model is tuned and its behavior is evaluated
on a small number of cells located in central manhattan  in
this document  the procedure is outlined on a single cell
for simplicity  the model is then trained on the whole grid 
results are encouraging  with very accurate prediction of
the discrete congestion estimator and precise reconstruction
of the actual traffic speed  we consistently obtain        
classification accuracy and the estimated traffic speed is
generally within   mph of the actual speed in most areas
south of    th street 
one of the key limitations of our model is its inability to
capture directionality of congestion  average speed strongly
depends on the direction of travel in both urban and nonurban settings  future work will adopt a graph based model
rather than our current grid based paradigm  allowing us
to better capture the traffic patterns of road networks and
direction of travel  it will also allow us to better estimate the

    weather
underground
api
and
historical
database 
http   www wunderground com  retrieved    oct       
    john amanatides and andrew woo  a fast voxel traversal algorithm
for ray tracing  in in eurographics     pages           
    bureau of public roads  traffic assignment manual  technical report 
u s  department of commerce  urban planning division  washington 
d c              
    chih wei hsu and chih jen lin  a comparison of methods for multiclass support vector machines  neural networks  ieee transactions
on                     
    s  kataoka  m  yasuda  c  furtlehner  and k  tanaka  traffic data
reconstruction based on markov random field modeling  arxiv eprints  june      
    james h kell  iris j fullerton  and milton k mills  traffic detector
handbook  technical report       
    boris s  kerner  modeling approaches to traffic congestion  in
encyclopedia of complexity and systems science  pages          
springer       
    vahid moosavi and ludger hovestadt  modeling urban traffic dynamics in coexistence with urban data streams  in proceedings of the  nd
acm sigkdd international workshop on urban computing  page    
acm       
    yosef sheffi  urban transportation networks  equilibrium analysis
with mathematical programming methods  prentice hall  englewood
cliffs  new jersey       
     kevin spieser  kyle treleaven  rick zhang  emilio frazzoli  daniel
morton  and marco pavone  toward a systematic approach to the
design and evaluation of automated mobility on demand systems  a
case study in singapore  in road vehicle automation  springer      
 in press  

fi