forecasting the direction and strength of stock market movement
jingwei chen
                                            cjingwei stanford edu

ming chen

nan ye

mchen  stanford edu

nanye stanford edu

abstract     stock  market  is  one  of  the  most  complicated  systems  in  the  world   and  it  has  connection  with  almost  every  part  in  
our  life   in  this  paper   we  applied  different  machine  learning  methods  to  predict  the  direction  and  strength  of  the  market  index  
price  movement   specifically   we  looked  at  multinomial  logistic  regression   k nearest  neighbors  algorithm   linear  discriminant  
analysis    quadratic   discriminant   analysis    and   multiclass   support   vector   machine    and   compared   their   performance   results  
based  on  test  accuracy   robustness   and  run time  efficiency   
  
   introduction
stock market movement prediction is a challenging task because of the high data intensity  noise  hidden structures  and the high
correlation with the whole world  in addition to forecasting the movement prediction  we also tried to predict the movement
strength of stock market at the same time 
we started with a brief description of the response and the predictors  which we think are relevant  and did feature selection
based on the correlation coefficients between them  finally  we applied different machine learning methods to train the data and
make predictions  the data is from yahoo  finance and federal reserve bank of st  louis 
   dataset
the response in our models is based on the historical data of s p     index  we divided the returns of s p     index into four
categories based on our segment threshold  as following                             
we marked them with class         and    so that we can integrate the information about stock market movement and its strength
together  our predictors include the lagged change rates of following indices   s p     index  us dollar index  volatility index
 vix   ftse     index  nikkei     index  hang seng index  shanghai stock exchange composite index  s p     index
volume  s p     index highest price change rate during the period  s p     index lowest price change rate    month t bills
rate     year t notes rate and initial jobless claims  the range of the data is from            to            therefore  there
are      observations in the daily data and      observations in the weekly data 
   evaluation metric
we set aside the last     observations in our data sets as the test data because we only care about the predictability of our models
in the recent period and the best model might change as time flies  we trained our models on the data based on different training
dataset size and different segment thresholds and then applied the coefficients we obtained to make predictions on the test data 
we use test precision defined as

  y

 i  
pred

i

 i  
 i  
 i  
 i  
  yactual
      yactual
    where y pred and yactual are the i th predicted response and the ii

th actual response  also  we looked at the test precision based on the probability of class   occurring when we predict the
response is    i e  
 i  
pred

p yactual      y pred

 i  
actual

  y   y     
     
 
  y     
i

 i  
pred

i

the realized distributions of our test set on the   categories are shown below 
realized distribution of test sample  weekly 

   

   

   

   

distribution

distribution

realized distribution of test sample  daily 

   

   
 

 
 

 

     
 

    
     
segment threshold

 

   
   
 
 

 
 

    
 

    

category

    
segment threshold

 

category

fi   multinomial logistic regression
multinomial logistic model with four categories has three logit functions 
                 

          

while class y     is the reference group  so we can write the logit functions as the following 
     

                      

      

         

         

where   and    are the regression coefficients  the multinomial logistic functions are then defined as 
  
 
                   
 
     
 

                 
    

         

we then only need to compare the four logistic functions and pick the greatest one as the predicted category  the out of sample
category prediction results based on daily and weekly data are shown below 
mlr  overall  weekly 

   

   

   

   

test precision

test precision

mlr  overall  daily 

   
   

   
   

   

   

   
    

   
    
   

     

    
    

    
   

    

   

     
 

training size

 

segment threshold

    
   

training size

 

segment threshold

  

mlr   th class  weekly 

mlr   th class  daily 

   

   

   

   

test precision

test precision

    

   

   

 
    

   

   

 
    

     

    
    
    
training size

   

    
   
   

     
 

 

segment threshold

    

training size

    
   

 

segment threshold

  

the first row of graphs presents the overall category prediction results based on our mlr model  as the segment threshold
increases  above      for daily and    for weekly   both daily and weekly data perform better  however  the performance of
weekly data is less volatile than the daily data  and weekly data generally yields a better performance with respect to the same
level of realized distribution of the test sample we use 

fithe situation in the second row is similar to that of the first row  in terms of the  th class  i e  y     or extreme positive  
weekly data based model significantly outperforms the one based on daily data with respect to both accuracy rate and reliability 
therefore  weekly data based mlr model is more prosperous and reliable for real world real time prediction 
   linear discriminant analysis
we applied both linear discriminant analysis  lda  and quadratic discriminant analysis  qda  to model the data  qda assumes
that each class has its own covariance matrix  consequently  lda has lower variance  which leads to improved prediction
performance  as we performed both models  we found out that lda substantially outperforms qda  thus  we will only present
the lda model here  with different values of training size and segment threshold  the overall and  th class test precisions with
weekly and daily data are shown as below 
lda  overall  weekly 

lda  overall  daily 

   

   
    

test precision

test precision

   

   

   

   
    
   
    

   
    

   
    
     

    

    

    
    
training size

   

     
 

 

    
training size

segment threshold

 

 

segment threshold

lda   th class  weekly 

lda   th class  daily 

   

   
   

test precision

   

test precision

    

   

   

   
   
   

 
    

   
    
     

    
    
    
training size

    
   

    

     
 

 

segment threshold

    
training size

 

 

segment threshold

  

as can be seen from the figures above  weekly data performs better than daily data and the test precision does not change
significantly with different values of training sizes  however  it severely depends on the segment threshold value  it is worthy to
note that  when threshold becomes larger  the observation in class   will increase and our model tends to predict class    thus
the overall precision increases while the  th class precision drops 
   k nearest neighbors algorithm
we performed sensitivity analysis with different values of k and it turned out that k     would be a reasonable choice  with
different values of training size and segment threshold  the overall and  th class test precisions with weekly and daily data are
shown below 

fiknn  overall  weekly 

knn  overall  daily 

   

   

   

test precision

test precision

   
   
   
   
   
    

   

   

   
    
     

    

    

    
    
training size

   

     
 

 

    
training size

segment threshold

 

 

segment threshold

  

knn   th class  weekly 

knn   th class  daily 

   

   
   

test precision

   

test precision

    

   

   

   
   
   

 
    

   
    
     

    
    
    
training size

    
   

    

     
 

 

segment threshold

    
training size

 

 

segment threshold

  

we can see that knn model underperforms lda model and shows bad results for medium segment threshold values  nor is its
prediction accuracy for  th class satisfying  besides  the running speed is also much lower than lda  therefore  we recommend
lda to model data 
   multiclass support vector machine
the last model we used is the multiclass svm model  which consists of the preceding observations of the test point  because
we have     test points  so we should train our models for     times and make predictions separately  we applied the same
segment thresholds to categorize the returns of s p     index  except that we changed the range and the size of step  we
trained our models on the scaled and non scaled daily data and weekly data  and we also applied different kernels to the model 
including linear kernel  polynomial kernel  radial basis function kernel  and sigmoid kernel 
after trying out all the kernels above  however  we discovered that the linear kernel and the polynomial kernel do not apply to
this problem  and sigmoid kernel behaves similar to radial basis function kernel  moreover  the outcome of daily data is similar
to that of weekly data  therefore  we only show the results of our svm models using radial basis function kernel on daily data 
the results of our multiclass svm are shown below 

fimulticlass svm  overall  scaled 

multiclass svm  overall  nonscaled 

   

   
test precision

test precision

   
   
   
   
   
    

     

   
   
   

     

    
    

    
   

   

     

     
training size

 

 

training size

segment threshold

 

 

segment threshold

  

  

we can see that scaled predictors perform more robust than non scaled predictors because the range of test precisions is
narrower on scaled predictors  also  we can conclude as before that the training size has little effect on the test precision while
segment threshold affects the test precision significantly  in addition  we can achieve more than     test precision if we
choose a proper segment threshold no matter whether we scale the predictors 
   conclusion
based on the results from different machine learning methods  we can see that multinomial logistic regression performs the
best in all the models in terms of the model robustness  prediction precision  and run time efficiency  all the models perform
better on the weekly data than on the daily data  for multiclass svm  scaled predictors can improve the robustness of the model
in the prediction 

reference  
g james   d witten   t hastie   r tibshirani           an  introduction  to  statistical  learning   springer   
r choudhry   k grag           a  hybrid  machine  learning  system  for  stock  market  forecasting   world  academy  of  science   
engineering  and  technology        
w huang   y nakamori   s wang           forecasting  stock  market  movement  direction  with  support  vector  machine   computers  
   operations  research        pp              

  

fi