learning to predict image affects in social networks

  

sen wu

zhihao jia

department of computer science
stanford university

department of computer science
stanford university

senwu stanford edu

zhihao stanford edu

introduction

popular social networks such as flickr  facebook  google   and
twitter provide users ability to upload images and label them with
certain emotions  for example  if you feel happy  you can upload a
california sunshine picture on your facebook and marked it with a
smile face  or you could feel grieved and update a heavy downpour
picture on your flickr with a sad emotion marker  since images
provide an efficient way to express emotions and affect others  its
applications in social networks is becoming more and more popular  however  predicting image affects in social networks is a difficult problem and poses many challenges  the main challenges are 
 how to address the issue caused by the fact that similar images may cause totally different affects 
 how to model the correlation between the image visual features and affects 
 how to come up with a practical learning model and deploy
it in a efficient way 
a naive approach to predict the user emotions by images is scanning basic elements in the images and exploit the correlations between certain image components and certain user emotions  for example  sunshine usually correlates with happy emotion and downpour correlates with sad emotion  another example is that images
with warm colors correlates with positive affects  while images
with cold colors correlates with negative affects  therefore  by exploiting particular components  e g   color features  brightness  and
saturation  in images  we can predict the affects for some images 
one downside of the above approach is that similar images may
cause totally different affects  images with a need fire may refer
happy to some people  but could mean angry to others  therefore 
how to predict the affects for these seemingly ambiguous images
is a main challenge for our project  to address the issues  we introduce homophily phenomenon into our predictor  and refine our
prediction by considering the affects homophily among users in the
same community 
the homophily phenomenon  the observed tendency of individuals tends to choose friends with similar tastes and preferences     is one of the most striking and interesting regularites of
social life  homophily was first studied by pychologists with small
groups of participants  with the rapid proliferation of online social
networks such as twitter  facebook and flickr  it becomes feasible
to conduct investigations on real large scale social networks      
in practice  it can help us achieve an in depth understanding on the
complex dynamics in social networks  and benefit various aspects
such as advertising and economics 
in this paper  we employ an image based social network flickr
as the source for our experimental data  homophily can be influenced by various factors such as individual status and community
pressure  in individual level  different tastes and preferences may

figure    community homophily analysis  taking night images
community  one of the most popular communities in flickr  as the example  the figure shows the color features consistency within community and between community  the within community average distance
stands for the average euclidean distance between two images color
features over all possible pairs coming from the same community  the
between community average distance stands for the average euclidean
distance over all possible pairs coming from different communities 

result in different user emotions under a particular image         
but in community level  connected individuals can influence each
other and tend to behave similarly      for example  as the common
sense  colors are the most relevant attributes with image affects 
figure   shows the consistency of color features among images
from the same or different communities in flickr  it can be clearly
seen that for all the six basic affects      the colors of their corresponding images in the same community have much higher consistency than those in different ones  which indicates the importance
of homophily in predicting image affects in community structured
social networks 
how to design a principled model to automatically predict emotions from social images by considering both the image attributes
 e g   color features  and the homophily phenomenon  e g   community information   this problem is a non trivial and pose a
challenge  to address this challenge  we first formally define two
patterns of homophily phenomenon in different levels  individual
level and community level  a novel community aware factor graph
model  comfg  is further proposed to incorporate both the image
attributes and homophily patterns to predict affects of social images  to validate the effectivenesss of our method  we test the proposed method on         random download flickr images  and the
experimental results show that the proposed method significantly
outperforms the alternative methods 
the rest of paper is organized as follows  in section    we give
the definition of homophily patterns and formulate the problem 
section   introduces the community aware semi supervised factor
graph model and the learning algorithms  then in section    we report the experiment setup and performance using proposed method 

fiand further provides discussions  in section    we review the related work  the paper concludes in section   

  

problem definition

let g    v  e  represent a social image network  where v  
 p            pn   is the set of  v     n images with user ui published
pi at time ti and e  v v is the set of  e    m edges  each edge
eij represents image pi having a correlation with image pj  e g  pi
and pj uploaded by the same user in a short time   in this network  we further assume all images belong to c communities and
use an binary valued n  c matrix c to represent users community memberships where each binary valued element cik  c represents whether image pi belongs to the kth community  here  we
use ck to represent kth community  for example  in flickr  users
can construct communities and upload images to communities  in
addition  each image vi is associated with a d dimension attributes
xi which describe images attributes  e g  color features   here  x
is defined a  v     d attribute matrix associated with all images 
furthermore  each image uploaded by user can present his her affects  a  a  p  ui   t  denotes user ui uploaded image p  p at time
t  where p is the set of images  presents the affect a  a  where a
is the set of possible affects 
our goal is to study how homophily behavior effect users affects  given this  we define several definitions and our problem 
definition    affects  the affective categories of an image pi
is denoted as ai  a  where a is the affective space defined by
ekman    
a    happy  sad  anger  disgust  surprise  f ear 

   

in order to better understanding the problem  we define two different levels of homophily from the level of individual and community  please note that a image may involve in many different
communities  here we only consider its main group 
definition    individual homophily  the individual homophily
is defined as the color attributes absolute error between image pi
and the mean color attributes from user uj  
ih p   

 ap  auj  
auj

  

model framework

in this section  we propose a novel community aware factor
graph  comfg  model to incorporate both color features and homophily behaviour for better modeling and inferring the images
affects updated by users in large networks 

   

community aware factor graph model

a social image network can be represented by a graph g  
 v  e  with a node set  v     n and an edge set  e    m representing all images and edges in network  besides these  we know that
there are many communities c  in social networks and there are
some special affects representations within communities  figure  
demonstrates the graphical representation of the comfg model 
figure   a  shows our input is a social network with image attributes  users relationship and community informations  then 
we spilt the network based on community information as figure
  b   next  we define factor graph model on each community 
in comfg model  we attempt to maximize conditional probability of image affects given their the corresponding attributes  communities and network  i e   p  y  x  g  and according to the bayes
theorem  we can define a factor graph as 
p  x  g y  p  y  
 p  x y    p  y  g     
p  y  x  g   
p  x  g 
where p  y  g  defines the probability of affects given the structure
fo the network and p  x y   defines the probability of generating
the observation variables x given the latent variables y   further
assuming  the generating probability of the observation variables is
conditionally independent  so
y
p  y  x  g   p  y  g 
p  xi  yi  
   
i

where p  xi  yi   is the probability of generating the observation
variables xi given the latent variable yi  
in the proposed comfg  we are capturing two kinds of information  i e  the attributes associated with each image and two levels
of homophily we defined in     we have two factor functions to
represent the individual homophily and community homophily 

   

where ap denotes the color attributes of image p  and auj represents
the mean color attributes of images uploaded by user uj  
we also define community homophily to represent how communities effect the image affect 
definition    community homophily  the community homophily
is defined as the color attributes absolute error between image pi
and the community ck mean color attributes image pi belongs to 
 api  ack  
   
ack
where api denotes the color attributes of image pi   and ack represents the community ck s mean color attributes 
gh p  cpk    

 individual homophily factor  f  yi   ih pi    represents the
correlation between image pi s affect and individual homophily 
 community homophily factor  f  yi   gh pi   ck    represents
the correlation between image pi s affect and homophily to
its community ck  
more precisely  we decompose the original factor graph model
into several communities based on the community information  as
we know  there are c communities in the network  so the prior probability p  xi  yi   can be split into c communities as pk  xi  yi    then
we can get 
c
c y
y
y
p  y  x  g  
pk  y  gk  
pk  xi  yi  
   
k  

please note that individual and community homophily is defined
on each specific affect  more precisely  the problem can be defined
as 

k  

i

where we ignore all the cross community probability in order to
simplify our model and reduce the cross community influence 
in order to instantiate the probability of pk  y  gk   and pk  xi  yi   
problem    image affect prediction  given a network g  
we model them into a markov random field  and according to the
 v  e  c  x  and an pictures uploading history h     a  p  vi   t  p a i t   hammersley clifford theorem      the probabilities can be instanour goal is to incorporate all kinds of information into a uninaed

tiated as 
 
model to learn a predictive function 
exp k  fk  xi   yi   
   
pk  xi  yi    
z 
f    g  h   a
   
where k is the weight of feature vector function and fk  xi   yi   is
where ai  a indicates what is the affect of the picture pi  
the set of feature functions in the kth community  similarly 

ficommunity  
 

y 

 
y 

 
 

community  

y 
y 

 

community  

y 

y 

 

y 
y 

 
 

y 

 

community  
y  

y  

community  
y  
y  

  

y  

  
y  

community  

  

x  

x  

x  

 a  an example of the problem

 b  decompose of factor graph by communities

 c  graphical representation of comfg

figure    an example of the problem and graphical representation of comfg model 

pk  y  gk    

 
exp k  hk  yi   yj   
z 

name
saturation
brightness
color ratio
dominant colors

   

where k is the weight of correlation vector function and k 
hk  yi   yj   is the set of correlation functions in the kth community 
model learning  we now learn to comfg model by estimating
the parameter configuration                  such that    
arg max p  y  x  g  to optimize the log likelihood of observed
data  we can define the log likelihood objective function
 as
c
c y
y
y
o     log
pk  xi  yi  
    
pk  y  gk  
k  

k  

community id

figure    summary of all features

i

a gradient method  newton raphson method  is used to solved
the objective function  eq       the gradient of each kj is
o  
  e fkj  xij   yi     epkj  xij  yi    fkj  xij   yi        
kj
where e fkj  xij   yj    is the expectation of factor function fkj  xij   yj  
given the data distribution  and epkj  xij  yi    fkj  xij   yi    is the
expectation of factor function fkj  xij   yj   under the distribution
pkj  y  x  gk   given by the estimated model 
similarly  for each k is
o  
  e hkj  yc     epkj  yc  x gk    hkj  yc   
    
kj
where yc is short form of edge  ys   yt    e hkj  yc    is the expectation of factor function hkj  yc   given the data distribution 
and epkj  yc  x gk    hkj  yc    is the expectation of factor function
hkj  yc   under the distribution pkj  yc  x  gk   given by the estimated model 
we use loopy belief propagation  lbp  to approximate the gradient and update  iteratively and calculate the marginal distribution pkj  yc  x gk    

   

uploading time

contain uploading time and community id  the detail description
lists listed in figure   

  

experiment results and discussions

in this section  we first describe our experimental setup  then
present the performance for several baselines and our model  finally  we give some analysis and discussions 

   

experimental setup

data set  the data set we used in this paper is collected from
flickr    the data set includes         images from       groups
and      users  one user could belong to different groups and so
is one image  in this work  we divide the data set into two parts
evenly  both the training set and testing set include        images
respectively 
comparison methods  we evaluate our proposed method with the
following methods on flickr data set 
 svm  it uses the images color features and homophily patterns to train a classification model and then predicts images
affects in the testing data  we use svm multiclass   

feature extraction

to train the proposed comfg model  besides the homophily patterns  we also extract image attributes from two aspects  the first
aspect is color features including saturation  brightness  color ration
and dominant colors  another aspect is social correlations which

description
the mean and deviation of saturation
the mean and deviation of brightness
cool color ratio and clear color ratio
the index of    hsv bins  where the hsv space
is divided by   partitions along the hue dimension  and three equal partitions along the other
two dimensions
the standard unix time stamp is used to sorted
images in time sequence
the groups that the image are included in

 
 

http   www flickr com   flickr is a photo sharing network
http   lightsvmlight joachims org 

fiprecision
      
      
      
      
      

recall
      
      
      
      
      

f  measure
      
      
      
      
      

accuracy
      
      
      
      
      

figure    performance of different methods on flickr data set
 lrc  it uses the same features as svm to train a logistic
regression classification model and then predict images affects in the testing data 
 crf  it uses the same features as svm to train a conditional
random field model to predict images affects in the testing
data 
 fgm  it trains a factor graph model with partially labeled
information with all image attributes  color features and social correlations  and homophily patterns 
 comfg  the proposed model  which trains a communityaware factor graph model with all image attributes  color
features and social correlations  and homophily patterns 

affects
happy
sad
anger
disgust
surprise
fear

all codes are implemented in c   and java  and all the evaluations are performed on an x   machine with e         ghz intel
xeon cpu and    gb ram  the operation system is microsoft
windows server      r  enterprise 

   

performance analysis

prediction accuracy 
figure   lists the affects prediction results of the different methods on flickr data set  the proposed
method  comfg  shows clearly the best performance than other
methods  in terms of f  measure  comfg achieves       improvement compared with svm        improvement compared
with lrc  and       improvement compared with crf  it demonstrates that besides color features  social correlations are also very
helpful  although fgm and comfg can both incorporate color
features and social correlations  as flickr is a community structured
social network  the proposed comfg achieves       improvement
in precision and      improvement in recall compared to fgm
 figure     these results confirms the effectiveness of the proposed
comfg model 
factor contribution analysis  to investigate the factor contributions in our problem  we first use only color features in comfg and
evaluate the performance by adding each of the other factors step
by step into the model  therefore  we can measure their contributions by the inprovement of f  measure they achieved  as shown
in fig    a   besides color features  we have   types of factors 
social correlations  s   individual homophily  i   and community

recall
fgm
comfg
      
      
      
      
      
      
      
      
      
      
      
      

f  measure
fgm
comfg
      
      
      
      
      
      
      
      
      
      
      
      

figure    performance of fgm and comfg on different affects
   

    

    

   

   

    

   

without homophily
with homophily

    
   
    

    

flickr

 a 

   

flickr s flickr siflickr sic

 b 

factor contributions

svm

lrc

crf

fgm comfg

effects of homophily

   
    

f measure

evaluation metrics  to quantitatively evaluate the performance of
proposed method  we consider the following performance metrics 
 prediction accuracy  we apply the learning model for predicting images affects and evaluate its performance in terms
of precision  recall  f  measure  we further analyze the
factor contributions respectively 
 effects of homophily  we use compare method to present
the effect of different homophily patterns 
 scalability performance  we evaluate the prediction performance by using different number of labeled data as the
efficiency metrics 
 qualitative case study  we use several case studies to further demonstrate the effectiveness of the proposed model 

precision
fgm
comfg
      
      
      
      
      
      
      
      
      
      
      
      

f measure

flickr

algorithm
svm
lrc
crf
fgm
comfg

f measure

data

   
    
   
    
flickr
   

 c 

  

  

  
 instance

  

   

scalability performance

figure     a  factor contribution analysis  flickr stands for training a comfg model with only the color features  flickr s stands for
comfg with social correlations  flickr si stands for further involving
individual homophily  comfg sic stands for considering community
homophily   b  f  measure of different methods by considering the effect of homophily in flickr network   c  performance by using different
number of labeled data 

homophily  c   we can see different factors achieve different contributions  for example  in term of the f  measure  we get     
improvement by adding social correlations       more improvement by further adding individual homophily  and another     
improvement by finally adding community homophily  these results confirm the effectiveness of the proposed factors 
effects of homophily  in order to further show the effects of homophliy  we use a compare experiment to present the power of homophliy  figure   b  shows the prediction accuracy in terms of f measure on the different methods  it can be clearly seen that by incorporating the homophily factors  the prediction performance can
be significantly improved           for all the predictive methods  these results indicate the importance of modeling homophily
in inffering affects from images in social networks 
scalability performance  the accuracy results also depend on
the size of training set for the initialization  a small number might
result in high precision but low recall  while a large number might
mean higher recall but would hurt the precision  figure   c  shows
how the average performance changes by varying the size of the
training set  when the size of the training set is larger than        
f  measure grows slowly  which indicates the rationality of using
       images as training set in our experiments 

   

qualitative case study

finow we give an interesting case study to further demonstrate
the effectiveness of the proposed model  analogy photography
and canon dslr usersare both of the most active photographerscommunities in flickr  but they have different preferences 
analogy photography advocate none digital photos  while canon
dslr users are the enthusiasts of digital photos  will the different community culture lead to different views on affects conveyed
by images  taking the images from the two communities as examples  we use the proposed model to infer affects of them  some
results are shown in figure    lets focus on the happy and sad
affects  for happy affect  we find its corresponding images from
analogy photography mostly have brighter and warmer colors
than those from canon dslr users  and the blue channel of
the color histograms is mostly larger than that in canon dslr
users  while for sad affect  the images contained in canon
dslr users are mostly with darker colors and higher contrast 
and the red channel of the color histograms is mostly larger than
that in analogy photography  so it can be clearly seen that people in different communities may have different opinions on colors
and affects  but people in the same community have much more
consistency  this case further indicates the rationality and importance of modeling homophily to propose the community aware factor graph model for our task 

 a  images for case study

 b  the rgb histograms of images

figure    case study  images from a f comes from the analogy
photographycommunity in flickr  and images from g l are contained
in the canon dslr users community  the images and their corresponding color histograms are shown on the left and right side respectively  contours with different shadows present the certain community
or inferred affect 

  

related work

colors and affects  colors as described in      is the foundamental image attritutes that reflect and impact the human affects 
for the correlations between colors and affects       studied the
relationship between affective reactions and color hue  saturation
and brightness using pleasure arousal dominance affective model
      examined color affect associations and found that affective
responses to colors change with value and saturation       made a
summary about color features inspired by psychology and art theory  and further used the color features for affective images classification 
social attributes and affects  social attributes using in affective
image classification always include ages  genders     cultures    
races etc       found that within   age groups  participants from
the same group preferred consistent choices for color affect pair
comparison tasks       revealed that there are correlations between
color preference and interests of people  although the importance
of social attributes has been emphasized  most work on inferring

affects of images still only use visual attributes such as colors 
composition  texture  and contents         due to the lack of proper
model to incorprate both the visual attributes and social attributes 
in the next section  we will further give the problem definition before we introduce our comfg model in details 

  

conclusions

in this paper  we formally define patterns of homophily in individual and community levels  and then propose a community aware
factor graph model to infer affects from social images by leveraging the homophily patterns  the improved performance and case
study reveal that the homophily plays an important role in effecting
image affects in social networks 
understanding the underlying homophily phenomenon can benefit may aspects  such as image retrieval by affective semantics and
community aware recommendation  so far  we have only studied
homophily in interest based online communities in this paper  as
for the future work  it would be intriguing to find whether there
is homophily behavior for communities based on other social factors  such as location and cultural background  to better capture the
dynamic social ties 

  

references

    s  aral and d  walker  identifying influential and susceptible
members of social networks  science                         
    f  birren  color psychology and color therapy  a factual study of the
influence of color on human life  kessinger publishing       
    a  choungourian  color preferences and cultural variation 
perceptual and motor skills      c                 
    r  datta  d  joshi  j  li  and j  z  wang  studying aesthetics in
photographic images using a computational approach  in computer
visioneccv       pages         springer       
    p  ekman  w  v  friesen  m  osullivan  a  chan 
i  diacoyanni tarlatzis  k  heider  r  krause  w  a  lecompte 
t  pitcairn  p  e  ricci bitti  et al  universals and cultural differences
in the judgments of facial expressions of emotion  journal of
personality and social psychology                  
    j  m  hammersley and p  clifford  markov field on finite graphs and
lattices  unpublished manuscript       
    j  jia  s  wu  x  wang  p  hu  l  cai  and j  tang  can we understand
van goghs mood   learning to infer affects from images in social
networks  in proceedings of the   th acm international conference
on multimedia  pages         acm       
    s  kobayashi  the aim and method of the color image scale  color
research   application                   
    g  kossinets and d  j  watts  origins of homophily in an evolving
social network  american journal of sociology                
     
     j  machajdik and a  hanbury  affective image classification using
features inspired by psychology and art theory  in proceedings of the
international conference on multimedia  pages       acm       
     s  e  palmer and k  b  schloss  an ecological valence theory of
human color preference  proceedings of the national academy of
sciences                         
     j  tang  s  wu  and j  sun  confluence  conformity influence in
large social networks  in proceedings of the   th acm sigkdd
international conference on knowledge discovery and data mining 
acm       
     m  m  terwogt and j  b  hoeksma  colors and emotions 
preferences and combinations  the journal of general psychology 
                 
     p  valdez and a  mehrabian  effects of color on emotions  journal of
experimental psychology  general                   
     x  wang  j  jia  p  hu  s  wu  j  tang  and l  cai  understanding the
emotional impact of images  in proceedings of the   th acm
international conference on multimedia  pages           acm 
     

fi