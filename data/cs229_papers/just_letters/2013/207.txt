 

listen to your heart 
stress prediction using consumer heart rate sensors
david liu  mark ulrich
 davidcyl  mark ulrich  cs stanford edu
final project  stanford cs      machine learning  autumn          

f

abstractgalvanic skin response  gsr  is commonly used to measure
short term emotional and cognitive stress  but measuring gsr requires
obtrusive equipment  we present a model to predict stress levels
solely from electrocardiogram  ecg  data  which can be measured
with wearable consumer grade heart monitors  our model incorporates
time and frequency domain features of heart rate variability  and the
spectral power components of the ecg  we make predictions on a
sliding window of ecg signal  we apply a linear model to predict
stress as a continuous quantity  and our prediction is correlated with
the actual gsr with r                  we also present a model
for classifying each window as a binary stress or rest periods  the
best performance was achieved with a linear svm  with an f  score
of      on the most distinct samples  highest and lowest    percentile
gsr levels   and f         over all samples 

 

 

data set and features

background

society and science alike agree on the deleterious effects
of stress  which we will here define as the short term
activation of the sympathetic nervous system caused
by cognitive stressors  as opposed to physical activity  
chronic emotional and mental stress has been linked to
a range of health problems           people often dont
notice triggers that cause them to become stressed  stress
is easy to identify using galvanic skin response  gsr  
which measures sweating of the hands  however  these
sensors interfere with daily activity  meanwhile  unobtrusive  wearable  off the shelf heart rate sensors and electrocardiogram  ecg  devices are becoming increasingly
affordable  we seek to use this sensor data to determine
when the wearer is experiencing stress 
a simplistic heart rate analysis usually takes a long
time to detect a stressor  and it is difficult to determine
if an increase in heart rate was caused simply by physical
activity  such as standing up  or cognitive emotional
stress  on the other hand  gsr is particularly useful in
the immediate identification of short term stress events 
because about     seconds after a startle event  an
individuals palms will sweat and gsr will spike      the
goal of our project is to achieve the accuracy of gsrbased stress detection with only ecg signals 

figure      an example of gsr data  top  and ecg data
 bottom   shaded regions correspond to gsr values greater
than     of all other gsr values in the record  an indicator
that the subject was possibly experiencing stress 

we use data from a study by healey and picard     
available from physionet      in this data set  gsr  on
the skin of the hand  and ecg signals were continuously
collected while drivers experienced stress inducing events
 busy streets  red lights  highways  as well as a rest
state  parked in a garage   the signals were recorded
at a rate of    hz for the gsr and     hz for the
ecg  healeys original study also included a variety of
other features  such as respiration  electromyogram in the
shoulder  muscle tension   and foot gsr  hand gsr is
the most commonly used indicator of stress  so we use
that as the ground truth for subject stress 
this data is relatively noisy  in about     of the
records  the data collection had clearly gone awry  detached leads  wildly noisy jittery signals   so we manually examine the signal graphs and exclude those portions
of the records  each record is windowed using a fixedsize sliding window of length w seconds  using crossvalidation  we later determined that w      was the

filisten to your heart  stress prediction using consumer heart rate sensors

 

best option   from the ecg signal in the window  we
extract heart rate variability features as well as spectral
features of the raw waveform itself 
   

   

david liu  mark ulrich

model
continuous stress prediction

our first approach was to apply linear regression directly
to the features and attempt to predict a continuous stress
value from the ecg features  we tried ecg spectra
alone  as well as a combination of ecg and hrv features as predictors in the linear model  we experimented
with different fitting procedures  including ordinary least
squares  ridge regression  and lasso regularization 

heart rate variability features

heart rate variability  hrv  features can be extracted
from the timing of heartbeats alone  these features
therefore only capture a limited subset of the information
in the ecg signal  but they can be collected with only
a simple heart rate sensor  which is less expensive than
a full ecg device 
we first use an automatic qrs wave annotation tool
 wqrs  on the ecg data to identify morphological
features in the ecg  such as the r peak of each heartbeat  the rr intervals  lengths of intervals between
heartbeats  are then used to extract heart rate variability
 hrv  features 
we use tools available through the physionet wfdb
package and hrv features that are commonly used for
ecg analysis      the time domain features of hrv
consist of the following characteristics of rr intervals 
 nn rr  the fraction of heartbeats that are considered normal heartbeat lengths
 avnn  sdnn  sdann  average and standard deviation of rr intervals
 sdnnidx  mean of the standard deviations of rr
intervals in all   minute segments
 rmssd  rms difference between adjacent rr intervals
 pnn  percentage of adjacent rr intervals that differ
by more than    ms
to compute frequency domain features of hrv we apply
a lomb periodogram  a variant of the fourier transform
designed for time series sampled at uneven intervals  such
as heartbeats   the following features are extracted from
the periodogram 
 totpwr  total spectral power of all rr intervals
up to      hz
 ulf  vlf  lf  hf  total spectral power of all rr
intervals in the bands         hz             hz 
          hz           hz
 lf hf  ratio of power in the lf to hf bands

we then applied an svm to the binary classification
problem and tried many kernels  rbf  polynomial with
degrees      sigmoid  and linear   to determine the best
regularization parameter and kernel and evaluate performance     fold cross validation was used 
we also tried k nearest neighbor classification  in
which each window is assigned based on a vote of its
k nearest neighbors in the feature space  and a random
forest classifier 

   

   

   

stress detection with binary classification

we next formulated the problem as a binary classification problem  windows are labeled as stress or rest
windows  to produce ground truth labels  we use the
relative value of the gsr signal  when gsr is in the top
or bottom cutoff percentile in the record  the window
is considered stress  a cutoff of     corresponds to
labeling all windows with above median gsr as stress
and all below median gsr windows as rest  when
cutoff is less than      we train on and classify only the
subset of data where the gsr is most extreme portion
of the record  this corresponds to estimating stress only
for the most clearly stressed or relaxed time periods 
we applied many techniques to this classification problem  the first was a gaussian naive bayes classifier 
which fits a gaussian distribution to each feature independently of the others  that is  for the classes y     
 stress  and y      rest   we modeled the class distribution of each feature xi independently as


 xi  y   
 
exp 
p  xi   y    q
 y 
 y 

ecg based features

varying prediction windows

we hypothesized that heart based predictions might lag
the gsr because gsr exhibits a faster biological response  thus  we tried using a shorter subportion of
the window to assign the ground truth label of the
window  figure     shows the results of varying this label
window length  decreasing the window length generally
decreased our f  score  so we settled on using the same
window for input features and labels 

the raw ecg data contains the full spectrum of the
hearts electrical activity  giving data that is richer than
the timing of the heartbeats  we compute the fourier
transform and take the logarithm of summed total power
in   hz bands  from   to     hz  this follows previous
work by chou et al  who showed that these ecg frequency bands were discriminative for detecting abnormal
heart events     
 

filisten to your heart  stress prediction using consumer heart rate sensors

david liu  mark ulrich

model was evaluated with    fold cross validation  and
examining the correlation between the stress prediction
 x axis  and the actual gsr  a perfect prediction would
have r      and all points on this plot lying on the
line y   x  when predicting stress levels with only the
ecg spectral features  we achieved r                 
with both ecg and hrv features  we achieved r   
             and a line that is fairly close to unity
 figure      
   

binary classification results

we measured the performance of our binary classifier
using the f  score  which is defined as the harmonic mean
of the precision and recall  that is 
f      

figure      performance under changing label window
widths

classifier
svm rbf
svm linear
gaussiannb
gaussiannb
gaussiannb
svm linear
svm linear

we also tried a few more variations on the features and
windows 
 we used previous and future ecg windows to predict the gsr in a short two second window 
 to capture changes over the duration of the window 
we extracted the hrv ecg features separately
from each third of the window  resulting in three
times as many features 
neither of these changes improved classification accuracy 

 
   

precision  recall
 
precision   recall

features
hrv
hrv
hrv
ecg
ecg hrv
ecg
ecg hrv

f   accuracy
      
      
      
      
      
      
      

figure      selected combinations of classifier and feature
set classification with cutoff        ecg corresponds to the
   bands of ecg frequency content  and hrv corresponds
to the    time and frequency domain hrv features 

evaluation and results
continuous model results

we tried a range of different classifiers and feature sets 
figure     shows some selected combinations  we found
that a linear svm  i e  logistic regression  on both ecg
frequency features and hrv features performed best 
outperforming other model choices slightly 
we also tried a k means classifier and a random forest
classifier  neither of which achieved competitive accuracy 
in figure      we examine classification accuracy for
varying cutoff gsr levels  in this graph  we see that classification accuracy is highest for the top and bottom   
percent of gsr values  and classification accuracy drops
off as we approach increasingly ambiguous gsr samples 
this is reasonable  because the windows that have middling gsr values may not be as distinctively distinguishable as stress or rest  when cutoff is extremely small 
classification accuracy also suffers  though  because there
are not enough training examples  when classifying all
windows  the f  score is      
we varied the width of windows  figure      and found
that a length of    seconds is optimal  extremely long
windows performed increasingly poorly  likely because
they often contained a mix of both stress and rest states 

figure      scatter plot of ecg predicted stress levels versus
actual gsr  and the least squares regression line  r         
the regression line is y         x         

the linear regression yielded stress predictions that
were reasonably correlated with the observed gsr  the
 

fif   score  

listen to your heart  stress prediction using consumer heart rate sensors

feature
score
ecg freq     
       
ecg freq        
       
ecg freq        
      
ecg freq      
       
ecg freq        
      
hrv pnn
       
additional  features   hrv hf   hrv lf   hrv nn   
hrv sdann   hrv totpwr   hrv ulf   hrv vlf   
ecg freq           ecg freq         
ecg freq         ecg freq           hrv rmssd   
hrv avnn   ecg freq          hrv sdnn   
ecg freq         ecg freq           
ecg freq         hrv sdnnindx   ecg freq           
ecg freq         ecg freq           
ecg freq           ecg freq         hrv lfhf   
ecg freq           ecg freq      

forward  search  

      
     
      
      
      
      
     
      
      
      
   

    
    
number  of  features  

david liu  mark ulrich

    

figure      performance achieved by incrementally adding features selected by forward search 

forward search  figure      indicated that the majority of the classification performance was due to just a
few top features  the ecg features in various bands  and
the pnn   feature  percentage of adjacent normal rr
intervals that differed by more than   ms   this indicates
that immediate variation in heart rate is a good indicator
of stress 

 

using a combination of hrv and ecg features  we are
able to predict whether the gsr is in the highest or
lowest    percentile with     accuracy  samples with less
extreme gsrs can be predicted with     accuracy  this
suggests that using consumer ecg devices  we would be
able to predict whether or not the user is stressed with
high confidence without requiring gsr measurement 
we draw the following conclusions 
 hrv is not enough to reliably determine
stress state  low end consumer devices only transmit heartbeat timing and not the full ecg signal 
the added information from ecg spectral features
increased classification score from f          with
only hrv  to f          with hrv and ecg
spectral features combined  
 ecg responds quickly to stress stimuli  we
were expecting that the gsr response might occur
significantly before or after the ecg response  but
offsetting the windows only decreased classification
score 
 ecg captures subtle heart activity variations 
there is valuable additional data in the raw ecg
waveform  perhaps due to intrabeat variations in
wave morphology or due to increased movementinduced noise when subjects were stressed  if the
wave morphology itself changes  follow up studies

figure      performance with our best classifier  linear
svm     second windows  at different cutoffs for the training
window lengths 

window  width  vs  classica on  performance  
   

f  score  

     
     
     
     
     
     
   

    

    

    

    

     

conclusion

     

window  size  

figure      classification accuracy  f  score  with varying
window sizes 

 

filisten to your heart  stress prediction using consumer heart rate sensors



   

should consider incorporating time domain features
of the qrs complex  each ecg cycle typically has
five deflections  p  q  r  s  t   and meaningful
physiological information might be derived from
variations in the relative lengths and amplitudes of
these sub waves 
stress is continuous  but a binary classification can often be sufficient  stress is an inherently continuous  and likely multi dimensional 
variable  so this binary classification as stress or
rest is a simplification that would be appropriate
in applications that would have to take a specific
action in response to a certain stress threshold level 
this level could be varied by changing the weighting
of classes in the svm 

for a consumer application  we would consider using
an online and incrementally adaptive learning system 
initially  with only generic training data  we may achieve
classification accuracy of approximately      the accuracy we achieve when pooling different subjects records  
user feedback could be used to generate further training
examples for an incremental online learning algorithm 
we plan to test our models for stress prediction and
binary stress classification with real time data from a
bluetooth ecg device 

references
   

lawrence r murphy  stress management in work settings 
a critical review of the health effects  american journal of
health promotion                     
    franklin stein  occupational stress  relaxation therapies 
exercise and biofeedback  work  a journal of prevention 
assessment and rehabilitation                     
    s  r  vrana  emotional modulation of skin conductance
and eyeblink responses to startle probe  psychophysiology 
              jul      
    jennifer a healey and rosalind w picard  detecting stress
during real world driving tasks using physiological sensors 
intelligent transportation systems  ieee transactions on 
                  
    ary l goldberger  luis an amaral  leon glass  jeffrey m
hausdorff  plamen ch ivanov  roger g mark  joseph e mietus  george b moody  chung kang peng  and h eugene
stanley  physiobank  physiotoolkit  and physionet components of a new research resource for complex physiologic
signals  circulation          e   e          
    sansanee boonnithi and sukanya phongsuphap  comparison
of heart rate variability measures for mental stress detection 
in computing in cardiology        pages       ieee       
    tracy chou  yuriko tamura  and ian wong  detection of
atrial fibrillation in ecgs  cs     final class projects       
    r barbieri  ec matten  and en brown  instantaneous monitoring of heart rate variability  in engineering in medicine
and biology society        proceedings of the   th annual
international conference of the ieee  volume    pages    
     ieee       
    akm fazlul haque  md hanif ali  m adnan kiber  and
md tanvir hasan  detection of small variations of ecg features
using wavelet  arpn journal of engineering and applied
sciences             
     peter j lang  mark k greenwald  margaret m bradley  and
alfons o hamm  looking at pictures  affective  facial  visceral  and behavioral reactions  psychophysiology           
          
     w picard and jennifer a healey  wearable and automotive
systems for affect recognition from physiology       
     f  pedregosa  g  varoquaux  a  gramfort  v  michel 
b  thirion  o  grisel  m  blondel  p  prettenhofer  r  weiss 
v  dubourg  j  vanderplas  a  passos  d  cournapeau 
m  brucher  m  perrot  and e  duchesnay  scikit learn 
machine learning in python  journal of machine learning
research                    

future work

other approaches that might be considered include dimensionality reduction using pca 
a deeper qualitative understanding of which features
are most important could help us discover more features
and better understand the biological processes related to
activation of the sympathetic nervous system 
we might consider extracting different hrv features 
barbieri et al  propose modeling the heartbeat intervals
as an inverse gaussian process  and describing the hrv
using the parameters of this process     
we might also try including finer grained bins of the
ecg spectrum  we recently learned that most of the
information content in ecgs is contained in the     
hz band  so more resolution in that area might improve
results  other researchers have suggested that other
time frequency analysis algorithms  such as the wavelet
transform  may improve discrimination of ecg data     
another dimension to explore would be to distinguish
between positive and negative emotional stress  eustress
and distress  respectively we currently make no distinction  our data set probably consisted of mild distress 
a neutral state  rest   and few incidences of eustress 
because it was all collected during automobile driving 
some researchers have shown that in certain cases heart
rate increases more for positive arousal than for negative
arousal      
   

david liu  mark ulrich

applications

measuring stress with ecg has diverse applications 
psychology experiments measuring stress levels would no
longer require a subjects hands to be free  would require
less intrusive equipment  and could reduce cost  one
consumer application is a stress alert system that could
be worn at all times of day  most current biofeedback
systems rely on hand gsr  which is cumbersome and
cannot be worn continuously 
 

fi