discriminative ensemble averaging for accelerated denoising

corey mccall
stanford university      serra mall  stanford  ca       usa

abstract
it is difficult to filter a signal with highamplitude in band noise if an independent
noise reference cannot be obtained  if the signal is periodic relative to a known sequence of
temporal markers  ensemble averaging can
be used to reduce the noise by averaging the
signal over several periods in the same way
that artificial neural networks average many
modest experts to achieve a higher overall accuracy  although this method effectively reduces in band noise for this type of signal 
it costs several time periods of waiting and
is subject to corruption by high amplitude
spikes that take take several periods to reduce  in this paper  we use k means clustering to discriminate against corrupted periods in order to achieve faster convergence
of the ensemble average in a ballistocardiography dataset recorded on nasas zero g
aircraft  by using a single clean training example from each subject to select the least
noisy cluster  ensemble averaging is accelerated for all ten subjects in the dataset within
the first   cycles 

   introduction
ensemble averaging  ea  is a technique used in artificial neural networks to reduce many moderately accurate classification models to a single averaged model
that together outperforms any of its individual components  the same technique can be used to denoise signals with high amplitude in band noise that would be
otherwise be difficult to filter using typical frequencybased techniques  unlike the typical approach to this
problem  adaptive filtering  inan et al          ea does
not require an independently referenced noise signal so
long as the signal is periodic relative to a known sestanford cs     machine learning final project  fall
      copyright      by the author 

cmccall stanford edu

quence of temporal markers  this type of signal is
commonly encountered in fields like electrophysiology
where measurements are very noisy  but the underlying signal of interest is periodic with respect to heart
beats or action potential firings 
one exemplary case exists in ballistocardiography
 bcg   the measurement of the small ballistic force induced by the heart pumping a volume of blood across
the chest  it can be measured with either an accelerometer mounted to a persons center of mass  or
with a sensitive scale measuring the differential weight
between the legs of a standing person  a clean bcg
waveform contains many hemodynamic  blood movement  parameters useful for assessing a persons cardiac health in terms of cardiac output  contractility 
synchronization  and other metrics as shown in figure    inan et al         etemadi et al          the
frequency range of the bcg waveform is     hz  and
highly susceptible to in band noise caused by body motions as small as chewing or balancing while standing 
bcg can be obtained carefully in a controlled environment  but cannot be used in congested settings without a robust denoising strategy 
in this paper  a discriminative ea approach is
described for measuring small signals with highamplitude in band noise  the motivating example is
measuring the bcg of astronauts onboard a crowded
space capsule as in  wiard et al          the signal
can be ensembled by synchronizing with the simultaneously obtained electrocardiogram  ecg   in which the
ecg r peaks proceed each bcg waveform complex
 figure     although each bcg beat can be effectively
referenced to an ecg timing marker  the congested
setting induces frequent high amplitude motion noise
spikes from collisions with weightless objects and other
astronauts  each of which increases the convergence
time of the average  in order to solve this issue  the
convergence is accelerated by discriminating against
corrupted beats  this is done by clustering each sample of the ensemble at each step in order to filter out
abnormal samples that negatively affect the average
and increase the convergence time  unlike naive ea 

fistanford cs     machine learning final project  fall     
typical bcg recorded in controlled environment

bcg  mv 

  
  
 
  

pared to the controlled environment recording shown
in figure    the bcg signal was pre processed using
a     hz digital bandpass filter and subtracted from a
    second windowed third order polynomial fit  savitzky   golay        in order to reduce baseline wander before averaging  the m training example will be
referred to as  x i   rn   i              m   where each example is n       samples long      seconds at    hz  
the full matrix of examples x  rmn is defined as 

ecg  mv 

   

 x     t
 x     t
  
 



   
  



x 


 







 x m   t

  
 

   

 

   

 

t  sec 

which blindly averages each beat together  the algorithm described in this paper constructs the average
from a subset of of the recorded beats determined at
each sample by clustering  the output is a composite
signal consisting of any number of parts from each of
the recorded beats 
a previously used simpler approach in  mccall       
clustered entire beats in n dimensional feature space
instead of each sample point  this approach was less
effective because high frequency noise would cause an
entire beat to be filtered out even if the uncorrupted
parts were useful 
this paper proceeds as follows  in section    the bcg
dataset is described  in section    the discriminative
ea approach is described  in section    the results of
the discriminative ea approach on the bcg dataset
are described  and finally  we conclude in section  
with a discussion of the results 


y    
 y     


y    
    


y  m 
typical bcg recorded in congested environment
   
  

bcg  mv 

figure    in a controlled environment  bcg can be easily obtained by standing still on a weight scale as shown
 top   various useful physiological parameters can be derived from the timing differences between the simultaneously recorded ecg  bottom  r peaks  red triangles   and
the ijk complex of the trailing bcg waveform marked by
the magenta  i   red  j   and blue  k  triangles  signal
segments are truncated to emphasize the window of interest 

and the associated subject labels  y  i 

            n    i              m  are defined in y  rm
as 

 
  
   

   

 

   

 

   

 

   

t  sec 

figure    in a congested environment  bcg is difficult to
distinguish because of the in band noise that is much larger
than the bcg component  the vertical red bars indicate
ecg r peaks used to synchronize the ensemble 

   discriminative ensemble averaging
in the following sections  ea and the strategy to reduce its convergence time with clustering is discussed 
     ensemble averaging

   bcg dataset
a dataset of n      subjects was recorded aboard
nasas zero g aircraft  with an average of     heart
beats recorded from each subject  a typically noisy
recording from the dataset is shown in figure    which
has no distinguishable bcg waveforms when com 

ea is a technique used to denoise periodic signals in
which the in band noise power is large compared to the
signal of interest  under the assumption that this noise
is independently distributed with respect to the signal
of interest  an estimate of a period of the underlying
signal x can be calculated by averaging the signal

fistanford cs     machine learning final project  fall     

over many periods  the following defines the naive
ea estimate of subject a in the dataset 
 
x    y   a 
 i    a 
 
 y
i  

x   pm

where   is the componentwise indicator function 
  z   a      if z   a  else   
an example of this procedure for half of the dataset
is shown in figure    it can be seen that in a realistic dataset  it can take many examples for x to
converge  in many practical cases  such as busy astronauts checking into the bcg device for periodic
checkups  it is desirable to minimize the measurement
time required to estimate the underlying waveform x  
  beats

  beats

   beats

   beats

    beats

bcg ea  mv 

  

algorithm   discriminative ensemble averaging
input  x   x i   rn   i              m   xtrain  rn
output  dea  rn
ea   ea x 
x    x  xtrain
for j     to n do
z   xj
c  cluster z 
z      zi   ci   cm    
z      z     xtrain j
dea j  min ea z     ea j  
end for
ple  the algorithm is repeated until a target signal
to noise ratio  snr  is achieved  in the case of the
bcg dataset  the algorithm would be repeated until
the ijk complex is able to be distinguished  and the
required training example would be collected in a controlled environment before the test measurements 

 

the overall goal of the algorithm is to minimize the
cost function defined as the   norm of the distance
between the average and the training example 

  

   
 

    

 

    

 

    

 

    

 

    

t  sec 

  ea  final ea   

    

min  ea x   xtrain   
x

subject  
subject  
subject  
subject  
subject  

   
   

data with training example

clustering

cluster mean

   
   
 

  

  

  

  

  

  

  

  

  

   

number of beats

figure    ea convergence for   subjects calculated naively
by averaging each beat in sequence  the top row shows
an example for subject   as the average converges  the
vertical red bars indicate the ecg r peaks used to synchronize the ensemble  and the thin dashed lines indicate
the standard deviation of the average at each point 

figure    graphical  d example of discriminative ea for
k     clusters  in the left figure  a single training example
is added to the dataset  in the center figure  all of the
points are clustered into k clusters  in the right figure  the
training example is removed and the mean of its cluster is
taken as the discriminative ea 

     discriminative ensemble averaging
in discriminative ea  a single training example is
added to the set of measured examples  then all m    
examples are clustered at each point j           n  after
clustering  only the points in each cluster containing
the training example point are used to calculate the
ea as described in algorithm   and figure    in this
way  the clustering algorithm can select examples that
look like the training example for the average  discriminating against examples corrupted by large motion
noise or other artifacts in the other clusters  the final
output if the algorithm is the naive ea or discriminative ea which is most similar to the training exam 

   results
algorithm   was tested on the dataset using k means
for the cluster function with k     in an attempt
to discriminate noisy vs  non noisy examples  a more
complex clustering method such as a gaussian mixture
model was not used because in this case our goal is
to explicitly include outliers in the center calculation
rather than to form tight clusters 
the results for two typical subjects are shown in figures   and    where it can be seen that the discriminative ea approach converges faster than the naive

fistanford cs     machine learning final project  fall     

a graphical depiction of performance on the entire
dataset for m      is given in figure    this matrix of ratios of naive to discriminative cost functions
highlights when the algorithm is most effective  aligning with our goal  performance is increased within the
first   cycles for every subject in the dataset  performance gains for higher m values  such as in subjects
  and    are because the algorithm naturally skips examples which cause the cost function with respect to
the training example to increase 
discriminative vs  naive ea for subject  
naive ea
discriminative ea
output  min 

  ea x   xtrain   

   
   

  ea x   xtrain   

naive ea
discriminative ea
output  min 

   
   
   
   
   
 

   

discriminative ea
naive ea

  
  
  
  
 

 

  

  

  

  

  

m  beats 

figure    discriminative ea increases the convergence rate
compared to naive ea for typical subject   

for quantitative snr analysis 

   

acknowledgments

   
 

   

mean samples used    

discriminative vs  naive ea for subject  
   

mean samples used    

ea approach in both figures as expected  in figure   
discriminative ea performs better with a low number
of examples because the second example is clearly corrupt as seen in the naive ea trace  in figure    the
first examples are not noisy  so the discriminative ea
does not pay off until noisy examples start to show up
and increase the naive ea cost around example   

discriminative ea
naive ea

  
  
  
  
 

 

  

  

  

  

  

we acknowledge professor gregory kovacs and dr 
laurent giovangrandi at stanford universitys transducers lab for discussing bcg signal processing techniques and sharing this dataset  we also acknowledge
nasas reduced gravity office for facilitating the collection of this dataset  and finally  we acknowledge
professor andrew ng and the stanford cs    lecture
notes  ng        for general instruction on machine
learning 

m  beats 

figure    discriminative ea increases the convergence rate
compared to naive ea for typical subject    top   mean
percentage of data used at each point in the corresponding
discriminative ea  bottom  

   discussion
in this paper  a novel discriminative ea algorithm is
described and tested on an appropriate dataset of ballistocardiogram data recorded in a very noisy environment  the algorithm  currently based on k means
clustering effectively increases the ea convergence rate
in all subjects within   cycles 
future work should include comparing this method
to other non frequency based filtering techniques such
as pca dimensionality reduction before seeking peerreviewed publication  it would also be valuable to test
the algorithm on a dataset of simulated irregular noise

references
etemadi  m   inan  o  t   r  m  wiard  l  giovangrandi  and kovacs  g  t  a  non invasive assessment of cardiac contractility on a weighing scale 
in proceedings of the   st annual ieee engineers
in medicine and biology conference  minneapolis 
minnesota       
inan  o   etemadi  m   wiard  r   kovacs  g  t  a  
and giovangrandi  l  non invasive measurement of
valsalva induced hemodynamic changes on a bathroom scale ballistocardiograph  in proceedings of
the   th annual ieee engineers in medicine and
biology conference       
inan  o  t   etemadi  m   widrow  b   and kovacs 
g  t  a  adaptive cancellation of floor vibrations
in standing ballistocardiogram measurements using

fistanford cs     machine learning final project  fall     

figure    algorithm performance across the entire dataset
for m      randomly sequenced beats  each row is normalized to the maximum ratio of naive to discriminative
ea cost functions  lighter   better   it can be seen that
most subjects exhibit a performance increase in the first
few cycles 

a seismic sensor as a noise reference  ieee trans
biomed eng       
mccall  c  discriminative ensemble averaging for
accelerated denoising  milestone   cs    final
project  fall            
ng  a  cs     machine learning course reader 
stanford university       
savitzky  a and golay  mje  smoothing and differentiation of data by simplified least squares procedures  analytical chemistry       
wiard  r  m   inan  o  t   giovangrandi  l   cuttino  c  m   and kovacs  g  t  a  preliminiary
results from standing ballistocardiography measurements in microgravity  in proceedings of the   th
annual ieee engineers in medicine and biology
conference       

fi