regressing loan spread for properties in the new
york metropolitan area
tylercasey
tyler casey   gmail com
abstract 
inthispaper idescribeamethodforestimatingthespreadofaloangivencommon
quantitiesfiledwiththeloanitself estimatingtheriskandrewardofaloanhasbeenof
particularimportancesincetheeconomiccrisisof     asamoreaccurateestimation
andvalidationschemeonloanriskcouldhavehelpedpreventandmitigatethewidespread
damageofthemortgageandderivativescrisis thedatasetusedinthisanalysiswasa
smallgroupofrecent      loansoriginatinginthenewyorkmetropolitanarea the
smallsampleofloansavailable mixedwithalargefeaturespaceandmultipleloantypes
withinthedatasetitself madecreatingarobustmodelprimarilyataskofavoiding
highvariance overall iachievedasubstantialimprovementoveranaveragebaseline
estimate butacknowledgeroomforchangesinthemodelandrecognizesomepractical
limitationswiththeanalysis 
introduction 
thefinancialcrisisof    hasbeenlargelyattributedtoadramaticriseindefaulting
homeloans andacollapseincreditderivativescreatedfrombundlesofbadloans    
pricingloanstoeffectivelycovertheirtrueriskofdefaultisaxiominthefinancialworld the
volumeandvalueofbothloansandtheirderivativeassetsisastrongimpetusforcreating
aprogrammaticapproachtobothpricingandvalidation thecomplexityinthecurrenttask
isbrokenintothreephases datapreparation featureenhancementandselection and
modelgeneralization allcodingwasdoneinpython utilizingthemachinelearning
packagescikitlearn    
datapreparation 
individualloandatawasprocuredfromtrepp com amortgagesecuritiesdatareseller by
theprojectsponsor fortheanalysisthedatasetwasconfinedtorecentloanson
propertiesinthenewyorkmetropolitanarea additionally loanswerefilteredsothateach
wasguaranteedtobeasingleloanproperty benchmarkedbyustreasurynotes and
havealtv loantovalue measure fortheanalysis allnonnumericcolumnsinthedata
wereremoved infutureanalysisitcouldproveusefultoencodethesetextfieldsas

fifeatures butgiventhealreadylargenumberofvariablespersampleandthepossible
misinterpretationofthetextdataitself thiswasleftout sampleswerethenbinnedon
propertytype i e multifamily hotel office etc   andallcolumnswerel normalized l 
andunnormalizeddatawasalsotried butwerefoundtobeinthebestfitmodels
detriment  propertieswerebinnedbecauseloanprovidersconsidercertainproperty
typesmoreriskythanothers 
thedependantvariablefortheanalysiswastheaverageofaloanslowandhighspread 
thisnumberrepresentsthepremiumthebankstandstomakeoverthecurrentlendingrate
fromthefederalreserve andisthemeasureofriskforaloan 
histogrambinning
atthesuggestionofthedataprovider ahistogrambinningapproachwasdonetocreate
apiecewiselinearmodelforcapturingdifferentphaseswithinimportantfeatures namely
theloantovalue ltv metric insteadofdoingthismanually iimplementedatunable
algorithmforidentifyingregionsofsignificancebyconvolvingthecumulativedistributionof
avariablewitha ndderivativegaussian theresultbeingasmoothedversionofthe
secondderivativeofthecdf aheuristicbinningstrategywasappliedontopofthiswithin
eachpropertytype examplesofdynamicbinningontheltvmetricfortwodifferent
propertytypesbelowinfigure  

fig   thethinbluelineisthesmoothed ndderivativeofthedata thegreenbarrepresentsatunablethresholdformakinga
rangingnumberofbins thegreenlineisthecdfoftheltvforthepropertytypeinquestion 

ficensusdataextraction 
anefforttoprovidefurthercontextfortheloansbeyondthetreppdatawasdoneby
accessingcensusinformationondemographicsforeachpropertyinthedataset this
wasdoneviathepublicallyavailablecdynewebsite    ratelimitingonthefree
informationrequiredbuildingaworkerclustertofacilitatethefullrequestinreasonable
time 
workercluster 
inordertoextractthecensusdata andlatertodoalargescalehyperparametersearchon
regressionalgorithms iprocuredadistributedclusterof    linuxworkersoncloud
servicesplatformheroku alongwithasmallinstancerunningtheredisdatabase using
thetaskdistributionpackagecelery tasksweredispatchedtoworkersandthen
processedinbatchaftercompletion 
afteraddingcensusdataandbinarizingimportantvariables thefinaldatasetis
comprisedof   loans withamaximumof   features mostlybinaryvariables  
dependingonthesettingsofthehistogrambinarizer 
featureselectionandmodelselection 
giventhenumberofsamplescomparedtofeatures narrowingthefeaturesettoreduce
theriskofhighvariancemodelswasapriority initialtestswithvariouslinearmodels
displayedhighvarianceonholdoutcrossvalidationsets ensembleregressionalgorithms
addressthisproblembycombiningmultiplecandidatemodelstoformamoregeneralized
completemodel theregressorsultimatelyupforfinetuningwererandomforest
regressor andextratreesregressor      thesetreebasedensemblesareusefulfor
bothregressionandforfeatureselection asthealgorithmsmustscoremany
subregressorsonlimitedfeaturesetsduringthefittingprocess creatingabuiltinmeasure
offeatureimportance figure belowshowsthetop  featuresfortheprojectsbestfit 

fig  

fivcdimensionandperformancemeasurement 
aliteraturesearchintothevcdimensionofensembleregressorswasinconclusiveasto
howthepropertiesofadataseteffecterrorestimates intuitively thenumberofbinary
dimensionsprovidedbythebinningfunctions    pervariablebinned translatesintoa
largegeneralizationerrorforlesscomplexalgorithmsgiventhesizeofthedataset figure
  belowillustratesthesubstantialtesterrorinpracticeonakfold   randomforest
analysiswithincreasingnumberoftreesintheregressor 

fig  

withthisinmind inordertomaximizethetrainingsetsize modelperformancewas
gaugedonnleaveoneoutvalidationsteps withanoutputmetricofmeansquarederror
 mse  

hyperparametersearch 
inordertofinetunetheensembleregressorsusingleaveonevalidation whichiscostlyin
practice ahyperparametersearchwasdoneonthevalidparametersofthealgorithms a
powersetofviableensembleparametersandfeaturesetswasdispatchedtotheworker
cluster modelfitsweretestedandmsemeasureswerestoredinredis approximately
     parametersetsweretriedina  hourperiod 

fibestfitresults 
dataparameters 
bins   appraisalandltvltv   dscrnoi  
features   married   avgincome   avghousevalue  
 yearbuilt   debtyeildncf   appraisalandltvltv  
 adjaveragespread   dscrnoi  
columnsl normalized true

regressorparamaters 
algorithm randomtreesregressor
n estimators    
min samples leaf  
min samples split  
max features  

bestfitregressormse      
dataaveragedummyregressormse     

discussionandconclusion 
althoughmanythingsweretriedinthisprojecttoreducethemseofthetestsets 
frustratinglyitseemedasthoughthefeaturesofthedatadidnothavemuchinformative
capacitygiventhenumberofsamples thisshelvedsomeofthelateranalysisplannedfor
thisproject andisatentativecritiqueoftheinformationassociatedwithloans i e itis
seeminglyoflittlevalueininferringaloansrisk iwasabletocutthebaselinemsebya
factoroftwo whichisasubstantialyetsomewhatlacklusterimprovement nonetheless 
theerrordifferencebetweenadummyregressorandthebestfitmodelcorrespondsto
approximately  spreadpoints consideringthevalueofthefinancialassetsinquestion 
abetterregressionby  spreadpointscouldtranslatetosignificantefficienciesatlarge
scale 
citations 
    financialcrisisof        wikipedia wikimediafoundation   sept      web   dec 
     http   en wikipedia org wiki financial crisis of     
    scikitlearn   machinelearninginpython    documentation n p  n d web   dec 
     http   www scikitlearn org
    demographicdata  demographicdata n p  n d web   dec      
http   www cdyne com free demographicdata aspx
   l breiman randomforests machinelearning                
   p geurts d ernst  andl wehenkel extremelyrandomizedtrees machinelearning       
         

fi