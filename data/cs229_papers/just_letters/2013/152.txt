cs     autumn     

predicting gold prices
megan potoski
abstract
given historical price data up to and including a given day  i attempt to predict whether the london pm price fix of gold the
following day will increase or decrease relative to the current days price fix  my predictions are based primarily on technical
indicators calculated from historical price data for gold as well as for a variety of financial variables  using logistic regression
for binary classification  i attain over     accuracy using only features calculated from the gold price  and over     accuracy
after adding certain intermarket variable features that display a high correlation with gold prices  i also simulate executing
  day trades based on this prediction  where i can either buy or sell   ounce of gold each day  and achieve an average daily
profit exceeding       

   introduction
machine learning has often been applied to the prediction
of financial variables  but usually with a focus on stock prediction rather than commodities  in my project  i chose to
apply supervised learning to the prediction of gold prices in
order to see what kind of success i could achieve  for the
purposes of profitability  it is more important to predict the
relative change in price tomorrow  i e  whether the price will
go up or down  than to predict the absolute price tomorrow 
so i have formulated this as a classification problem  given
historical price data up to a given day  my algorithm attempts
to predict whether the gold price tomorrow will be higher or
lower than it is today 
the most reliable source of gold price data that i found
was the london afternoon  pm  price fix  which i obtained
from the usa gold website  as gold is not traded in the same
sense as stocks  there is no separate data available for  for
instance  daily open vs  close prices or trading volume  i have
gathered the daily price fix data spanning early      to late
       about   years  where   out of every   days are eligible
data points  which yields about      training examples 
another question that i sought to address in this project
is whether or not intermarket financial variables  like stock
index prices  exchange rates  bond rates  and other commodity prices  can be effective inputs to the prediction of gold
prices  historically  these variables have exhibited a significant correlation  but i was curious as to the reliability of
these relationships as well as their applicability in extremely
short term situations 

also their future movements 
    technical indicators
quantitative research on stock prediction often uses an assortment of calculated technical indicators  as gold prices
should follow many of the principles of predicting financial
markets in general  i have studied past work on stock prediction to learn about these methods         below i summarize
the indicators i have chosen to use and how i calculate them 
the ability to recognize the current price trend
is vital to the accurate prediction of future prices  not only can
determining the trend over the previous time period provide a
rough estimate of continued price movement  but it can also
prove useful in spotting a trend reversal  uptrend to downtrend 
or vice versa   since prices can fluctuate considerably  a
trendline is not an ideal way to describe the data  but it is still
a valuable tool  i have chosen to use simple linear regression
with a least squares cost function to fit a trendline over the
last n days  by determining a line of the form
trendlines

y   ax   b
that minimizes
n

  ax i    b  y i    

i  

momentum measures the difference between the price on day x and the price n days before  rate of
change  roc  is essentially normalized momentum  i calculate this as follows 
rate of change

rocn  x   

   feature definition
from the outset  i expected that feature definition would
be the most challenging component of this project  as the
price data alone lends little insight into future price movement 
the goal thus becomes to find and to calculate the features
that best capture the movement of gold prices and provide
information on not only their past and current movements  but

p x   p x  n 
p x  n 

momentum and roc are often used to establish trends  i e 
roc     signals an overall uptrend  and roc     signals
a downtrend  however  it is also useful to compare rate
of change over varying time periods  for instance  if    
roc   x    roc    x   or     roc   x    roc   x      this
may signal a weakening and potentially a reversal in the uptrend 

fipredicting gold prices     

the ratio between roc calculated over different
time intervals  particularly rocn   rocm for m   n  is informative because it lends insight into how the change in price
 similar to the first derivative of price  is changing over time
 similar to the second derivative of price  
ratios

the stochastic oscillator is used to
determine overbought or oversold levels of a stock or commodity  overbought basically means that the price has increased
significantly over a short period of time and may be artificially
high  this might mean that the underlying asset is overvalued
and the market will soon adjust  bringing the price back down 
the stochastic oscillator assumes that  in uptrends  prices will
close near the upper end of the recent price range  and in
downtrends  near the lower end  adapting this to use the daily
price fix rather than close prices  i calculate the oscillator on
day x over an n day period as follows 
stochastic oscillator

ln   lowest price over the past n days
hn   highest price over the past n days
p x    price on day x
 k  

p x   ln
     
hn  ln

in general   k generates a buy signal if it is less than     or a
sell signal if it is greater than    

   initial tests
there are a variety of algorithms which can be used for
classification  the two i chose to focus on for this project
are logistic regression and svm  first  i explain the evaluation metric used throughout  the training testing strategy  and
preliminary feature selection 
    evaluation metric
i have formatted this as a classification problem  where
y i      means the gold price goes up from day i to day i     
and y i      means the gold price goes down  or stays the
same   now  denote any example with label   a positive
example  and with label   a negative example  to evaluate
the success of a given algorithm  i plan to take into account
all three of the following metrics 

train and test the algorithm on this data is using k fold crossvalidation  not only does this make efficient use of the data
by using every example for both training and testing at some
point  but it also avoids the not unlikely situation of choosing
a comparatively small test window consisting of an uneven
representation of all possible examples  for example  if i
chose to test on one     day period in which gold happened
to be exhibiting a strong uptrend  this would not adequately
test my algorithms ability to accurately predict what happens
in a downtrend  thus  for all algorithms described below  i
train and test on the full data set with k fold cross validation
for k      
    basic feature selection
in the feature definition section above  i described the usefulness of trendlines and rate of change  but never specified
the exact periods over which i would calculate these  according to past research  a reasonable period would range from
about   days to    days  let nums hold the array of periods
i include as features  varying only the items of nums  i ran
forward selection with logistic regression on this model using
precisely the following features  calculated only for gold price
fix  but none of the intermarket variables  
 slope of trendline at day x and x    for each n in nums
 roc    rocn for each n in nums
 ratios roc   rocn for each n in nums
 value of  k oscillator for period   
i obtained an optimal value nums                        
    logistic regression
using the set of features selected above  the first algorithm
i tried was logistic regression  using the linear model from
pythons scikit learn library  in an attempt to classify as accurately as possible whether the following days london pm
gold price fix would be higher or lower than the current days 
i used the full set of gold price fix technical indicator features
but none of the intermarket variables  i also used l   norm for
penalization rather than the default l    as it achieved better
results  the average results of running logistic regression with
   fold cross validation were as follows 
table    logistic regression  gold price features only 

precision  
recall  
accuracy  

true positives
true positives   false positives
true positives
true positives   false negatives
true positives   true negatives
all examples

    train and test sets
as explained above  i have approximately      data points
spanning early      to late       i believe that the best way to

precision
recall
accuracy

      
      
      

so the recall of logistic regression is over     on average 
which is very high  this means that almost all positive examples were correctly classified as positive  however  the
precision is just over      which is relatively low  this is
because the algorithm produced many false positives  even
for negative examples  it is more likely to predict   than   

fipredicting gold prices     

    svm
the second algorithm that i tried was svm  using the svc
model from scikit learn  i tried four variants of svm  the
default rbf  radial basis function  kernel  the linear kernel
with l   regularization  the linear kernel with l   regularization  and the polynomial kernel  after getting disappointing
accuracy  around         with all four  i normalized all of
the input features by scaling  setting
 i 

 i 
xj

 

x j  mean j
max j  min j

ultimately  the highest accuracy that i was able to achieve
with any kernel with or without normalization was        
which occurred when the svm predicted a positive label for
every example  unfortunately  all variants of svm displayed a
strong propensity to favor predicting whichever class occurred
more frequently in the training set  i e  if x train contained
slightly more positive examples than negative  then y test
would contain almost all positive predictions  
for this reason  i decided that svm is likely not the best
algorithm for this task  regardless of the kernel  and even if
the input features are normalized  the svm always favors
one class  thus i proceed with a primary focus on logistic
regression  however  i do attempt svm once again with the
final feature set  and see a vast improvement in results 
    bias vs  variance
before proceeding  it is important to determine whether the
high test error is due to high bias or high variance  i e  underfitting or overfitting the training set  even when trained and
tested on the entire data set  logistic regression still achieves
only        accuracy and        precision using the gold
price only feature set  this means that the high error is occurring due to high bias  not high variance 

   additional features
as the error above is due almost entirely to the bias of the
classifier  the current feature set clearly does not provide the
algorithm with adequate information to make the right prediction  in this section  i explain how i add features to improve
both train and test accuracy 
    intermarket variables
gold prices  and commodity prices in general  may also be
related to other financial variables  for instance  gold prices
are commonly thought to be related to stock prices  interest
rates  the value of the dollar  and other factors  therefore 
i wanted to explore whether these other variables could be
effective inputs to the prediction of gold prices  i collected
the following data over the same time period as the gold price
fix data  from early      to late      
 us stock indices  dow jones industrial average  dji  
s p      gspc   nasdaq composite  ixic 

 world stock indices  ibovespa  bvsp   cac     fchi  
ftse      ftse   dax  gdaxi   s p tsx composite  gsptse   hang seng index  hsi   kospi
composite  ks     euronext      n      nikkei    
 n      shanghai composite  ssec   smi  ssmi 
 comex futures  gold futures  silver futures  copper futures  oil futures
 forex rates  eur usd  euro   gbp usd  british
pound   usd jpy  japanese yen   usd cny  chinese
yuan 
 bond rates  us   year bond yield  us    year bond
yield  eurobund futures
 dollar index  measures relative value of us dollar
as with gold prices  the absolute values of stock indices 
bond rates  etc  mean very little without an understanding of
current trends and the mechanics of their recent price movement  for instance  for dow jones index values to be useful
for gold price prediction  the algorithm must first thoroughly
understand  and to some extent predict  the movement of the
dji itself  with this in mind  i am applying the same technical
indicators as outlined above with gold prices 
however  i am also adding two additional features per variable      rate of change of volume  since daily volume was not
available with the gold price fix data  and     rate of change
from open price to close price on the current day  which gives
deeper insight into the most recent price movement data that
is available 
    results with additional features
i ran logistic regression  the same format as above  with
   fold cv  with the full set of features calculated for both
gold prices and all intermarket variables listed above  the
table below displays the results 
table    logistic regression  full feature set 
precision
recall
accuracy

      
      
      

as shown above  adding extra features provided a major
boost to the accuracy of the classifier  when i included the
full feature set  accuracy jumped from        to         and
precision from        to         these additional intermarket variables are thus very useful for predicting the rate of
change in gold price 
    computing correlation
as adding a multitude of features that actually have little or
no effect on gold prices would add noise and negatively affect
my predictions  i first want to quantify the correlation that

fipredicting gold prices     

certain variables have with gold prices to determine whether
they might be beneficial to include      for all of the intermarket variables listed above  i calculated the pearson correlation
coefficient over the roughly      day data period between  a 
the london pm gold price fix on a given day  and  b  the close
price of the variable  the table below displays all quantities
by descending absolute value correlation coefficient with the
gold price fix 
table    correlation coefficients
   gold futures
   silver futures
   copper futures
   eur usd
   dollar index
   oil futures
   s p tsx composite
   usd cny
   gbp usd
    kospi composite
    hang seng index
    ftse    
    nikkei    
    shanghai composite
    usd jpy
    dax
    cac   
    euronext    
    eurobund
    us    year bond
    us   year bond
    s p    
    nasdaq composite
    dow jones industrial average
    smi

    
    
    
    
     
    
    
     
    
    
    
    
    
    
     
    
    
    
    
     
     
    
    
    
    

canadian s p tsx index and all of the asian stocks were
quite highly correlated  interestingly  all three of the us stock
indices i tested had an extremely low correlation with gold
prices  with coefficients under      
    feature selection based on correlation
consider  for instance  the three us stock indices  these
all have a very low correlation with gold prices  and thus
are likely not helpful for gold price prediction  in fact  they
may even add noise and cause the classifier to overfit the
training data  leading to higher test error  indeed  training and
testing on the full data set with all of these features achieves a
train accuracy of         which is high compared to the test
accuracy of         thus the variance of this model must
be high relative to the previous model with gold price only
features  i suspected that if i could find a model somewhere
in between these two  i could boost accuracy even further 
i decided to run feature selection on the intermarket variable
features  to do so  i try adding all features associated with
each intermarket variable in order of descending absolutevalue of its correlation coefficient with gold prices  the goal
is to continue adding features in a strategic order as long as
they help rather than hurt accuracy  if the additional features
increase accuracy  i keep them in the model  otherwise  i
discard them 
the outcome of this experiment was extremely positive 
ultimately  the optimal feature set included    of the top   
most correlated variables  of    total   these are 
   commodities futures  gold  silver  copper  oil
 dollar index
   exchange rates  eur usd  gbp usd  usd cny
 hang seng index and nikkei    
the results are as follows 
table    logistic regression  optimal feature set 

the correlation values lead to a variety of very interesting
observations  and here i discuss several salient ones  first 
commodity futures are very highly correlated with the gold
spot price  especially futures for gold itself 
also  when the dollar is valued high  it takes comparatively
less dollars to buy the same amount of gold  so the gold price
 measured in dollars  will be low  for this reason  when
variables which increase with the value of the dollar  i e  the
dollar index or the usd cny exchange rate  are high  the
dollar is high so the gold price is low  conversely  when
variables which decrease with the value of the dollar  i e  the
eur usd exchange rate  are high  the dollar is low so the
gold price is high 
in addition  every single stock index i tested exhibited a
positive correlation with the gold price fix  certain indices
appear much more correlated than others  for instance  the

precision
recall
accuracy

      
      
      

this illustrates a very significant increase in accuracy  from
       when using the entire feature set to        when
using this modified feature set  moreover  precision and recall
suggesting that the classifier is no longer strongly favoring
one class over another  as in the initial tests  where there were
disproportionately many false positives  
    varying the algorithm
at this point  i consider that i have found a highly satisfactory feature set to work with  and briefly examine the effects of
making changes in the algorithm to potentially obtain higher
accuracy 

fipredicting gold prices     

   conclusions

      revisiting svm

running svm on the gold price only feature set was disappointing  as was running svm on the feature set with all
intermarket variables  however  a linear kernel svm with
l   regularization actually performed quite well on the final
feature set  normalized by scaling  as in the svm section
above   achieving accuracy of        with    fold cv  apparently these new features provide the svm just enough
information to make predictions with accuracy very close to 
but still not quite matching  that of logistic regression 
      logistic regression

there are not too many parameters of the logistic regression
model to experiment with  but i tested variations on  a  the
norm used in penalization  and  b  the c parameter  which
specifies inverse of regularization strength  i found that the
optimal combination occurred with the l   penalty and the default c        precisely the parameters of the model in table   
thus this model attains the highest accuracy  precision  and recall of anything i tried  making my overall peak classification
accuracy        

   trading simulation
for practical purposes  predicting the direction of change is
important primarily insofar as it leads to profitable decisions 
to evaluate the success of the algorithm with regard to its
potential profitability  i ran a small simulation that executes
  day trades based on my algorithms predictions 
 predict    buy   ounce of gold
 predict    sell   ounce of gold
i broke the set of training data up into    folds  and separately
for each fold  i trained the classifier described above on all
other examples  then simulate trading on the test set  the
results my algorithm obtained are as follows 
table    simulation results
features
   only gold features
   all optimal features 

average daily profit
     
     

 the simulation with the  nd feature set assumes that gold
can still be purchased at the london pm price fix even after
market close and all data has been obtained  which occurs
several hours later   i was not able to find reliable data for the
gold spot price at market close  when the algorithm would be
ready to make the buy sell decision  
i expect the algorithms actual profit would fall somewhere
between these two estimates  at any rate  my algorithms
predictions allow the trading agent to net a significant profit
over the course of the simulation 

ultimately  my algorithm was able to predict with a good
degree of accuracy whether the following days london pm
gold price fix would be higher or lower than the current days 
i was surprised that the relatively simple model of logistic
regression could achieve such high accuracy  even outperforming all variants of svm that i tried 
moreover  i was able to answer many of the questions i
originally set out to explore  for instance  technical indicators
are usually applied to stock prices or  in general  financial
quantities for which daily high  low  open  and close prices
are tracked  by making slight modifications  for instance 
to the stochastic oscillator formula  and extending this logic
to a quantity like the gold price fix  which is measured only
once per day  i was still able to achieve the desired effect of
understanding how prices have been moving 
i was also very curious about whether intermarket variables
would be effective inputs for gold price prediction  the results
demonstrate that they indeed were  a strategic combination
of these variables based on the magnitude of their correlation with gold prices provided a major increase in accuracy
and precision  indeed  feature selection was a highly useful
process in determining not only what intermarket variables i
should use but also what specific technical indicators i should
use  in general  adding features tended to help  but in other
cases it led the model to overfit the training data  thus reducing
test accuracy 
finally  the simulation illustrates that this algorithm could
actually have significant profitability  with a classification accuracy of nearly      even the extremely simple trading agent
set forth in the simulation was able to attain a considerable
average daily profit 
overall  these experiments have further piqued my interest
in the applications of machine learning to financial prediction 
as determining which features to add and which algorithms to
use was quite interesting  and the end results were better than
i expected  i would be interested in continuing to optimize
this model and perhaps putting its predictions to practical use 

references
   

jan ivar larsen  predicting stock prices using technical
analysis and machine learning  ntnu       

   

vatsal h  shah  machine learning techniques for stock
prediction  nyu       

   

shunrong shen  haomiao jiang  and tongda zhang  stock
market forecasting using machine learning algorithms 
stanford university       

fi