feature investigation for stock market prediction
hui lin
department of aeronautics and astronautics
stanford university
linhui stanford edu

abstract
in this project  machine learning algorithms
were used to forecast the price of the future
stock market  notably  matlabs neural
networks  nnets  and support vector
machines  svm  were used for the
classification problem of whether the stock price
has increased or decreased compared to the
price at the last timestamp  the amount of data
shifting was also investigated  it was found that
the more recent the data that was used for
prediction  the better the prediction accuracy
was 
in implementing these machine learning
algorithms     features such as the quarterly pe
ratio  cogs and net income were used  using
nnets  an accuracy of up to     was achieved
for microsoft depending on the selected
features  with svm  an accuracy of up to    
was achieved 
feature selection techniques such as forward
search and backward search were also
investigated in order to improve the accuracy of
the stock price predictions 
summary
   preliminary investigation
in the beginning of this project  a preliminary
investigation was done to determine the
effectiveness of the nnets in predicting the
future price of microsoft  the previous day
closing price of microsoft  previous day closing

price s p      and moving averages were used
as the features to predict the next day closing
price of microsoft  hidden layers  hl  ranging
from   to     for the nnets were tested 
regardless of the number of hls or the selected
features  the highest accuracy that was achieved
was      upon further investigation and
reading more papers  it was concluded that
using only the historical prices as the features
would not be enough to generate accurate
predictions 
   data collection
more feature data were collected upon
concluding that the historical prices were not
enough to generate a good prediction 
notably     key financial ratios ranging from
s p     price  pe ratio  cost of good sold
 cogs  to net income were obtained 
following that  quarterly data ranging from
     to      were extracted since these ratios
were only available on a quarterly basis 
another reason for using a quarterly data was
that using a slightly longer term data may have
been able to filter out some of the random
noises from the daily fluctuations of the stock
prices 
   data shifting
in predicting the future output values  the
shifted historical data was used  for example 
by shifting the data set by     could be
predicted using     this can be extended to

fiany amount of data shifting where  can be
predicted using    however  after running a
few simulations  it was quickly found out that
the amount of data shifting should be minimized
for a good prediction accuracy  this makes
sense intuitively as the future price of the
market is closely related to the recent historical
data rather than the older historical data 

the accuracy of the trained model is then  given
by the total number of correct label realization
divided by     

   training and validation
after gathering the data  it was split into    
for training and     for testing  within the
    for training  it was furthermore split into
    for training and     for validation  this
was required as the criterion for convergence for
the training of the neural network was when the
validation error would be larger than the
training error 
upon convergence  the accuracy of the training
model was determined  two forms of cross
validations were used  the static algorithm
used              to train the model  and the
model was used to predict                 
the dynamic algorithm is an online algorithm
that goes as follows  during the first iteration 
             was used to train the model  and
the model was used to predict      in the next
iteration                 was used to training
the model  and    was predicted  this was
repeated until there were no more points in the
testing set to predict  the dynamic training
algorithm had higher prediction accuracy since
the training data set contained the information
of the latest financial ratios 
the metric that was used for determining the
accuracy goes as follows  given a test output
set               the corresponding labels
              were generated  where
    

         
   

figure    flow diagram for the neural network training model

   summary of the results
the following tables summarize the table from
running the nnets  table   summarizes the
prediction accuracy determined by averaging all
of the accuracies for a single feature neural
network for a certain number of hl  as shown
in table    using a hl of   gave the highest
average prediction accuracy 
table    average prediction accuracy with respect to the
number of hidden layers for microsoft

neural network with single feature
 microsoft data 
number of
average prediction
hidden layers
accuracy of all the features
 
      
 
      
  
      
  
      
  
      

fitable   shows the prediction accuracy of the
static algorithm for the top   features using hl
of   
table    top   features for microsoft for the static algorithm
using neural network

feature
shareholders equity
common stock net
total current assets
net income
selling  general  
administrative expense

accuracy
      
      
      
      
      

the same strategy was also done with ibm  for
ibm  it was better to include all    features
rather than just a single feature  with a single
feature  the accuracy ranged from           
which was not useful  by including all   
features and tweaking the number of hl  an
accuracy of up to     was achieved 
finally  a preliminary investigation using
matlabs svm package with the gaussian
kernel was also done  by using all    features 
the svm was able to achieve an accuracy of
    for microsoft  which was significantly
lower than the accuracy achieved by nnets 

table   shows the prediction accuracy for the
dynamic online algorithm for the top  
features using hl of    as expected  the
dynamic algorithm gave a higher prediction
accuracy than the static algorithm 

   feature selection

table    top   features for microsoft for the  dynamic 
algorithm using neural network

the first method that was tried was to combine
the features with the highest accuracies from the
single feature prediction  as shown in table   
the more the feature was combined  the lower
the accuracy was  this was rather unexpected
as an increase in the prediction accuracy was
anticipated from combining the top features 

feature
shareholders equity
common stock net
total current assets
accounts payable
gross profit

accuracy
      
      
      
      
      

table   shows the prediction accuracy for these
features when used in linear regression  as
shown in table    the prediction accuracy for
linear regression averaged at about     
table    prediction accuracy using linear regression for the top
features from neural network

feature
shareholders equity
common stock net
total current assets
accounts payable
gross profit

accuracy
      
      
      
      
      

since there were    features  feature selection
techniques were implemented in order to
improve the accuracy 

table    prediction accuracy obtained from combining the top
features

feature
top   feature
top   features
top   features
top   features
top   features

accuracy
      
      
      
      
      

upon seeing that simply combining the top
features didnt increase the accuracy  forward
search and backward search feature selections
were implemented  the forward search goes as
follows  starting from the first feature  one
feature was added at a time  then  the
prediction accuracy was determined for the

ficombination of those features  if the accuracy
increased by adding the new feature  the added
feature was kept  if the accuracy dropped  that
feature was not added to the feature list  most
of the time  the forward search didnt work well
since it ended up with just   feature 
on the contrary  backward search started with
all    features  then  features were removed or
kept one at a time  figure   shows the evolution
of the prediction accuracy as new features were
kept or removed from the backward search
feature selection  as shown in the figure  the
backward feature selection did not improve the
prediction accuracy 

accuracy of     was achieved when all   
features were used 

future works
some of the future works include a most robust
method of coming up with selecting the features
that would give the highest prediction accuracy 
neither forward search nor the backward search
feature selection worked for this specific stock
price prediction problem 
another point to investigate is to have a moving
training data set  currently  the old training data
are always kept even when new data are being
added after every iteration  however  in stock
market prediction  the data from    years ago
may not be helpful in predicting the future price
of the stock  thus  the removal of the old data
from the training data set when adding in new
data should be tested in order to improve the
prediction accuracy 

acknowledgement

figure    prediction accuracy evolution from backward search
feature selection

conclusion
with neural networks  a prediction accuracy that
was noticeably higher than     was achieved 
it was also noted that the feature selection
played an important role in terms of the
prediction accuracy  interestingly  for
microsoft  the highest prediction accuracy was
achieved when using only   feature as an input 
such was not the case for some of the other
companies such as ibm where prediction
accuracy using   feature averaged at around
     with ibm  a much greater prediction

i would like to acknowledge jordan klovstad
for helping me with acquiring all the important
financial data that was used for this study 

fi