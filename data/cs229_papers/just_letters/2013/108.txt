 d visualization of immune system cellular protein data by
nonlinear dimensionality reduction

andre esteva
esteva stanford edu
stanford university  electrical engineering      lomita mall  durand      stanford  ca       usa
anand sampat
asampat stanford edu
stanford university  electrical engineering      serra mall  stanford  ca       usa
amit badlani
abadlani stanford edu
stanford university  electrical engineering      serra mall  stanford  ca       usa

abstract
we present in this paper a way to effectively
visualize multi dimensional immune system
cellular data by means of nonlinear methods 
we find that stochastic neighbor embedding  sne   and its variations  t sne and
s sne  to be most effective at successfully
mapping clusters of points into a two dimensional embedding space while preserving both
the structure between similar points and the
disparity between different clusters  using
a centroid based metric that relabels points
according to the cluster centroid to which
they are closest  we conclude that sne works
significantly better than linear and spectral
methods  by using an optimization approach
for sne that follows the spectral direction
of descent  we are able to run the sne varients and ee two orders of magnitude faster
than with standard optimization  finally  we
demonstrate superior classification of data by
first reducing its dimension then applying supervised learning using a c svc svm and
 svc svm 

   introduction
     immune cell data
in the field of cancer immunology  scientists use the
protein content of immune system cells as a way to
identify a cells corresponding type      for example 
appearing in proceedings of the    th international conference on machine learning  edinburgh  scotland  uk       
copyright      by the author s  owner s  

immune system cells  which are contained in bone marrow  are comprised of a variety of cell types  and to a
large degree are uniquely identifiable by the proteins
they contain  highly sophisticated methods have been
developed that process cells and return information on
the types and quantities of proteins expressed in those
cells  this data can then be viewed by an expert in the
field and categorized  the laborious process of viewing the different dimensions of protein expression and
categorizing a cells type is known as gating 
     project goals and metrics
it is of interest to cancer immunologists to find structure within multi dimensional protein expression space
and map it onto a lower dimensions  refered to henceforth as a map space  for ease of visualization and
understanding  as cells change and evolve  so do the
types and quantities of the proteins they express  this
leads to a shifting of their representation in multidimensional space which can be tracked  dimensionality reduction of original biological data coupled with
a metric for how well the projection represents the
original data would provide biologists with a powerful
tool for understanding the structure of their data  to
address these challenges we demonstrate 
 visualization  the application of linear and nonlinear methods of dimensionality reduction of
multi dimensional protein data
 visualization  a metric based comparison of how
each algorithm performs
 classification  application of svms to both the
original data and to the dimensionality reduced
data

fi d visualization of immune system cellular protein data by nonlinear dimensionality reduction

damentally different roles in cell identification  surface
proteins are semi permanent markers that last for significant periods of time relative to the lifetime of a cell 
whereas intracellular proteins are highly transient and
can change quickly  this is analogous to classifying
a person based on where they live  semi permanent 
versus what they wore on a particular day  transient  
understanding this  we select as our feature space the
n      surface protein markers of the cell data 
figure    overview of data acquisition  from extraction of
cellular protein counts to storage in online databanks

table    classification of cell types and their corresponding sub types

cell types

sub types

stem cell
b cells

hsc  mpp  cmp  gmp  mep
plasma  pre b i  pre b  ii  immature 
mature cd   low  mature cd   mid
mature cd    mature cd  
naive cd    naive cd  
cd  b     cd  b high  cd  b mid

t cells
nk
pdc
monocytes

   methods
the datafiles provided contain cell counts on the order of tens of thousands where we consider each cell to
be a point in rn   to simplify our algorithms and account for matrix size differences in the different  fcs
files we run our algorithms on equally sized portions
of different cell data  in particular  if we let s be the
set of all cell sub types as defined in table    s  s
be some subset of interest with cardinality  s   and n
some fixed positive integer  then by taking n rows from
each sub type s  s we form a matrix m  rn  s n  
this allows us to run algorithms that accomplish dimensionality reduction from rn onto r  quickly and
without giving unfair weighting to a particular cell
sub type 
     linear methods

   data representation
     data acquisition
mass cytometry is a single cell multiparametric protein detection technology based on inductively coupled
plasma mass spectrometry  it is an extension of flow
cytometry in which antibodies are tagged with isotopically pure rare earth elements allowing simultaneous
measurement of greater than    parameters while circumventing the issue of spectral overlap  in single cell
droplet form  the cells are passed through an elemental mass spectrometer and an integrator to generate an
m  p matrix where m is the number of cells processed
and p is the number of distinct proteins contained in
the cell set  these matrices are stored as  fcs files in
online databanks which we have been granted access
to  figure    taken from     shows this process  table   lists the cell types and subtypes that are parsed
using this method 
     feature selection
the p      types of proteins collected for each cell
using mass cytometry are comprised of both intracellular and surface proteins  these two types play fun 

linear methods such as principal components analysis  pca  and multidimensional scaling are straightforward and standard ways of achieving dimensionality reduction  the caveat is the requirement that the
data be linearly separable in the space being considered  unlike svms  which have the ability to project
data to higher dimensions in order to linearly separate
it  pca runs in the original dimension of the data 
given the nature of this data and the fact that cellular protein counts can vary largely between cell types 
pca is not an optimal method for visualizing these
sorts of problems  we apply pca and demonstrate
that its visualization is quite poor  as expected 
     spectral methods
spectral methods like locally linear embedding
 lle   isomap  and laplacian eigenmaps  le  seem
like better candidates for dimensionality reduction of
problems of this sort  for example  le tries to preserve the local structure of the data while keeping the
scale of the embedding data fixed  leading to good results on toy problems such as the swiss roll  we apply
lle and isomap to this data set and show  rather
counterintuitively  that the results are even worse than
pca 

fi d visualization of immune system cellular protein data by nonlinear dimensionality reduction

     nonlinear methods

   results

nonlinear methods  as demonstrated in the section below  are the most effective of the algorithms used for
visualization of celllular protein data  cellular protein
data is largely believed to exist in multi dimensional
space in gaussian distributed clumps that can have a
high degree of overlap  these gaussians can exhibit
high degrees of variation in their average and variance
values  as such  we consider the variants of sne      tsne     and s sne      along with elastic embedding
 ee      as prime candidates for effective visualization 
these algorithms minimize objective functions that
mimic attractive and repulsive forces in the mapping
space  which keeps the images of nearby objects close
while pushing all image clusters apart from each other 
they take the form e x      e    x    e   x 
where e    x  is the attractive term  e   x  the repulsive term      is a fixed parameter  and x    xn   is
the set of points in the mapping space  the repulsive
term significantly improves them over spectral methods like le 

     linear methods   pca

     fast learning of nonlinear embeddings

figure    principal components analysis on all cell subtypes with     cells per subtype

in order to speed up the sne and ee algorithms  we
employ a strategy for optimization of the objective
functions in the spectral direction      optimization
typically involves computing the gradient g   e of
the objective function and computing a descent direction as p by solving the linear system bp   g using
some positive definitie b  when b   i this is gradient
descent  and for b     e we have newtons method 
descending in the spectral direction is accomplished
by letting b be the first term of   e and  for small
data sets           points  is two orders of magnitude
faster than gradient descent and newtons method 

we consider pca over all    cell sub types with    
cells per cell sub type and obtain a        re labeling
error  figure   below shows the visualized data  it is
clear that the overlap between points renders the map
meaningless  the colored stars in the figures represent
the centroids of each sub type 
even when we reduce the number of sub types to
   monocytes and t cells   the performance is still
abysmal at        error  as shown in figure   

pca  n file      err        

pca  n file      err        

 

 
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

 

 

 

 

 

 

 

 

 
 

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

 

 

 

 

 

 

 

 

 

 

  

  

 
 

 

 

 a  original labels

pca  n file      err        

 

 

 

 

 

  

  

relabel pca  n file      err        

 

 
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

 

 

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

 

 

 

 

 

 

 

 

 
  

 

 b  new labels

 

 

 

 

 

 

 

 

 

  

 
  

 

 

 a  original labels

 

 

 

 

 

 

 

  

 b  new labels

figure    principal components analysis on monocytes
and t cells with     cells per subtype

     metric on quality of visualization

     spectral methods   isomap

we quantify the quality of the various algorithms
at accurately segregating different cell types in the
map space using a simple re labeling technique  after
projection  the averages of all the points  centroids 
of each cell sub type are calculated  each point is
then relabeled based on whichever centroid it is closest to  formally  for cell sub type i with p  i  points
 x i    in the projection space  the centroid is given
p  i 
by  i    p  i  j xj   and each point x is relabeled
as sub type i   arg minj    j   x    the error of
a visualization
pn with n points is then calculated as
err   n  j   originallabel xj      newlabel xj    

we illustrate in figure   the spectral method isomap
on this data both for all cell sub types  n type       
and for just monocytes and t cells  n type       
combined  in each case  the algorithm yields no discernible segmented high level structure 

isomap  all cell types

isomap  monocytes   t cells

  

  

  

  
  

  
 
 

 
 
 

  
 

  

  
  

  

  

 

 

 

  

  

 a  all cell types

  

  

  
  

  

 

 

 

  

  

 b  monocytes and t cells

figure    isomap with     cells per subtype

fi d visualization of immune system cellular protein data by nonlinear dimensionality reduction

     nonlinear methods
tsne  err         

we begin by considering t sne and sampling     cells
from each cell type  we see in figure   that the algorithm clusters the points reasonably well  even though
it attains a relatively high error of         on the
other hand  when we only work with monocytes and
t cells  figure     we obtain a       error   a   fold
improvement on pca for the same data set 

relabel tsne  err         

  

  

  

  

  

  

  

  

  

  

 

 

  

  

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

  

  

  

  

  

  

  
   

   

   

  

 

  

   

   

  
   

   

   

   

 

 

 

 

 

 

 

 

  
  

 

 

 

  

  

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

  
  

 

 

 a  original labels

 

  

  

 b  new labels

figure    ssne on all cell subtypes with     cells per subtype
relabel ssne    err         

ssne    err         

  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

 

 

 

 

 
 

 

 

 

 

 

 

 

 

 

 

 
 

 

 

 

 

 

 

 

 

  

 
 

 

 

 a  original labels

 

 

 

 

 

 

  

 b  new labels

figure    ssne on monocytes and t cells with     cells
per subtype
relabel ee  err        
  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

cd  b monocyte
  
cd  bhi monocyte
cd  bmid monocyte
cmp
  
gmp
hsc
immature b
mep
  
mpp
mature cd  lo b
mature cd  mid b 
mature cd   t
mature cd   t
nk
  
naive cd   t
naive cd   t
plasma cell
  
plasmacytoid dc
preb i
preb ii
  

  

  

 

      
     
     
      

   

 
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte  
cmp
gmp
 
hsc
immature b
mep
 
mpp
mature cd  lo b
mature cd  mid b
 
mature cd   t
mature cd   t
nk
 
naive cd   t
naive cd   t
plasma cell
 
plasmacytoid dc
preb i
preb ii
 

ee  err        

      
      
       
      

  

relabel ssne    err        

ssne    err        
 

  

  

  

pca
tsne
ssne
ee

 

 b  new labels

  

monocytes   t cells

  

 

table   summarizes the errors for the different algorithms 

all cells

   

figure    tsne on monocytes and t cells with     cells
per subtype

we now look to ee  the last of the nonlinear methods
we are considering  and run the algorithm with the
same inputs as the previous methods  once again  we
take a sample of     cells from  i  all cell types and
 ii  monocytes and t cells  figure   shows the visualization of all cell subtypes and figure    shows it for
monocytes and t cells  though the algorithm works
better than pca  it performs substantially worse than
the sne variants with an error of         for all cells
and        for just monocytes and t cells  in addition  there is less spacing between clusters than with
the sne variants 

algorithm

   

 a  original labels

next  we consider s sne on a similar sample of    
cells taken from either all cell types  figure    or
monocytes and t cells  figure     we see that the
visualization appears to perform as well as tsne  yet
the metric shows that its performance is slightly worse 
ssne attained errors of        and       for all cell
types and the subset of monocytes and t cells  respectively 

table    algorithm errors

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

  

  
   

   

   

  

 

  

   

  
   

   

 a  original labels

   

  

 

  

   

 b  new labels

figure    ee on all cell subtypes with     cells per subtype
ee  err        
tsne  err       

relabel tsne  err       

  

  

  

 

  

  

 

  

  

  

  

  
  

  

  

 

  

  

 a  original labels

  

  
  

   

   

   

   

  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

  

  

   

   

   

  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
cmp
gmp
hsc
immature b
mep
mpp
mature cd  lo b
mature cd  mid b
mature cd   t
mature cd   t
nk
naive cd   t
naive cd   t
plasma cell
plasmacytoid dc
preb i
preb ii

relabel ee  err        

   

  
cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

 

  

   

   

   

   

  

  

  

 

  

  

  

 a  original labels
  

 

  

  

cd  b monocyte
cd  bhi monocyte
cd  bmid monocyte
mature cd   t
mature cd   t
naive cd   t
naive cd   t

   

   

   
  

  

 

  

  

   
  

  

  

  

 

  

  

  

  

 b  new labels

  

 b  new labels

figure    tsne on all cell sub types with     cells per subtype

figure     ee on monocytes and t cells with     cells per
subtype

fi d visualization of immune system cellular protein data by nonlinear dimensionality reduction
table    svm classification rate
c svc

original

pca

t sne

radial
polyn 
linear
sigmoid

    
    
      
    

     
     
     
     

      
      
      
     

nu svc

original

pca

t sne

radial
polyn 
linear
sigmoid

  
    
     
    

   
     
     
   

      
      
     
      

ee
    
    
    
   

 
 
 
 

ee
  
    
    
   

 
 
 
 

     classification
shifting our attention from visualization to classification  we compare the classification effectiveness of csvc and  svc svm  per the libsvm library     
run on the original data to the projected data  and
reach a counter intuitive result  the svm applied to
the original data fails entirely  with low success rates 
the svm applied to the projected data classifies with
significantly higher accuracies  depending on the dimensionality reduction algorithm used  table   shows
the success rates of c svc and  svc with various
kernels  with s sne omitted as its values are very
close to t sne   we find that the best classification
is achieved  with a success rate of        when using  svc based svm with a polynomial kernel on
the pca reduced data  the classifiers
 used are multiclass classifiers that train  celltypes
binary classifiers
 
resulting in     decision boundaries that more effectively classify the    labels than a standard one vs all
algorithm 

   conclusion
human immune system cells are comprised of a variety of cell types and sub types which are characterized
by the proteins contained within them  proteins embedded on the cells surface are particularly effective
at characterizing the type of cell  we apply dimensionality reduction considering only the surface proteins as features to aid the visualization of cells in
this multi dimensional protein space  we apply principle components analysis  isomap  elastic embedding  symmetric stochastic neighbor embedding  and
student t distributed stochastic neighbor embedding
to this problem and use a centroid based relabeling
metric to quantify the effectiveness of each visualization  we demonstrate the superiority of the nonlinear
methods  with t sne being the most effective  while

simultaneously showing that pca and isomap yield
poor results  we further conclude that the data is
nonlinear and that it supports the belief that clusters of healthy cells in this protein space are gaussiandistributed 
in addition  we demonstrate a substantial improvement in svm based classification of data by first reducing the dimensionality of the data and then applying classification on the reduced data  we find that by
combining pca with  svc based svm and a polynomial kernel a       classification rate is achieved 
our work provides a general tool which biologists
can use to visualize and better understand multidimensional cellular protein data  this is a first
step towards automated cell labelling and further work
could yield a scalable platform by which both healthy
and unhealthy immune system cells could be easily categorized  leading to a cancerous cell detection system 
additionally this can be used by researchers to track
how immune system cells protein content changes as
they mature  evolve  and differentiate 

   acknowledgments
we would like to thank karen sachs  stanford university  and andrew gentes  stanford university  for
their support and guidance throughout this project  as
well as for providing the data required for its completion 

references
    bendall  s  c  et al  single cell mass cytometry of
differential immune and drug responses across a human hematopoietic continuum  science            
       
    hinton  g  e    roweis  s  t     hinton  g  e 
  roweis  s  t  stochastic neighbor embedding  advances in neural information                 google
scholar  advances in neural information              
    van der maaten  l    hinton  g  visualizing data
using t sne  journal of machine learning research   
          
    cook  j   sutskever  i    mnih  a  visualizing similarity data with a mixture of maps  international      
       
    carreira perpinan  m  a  the elastic embedding algorithm for dimensionality reduction  icml        
    vladymyrov  m    carreira perpinan  m  partialhessian strategies for fast learning of nonlinear embeddings  arxiv preprint arxiv                  
    chang  c  c    lin  c  j  libsvm  acm transactions on intelligent systems and technology       
       

fi