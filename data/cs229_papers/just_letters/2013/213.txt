gaussian process based image segmentation and
object detection in pathology slides
cs     final project  autumn     

jenny hong
email  jyunhong stanford edu
i 

i ntroduction

in medical imaging  recognizing and classifying
different cell types is of clinical importance  however  this requires a medical expert to perform the
arduous task of manually annotating images  therefore  we seek to better automate the two following
problems in pathology slides of human tissue 
the first is image segmentation  or categorizing
pixels into labeled classes  for our dataset of h e
stained cardiomyopathy slides  our classes are the
foreground cells  ie  cardiomyocytes   background
cells in the interstitial space  and nuclei in either
region 
the second problem is object detection  or identifying instances of some class  in this case  our primary interest is identifying instances of cardiomyocyte cells  this greatly aids in medical annotations
and allows experts to focus on annotating only the
interstitial cells  which are the parts that most require
expert attention to label 
we extend existing methods for object detection
by proposing a new model for shapes of objects  for
each cell  we develop a radial representation  which
we call a shape profile  we then learn gaussian
processes from these profiles model the prior distribution over shapes  such a model is relatively new in
the literature     and the work has not also combined
this technique with the process of proposing new
boundaries for cells in a generative method 
we then further augment this method by building
off of existing methods for seed detection  which is
important for refining the radial representations 

 
   
   
   
   
    
    
    
 

fig    

   

    

    

original h e stained slide with bounding boxes

this project is an extension of jennys work
under david a  knowles during stanford cs undergraduate research internship during the summer of
      where she developed the image segmentation
portion of the project and began initial work on the
shape profile model for gaussian processes 
december         
ii 

m ethods

a  image segmentation
for multi label segmentation  we use the approximate graph cuts based algorithm proposed by
boykov et al       minimizing energies of the form
e f    

x
 p q n

vp q  fp   fq    

x
pp

dp  fp  

   

fi 

 

   

   

   

   

   

   

   

   

    

    

    

    

    
 

fig    

   

    

    

results of image segmentation

where n is a set of four connected neighboring pixels and p is the set of pixels  the potentials respectively seek smoothness  ie  similarity of neighboring
pixels  and fidelity to the original image 
for each class  to calculate the unary potentials 
we learn a gausian mixture model with pixels as
individual data points  each pixel is represented by
a vector consisting of its rgb values in the original
image 

    
 

fig    

   

    

    

results of connected component labeling

b  object detection
our goal in this stage is to identify components
with smooth outlines  so that we can generate shape
profiles as described in the next section  starting
with the segmentation generated from the previous
step  we reduce the image into binary background
vs  non background classes and use a simple flood
fill algorithm to identify connected components of
the same class  fig    shows the results of connected
component labeling  each color represents a different connected component  

a small set of hand labeled pixels  relative to
the image size   serves as the training data for
the gaussian mixture model  we have labeled two
bounding boxes of pixels per class  to simulate the
type and amount of data a human would provide if
labeling an image in an interactive environment  an
example image with bounding boxes  in green  is
shown in fig    

for each object  we construct a shape profile 
or radial representation  by measuring the radius
from the center at    evenly spaced angles from
  to    the initial guess of the center is taken to
be the centroid of all pixels assigned to the given
connected component  however  later iterations can
incorporate the centers found by the seed detection
component of the project 

for the pairwise potentials  we started with potentials of larger magnitude from a class to itself 
which promotes identifying coherent  connected objects  we also gave small potentials to cardiomyocyte and background  and cardiomyocyte and nucleus 

this representation allows us to represent a shape
with fidelity to the exact pixels used in the shape
but in a very compact way  from these shapes  we
learn parameters to represent a prior distribution
over the shapes via a gaussian process  for our
covariance function  we use the following periodic
random function     over x

the result of the image segmentation process is
shown in fig   

k x    x      a exp 

sin    x   x    
 
 l 

   

fifig    

  
  
  
  
  
  
  
   

 

 

 

 

 

 

  
  
  
  
  
  
  

 

 

 

 

 

 

sample gaussian process parameters

a is the amplitude and learns the average radius
or measure of size for each cell  l is the lengthscale  or strength of correlation between two points
as a function of their distance  for example  l can
distinguish between an elliptical cell shape  such as
the ground truth cardiomyocyte labeling  a figureeight cell  such as two cells incorrectly identified as
one connected component 
we found the parameters to be influenced very
little by the prior distributions given over their
values  however  they were strongly influencedqby
n
initial values  we used initial values a   

where n is the number of pixels in the connected
component and a small constant for l   
fig    shows a shape profile and the parameters
of the gaussian process learned from it  the dashed
green line represents the mean and the shaded gray
area extends to one standard deviation above and
below 
c  seed detection
the gaussian process technique learns parameters over the prior distribution of shapes  but it
does not directly aid in identifying the centers or 
more importantly  the boundaries of these shapes 
identifying accurate centers is important in finding
a shape profile with high fidelity  and to that end 
we use a multiscale laplacian of gaussian filtering

fig    

laplacian of gaussian filter with      

method proposed by al kofahi et al      
the multiscale log method originally used an
exact binary graph cuts algorithm to classify foreground and background for pre processing  however  because of richer image data and different
needs  we have binarized our image after a multilabel segmentation via flood fill 
the multiscale log method simultaneously gives
estimates of the shape and of the center for each cell 
the scale normalized log filter is given by
   g x  y       g x  y   
 
 
x 
y  
   
where  is the scale value and g x  y    is a
gaussian with   mean and scale  

lognorm  x  y          

fig    shows the log filter detecting centers well
for the given   in particular  red areas show pixels
that are good fits of centers whose borders align with
the filter 
the centers of cells in the image are given by
peaks in the response surface
rn  x  y    argmax  lognorm  x  y     in  x  y  
   
for each connected component c where c is a
set of pixels  the estimate of its center is therefore
given by argmax x y c rn  x  y   this is again a
modification of al kofahi et al s method  which

fiveta of the image sciences institute      a ground
truth data set  we also plan to data from the ucsb
bio segmentation benchmark dataset      also h e
stained breast cancer images 
iii 

fig    

sample centers detected by the laplacian of gaussian filter

used watershed flooding to detect all local maxima
rather than restricting to one per connected component 
this method allows us to choose exactly one
center per connected component to generate the
shape profile for the gaussian process part of the
object detection process  it also simplifies the problem by allowing us to use the guassian process
to focus only on under segmentation  ie  when two
or more ground truth cells are detected as one
connected component  instead of also addressing
over segmentation  which was not a problem for our
data set 
however  this means we must rely entirely on the
score assigned by the gaussian processes to detect
when we should split components  in the original
method  the multiscale log method implicitly contributed to detecting places to split  because each
local maximum indicated one cell 
d  data set
thus far  we have run our methods on transverse and longitudinal h e stained cardiomyopathy
slides provided by andrew connolly of the stanford
medical school   figures in this paper are taken
from tranverse slides   for comparative analysis  we
plan to test further using result from h e stained
breast cancer histopathology images from mitko

c onclusion

in this project  we have explored the effects
of two approaches to object detection that run in
parallel  gaussian processes based on shape profiles
and multiscale laplacian of gaussian filters  each
method gives an independent estimate of two values 
    the size of the cell  corresponding to a parameter
of the gaussian process and the scale of the log
filter  and     the fit of a connected component
 corresponding to the score assigned to a component
by the gaussian process and whether the original
multiscale log filtering method by al kofahi et al 
yields multiple seeds per connected omponent  
the main goal of immediately further work is
to integrate these two estimates iteratively  that
is  a proposed workflow is to iterate between the
gaussian process method and the multiscale log
method instead of running them in parallel  after
one method completes  its estimates of the two
values above can be passed to the second one  such
as in the form of prior beliefs of the values  we
thus aim to build an integrated method with better
performance than either method individually 
finally  we plan to integrate these techniques into
the interactive learning and segmentation toolkit
 ilastik      
acknowledgment
this project was advised by david a  knowles 
postdoctoral researcher at stanford university 
in the in the initial segmentation process  we
use andrew muellers pygco library  which is a
python wrapper for boykovs implementation of
his multi label graph cuts method in c    our
implementation of the gaussian process builds off
of the open source pygp gaussian process toolbox
for python 
the author would also like to thank andrew
connolly and mitko veta for personally providing
their h e slides for use in our data set 

fir eferences
   

   

   

   
   

   

   

y  al kofahi  w  lassoued  w  lee  and b  roysam  improved automatic detection and segmentation of cell nuclei
in histopathology images  ieee transactions on biomedical
engineering                april      
y  boykov  o  veksler  and r  zabih  fast approximate
energy minimization via graph cuts  ieee transactions on
pattern analysis and machine intelligence                  
november      
e  d  gelasca  j  byun  b  obara  and b  manjunath  evaluation
and benchmark for biological image segmentation  in ieee
international conference on image processing  oct      
c  e  rasmussen and c  k  i  williams  gaussian processes for
machine learning  the mit press       
t  shepherd  s  j  prince  and d  c  alexander  interactive
lesion segmentation with shape priors from offline and online
learning  medical imaging  ieee transactions on            
           
c  sommer  c  straehle  u  koethe  and f  a  hamprecht 
ilastik  interactive learning and segmentation toolkit  in  th
ieee international symposium on biomedical imaging  isbi
            
m  veta  p  j  van diest  r  kornegoor  a  huisman  m  a 
viergever  and j  p  w  pluim  automatic nuclei segmentation
in h e stained breast cancer histopathology images  plos
one          

fi