prediction of nyc restaurant health inspection results
michael walter
   december     
project goal
every year  the new york city health
department inspects each of the       
restaurants located in the city  and evaluates
them on compliance in food handling  food
temperature  personal hygiene  and vermin
control  to help the public understand the
results of these inspections  the health
department developed a grading system in
      where a grade of a  b  or c is assigned
to each restaurant based upon the inspectors
evaluation  with a being the best grade  each
restaurant is then required to post its grade at
the restaurants entrance  so potential patrons
can have insight into the restaurants health
standards 
since restaurants in new york city have a fairly
high turnover rate  a restaurant will often have
a sign saying grade pending or not yet
graded  which means potential patrons are left
to guess what the health grade would be  the
potential patron would  however  know various
facts about the restaurant  such as restaurant
name  type of food  street address  borough 
and zip code  the goal of this project is to take
these basic facts and predict whether a
restaurant will receive a grade of a or a lower
grade 
data
new york city publicly posts the results of their
restaurant inspections in an online database 
and makes them downloadable as text files
 https   nycopendata socrata com    these text
files contain information on every inspection
the city has performed  and includes the
inspected restaurants name  address  zip code 

borough  food type  inspection date  health
violations found  inspection score  health grade 
and any punitive actions taken by the health
department  since the goal of this project is to
help a member of the general public predict the
health grade  the input variables will be limited
to only the information that a patron would
know 
to make the information useable  the text files
are first converted into a spreadsheet format
for further processing in matlab 
each
restaurant inspection is then assessed and
removed if the inspection did not produce a
health grade  since many inspections are not
graded  next  those with grade pending or
not yet graded scores are removed 
additionally  since most restaurants have been
inspected and graded multiple times  the grades
for a given restaurant are averaged to eliminate
counting a restaurant multiple times  which
results in each restaurant being assigned its
typical grade  finally  the data is prepared for
training and testing  by selecting a random
distribution of     of the data as a training set 
and     as a test set 
after processing the data and turning it into a
useable format        of the citys       
unique graded restaurants are available for
training and testing  of these restaurants       
received a grade of a  while the rest received a
lower grade 
approach
the overall approach taken to classify a
restaurants health grade as an a or lower is to
first assess individual factors that a potential
patron would know and determine the
 

fiprobability of the restaurant receiving a certain
grade  given that individual factor  the
probabilities for each factor are then
collectively evaluated by performing logistic
regression with each probability being treated
as a feature  finally  a classification prediction
is made and evaluated for all values of a test set 
to help assist with feature selection  each
feature is independently evaluated by holding
out a test set when training  and then
evaluating that features performance on that
test set  this is relatively easy  since the output
of each independent feature evaluation is the
probability of an a for each test case 
there are two issues worth noting when
performing feature selection against the
restaurant data set with features of borough 
address  zip code  name  and food type 
   the features can be grouped into three
classes
of
data
with
similar
characteristics  textual data  name and
street address   features where each
possible value is independent from the
others possible values  borough and
food type   and features where the
possible values are related to each
other  zip code  
   there is correlation between certain
features that occur in the data set  such
as between borough and zip code  or
name and food type 

functions  the success of this factor is then
tested by applying the nave bayes classification
algorithm  and running it against a test set 
while one borough  staten island  results in a
prediction accuracy of        the overall
prediction accuracy for the city is        which
is almost equal to random guessing and
therefore implies that the borough is probably
not a useful factor 
the poor performance of this factor is likely due
to the fact that each borough is very large and
consists of many diverse neighborhoods  which
means there is too much variation within each
borough  this point is supported by the fact
that staten island  at         people  is one
third the size of the next smallest borough  and
therefore has the greatest probability for
homogeneity throughout the entire borough 
food type
a nave bayes classifier is also used to evaluate
a restaurant by the feature of food type  unlike
borough  however  classifying a restaurant by
food type results in a statistically significant
accuracy of        which implies that this
feature is better for prediction  in particular 
certain food types are more indicative of a
certain health grade than others  for example 
the following food types  each with more than
   test restaurants  result in a generalization
error of less than     
asian

chinese japanese

while features of different classes can be
evaluated together without a problem  using
two correlated features can be problematic 
and is therefore avoided 

donuts

greek

ice cream

indian

indonesian

juice smoothie

borough

russian

sandwiches

steak

turkish

to determine the probability of a restaurant
receiving an a given a specific borough  bayes
formula is easily implemented using indicator

 

fithis implies that these food types have a strong
correlation between food type and health grade 
on the other hand  the following food types
 each with more than    test inspections  have
a generalization error greater than      and are
therefore not as useful in predicting a grade 

indian and bombay  ice cream and ice  and
sandwich and pain 
this correlation
demonstrates the futility in combining both
name and food type when trying to make a final
prediction  even though there is a significant
accuracy for both name and food type 

african

bagels

street

bakery

italian

korean

kosher

middle eastern

pizza

spanish

vegetarian

classifying the restaurant by street address uses
similar text classification algorithms as
classifying the restaurant by its name  in this
case  the training set of       different
restaurants results in     different street words 
while there are certain streets  such as
richmond  flatlands  pearl  and knickerbocker 
that are indicative of a specific restaurant
health grade  the prediction accuracy against a
test set is only        the street evaluation
factor is therefore not very useful 

name
to evaluate a restaurants name  a text classifier
that determines the probability of a grade given
a specific name needs to be used  such as a
nave bayes text classifier 
while
mathematically similar to the classifier used for
borough and food type  this approach requires
significantly more data processing  this is also
similar to the spam filter discussed in the
lecture notes  the accuracy of the independent
name classifier is        which is statistically
significant 
the training set of       different restaurants
results in       unique words with which to
classify  the words that result in the strongest
probability of accurately predicting a grade are 
bombay

chen

donuts

dunkin

fusion

ice

pain

quotidien

shoppe

town

it is important to notice the correlations
between the name and food type  for example 
the food type of donuts is a strong predictor 
as are the words dunkin and donuts  other
obviously correlated names and food types are 

zip
the final feature that is easy for a restaurant
patron to know is a restaurants zip code  while
the other factors are determined using a nave
bayes classification algorithm against a
categorized set  the zip code affords other
possibilities  which arise due to the fact that
consecutive zip codes often share physical
boundaries  three approaches are tried to
determine the best probability of a health grade 
nave bayes  k means clustering  and fitting a
polynomial to zip code groups 
initially  a nave bayes classification algorithm is
implemented  since it provides a test case  and
is easy to adapt from the previous factors 
nave bayes results in a test accuracy of      
for     zip codes  which is statistically
significant  albeit less accurate than the
features of name and food type 
the next approach to predicting a health grade
based upon zip code is to use a k means
 

ficlustering algorithm to attempt to group the zip
codes into neighborhoods that might have
homogeneous characteristics 
   cluster
centroids are chosen  since new york state
defines    different neighborhoods in new york
city  which results in an average of     zip codes
per clustered neighborhood  after the clusters
are formed  bayes algorithm is applied to the
clustered neighborhoods to determine the
probability of each restaurant receiving an a 
unfortunately  at      the test results are
slightly worse than for the original nave bayes
approach 
the third approach is to attempt to fit a
polynomial that inputs a zip code and outputs
the probability of receiving a specific health
grade  using the following steps 
   the zip codes are divided into groups 
because nycs zip codes exist in seven
groups that have roughly consecutive
numbers within them  but fairly large
gaps between the groups  for example 
one group  staten island  has zip codes
             and then the next group
 the bronx  has zip codes that jump
over a hundred numbers to            
   values of a are assigned a    and other
values are assigned a    these values
are plotted vs zip code for each group 
   holdout cross validation is used to
determine the optimum dimension for
a curve to fit through each of the seven
groups  the optimal balance between
bias and variance is achieved by cycling
the hold out sample points  and
averaging their test accuracies for
various dimensions 
   finally  a new curve is fit for each group 
given the optimum number of
dimensions found in the previous step 

using these steps  the probability of an a
grade for each zip code is extimated by each
polynomial  since fitting the curve essentially
averages the assigned  s and  s for that zip
code  while also being influenced by the
surrounding zip codes  since adjacent zip codes
will likely have some correlation  this is a
promising technique 
unfortunately  this
method independently results in a test accuracy
of       
combination of features
the final step to predicting a restaurants health
grade is to combine several of the features
using logistic regression  and therefore the
hypothesis is 

where  x  are the evaluation features for each
restaurant  and    are the functions
coefficients  the obvious evaluation features
are probability give a food type and the nave
bayes output for zip code  since they are the
most accurate uncorrelated features  figure    

figure    test accuracy for each factor
theta is found by running an update algorithm
with a decreasing learning rate against the
entire training set  until the theta values
converge  which can be seen in figure   

 

fiare the largest single factors  however they
were not chosen together due to their high
correlation  the result of testing them together
is an accuracy of        which is    less than
the chosen combination  and actually worse
than food type by itself  this supports the
decision to not include two highly correlated
features 

theta values vs  iterations
 
   
 

theta values

   
 
   
 
    

conclusion
  

 

   

    

    
iterations

    

    

    

figure    theta values vs number of iterations
finally  the logistic regression equation is run
against the test set that had originally been left
out  and the result is similar to the accuracy of
food type  when run independently 
when logistic regression is instead run with the
features of food type and the polynomial fit zip
code the testing accuracy increases by
approximately    to        this result stays
consistent when different mixes of testing and
training sets are used  and therefore
demonstrates a clear pattern  the reason for
the polynomial fit performing worse than the
nave bayes during independent testing is likely
due to the fact that the polynomial fit is an
estimate attempt  rather than a calculated
probability  therefore applying nave bayes
probability logic is not quite appropriate  once
combined with food type in the logistic
regression  the theta values compensate for any
offset error in probability estimate and the
polynomial fit works better 

the project shows that by properly applying
machine learning techniques to historical new
york city health grade information  a person
can predict the grade of an ungraded restaurant
with about     accuracy by only knowing the
restaurants zip code and food type 
references 
new york state department of health  zip
code definitions of new york city
neighborhoods 
http   www health ny gov statistics cancer regi
stry appendix neighborhoods htm
ng  cs    class notes  cs    stanford edu 
nyc open data   restaurant inspection
results   https   nycopendata socrata com 

in addition to zip code and food type  other
feature combinations were tested to confirm
that the assumptions about correlation and
accuracy are valid  the results show that zip
code and food type perform notably better than
any other combinations  including combining all
features   for example  food type and name
 

fi