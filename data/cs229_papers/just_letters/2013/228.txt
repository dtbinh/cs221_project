 

better diagnosing narcolepsy
cibele halasz and preeyanka shah
department of electrical engineering
stanford university
stanford  ca      
email  cibelemh stanford edu and psk  stanford edu

f

abstractnarcolepsy is a sleeping disorder that affects approximately
  in      people in the united states      it is difficult to diagnose
because its symptoms resemble those of other diseases and because
signals collected during sleep studies such as eegs  ecgs  emgs
have to be manually inspected by humans during the diagnosis process 
in this project  we set out to determine what features can be used
to classify narcolepsy based on hypnograms and what is the overall
error rate based on a requirement of no greater than    type i error 
we determined that useful features that can be incorporated into a
machine learning based model include the presence of sleep onset rem
 sorem   the percentage of transitions from stage   to rem sleep 
awake to rem sleep  awake to nrem stage   as well as percentage
of total sleep time in nrem stage   sleep  for the majority of the
model development we used support vector machines for classification 
using    fold cross validation  we report       overall mean error and
additionally type i mean error of       and type ii mean error of       

 

i ntroduction

narcolepsy is a neurological disorder in which the brain
is unable to regulate sleep wake cycles normally  people
with this condition experience disturbed nocturnal
sleep and abnormal daytime sleeping patterns  such
symptoms manifest themselves as mental cloudiness 
memory problems  lack of energy  depression  cataplexy
and sleep paralysis      narcolepsy is a fairly rare disease
and it is difficult to diagnose because its symptoms can
be mistaken for symptoms of other diseases     
patients with suspected sleep disorders undergo
sleep studies or nocturnal polysomnograms where
they are monitored using several different types
of signals  information about a persons sleep
behavior can be obtained by from recording
brainwaves  electroencephalogram or eeg   eye
movements  electrooculography or eog   muscle tone
 electromyography or emg  and heart rate ecg  
    by visually scoring the eeg  eog  and emg  a
hypnogram can be manually produced from these
signals  hypnograms are graphs that represent the
stages of sleep as a function of time usually with   
second precision  certain frequencies displayed by
eegs  eogs and emgs are characteristic and determine

what stage of sleep or wake the subject is in 
given that the most common method for diagnosing
narcolepsy is through manual analysis of the sleep
signals discussed above  it is a fairly labor intensive
process  one question that has arose in the sleep
disorder field is whether machine learning techniques
can be used to automate the diagnosis process to some
extent  for the scope of this project  we focused on
examining whether hypnogram data can be used to
better predict narcolepsy using classification algorithms 

 

r equirements

of

p roject

the main goal of this project is to develop an algorithm
that predict whether a patient has narcolepsy based on a
hypnogram collected during a sleep study  the specific
requirements are as follows
 the features used in model fitting have a clinical
basis
 the algorithm diagnoses narcolepsy with high
specificity  there should be less than    false positives 
 specificity should be priorized over sensitivity  it is
acceptable to miss narcoleptic patients 

 

dataset

our data set comprised of     narcoleptic patients
and     control  non narcoleptic  patients  the    
narcoleptic patients are from   cohorts  a stanford sleep
study and   xyrem  a drug that treats narcolepsy 
studies  the     non narcoleptic patients from the a
wisconsin sleep study cohort 
all data was provided by the stanford center for
sleep sciences and medicine and was fully deidentified
before being worked with 
datasets
winsconsin non narcoleptic 
sxb   narcoleptic 
sxb   narcoleptic 
stanford clinic narcoleptic 

data size
   
 
   
  

fi 

the hypnogram signal traditionally has    second
precision and   different stages which is seen in figure   
sleep stages
artifact nan 
awake
nrem 
nrem 
nrem   deep sleep 
rem

value
  
 
 
 
 
 

fig     presence of sorem in a patient 
fig     raw hypnogram



   

feature development

one of the major areas of this project was feature
development and selection  given the ultimate
goal of enabling physicians to use this work in
clinically diagnosing narcolepsy  all features had to be
understandable by clinicians 
the approach to feature development that we took
was to extract ideas from papers discussing the impact
of various sleep disorders on sleep patterns and
converting them into features             
in addition to sleep onset rem  sorem  which is
a binary signal denoting whether rem sleep occurred
in the first    minutes of falling asleep  other features
included transitions between various states  average
duration of a rem stage in the first and second half of
sleep and percentage of sleep time in each stage 

number of transitions from one stage to another
length of a segment within a specific stage

one issue of consideration was how to clean up the
data  in the process of analyzing the data  three outliers
were removed from the data set 
although a spike in stage for one or two cycles
was likely to be noise  it is also known that narcoleptic
patients display fragmented sleep including rem sleep 
    hence in the process of denoising  meaningful
information could be removed 
ultimately a second set of features was developed
based on a mode filtered signal  a   window mode
filter was selected because it would remove   and  
cycle outliers but keep longer term fluctuations that
may represent information  a mode filter was selected
over a mean or median filter is that each sleep stage can
be considered a different category that are not perfectly
ordered 
from that we were able to extract    features  they

in order to better understand the importance of
each feature we plotted histograms of the distribution
of each feature as well as the distribution conditional
on whether a patient had narcolepsy was present or
not  in figure    the specificity of sorem in diagnosing
narcolepsy is clear 
based on conversations with emmanuel mignot  a
leading narcolepsy researcher  to determine features
other than sorem  we removed the first    minutes of
data 
generally speaking  the features fell into several
different categories 
 total sleep
 presence of sorem
 percentage of time spent in a stage

fig     raw and smoothed hypnogram waveform
account mainly for the number of transitions into rem 
time spent in different stages of sleep  the percentage of
time spent in those stages  the number of segments for

fi 

   

feature selection

to select the     best features from an original list of
    features  we used forward sequential search using
svm models with    fold cross validation  we used the
following criterion that needed to be further reduced 
c   w   etypei   w   etypeii
we consider type i errors as incorrectly predicting a
patient as narcoleptic when they are not and type ii
errors are predicting that a patient is not narcoleptic
when in reality  they are  for this specific problem 
reducing type i errors was more important 
   
fig     percentage of time spent in nrem sleep in
smoothed waveform
each of the stages of sleep 
for training  all the features were normalized such
that all entries ranged between   and   

 
   

m ethods
machine learning algorithms used

all development was done in matlab 
for most of training  testing and the majority of
the time spent in model development  we used the
liblinear library to implement l  regularized l loss support vector classification within matlab     
this specific implementation minimizes the following
objective


i
  t
q 
   et  s t       i    
min  
  
 c

validation

to validate our model  we reported the average error
as well as type i and type ii error across    fold cross
validation using the selected features  given the small
dataset  we did not leave out data to test on at this time 
although overfitting did exist  it was minimized as all
model selection and validation was done using    fold
cross validation  however  as the work is taken farther 
we could test the model on unseen data 

 

r esults

and

d iscussion

in the methods section of the paper  we discussed using
a weighted sum of errors in order to fit the model 
the process of finding optimal weights was important
in order to ensure that type i errors remained below
   during the process of reducing overall errors  in
this scenario we found that weighing each type of error
equally provided the optimal outcome which is clear in
figure    however  if the ratios of narcoleptics and nonnarcoleptics in the original data set were different  the
weights may have needed to be tuned differently 

the first thing that was done was determining
appropriate weights for our criterion so that type i
errors would remain under    but that overall error
would also be minimized 
using the found weights  feature selection was done
using forward sequential feature selection and using the
svm classification method described below  in forward
sequential search  a single feature is used to predict the
data  then an additional feature is added to the model
and whichever feature reduces the criterion the greatest
is added to the model  this process is iterated until
the criterion is no longer reduced by the addition of
additional features 
after feature selection  we tested the accuracy of
models based on svm  naive bayes  random trees 
neural network and logistic regression model using
the validation process described below 

fig     error rates versus ratio of w  versus w 
using forward sequential feature search  the   features that were found to be most relevant in predicting

fi 

narcolepsy with high specificity were the following    in
figure    we display the decrease in error during each
iteration of the forward sequential feature search  the
features below are presented in order of being added to
the model 
 sorem present
 percent transitions from stage   to rem
 percent transitions from stage   to rem in the
smoothed signal
 percent transitions from stage   to rem
 percent time spent in nrem   sleep
 percent transitions from stage   to  

    assessing different machine learning algorithms
in addition to using a model trained using support
vector machines  we also explored other machine learning algorithms  the results for different algorithms are
summarized below 
algorithm
svm
naive bayes
neural net 
rand  forests
log  regress 

  type i
error
    
    
    
    
    

  type ii
error
     
     
     
     
     

  overall
error
    
     
     
     
    

initial trials had suggested that an svm based model
would have the lowest error  after selecting features 
we were able to validate that assumption  although
logistic regression shows a lower type ii error  its
average overall error is slightly higher  however  given
that it is significantly easier and faster to implement  it
is a viable alternative 

fig     feature search error   l  regularized l  loss svc
to determine whether the numbers reported were
valid and consistent based on the an individual index
selection used for k means cross validation  we ran the
algorithm    times to better determine the stability of
the error values  with the l  regularized l  loss support
vector machine classification model  we reported a mean
error of       with a standard deviation of       

in the future  we plan to test the model against
unseen data  however  we foresee limitations in the
model in that we may have been working with biased
data  all of our controls came from a single cohort 
as can be expected  many of them likely had another
sleep disorder and furthermore it is known that the
wisconsin sleep study cohort is not diverse  age wise 
hypnograms can change significantly with age and
hence  it will remain to be seen whether our model can
be generalized and scalable  however  we have high
hopes that at least some of the features will provide
meaningful information in predicting narcolepsy 
it is important to mention that hypnograms are
hand scored by a technician through the analysis of
the eeg  eog  and emg signals  this means that
although the hypnogram requires less preprocessing  it
is susceptible to human error 

 

c onclusion

and

f urther w ork

preliminary testing suggests that we have achieved
our goal of using machine learning classification for
predicting narcolepsy with high specificity 

fig     stability of    fold cross validation error across ten
trials
   percent transitions are taken over total number of transitions in
hypnogram

the svm classification based model shows the most
promise in correctly classifying narcolepsy within
clinical studies  for this method  we were able to
achieve a       type i error which is within the
specifications of the stanford center for sleep sciences
and medicine and an overall error rate of       
although there is some over fitting  these are issues
that can be resolved once we have validated our model
on new  more diverse clinical data  nevertheless  our
project was able to achieve the goals it had set out
on and provides a solid basis for further research in

fi 

automating diagnosis of narcolepsy 

acknowledgment
we would like to acknowledge emil munk and emmanuel mignot of the mignot lab at the stanford center
for sleep sciences and medicine 

r eferences
    what are the signs and symptoms of narcolepsy 
 online   available  http   www nhlbi nih gov health healthtopics topics nar signs html
    how
is
narcolepsy
diagnosed 
 online  
available 
http   www nhlbi nih gov health healthtopics topics nar diagnosis html
    overnight 
attended
sleep
study 
 online  
available 
http   stanfordhospital org clinicsmedservices clinics sleep test overnightattended study html
    p  drakatos  a  suri  s  e  higgins  i  o  ebrahim  r  t  muza  c  a 
kosky  a  j  williams  and g  d  leschziner  sleep stage sequence
analysis of sleep onset rem periods in the hypersomnias  journal
of neurology  neurosurgery   psychiatry  vol      no     pp         
     
    j  harsh  j  peszka  g  hartwig  and m  mitler  night time sleep
and daytime sleepiness in narcolepsy  journal of sleep research 
vol     no     p            
    i  marti  p  o  valko  r  khatami  c  l  bassetti  and c  r  baumann 
multiple sleep latency measures in narcolepsy and behaviourally
induced insufficient sleep syndrome  sleep medicine  vol      no     
pp                 
    c  h  schenck and m  w  mahowald  motor dyscontrol in narcolepsy  rapid eye movement  rem  sleep without atonia and rem
sleep behavior disorder  annals of neurology  vol      no     pp 
          
    r  e  fan  k  w  chang  c  j  hsieh  x  r  wang  and c  j  lin 
liblinear  a library for large linear classification  journal of
machine learning research  vol     pp                 

fi