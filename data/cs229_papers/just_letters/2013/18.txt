dynamic feature extraction from molecular mechanics trajectories
han altae tran  muneeb sultan  vijay pande
december         

introduction

methods

with the recent advancements in distributed computing  it
is now possible to simulate molecular dynamics of large systems over unprecedented time scales  however  due to the
sheer size of the generated trajectories  it is no longer possible to reliably extract relevant chemical and biological information from a simulation through visual inspection alone a single trajectory alone may consist of well over a thousand
of atoms  charted over hundreds of time points  currently 
markov state models are being used to compute a discretization of the conformational space of large proteins  however 
one current challenge lies in understanding the transitions between the states  to address this problem  we consider restoring the dynamic systems perspective and look for methods
capable of detecting transition mechanisms in this context 
since physical interactions between atoms are typically proportional to distances between corresponding atoms  we are
particularly interested in analyzing pairwise atomic distances 
unfortunately  the space of pairwise distances scales with the
number of atoms squared  it is therefore desirable to develop methods that reduce the dimensionality of the space
into readily interpretable coordinates that largely account for
variations in the data 
while offering a promise of fewer dimensions  conventional
methods  such as principal components analysis  pca   often produce difficult to interpret coordinates  as each of the
coordinates mixes a significant number of atoms that makes it
difficult to definitely attribute motion along a principal component to motion in real space  furthermore  the assumption
of linearity is weak in the context molecular dynamics  similar problems arise for factor analysis  finally  many of these
techniques are not readily applicable to time series data because measurements taken close in time cannot be considered
independent samples from the distribution of atomic configurations 
here we seek to address this issue by proposing an unsupervised feature selection method for a system of time series
that incorporates basic time dependent relationships within
the system  for the application  we will be working with pairwise distances from single molecular dynamics trajectories 
however  this method should be applicable to other feature
spaces and possibly other fields 

consider a system of n possibly related processes  such as the
set of pairwise distances in a protein  where the relationships
between the processes are undetermined  and could possibly
depend on time and or the state of the system  however  for
a narrow time range  and small set of system states  it may be
possible to uncover basic relationships between the processes
in this limited domain of operation  in the context of large
scale transitions between states in a system  we are therefore
interested in detecting processes that exhibit anomalous behavior in the beginning or even possibly before a large scale
transition of the system  one possibility for detecting this
type of relationship involves lagging one process relative to
another and computing a heuristic that determines whether
the first process exhibits anomalous behavior that is followed
by anomalous behavior in the second process  essentially providing a notion of directionality between the two processes 
arguably there are other methods for detecting such variation within a system  with principal components analysis
being one of the more famous examples  however  many of
these methods are not catered toward time series data and do
not necessarily address the issue of detecting anomalous behavior that proceeds transitions  we will save this discussion
for the end 

directionality measure


 
consider a sample of the n processes  xtik i       n   over the
equally spaced times t            ttf   because we are interested
in anomalous behavior  deviations from standard behavior  
we mean subtract each of the sampled processes using a moving average of global parameter   the moving average is
essentially a causal smoothing filter applied to the data set
 causal meaning that only time points behind a given time
are included in the smoothing   denote the moving

 ff average
subtracted sampled processes as y itk   xtik  xi t   where
k

 iff
x t is the moving average of xtik with parameter   a
k
moving average is preferred over a complete average because
despite being constrained to a limited range of operations 
the processes might posses time dependent average values 
for an example  consider two atoms that suddenly move close
together at some time tk and remain fixed around this new
distance for the remainder of the sampled times  further department of chemistry  stanford
 department of chemistry  computer science  and structural biolmore  this allows a more natural comparison between rapid
ogy  stanford
switch like motion and step like motion  e g  the previous
 

fi 
 
example  
reversible  therefore ij    when the the cij
    and cji
   
with mean subtraction in place  we can now consider the are uncorrelated  or even anti correlated which implies strong
cross correlation between two sampled processes  x i and x j   irreversibility   together  these two factors help ensure that
the cij are meaningful 
cij       y i   y j    
we can now proceed to define the directionality between

j
i
x
y
tk and ytk as
ytik ytjk  
zij   cij ij ij
k 

which sets up a relationship structure between the n processes that we can proceed to analyse  however  a potential
problems might arise at this stage  and we address a few of
them below 

where we have defined ytik     when k 
              tf    in the
idealized continuous setting  the cross correlations amounts to
j
the integral over t of yti yt  
  which computes the overlap bei
i
tween yt and yt when the latter is lagged in time by the
amount    we create
function 
fi   afi normalized cross correlation
 
cij
    so that ficij
   fi    for all   and cii          for all
i  this ensures that cross correlations of different pairs i    j 
and i    j  are more naturally comparable  now  given two
processes  i  j   we would like to define a notion of directionality  zij   between the pair  we will base the idea on the max
one sided cross correlation 
fi  
fi
cij   max ficij
   fi

noisy data

if the sampled processes are especially noisy  the cross correlation will be as well  it might be necessary to smooth
 
cij
    with a moving average of window h  this will prevent spurious maxima
appearing  the idea being that
fi   from
fi
 ij   arg fimax  fi ficij
   fi represents the location of true max 
imum of ficij
   fifi if neighboring
values of   also demonstrate
fi
  
 
   fi  note that we are not necessarily
large values of ficij
interested in determining a lag time  ij   that gives a definiwhich is maximum possible correlation between ytik and ytjk
tive time delay in the relationship between the two processes 
when the former is lagged in time  the core idea is that if
first off  a constant time delay between the two processes
both ytik and ytjk display anomalous behavior  a lagged ytik
may not be adequate in describing the relationship  morej
j
should substantially overlap ytk if ytk displays this behav  over  we are more interested in the question of whether or
ior behavior before ytjk does  however  using cij to describe not y i proceeds y j   which can be dealt with here without
tk
tk
the relationship structure between the sampled processes will explicit reference to lag times  as a result  smoothing the
lead to many problems  the first is the lack of distinguish  cross correlation function poses no significant difficulty to the
able directionality between sampled processes   the difference task at hand 
between cij and cji may be small even if cij is large  this
reflects an overall inability to distinguish between the two nohigh dimensionality
tions ytik proceeds ytjk  denoted ytik  ytjk   and ytjk  ytik  
furthermore  there is the added problem of spurious noise another issue might arise when we n is very large  as comalignment  whereby noise from two series line up in one lag puting zij requires o n  tf   calculations  if we have a prior
direction  but not the other  lastly  there is the problem of notion of when some of the yti do not contribute to system in
k
correlated motion giving rise to large cij   cji   and  cij  cji    the domain of operation  then we can remove these sampled
to address these issues we introduce two multiplicative fac  processes from the analysis  in the context of molecular metors for cij  
chanics  such a notion would be encapsulated in the idea of
ij    cij  cji  
a stationary  low variance sampled process  as such a process
would not be changing throughout the domain of operation
and

 
 
 
 and is hence a constant along the domain   this is not to
ij      corr  cij      cji    
say it is not useful in the system as a whole  just that it
where corr  indicates the standard linear correlation over    does not contribute in the context of dynamics in the queried
the first factor quantifies how lopsided the difference between domain  for example  distances between covalently bonded
the two notions  ytik  ytjk and ytjk  ytik   are  therefore  atoms usually do not contribute significantly to a conformaif ij     then the cij   cji pair is a non trivial comparison  tional change in a protein  since this is structurally fixed 
note that this factor substantially reduces cij between two one way to quantify this notion is the use of a signal energy 
processes that are highly correlated at low lag time  in the high signal energies of mean subtracted processes typically
context of molecular mechanics  this amounts to reducing the correspond to high amplitude oscillations  and hence signify
effects of atoms that consistently move together  ij   on the a non constant signal  one last point should be made that in
other hand  determines how dissimilar ytik  ytjk and ytjk  the context of molecular mechanics  distances between atoms
 
ytik are in the context of all possible lag times  if cij
     matter  an oscillation of   angstrom between atoms that
 
and cji     are highly correlated  then increasing lag times are     on average angstroms apart is not nearly as impor 
 
produces the same type of change in cij
    and cji
     which tant as an oscillation of   angstrom between atoms that are
j
j
i
imply that the two notions ytk  ytk and ytk  ytik are   angstroms apart  to account for this  we define a relative
 

fi  since the ith row of z represents the outflow of the ith
node   zz t  ij is the shared outflow of the ith and j th nodes 
similarly   z t z ij is the shared inflow of the ith and j th
nodes  the symmetrization z sym therefore relates two nodes 
i and j  if they exhibit highly shared flow to the rest of the
graph  even if they do not exhibit flow between them 
sym
the resulting symmetrization zij
can be used as a similarity matrix for a symmetric weighted graph clustering problem  various clustering techniques exist  such as the ubiquitous k means clustering  however  here we are interested
in finding connected components in the z sym induced structure  rather than centroids because not all nodes in a cluster
need to be closely related to one another for the nodes as
a whole to represent a distinct concerted motion within the
system  to achieve this  we make use of a technique called
spectral clustering  which projects the data into a lower dimensional subspace using the eigenvectors of the normalized
graph laplacian matrix  and then clusters the nodes in the
reduced dimensional space using k means  if the graph is split
into many disconnected components  the graph laplacian will
be roughly of block diagonal form  and consequently its eigenvectors will have nonzero entries corresponding to combinations of the blocks  the nodes in the lower dimensional space
are then separated according to the disconnected component
they belong in  therefore  disconnected components within
the graph may be detected using spectral clustering  resulting
in k clusters q            qk  

fluctuation  given by
ytik  

ytik
hxi itk

which weights the mean subtracted sampled process at a
time tk   
ytik   ffusing the sampled process mean estimate at
time tk   xi t   sampled processes with large deviations
k
relative to the mean estimate have large relative fluctuations 
small relative fluctuations amounts to little relative motion 
in the context of molecular mechanics  the latter is seen in
the distances between structurally stable components  to
quantify the presence of large relative fluctuations in a given
process  ytik   we compute the signal energy of the relative
fluctuations  which we call the relative fluctuations energies 


ff
ei   ytik   ytik

x
fi i fi 
fiyt fi
 
k

k 

and then place a cutoff on these energies depending on
which sampled processes one is interested in keeping  once
can then curate a training set of sampled processes to keep
and sampled processes to discard and use a logistic regression
trained on this set to automatically keep or discard each of
the remaining sampled processes 

analysing the directionality structure
the structure imposed by the zij can be thought of in the
context of directed graphs  where zij and zji provide the two
asymmetric weights between the ith and j th nodes  sampled
series   the usefulness in this interpretation of the zij lies in
graph partitioning  whereby we split the directed graph into
representative subgraphs  each of which represents some distinct source or destination of motion within the system under
the limited domain of operation  to make this explicit  let
z be the adjacency matrix formed by zij   zij   if we are
interested in partitioning the graph described by z into k
representative subgraphs  roughly  we would attempt to pick
k subsets of the n nodes that maximize the flow  directionality  across these subsets  in the more usual language  we
seek k clusters of the n points  sampled series   unfortunately much of the modern clustering work addresses symmetric directed graphs  where the weight between two nodes
can be likened to a distance  while there are methods for
clustering asymmetric weighted graphs  we will instead take
the approach of graph symmetrization which will allow us to
use the more familiar methods on some symmetrization of z 
the most common symmetrization is z   z t   which essentially ignores the directed structure of the original graph by
averaging zij and zji to form the symmetric weights between
the ith and j th nodes  in the context of the above directionality measure  this is not a particularly helpful symmetrization 
though it is widely used for other problems  a less commonly
found symmetrization is the bibliometric symmetrization 

cluster aided feature selection
finally  we would like to select representatives from each of
the clusters q            qk to constitute a reduced set of features
that explains the different types of directed motion within
the system in the domain of operation  here we seek to optimize some function f  i   i  qq for each cluster qq   with
arg maxiqq f  i  corresponding to the representative node iq
of qq   depending on the goals  e g  detecting sources vs
destinations etc    different choices of f may be made  such
as letting f  i  be the eigenvector centrality of the ith node
in z sym    for our purposes  where we are looking to detect
sources of motion  we take f to be the influence of node i
on the graph  that is the difference of squared outflows and
inflows  that is
f  i   

n
x

 
 
zij
 zji



j  

which rewards large outflow and penalizes large inflow 
while neglecting small inflow outflow that might not substantially affect the relationship of the ith node to the system as
a whole  finally  we select the representative nodes  iq   using
by maximizing f over the clusters qq   and order the iq in the
order of decreasing f  iq    the top representative nodes are
therefore those that represent the most substantial sources of
motion within the system  we now proceed by testing the
effectiveness of this method on molecular mechanics data 

z sym   zz t   z t z
 

fifigure    heatmap of the spectral clustering results  the
 i  j th entry corresponds to the directionality measure zi j
between the i th pairwise distance and the j th pairwise distance  the two clusters with high outflow relative to inflow
are boxed 
figure    results of cluster based feature selection  a b 
application to molecular mechanics time series plots of the top two pairwise distances scored
by d   f  i   c h  top two pairwise distances are mapped
here we present an application of the above unsupervised onto the ubiquitin structure at the given time indices  the
learning method to a simulated transition between the      intial ubiquitin up state is shown in c   with the final ubiqregion  residues       up state and down state of ubiquitin uitin down state shown in h   the red and blue asterisks
 see fig  c  fig  h for the up state and down state respec  shown in a  and b  occur at the times represented by e  and
tively   to reduce the initial dimensionality  we only consider f  respectively 
the alpha carbons  backbone carbons  within the protein 
the space of all pairwise distances between alpha carbons
 i j 
is then considered  where a sampled process  ytk   is now two distances are mapped to the cartoon representation of
the pairwise distance between the alpha carbon of residue i the structure at various times during the transition in figure
       
and the alpha carbon of residue j computed at time tk   rela    c h  what ytk
reveals is the preparatory rearrangement
tive fluctuations energies are calculated and used to filter out of the loop region below alpha helix   the loop moves down
pairwise distances that are relatively constant  and the noisy starting at index     and reaching a maximum distance from
data protocol of smoothing of the cross correlation function the      region at time index     this is followed by an
by a window of    frames is employed to reduce the effects of extremely rapid increase in yt       
at index     which can be
k
thermal noise on the cross correlation function  zij is then contextually understood as the rapid expansion of the alpha
computed and symmetrized to form z sym   which is then split helix  this event is followed by a rapid contraction of the
into k      groups using spectral clustering  the results of alpha helix at index     after which the system settles into
spectral clustering can be seen in figure    which is a heatmap the down state conformation  the top two selected pairwise
of zij arranged by cluster  notice that there are only two clus  distances therefore capture anomalous behavior that proceeds
ters with high outflow compared to inflow  and two notable the system transition 
clusters with higher inflow than outflow  while the remaining
regarding the number of clusters  k  when we use k  
  clusters are relatively inactive  therefore  in the context              the single top pairwise distance is consistently
of this clustering  we consider the top two pairwise distances 
       
ytk
 which will follows from how we determine the iq   
as these correspond to the two clusters that are  in the netwhile the second pairwise distance is either the distance from
work sense  sources of motion  we use f  i  to select the repthe   sheet to the tip of the alpha helix  or the distance from

 i j 
resentative pairwise distances  ytk q from each cluster qq   the end of the alpha helix to the tip of the alpha helix  i e 
q              k  the top two representatives are the distance the alpha helix length   in either case  both of these latter
       
between lysine   and leucine    ytk
   and the distance two distances captures the expansion contraction event of the
       
between threonine   and threonine    ytk
   shown in alpha helix 
figure   a b  the implicitly sought after anomalous behavior
retrospectively we may also investigate the effectiveness of
for the two pairwise distances are shown with asterisks  the zij in inducing a directionality structure between the pairwise
 

fifigure    directionality measure between pairwise distances
expected to have high directionality  red  and between pairwise distances not expected to have high directionality  blue 
computed for different moving average window sizes 
distances  evidently  the loop below the alpha helix moves
before the alpha helix does  which  truth be told  was not
obvious by visual inspection alone  we should therefore ex       
       
pect the notion ytk
 ytk
to be stronger than the
       
       
opposing notion ytk
 ytk
  furthermore  there is
an unconstrained loop with very high positional variability
present in the simulation  and we do not expect the tail end
of this loop to contribute much to the transition  nor do we
expect the transition to much affect the behavior of the loop 
       
to quantify this we introduce ytk
  which measures the
distance from the base of the loop to the end of the loop 
       
       
       
       
and examine ytk
 ytk
and ytk
 ytk
 both
of which should correspond to low directionality measures  
to test that our directionality measure faithfully reproduces
these relationships  we compute zij for these comparisons 
for a variable moving average window size    the results
are plotted in figure    notice that regardless of the window size  z                  z                  which tells us that we
can accurately reproduce the notion that anomalous behavior
       
       
ofytk
proceeds that of ytk
  furthermore  note that as
expected  the unconstrained loop exhibits low outbound or
inbound directionality 
for future work  we will consider using functional atoms
on amino acid side chains  rather than just alpha carbons  
granting us a view into the mechanistic structures that underlie conformational changes  furthermore  we might consider training our directionality measure on synthetic data of
known lag times to obtain a more discriminative directional 
ity measure of the form zij   cij  ij  ij
  where the k are
parameters to be trained 
we close our discussion with a brief comparison to pca
 which is actually used quite frequently in the context of
molecular mechanics   once again  we consider the set of
 i j 
processes  ytk   treating each  i  j  as a dimension  and each
 i j 
ytk as an observation for the dimension  i  j   we then
proceed by performing pca on the time pooled data where
each dimension  i  j  is now populated by the sample points
 i j 
 ytk   k              tf    the results are shown in figure   
as expected  pca is unable to even detect the transition 
as the data points are not separated in time when projected

figure    first two principal components of the simulated
ubiquitin transition  the color of the points transitions from
black to blue along the simulated protein trajectory
to this reduced dimensional space  instead  pca explains
the difference between the up state and down state  without
regard to intermediate states   as well as the motion of the
unconstrained loop  the method we propose  on the other
hand  is more explicitly equipped for time series analysis and
irrelevant motion  consequently  it is relatively successful in
elucidating the types of motion that occur during system level
transitions  moreover  this method is at the heart a feature
selection technique  and therefore does not mix any of the
coordinates  this is important because it allows us to determine functionally relevant atomic pairs  in the context of
other proteins  this might provide information regarding a hydrogen bond  or a salt bridge  that is critical to a particular
conformational change  with additional refinements refinements  this method might even be helpful in understanding
the transitions between protein conformations in a setting 
such as drug development  where innumerable protein transitions need to be understood by a small number of researchers 

references
    satuluri v  parthasarathy s symmetrizations for clustering directed graphs  proceedings of the   th international conference on extending database technology 
              
    zhang y  zhou l  phillips ah  et al  conformational stabilization of ubiquitin yields potent and selective inhibitors
usp   nat chem biol                 
    teodoro ml  phillips gn jr  kavraki le understanding protein flexibility through dimensionality reduction  j
comput biol                      
 

fi