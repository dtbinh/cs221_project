max margin models for rna secondary structure prediction

clara fannjiang

   introduction
rna was first explored and understood as a messenger molecule  relaying dna encodings of amino acids
during protein synthesis  beyond messenger rna 
however  a class of rna known as non coding rna
plays fundamental roles in transcriptional and translational gene regulation  as the biological mantra goes 
form fits function  and these regulatory roles depend
on the   d structure of the rna molecule  the   d
structure is largely induced by the secondary structure 
or the base pairs of the rna sequenceunlike dna 
whose complementary strands are fully paired  rna is
single stranded and displays complex patterns of basepairs  as empirical methods for finding rna structure  such as crystallography  are time consuming and
involve expensive equipment and expertise  computational methods for predicting rna secondary structure
are of great value to the study of non coding rna 
     rna secondary structure prediction as a
structured prediction problem
since each base in a sequence can only pair with one
other base  it is natural to model rna secondary structure as a graph matching  each node of the graph
corresponds to a base  and each edge corresponds to a
base pair that exists in the secondary structure  given
an rna sequence  or the nodes of a complete graph
where each edge corresponds to a possible base pair  we
approach secondary structure prediction as the problem of deducing the true matching  biologically speaking  the true or most stable secondary structure is the
one that minimizes free thermodynamic energy  to
incorporate this concept into the graph model  we design some scoring function over all possible matchings 
such that a higher score corresponds to a more stable
secondary structure  finding the true secondary structure is then be equivalent to finding the matching that
maximizes the scoring function 
rna secondary structure prediction is thus an instance
of a structured prediction problem  structured prediction arises when we predict not a single label  but
rather a set of many interdependent labels  a structured prediction problem involves a scoring function

clarafj stanford edu
over a set of combinatorial structures  as well as a
tractable method for the finding the structure with the
maximum score  in our problem  we predict a binary
label for each edge in the complete graph  where a label of   means that base pair exists in the secondary
structure and a label of   means it does not  label
interdependence arises not only from the matching constraint  but also from local interactions between basepairs that occur in common structural motifs  we hope
to solve our structured prediction problem by learning
a max margin model  a generalization of the support
vector machine  svm  
     max margin models for structured
prediction  mmsp 
the intuition behind an svm is to learn the decision
boundary that maximizes the separation between different labels  as a generalization  a max margin model
learns a scoring function that maximizes the separation
between the score of the true structure and the score
of any other structure 
let
s x be the space of rna sequences and let y  
xx y x  be the space of possible secondary structures  where y x  is the space of possible secondary
structures  or graph matchings  for the sequence x 
x   we parameterize the scoring function s x  y  as a
linear combination of n features  such that s x  y   
w  f  x  y  where f   x  y  rn is the feature
function  given m training instances  x i    y i     i  
           m  our constrained optimization problem is
 
min   w   
w  
s t  i  y  y x i    
w  f  x i    y i     w  f  x i    y      y i    y 
where the constraints ensure that the margin of the
score of y i  over the score of any other structure y
is at least   y i    y   the loss of predicting y over the
desired y i    by adding slack variables  to ensure
that the constraints are feasible  and maximizing over
the possible structures to get a single constraint per
training instance  we have
x

min   w     
i
w   
i

fimax margin models for rna secondary structure prediction

algorithm   subgradient calculation for mmsp objective  from     
input  w    x i    y i    m
i         y  y  r  f   x 
y  rn  
initialize w     
for i     to m do
y i    arg max w  f  x i    y      y i    y 
yy x i   

w   w   f  x i    y i     f  x i    y i   
end for
 
w
w   m

s t  i 
w  f  x i    y i     w  f  x i    y i        y i    y i     i  
y i    arg max f  x i    y      y i    y  
yy x i   

where the regularization parameter  tunes the emphasis on maximizing the margin over obeying the constraints  since the constraints are active at the optimum  we substitute them into the objective to get the
unconstrained optimization problem min j w  where
w


j w      w     
 
x
 w  f  x i    y i        y i    y i     w  f  x i    y i     
i

distance between the two bases  the probability of the
base pair as computed by mfold  a model that approximates the free energy of secondary structures using
empirically measured energies of structural motifs  and
indicators on the identity of the two bases    bases are
a a     bases are a c             bases are u u    incorporating information from other predictors  such as
mfold  is not uncommon and is justified if the model
outperforms the input predictors       to calculate the
max score structure y for the mmsp objective subgradient in alg     we simply calculate the score of each
edge sedge  x  yj     w  fedge  x  yj   and run edmonds
blossom algorithm to find the max weighted matching
y  
we trained the single base pair matching model on
trainsetb  a set of      highly diverse rna sequences
and known structures designed in      the model was
tested on testsetb  a set of     sequences and structures designed in the same paper  we compared the
predictions to those made by mfold  one of the oldest rna secondary structure prediction methods  often seen as a baseline for performance  the mean
matthews correlation coefficient  mcc  of the predictions            beats the mean mcc of the mfold
predictions             where the mcc can be understood as the correlation between the true and predicted
binary labels on the edges 
tp  tn  fp  fn
m cc   p
 t p   f p   t p   f n   t n   f p   t n   f n  

   methods
     subgradient method for mmsp
we minimize the mmsp objective j w  using the subgradient method  a generalization of gradient descent
to non differentiable convex functions      gives alg 
  for calculating a subgradient of the mmsp objective  note that the algorithm involves computing the
max score structure y i    which becomes the bottleneck for implementation  we must design f  x  y  to
be complex enough  such that the scoring function
s x  y    w  f  x  y  captures the many factors involved in structure stability  yet it must be simple
enough that computing  or approximating  y i  is
tractable 
     single base pair matching
one of the simplest ways to parameterize s x  y  is
to define features fedge  x  yj   for each edge yj in the
matching y  and let the score of the matching simply
be the sum of the scores of the x
edges in the matching  s x  y    w  f  x  y    w 
fedge  x  yj    we
j

defined the features of an edge  or base pair  as the

where tp  tn  fp  and fn are the numbers of true
positive edges  true negative edges  false positive edges 
and false negative edges  respectively 
however  the single base pair matching model is inherently limited as it neglects how interactions between base pairs influence the stability of structures 
to incorporate such interactions  the scoring function
s x  y  needs to capture the scores of local structural
motifs  not just the scores of isolated base pairs 
one strength of the single base pair matching model
that the successor model lacks is that the calculation
of the max score structure y is both tractable and
exact  by making the scoring function more complex 
we forgo our ability to calculate an exact subgradient as
given in alg     and resort to a tractable approximation
instead 
     greedy stack matching  greedystacks 
a prevalent motif in rna secondary structures is
stacking base pairs  where base pairs form adjacent to
each other  analogous to the pairing of complementary
dna strands  stacking base pairs are key to the sta 

fimax margin models for rna secondary structure prediction

bility of rna secondary structures  and are the next
focus in enriching the scoring function s x  y   we redefine the graph model of the rna sequence  such that
each node represents two adjacent bases and each edge
represents a possible stack  or two adjacent basepairs  note that this model cannot express isolated
base pairs  which are rarely observed due to the stability of stacking  fig    illustrates how the stack
matching model expresses a sub structure 

figure    example of a stack graph matching  right  modeling a sub structure with stacking base pairs  left  

algorithm   greedy approximation of max score
structure
input  w   x  y       y  y  r  fstack  
define a complete graph where each node represents
two adjacent bases in x  and the score of each edge
m is sstack  x  m    w  fstack  x  m  
run edmonds blossom algorithm for the maxweighted matching m 
sort the edges m  m by decreasing score 

initialize the greedy approximation ygreedy
   
for each edge m  m do

if m does not conflict with edges in ygreedy
then


ygreedy   ygreedy  m
end if
end for

machine learning prediction methods  the probability
of the outer base pair as computed by contrafold 
and indicators on the identity of the bases in the
stack    bases are aa uu             bases are uu gg  
for computational efficiency  we eliminated all edges
in the stack graph involving non canonical base pairs 
or base pairs other than a u  c g  or g u 
objective throughout learning
  

j

note that the max score structure y is no longer the
max weighted matching  since a matching of the stack
graph may not be a valid matching of the single base
graph  once the ca ug stack exists in fig     for
instance  the adjacent ac node cannot be paired
since the a base has already been paired with the
u base  and similarly for the gu node   in fact 
as proven in      the calculation of the max score structure y i    arg max w  f  x  y      y i    y  is np hard
yy x i   
x
for f  x  y   
fstack  x  yj    we calculate the greedy
j

  

  

objective

here  a matching y represents the set of stacks in the
secondary structure  as in the single base pair matching model  we then define the features fstack  x  yj   for
each edge or stack  and let the score of a matching be
the sum of the scores of the
x edges in the matching 
 
 
s x  y    w f  x  y    w
fstack  x  yj   

  

  

  

  

  

 

   

    

    

    

    

    

    

    

iterations of subgradient method

figure    value of the mmsp objective through iterations
of the  approximate  subgradient method 


approximation ygreedy
described in alg    instead  and


replace y with ygreedy
in alg    

the features of an edge  or stack  are the distance
between the bases of the inner base pair  a lengthdependent intercept  bases
      where     was the maximum sequence length observed in the training set 
the probability of the inner base pair as computed by
contrafold  currently one of the best performing

     pseudoknots
here  we note that our graph model lends us a unique
advantage in rna secondary structure prediction  we
focus on structures that involve pseudoknots  a structural motif where base pairs are not properly nested

fimax margin models for rna secondary structure prediction
   

feature weights

   

   results
fig    compares the predictions made on testseta by
ipknot and greedystacks  and reveal that greedystacks slightly outperforms ipknot in mean f measure
as well as mcc  the sensitivity vs  positive prediction
value trade off  shown in fig     shows that though
greedystacks does slightly worse in ppv  it has an
almost     advantage over ipknot in sensitivity 

   
   
   
   
 

   

   

and cross over one another  fig      contrafold
and most other rna secondary structure prediction
methods are unable to express pseudoknots  as they
rely on the nested ness of base pairs to express structures recursively  pseudoknots have thus become
important special case of rna secondary structure
prediction  unlike contrafold  our stacked basepair matching model make no assumptions about the
nested ness of base pairs  there are no distinctions between pseudoknotted and non pseudoknotted edges in
the graph  to tune our model for pseudoknots  we train
and test greedystacks only on pseudoknotted structures and compare the predictions to those made by
ipknot  currently one of the best performing prediction methods for pseudoknots     

 

 

   

   

   

   

   

   

greedystacks mcc

figure    learned weights of the greedystacks features 

greedystacks fmeasure

ipknot vs  greedystacks on pseudoknotted structures

distance
ld intercept
contrafold outer
contrafold inner
aauu
acgu
agcu
aguu
auau
augu
caug
ccgg
cgcg
cgug
cuag
cugg
gauc
gauu
gcgc
gcgu
ggcc
ggcu
gguc
gguu
guac
guau
gugc
gugu
uaua
uaug
ucga
ucgg
ugca
ugcg
ugua
ugug
uuaa
uuag
uuga
uugg

   

   

   

   

   

 

   

   

   

   

   

   

   

 

 

   

   

   

   

 

ipknot fmeasure
greedystacks  mean            
ipknot  mean          
greedystacks  mean            
ipknot  mean          
y x

 
 

   

 

   

 

ipknot mcc
greedystacks  mean            
ipknot  mean          
greedystacks  mean            
ipknot  mean          
y x

figure    f measure  left  and matthews correlation coefficient  right  of testseta predictions made by ipknot and
greedystacks 

   future work
we are currently working on a model that incorporates scores over pseudoknots  not just scores over basepair stacks  again  there is no tractable algorithm like
the edmonds blossom algorithm for finding the maxscore structure in such a model  instead  we define the
scores over pseudoknots as higher order potentials over
a markov random field  then implement dual decomposition as described in     to approximate the maxscoring structure 

figure    example of a pseudoknot  where the a u basepairs cross over the c g base pairs 

we created the pseudoknotted trainseta and testseta by combining the three highly diverse sets cited
in      and randomly selecting     sequences for the
testing set 

the regularization parameter  in greedymatch also
has not been tuned  we are currently running   fold
cross validation to tune this parameter  which may further increase the accuracy of its predictions 

   acknowledgements
many thanks to my mentors cristina pop and chuansheng foo at the stanford ai lab for their guidance 

fimax margin models for rna secondary structure prediction

    taskar  b   chatalbashev v   koller    guestrin 
c          learning structured prediction models  a large margin approach  proc  of the   nd
icml          

 

   

   

   

ppv

   

   

   

   

   

   

 

 

   

   

   

   

   

   

   

   

   

 

sensitivity
ipknot sensitivity vs  ppv
greedystacks sensitivity vs  ppv
mean ipknot sensitivity          and ppv         
mean greedystacks sensitivity          and ppv         

figure    sensitivity vs  ppv of testseta predictions
made by ipknot and greedystacks 

references
    komodakis  n          efficient training for pairwise or higher order crfs via dual decomposition  proc  of the   th ieee cvpr            
    notredame  c   higgins  d g   and heringa  j 
        t coffee  a novel method for multiple
sequence alignments  jmb               
    ratliff  n   bagnell  j     zinkevich  m         
 online  subgradient methods for structured prediction  proc  of the   th aistats 
    rivas  e   lang  r   eddy  s          a range of
complex probabilistic models for rna secondary
structure prediction that includes the nearestneighbor model and more  rna              
    sheikh  s i   backofen  r   and ponty  y        
impact of the energy model on the complexity of
rna folding with pseudoknots  proc  of the     
cpm 
    sato  k   et al          ipknot  fast and accurate prediction of rna secondary structures with
pseudoknots using integer programming  ismb 
          

fi