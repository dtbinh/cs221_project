predicting mode of transport from iphone accelerometer data
ben nham  kanya siangliulue  and serena yeung

introduction
in our project  we present a method for offline classification of transportation modes from an iphone accelerometer 
our research may be useful for accurately predicting travel times  where automatically detecting transport mode can
be used as an input into a particle filter  or for automatically classifying and logging physical activity over the course
of a day as part of a fitness program  while there has been research into using multiple accelerometers to classify
physical activity            we are unaware of research into classifying transportation modes using a widely available
retail device such as the iphone 
we start by extracting various features from the raw accelerometer data  we then train several learning algorithms
on subsets of these features to generate a classifier that can reasonably distinguish between the different
transportation modes from the acceleration stream 

data collection

figure    accelerometer logging application
to collect accelerometer data  we wrote a custom application to sample the iphone s three axis       g accelerometer
at    hz while annotating the current transportation mode  as shown in figure    the device was placed in the
pocket of the non dominant hip of all participants to allow acceleration magnitudes to be compared across subjects 
to simulate real usage of the device  we placed no constraint on the orientation of the device in the pocket while
logging data 
in total  four participants gathered      hours of annotated acceleration data while walking  biking  running 
driving  riding trains  and riding buses  the first     of the dataset for each of the transportation modes was chosen
as the training set  while the remaining data was used as the test set  the datasets can be found on the project
website     

feature extraction
in past projects involving activity detection from accelerometer data  researchers mounted their accelerometers  and
other sensors  in fixed orientations at fixed spots on all participants  we decided to have participants place their
devices in their hip pockets  as this seemed like a natural location for storing a phone  however  we decided to relax
the constraint that the phone be placed in a particular orientation  face up or face down and rotated portrait or
landscape  to better simulate real usage of a phone  a subject would be unlikely to remember to place in their pocket
in exactly the same orientation every time they finish using it 

fithis made correlating axis information across samples difficult  as gravity could be pointing along different axes
depending on the orientation of the device in a given sample  we decided to solve this problem by first
preprocessing our data by collapsing the triaxial acceleration data over time into a vector of acceleration magnitudes 
this solved our orientation problem  but meant we could not directly use previous research the trained learning
algorithms on triaxial data     
we then split the magnitudes into windows of   seconds      samples  each  with each window overlapping the
previous window by      as previous studies found this to be an effective window size      a     point fft was
taken on each window  and the magnitude of the fourier coefficients stored in the final training matrix 

the figures above show a sample magnitude window  along with the mean of fft components across all
windows  from the fft plot  we can see that  at least on average  there are distinct frequency characteristics for
each transportation mode  running shows the highest peaks  corresponding to a higher energy signal  and a higher
fundamental frequency than walking  which makes sense since the pace and impact of running is generally higher
than with walking  both running and walking show many frequency peaks  probably from the multitude of
vibrations that occur when a shoe hits the ground with some force  on the other hand  biking and driving show much
lower peaks  as there is not the same style of impact in these activities  indeed  when driving  subjects usually stay
stationary  and even when a car is accelerating or decelerating  the acceleration is generally is quite smooth 
from these fft coefficients  we extracted the following     features 





the magnitudes of the     fft components
energy of the signal  squared sum of fft components  from parseval s theorem 
mean of the signal
variance of the signal

fiwe chose to additionally extract energy  mean  and variance
from the signal as previous research has showed that they
were significant features when using triaxial data      the
figures below show the distribution of energy  mean  and
variance are shown above  as in the fft plot  running shows
the most energy  mean signal strength  and variance  followed
by walking  biking  and finally driving 

gda results
walking

running

biking

driving

total

      

      

      

      

      

table    gda classification results
initially  we used gda to model the training
data as a     dimensional gaussian with unique
mean and covariance over the     fft
coefficients for each activity  when data from
all three training subjects were lumped together
and hold out cross validation was performed 
the subject independent test results were as
shown in table    walking and running
windows were classified correctly with
reasonably high accuracy  but driving and
especially biking had much lower accuracy 
after re running hold out cross validation on
each subject s data samples independently  we
found that gda predicted ben s motion
correctly        of time  pao s motion correctly
       of the time  and serena s motion
correctly        of the time  the poor
classification performance on serena was
caused by most of her biking windows being misclassified as walking  which also brought down the overall
accuracy of the algorithm  this made sense upon examining serena s average fft window above  which shows
significant overlap between the coefficients for biking and driving 

svm results
since most of the error in the gda model was due to its inability to separate out the differences between sets of
data that were also hard to separate by eye  we decided to try an svm with a higher dimension feature space  by
using a gaussian kernel  to try to better separate the data  we used libsvm with one vs one max wins voting for
multi class support    fold cross validation  and grid search through the parameter space  the constant cost c and the

figaussian parameter gamma  to achieve the results shown in table    in particular  serena s test accuracy improved
to a comparable level of accuracy as ben and pao  so there were no longer specific classification tests that resulted
in abnormally high error 
    components

    components

  components

train

test

train

test

train

test

ben

      

      

      

      

      

      

pao

      

      

      

      

      

      

serena

      

      

      

      

      

      

all

      

      

      

 

      

 

table    svm classification results
a confusion matrix for training and predicting on data from all subjects on all parameters is shown below  the
input test classes are shown on the rows  while the predicted classes are shown in the columns  of all pairs of
activities  biking and driving were confused the most  from the energy  mean  and variance graphs in the feature
extraction section  this seems reasonable since biking and driving are similarly low acceleration energy activities 
walking

running

biking

driving

walking

   

 

 

 

running

 

   

 

 

biking

  

 

   

  

driving

 

 

   

    

table    confusion matrix when classifying on all component
the difference between training accuracy and testing accuracy in table   when training on all     fft
components showed that the svm model was likely suffering from high variance and overfitting  the training
accuracy was substantially higher than the testing accuracy for the feature set of     components  and notably 
serena s originally low training accuracy  from the gda  was now fitted to an almost perfect         although
testing accuracy was only         this suggested that either more data or better feature selection might improve the
model  adding more training data was not achievable given the time constraints  so we focused more on feature
selection  in addition to the     frequency components  we added   more features  energy  mean  and variance which were found to be good predictors in previous studies that used more sensor data      we then used a libsvm
library that used an f score heuristic to choose between the     total parameters  the algorithm chose    
paramters from the      and the results are from training on these parameters are shown in table    we also tried to
train on only the energy  mean  and variance parameters to see if that would give  good enough  results so that a
classifier could be trained efficiently in real time  we had trouble with libsvm infinite looping on several
configurations indicated by the asterisk in the table 
choosing fewer parameters did narrow the gap between training and testing accuracy for ben and pao  but it did
not work well for serena and did not result in a significant improvement in accuracy  this may have been in part
due to the nature of the     components as essentially all part of a larger frequency category  so that there were only
  completely separate feature categories to start with  also  there were only   subjects with different gaits and data
distribution characteristics  i e  different frequency peaks   making it difficult to pick out the most important
frequency components from only these   distributions  sampling more subjects  so that there would be a more
normal distribution of gait and frequency characteristics  might have resulted in more informative feature selection 
and a consideration of other feature types  i e  frequency peaks  might have made feature selection more effective 
but we did not have the time to explore these aspects in the time allotted 

fifuture work
in this project  we were able to achieve reasonable accuracy training and testing on the same subjects  but we did not
look much into training on one set of subjects and testing on an unrelated subject  developing such a general
classifier would likely require significantly more data collected from a larger distribution of subjects  for future
work  we think it would be both interesting and useful to look into this problem  as it could be used to detect
activities out of the box in a consumer product  we also believe that collecting additional data and analyzing
features more closely could help further improve the accuracy of our model  as discussed above 

acknowledgements
morgan quigley of stanford helped us greatly by giving us the initial project idea  as well as mentoring us
throughout the project 

references
   bao  l   intille  s   activity recognition from user annotated acceleration data  in  proc proc  pervasive
             
   e  munguia tapia  s  s  intille  w  haskell  k  larson  j  wright  a  king  and r  friedman   real time
recognition of physical activities and their intensities using wireless accelerometers and a heart rate
monitor   in proceedings of the international symposium on wearable computers  ieee press       
   j  lester  t  choudhury and g  borriello   a practical approach to recognizing physical activity   proc 
 th int l conf  pervasive computing  pervasive      lncs       springer        pp      
    http   svn nhaminated com viewvc cgi project  root cs   
   n  ravi  n  dandekar  p  mysore  and m  littman   activity recognition from accelerometer data  in
aaai  aaai press       

fi