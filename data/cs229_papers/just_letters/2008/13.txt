computational gambling
konstantinos katsiapis

introduction
gambling establishments work with the central dogma of percentage payout  pp   they give back only
a percentage of what they get  for example they could return only     of the collective receipts but the
returns are unevenly distributed between the players  so some of them end up with huge winnings while
most end up with small loses 
we have at our disposal data of several shops  mini casinos  from different areas and countries  our
goal is to apply machine learning algorithms on the data and try to infer the effect of pp on the shop s
performance  we are interested in predicting performance indicators such as profit or actual percentage 

available data
at any given day  a shop is instructed to play at a specific pp  however there is no guarantee that the
actual pp will match the instructed one  this is largely due to the random nature of the games  which is
a desired property   and partly due to the fact that some games don t follow their instructions  which is
not desired but a reality nonetheless   randomness on the behavior of a game conditioned on its
instructed pp is desired in order to prevent determinism and guessing on the part of the players for the
behavior of the game in a single day  however  assuming a shop is instructed to play at a specific pp
for a long period of time  the actual pp is expected to converge to the instructed one  intuitively we can
think of the set percentage as a nudge to the right direction that the shop should follow  in reality the
pp almost always changes from day to day  and the changes might be abrupt  but the overall effect
averaged out over several days should smooth out  one aspect of the paper will be to predict the actual
percentage payout based on the instructed percentage payout  this will give as a side effect an
indication of the degree to which the games follow their instructions 
for any given shop and day we have the following data available 


set percentage  controllable   this is the instructed pp for the day 



revenue  observed 



profit  observed 



shop percentage  observed   this is the empirical percentage obtained from profit and revenue
measures 



games percentage  observed   this is the empirical percentage obtained from profit revenue
and gift measures and denotes the actual percentage at which the games played 

we currently have at our disposal data for        days obtained from     shops  yielding an average
of     days shop  all numbers are approximate  

approach
our initial approach is to perform regressions using set percentage as the feature and one of revenue 
profit  shop percentage and games percentage as the response variable  the rational behind this
follows naturally from the fact that we can control the set percentage and hope to be able to tune the

firemaining based on the first 
predicting the profit based on the set percentage might sound trivial at first  but it s anything but  the
problem is that a shop s revenue does not remain fixed but rather depends on set percentage in direct
and indirect ways  surely a player will prefer a shop where her chances of winning are higher
 reflected on average by a higher set percentage   consequently  a low set percentage for a shop might
imply higher profit in the short run but most probably a loss of customers and a smaller revenue and
profit in the long run  our goal is to be able to predict the profit based on set percentage and perhaps
find the optimal value of the second for long term equilibriums 
a secondary approach will involve extending the feature set of controllable features  set percentage 
with observed historical features  eg yesterdays revenue  profit  games percentage etc  

averaging of set percentage
all the available data are exact for any given day  however as already mentioned  predictions of
response variables for any given day are expected to be bad  since the games  behavior appears random
in small periods of time and small amounts of money played  naturally we would like to extend our
time and point frame by looking at aggregates over a week or month  aggregating profits  revenues and
shop percentage and games percentage is trivial  but aggregating set percentage is not  the naive
approach would be to take a simple average of set percentage  the problem with this approach is that
all days are treated equal  assume for example that of the   days in a week  the first   had a very low
set percentage with a small amount of played money and small profits  further assume the  th day had
a high set percentage with big amounts of played money and profits  a normal average of
set percentage will give the incorrect training example of low set percentage yielding a high profit 
to avoid the problem we perform a weighted average of set percentage based on the amount of money
played under that set percentage  intuitively  when a shop is instructed for a long period of
time money to play at a specific set percentage it is expected to converge to that faster compared to
small periods of time money 
to avoid pathological situations where no amount of money was played in a given week we apply
laplace smoothing in our averaging  a formula for averaging set percentage is thus given by 
set percentage    sum  day weight        set percentage     sum day weights    count days  
this same technique is not only useful when averaging set percentage across many days  but also
when averaging the value across multiple shops  provided they share the same currency   we can thus
apply our techniques to shop groups  areas  or even entire countries by aggregating on a per currencybasis 

models
our models consist of least squares fitting approaches  we limit ourselves to using polynomial
models of degree      and also locally weighted linear regression models  with simple unweighted
linear treated as a subcategory with equal weights  
we are using ruby gsl  an interface to the gnu scientific library  for our computations 

polynomial models allow us to use a single feature while locally weighted linear regression models
extend well to multiple features  consequently  current controllable features can easily be mixed with
historic controllable and observed features  for more details look at feature selection section below  
here are the exact choices of our models 

fi

  linear model



  polynomial models  orders     to    step   



   locally weighted linear models  taus       to      step          to    step    and     to    
step     

model selection
standard methods for selecting the best model are employed  specifically we use the following   


  simple cross validation methods  scv   test data at     and     



  k fold cross validation methods  kfcv   k          



  leave one out cross validation method  loocv   a special case of k fold really 

in order to gather some intuition and knowledge on which is the best selection method for our data we
are calculating the best model based on each of the selection methods and are recording its parameters 
training and test error 

feature selection
our initial approach is to use set percentage as the only feature  we expand on that by adding historical
values of set percentage as additional features  for example when attempting to predict day a s
response variable we will use the set percentage of days a  a    a   etc  we evaluate each model
using each of the selection methods on historical data with history values   to    step     we do the
same for weekly and monthly calculations 
our secondary approach is to add observed features into the historical information  for example we
use the profit  revenue  shop percentage and games percentage of days a  a    a   etc  since the
feature count is much larger now we only evaluate our models for history values   to    step    
similarly for weekly and monthly calculations 
note that there is no need to perform generalized feature selection techniques  like forward search  or
backward search  as there is no combinatorial aspect  no combinatorial explosion  in the choices of
set percentage  the reason is that we expect set percentages closer to the current time frame to be
more important in affecting the response variable  there is thus no need to include a set percentage of
several time periods ago  without including all the set percentages of the subsequent periods up until to
the current time frame 
further  historical profit and revenue are expected to have similar predictive power as they are linearly
correlated  through the shop percentage   also a combination of shop percentage and
games percentage is expected to have better predictive power than either of the two alone  as the
combination conveys information about gifts  

results
the astute reader  yes  that s all of you     must have noticed that the number of experiments described
in our approach is quite large  indeed the number of fits we investigate is close to          contrast
that to the original number of days for which we have data available  the vast majority of the
experiments however are marginally useful and quite a few useless  they are there for completeness
and also have an educational purpose in giving us general insight in bias  variance  feature and model
selection  further  quite a few shops have a very small amount of data and the fits were largely useless 

fimodel selection method
analysis of the experiments  data narrows down the comparison of feature selection methods down to
three contenders 


scv        fast  not robust



kfcv      medium speed  not robust



loocv   slow  robust

a method is considered robust if its train and test error calculations do not vary a lot due to chance
 random effects   even for a small number or training and test examples 
for the presentation of results  we decided to use loocv which although very slow for large data sets
is always robust due to its symmetric nature and so its train and test error can be trusted 

time frame
the hardest variable to predict was profit 
the best profit predictions at a daily interval yield test errors of     or more 
the best profit predictions at a weekly and monthly interval yield test errors of           
for the cases of profit and revenue predictions  we get better results when limiting our training and test
set to the latest examples  eg last    months  last    weeks etc   this is explained by seasonality
effects  consider a shop doing very well   years ago and poorly now  using examples from the distant
past will lead to biased optimistic predictions 
predictions of shop percentage and game percentage don t suffer from this limitation  as they are
relativistic in nature and magnitude agnostic  

features
set percentage alone has fairly good predictive power 
adding history of set percentage improves performance by      percentage points in general  the best
predictions usually involve a history of   to   
adding history of observed features such as shop percentage and games percentage further improves
performance by another     percentage points in general  the best predictions usually involve a history
of   to   
surprisingly  inclusion of observed features such as past revenue and profit rarely gives good results 
their inclusion causes severe overfitting  and test error increases by      percentage points  attempts
to prevent overfitting by penalizing high norm thetas  a la map  failed  test error further increased 

indicative numerical data
analysis was done on a per shop and on a per currency level  we present below numerical results for
monthly and weekly predictions of profit and games percentage 
graphical results are available in the project presentation at 
http   www stanford edu  kkatsiap cs    project cs    project presentation pdf

fifeature acronyms  sp  set percentage  shp  shop percentage  gp  games percentage

profit prediction
period

group

train error test error features

history limit model

by month

currency    

      

      

sp

 

  

linear

by month

currency    

     

      

sp  shp  gp

 

  

wlinear      

by month

shop    

      

      

sp  shp  gp

 

 

wlinear      

by month

shop    

      

      

sp  shp  gp

 

 

linear

by week

currency    

      

      

sp  shp  gp

 

  

linear

by week

currency    

      

    

sp  shp  gp

 

  

linear

by week

shop    

      

      

sp  shp  gp

 

  

wlinear      

by week

shop    

      

      

sp  shp  gp

 

  

linear

games percentage prediction
period

group

train error test error features

history limit model

by month

currency    

     

     

sp

 

 

linear

by month

currency    

     

     

sp

 

 

wlinear      

by month

shop    

     

     

sp

 

 

wlinear      

by month

shop    

     

     

sp

 

 

wlinear      

by week

currency    

     

     

sp

 

 

linear

by week

currency    

     

     

sp

 

 

wlinear      

by week

shop    

     

     

sp

 

 

wlinear      

by week

shop    

     

     

sp

 

 

wlinear      

future work


comparison with time series forecasting techniques  we would expect our technique to
perform better than raw time series forecasting techniques as it takes into account
set percentage  a feature that has direct and indirect effect on the response variables  which
time series forecasting techniques do not 

resources
limited source code and documents are available at  http   www stanford edu  kkatsiap cs    project 

fi