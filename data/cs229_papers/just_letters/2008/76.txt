robust realignment of fmri time series data
ben dodson
bjdodson stanford edu

olafur gudmundsson
olafurg stanford edu

december         
abstract
fmri data has become an increasingly popular source for exploring brain activity for a variety of
research purposes  doing so with automated tools requires the series of images to be aligned as accurately
as possible  accounting for any motion that may have occurred during the scan  this is typically done by
applying a rigid body transformation to each three dimensional image of the series  often done with a least
squares cost function as a similarity metric between a given figure and the reference image  however  by
itself  this technique can be biased by outlying voxel intensities caused by random noise during the scan
and  even worse  caused by the very brain activation that is ultimately being detected  bias in motion
estimation due to activation signals can ultimately result in the detection of false activation regions or
true activation regions remaining undetected  we apply various techniques of machine learning to try
and improve upon this algorithm  building on top of common tools when possible 

 

introduction and approach

the problem of motion correction for fmri time series is of particular importance for the analysis of brain
activation  as described in     there are two main issues with this task  on one hand an accurate realignment
algorithm is needed so that relatively large motions wont hinder the detection of signal variation due to
brain activity  on the other hand if the brain activation is relatively high it can bias the motion estimate
and possibly result in false activation regions being detected in later steps of the analysis 
in this paper we will turn most of our attention towards the second issue  this issue is known to be
especially severe when using a least square cost function as a similarity metric between two images     this
is because the l  norm puts small weight on small residuals but strong weight on large residuals 
we will approach the problem in two ways  first we will investigate whether using image preprocessing
techniques to detect features in the image will help ignoring the effect of bias due to brain activation 
specifically we will focus on detecting the edge of the brain image and use that to align all images to the
reference  our second approach will focus on using different cost functions that are less sensitive to outliers
and should thus be less sensitive to high activation signals 

 

data and simulations

the fmri data studied is readily represented as a series of three dimensional matrices  typically a slice of
size   x   voxels  at a depth of    slices  over a period of    samples was used  here  the conversion between
voxels and millimetres is a fixed  known quantity  the underlying data at each voxel was a single    bit
unsigned integer  representing the intensity at that location 
obviously in a real fmri image series the true motion and activation of the subject can not be known
exactly  instead  all work was done using simulations  a single  fixed three dimensional fmri scan was
duplicated    times  representing a static time series  then  simulated activation was applied by increasing
the intensity of a select grouping of voxels by a given amount ranging from        finally  we altered the
orientation of a given image by applying an affine transformation to the original image  to best approximate
 

fitrue motion  a smooth motion function was used and  to simplify our analysis  it was fixed to be a sine wave 
similarly  a square wave was chosen for the injected activation profile over our samples 
we explored various combinations of affine motion over the six degrees of freedom  but to ease analysis 
these functions were required to be parametrized by a single value determining the peak motion expressed
over our time series  likewise  our activation had a single parameter determining the amplitude of the square
wave applied  the overall method used was similar to that of     
finally  all of our work was done in the open source matlab based platform spm  by doing so  we hoped
to both avoid repeating work that others had already done  and also to have a clear channel of distribution
in the event that our work turned out useful results  spms realignment method was a useful baseline for
determining if our injected motion was what we desired 
to investigate different cost functions we used cvx  a package for specifying and solving convex programs
        to solve the resulting convex optimization problems 

 

derivatives of least squares

spm  like many other initiatives that correct for real world motion over time  uses the method of least squares
to compensate for unwanted movement  between two given images in the series  the motion is assumed to
be affine  and the correction matrix is computed by solving a linear system of equations for the mapping of
voxels  however  it is known that least squares is sensitive to outliers  our first intuition was to mask such
outliers 

   

pre processing of images

figure   a  shows a typical  d slice from a  d fmri image  it seems apparent that most voxels belonging
to the brain are of relatively high intensity compared to the background  this is clearly demonstrated in
figure   c  which shows a histogram of the pixel intensities in the image  thus a simple way to separate the
background from the brain is to use a clustering algorithm  like k means with k      to find the means of
the two distributions  then one can use the results to mask out the entire brain and do the realignment
based on the edge between the two regions 
to further elaborate on this idea we also attempted to use higher values for k  by reducing our color
space to a much lower dimension  our voxels would be more likely to have an intensity equivalent to its counterpart in the realignment process  the activated regions should be indistinguishable from their unactivated
counterparts  with k      for example  we see good distinction between regions of our image  and hence
improved robustness when considering activation levels  on a particular slice  we found our means to be
                                  these clusters are separated beyond the levels of activation produced in the
brain  which were at most     greater than the original value  so we were likely to assign coordinated voxels
to the same cluster whether or not activation was applied 
we discussed several methods of determining clusters  taking into account efficiency and efficacy  because
we would be mapping voxels across slices and across time samples  we required the cluster values to match
in each image  and  because our simulations were generated off of a single image  we used one image to
determine these values 
we found that the addition of k means did achieve our desired result of masking the induced activation 
during our error analysis  there was no indication that activation was present in these series  however  the
loss of detail in the images resulting from applying k means introduced substantial error to our least squares
algorithm  although comparable  our results were typically worse than the standard least squares method 
we explored another intuition for how we could reduce the effect of activation  rather than applying a
lossy filter to each voxel of each image  we could detect a region of the image that would be readily reconciled
between images  and would also be immune to activation  the boundary region of the brain was a likely
candidate 
we tried several well known edge detection methods  such as canny and sobel for our preprocessing 
however  during our k means analysis  we saw that the method was acceptable for separating regions of the

 

fi a  an unaltered slice taken from an  b  simple boundary detection based  c  histogram of pixel intensities in a
fmri series 
on k means using   clusters 
single fmri scan 

brain from the background  and built a simple boundary detector from there 

 

different cost functions

the role of the cost function is to assign a value to how well a given image matches to the reference image
given a certain transformation  the most common choice of a cost function in practice  and the one that is
implemented in spm  is the l  norm  other currently used methods are the correlation between images    
or mutual information      for the purpose of this paper we consider using the l  norm and the deadzonelinear penalty function instead of least squares  the deadzone linear penalty function puts zero cost on
residuals less than a given value m  which we chose to be       and is defined as 

 
 x   
 x   
 x   m   x    
both of them put relatively small weight on large residuals and should thus be less sensitive than leastsquares to bias due to activation 

 

results

figure   shows the results from using all methods on three different cases  little or no motion injected and
high activation      peak activation   medium motion and activation  motion factor   and peak activation
    and a case with high motion but little or no activation  motion factor      the motion factor defines
the amplitude of the sine wave motion function injected  thus a motion factor    injects a translation of  
mm      mm and   mm in x  y  and z direction and   and     rotation around the x and y axis 
from   d  we see that using the l  norm or the deadzone function as a cost function results in less
sensitivity to high activation compared to using the l  norm  furthermore  the boundary detection methods
are more or less immune to the activation as expected since we are masking out the activated brain regions 
for the two cases with higher motion  where bias due to activation is less critical  all methods are mostly
comparable 
while our methods are not perfect  they do provide superior results for the common case where the effect
of activation may outweigh that of motion  with a real time series  it is not possible to determine whether
or not motion is an issue  and our methods protect against introducing bias due to a false correction 

 

acknowledgments

many thanks to catie chang for her inspiration and continual support on this project  also thanks to
andrew ng and the many tas of cs    for guidance 
 

fi d  mean absolute error results for     peak activation and  e  results for    peak activation and motion parameter   
no motion  dimensions       and   are x  y  and z for translation and roll  pitch  and yaw for rotation 

 f  results for no activation and a motion parameter of    

 

fireferences
    collins dl  evans ac  holmes c  peters tm  automatic  d segmentation of neuro anatomical structures
from mri  inform process med imaging             
    luis freire  jeff orchard  mark jenkinson  and jean francois mangin  reducing activation related bias
in fmri registration  miar       lncs  pp          
    m  grant and s  boyd  cvx  matlab software for disciplined convex programming  web page and software   http   stanford edu  boyd cvx  december      
    m  grant and s  boyd  graph implementations for nonsmooth convex programs  recent advances in
learning and control  a tribute to m  vidyasagar   v  blondel  s  boyd  and h  kimura  editors  pages
        lecture notes in control and information sciences  springer        http   stanford edu 
 boyd graph dcp html 
    maes f  vandermeulen d  suetens p  comparative evaluation of multiresolution optimization strategies
fro multimodality image registration by maximization of mutual information  med image anal               
    jeff orchard  chen greif  gene golub  bruce bjornson  and m  stella atkins  simultaneous registration
and activation detection for fmri  iee transactions on medical imaging  vol      no    may             

 

fi