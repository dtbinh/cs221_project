restoring focus in photographs  extraction of the point spread
function
jeff keacher
december         

 

introduction

there are two classes of deconvolution  blind and
non blind  in non blind deconvolution  the psf is
known but the latent sharp image is unknown  the
noise may or may not be characterized  in blind deconvolution  both the psf and the latent sharp image are unknown  and the user is left to recover one
or both of them  since it is generally impractical to
measure directly the psf of an optical system without access to specialized equipment  we will focus on
the blind case 
this paper discussed a method to recover the psf
from a blurry image  minimizing the number of scope
of assumptions about the psf  the latent sharp image  and the blurry image 

out of focus images are the bane of the modern photographer  while error in exposure  cropping  and
color can often be easily fixed in post processing  errors in focus are not so simple to erase  the most
common approach to dealing with an out of focus image is to use a tool like unsharp mask  which increases the apparent sharpness of the photo but does
not correct the fundamental focusing mistake  this
is because the unsharp mask procedure increases the
acutance  essentially  the edge contrast  instead of
reversing the blur  fortunately  a technique that applies deconvolution can recover the latent sharp image from the observed blurry picture 
formally  we can represent the captured  blurred 
image b with the equation
b  l p  n

 

   

related work

many methods have been proposed for recovering the
sharp image and the psf  some operate by estimating the latent sharp image directly and then comparing the estimate to the observed blurry image to infer
the psf  others operate by doing statistical analysis 
modeling the blurry image  latent sharp image  and
psf in probabalistic terms 
one of the oldest techniques  still in use today  is
the richardson lucy algorithm  which iteratively arrives at a solution by alternately optimizing the latent
image estimate and the psf estimate  richardsonlucy saw extensive use in the astronomy community 
and it is still the default blind deconvolution method
in matlab  however  it is poorly suited to terrestrial
images 
recent work by shan et al         solves for the
latent image and the psf using probability models of
the image  noise  and psf  these results have been
demonstrated to be particularly useful when applied
to motion blurred images  however  the assumptions
about the nature of the psf  namely that it is sparse 
might not be applicable to images blurred due to fo 

where l represents the latent sharp  unblurred  image  p represents the point spread function  discussed below     is the convolution operator  and
n represents noise  we will assume that the noise
term n models the collective sensor noise  quantization noise  and compression noise 
the point spread function  psf  is  by definition 
a model of how a point source of light is modified and
distorted by an optical system  such as a camera lens 
this is particularly visible in terrestrial photos as the
image of the aperture  typially a circle or a polygon 
that is visible in out of focus images of bright lights 
for most terrestrial cameras with wide open apertures  the psf appears as a large fuzzy disc  the
psf is also related to the quality of the image bokeh 
which is the pleasant blurring of the background that
can be produced by a lens with a large aperture  it
can model more than just out of focus blur  the psf
can also model motion blur  caused by a moving object or moving camera  and atmospheric distortion
 often observed by ground based telescopes  
 

ficus errors 
fergus        describes a similar method using natural image priors  they attempt to recover the psf
for an image using a variational bayesian framework 
which allows them to solve for the psf directly 
there has also been some work in better applying
the recovered psf  in particular  levin et al        
discusses methods of restoring focus to particular objects in a scene using subject identification techniques
and focus error estimation methods  these concepts
should be amenable to a variety of psf recovery and
deconvolution techniques 

 

our approach

we attempt to extract the unknown psf for a blurred
image using natural image statistics  this is similar
to the approach of fergus        
natural images  such as photographs of landscapes
and people  tend to have statistical similarities  one figure    plot of absolute value of log  density of
  
such area is in the distribution of gradients within the ol  the density of a sharp image  note the heavy
image 
tail 
sharp natural images tend to have heavy tailed
gradient densities  such as     but blurry natural images tend to have gradient densities with small tails
 such as     intuitively  this means that the sharp
images have more high  and mid frequency components than blurry images 
our algorithm attempts to find the psf that  when
used during the deconvolution of the observed blurry
image  produces a sharp image with a gradient density most similar to this heavy tailed ideal  no additional assumptions are placed on the images and
psf 

 

implementation

the psf recovery algorithm was implemented in
matlab  for the deconvolution function  we chose
to use the deconvl  frequency function developed
by levin et al      due to its fast performance  good
results  relative immunity to noise  we tuned the
weights required by this algorithm to provide the best
results for the image being processed  as were the
other parameters needed by the algorithm described
above 
a sample of natural images were used to tune the
parameters used for the gradient match  the two
parameters of particular interest were the inflection
points in the log gradient density curves  empirically 

figure    plot of absolute value of log    density of
ob  the density of a blurry image  note the lack of
a heavy tail 

the first point corresponds with the point at which
the blurry image curve diverges from the sharp image
 

ficurve  the second point corresponds with the upper
bound of the smooth gradient curve  beyond which
there is a sharp falloff and noise dominates 
the psf was calculated iteratively  a delta function  a single non zero pixel in the psf  located at
the center  was used for the starting psf  then  using
stochastic gradient descent  the algorithm iteratively
optimized each pixel of the psf to minimize the cost
function  as alluded to earlier  the cost function was
a least squares measure of the difference between the
modeled ideal gradient density for a sharp photo
and the observed gradient density  calculated by deconvolving the current iteration of the psf with the
observed blurry image 
in order to decrease running time  we chose to operate on progressively larger versions of the original figure    ground truth  sharp  version of the sample
observed blurring image  this allowed us to start image 
with a small image  for which the processing time is
short  and generate a good estimated starting point
  results
for the next larger image size 
a summary of the algorithm follows 
images with two types of blur were tested  those with
   estimate gradient density of the latent image out of focus blur  such as the sample image in figure
based on the characteristics of natural images     and those with motion blur  in both cases  the images were real photos captured with a dslr camera 
and the observed blurred image 
the images were cropped so that the entire image
   resize the blurry image and the working psf expressed nearly identical blur  which eliminated the
need to solve for spatially varying psfs 
size to be smaller
the algorithm successfully converged on psfs that
minimized
the cost function  images deconvolved
   iterate through all of the pixels of the psf  upwith
the
derived
psf exhibited gradient density funcdating using stochastic gradient descent
tions with the desirable heavy tailed characteristics 
   repeat step   until the cost function  the dif  the improvement in this metric is clearly visible in
ference between the estimated gradient density figure   for the sample image  in that sense  the
and the gradient density obtained by deconvolv  algorithm was very successful 
for the blurry sample image  the algorithm recoving the blurred image with the current iteration
ered
the psf shown in figure    this psf is generof the psf 
ally consistent with the expected shape of a psf for
   after convergence  resize the blurry image and out of focus images  a fuzzy disc  however  there are
two faint vertical lines on the left side of the psf that
working psf to the next larger step size
are both unexpected and of unknown origin  vertical
   repeat until the blurry image is at its original lines in psfs are typically associated with vertical
motion blur  but no such distortion was present in
size
the observed image 
unfortunately  the algorithm was very slow to con   output the full recovered psf
verge  especially for larger images or psfs  this
once the psf was inferred  we extracted the latent due to both the deconvl  frequency function  which
sharp image using the same deconvl  frequency uses several fast fourier transforms  and the need
function that was used in the algorithm  the image to iterate over every pixel in the psf  which grows
statistics on the recovered image were then plotted  exponentially on every size increase  as such  the
and the image was evaluated subjectively for sharp  run time was extremely sensitive to the parameter
ness 
specifying the upper bound on the psf size  with
 

fi a 

 b 

 c 

figure    the absolute values of the densities of the
log gradients for the ground truth sharp image  a  
the observed blurry image  b   and the sharp image
recovered with the inferred psf  c   note the improved weight of the tail in  c  compared to  b  

figure    observed version of the sample image  with     megapixel images and   x   pixel maximum psf
out of focus blur  captured in a different frame than sizes  run times on the order of       minutes were
the ground truth sharp image  note the fuzzy ap  not uncommon 
pearance of the lines on the lens box 
once the algorithm converged  the resulting psf
was still suboptimal  visual artifacts  e g   ringing 
indicated that the level of fit between the true  unknown  psf and the inferred psf was not as good
as it could have been 
most apparent was the remaining blurriness in the
recovered latent images  clearly  the resulting images  such as the example in figure   would be considered sharper but not sharp  especially when
compared to the ground truth sharp images  such as
figure    experience suggests that the recovered
psf needs to be larger and have sharper edges in
order to provide a better representation of the true
 unobserved  psf 

figure    recovered latent sharp image  derived using the inferred psf  while the image is not perfect 
it is perceptibly sharper  especially around the eyes
of the plush doll 

 

conclusion

from the results we observed  we conclude that recovering the psf based solely on attempting to match
natural image gradient distributions leads to a suboptimal end  it is unclear if making use of additional natural image characteristics  such as color
data  would  all else being equal  lead to a better
outcome 
based on the work of others  we suspect that
the performance would be improved if the algorithm
placed constraints on the psf  such as enforcing
sparseness or limiting gradients 

figure    recovered psf  enlarged and contrastenhanced for publication clarity 

 

fireferences
    jalobeanu  a   blanc feraud  l   and
zerubia  j        an adaptive gaussian model
for satellite image deblurring  ieee transations
on image processing              
    joshi  n        enhancing photographs using
content specific image priors  phd dissertation 
university of california san diego
    kovacs  l   and sziranyi  t        evaluation of relative focus map based image indexing 
international workshop on content based multimedia indexing
    levin  a   fergus  r   durand  f   and
freeman  w  t        deconvolution using natural image priors  siggraph
    levin  a   fergus  r   durand  f   and
freeman  w  t        image and depth from a
conventional camera with a coded aperture  acm
transactions on graphics  siggraph
    li  j   et al        measurement and analysis
of defocused point spread functions and optical
transfer functions of a microscope  ieee pacific
rim conference on communications  computers 
and signal processing proceedings
    roth  s   and black  m  j        field of
experts  a framework for learning image priors 
cvpr
    savakis  a   and trussell  h  j        on
the accuracy of psf representation in image
restoration  ieee transations on image processing             
    shan  q   jia  j   and agarwala  a       
high quality motion deblurring from a single image  siggraph
     tzikas  d   aristidis  l   and galatsanos 
n        variational bayesian blind image deconvolution with student t priors  ieee international conference on image processing

 

fi