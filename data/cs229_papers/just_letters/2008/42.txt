object recognition using template matching
nikhil gupta  rahul gupta  amardeep singh  matt wytock
december         

 

introduction

 

building  d models

an important aspect of our project is the accurate
construction of a  d model of our target object  to
this end  we acquired   high quality diecast car models      these models are accurate replicas of real
cars at an      ratio  we chose cars representative
of the general distribution of car models on the road 
 d models of the car models were built using the
nextengine  d laser scanner     in the stanford ai
lab  this process turned out to be more challenging
and time consuming than initially anticipated  often
multiple scans had to be taken for the cars as they
have very shiny surface  often requiring a coat with
powder so as to make their surfaces less reflective 
also  some areas were still missed in the built model 
and required multiple scans to be able to build an
accurate  d model 

object recognition is inherently a hard problem in
computer vision  current standard object recognition techniques require small training data sets of
images and apply sophisticated algorithms  these
methods tend to perform poorly because the small
data set does not reflect the true distribution  selection bias  
recently  torralba et al     have proposed to develop a large data set of images     million images 
and apply simple algorithms for object recognition 
their method performs relatively well for some certain classes of objects  nevertheless  their data sets
require very large storage and are noisy 
in this project  we develop precise  d models of
objects and use these to apply simple learning algorithms for object recognition  three dimensional
models have the advantage that they are more compressed than individual images  thus this allows
training large scale object recognition algorithms  we
hope to prove that by applying a simple learning algorithm  namely template matching  we are able to
achieve strong performance in recognizing objects 
in order to focus our efforts  we are concerned only
with the classification task  given an image does it
or does it not contain the target object  this task is
the focus of much research in computer vision and in
this report we will compare our results to the state
of the art from the pascal visual object classes
 voc  challenge            further  we chose cars as
objects to detect as detecting cars in images is a general problem  and we could make accurate  d models
of the cars ourselves using scaled diecast models 
this report is organized as follows  section   details how we created the  d car models  section  
provides details of basic approach we followed  section   and   give experimental results along with
some other variations of our approach  section  
details an alternate k means based approach to the
problem  finally  section   concludes the report 

 

template matching with  d
models

once we have acquired a  d model  we need a method
to match it to a target images  we build on the simple
template matching techniques described by le et al
     this is our method of matching a  d model to a
target image i 
   using the  d model  generate a  d projection at
some pose        and scale  z   this will be
the template image  t  
   convert t and i to grayscale  if necessary 
   apply a gaussian blurring filter to t and i 
   apply canny edge detection to t and i 
   apply another gaussian filter to t and i 
   find best match in i for t using template matching and normalized sum of squares difference difference metric 
 

fissd

the goal of the gaussian filters and the edge detec 
car
tion is to provide invariance to changes in color and
no car
   
slight changes in structure and rotation while main   
taining a general representation of the object structure from the  d model  the parameters of the gaus   
sian filters and canny edge detection are parameters
   
of the method that we tuned by hand to give the best
   
performance on our datasets 
   
in step     there is an infinite space of  d projections that can be generated from the  d model 
   
in fact  it is a strength of our approach that our
   
 d model is a complete representation of the object 
   
however  in practice  naively iterating over all poses
    
   
template size
and scales and generating a  d projection in ths fashion is computationally expensive  therefore  for the
purposes of this project  we restrict our attention to
figure    the same template t   scaled to different
a limited set of poses 
sizes and compared to image i 

   

template score dependence on    
size

parametric model based on template matching

as discussed above  its unclear how to compare template matches of different sizes  furthermore  we
want to match templates showing the target object
at different  d rotations  therefore  we pose a supervised learning problem in which the output space
y          represents car or not car and the input feature vector x    x         xn   is composed of
our scores from template matching  the dimensionp p
ality of the feature vector will be equal to m x n x k 
 t  i  j   i x   i  y   j   
where m is the number of models  n is the number
p pi j
p
p
  i j t  i  j      i j i x   i  y   j    
of poses and k is the number of scales 
based on figure    it is our intuitive sense that positive
examples should be differentiated from negative
when template size approaches    the score also
examples
by an inflection point  local minimum  that
decreases toward   as the minimization problem berepresents
a good match at a given scale  whereas
comes easier  for example  a template of size   is very
negative
examples
should have scores that decrease
likely to find its exact match in the image  we obmonotonically
as
the
template size decreases 
served this empirically  see figure    note that there
are other scoring functions used for image comparison
when template matching  such as cross correlation 
  easy data set    poses  single
but they all have this same property 
an interesting question that arises  therefore  is to
scale
define the optimal loss function for comparing templates of different sizes  we did not derive such a the first data set that we attempted to classify was
function as part of this project  however it is our in  from the uiuc image database     for car detection 
tuition that the loss function should be based on the it contains       labeled examples of car side views
premise that a random template of size m and a ran       positive      negative  at a single scale  we
dom template of size n  m    n   should have ap  partitioned these examples randomly into a training
proximately the same score when template matching set       and a test set       
in order to match our  d model to this set  we
against a given image i 
one phenemenon that we observed when comparing scores from template matching is that there is
a strong correlation between the score of the template and its size  considering the normalized sum of
square differences scoring function that we are using
to compare the template t and the image i 

 

fisurprising that the first pose   feature is selected at
 th in the list  this leads us to believe that adding
additional poses does not help as much as we initially
anticipated  one possible reason for this is that after
running blurring and edge detection the most dominant remaining feature of both poses is the wheels
which happen to look roughly the same since the two
poses are both side views 

used   model  with   poses and    scales to generate
   features  we then performed logistic regression
on these features to find their optimal weights  our
results on this simplistic data set were good  achieving an average precision  ap  of       however  a
simpler approach using nearest neighbor achieved a
better ap of      

it is also interesting to note that the optimal
weighting found by logistic regression corresponds to
our intuitive notion of applying a differential function
on the feature vectors 

 

    

nn
tm
   

   
   
    
   
    

accuracy

precision

   

   

   

    

    

   

   

   

    

   

    

 

 

   

   

   

   

   
recall

   

   

   

   

    

 

 

 

  

  
  
number of features

  

  

  

  

figure    easy data set   a  example image  b  pr
curves for nearest neighbor and template matching

  

  

   

 

feature analysis

  

to better understand how our features represent our
data  we use the forward search feature selection al  
gorithm to determine the most important features
  
 see figure     the top    features chosen by forward
search are                                   
  
 
 
  
  
  
  
  
  
by visual check  feature   corresponds to the scale
of the model most closely matching that of the cars in
the target images  therefore  it makes sense that it
is the most discriminative single feature since images
which match the properly scaled model template well figure     a  number of features vs  accuracy  b 
optimal weight vector
are most likely car images 
in this example  features      come from pose  
and features       come from pose    it is somewhat
 

fi   

comparison

we implemented the nearest neighbor algorithm for
classification by computing the sum of squares distance  ssd  between the test image and all training
images  then  each of the    closest images contributes one vote as to the class of the target image
 car or not car   normalizing these votes gives us
a score between   and    which we can use to compute
the precision and recall at different thresholds 
nearest neighbor works well on this set because
the input images are homogeneous in terms of object
position color  position and scale  in this scenario 
a  d model that can represent all of the different
poses and scales of a model provides little additional
value  furthermore  our template matching routines
throw away significant information when doing edge
detection and blurring that is clearly used effectively
by nearest neighbor  finally  our car model has a
slightly different structure than the older cars present
in the images  giving it a slight disadvantage 

 
tm  lr 
tm  svm 
nn

   

   

   

precision

   

   

   

 

difficult data set 
poses  many scales

many

   

   

   

the next data set that we worked on was that from
the voc      challenge      this data set has cars
at all scales and poses as well as occluded cars and
non traditional cars  such as the hummer  they have
also pre segmented the data into a training set and a
recommended validation set 
this dataset has labeled car examples split into
test  validation and training sets             unlike
the previous data set  this set is skewed       toward
negative examples which means that accuracy is not a
good measure of performance  instead we use average
precision  ap  which is the same measure used in the
challenge 
the best result from the challenge is ap of     
while nearest neighbor gets ap of       our template
matching approach scores      

 

 

   

   

   

   

   
recall

   

   

   

   

 

figure    difficult data set   a  example image  b 
pr curves for template matching with logistic regression  ap          template matching with svm  ap
        and nearest neighbor  ap        

tion error  the best ap achieved by forward search
on the validation set was       however  when we
used the feature set on the test set it hurt ap slightly 
this is not too surprising as the forward search algorithm simplify observed variations in the feature set
that randomly improved performance on the validation set  these improvements did not generalize well
to the test set 
    optimizing for average precision
a related technique would to be to use cross validation
with a regularization parameter but we could
logistic regression minimizes the error between the
not
try
this 
hypothesis and the training set  however  for the
voc challenge  the comparison metric is average
precision  ap is computed by iterating over recall     svm
in     intervals and averaging the precision values 
we used cross validation with a forward search al  we also ran a svm classifier over our feature set 
gorithm and optimized for ap instead of generaliza  to compare the results we got by logistic regression 
 

fiwe used the voc dataset  and svm light      with
linear  polynominal and radial kernel  the parameters for the svm classifiers were hand tuned for good
results 
with a radial kernel  we got an ap of       which
was comparable  but lower  than what we got from logistic regression  the linear and polynomial kernels 
however  were not able to classifly any of the positive
test images correctly  this is because the optimal
function computed by svm in these cases was such
that h x i        for all i  this is optimal in terms
of accuracy but not optimal for the metrics we care
about  precision and recall 

 

alternate approach 
means clustering

 

   

   

precision

   

   

   

   

   

   

 

 

   

   

   

   

   
recall

   

   

   

   

 

kfigure    pr curves for nearest neighbor  ap  
       template matching with k means  ap        
and template matching with  d model images  ap
       

one of the issues with template matching approach is
the set of templates to provide to do the match  here 
we used ta graz    database which also provides
pixel masks for labelled cars  we ran k means on
edge images of these extracted cars to divide them
into a small no  of clusters  our hope was that this
would divide the set of cars into a representative set
of poses good for template matching 
we ran k means to get a set of    representative
images  then  template matching was run on a set
of cars and non cars images from the same database 
this database is complex with cars in many orientations and sizes  with this approach  we got an ap of
     
for comparison  we also ran nearest neighbor  ap
        and template matching with  d model images  ap         
there were several difficulties we faced in k means
approach  which require further work  one was a
good way to find distance between two images  especially as their aspect ratios differ  we used sum
of squares distance on the images resized to fit in a
   x    square  maintaing their original aspect ratio
with empty parts padded with black pixels 

 

tm  kmeans 
tm   d 
nn

   

we used our  d models in a very simple way  by
generating  d projections of them  we then matched
the projections to target images  this raised numerous questions  such as  how do you compare scores
from the matching of different templates  how effective is template matching edge images at recognizing
the target 
we showed that using the scores directly as features in logistic regresison works reasonably well  we
also showed that even for difficult data sets template
matching with a small number of poses can be effective in recognizing cars  it remains to be seen if
simply using more poses will improve the accuracy of
the system  adding more poses will cause the feature
vectors to grow considerably  which in turn may also
require more thought as to what is the optimal way
to compare scores for template matching of different poses and scales  a question we touched on only
briefly  finally  adding more poses will push the limits of what is computationally reasonable  a question
we did not consider as part of this project 

conclusions

optimizing for precision and recall  as opposed
to accuracy  has been studied before in machine
learning  some examples include  svmperf     and
bhrm  we did not try these as part of this project 
but using such techniques would most likely improve
our scores on precision and recall significantly 

the problems we encountered can be categorized into
two areas  using the knowledge of the  d model to
extract features from target images  and training the
parameters of the system to optimize for precision
and recall 
 

fi 

acknowledgements

quoc le provided much guidance on this project  including the idea of using  d models plus template
matching to do object recognition  quoc also recommended comparing our results to nearest neighbor to
better understand the performance of our approach 

references
    a  torralba  r  fergus  w  t  freeman     million
tiny images  a large dataset for non parametric
object and scene recognition  in press  ieee
transactions on pattern analysis and machine
intelligence       
    quoc le  morgan quigley and andrew y  ng 
visual servoing by template matching   unpublished 
    the pascal visual object classes challenge
    
    http   l r cs uiuc edu  cogcomp data car
    http   svmlight joachims org
    http   svmlight joachims org svm perf html
    http   www diecastmodelswholesale com
    https   www nextengine com

 

fi