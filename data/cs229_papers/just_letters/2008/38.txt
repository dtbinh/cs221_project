detection of atrial fibrillation in ecgs

tracy chou  yuriko tamura  and ian wong

 tychou  ytamura  ianw  stanford edu

   overview
automatic detection and classification of arrhythmia
in electrocardiograms  ecg  provides a framework for
efficient diagnosis and broader outreach to patients at
risk for cardiac diseases  while prevalent types of arrhythmia include premature ventricular contractions
 pvc  and atrial fibrillation  the majority of existing
literature focuses on automatic detection and classification of the former type  in this report  we discuss our heuristic and implementation for detection
of atrial fibrillation  using a dataset provided by the
mit bih arrhythmia database  using features from
fourier analysis  wavelet transformation  and r r interval analysis  linear discriminant analysis  lda  on
individual segments performed well with classification
error of approximately      our detector  which built
on top of our classifier  successfully identified regions
of atrial fibrillation with less than    error 

ecg signal

frequency binning

remove baseline wander

r r intervals

wavelet transform

dimension
reduction  pca 

classifier  lda 

feature extraction
classification 
detection

atrial fibrillation 

figure    our overall approach 

sequence of heartbeats and can be observed by irregularity of both morphology and rhythm of heartbeats 
     problem statement

   motivation
     background
electrocardiograms  ecgs  are recordings of the
hearts electrical activity and are widely used by physicians to diagnose pathologies related to the heart  normal  sinus  rhythms manifest as periodic time signals
representing a series of heart beats  each with characteristic peaks that correspond to events during a single
heart beat  patients with or at risk of cardiovascular
diseases often present ecgs that are irregular in rate
and in morphology of the signal 
there is a recognized industry in creating automatic
detection algorithms for arrhythmia  because it is impractical for doctors to comb through ecg data by
hand  episodes of arrhythmia may be infrequent  and
recordings of more than    hours are often necessary
to catch them 
however  while prevalent types of arrhythmia include
both premature ventricular contractions  pvc  and
atrial fibrillation  most prior research has focused on
pvc  the techniques used for detecting pvc  which
occurs as singular beats  cannot be applied directly to
detecting atrial fibrillation  which takes place over a

given an entire ecg recording  can we detect regions
with atrial fibrillation 

   our approach
our approach to addressing the problem of atrial fibrillation detection is depicted in figure    using the
mit bih arrhythmia database as a signals database 
we first trained our binary classifier  which used linear discriminant analysis  on both normal and atrial
fibrillation regions in these signals  the features we
used are detailed in a section    afterwards  we applied our binary classifier to regions of our test signal 
more precisely  we classified rolling regions over our
test signal  assigning all points in the signal a probability score for atrial fibrillation  for verification we
compared our predicted regions of atrial fibrillation to
regions of actual atrial fibrillation as annotated by the
database 

   obtaining ecg data
physionet provides access to various ecg datasets 
including the mit bih arrhythmia database  which
provides beat and rhythm annotations manually done

fidetection of atrial fibrillation in ecgs
normal ecg

afib
normal

   

 

figure    segments of atrial fibrillation and normal beats 

 

  

  

           
frequency  hz 

  

  

  

  

  

  

afib ecg

by physicians  the waveform database  wfdb  library provides c functions to decode the data and annotations  which we were able to port into matlab 
the database is comprised of    fully annotated halfhour  two lead ecg recordings  of these    recordings
contain atrial fibrillation  these   were our signals of
interest 

   feature selection
we considered several different features to use in classification of individual heartbeats  the most successful
set of features was a combination of all the features we
considered   frequency components  time series data 
and length of the beats 
     defining training examples
one straightforward approach would have been to use
individual heartbeats as training examples  since the
end goal was to classify individual beats  however 
consecutive beats tend to be very similar  and this
approach would have given more weight to training
examples that occur in long continuous runs  especially given the few datasets available  this could have
skewed the classification algorithm considerably  our
approach therefore segmented the records according
to the annotations of normal or atrial fibrillation 
and each segment was considered one training example  each training example could have a variable number of beats 
we only used records containing atrial fibrillation  we
did not use normal segments from any records not containing atrial fibrillation 
     frequency components
we selected frequency features by applying the fourier
transform on the raw data  we binned the contributions in bins of    hertz  that is  the frequency components between   and    hertz would be summed 
between    and     and so on  we then computed the
power  in decibels  by taking the log of these sums 
and normalized them  we experimented with different

   

 

 

  

  

           
frequency  hz 

figure    top  normal signal and histogram of frequencies
after fourier transform  bottom  same  but for signal with
atrial fibrillation 

size bins  and different numbers of bins  which corresponded to number of features   in general we found
that bins of    hertz were best  and also that the frequencies above     hertz reflected noise in the ecg
signals and were not representative of wave morphology or timing 
     time series data
we selected time series features by performing wavelet
transform  windowing individual beats  downsampling
those beats  and averaging the samples for each window 
ecg recordings frequently exhibit baseline wander 
artificial  fluctuating curves that offset entire ecg signals  due to various sources of recording noise  including patient movement and mechanical displacement of
the ecg leads  before extracting time series features 
we first preprocessed the signal to remove baseline
wander  we compared different ways of filtering the
signal to recover the baseline  including single median 
double median  double mean  and lowpass filters  we
found that a double median filter  first with width    
milliseconds and second with width     milliseconds 
was most effective for retrieving the baseline  which we
then subtracted from the original signal 
the next step was to smooth out noise and enhance
morphological features of the signal  based on results
in literature  particularly from andreao et al   and
our own experimentation  we chose to use the wavelet

fidetection of atrial fibrillation in ecgs
   

original
double median

 
   
 
   
 
   

vious work on analyzing ecg signals considered r r
intervals as an important characteristic in differentiating normal and abnormal beats  however  we found it
easier to substitute length per beat as an approximate
measure of r r intervals  which would have required
looking at previous and subsequent beats  we grouped
this feature with the time series data in our testing 

 

     combining feature sets

   

after testing the effectiveness of the classifier using the
different feature sets  we found that combining all of
them gave the best results 

 
   

baseline wander removed

 

figure    top  ecg with baseline wander and the signal
after double median filter  bottom  ecg with baseline
wander removed 

original signal
wavelet transformed signal
qrs peaks
extracted features
window boundaries

figure    wavelet transformed signal with extraction windows and selected features 

transform with the mexican
given by

r  hat wavelet 
d
 
andreoa
w f  t  s    f  s  t     s  f  t   t
s
et al   andreao    compared various wavelet transform  and showed that the mexican hat wavelet is similar in shape to ecg signals and is the ideal candidate
to enhance the major features of the signal while removing high frequency noise  after testing different
scales of the wavelet transform on our ecg signals 
we settled on the scale s       
to determine the locations of individual beats  we used
the mit database annotations for qrs peaks and windowed by splitting beats halfway between peaks  after
windowing  we anchored the qrs peak of each window as the halfway point  as it was the most significant feature  and uniformly sampled points before
and after the peak to get the desired number of features our first approach was to find local maxima and
minima within subintervals of the window  but the
more straightforward downsampling produced better
results in classification 
finally  for each training example  we averaged the
features obtained per beat in the example 
     beat length
because our windows were of variable size  we used
the length of windows as a feature  in fact  much pre 

for the frequency and time series analysis  the number of features extracted per training example was very
straightforward  corresponding to frequency bins and
downsampled points  respectively  when testing the
combination of sets  for a desired number of features
n  we concatenated n features for each set to get  n
features  however  when concatenated  we found our
training matrix of a higher dimension to be not full
rank  limiting our inference abilities  that is  the
higher dimensional data actually resides in a lower one 
so we applied principal component analysis to reduce
the dimensionality back down to n  on the downside 
pca made it difficult to attach physiological meaning
to the features we extracted 

   classification
our goal for classification was binary classification of
segments of ecg signals as normal beats or atrial fibrillation 
     classification algorithm
we used standard gaussian discriminant analysis with
a pooled covariance matrix as our classification algorithm  we also tried gaussian discriminant analysis
with covariance matrices stratified by group  as well
as naive bayes  with less success 
     performance metrics
we used leave one out cross validation to evaluate the
performance of our classifier  since we were working
with a limited dataset  the best performance was
      error using    combined features  with       
sensitivity and     specificity  the lowest classification error using only frequency features was        
with    features  measuring frequency components up
to     hertz  the lowest classification error using only
temporal components was         with    features
   samples per window  combined with beat length  

fidetection of atrial fibrillation in ecgs
sample ecg recording   with afib
relative probability

classifying with only the individual frequency or temporal feature sets had perfect sensitivity but no specificity  indicating that the classifier always erred on the
side of predicting atrial fibrillation 

 
   
   
   
   
 

detected
actual

entire recording     min 

classification error
fourier wavelet   rr
both
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
sensitivity     tp      tp     fn 
fourier wavelet   rr
both
 
 
      
 
 
      
 
 
      
 
 
      
 
 
      
specificity     tn      tn     fp 
fourier wavelet   rr
both
 
 
      
 
 
      
 
 
      
 
 
      
 
 
      

   detection
an automatic detection tool for atrial fibrillation is
the primary application of our rhythm classification
tool  the original motivation of our problem was that
arrhythmia are often only captured in holter recordings that are too long for visual scanning by doctors 
using our best performing set of features for classification  we developed an algorithm to detect episodes
of atrial fibrillation in a test ecg record  with only
      error on our test data 
to classify sections of a    minute mit database
record  we considered a test window which we slid
through the record with constant increments on the
starting index  from each window we extracted   
features combining fourier transforms  wavelet transforms  and r r interval analysis  and classified the segment with linear discriminant analysis  as described
above  test windows classified as atrial fibrillation
were output as an array of  s for the represented sample indices  and  s otherwise  the relative probability
of finding an arrhythmia at a particular index was calculated as the normalized cumulative sum of all outputs of test windows that included the point  if this
probability was greater than      we predicted arrhythmia  and normal otherwise 

relative probability

 
features
 
  
  
  
  
 
features
 
  
  
  
  
 
features
 
  
  
  
  

 

sample ecg recording   with afib
 
   
   
   
   
 

detected
actual

entire recording     min 

figure    our detector successfully identified regions with
atrial fibrillation 

we used a constant length of      samples per test
window  corresponding to    seconds  the offset between each start index was set to be     samples  corresponding to     seconds  we chose these numbers
because segments of arrhythmia often last several minutes  and     seconds corresponds to approximately
half a beat in a normal sinus rhythm and up to a
whole beat for irregular rhythms  the relative fraction of the offset to the test window length defines the
vertical resolution of the additive algorithm  while the
absolute value of the offset changes horizontal resolution 

   conclusions
machine learning applied to ecg analysis provides a
platform for accurate and efficient arrhythmia diagnosis without extensive knowledge of the mechanisms
or characteristics of different classes  through experimentation with different feature extraction and machine learning techniques  we developed a robust binary classification method for atrial fibrillation  detection using our wave classifier shows promise in clinical application of our algorithm 
our approach first represented different heartbeats
with characteristic features combining frequency domain analysis as well as time series data  and then used
these features to train a linear discriminant analysis
classifier  the standalone classifier had approximately
    accuracy  but our detection tool performed even
better  successfully detecting regions of atrial fibrillation with only       error 
further work to improve the performance of our classification and detection algorithms should incorporate
different ways of dividing up segments for feature analysis  in our temporal analysis we considered beats
individually  but one researcher  omer inan  has suggested that larger windows of   beats are preferable 

fidetection of atrial fibrillation in ecgs

because they capture rhythm transitions  our results
showed that combining time series data with fourier
transformed data drastically improved performance 
indicating the importance of longer scale wave characteristics such as heart rate for classification of atrial
fibrillation 

   acknowledgments
we would like to thank jinglin zeng  ph d   uday kumar  m d   mark day  ph d   and omer inan for providing us with inspiration  expertise  and moral support throughout the project   we would also like to
designate the killers song human as the official
theme song of our project  

    references
andreao rv  dorizzi b  boudy j  ecg signal analysis
through hidden markov models  ieee transactions on
biomedical engineering                        
andreao rv  boudy j  combining wavelet transforms
and hidden markov models for ecg segmentation 
eurasip journal on advances in signal processing 
               pp       
coast da  stern rm  cano gg  briller sa  an approach
to cardiac arrhythmia analysis using hidden markov
models  ieee transactions on biomedical engineering 
                    
hughes np  tarassenko l  roberts sj  markov models for
automated ecg interval analysis 
koski a  modelling ecg signals with hidden markov models  artificial intelligence in medicine                  
laguna p  mark rg  goldberg a  moody gb  a database
for evaluation of algorithms for measurement of qt and
other waveform intervals in the ecg  computers in cardiology                   
inan o  giovangrandi l  kovacs g  robust neuralnetwork based classification of premature ventricular
contractions using wavelet transform and timing interval features  ieee transactions on biomedical engineering                         

fi