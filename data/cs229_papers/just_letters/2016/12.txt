 

classification of abdominal tissues by
k means clustering for  d acoustic and
shear wave modeling
kevin t  looby
klooby stanford edu

i  a bstract
clutter is an effect that degrades the quality of
medical ultrasound imaging  to better understand and
subsequently reduce the effects of clutter  the underlying mechanisms must be studied  clutter is thought
to be highly reliant on the reverberations of acoustic
signal due to microscopic subcutaneous tissues 
this paper presents a method for producing a fourtissue acoustic map to be used in three dimensional
nonlinear ultrasound simulations  a full volumetric
map was successfully produced through the application
of the k means clustering algorithm to a fat water
separated mri volume 
ii  m otivation
a  clutter
in ultrasonic imaging  clutter  a phenomenon associated with poor quality images  produces a temporallystable obstruction resulting in decreased image contrast
and a reduced ability to discern imaging targets  clutter is frequently a factor when imaging overweight 
obese  and difficult to image patients  the effect of
clutter is attributed to the interactions of acoustic
waves with the subcutaneous tissue layers  particularly 
acoustic reverberation  off axis scattering  and phase
aberrations from the subcutaneous layers are significant sources of clutter         
b  tissue classification for modeling
the imaging difficulties presented by clutter are
a major obstacle for clinical ultrasound imaging  as
such  modeling the acoustic wave tissue interactions
that produce clutter is of importance to ultrasound
researchers  while much previous work has been
done in characterizing this phenomenon using twodimensional models  the problem must be examined on
a three dimensional scale in order to produce simulation results of significant value  presently  the literature
lacks three dimensional models of these interactions 
this project  which forms a piece a of an ongoing
project that i am conducting in jeremy dahls ultrasound research lab  seeks to produce acoustic maps to
be used in three dimensional ultrasound simulations 
an acoustic map  in the context of this project  is a

mapping of tissue characteristics to spatial locations 
these maps will be produced through the processing
of  d magnetic resonance imaging  mri  scans 
at this time  the primary aim is to take a set of mri
slices and assign each image pixel a label corresponding to the tissue displayed in that pixel  the primary
tissues of interest are skin  fat  muscle  and connective
tissues  any pixels corresponding to regions without
signal are classified together as background pixels in
a fifth cluster 
iii  m aterials
the mri datasets used in this project were acquired
at the lucas center at stanford specifically for this
project  in order to achieve high signal to noise ratio
 snr  at a very high resolution      micron isotropic  
prohibitively long scan times are required  as such  a
slab of pork belly is used as an ideal ex vivo model 
it is desired that the results achieved on this model be
replicated when applied to a non ideal in vivo human
scan  which will show a significant degradation in
snr 
a tailored mri pulse was used to generate two
datasets  one dataset contains the signals from protons
within water based tissues  the other contains signal
from protons within fat based tissue  although out of
the scope of this project  as brief explanation  this was
achieved by making use of the chemical shift seen
in the resonant frequencies of shielded protons  this
allows for the signals from different chemical species
 here  water and fat  to be distinguished based on the
phase of the received signal 
for illustrative purposes  a two dimensional slice of
the dataset is provided in fig    and fig     before running the algorithm  some preprocessing was required 
first  the datasets were separately normalized to have a
minimum voxel intensity of zero and a maximum voxel
intensity of one  the datasets were then registered to
each other  as it is vital that the voxel correspondences
between the two datasets be accurate 
iv  m ethodology
a  k means algorithm
the k means clustering algorithm is fairly straightforward  a set of centroids is initially chosen  either at

fi 

fig     selected slice from the water only dataset  gray levels closer
to white indicate a stronger water signal at that pixel 

fig     selected slice from the fat only dataset  gray levels closer
to white indicate a stronger fat signal at that pixel 

random or with some initial estimate of the likely final
centroids  during each iteration  every point  in this
application  pixel  is assigned the label corresponding
to the centroid closest in euclidean distance in the
feature space  the feature space will be described in
the next section   once every point has been assigned
a label  the locations of the centroids are updated to
the means of the locations of all points that were
assigned the corresponding label in the previous step 
this process is repeated until a convergence criterion
has been met 

b  feature space
in the k means clustering method  the feature space
can be thought of as a space with dimensions defined
by the features chosen to describe the data to be
categorized  the centroids take on values within this
space  and distances within the space can be calculated
between the values taken on by the centroids and the
values held by the data 
a substantial piece of this project involves devising
and properly weighting the features that are used to
describe each pixel  the dataset can be considered
as a three dimensional matrix whose dimensions correspond to the three spatial dimensions x  y  and z 
each entry in the matrix is a scalar representing the
pixel intensity at each spatial location  as such  the
only information available is a pixel intensity and its
location in cartesian space 
the results that will be presented in the next section
were achieved using a weighting of nine features  the
features were chosen and weighted in order to best
accommodate the clustering of the data into the five
desired clusters 
   known signal  as the data has already been
grouped into fat signal and water signal  it is very
desirable to make use of this information  the voxels
corresponding to the water based tissues  skin  muscle 
and connective tissue  should be represented by high
signal values in the water signal dataset  while the
pixels corresponding to the fat signal should of course
be represented by high signals in the fat signal dataset 
furthermore  the regions corresponding to a lack of
signal should have very low pixel values in both
datasets 
this information was included as three binary features  representative slices of these features are provided in fig        and    as the remainder of the
difficulty rests in distinguishing the three water based
tissues  the following features will only be applied to
the water signal volume 

mathematically  this can be described  as presented
in the course lecture notes  by the following  repeat
steps   and   until convergence is achieved 

 


c i     arg min x i   j 
   
j

  i 
 
pm
  j x i 
i     c

 
j    pm
 i    j
i     c

   

in these equations  c i  denotes the label assigned to
data point x i    j the location of centroid j  and    
is the indicator function yielding   when its argument
is true  the algorithm is implemented using the builtin function provided with matlab for computational
efficiency 

fig     thresholding the normalized water signal dataset gives a
binary mask corresponding to voxels to be associated with waterbased tissues 

   connected regions  intuitively  neighboring
voxels of similar intensity are likely to belong to the
same tissue class  this is a very natural assumption
and can be implemented by using a region labeling

fi 

the sizes of each of these connected regions can
also be usefully incorporated into the feature space  as
the connective tissue regions  the smallest connected
regions  were found to be the most difficult to classify 
the region size feature was chosen to emphasize clustering these small regions together  this was achieved
by summing the number of pixels in each region and
then thresholding the labeled volume so that only the
regions significantly smaller than the mean region size
were kept  fig     
fig     thresholding the normalized fat signal dataset gives a binary
mask corresponding to voxels to be associated with fat based tissues 

fig     thresholding out the largest of the regions leaves a fair
estimate of voxel regions expected to relate to the connective tissues
class 
fig     the water and fat features were combined to provide a binary
mask to encourage the separation of tissue voxels from background
noise 

algorithm  the algorithm implemented in this work
used the matlab function bwlabel    this function takes a binarized volume and outputs a label for
each detected connected region 
it was found that in three dimensional space  the
connective tissue fibers link the larger tissue structures
to each other  as anticipated by prior knowledge of this
anatomy  as such  running the region labeling algorithm in three dimensions did not provide useful results  however  by labeling regions in two dimensional
space  it is possible to separate the connective tissue
regions from the larger skin and muscle masses  a
representative slice of this feature is shown in fig   

   intensity  voxel intensity naturally makes up
one feature  alone  this is in no way sufficient for
characterization  as the different water based tissue
types produce similar signals  see fig      towards the
edges of tissue regions  the mri signal decays  and as
such there is a broad overlapping of intensities between
the tissue types  these variations were accounted for
by assigning the median voxel intensity over each
connected region to every voxel within that region 

fig     the median intensity value over each region in fig   
was assigned to every voxel within that region to promote uniform
classification by region and voxel intensity 

fig     each connected region in the volume was assigned a unique
integer label  the labels were then normalized to a maximum value
of one 

   spatial distribution  again  referring to fig   
it can be seen that there is a significant macroscopic
distribution of tissues in the y direction  vertical   it is
possible to take advantage of this distribution by using
the y position of each voxel as a feature 
experimentation was done with using polynomial
weightings of the voxel locations to try to enforce prior
knowledge about the expected spatial distributions of

fi 

the water based tissues  however  a simple logarithm
of the vertical position  with respect to the orientations
of the slices as presented in the figures in this work 
was found to effectively enforce the expected spatial
distributions of tissues while preserving the ability to
generalize to future datasets 

fig      the convolution described in eqn    produces a volume
with local vertical gradients represented by voxel intensity 

fig     taking a weighted logarithm of the vertical voxel locations
enforces the prior expectation regarding the spatial distribution of
abdominal tissues 

   image gradients  additionally  there are spatial
variations in pixel intensity throughout each tissue 
as a particular example  the connective tissues  thin
tendrils as seen in fig     display a bright signal of
a width on the order of     pixels  in an attempt
to characterize such spatial variation  local gradients
in the x  and y  directions are used as features 
these gradients are calculated with a two dimensional
convolution of the image data with appropriate kernels 
defined as 


gx   im     
   
 
 
gy   im 
 

and rsize the sizes of the connected regions  ii denotes
the intensity of the ith pixel  yi denotes the normalized
and weighted y position  vertical  of the ith pixel 
and  as before  gx i and gy i are the local gradients
calculated for each pixel 


stotal
 swater 


 sfat 


 rlabel 



x i    
   
  rsize 
 ii 


  yi 


 gx i 
gy i
multiplicative weightings were added to the region
size and y location features in order to encourage the
algorithm to emphasize these features over the rest 
as these were found to produce better results when
weighted 

   
v  r esults
clustering was run on the water only and fat only
volumes  fig    and fig     respectively  using the
features defined in the previous section  by running kmeans on this feature set  a complete acoustic map
is obtained  fig       for the sake of providing a
visualization of the data  each of the images displayed
throughout this work are of the same two dimensional
slice of the larger three dimensional volume  the clustering was successfully applied to the entire volume 
vi  d iscussion and c onclusions

fig      the convolution described in eqn    produces a volume
with local horizontal gradients represented by voxel intensity 

in equations   and    gx and gy are the local
gradients in the x  and y  directions respectively  and
 is the convolution operator 
   feature space weighting  the complete feature
space can be represented as in eqn     stotal is the
complete signal mask  swater and sfat the water and
fat signal masks  rlabel the connected region labels 

overall  excellent qualitative results were achieved 
as is to be expected  some misclassifications must
be accepted  as any mri acquired at this resolution
will have low snr and contrast  the feature space
was specifically defined with this in mind in order to
produce benign misclassifications whenever possible 
in medical ultrasound  images are constructed based
on acoustic reflections  such reflections occur when
a propagating acoustic wave encounters an acoustic impedance mismatch  larger mismatches produce

fi 

investigations into the robustness of this algorithm to
the presence of these less ideal conditions will need
to be performed 
r eferences
   

   
fig      the k means algorithm produces an integer labeled mapping of the dataset  a  d slice of the labeled tissues with each tissue
class represented by a different grayscale value is provided  in order
of increasing whiteness  the classes are background  black   fat 
muscle  skin  and connective tissue  white  

larger reflections  this aspect of ultrasound physics
was used to guide the definition of benign and
malignant misclassifications 
a benign misclassification was defined to be a
classification of either skin or muscle voxels into
the connective tissue class  as long as kept to small
numbers  these misclassifications will have negligible
effect on simulation results 
there are two types of misclassifications defined as
malignant for this application  the first was defined to
be any deep classification of a fat voxel as water based
tissue or water based voxel as fat  here  i use deep
in the anatomical sense  that is  an example of this
misclassification would be an erroneous voxel in the
middle of a piece of muscle labeled as fat   this type
of error was heavily influenced by the rician noise
inherent in mri scan data and was nearly eliminated
by the addition of the connected regions feature  fig
   
the second malignant misclassification type is the
classification of any tissue voxel as background or
empty space  such erroneous voxels would produce
extremely large imaging artifacts  the impedance mismatch between any tissue and empty space is large 
the preliminary results presented in the milestone
suffered greatly from these misclassifications 
much of the subsequent work involved incorporating features and preprocessing steps to eliminate these
errors  the inclusion of a more sophisticated image
registration transform to ensure alignment between the
fat and water volumes along with inclusion of the
connected region and binary signal features allowed
for the almost complete removal of these misclassifications 
vii  f uture w ork
the results presented in fig      are more than
satisfactory to serve as a dataset for preliminary ex vivo
simulations  as mentioned  it is desired to translate this
process to usage with in vivo scan data  which will
suffer a further reduction in snr and image contrast 

j  j  dahl and n  m  sheth  reverberation clutter
from subcutaneous tissue layers  simulation and
in vivo demonstrations  ultrasound med biol 
     
g  f  pinton  g  e  trahey  and j  j  dahl 
sources of image degradation in fundamental
and harmonic ultrasound imaging  a nonlinear
fullwave simulation study   ieee trans ultrason
ferroelect freq contr  vol      pp           
     

fi