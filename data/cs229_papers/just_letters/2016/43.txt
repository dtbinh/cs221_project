 

household energy disaggregation based on
difference hidden markov model
ali hemmatifar  ahemmati stanford edu  manohar mogadali
 manoharm stanford edu 

abstractwe aim to address the problem of energy
disaggregation into individual appliance contribution
for a given household  we do this based on a machine
learning approach that involves modeling each appliances load contribution to be a markov chain 
once the hidden markov model  hmm  is trained 
we can get the parameters such as the number of
states and their prior probabilities  transition matrix
and the emission characteristics for each appliance
 each state is modeled as a gaussian distribution  
the disaggregation of the total load is modeled as a
difference hidden markov model  difference hmm  
based on hmms for each of the appliance learned
previously  finally  the most probable set of states for
all the appliances is obtained using a custom viterbi
algorithm  this approach to energy disaggregation
works well for fixed state appliances  as can be seen
in the results 
key words  energy disaggregation  markov
chain  hmm  difference hmm  viterbi algorithm

i  i ntroduction
exponential increase in energy demands
makes the energy conservation one of the
biggest challenges of our time  any effort in
minimizing the energy wastage will then have
direct impact on our life  both economically
and environmentally  it is estimated that  on
average  residential and commercial buildings
consume as high as a third of total energy
generation     recent studies         suggest
that household specific energy monitoring and
providing direct feedback  as opposed to indirect feedbacks such as monthly bills  etc  
can help reducing the energy consumption of
residential buildings by about      this could
also be used to provide important information to utilities and lawmakers who shape en 

ergy policy  energy disaggregation has been
an active area of research in the recent past 
   use sparse coding for even disaggregated
load from monthly demands  non intrusive appliance load monitoring  nialm  techniques
are among the promising monitor feedback systems  nialm is a method of evaluating total
current voltage  or power  readings in order
to deduce appliance level energy consumption
patterns  to this end  nialm monitors the total
load and identifies the certain appliance signatures  these signatures correspond to certain
 hidden  states of the appliances and can be
used to disaggregate the total load to its individual components  energy disaggregation  powered by various machine learning algorithms 
has been an active area of research              
     among all  supervised algorithms show
better performance compared to unsupervised
    algorithms  due to a prior knowledge on individual appliance energy states and signatures 
in this project  we use a mixture of supervised
learning algorithms for energy disaggregation 
we first extract individual appliance energy
states by approximating the states as a mixture
of gaussians  we then use hidden markov
model  hmm  with gaussian outputs  or emissions  to learn energy signatures and transitions
between states for each individual appliance 
we then use difference hmm  dhmm  algorithm developed by    along with a custom
viterbi algorithm to approximate the most probable sequence of hidden states for each appliance from total power consumption data  using
our model  we are equipped with a method
to provide energy saving recommendations to

fi 

consumers  energy consumption segmentation
into classes of appliances has been studied 
these methods though being both stochastically
advanced and accurate  do not help in providing
valuable recommendations to a customer  we
believe that by comparing with other households having similar energy patterns  one can
provide more relevant recommendations and
have a greater chance of behavioral change 
this is a novel feature that has not been researched much on  according to our knowledge
and is central to our recommendation scheme 
ii  a ppliance m odeling
in this section  we describe the procedure
of extracting features of energy consumption
of appliances  we use publicly available redd
dataset which contains both aggregate and individual appliance power data of   households 
we used the data from first home  measured
at every   to   sec  for our appliance level
supervised learning  we identified the major
energy consuming appliances  total of    and
extracted their power curves  to this end  for
each appliance  we chopped the power usage
for period of times in which the appliance
was on  this will provide a multi observation
sequence which can potentially result in more
accurate training  we then used a histogram
analysis to identify number of states of each
appliance and provide reasonable initial guesses
to the training algorithm  figure   a  shows
the actual power reading of dishwasher as well
as its corresponding energy histogram  this
analysis and all the following algorithms are
implemented in matlab  as shown in figure
  a   we created an energy histogram of each
appliance  normalized frequency of energy vs 
energy level  to identify the most frequent
energy levels and the standard deviation corresponding to those states  this is a crude yet
essential step for us in appliance modeling 
as it provides reasonable initial values for the
next step in appliance modeling  these results
are then fed into a hmm as initial values 
since the power readings are continuous  we

approximate the output of hmm as multivariate
gaussian  with each state corresponding to a
single gaussian   for this version of hmm 
we used the algorithm formulated by      we
briefly introduce this model here  for emission
matrix   we have i  n  i   i     the estimation formulae for the parameters of this
model can
pt be shown to be ofptthe form    
 
t  i xt
t   t  i  xt i  
pt
and i   
i   pt  
t

 i 

 i 
t
t
t  
t  
where x is the observation and i and i  are
respectively mean and variance of i th state 
t  i  is the probability of being in state i at
time t and is defined as
t  i t  i 
t  i    pn
i   t  i t  i 
where t  i  and t  i  are backward and forward variables  the other parameters  such as
prior probabilities and transmission matrix  are
similar to the case of standard hmm  the
result of gaussian emission hmm in the case
of dishwasher is shown in figure   b   this
appliance has four states and so the graph representation has four nodes  in figure   c   we
show the most probable state sequence  output
of viterbi algorithm  for the data shown in
fig    a   result show a reasonable agreement
between predicted and measured power curve 
we similarly train the rest of appliances use a
difference markov chain to disaggregation 
iii  d isaggregation
once all the appliances are modeled  the
task of disaggregation is addressed  we use
a difference hidden markov model for this 
for the disaggregation of total load  we have
two input vectors  x  time series of the total
load curve  and y time series of difference in
x for consecutive time states   i e   such that
yt   xt xt   hence this model is referred to as
a difference hmm   this is done because y is a
more important feature than the total load itself
since any change of state is an appliance results
in non zero yt values  and zero yt values for
steady operation  figure   shows the schematic
of a difference hmm where x and y are defined

fi 

figure     a  measured power draw and histogram of states for dishwasher   b state transition model   c  predicted state sequence
via viterbi algorithm

we assume that each appliance has a gaussian distributed power demand 
p wzt  zt       n  zt   z t  

   

where wzt is the actual power draw for
the appliance  then  yt can be modeled as a
gaussian distribution which is a difference of
  gaussian distributions 
figure    schematic of difference hmm

yt  zt   zt      n  zt  zt    z t   z t       
above and z is the vector of appliance states at
each time step 
for each appliance n  the
 model parame 
ters can be defined as  n     n    a n    n   
respectively corresponding to the probability
of an appliances initial state  the transition
probabilities between states and the probability
that an observation was generated by an appliance state     the probability of an appliances
starting state at t     is represented by the prior
distribution  hence 
p z    k    k

   

where k    k   k      and k and k  are the
mean and variance of the gaussian distribution
describing this appliances power draw in state
k  so far  change in state of an appliance
does not ensure that the appliance was capable
of being in the initial state  or even if the
appliance was on   we can do this by imposing
a constraint on the total power demand xt   as
a higher limit for the appliance power draw zt  
xt
n  zt   z t  dw

p  wzt  xt  zt      


the transition probabilities from state i at t
  to state j at t are represented by the transition
matrix a such that 
p zt   j zt    i    ai j

   



 
    erf
 
 



xt   z t

 zt  


   

we further need another constraint which
ensures a change of state is not predicted based

fi 

on noise in the observed total load x  in order to
achieve this  we filter out the change of states
when the joint probability is below a certain
threshold c  specific to each appliance  t  s
if
maxzt   zt  p xt   zt    zt      c

   

combining equations   through   mentioned
above  we end with a joint probability 
figure    energy disaggregation into four different appliances
 oven  dryer  microwave and refrigerator 

p x  y  z     p z    

t
y

p zt  zt    a 

t  
t
y
t  

p  wzt  xt  zt    

y

p yt  zt   zt         

ts

using equation    we can figure out the most
probable state for any appliance at a given time
t  if we know its state at t     we still do
not have a unique state change  a non zero yt
could predict change of state for more than one
appliance   in order to overcome this  we employ the viterbi algorithm  which is a dynamic
programming algorithm that returns the most
probable change of state across all appliances 
for running the custom viterbi algorithm  we
make the assumption that there can be only
one state change across all appliances  this is
a fair assumption owing to high sample rates
for the data used        seconds   only the
most likely change of state  as predicted by the
viterbi algorithm  is accepted and all others are
discarded at each time step  the results of this
algorithm are discussed in the next section 
  r esults and d iscussion
in figure    we show the total load curve
of a household disaggregated into   appliance
loads   an oven  a dryer  a microwve and a
refrigerator  the total power demand curve is
taken from one of the households in the redd
dataset  table   shows the energy usage  which
is the area under the power time curve  for
each appliance  we observe that the l  norm

dryer
oven
refrigerator
microwave

actual energy    
     
     
     
    
table i

estimated energy   
     
     
     
    

actual and estimated total energy consumption
for   appliances   oven   dryer   microwave and
refrigerator  

of the error for this example is       of the
total load curve  the results show that we have
successfully disaggregated the total load for the
building into its appliance components 
  a pplications and s cope
one application of the disaggregated data
is to provide energy saving recommendations
to individual households  this could be from
identifying inefficient appliances  better usage
recommendations such as using the washerdryer during afternoon  when the electricity
price is low  etc  one major feature required
in a recommendation system is that it should
be relevant to the consumer  in order to address this  we cluster the users into   different
clusters based on their energy habits using kmeans   algorithm  we observe that k    
gives the best results  individual household data
is obtained from pecanstreet data  which provides     homes load curves  the results are
presented in figure    the clustering of users
makes comparison within the same energy cluster far more meaningful than when done in a

fi 

figure    clustered households via k means    clustering k  
    least square error for various k values

general setting  any inaccuracies that occur in
the disaggregation algorithm can be treated as
an online learning problem within each cluster
to increase the accuracy 
  c onclusion and f uture w ork
we notice that the difference hmm modeling
approach to energy disaggregation based on
hmm appliance models has a good prediction
rate in the case of fixed state appliances  in our
example  we have an l  error norm of      
of the total load  it should be noted the power
surge that typically occurs when appliances
start from the off state is not explained using
the current model  further  infinite state devices
 such as dimmer lamps  cannot be modeled
accurately using a finite state hmm model and
hence  their contribution is not disaggregated
accurately  further  we state a feasible application for the work carried out  in the form of a
novel energy saving recommendation provider
by comparing households with similar energy
patterns 
r eferences
    k carrie armel  abhay gupta  gireesh shrimali  and
adrian albert  is disaggregation the holy grail of energy
efficiency  the case of electricity  energy policy        
          
    d kelly and w knottenbelt  disaggregating smart meter
readings using device signatures  imperial computing
science msc individual project       
    j zico kolter  siddharth batra  and andrew y ng  energy
disaggregation via discriminative sparse coding  in advances in neural information processing systems  pages
               

    j zico kolter and tommi jaakkola  approximate inference
in additive factorial hmms with application to energy
disaggregation  in international conference on artificial
intelligence and statistics  pages                
    oliver parson  siddhartha ghosh  mark weal  and alex
rogers  non intrusive load monitoring using prior models
of general appliance types       
    lawrence r rabiner  a tutorial on hidden markov models
and selected applications in speech recognition  proceedings of the ieee                     
    ahmed zoha  alexander gluhak  muhammad ali imran 
and sutharshan rajasegarar  non intrusive load monitoring
approaches for disaggregated energy sensing  a survey 
sensors                          

fi