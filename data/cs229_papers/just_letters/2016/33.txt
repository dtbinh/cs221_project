automatic segmentation and diagnosis of
mass lesions in mammograms
margaret shen  marshen   william du  willadu 
introduction
according to the national breast cancer foundation  one in eight women in the u s  will be diagnosed with breast cancer and
over        of them will die from the disease every year  only    of women who are diagnosed at the latest stage of cancer will
survive past   years   thus  an important step to reducing mortality rates for breast cancer patients is detection of cancer at an
early stage  this includes more common and more accurate screening  the most effective method for screening patients for breast
cancer is screen film mammography  identification of lesions in breast mammograms typically requires expert radiologists who
undergo years of training  however  interpretation of mammograms is still very difficult and an error prone task  they have a false
negative rate of around     and a false positive rate of up to      due to factors such as dense breast tissue  
computer aided detection  cade  systems help identify areas in mammograms that may be cancerous that the radiologist may
have missed  previous literature has shown rapid improvement in automatic detection for microcalcifications   another symptom
of breast cancer  yet progress in detection of mass lesions has remained stagnant  masses are often more difficult to detect because
they are typically indistinguishable from dense breast tissue  can have low image contrast  and may be connected to surrounding
breast tissue   in this paper  we will explore the task of segmentation  a crucial part of a cade system  which provides a high
resolution outline of a cancerous region  region of interest  roi   using convolved and filtered images  we build a classification
model that outputs whether or not a voxel is part of a mass lesion  using these classifications  we generate a candidate roi for
each image  computer aided diagnosis  cadx  systems usually are found in tandem to cade systems   computer aided diagnosis
systems help classify lesions as benign or malignant  in this paper  we extract textural characteristics and tumor characteristics
from rois to classify lesions as benign or malignant  we explore cade and cadx simultaneously using machine learning to
produce a tool that radiologists may use to inform their decision process and ultimately provide more accurate diagnoses 

data   methods

and lowers variance  textural  edge  and simple features are
generated for each voxel 

data

extracting features for detection

the dataset provided by dr  daniel rubin  md   assistant
professor of radiology  contains      mammograms from the
digital database for screening mammography  ddsm  dataset 
    of these mammograms are from the cranial caudal  cc 
view  the view of the breast from above  the remaining      are
from the medio lateral view  mlo  view  a side angle view  we
exclusively use images taken from the cc view to test and train
our automatic segmentation methods  both mlo and cc
features are used to test and train the diagnosis model for mass
lesions  for all mammograms  we have lesion rois annotated by
 rd party state of the art segmentation software      gold
standard radiologist rois were provided for    mlo and   
cc images 

for each cropped image  we generate    features for each
voxel in the image by creating    different filtered and convolved
images from the original  the features are enumerated as follows 
  basic features represent local data associated with a voxel
and or its neighbors  these features are intensity  local entropy 
local standard deviation  local range  and local average  where
the latter four are statistics calculated from the   by  
neighborhood around the image that help describe textural
features around a voxel 
  difference of gaussian filters are applied as features that
detect edges and remove noise 
   permutations of gabor filters are used to detect edges
with respect to orientation 
finally  an additional filter  composed of average intensity
over superpixels was calculated  superpixels are generated by
clustering voxels that are similar in intensity and spatially
adjacent  
these features were selected for their ability to help define
edges  characterize local texture indicative of mass lesions  and
most importantly  incorporate local information into each
observation of a voxel  thus  even as the classifier is trained on
each voxel  information from the neighborhood of each voxel is
incorporated as its features 

computer aided segmentation
each mammogram has an associated detection roi 
annotated by radiologists  which is a general circle placed around
a region that contains a mass lesion  we use this circle as a
bounding box and crop our image to that general region  in this
case the tumor has been detected  thus our associated problem is
segmentation of the tumor within this region  we preprocess the
image to enhance contrast before extracting features  for this
segmentation problem  we exclusively use the subset of cc
images that have radiologist gold standard rois available
 n     
we approach the segmentation problem as a classification
problem by treating each voxel of a mammogram independently
and associating it with a lesion or non lesion label  although we
make the assumption that each of the voxels in an image are
independent  a high bias assumption  it significantly expands our
sample space from n    patients to n    million training voxels

training classifiers and testing for detection models 
after feature extraction  each voxel is associated with   
features and a label that indicates whether it is part of a mass
lesion or not  using these voxels as individual samples we train
classifiers that takes in these    features and outputs a label
representing if the voxel is part of a lesion  the classifiers we
focus on in this paper are decision trees  and naive bayes 

fimaking the number of samples used as input high 
for each fold  approximately    million voxels
are used as training samples 

post processing rois 
the classifier produces a   dimensional
representation of a binary mask that can be
rehydrated into a   dimensional binary mask  to
retrieve the roi of the tumor from the mask  we
consider the largest connected component within
the binary mask as the tumor volume  where
connections are defined as the   connected
neighborhood of a voxel  holes and gaps within
the mask are filled  all other connected
components are discarded 

computer aided diagnosis

figure    main methodology for learning pipeline in the supervised
segmentation pipeline  images are preprocessed then cropped  then features
are extracted by using image convolution  a visualization of the feature
extraction pipeline follows  the image is then collapsed into a voxel feature
matrix and then fed into the learning algorithm 

given a mammogram and the segmented area
for the tumor  the goal is to classify the tumor as
either malignant or benign  the segmented area
was obtained with a third party segmenting
software and not our own implementation so that
we were training the classification model on a
more reliable image  the total number of samples
used for classification was m        which
included all samples which had both a cc view
and mlo view  as well as corresponding mask
rois for each  because the number of samples
which were missing the mlo view was less than
    of the total sample size  we decided to
remove those samples instead of imputing the
relevant feature values and risk dampening the
value of the mlo image features  each sample
was composed of    total features     cc view
image features     mlo view image features  and
   binarized radiologist annotated features 

image features 
image features were chosen based on literature
review  these features fall under three main
categories 

segment shape properties  eg  tumor volume 
tumor length width

voxel properties  eg  max intensity  voxel
value   min intensity  average intensity

texture properties  eg  entropy  contrast 
homogeneity
image texture properties were largely derived
from haralicks oft cited textural features for
image classification  this set of features is
widely used in any medical imaging application
figure    visualization of methodology for cadx  the roi is first isolated from
involving
supervised learning and classification  
the raw mammogram  then image features are combined with annotated
each value was calculated only for the segmented
features and fed into a learning algorithm for classification  results are verified
region  which was isolated by applying a bitmask
with cross validation 
with the region outline over the original
mammogram image  segment shape properties
were
normalized
by the bounding box area for the roi 
logistic regression and linear discriminant analysis were tested
but did not produce meaningful segmentations compared to the
annotated features 
aforementioned algorithms  although the dataset itself is large 
radiologist annotated features included the following 
validating and training a segmentation model is reliant on
radiologist rois  only    cc mammograms are annotated with
 shape of the mass lesion     categories  e g  lobulated 
radiologist rois  thus we choose to perform   fold validation
irregular  asymmetric 
on this image set  however  while the number of images that
 marginal characteristics of the mass legion     categories
available is relatively small  the classifier is trained on voxels 
 e g  circumscribed  microlobulated  spiculated 

firesults
evaluation of machine learning
models for computer aided
segmentation
rois generated by our approach were
evaluated
using
the
sorensen dice
coefficient against existing radiologist goldstandard rois 
we tested both models  naive bayes and
decision tree  using   fold cross validation
against the radiologist gold standard rois 
the mean dice score over the   fold cross
validation was       for the naive bayes
model and      for the decision tree model 
the max dice score for each model was     
and      respectively  and the minimum
score for each model was    indicated that
there were some images that were completely
misannotated  only three images were
completely misannotated out of all   
samples  thus  the segmentation algorithm
detected at least part of the mass lesion as
annotated by the radiologist in     of the
samples  we can examine a variety of the
segmentations in figure   

evaluation of machine learning
models for computer aided
diagnosis
figure    sample segmentations produced by the models learned on
convolutions of mammograms  the first column are the gold standard
segmentations produced by radiologists  the second column are segmentations
produced by the naive bayes model  the third are segmentations produced by
decision tree  the dice scores are as follows  nave bayes decision tree   a 
             b               c              




subjective visibility of the mass
relative density of the surrounding breast tissue

because the first two feature types were qualitative and had
no meaningful analog to ordinal rankings  each separate
category was treated as its own binarized feature 
a variety of classification methods were tested and tuned
using k fold cross validation  including logistic regression  knearest neighbors  decision tree  random forest  and naive bayes 
all features were normalized on a   to   scale while testing
various classification methods  but original values were used
when tuning the final chosen model  random forest  since it is
invariant to monotonic transformations of feature values 
for the random forest model  we used the tree bagging
algorithm with the random selection of a feature subset at each
split in the learning process  we tuned the following
hyperparameters  number of trees to use  number of features to
samples at each split  mean decrease impurity was used to
determine the most important contributing features to the
classifier  in addition  we also trained the model on various
subsets of the features to determine which broad categories of
features would be most useful to radiologists 





random forest outperformed our other
classification algorithms in terms of both
training error and test error  the out of bag
error after training on all m       samples
and the full feature set of n      was        
below are the average test errors with    fold
cross validation using different combinations
of features 

 all features        
cc image features and annotated features        
cc image features only        
mlo image features only        

tuning for the number of features to sample at each split
with k fold validation as well  the optimal value was the square
root of the number of features  approximately    this yielded the
lowest average k fold test error with a standard t       trees 
figure   graphs the results for tuning for the number of trees 
using   features to sample at each split  the optimum tree
number was     
predicted
predicted
positive
negative
actual
  
  
positive
actual
 
  
negative
figure    confusion matrix for a random k fold
of random forest for tumor diagnosis    
samples total in the fold 

fi   major axis length of the ellipse that has the
same normalized second central moments as the
roi in the cc view
the average errors with k fold cross
validation for other algorithms is as follows
 matlab implementation in parentheses  
   logistic regression  fitglm with binomial
distribution         
   linear discriminant analysis  fitcdiscr  
      
   naive bayes  fitcnb         
   k nearest neighbors  fitcknn         
   decision tree  fitctree         

discussion
work

and

future

computer aided segmentation
one of the main assumptions made in the
segmentation process is that voxels are
independent  and are only tied by information in
their feature matrices  although this is a highfigure    tuning the number of trees for the random forest model  the
bias assumption it allows us to significantly
lowest point in the graph  lowest error  is at t     
expand our training set size from n    to n   
million  by increasing the number of samples 
we hope that the decrease in variance overcomes
the high bias assumption 
evaluating the segmentations  we see that
decision trees performed on average better than
naive bayes evaluated by mean dice scores 
examining specific cases  we note that the mass
lesion that are well defined by contrast are
exceptionally annotated by the segmentation
algorithm  mass lesions that were adjacent to
dense breast tissue  which much of the time 
presents itself similar to mass lesions  were more
generously segmented in comparison to the
radiologist roi  one common influence on the
dice score revolves around the specificity of the
machine learning segmentation  radiologist are
more likely to provide much more general
segmentations with regard to edge than to those
annotated by the the machine learning
segmentation  because of this  an automatic
segmentation may appear to segment the correct
region  but its dice score may be lower than
expected  the results show promising
performance in the mass segmentation
figure    the out of bag classification error decreases then plateaus with the
algorithm that can help radiologists interpret
number of grown trees  this is for a randomly selected k fold with the full
their mammograms and help computational
feature set 
biologist extract quantitative features as used in
the diagnosis framework presented  future
exploration of unsupervised learning provides another avenue to
top   determining features based upon mean decrease
approaching the segmentations of mass lesions in mammograms 
impurity for a random k fold 
  
  
  
  
  

microlobulated mass margin
tubular mass shape
irregular mass shape
ill defined mass margin
max intensity in the roi of the cc view

in this work  a region of interest is already identified by a
radiologist and thus  the segmentation algorithm is run on
images that have been cropped from the complete mammogram 
a mass detection algorithm paired with the segmentation
algorithm would allow for a more seamless computer aided
detection process  a powerful tool that could increase the success
of early breast cancer diagnosis 

ficomputer aided diagnosis
the test error of our best performing model  random forest 
was         this was a vast improvement from our milestone
error which was based on logistic regression          samples
were malignant  and         were benign  so our training set
was fairly balanced to begin with  it is important to note that the
image area which our algorithm inspected is based upon a thirdparty segmentation software  so there is no guarantee that the
excised area represents the true properties of a mass  for
example  one of the features is volume of the tumor  represented
by a count of the voxels in the segmented region   if the image
segment only contained a portion of the true tumor  or contained
a large area outside of the tumor  this feature would be less
reliable and informative  there was not a sufficient amount of
gold standard radiologist segmentations to use for classification 
another metric to evaluate these results is the confusion
matrix  we can see that for a randomly chosen k fold  the false
negative rate was        compared to a false positive rate of
     this is preferable to the opposite  since it is safer to let a
patient know she may have breast cancer when she doesnt
instead of letting her know she does not have cancer when she
does  since our overall accuracy is         these high false
positive negative rates are expected 
it is interesting to note that classification with decision trees
using only mlo view image features performed significantly
worse than using only cc view image features  this may imply
that mammograms from the mlo view obscure the mass lesion
more  making it a poor tool for diagnosis  using both annotated
features and cc view features performed almost as well as using
the full    features  the importance of the annotated features
demonstrates that cadx is perhaps best used as a tool that will
supplement radiologists for the time being  but not replace them 
this is also reflected in the top features  which could be
useful for radiologists in determining what factors to weight
when classifying tumors by hand  one important caveat to the
mean decrease impurity method for selecting good features is
that correlated features may be down weighted  thus there could
be features correlated with the top   which are just as important 
but are lower in the ranking  none of the top   most important
features in the random forest originated from the mlo image
features  a microlobulated mass margin was the most significant
feature used in classifying a mass lesion as malignant  one
interesting finding was that a tubular mass shape and major axis
length were both in the top six features  the former is an
annotated feature  and the latter is computed from the image 
but a tubular mass shape implies a long major axis  this
reinforces our hypothesis that our image feature extraction has
the potential to replace human annotations  at least for some
characteristics 
in the future  it would be interesting to explore other features
that were not limited to the breast tissue  studies have shown
there are strong correlations of age  race and family history with
breast cancer  
another future direction would be to explore the use of
convolutional neural networks  cnns   which would directly
take as input the raw image roi  since there are so many
possible textural features and other measurements that can be
taken from an image  it is very time consuming to select these
features by hand  the downside would be that the model can be
difficult to interpret  it would be impossible for radiologists to
learn what characteristics of a mass lesion are most important in
diagnosis 

acknowledgements
advised by and data acquired through daniel rubin  md 
assistant professor of radiology and medicine  thank you to
prof  john duchi and the cs     staff for their guidance 

references
    donepudi  m s   kondapalli k    breast cancer statistics and

markers   national center for biotechnology information 
u s  national library of medicine  n d  web     june      
    johns  louise e   and sue m  moss   false positive results
in the randomized controlled trial of mammographic
screening from age      age  trial    cancer epidemiol
biomarkers  nov        web     june      
    i  el naqa  yongyi yang  m  n  wernick  n  p  galatsanos
and r  nishikawa   support vector machine learning for
detection of microcalcifications in mammograms  
biomedical imaging        proceedings       ieee
international symposium on        pp          
    dheeba  j   n  albert singh  and s  tamil selvi   computeraided detection of breast cancer on mammograms  a
swarm intelligence optimized wavelet neural network
approach   journal of biomedical informatics           
       web 
    ravin  car e   computer aided diagnosis  breast imaging  
carl e ravin advanced imaging laboratories  n p   n d 
web     june      
    r  achanta  a  shaji  k  smith  a  lucchi  p  fua  and s 
susstrunk  slic superpixels  technical report  epfl       
    haralick  robert m   k  shanmugam  and its hak dinstein 
 textural features for image classification   ieee
transactions on systems  man  and cybernetics ieee trans 
syst   man  cybern                     
    genuer  robin  jean michel poggi  and christine tuleaumalot   variable selection using random forests   pattern
recognition letters                         web 

fi