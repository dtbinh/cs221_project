 

resampling detection for digital image forensics
john ho  derek ma  and justin meyer

abstracta virtually unavoidable consequence of manipulations on digital images are statistical correlations
introduced between the pixels  these correlations may not
be visible to a human  but can be detected by statistical
techniques  this paper presents a machine learning based
approach to image resampling detection based on the
detector by popescu and farid  we investigate ways
to improve robustness and detection accuracy by using
supervised learning techniques 

i  i ntroduction
with the proliferation of digital images and powerful image editing tools such as photoshop  it has
become increasingly easy to manipulate images to
alter content and meaning  digital image forensics
seeks to authenticate image based on statistical
patterns left on an image by tampering  in     
popescu and farid introduced a forgery detector by
based on the correlations introduced between pixels
by resampling  that is  the operation of stretching 
shrinking  or rotating an image  since objects in
images are often on different scales  resampling is
necessary to create a visually convincing forgery 
however  resampling imposes periodic correlations
between pixels that otherwise do not exist  these
correlations can estimated by a learning algorithm 
in order to determine if the image has been
resampled  the found correlations must be passed
to a classifier  the classifier by popescu and farid
characterized resampling by constructing a database
of synthetic maps for different resampling ratios 
this has the advantage of being conceptually simple  but requires an exhaustive database and does not
take into account the fact that natural variations can
be learned  in this paper  we show that a supervised
classifier can improve the detectors accuracy and
allow it to work in a much more general setting 
the paper is organized as follows  section ii
describes the basis of correlations introduced by
resampling and the em procedure used to determine
the correlation between pixels  section iii presents
submitted november          for cs    machine learning  prof 
andrew ng  stanford university 

a supervised learning approach to classification  finally  section iv presents the results of our classifier
and compares it with the performance by popescu
and farids classifer 
ii  d etecting r esampling c orrelations
a  resampling
resampling causes certain pixels be a linear combination of its neighbors  these pixels are correlated
with its neighbors and will appear periodically in
the resampled image  for each pixel  we define its
neighbors to be all pixels within a window of length
 n     
resampling by a factor p q can be represented
by the linear equation  y   ap q  x  where p and q
are integers   y the resampled signal   x the original
signal  and ap q  rnm the resampling matrix 
for example  consider the case of p q      the
resampling matrix is given by


a   




 




   
 
         
 
 
     
         
 
 
 
  
   
 





 




it can be seen that the odd samples do not change
while the even samples are linearly dependent on
their neighbors  we have
y i    xi
y i      xi      xi  
for i              m  this implies that
y i       y i       y i    

   

so  for this case  every even sample is exactly the
same linear combination of its neighbors 

fi 

 a 

  

  

 o

  

  

 o

   

   

  o

   

   

  o

 b 

 c 

fig     image  probability map  and periodicity map for  a  upsampling   b  downsampling  and  c  rotation  the classifier must be able to
distinguish between natural peaks in the image and those introduced by resampling 

let m  be the set of samples that are correto generalize this to a signal resampled by an
lated to their neighbors and m  the set of samples
arbitrary p q it is necessary to determine when
not correlated to their neighbors  em is used to
n
x
  and a soft assignment
k yi k
    simultaneously estimate 
yi  
pr y

m
 
for
each
pixel yi since neither is
i
 
k n
known  the output of the em algorithm is a set
where k is the set of weights across the neighbor  of coefficients 
  and a probability map p   the
hood 
complete algorithm is given in appendix a 
let  ai be the ith row of the resampling matrix
for faster computation of the probability map 
ap q   it can be shown that     holds when
the em algorithm can be applied to only a random
subset of the blocks in the image to train the weights
n
x

 ai  
k ai k  
        once the weights are weights are found  p can
be quickly computed everywhere  we found that this
k n
does not significantly change the probability maps 
that is  a resampled pixel yi is correlated with
random block sampling was used throughout our
its neighbors whenever its corresponding row of
experiments 
the resampling matrix ai can be written as a linear
combination of its neighboring rows         this c  periodicity
will lead to periodic correlations between resampled
neighboring pixels can be naturally correlated
pixels since the resampling matrix is periodic 
based on the statistics of the natural image  however  it is unlikely that these correlations are perib  expectation maximization
odic  to detect periodicity  fourier transform of the
if the resampling matrix ap q is known  the probability map is taken  we refer to the magniproblem is simply that of finding a set of weights 
  tude of the transform as the periodicity map  the
that satisfies     for a subset of rows  however  in periodicity map is typically high pass filtered in
practice  the sampling factor p q and interpolation order to suppress the natural dc peak  in      a
method are not known  popescu and farid de  peak detection algorithm is also described in order
scribe an expectation maximization  em  algorithm to enhance the peaks and suppress energy due to
natural correlations in the image 
to learn the weights 
  

fi 

table i
t raining r esampling r ates  

iii  s upervised l earning
given a periodicity map  we want to determine if
the image has been resampled or non resampled  in
     an exhaustive database of synthetic maps was
generated for various resampling ratios  a periodicity map was then classified by k nearest neighbors
 knn  with k     for a similarity score  while this
yields reasonable accuracy  the knn classifier does
not work in a general setting with arbitrary block
sizes and resampling ratios 
we train a support vector machine  svm  to
classify a periodicity map as resampled or nonresampled  figure   shows the probability and periodicity map for different images and resampling
ratios  there are distinct peaks that appear when an
image has been resampled  the classifier must be
able to distinguish between natural peaks in the periodicity map from those introduced by resampling 
we extract the following   features from the
periodicity map 
   n largest coefficients  higher peaks tend to
indicate resampling  the coefficients ci are
sorted by magnitude and aggregated to a single feature
f   

n
x
p
m
 ci   

   

i  

   n largest coefficients after peak detection 
the peak detection algorithm used in     is
applied to the periodicity map  the sorted
coefficients c i are aggregated by
n
x
p
m
f   
 c i   

   

i  

   n largest coefficient distance from center 
peaks in natural images tend to be concentrated in low frequencies  the positions
 ui   vi   are used to compute
n q
x
f   
u i   vi   
   

upsampling ratio
downsampling ratio
rotation    

start

step size

end

    
   
 

    
    
 

   
    
  

   peak to total energy ratio  the ratio r was
scaled by
f         r m       

   

since all the features are non negative  they are
scaled to         we selected n     coefficients and
a scaling factor of m      libsvm was used with
the radial basis kernel     
a  experiment setup
for the test images  we use the uncompressed
kodak photocd set of    images  these images
are not compressed and are true color  that is  free
of demosaicking  which can also introduce linear
correlations      for simplicity  we extract the green
color channel from the image to obtain a grayscale
test image  we used a        window size  which
is significantly smaller than          used in     
smaller block sizes can better localize tampering 
but result in peaks that are less distinct 
for each resampling operation  we first randomly
select an image on which to apply resampling
and then randomly select a window within the
resampled image  the resampling ratios used in
training are shown in table i  in order to obtain nonresampled samples  the images are divided into nonoverlapping blocks  we used     of the images for
training and     for testing  since false positives
are highly undesirable in a forensic setting  the
parameters of the classifier are set to have no false
positives over the training set 
we also implemented the knn classifier in    
for comparison  the database consists of synthetic
maps using the same resampling ratios in table i 

i  

   n largest coefficient to local energy ratio 
iv  r esults
the ratios ri are computed for a local recta  classification results
angular window of width w and aggregated
the overall recall and precision rates for our clasby
 m
n
sifier
are shown in table ii  there is only one false
x
f   
    ri
     
    positive        over the test set  the performance
i  
of the svm classifier is compared to the knn

fi 

table ii
r ecall and precision rate for svm classifier  
   

non resampled

resampled

recall
   

       
      

       
      

precision
   

       
       

       
       

 

  
  
  
  
 
 

  

  

  

  
  
upsampl i ng    

  

  

  

   

 

  
  
  
  
 
 

 

  

  

 

  

  

  
  
d ownsampl i ng    

  

  

  

  

  

  

  

  

   

 

  
  
  
  
 
 

  
  
r otati on    

fig     recall rate for the svm classifier  black solid  and the
knn  dashed gray  classifier  the false positive rate for both cases
are      

classifier over a wide range of resampling ratios in
figure    the threshold of the synthetic classifier
was set to have a similar      false positive
rate  our classifier clearly outperforms knn at low
resampling rates  which compared to results in    
suffers from the smaller block  it has comparable
accuracy to knn at large resampling ratios and can
detect some highly downsampled images where the
knn classifier has zero recall 
figure   shows the training set features projected
onto the first two principal components  the upsampled and rotated data are clearly separable from
the non resampled data  but the down sampling data
appears to be clustered  this is due to fact that
downsampling peaks in the periodicity map are
indistinct and can be buried in the natural image
correlations  interestingly  it also appears that upsampled and rotated images can be distinguished
from one another 

   
nonresampled
upsampled
downsampled
rotated

   

   

   

 

   

   

   

 

   

   

   

 

 

   

 

fig     training set features projected onto the first two principal
components   and     the upsampled and rotated data is clearly
separable from the non resampled data even in low dimension  but
downsampled data is difficult to separate 

b  detection example
figure   shows how the svm classifier could be
used to perform tamper detection in a more general
setting  a beach scene contains an image of prof 
andrew ng of stanford university that has been
upsampled and inserted into the foreground  several
regions in the image are selected over which the
periodicity maps are computed  the features are
extracted from the periodicity maps and passed to
our classifier  which determines if the region has
been resampled  the classifier successfully distinguishes the resampled and non resampled regions 
if not computationally prohibitive  a sliding window
could be used to perform detection at every location
in the image to enable automatic detection without
user input 
v  c onclusion
in this project  the popescu and farids em
algorithm for learning correlations between pixels

fi 

 a 

 b 

fig      a  tampered image and  b  probability map and periodicity map for four blocks  the classifier correctly determines that the red
block has been resampled and the remaining blocks are not resampled 

was implemented and tested for a smaller block
size  an svm classifier was trained to determine if
the correlations found by the em algorithm result
from resampling  this classifier was shown to have
better performance than the knn classifier at low
resampling rates and does not require and exhaustive
database of synthetic maps 
a ppendix a
the expectation step consists of assigning
pr yi  yi  m   pr yi  m   
p 
k   pr yi  yi  mk  
   
where pr yi  m      pr yi  m          
the model m  is assumed be normally distributed
pr yi  m   yi    

pr yi  yi  m     
 yi 
 
 exp 
  

pn

  k yi k   
k n 
   

 
    

and m  uniformly distributed pr yi  yi  m     
  n where n is the range of the pixel values 
the maximization step reduces to finding the
parameters 
  by weighted least squares

     y t w y    y t w  y

    

where the rows of y are the blocks in the image
with the center value removed and w is a diagonal

matrix with diagonal elements equal to pr yi  yi 
m    
the em steps are iterated until    
 i   
 i        
where 
   i  is the set of weights obtained from the
th
i iteration 
r eferences
    a  popescu and h  farid  exposing digital forgeries by detecting
traces of resampling  signal processing  ieee transactions on 
vol      no     pp            feb       
    m  kirchner  fast and reliable resampling detection by spectral
analysis of fixed linear predictor residue  in proceedings of the
  th acm workshop on multimedia and security  ser  sec    
new york  ny  usa  acm        pp       
    c  c  chang and c  j  lin  libsvm  a library for support
vector machines  acm transactions on intelligent systems and
technology  vol     pp                   software available at
http   www csie ntu edu tw  cjlin libsvm 
    a  popescu and h  farid  exposing digital forgeries in color
filter array interpolated images  signal processing  ieee transactions on  vol      no      pp              oct       

fi