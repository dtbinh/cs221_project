predicting intraday price movements in the
foreign exchange market

noam brown
robert mundkowsky
sam shiu

abstract
it is commonly assumed that short term price
movements follow a random walk and cannot
be predicted  however  in this project we
predict next second price movements in the
euro dollar foreign exchange market by using
depth as a feature  we show that if there is
a sufficient imbalance in depth  an accurate
prediction can be made  further  we train
and test a markov model to demonstrate that
this predictive potential can overcome transaction costs to be profitable 

   data
our data consists of a   second time series of prices
and quotes in the euro dollar foreign exchange market  all prices are measured in dollars per euro  the
data spans from   february      to    march      
resulting in about     million observations  since the

foreign exchange market is open    hours a day   days
a week  we have access to many millions of observations  the earlier     of the observations were used
for training  with the remaining     used for predictions 
unlike most financial market data  our dataset includes a complete aggregate of the bid and ask depth
at each second  measured in millions of euros  that
is  we know the combined size of standing requests to
buy  bid  or sell  ask  at almost any given price  this
data will form the basis for the key features we use in
our predictions 
a price decrease can only occur after all the bid depth
at a given level is exhausted  likewise  a price increase
can only occur after all the ask depth at a given level
is filled  it seems logical  then  that market depth
would influence the short term movement of prices 
suppose the current best bid price at time t  measured in seconds  is pbt with depth dbt and the current
best ask price at time t is pat with depth dat   intuitively  one would think that if dbt    dat   then
p  pbt     pbt     p  pat     pat    that is  if there are
far more people trying to buy at the bid than there
are people trying to sell at the ask  then we expect the
bid is relatively less likely to go down in price than the
ask is likely to up in price  this is because there is less
resistance to an upward movement than a downward
movement  this will be the central approach to our
predictions 
     feature selection
following the convention of the literature  instead of
attempting to predict the next transaction price we instead attempted to predict the next mid quote  this
mid quote gives a more stable measure of price move 

figure    distribution of magnitude of depth 

fipredicting intraday price movements in the foreign exchange market

figure    random sampling of upticks  blue  vs downticks
 red  across depth  note that downticks are more prevalent
when ask depth is higher 

figure    a moving average of perceptron predictions of
next second price movements using only bid and ask depth
as features 

   perceptron model
 

ments in the market  it is calculated by averaging the
highest bid and the lowest ask  for convenience  we
will still use p to represent the mid quote and refer to
it as the price  since we know what the current price
is  we actually need only predict the change in midquote p  this change in price is measured in pips 
which are ten thousandths of a point          of these
changes are positive in the training data  while      
are negative 
we included a total of three features in our predictions  two critical features are depth at the highest
bid db   and depth at the lowest ask da   previous literature has shown that at high frequencies  there is
some mean reversion  we confirmed this by running
an autoregression on the mid quote series  therefore 
we also included the previous change in price pt 
as a feature in the markov model 
we also considered using other available features  including the spread    trade volume in the last second 
trade volume in the last minute  and pt    however 
none of these features contained significant predicting
power 
 
trades occur anywhere between the highest bid and
the lowest ask  inclusively  thus  even if the bid and the
ask do not move  oscillations in trade prices between the
bid and the ask can give the illusion of movement 
 
an increase in the exchange rate from        to       
is an increase in one pip 
 
the distance between the highest bid and the lowest
ask 

as a first step  we attempted to simply predict the
direction of future price movements using a perceptron
model  we scored our results only on seconds when
there was an actual price movement  without any
further constraints  this method obtained a prediction
accuracy of     
however  in the market it is not necessary to trade
constantly  instead  one can choose to only trade when
there is a certain degree of confidence  with this in
mind  we restricted our predictions to only scenarios
where there is a significant depth imbalance  we chose
a threshold of     million euros   with this further
restriction  our model achieved a prediction accuracy
of     making predictions on     of observations that
had a price movement 
we also attempted predictions on time horizons
greater than   second  however  the accuracy of our
predictions fell off quickly as we moved beyond   second  as shown in figure    at   seconds  the accuracy
fell to      at   second it fell to      and by   seconds
our features had no predicting power  this is reflective of the fast pace of the foreign exchange market 
indeed    second itself is considered a large interval by
traders 

   markov model
for our perceptron algorithm  we restricted our predictions to only situations where we were confident in
our results  this raises the obvious question   what
confidence threshold is optimal  to answer this ques 

fipredicting intraday price movements in the foreign exchange market

buy
nothing
sell

long
n a
long
neutral

neutral
long
neutral
short

short
neutral
short
n a

table    action position transition matrix 

buy
nothing
sell

long
n a
 
    

neutral
    
 
    

short
    
 
n a

table    action cost matrix 

figure    accuracy attempting to predict over different
time horizons  performance falls off quickly 

uptick
nothing
downtick

long
    
 
     

neutral
 
 
 

short
     
 
    

tion  we constructed a markov model with rewards and
costs to simulate market conditions 

table    position reward matrix 

since we incorporated costs for acting on a prediction 
it no longer made sense to evaluate a model based on
prediction accuracy alone  after all  the model may
accurately predict a price movement  but believe that
the transaction cost of acting on that information outweights the expected value gain of the movement itself 
instead  we evaluated our model based on a theoretical profit  considering both rewards and costs  that
the model would seek to maximize 

matrix to    x     our transition probability matrix
was created by observing the     million transitions
among these states in the training data  every state
was reached at least once 

     state space
our markov model contains a   dimensional state
space consisting of bid depth  ask depth  change in
price since last second  and position  position can
take one of three discrete values  long  neutral  and
short  this represents whether we have bought euros 
sold euros  or do not hold any euros  the position
dimension is obviously central to our reward calculations  bid depth and ask depth were discretized into
  buckets each  change in price since last second was
discretized into   buckets  positive  negative  and zero 
this amounts to     different possible states 
due to the very high liquidity in the euro dollar foreign
exchange market and the small quantities our model
trades  we can safely assume that our actions do not
significantly affect the market  that is  whether we
are long  short or neutral has no bearing on if the
price goes up or down  or if the depth increases or
decreases  therefore  the position state dimension is
independent of the other three  since the dimension
is independent  it need not be included in the transition probability matrix  this reduced our transition

as a small test  we repeated our attempt to predict the direction of price movements  this time using the markov probability matrix  that is  given a
bid depth bt   ask depth at   and previous price movement lt   we calculated the corresponding state st   and
checked whether we were more likely to transition upward  to a state with a positive previous price movement lt        or downward  to a state with a negative previous price movement lt         that is  we
compared p  lt        to p  lt        and predicted
whichever was more likely  to improve our confidence
in the result  we required a depth imbalance such that
bt    at in order to make a prediction  testing on
our prediction set  we achieved     accuracy making
predictions on     of the observations that had price
movements  and     of all observations  consider
the number of predictions made  this is about equivalent to our results with the perceptron algorithm  although some information was lost in the bucketing of
the depth  it is possible that the ability to model the
data as non linear countered that loss 
we also included   actions  buy  sell  or do nothing 
buy and sell will transition the position as shown in
table    we assume that each purchase is for   million
euros  the smallest amount allowed in this market  to
keep our market impact assumption realistic  we disallowed the model from further buying in a long position
or further selling when in a short position 

fipredicting intraday price movements in the foreign exchange market

     rewards and costs
even though we are able to predict the direction of
price change with greater than     accuracy  it may
often not be profitable to act on this information 
this is because there are inherent transaction costs in
any purchase  the most significant transaction cost 
particularly when trading at high frequencies  is the
spread   in the euro dollar market  the spread at normal trading hours is almost always   pip  therefore 
we assumed that any trade has an immediate cost of
    pips  so that a buy and a sell combined equals the
cost of a typical spread  since our transactions are always to purchase   million euros  this cost amounts to
     this is shown in table   
our reward function was chosen to resemble profitability in the market  if we are in a long position  then we
profit from upticks  positive changes in price  and lose
money on downticks  similarly  if we are in a short position then we profit from downticks and lose money
on upticks  the models knows if it is long or short
based on the position dimension of the state  likewise  the model knows if there has just been an uptick
or downtick based on the change in price since last
second dimension of the state  thus  the reward for
any state can be determined from these dimensions 
as shown in the table    to simplify the training of
our model  all rewards have a magnitude of      pips
       this is the average magnitude of upticks and
downticks in our data set 
thus  the value function for state st defined by its
dimensions  position pt   bid size bt   ask size at   and
last price move lt is given by
vst   rpt  lt   

x

 p  b  a  l bt   at   lt   vs  cp pt   

s

where p  b  a  and l are position  bid depth  ask depth 
and last price respectively  rpt  lt is the reward for being in position pt when there was a price movement
of lt   and cp pt is the cost of transitioning from position pt to p  either     or     vs is initialized at rp l  
we used synchronous value iteration until the value
matrix converged 
     results
our test set contained         observations  using
the converged value matrix as a guide for actions  the
markov model generated a theoretical gross profit of
 
the spread is the difference between the bid price and
the ask price  and is always non zero  thus  if one were to
simultaneously buy and sell in the market  there would be
a net loss equal to the spread 

         on      trades  since each trade cost     
this amounted to a net profit of          or        day 
the net profit per trade was     
we also tried expanding the model to include the
depth immediately below the best bid and above the
best ask  this added   additional dimensions to the
state space  to keep the problem tractable  these two
additional dimensions were discretized into two buckets  less than the depth below above it  or greater
than the depth below above it  this resulted in a state
space of      states  although only     were used in
the transition matrix  with this expanded state space 
the net profit was slightly higher at         on     
trades 

   conclusion and future work
there are many factors that this model does not consider  such as execution delays  market impact  and
transaction costs other than the spread  it is unlikely
that this model would generate such substantial profits
in practice  in particular  it would be better to model
the movement in bid price and ask price separately 
rather than just modeling movement in the mid quote 
since trades for this strategy would happen at the bid
and the ask  this would give more accurate estimates
of the profitability of the system 
there is also room to improve the predictive power of
the model  in particular  our final model discretized
the last two dimensions into only two buckets in order
to keep the transition matrix tractable  an expanded
state space would probably result in a significant improvement 
nevertheless  in this project we successfully demonstrated the effectiveness of adding depth to a model 
it is clear that real time information on depth can be
used as an indicator of future short term price movements 

fi