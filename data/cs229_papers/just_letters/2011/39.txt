improving accuracy of inertial measurement units
using support vector regression
saran ahuja  wisit jirattigalachote  and art tosborvorn

abstract inertial measurement unit  imu  is a sensor
that measures acceleration and angular velocity rate 
it has become increasingly popular due to its small
size and low cost comparing to typical marker based
motion capture system  nonetheless  imus face considerable challenges  in particular noticeable inaccuracy
from accumulated integration errors  in this project  we
attempted to improve accuracy of imus in measuring
clinical knee angles using supervised machine learning 
specifically support vector regression  by employing highaccuracy data from marker based motion capture system
as training samples  we were able to see improvement in
the performance of the imus estimation of clinical knee
angles in walking motion  this result is promising and
encourages further works that might extend the model
to include a more general set of movements 

i  i ntroduction
since its introduction in       motion capture is
used not only in the entertainment business such as
films and games  but it is also used extensively in
sports  medicine  and military  traditionally  motion
capture is done using images captured from cameras
to triangulate positions of each reflective marker in the
  dimensional space  while this marker based system
performs extremely well in terms of positional accuracy
and continue to hold its status as the industrial standard 
there is a number of undesirable features  including
high cost  setup complexity  and space limitation 
recently  an alternative method has gained popularity  inertial motion capture uses sensorsinertial
measurement units  imusattached to different parts
of the body  much like reflective markers used in the
optical system  to measure acceleration and angular
velocity  this raw data may then be used to calculate
parameters of interest  such as joint angles and other
positional data  due to its small form factor  minimal
setup requirements  and low cost  inertial motion capture has come to be an appealing alternative to the
marker based system  in addition  since inertial motion
capture does not require camera setup  it is a viable
solution for capturing outdoor motions like skiing or

mountain biking that otherwise may never be achieved
through traditional marker based motion capture 
as good as it may sound  inertial motion capture has
one big disadvantage  unlike the marker based system 
inertial motion capture lacks absolute positional data
and relies heavily on integrating acceleration as well
as angular velocity vectors in order to compute its
absolute position  taking into account sensor errors and
motion approximation  the errors from this integration
procedure quickly add up  and the result becomes more
inaccurate as time passes 
in this project  we attempted to improve the accuracy
of inertial motion capture using supervised machine
learning  using both systems to simultaneously capture
a subjects motion  we trained the inertial motion
capture model to more accurately estimate the valuable
clinical knee angles of the subject during a walking
motion 
ii  s ystem   data p rocessing
a  inertial measurement unit  imu 
in this project  we used a system of low cost wireless
inertial measurement units  the system is shown in fig 
   the system consisted of two imus with the capability of expanding up to     units  each imu has a  axis accelerometer with  g range  a   axis gyroscope
with      deg s range  and a   axis magnetometer with
  gauss range  all in    bit resolution  the data was
sampled at     hz and transferred to mobile phone for
processing and data storage via bluetooth connection 
b  marker based motion capture system
the marker based motion capture system is widely
accepted as the industrys gold standard  in our experiment  the reference system was the vicon motion
capture system with   cameras setup  running at   
frames per second with sub mm accuracy 
c  experimental protocol
we collected two standard static trials in order to
estimate the rotation matrices from each imus body

fithe rotation matrix can be computed as follow 
r q     q    t  i    t   q     

   

where i is the identity matrix and    is standard
vector cross product  then the following differential
motion describes the dynamic of body angular motion 
dq t 
  a  t q 
dt

   

where

 
z y x
   z
 
x y 

a  t    
 
z 
   y x
x y z
 


fig     inertial measurement unit  imu  system with bluetooth
capability 

frame to the reference frame  after the initial setup  we
collected data of    normal walking trials on a treadmill
at      m s  for each trial  we collected the data using
both imus and vicon systems simultaneously  at the
beginning of each trial  the subject jumped and stood
still for a few seconds in order for us to be able to
synchronize the timing of both systems  of the    trials 
three trials were dropped due to the corrupted data from
the imus  leaving us with    trials 
d  clinical knee angle estimation
some of the key of parameters of a walking motion
are the clinical knee angles  these parameters are very
helpful for a physician to analyze knee related injuries
in patients  the clinical knee angle measurements
consist of three parameters  flexion extension  adduction abduction  and internal external rotation angles 
before processing any data  we synchronized the
data from both imu and vicon together using the
jumping event at the beginning of the trial  we then
only used the data after jumping for training and
reporting results 
from the imus data  we performed a quaternionbased strap down integration method               in
order to estimate the rotation matrices  our raw data
consisted of gyroscopic rates  denoted by  t   and
acceleration with respect to the body frame b   we
need to find a rotational matrix that transformed an
imu body frame into the world reference frame w   we
will denote this rotation matrix by r t   a convenient
way to keep track of r t  is to use the quaternion
representation q    q    t    where q  is a scalar and
 is a    vector  given the quaternion representation 

and  t     x   y   z    the angular velocity of b   let
t denote the systems sampling interval and assume
that q t  is constant for t   kt   k     t   then we
can solve equation     explicitly and get a discrete time
quaternion
qk     eak t qk  

where qk is the quaternion at time kt and ak  
a  kt   q  is computed so that the rotation matrix
is consistent with our initial static position  once the
discrete system above is solved  the rotation matrix is
updated using equation     
after we found the rotation matrix representing the
rotation from imus body frame to the world frame  we
used a joint coordinate system  jcs  as recommended
by isb and defined by grood and suntay          to
calculate the clinical knee angles 

fig     experimental setup  a subject is wearing both imus and
reflective markers 

fitable i

iii  m ethodology
as mentioned earlier  inertial motion capture suffers
from buildup of errors  in this section  we describe
the use of supervised machine learning procedure  in
particular support vector regression  to improve the
estimation from measurement of imus 
after processing the data as described in the previous
section  the clinical knee angles estimation imu  t  are
computed  using relatively accurate position data from
marker based system  we were able to compute these
angles with great accuracy  this set of data served as
the target value  we then train the model using   svr
with the pairs  imu  t   marker  t   
a  model
accepted as the gold standard for position capturing  marker  t  is treated as actual knee joint angle and
we have the following model 

root mean square error
clinical knee angle
flexion extension
abduction adduction
internal external rotation

normalize the training sample to have range       
let m   m be the minimum and maximum of our
sample angles  then
 
imu
marker
t i
 m
t t i  m
xt i  
 
 
yt i  
 
t m   m
 m  m



apply svr with regularization parameter c  
  to the normalized training set   xt i   yt i     i  
              n  t                 t    we use libsvm
toolbox     which provides all necessary matlab
functions 
compute leave five out cross validation error using root mean square error as a metric 



timu   tmarker    tmarker     t    tmarker     t  

inverting this relationship  we have
tmarker

 

 timu  

  t  

which gives a setting where the support vector regression can be applied  this derivation is not meant to
be rigorous  but rather to motivate our use of support
vector regression 
b  learning method
from each trials  we collected and processed our
data to get a sample path of angles measurement
from both imus and marker based motion capture as
a function of time  the processed data consisted of
imu marker
triplets  t  t i
  t i    where t                 t   and
i                 n   t is the number of time steps and
n is the number of trials     in our experiment   our
imu
training size is n  t where  t  t i
  gives us input
marker
samples to be trained with target t i
 
we applied   svr with various kernels to the training set and compared the performance among different

rbf
      
      
      



t    tmarker     t  

so that

polynomial
      
      
      

kernels  to evaluate the generalization capability of the
model  we used leave five out cross validation method
with root mean square error as a criteria  more concretely  we performed   trainings and trained the model
using    walks and cross validated with   walks  except
for the last training in which we used    walks to train
and   walks to cross validate   the learning procedure
can be summarized as follows 

timu   tmarker   t  

where t is the error from the measurement  sensor
noise  and integration  since our main application is
to measure knee joint angle related to a specific body
movement  walking  running  etc    one might expect
the error to be correlated with the angle marker  t   let

linear
      
      
      

iv  r esults
for kernel selection in our support vector regression
method  we tried linear  polynomial  and radio basis
function  rbf  kernels  the results showed no significant advantage of one kernel over others across all three
angle measurements  as can be seen in table i  for knee
flexion extension angle  we found the rms error to be
approximately      degrees  knee adduction abduction
angle had an rms error around      degrees  and for
the knee internal external rotation angle  the rms error
was      degrees 
by using our model from svr  we found a significant improvement in all three knee angles estimation
from imus  as seen in a sample walking trial in fig 
   the imumodel  i e  imu data processed with svr 
was closer to the vicon reference system  on average
of more than      in addition  our estimated model
reduced the rms errors over time across all trials at
least in half  as seen in fig    

fiflexion extension

flexion extension
  
vicon
imuraw

  

angle  degrees 

angle  degrees 

  

imumodel

  
  

imuraw
imu

  

model

 

 
 

 

 

 
time  s 
adduction abduction

 

 

 

 

 

 

 

 
time  s 
adduction abduction

 

 

 

angle  degrees 

angle  degrees 

 
vicon
imu

 

raw

 

imumodel

 
 
 

 

 

 
 
time  s 
internal external rotation

 

imuraw
   

imumodel

 
   
 

 

 

 

 

 
 
time  s 
internal external rotation

 

 

vicon
imuraw

  

angle  degrees 

angle  degrees 

  

imumodel

 
 
 
  

 

 

 

 
time  s 

 

 

 

fig     estimations of three clinical knee angles using data from
imus improve by more than     using svr  as we can see
imumodel is close to the reference system  vicon  

v  d iscussion
each kernel  linear  polynomial  and rbf  showed
comparable performance across all three types of knee
angles  as seen in table i  this is possibly due to the
structure of the error that was not specific to any kind
of kernel  these relatively low cross validation errors
allowed the model to fit the actual angle nicely without
over fitting the data  also note that the magnitudes of
these errors are relatively good comparing to what have
been found in a few other similar studies               
      our model estimation has an advantage of very
little computation time requirement  around    seconds
for a sample of    trials  polynomial kernel   however 
our model only considered a specific normal walking
condition on a treadmill  thus further experiments
involving various motions and speed will be required
to improve the generalization of the model 
support vector regression was able to reduce the
error in the knee angle estimation significantly  as seen
in fig     one observation from the data is that the
error increased in time due to accumulation of error
from each time step discretization  by adding time
since last static position parameter into our model  we
were able to reduce accumulating errors significantly 
nevertheless  svr is still unable to completely remove

imuraw

 

imumodel
 
 
 

 

 

 

 
time  s 

 

 

 

fig     root mean squared errors due to time effect from imus are
reduced by more than     on average 

non systematic errors such as hardware sensor noises 
with regards to the nature of the subjects movement 
we notice that when the subjects foot hit the ground 
the imu registered significant noise in acceleration 
this would suggest that we might observe periodic
spikes in errors from the imu  however  fig    showed
that the root mean squared error from the imus does
not appear to be periodic as expected  this was due in
part by the not completely synchronized step cycles
from our pre processed data  therefore these spikes
were averaged out over    trials  the residuals  on the
other hand  exhibits higher degree of periodicity  this
might be due to svr  which takes into account of the
time parameter  was able to notice the cyclical trend 
vi  c onclusion
in this paper  we explored support vector regression
method to help improve knee angle estimation from
multiple inertial measurement units  we used a gold
standard marker based motion capture system as our
learning examples  we then utilized cross validation
method to find an appropriate kernel to train the
model  the results demonstrated a vast improvement
of clinical knee angles estimation over the typical
imus measurement  this would allow us to capture the
essence of knee motion in a near real time calculation 
suitable for activities that require outdoor setting and

fiinstant feedback  future work would require testing and
learning of multiple motions and joint angles in order
to improve the generalization of the model 
r eferences
    a  m  sabatini  quaternion based strap down integration
method for applications of inertial sensing to gait analysis 
medical and biological engineering and computing  vol     
no     pp              
    j  favre  b  m  jolles  o  siegrist  and k  aminian 
quaternion based fusion of gyroscopes and accelerometers to
improve  d angle measurement  electronics letters  vol     
no      pp               
    j  c  k  chou  quaternion kinematic and dynamic differential
equations  robotics and automation  ieee transactions on 
vol     no     pp        feb       
    g  wu  s  siegler  p  allard  c  kirtley  a  leardini  d  rosenbaum  m  whittle  d  d  d lima  l  cristofolini  h  witte 
and et al   isb recommendation on definitions of joint coordinate system of various joints for the reporting of human joint
motionpart i  ankle  hip  and spine  international society of
biomechanics  journal of biomechanics  vol      no     pp 
             
    e  s  grood and w  j  suntay  a joint coordinate system for
the clinical description of three dimensional motions  application to the knee  journal of biomechanical engineering 
vol       no     pp              
    c  c  chang and c  j  lin  libsvm  a library for support
vector machines  acm transactions on intelligent systems
and technology  vol     pp                  
    j  favre  r  aissaoui  b  m  jolles  o  siegrist  j  a  de guise 
and k  aminian   d joint rotation measurement using mems
inertial sensors  application to the knee joint  in ninth international symposium on the  d analysis of human movement 
international society of biomechanics  isb  technical group
on the   d analysis of human movement  june      
    r  takeda  s  tadano  m  todoh  m  morikawa  m  nakayasu 
and s  yoshinari  gait analysis using gravitational acceleration measured by wearable sensors  journal of biomechanics 
vol      no     pp               
    g  cooper  i  sheret  l  mcmillian  k  siliverdis  n  sha 
d  hodgins  l  kenney  and d  howard  inertial sensorbased knee flexion extension angle estimation  journal of
biomechanics  sept       
     k  j  odonovan  r  kamnik  d  t  okeeffe  and g  m  lyons 
an inertial and magnetic sensor based technique for joint
angle measurement  journal of biomechanics  vol      no     
pp                     online   available  http   www 
sciencedirect com science article pii s                

fi