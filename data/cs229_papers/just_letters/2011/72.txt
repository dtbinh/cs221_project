stock prediction using twitter sentiment analysis
anshul mittal

arpit goel

stanford university

stanford university

anmittal stanford edu

argoel stanford edu

abstract

presidential elections and thanksgiving day in       they
also used causality analysis to investigate the hypothesis
that public mood states  as measured by the opinionfinder
and gpoms mood time series  are predictive of changes
in djia closing values  the authors used self organizing
fuzzy neural networks to predict djia values using previous values  their results show a remarkable accuracy of
nearly     in predicting the up and down changes in the
closing values of dow jones industrial index  djia  

in this paper  we apply sentiment analysis and machine
learning principles to find the correlation between public
sentiment and market sentiment  we use twitter data to
predict public mood and use the predicted mood and previous days djia values to predict the stock market movements  in order to test our results  we propose a new cross
validation method for financial data and obtain        accuracy using self organizing fuzzy neural networks  sofnn 
on the twitter feeds and djia values from the period june
     to december       we also implement a naive protfolio management strategy based on our predicted values  our
work is based on bollen et als famous paper which predicted
the same with     accuracy 

the rest of the paper is organized as follows  the second section briefly discusses our general approach towards solving
the problem and the following sections discuss the individual components in greater detail  in section    we briefly
discuss the dataset that we have used for this paper and
data preprocessing measures adopted  section   discusses
the sentiment analysis technique developed by us for the
purpose of this paper  section   includes in detail  the different machine learning techniques to predict djia values
using our sentiment analysis results and presents our findings  in section    we use the predicted values and devise a
naive strategy to maintain a profitable portfolio 

   introduction
stock market prediction has been an active area of research
for a long time  the efficient market hypothesis  emh 
states that stock market prices are largely driven by new
information and follow a random walk pattern  though this
hypothesis is widely accepted by the research community as
a central paradigm governing the markets in general  several
people have attempted to extract patterns in the way stock
markets behave and respond to external stimuli 

  

algorithm

the technique used in this paper builds directly on the one
used by bollen et al       the raw djia values are first fed
into the preprocessor to obtain the processed values  at the
same time  the tweets are fed to the sentiment analysis algorithm which outputs mood values for the four mood classes
for each day  these moods and the processed djia values
are then fed to our model learning framework which uses
sofnn to learn a model to predict future djia values using them  the learnt model as well as the previous djia and
mood values are used by the portfolio management system
which runs the model to predict the future value and uses
the predicted values to make appropriate buy sell decisions 
figure   shows a brief flow diagram of our technique 

in this paper  we test a hypothesis based on the premise
of behavioral economics  that the emotions and moods of
individuals affect their decison making process  thus  leading to a direct correlation between public sentiment and
market sentiment  we perform sentiment analysis on publicly available twitter data to find the public mood and the
degree of membership into   classes   calm  happy  alert
and kind  somewhat like fuzzy membership   we use these
moods and previous days dow jones industrial average
 djia  values to predict future stock movements and then
use the predicted values in our portfolio management strategy 

the following sections discuss each component of our technique in greater detai

related work our work is based on bollen et als strategy     which received widespread media coverage recently 
they also attempted to predict the behavior of the stock
market by measuring the mood of people on twitter  the
authors considered the tweet data of all twitter users in     
and used the opinionfinder and google profile of mood
states  gpoms  algorithm to classify public sentiment into
  categories  namely  calm  alert  sure  vital  kind and
happy  they cross validated the resulting mood time series
by comparing its ability to detect the publics response to the

  

dataset

in this project  we used two main datasets dow jones industrial average  djia  values from june
     to december       the data was obtained using
yahoo  finance and includes the open  close  high and
low values for a given day 
 

fivery difficult to predict  we pruned our dataset by
removing these periods for final training and testing 
finally  in order to ensure that values were small and comparable  we computed the z score of each point in the data
series   x    and used that in our analysis  the original
values were of the order of       so matlab was giving a
precision error when computing functions like exp x    

  

sentiment analysis

sentiment analysis was an important part of our solution
since the output of this module was used for learning our
predictive model  while there has been a lot of research going on in classifying a piece of text as either positive or negative  there has been little work on multi class classification 
in this project  we use four mood classes  namely  calm 
happy  alert  and kind  we tried several standard tools
like opinionfinder  sentiwordnet     etc  for our problem
but found them inadequate and or inefficient and therefore
decided to develop our own analysis code  the methodology
we adopted in finding the public sentiment is as follows 

figure    our technique
 publicly available twitter data containing more than
    million tweets corresponding to more than    million users from june      to december       the data
includes the timestamp  username and tweet text for
every tweet during that period  since we perform our
prediction and analysis on a daily basis  we split the
tweets by days using the timestamp information 

   word list generation
we develop our own word list based on the well known
profile of mood states  poms  questionnaire  poms
is an established psychometric questionnaire which asks
a person to rate his her current mood by answering   
different questions on a scale of   to    for example 
rate on a scale of   to   how tensed you feel today   
these    words are then mapped on to   standard
poms moods  tension  depression  anger  vigour 
fatigue and confusion  in order to do automate this
analysis for tweets  the word list needs to be appropriately extended  bollen et al      used the google
n grams data for the same  we followed a much simpler approach of extending the list by considering all
commonly occuring synonyms of the base    words using sentiwordnet and a standard thesaurus 

data preprocessing
the data obtained from the above mentioned sources had
to be pre processed to make it suitable for reliable analysis 
we pre processed the djia data in the following manner   while the twitter data was available for all days lying in the giving period  the djia values obtained
using yahoo  finance was  understandably  absent
for weekends and other holidays when the market is
closed  in order to complete this data  we approximated the missing values using a concave function  so 
if the djia value on a given day is x and the next available data point is y with n days missing in between  we
approximate the missing data by estimating the first
day after x to be  y  x    and then following the same
method recursively till all gaps are filled  this approximation is justified as the stock data usually follows a
concave function  unless ofcourse at anomaly points of
sudden rise and fall 

   tweet filtering
as mentioned earlier  the tweet data is enormous and
will take several hours to be processed if used as it
is  which makes the task of daily predictions difficult  
therefore  we filtered and considered only those tweets
which are more likely to express a feeling  i e  we consider only those tweets which contain the words feel 
makes me  im or i am in them 

   if we observe the general movement of stock markets 
it is associated with a few sudden jumps falls and a
brief period of small fluctuations around the new value 
however  such jumps falls are due to some major aberrations and cannot be predicted  moreover  as we
know the public memory is very short and even though
the market may be trading at a much higher level than
the previous year  that does not mean that calmness
will be much higher than previous year  public mood is
a very local metric  therefore  we adjusted our stock
values by shifting up down for steep falls jumps  respectively  making sure that we do not disturb the
daily directional trend  up down movement of stock
prices  

   daily score computation
we used a simple word counting algorithm to find the
score for every poms word for a given dayscore of a word  

 of times the word matches tweets in a day
 of total matches of all words

the denominator accounts for the fact that the number of tweets could vary from one day to another  this
works well for our problem because of the nature of
tweets which contain simple sentence structures and
only a maximum of     characters  in most cases much
less   we tried using the stanford corenlp software
for word tagging and then using a words position in

   even after shifting the values in step    the values contained significant periods of volatile activity which are
 

fiabout another over a given lag period  the p value measures the statistical significance of our result i e  how likely
we could obtain the causality value by random chance  therefore  lower the p value  higher the predictive ability  it is
clear from table   that calmness and happiness are most
helpful in predicting the djia values as per the granger
causality  moreover  the causality is best when we use the
past   or   days data  figure   shows the djia values superimposed with sum of calmness and happiness over a brief
period  indicating the clear predictive trend 

the sentence to find its importance  however  similar
to our experience working with opinionfinder  we observed that this process  besides being extremely slow
was not too beneficial 
   score mapping
we map the score of each word to the six standard
poms states using the mapping techniques specified
in the poms questionnaire  we then map the poms
states to our four mood states using static correlation
rules  for example  happy is taken as sum of vigour
and negation of depression  

table    p values obtained using granger causality
analysis with different lags  in days 
lag calm happy alert kind
 
                           
 
                           
 
                           
 
                           
 
                           

it is important to note that  given our formulation  it does
not make much sense to compare the value of one mood
against another  they should only be used to compare mood
trends across days  we cross validated the results of our sentiment analysis technique by comparing the values returned
by our algorithm around significant events like thanksgiving day and michael jacksons death  as shown in figure
   the moods show a sharp rise of various mood states on
thanksgiving whereas one day after mjs death  there is a
sharp decline in happiness 

figure    the djia  and calmness   happiness
curves superimposed to show correlation

 a  various moods after michael jacksons death on   
june     

in the next section  we use the results of our sentiment analysis algorithm to learn a model that can predict the stock
index and its movement 

  

model learning and prediction

granger causality is based on linear regression  but the correlation between stocks and moods is certainly non linear 
therefore  after finding a causality relation between the past
  days moods and current day stock prices  we tried   different learning algorithms  linear regression  logistic regression  svms  self organizing fuzzy neural networks  to
learn and study the actual correlation  for svm we used
the libsvm     library  but we implemented the other three
in matlab ourselves as we could not find good working
libraries for them  the self organizing fuzzy neural network  sofnn  is a five layer fuzzy neural network which
uses ellipsoidal basis function  ebf  neurons consisting of
a center vector and a width vector  we implemented the
online alorithm for creating sofnns as introduced in     in
which neurons are added or pruned from the existing network as new samples arrive  neural networks have been
considered to be a very effective learning algorithm for decoding nonlinear time series data      and financial markets
often follow nonlinear trends  the authors in     showed the

 b  various moods on thanksgiving day on    november
    
figure    cross validation of our sentiment analysis
by analyzing moods on some important events
granger causality in order to ascertain whether the mood
values returned by our algorithm can be used to predict
the future stock movements  we computed the p values using granger causality analysis  granger causality analysis finds how much predictive information one signal has
 

fitable    djia   scv accuracy using   different algorithms
evaluation
id
icd
ichd
icad
ickd
ichad
mape
     
     
     
     
     
     
linear regression
direction
                                         
logistic regression
direction
   
   
   
   
   
   
svm
direction
                                         
mape
     
                  
   
      
sofnn
direction
                                         
algorithm

ichkd
     
      
   
      
      
      

    correlation using sofnns only  and our results also indicate that soffns do the best among all other algorithms 
giving nearly        accuracy 
in order to measure accuracy  we developed a novel validation technique called the k fold sequential cross validation
 k scv   in this method  we train on all days upto a specific day and test for the next k days  the direct k fold
cross validation method is not applicable in this context as
the stock data is actually a time series unlike other scenarios
where the data is available as a set  therefore  it is meaningless to analyze past stock data after training on future
values  for the purpose of our analysis  we use k     
our granger causality analysis indicates that calm and
happy are causative of the djia values  but to confirm the
inverse dependence of other mood dimensions on djia we
investigated a total of   different possibilities  in table    id
denotes the   scv accuracy when only the past   days djia
values are given as features  similarly icd   ichd   icad  
ickd   ichkd   ichad denote the accuracy when features
are the past   days djia values  represented by d  along
with the past   days mood values  c calm  h happy 
a alert  k kind  in different combinations  mape indicates the mean absolute percentage error between our predicted values and the actual normalized stock values  the
direction accuracy indicates the percentage matchings in
the trends  up down  predicted by our training vs the actual daily trends in the stocks  when using classification
algorithms  we used the up down trends as class inputs and
used the algorithm to directly predict trends whereas when
using regression algorithms  we fed the normalized stock values as input and used the predicted stock values to obtain
direction  up down  trends 

figure    predicted vs actual stock values using
sofnn on calm happy djia for    consecutive
days

   firstly svms and logistic regression perform badly on
this dataset  giving the same percentage values for direction
accuracy for all mood combinations  this shows that classification  directly predicting trends  is not the ideal methodology for this problem  linear regression performs pretty
good  which is in conjunction with the granger causality results  whereas sofnn performs the best  if we look at the
direction accuracy for sofnn we observe that the best
value is for ichd           also on adding any other mood
dimension the direction accuracy worsens  ie  the direction
accuracy is clearly lower for ichad   ichkd   this shows
that by adding more features we would essentially be overfitting the data  if we try to remove some feature and find the
direction accuracy  we observe that the result still worsens 
hence calm and happiness are indeed more indicative of
the stock values than any other moods  if we consider the
mape values  we find that calm and alert mood dimensions do marginally better than the others  but they are poor
in predicting the direction or the trends of stock movement 

we find that ichd gives the best results in all the algorithms considered  indicating that calmness and happiness
are more predictive of the stock values  confirming the granger
causality analysis and unlike the     result  they showed
    correlation when features were calm and djia values of
past   days  and reported the accuracy only on a specific test
set  without reporting any cross validation error average 
our results are also in conjunction with the philosophy that
happiness should in general be causative of the stock values 
figure   shows a graph of the normalized stock values as
predicted by our sofnn algorithm vs the actual normalized stock values when trained on the happy calm djia
feature set  we find a very close correlation and hence the
small value of mean absolute percentage error  mape  and
good directional accuracy 

to compare the significance of our results on the directional
accuracy with those of      we see that   fold sequential
cross validation is clearly a better indicator      have used
a specific test period which gives a       directional accuracy  and they have proved that statistically the probability
of that event happening with random success is pretty low 

we can draw several important conclusions from the table

 

fibut we have on the other hand cross validated over the entire
period  using our   fold scv technique  as mentioned earlier  this technique makes more sense for stock data because
the usual cross validation would essentially be using future
stock values to predict the past ones  which is an incorrect
technique when financial data is concerned 

towards a variety of socio cultural events during the year
      secondly  among the observed dimensions of moods 
only calmness and happiness are granger causative of the
djia by     days  thirdly  a self organizing fuzzy neural
network performs very good in predicting the actual djia
values when trained on the feature set consisting of the djia
values  calm mood values and happiness dimension over the
past   days  the performance measure we have used is kfold sequential cross validation  which is more indicative of
the market movements for financial data  finally a naive
implementation of portfolio management using our strategy
indicates a decent profit over a range of    days 

   portfolio management
having predicted the djia closing values one day in advance  we can use these predicted values to make intelligent
sell buy decisions  we develop a naive greedy strategy based
on a simple assumption that we can hold at most one stock
at any given time  or s stocks if all stocks are always bought
and sold together  following are the steps features of our
strategy 

our results are in some conjunction with      but there are
some major differences as well  firstly our results show a
better correlation between the calm and happy mood dimensions with the djia values  unlike their result  which showed
high correlation with only calm mood dimension  secondly 
we havent been able to obtain high percentage result of
     but our        result using k fold sequential cross validation gives stronger evidence that the correlation is over
the entire range of data  the profits in out naive implementation of portfolio management shows that our mape
estimates are pretty much accurate 

 pre computation
we maintain a running average and standard deviation
of actual adjusted stock values of previous k days
 buy decision
if the predicted stock value for the next day is n standard deviations less than the mean  we buy the stock
else we wait 

finally  its worth mentioning that our analysis doesnt take
into account many factors  firstly  our dataset doesnt really
map the real public sentiment  it only considers the twitter using  english speaking people  its possible to obtain
a higher correlation if the actual mood is studied  it may
be hypothesized that peoples mood indeed affect their investment decisions  hence the correlation  but in that case 
theres no direct correlation between the people who invest
in stocks and who use twitter more frequently  though there
certainly is an indirect correlation   investment decisions of
people may be affected by the moods of people around them 
ie  the general public sentiment  all these remain as areas
of future research 

 sell decision
if the predicted stock value is m standard deviations
more than the actual adjusted value at buy time  we
sell the stock else we hold 
note that the above strategy has three parameters  k  n and
m  our experiments show that the optimal parametrization
is n   m     and k     or     note that in order to trade
effectively  we needed a large enough test set  containing at
least       entries  thereby limiting the scope of our experiments because of limited test data   the profit obtained
using our strategy is as follows 

  

k       p rof it         dow points
k        p rof it          dow points

acknowledgments

we are extremely grateful to mihai surdeanu and john bauer
for introducing us to this problem and also for their constant
guidance and support 

the total range of stock movement in the same period is
       dow points 

  

references

    j  bollen and h  mao  twitter mood as a stock market
predictor  ieee computer              
    c  c  chang and c  j  lin  libsvm  a library for
support vector machines  acm transactions on
intelligent systems and technology                    
    g  p  gang leng and t  m  mcginnity  an on line
algorithm for creating self organizing fuzzy neural
networks  neural networks                  
    a  lapedes and r  farber  nonlinear signal processing
using neural network  prediction and system modeling 
in los alamos national lab technical report 
    a  e  stefano baccianella and f  sebastiani 
sentiwordnet      an enhanced lexical resource for
sentiment analysis and opinion mining  in lrec 
lrec 

please note that while the above analysis is entirely in terms
of dow points  it is easy to correlate a profit in dow points
with a monetary value  for example  the dow diamonds
is an exchange traded fund that holds the    stocks that
comprise the djia and researchers have shown a       correlation between the movement of djia and the dow diamonds  similarly  we can find many other funds which can
translate this profit in down point to a corresponding profit
in dollars 

   conclusions and future work
we have investigated the causative relation between public
mood as measured from a large scale collection of tweets
from twitter com and the djia values  our results show
that firstly public mood can indeed be captured from the
large scale twitter feeds by means of simple natural language processing techniques  as indicated by the responses
 

fi