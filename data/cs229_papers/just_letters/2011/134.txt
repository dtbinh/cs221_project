a stock purchasing agent from sentiment analysis of twitter 
alvin chyan
achyan stanford edu

tim hsieh
timhsieh stanford edu

chris lengerich
ctl   stanford edu

abstract
in recent years  there has been a number of forays into stock market prediction via sentiment analysis of microblogs 
most notably in bollen et al s      work twitter mood predicts the stock market  however  their work leaves
open a number of important questions  most practically  whether it is possible to make money using signals
generated from twitter  an agent which trades based on signals from twitter is particularly interesting  as there are
a number of features of real life stock trading which make it substantially different from simply predicting a
directional signal for a stock  while obtaining a reliable directional signal is certainly a sina qua non for successful
trading  calibrating a trading strategy to incorporate risk attitudes as well as real world parameters such as spread
and transaction costs requires additional complexity in the model  in this paper  we attempt to answer those
questions by obtaining a solid directional signal of the movement of the dow diamonds etf based on market price
changes and twitter data and subsequently building a stock trading agent to make simulated trades from those
signals 

prior work
there have been a number of prior works using sentiment
analysis to predict stock data  most notably  bollen et al  used
twitter data to predict the direction of djia movement 
achieving an accuracy of       using the self developed
google profile of mood states  gpoms  and a self organizing
fuzzy neural network         they found that the calm
mood profile yields the best result for stock market prediction 
in similar research  oh and sheng found that using a
combination of manual and an automated bag of words
technique yielded high predictive accuracy for a variety of stock
tickers         their smo algorithm was able to achieve a
weighted f measure of       

methods
overview
our ultimate goal was to create a system that could maximize
return on investments  the problem was broken into three
components  each of which could be independently validated 
   tweet sentiment analysis   accurately identify the
sentiments of tweets  so that  if bollen et al s predictions
held true  the directional signal could be improved by the
use of mood data
   stock movement prediction   find a model to generate a
prediction on the stock market movement given the
previous days stock changes and the twitter mood
   stock purchasing agent   accepting the output of part   as
input  determine a specific market order to place with the
goal of maximizing investment returns 
the overall design of the system is presented in figure   

figure    overall system design

fidata sources
stock
the daily dow diamonds etf  dia  opening market price from june          to december          was retrieved from
yahoo  finance   figure   presents the magnitude of the changes while figure   below presents the normalized dia in
comparison with the calm score derived from our tweets  for the time period under consideration  the dia rose on     of
the days  

figure    distribution of changes in the dia

twitter
a full set of all tweets on twitter from june          to december          were kindly provided by stanfords
snap laboratory  this encompassed some     million tweets  yang and leskovec       
stock preprocessing
the direction of change in market opening price across days was scored as a      binary classification   this formed the
labels for the supervised learning portion of part ii  the normalized market opening price is presented in figure   on the
following page 

part i  extacting mood score for each day
creating a dictionary of calm words
in bollen et al   it was observed that only the calm sentiment score made a significant contribution to improving the
directional accuracy of the djia movement signal         therefore  a dictionary of calm words was compiled and used
for a bag of words sentiment scoring on data from twitter  the kernel of the calm dictionary was a base list of words which
decrease the score of the tense mood state on the profile of mood states  poms   this kernel of words was expanded to
include additional words with high statistical correlation to the base words using google s  t   gram corpus  some words
were manually filtered to avoid words with overloaded sentiment meaning   this resulted in a    word dictionary 
assigning mood scores to each day
the following preprocessing steps were used to filter out spam and convert each tweet into a standard form suitable for bagof words sentiment analysis  these steps are similar to those documented by bollen et al         

   remove all tweets containing http and www to filter out spam 
   keep only tweets which have a high likelihood of reflecting emotional states  such as those containing i feel  i
  
  
  
  

 

am  makes me  etc 
tokenize each tweet 
remove all non alpha numeric characters 
convert all letters to lower case from upper case 
porter stem each word  this step involves a standard pre processing technique for text  which strips english words
of their inflections  for example  happiness and happy would be converted into the same stem word 

data for july   th was missing from the data set provided  accommodations for this were made in the pre processing steps 
note that  as an exchange traded fund  the dia does not map perfectly on the rise and fall of the djia  which rose       of the period
under consideration  this is a small difference  however  it reflects the fact that the dia receives influences from other factors besides
simply the basket of its incoming stocks 
 
note that this indicates that stock changes over the weekends  during which time the markets were not open  had   trading day and   nontrading days to occur whereas stock changes over a weekday had only   trading day to occur  this is a more difficult problem for
prediction  however  it is a realistic representation of the decision making that a trading agent would face  a similar pattern occurred for
holidays 
 

fiafter preprocessing  the selected tweets for a single day were selected and scored using a bag of words method  for each
occurrence of a word in the calm dictionary in one days tweets  the calm score for that day would be incremented by   
after calculating the total calm score for each day  the total score for each day was then normalized for volume by dividing
the score by the number of sentiment containing tweets on that day  the normalized dia and calm score for each day over
the period of our data are presented below 

figure    normalized dia and calm score

the calm score plot shows weekly cycles not seen by bollen et al   which roughly map to low calm scores during the
weekdays and higher calm scores during the weekend  this result by itself  in fact  is similar to the findings of kamvar and
harris  who suggested that the relaxed public sentiment increased over the weekends         moreover  the calm score is
highly correlated with national events  such as thanksgiving  this indicates that the calm score indeed reflects aspects of the
public mood 
the lack of obvious correlation between calm score and dia value suggests that  if a relationship is indeed present 
it may be non linear  as a result  it may not be feasible to isolate particular words as individually predictive of the dia
value  

part ii  stock price direction prediction
based on the non linearities of the correlation between the dia score and the calm score  a neural network was selected as a
modeling tool  as neural networks have sufficient power to handle arbitrarily complicated non linear functions  the preprocessed time series were converted to into the following two lagged time series   
   t   each entry contained the previous   calender days of twitter calm score
   d   each entry contained the previous   days of change in dia opening price
taking these inputs separately and in combination  a neural network was trained to predict the directional change of the stock
price over each day  after experimenting with sample sizes as small as    days  with      accuracy   it was found that the
largest training set possible  n      would produce optimal results  training on     days for         epochs and testing
from december  nd to december   th on a         neural network with sigmoid activation functions  the following
accuracies were obtained 
input data

test set accuracy  n    

d

   

d t

   
table    nn directional prediction accuracy

 

a naive bayes multinomial event model was also tested with an expanded vocabulary list  however  the test accuracy for this model was
under      this also suggests that the relationship between calm words and sentiment may not follow a linear relationship
 
note that because the markets are not open on the weekend  this involved making a prediction for the opening price change from
monday  tuesday by using the changes from the previous wednesday  thursday  thursday  friday and friday  monday  while the
twitter calm scores from friday  saturday and sunday would be used  we did not investigate the effect that this alignment causes in
particular  however  this area would a worthwhile topic of future research 

fiit is worth noting that that the difference in accuracy of these two test results in a    point data set only corresponds
to one extra correct classification  however  as noted in part iii  the output from the neural network trained with calm score
has a different distribution from the ouput from the neural network not trained with calm score 

part iii  reinforcement learning agent
the neural network output a series of signals  with magnitudes that roughly corresponded to the confidence of the network in
its prediction  the these signals  then  were taken as input to a policy search reinforcement learning agent  the following
actions  states and rewards were defined for the rl agent  states are defined as 

taking  

  as the fraction of the portfolio to be invested in stock  the calculated policy is defined as 

with s      s     the directional signal from the neural network  the neural network output should already emcompass the
information needed to predict a market change  so the other state parameters are excluded when calculating a policy to help
reach convergence of faster  a sigmoid function was used as it tends to make more aggressive decisions  which would
likely receive higher rewards when using a signal that is correct     of the time 
the corresponding action was to buy at the ask price or sell at the bid price to reach the desired percentage of investment in
stocks  starting from the current percentage of stocks   it was assumed that the agent faced a spread of       as well as a
transaction cost of    per trade   finally  the reward after taking an action was defined as the difference in the total portfolio
value before and after the action is taken  with the stock valued the bid price for the respective day  through this
reinforcement learning algorithm  the rl agent learned the optimal amount of risk to take given its signals 
results
the rl algorithm was trained until convergence on the period from july          through december         and tested from
december         through december           starting with          in cash  the results are presented in table   and the
learning curve  for the training set   is presented in figure   

profit

theoretical
maximum 

buy and
 
hold

buy        of stock
each day  sell on
last day

training on nn
predictions with nn
input   d

training on nn
predictions with nn
input   d and t

     

    

     

     

     

table    profit under agent vs  baseline strategies

figure    profit achieved by rl agent over training epochs

 

this spread is typical of highly liquid stocks like the dia
this is typical of online brokerages
 
the agent  given a perfect signal  goes all in each time  trading only at the opening market bell each day
 
go all in the first day  sell all on the last day
 

fianalysis
interestingly  even though the accuracy of the directional prediction is improved by adding the sentiment analysis from
twitter  the rl agent trading on the associated signal makes more money without the mood score  while this may be caused
by a number of factors  it may be explained by the plotting the output of the neural network versus the actual change that day 
as in figure   and figure   

figure    nn output without calm score

figure    nn output with calm score

for both training runs  the
selected sets the decision boundary near zero  therefore  if a point lies in the first or third
quadrant  then this means the directional signal is correct  as shown in the graph above  the directional signal makes five
incorrect decisions without the calm score and four with the calm score  however  the incorrect decisions with the calm score
have greater magnitude of change  this may contribute to the differences in their respective profits 
regardless of the ordering of the networks trained with or without mood score  the agent using either of the
directional signals makes at least as much money as the largest baseline        and       versus        respectively   this
is a strong indication that the reinforcement learning algorithm worked correctly  moreover  the agent trained on stock only
makes approximately       more than the highest baseline  indicating that it outperformed some simple investment
strategies 

conclusion
twitter calm mood improved the prediction accuracy of the neural network by approximately    over the test period 
however  this did not appear to increase the total profit of the agent over the test period  to improve performance  it may be
desirable to train the system holistically  rather than simply optimizing each step in sequence  this is due to the fact that the
nn output used by the agent in rl training had less accuracy than the output used in rl testing  as suggested by the
distribution of the nn output  it may also be that an agent with a weaker directional signal but stronger confidence in its
correct predictions would be more desirable than the existing agent  finally  it may be desirable to further vary the rl policy
function  or include more parameters than simply one parameter in the rl algorithm  these steps may be considered on the
path towards making a better stock purchasing agent from sentiment analysis of twitter 

references
bollen  j   mao  h  and zeng  x  j        twitter mood predicts the stock market  journal of computational science        
bollen  j   mao  h  and pepe  a        modeling public mood and emotion  twitter sentiment and socio economic
phenomena  in proceedings of the fifth international aaai conference on weblogs and social media 
kamvar  s d  and harris  j        we feel fine and searching the emotional web  acm international conference on web
search and data mining  wsdm      
oh  c  and sheng  o r l  investigating predictive power of stock microblog sentiment in forecasting future stock price
directional movement  in icis      proceedings  shanghai  china  dec       
yang  j  and leskovec  j        temporal variation in online media  acm international conference on web search and
data mining  wsdm      

fi