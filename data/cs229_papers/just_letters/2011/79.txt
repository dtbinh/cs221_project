shruti gupta
joe funke
thomas lipp

estimating road friction for
autonomous vehicles

introduction

        
cs    final report

system  data is collected at each time step while the vehicle is
operating on a given surface 

automobiles are connected to the road through the four small
areas where tires meet road surface  the friction between
these two surfaces defines the limit of the vehicles
performance  and knowing that friction value allows accurate
estimation of the vehicles capability  given a known realtime friction value during operation  existing safety features
such as stability control  traction control  and antilock braking
systems  abs  on existing production vehicles could greatly
improve      further  accurate friction estimation is essential
for an autonomous vehicle minimizing tracking errors and
maintaining stability while operating at the limits of handling 

further  a maneuver called a ramp steer can be conducted at a
given location  the data from which can be post processed to
empirically determine the overall friction of that surface  this
was done for five different surfaces covering a range of
possible situations  as outlined in table    note that this
approach does not allow us to estimate a continuous friction
value  which would be ideal  but categorically selects one of
these predetermined values  this is still valuable for
identifying changing conditions  such as transitioning from a
paved surface to a dirt road  or adapting to worsening road
conditions in the face of inclement weather 

various approaches to friction estimation currently exist  but
each has drawbacks making them unattractive to implement 
most approaches require precise vehicle models  in turn
requiring a significant time investment determining accurate
parameters      other approaches  such as wheel slip based
friction estimators or lateral dynamics observers  will estimate
friction only based on one of longitudinal dynamics
 accelerating and braking  or lateral dynamics  turning     
     some approaches  such as those based on steering torque 
rely on sensors not always available in production cars     

location
shoreline lot
bonneville salt flats
infineon raceway
santa clara
fairground
infineon raceway
any location

road condition
gravel
salt
wet pavement
dry pavement

friction value
    
    
    
    

dry pavement
    
vehicle speeds
unknown
near zero
table    friction coefficients for various road conditions

instead  a machine learning based approach to friction
estimation is proposed that can yield a real time estimate of
one of several friction values based on current vehicle
longitudinal and lateral dynamics  such an approach can yield
a real time estimate of friction based only on data available to
the vehicle and requires training on existing datasets rather
than attempting to build and tune a complete vehicle model 

supervised learning techniques are implemented with training
data constructed from measurement information provided at
given time steps labeled with one of the five friction values  a
sixth friction category of unknown was also added for nearzero vehicle speeds to reduce artifacts  given that there is no
way to estimate friction if the vehicle is not moving  
feature sets

setup
data was collected on a production audi tts fitted with a
high precision integrated gps ins unit and drive by wire
capabilities  the vehicle is part of stanfords dynamic design
lab and is used to research autonomous driving at the limits of
handling  friction estimation is currently not used on the
vehicle due to issues previously discussed  but having a realtime estimate of friction could drastically improve the speed
and safety of its autonomous driving at the limits of handling 

initial tests running a soft max algorithm  in which the
algorithm was trained on ramp steer data and tested on general
non ramp steer data  resulted in only     accuracy  seeing
such high error  the focus was first limited to training and
testing only on ramp steer data  this still yielded a training
accuracy of only      such high training error suggests the
data may be inseparable with just the basic sensor
measurements  motivating the addition of other features
relevant to friction estimation 

available data include measurements from on board
production sensors that yield information such as wheel
speeds  steering angle  brake and throttle positions  and engine
rpm  these measurements are supplemented by acceleration 
velocity  and angular rotation rates provided by the gps

estimation methods that determine friction based on lateral
dynamics incorporate the tire slip angle   which is the
angular difference between the heading of a tire and its
velocity      the greater the tire slip angle  the greater the
lateral force the tire produces  at least up until the friction
 

filimit  longitudinal based friction estimation techniques
instead rely on the longitudinal slip ratio   which is ratio of
the difference between the tires angular speed and its absolute
velocity      the longitudinal force of a tire is similarly related
to the slip ratio  the total slip is the square root of the sum
of both slips squared 

was conducted using a forward search algorithm in which the
feature with the greatest improved generalization error was
added at each iteration 
to speed performance of the soft max classifier  feature
selection was trained on only a fraction of the data     
samples  as testing showed including more data did not yield
markedly improved results  for the soft max algorithm the
minimum error was found at    features to be        as seen
in figure  a  although far from ideal  it is a significant
improvement over the performance without the augmented
features  the six most significant features used from feature
set   were  in order of importance  gear position  side slip  a 
of the front tire  a  of the front tire  k  of the front tire and a 
of the rear tire 

various equations have been proposed relating these tire slips
to forces  a linear relationship between slip and force is often
a good approximation at low slip angles  while more
complicated models depend on complex functions of slip  the
dugoff and fiala brush tire models  for example  relate forces
not to the slips but to terms of
 

  

   

tan
  

  

raised to the first  second  and third powers      the magic
tire formula  on the other hand  relates the force to the tangent
of      these forces are proportional to accelerations  which
are in turn proportional to friction  thus the features
  tan          
      were added  where each
term has a lumped value for the two front tires and a lumped
value for the two rear tires  all of these parameters can be
calculated with the basic sensor measurements 

feature set  
feature set  

percent error

  
  
  
  
  
  

 

 

  

  
  
number of features

  

  

figure  a  feature selection for the soft max classifier
training on feature set   and  

certain data measurements were also removed  some features
were removed because they were highly correlated  but others 
such as engine rpm  were removed because they are clearly
unrelated to friction  this will be discussed more in the section
on feature selection  the test data used for training was
collected with various autonomous driving runs spaced over
several years  and so leaving such extraneous measurements
may allow the classifier to find unwanted structure between
the different datasets based on time differences rather than
friction differences  thus four feature sets are referred to in
the remainder of this paper  which are outlined in table   
note that feature set   is the poor performing data set
mentioned earlier and is not used hereafter 

  
feature set  
feature set  

percent error

  
  
  
  
 

 

 

  

  

  
  
  
number of features

  

  

  

figure  b  feature selection for the gda classifier
training on feature set   and  

related
extraneous
slip
measurements measurements features


set  



set  


set  

set  
table    feature sets used for supervised learning
algorithms

when feature selection was performed using gda on feature
set   the minimum error was found at    features to be      
as seen in figure  b  the most significant features for gda
were right rear wheel speed  engine rpm  yaw rate  slip of the
front tires  brake pressure  and left rear wheel speed  tables  a
and  b show the precision and recall of the two analyses 
friction
   
   
   
  
 
unknown
                       
precision
                       
recall
table  a  precision and recall of soft max on feature set  
average precision      average recall     

soft max and gaussian discriminant analysis
both the soft max and gaussian discriminant analysis  gda 
classifier were analyzed on the augmented feature set  set
number    by performing feature selection  feature selection
 

fisupport vector machine

friction
   
   
   
  
 
unknown
                       
precision
                       
recall
table  b  precision and recall of gda on feature set  
average precision      average recall     

hoping for better classification results  a support vector
machine  svm  algorithm was implemented using the csupport vector classifier provided by the libsvm package  
which solves the following optimization problem 

the gda classifier performs better than the soft max
classifier which is to be expected given that even with the
nonlinear features added  soft max is still going to be poor at
classifying a nonlinear phenomenon  the gda classifier in
comparison is less constrained to a linear model  however 
neither classifier performs well enough to be acceptable in
actual implementation on a car 

 
min    
     
   

  

  

 

    

   

            

            

soft max and gda on feature set  

where

unfortunately  parameters such as gear position  which both
algorithms rely upon  are known to have minimal correlation
to friction  therefore  in feature set    parameters such as gear
position  throttle  and engine rpm  which are more likely to
classify driver behavior or an autonomous driving algorithm
than friction  were removed  as can be seen in figures  a and
 b and tables  a   b   a and  b  performance degraded but
only by about      although this new feature set performs
worse it is more likely to be classifying friction than some
other feature in the data sets 

this svm predicts one of two outcomes  so six classifiers
were trained for a given dataset  one for each friction value 
once trained  each classifier predicts the likelihood that a
given dataset may be labeled with its friction value  and the
highest probability value is assumed  thus any number of
friction values could be used for classification  simply
entailing a classifier for each value  the features were
normalized to mean zero and standard deviation   to improve
performance and reduce computation time  normalization
resulted in improvements on the order of     times the
accuracy in     of the computation time  

friction
   
   
   
  
 
unknown
                        
precision
                  
   
recall
table  a  precision and recall of soft max on feature set  
average precision      average recall     

is the training data and

are the friction values 

training on increasing fractions of the ramp steer data  from
      to     of the data  svm was run with the four provided
kernels  linear  polynomial  radial bias  and sigmoid  figure  
plots the resulting generalization error using feature set   and
the default values for each of the kernels  the polynomial
kernel produced the lowest error for every training amount 
and the performance of the respective kernels against one
another remained the same across all three feature sets  some
basic parameters were tweaked between the different kernels 
but the polynomial kernel consistently performed best  this is
consistent with the knowledge that friction is highly nonlinear
in the parameters measured  this ability to handle nonlinear
features allows the svm with polynomial kernel to perform
several orders of magnitude better than either soft max or
gda and even the svm with linear kernel  the irregularities

friction
   
   
   
  
 
unknown
                       
precision
                       
recall
table  b  precision and recall of gda on feature set  
average precision      average recall     
using feature set    the minimum error the soft max algorithm
achieved was found at    features to be         the most
significant features for the soft max algorithm were pitch
angle  longitudinal velocity  side slip  a  of the rear tires  k 
of the front tires  and the velocity of the right front wheel  for
the gda algorithm using feature set    the minimum error was
found at    features to be         the most significant
features for gda were right rear wheel speed  roll angle 
lateral acceleration  a  of the rear tires  break pressure  and k 
of the rear tires  these features are more likely to be
correlated with friction 

 

available at www csie ntu edu tw  cjlin libsvm  
training on     of the ramp steer data with feature set  
using svm polynomial kernel  d    c  

 

 

fiin the trends for each kernel seen in figure   can likely be
attributed to the random sampling of data in small sizes 

kernel is able to create features that can approximate or even
perform better than the nonlinear features  reducing the size
of the feature set is advantageous when moving the algorithm
onto the vehicle for real time calculation  since feature set   
with about half the number of features  requires less
computation time from the on board computer 

test error of different svm kernals  feature set   
    

  

   

 

test error as polynomial degree varies

x   

feature set  
feature set  
feature set  

    
   

linear kernal
polynomial kernal
radial basis kernal
sigmoid kernal

    

 

generalization error

generalization error

 

   
    
   

 

 

 
    
 

 
 

 

 

 

 
 
training data size

 

 

 

  
 

figure    testing different svm kernels

 

 

 

 
 
 
polynomial degree

 

  

  

  

figure    varying polynomial degree

the polynomial kernel is
      

 

 

generalizing the driving maneuver
 
so far the analysis was restricted to ramp steer data sets
because of their ease of data collection and analysis  they can
be easily run  and once collected  they represent a variety of
vehicle states in a relatively small amount of data  however 
generalization of these results to any driving situation  such as
driving in an oval  would be ideal  to test if ramp steer data
was general enough training data to generalize to any driving
maneuver  svms with polynomial kernels d    c   were
trained on ramp steers and tested on ovals  the results for
feature set   are displayed in table     these results indicate
that ramp steers are not general enough to use as training data
for a classifier to predict friction during any driving maneuver 
which would have been ideal  instead  the algorithm must be
trained with the maneuvers that the vehicle may experience 

where n is the number of features and c and d are parameters
of the kernel  a value for d was found by training and testing
on ramp steer data  a non zero c value was chosen so that
polynomial terms of order less than d would also be included
in the kernel  tests showed that as long as c was greater than
  its value did not have a significant impact on performance 
increasing the degree of the kernel caused results to fluctuate
from one training size to the next  likely due to numerical
errors building up as small numbers are raised to large powers 
this especially became prevalent with d    based on this  the
analysis of prospective d values was restricted to values less
than or equal to    the results from varying degree d while
training on     of the ramp steer data with feature sets  
through   are shown in figure    given the comparable
performance of the polynomial of degree   and degree    and
the degradation of performance with feature set   on the
polynomial of degree    the polynomial of degree   was
selected  a polynomial kernel of degree   should also be less
susceptible to numerical errors from raising small numbers to
high powers 

training
testing
error
ramp steer
ramp steer data
     
ramp steer
oval data
      
ramp steer   oval
oval data
     
table    training and testing on different maneuvers
as long as the algorithm is trained on data from ovals as well
as ramp steers  it does a good job of predicting friction during
both maneuvers  as shown in figure     this ramp and oval
trained algorithm was implemented at the santa clara site 
where the vehicle ran ovals around the testing site  the
resulting friction estimation at each time step is included in

given the high performance of the svm the slip values for
feature set   that were added for feature sets   and   were
removed  the comparable performance even with these
features removed suggests that the svm with the polynomial
 

fifigure   assuming a uniform friction value of      the
algorithm returned a        error  however  this site has
significant gravel patches  pot holes  and broken concrete  so
the true friction values for each point in time are unknown but
at times certainly could be lower than      so the true accuracy
of the algorithm is likely higher than        

if this limitation is met  however  the classifier is capable of
predicting friction values in real time 
however  the best algorithm is not always consistent in its
prediction results from data set to data set  even if the data are
from the same surface  which is likely due to a lack of
diversity in training data  going forward  training the classifier
on a more diverse set of data would be ideal  likely starting
with ramp steers  next steps also include exploring other
driving maneuvers and seeing how well the algorithm predicts
friction for those scenarios 

ramp and oval data  feature set   
   
ramp data only
ramp   oval data

    
    

generalization error

    

    van zanten  anton  evolution of electronic control systems
for improving the vehicle dynamic behavior  proceedings of
the international symposium on advanced vehicle control
 avec   pp             
    r  rajamani  d  piyabongkarn  j  lew  k yi  and g 
phanomchoeng  tire road friction coefficient estimation 
ieee control systems magazine  pp         august      
    j  o  hahn  r  rajamani  and l  alexander  gps based
real time identification of tire road friction coefficient  ieee
trans  contr  syst  technol   vol      no     pp          may
     
    c  lee  k  hedrick  and k  yi  real time slip based
estimation of maximum tire road friction coefficient  ieee
trans  on mechatronics  vol     no     pp           june
     
    j  hsu  s  laws  c  gadda  and c  gerdes  a method to
estimate the friction coefficient and tire slip angle using
steering torque  imece         november      
    rajamani  rajesh  vehicle dynamics and control   nd
edition  sae international  warrendale pa       

    
   
    
    
    
    
 

 

 

 

 

 
 
training data size

 

 

 

  

figure    prediction accuracy on ramp steer and oval
maneuvers
 

estimated friction value

  
   
   

   

unknown
 

    

    

    
    
time step

     

     

figure    estimated friction values for oval driving at
santa clara fairground
conclusions
a way to estimate friction from basic vehicle information
available from stock vehicle sensors and an additional gps
system was found  while soft max and gda classifiers do not
perform well  a polynomial kernel svm produces excellent
results  training and testing on ramp steer maneuvers works
well  but training on ramp steers and predicting friction while
running other maneuvers  such as ovals  does not work well 
indicating that this approach requires training on all possible
driving maneuvers that may occur during friction estimation 
 

fi