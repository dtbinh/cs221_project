musical instrument detection
detecting instrumentation in polyphonic musical signals on a frame by frame basis
greg sell

gautham j  mysore

song hui chon

center for computer research in music and acoustics
december         

 

overview

were each between   and   seconds in length  and consisted only of the specified instrument playing in solo
 no silence   then  to create one of the combinations
above  a random signal for each instrument were all
combined randomly  in this way  we created    total
signals for each instrumental combination  the final
   signals of these    were created from recordings
completely independent of those for the first     giving our training  the first     and test  the final    
data 
we used examples from multiple recordings in order to create a more robust system  an instrument
will have many unique features on a given recording 
every individual instrument has a unique character
 due to materials  construction process  body shape 
age  etc    and every individual performer creates a
different sound with the instrument  there are also
many different playing techniques  and then microphone choice and positioning as well as digital effects
and equalization will all create significant variations
between recordings  so  in order to effectively analyze
an arbitrary recording  we need to train our classifiers
with multiple examples 
the test data was created from recordings independent of the training data in order to simulate the
real life situation of encountering a recording with
new filtering  players  etc 

knowledge of the instrumentation of a musical signal at any given time could be useful for major audio
signal processing problems such as sound source separation and automated music transcription  knowing
which instruments are playing is a first step toward
more intelligently designed solutions to these very important and largely unsolved challenges 
so  in this paper  we attempt the problem of identifying the instrumentation of a musical signal at any
given time using several machine learning techniques
 logistic regression  k nn  svm   we approached the
problem as a series of separate binary classifications
 as opposed to a multivariate problem  so that we
could mix and match the best algorithm for each instrument to create the best overall classifier 

 

data

data collection and labeling in audio research can be
extremely problematic  hand labeling audio frames
 of lengths of    ms  is very difficult and time consuming  so  in order to expediate this process  we
chose to artificially manufacture our polyphonic music by combining solo recordings of each instrument 
we chose to investigate   combinations of instruments 

 

 piano  violin
 clarinet  piano  violin

features

the data was first segregated into frames of      samples each      ms   this frame size was selected for
 cello  clarinet  flute  piano  violin
its wide use in speech processing applications 
once divided  we chose to describe each frame with
we collected   samples each from    different
recordings for each of the five instruments  leading three types of features  which were decided based on
to    total signals for each instrument   the samples acoustic knowledge of the instruments 
 

fi 

 magnitudes of the discrete fourier transform
 dft 

using these features  or some subset  see below   we
attempted the problem with four different methods 

 mel frequency cepstral coefficients  mfccs 
 change in energy from frame to frame

   

 logistic regression
 k nearest neighbors  k nn 

dft magnitude

every instrument has defining characteristics in the
frequency domain  frequency range and frequency
bandwidth are often indicative of an instrument 
characteristic frequency peaks independent of a
notes pitch  known as formants  are also often
present in the spectrum of a certain instrument 
in hopes of exploiting these types of differences 
we included the magnitude coefficients of the dft
of each frame  in order to reduce the size of the
data set  we averaged the coefficients in   neighboring
bins to reduce the resolution  we also cut off the
analysis in the   th bin  or      hz  because visual
analysis of spectrograms determined there was not
enough energy present above that point to warrant
inclusion of the data 

   

algorithms

 support vector machine  svm  with linear
kernel
 svm with gaussian kernel

   

logistic regression

logistic regression was implemented using standard
gradient descent  the data was cycled through multiple times using a decaying  parameter  decaying
from    to        to provide a quick convergence 

   

k nn

k nn was implemented with the som toolbox     
for every instrument in every combination  every
value of k from   to      was considered  selection
of the k parameter is described in the training and
testing section 
distances between points were calculating using
the euclidean norm  in order to minimize the domination of a given feature  we preprocessed the data
to unit variance in all features 

mfccs

mfccs are used extensively in speech and speaker
recognition  essentially  they represent the discrete
cosine transform of the log spectrum of a signal
analyzed on an auditory frequency scale  the mel
scale   the process creates a    dimensional vector
that summarizes the signals spectrum 
we included mfccs to represent the differences in
the shape of the spectrum for different signals  which     svm
cause the timbral differences that provide one easy
svms with each kernel were implemented using spimeans for the ear to differentiate the signals  
der      for each instrument  a model selection was
performed separately with each of the kernels 
    energy change
for the linear kernel     logarithmically spaced valdifferent instruments also behave differently over ues of c were used  for the gaussian kernel     logatime  some instruments attack quickly and then de  rithmically spaced values of c and    logarithmically
cay exponentially from there  other instruments at  spaced values of   a total of     combinations of
tack slowly then decay quickly  every instrument parameters  were used 
a larger number of parameter values would have
has a unique amplitude envelope over time  known
in synthesis as the adsr  or attack  decay  sustain  been desirable but due to high computation time
 some of the matlab scripts took well over    hours
relief  
the energy changes of the previous   frames were to run   we decided to stick with the current set of
included as a result of this  this feature set will indi  parameter values  logarithmic spacing of parameter
cate the most recent tendencies in the energy change  values has been used so that a larger range of values
showing whether there has recently been a sudden could be spanned 
attack  slow attack  sudden decay  or slow decay  or
selection methods are described in the training
some combination  
and testing section 
 

fi 

training and testing
piano
violin
clarinet
piano
violin
cello
clarinet
flute
piano
violin

as described in the data section  the data was split
into two completely independent pools  designated
training and testing  however  due to the high computation cost of training svms  we were forced to
reduce the data size and feature set to yield reasonable computation times  around    hours   so  in the
case of svms  only the mfccs and temporal energy
changes were used  dft coefficients were excluded  
also  in each case  a trimmed data set was used for
training  in the case of   instruments  signals   to   
were used  for   instruments  signals   to    were
used  and  for   instruments    to    were used 
in all cases  the testing set was identical 
for logistic regression and k nn  the algorithms
were run in two different situations  in one case  the
algorithms were trained and tested on the same limited data set and feature set as the svms  from here 
those will be referred to as limited logistic regression
and limited k nn 
the algorithms were then run again using all of the
available data  full training set  full features   those
cases will be referred to as full logistic regression and
full k nn 

   

full k nn
  
   
  
  
  
 
   
   
   
    

figure    k values selected for k nn
the differing computational costs of the algorithms
prevent us from simply determining the best overall
approach for each case  because there are two ways to
view the data  one is to consider all the algorithms
on the limited scale to assess the best performance
on the same data  and the other is to compare the
svms to the full logistic and k nn to determine the
best option with a realistic computation time  we
analyzed the data in both ways 

   

model selection   svm and k nn

limited case analysis

svms  in general  give strong results with both kernels  the linear kernel is at or near the top performance for every classification except clarinet  cello 
and piano in the five instrument case  the gaussian
kernel is at or near the top performance for every classification except clarinet in the three instrument case 
and flute  clarinet  and piano in the five instrument
case 

in the case of svm and k nn  it was necessary to
perform model selection to find the values for c  k 
and   for svm and limited k nn  we used      
cross validation to select the model  dividing the limited training set into the selection training and selection testing sets  the parameters were then selected
as the values that achieved the best error rates 
for full k nn        cross validation was again performed  but this time using the full training and feature sets  these selected parameters are displayed in
fig      for k nn and fig      for svm 
it should also be noted that  as stated before  the
parameters for the svms were not able to be optimized beyond one pass over a wide logarithmic scale 

   

limited k nn
  
  
   
  
    
    
    
  
   
    

piano
violin
clarinet
piano
violin
cello
clarinet
flute
piano
violin

results

once model selection was complete  we predicted the
instrumentation in the test signals  in the case of logistic regression and k nn  separate predictions were
made using the limited and full cases  tables containing test accuracy for each instrument can be found in
fig      for limited cases and fig      for full cases 

svm linear
c
     
     
     
        
     
    
 
 
 
      

svm gaussian
c

               
 
       
     
    
    
       
    
       
               
      
    
               
              
      
      

figure    parameters selected for svm
 

fipf
vl
cl
pf
vl
vc
cl
fl
pf
vl

logistic
      
      
      
      
      
      
      
      
      
      

k nn
      
      
      
      
      
      
      
      
      
      

svm lin 
      
      
      
      
      
      
      
      
      
      

svm gaus 
      
      
      
      
      
      
      
      
      
      

perform the limited algorithms 
even though full k nn is often the best classifier 
it is an extremely data inefficient algorithm  in order to make a prediction  the new frame must be
compared to every training frame and then sorted 
the other algorithms are much more efficient in this
regard  so in applications were data storage or computation speed are important  k nn should not be
considered 

 

conclusions

figure    test accuracy of limited algorithms   vc fig     shows the test accuracy attained by combining
  cello  cl   clarinet  fl   flute  pf   piano  vl   the best classifiers  both in the case of only considerviolin 
ing limited algorithms and in the case of considering
all algorithms  we were able to make this step because of our initial decision to treat the problem as
limited logistic regression comfortably outper  separate binary classifiers 
forms all other systems for the clarinet and piano in
in the two instrument case  we are able to predict
the five instrument case 
both instruments with an accuracy of         in
the only cases where limited k nn outperforms the three instrument case  we were able to predict all
the other algorithms are piano for two instruments three instruments        of the time  with   possiand violin for three instruments  however  in both ble combinations   in the five instrument case  we
cases  svms are able to get similarly accurate results  predicted all five instruments correctly        of the
time  with    possible combinations  
    full case analysis
the table also shows how often the classifiers correctly predict at least a certain portion of the comin the two instrument case  the full logistic regression
bination correctly  in some applications  this less reand full k nn are outperformed by the limited algostricted level of accuracy could be as important 
rithms  however  as the instrument combinations become more complex  the full algorithms become more
and more effective  the most significant improve      most common mistakes
ments are with the clarinet and piano in the three
fig      shows the instrument combinations that were
instrument case and with the piano in the five inmost common in false positive mistakes for each classtrument case  where the full algorithms greatly outsifier  fig      shows the combinations the were most
common for false negatives 
logistic k nn
pf
      
      
    future work
vl
      
      
for our future work  we would like to find either more
cl
      
      
efficient svm software or more powerful computers
pf
      
      
so that we could experiment with feature selection 
vl
      
      
which will be especially important as we attempt to
vc
      
      
augment and refine our feature set  ideally  we could
cl
      
      
even select different feature sets for each instruments
fl
      
      
classifier  as was seen in      though  in this case  each
pf
      
      
possible combination of instruments was given its own
vl
      
      
binary classifier  each of which using an individually
optimized feature set  
figure    test accuracy of full algorithms   vc also  we would like to correct two trends that we
cello  cl   clarinet  fl   flute  pf   piano  vl   violin  see in our results  one is that our overall accuracy
 

fi  correct
 
 
 
 
 
 
 
 
 
 

limited best
      
      
      
      
      
      
      
      
      
      

overall best
      
      
      
      
      
      
      
      
      
      

pf
vl
cl
pf
vl
vc
cl
fl
pf
vl

l log 
pf vl
pf vl
cl
pf vl
cl pf vl
vc
cl
fl
pf
vc vl

l k nn
pf
pf vl
cl
cl pf vl
cl pf vl
vc
cl
fl
pf
vc vl

svm l
pf vl
pf vl
cl
pf vl
pf vl
vc
cl
fl
pf
vl

svm g
pf vl
pf vl
cl pf vl
pf vl
vc pf
cl
fl
pf
vc vl

f log 
pf vl
pf vl
cl
cl pf
pf vl
vc pf
vc cl
fl
pf
vc vl

f k nn
pf vl
pf vl
cl
pf vl
pf vl
vc pf
cl
fl
pf
vc vl

figure    most commonly mistaken combinations for
false negatives   vc   cello  cl   clarinet  fl   flute 
figure    test accuracy for limited best and overall pf   piano  vl   violin 
best for different number of instruments required to
be correct 
and feature set can both yield significant results 
however  in order to most efficiently enhance the
performance
of our classifiers  refining the feature set
drops a great deal in moving from two instruments
is
most
necessary 
to three  but then remains about the same in the
move from three to five instruments  the other is
that there is a great deal of consistency in the most
commonly mistaken combinations across the different references
algorithms 
    juha
parhankangas
esa
alhoniemi 
both of these trends indicate to us that we need
johan
himberg
and
juha
vesanto 
to expand improve our feature set  the fact that the
som toolbox 
availabe
online
at
classifiers all make similar mistakes suggests that the
http   www cis hut fi projects somtoolbox 
classes are not properly resolved in the feature space
       
in those cases  also  the similarity in performance
obviously  an expansion of the training data would     gokhan bakir jason weston  andre elisseeff
and fabian sinz  the spider  available online at
also help  some of the less favorable patterns in our
http   www kyb tuebingen mpg de bs people spider  
results could most likely be improved by exposing
     
the classifiers to more instances of those particular
combinations  and adding more training data should
    g  richard s  essid and b  david  instrument
improve the performance  the vast improvement in
recognition in polyphonic music  in proc  ieee
logistic regression and k nn from the limited case to
int  conf  acoustics  speech  signal processing 
full case demonstrates that increasing the data size
     

pf
vl
cl
pf
vl
vc
cl
fl
pf
vl

l log 
vl
pf
pf vl
cl
cl
pf
pf
vc cl
fl
cl

l k nn
vl
pf
pf vl
cl
cl pf
pf
vc cl
vc cl

svm l
vl
pf
pf vl
cl
cl pf
pf
vc cl
vc cl

svm g
vl
pf
pf
cl
cl pf
pf
pf
vc cl
 

f log 
vl
pf
pf vl
cl
cl pf
pf
fl
vc cl
vc cl
vc cl

f k nn
vl
pf
pf vl
cl
cl pf
pf
fl
vc cl
fl
vc cl

figure    most commonly mistaken combinations for
false positives   vc   cello  cl   clarinet  fl   flute 
pf   piano  vl   violin 
 

fi