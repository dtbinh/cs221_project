anomaly detection in bitcoin network using
unsupervised learning methods

phillip thai pham
steven lee

abstract
the problem of anomaly detection has been
studied for a long time  in short  anomalies are abnormal or unlikely things  in financial networks  thieves and illegal activities
are often anomalous in nature  members of a
network want to detect anomalies as soon as
possible to prevent them from harming the
networks community and integrity  many
machine learning techniques have been proposed to deal with this problem  some results appear to be quite promising but there
is no obvious superior method  in this paper  we consider anomaly detection particular to the bitcoin transaction network  our
goal is to detect which users and transactions are the most suspicious  in this case 
anomalous behavior is a proxy for suspicious
behavior  to this end  we use three unsupervised learning methods including k means
clustering  mahalanobis distance  and unsupervised support vector machine  svm  on
two graphs generated by the bitcoin transaction network  one graph has users as nodes 
and the other has transactions as nodes 

   introduction
network structures have appeared for a long time  and
along with them are those who behave abnormally
within the system  we refer to these people or their illegal activities as anomalies  with respect to financial
transactional networks  anomalies can include those
who execute fraudulent transactions  in these networks  a common goal is to detect those anomalies
to prevent future illegal actions 
bitcoin is a special type of transaction system  more
information about it can be found in      we seek
this project is accomplished for cs       machine learning
at stanford university in fall      

thaipham stanford edu
slee     stanford edu
to detect anomalies or suspicious activities in this
anonymous network  where nodes  i e  users  transactions  are unlabeled and there is no confirmation as
to whether or not a given node is actually conducting
illicit activities 
in this project  we focus particularly on the problem
of detecting anomalies in the bitcoin transaction network  which is related to the study of fraud detection
in all types of financial transaction systems  since this
problem can be generalized to those in other network
settings  which may or may not involve financial transactions  we are examining the more general problem of
anomaly detection in networks 
in this paper  we use three unsupervised learning
methods including k means clustering  mahalanobis
distance based method  and unsupervised support
vector machines  svm  on two graphs generated by
the bitcoin transaction network  one graph has users
as nodes  and the other has transactions as nodes 
the rest of the paper is organized as follows  section   describes everything related to methods  including data collection and parsing  feature extraction 
and mathematical descriptions of the machine learning techniques  section   discusses evaluation methods for our proposed algorithms  section   presents
the results we obtained by running these techniques
on the network type data set we generated  section  
evaluates our methods and results  section   describes
future work  section   concludes our study 

   methods
in this section  we describe data collection and parsing  then  we describe feature extraction  and finally
we provide mathematical explanations for the unsupervised learning techniques we use 
     data collection and parsing
we use the bitcoin transaction data set obtained from
the university of illinois urbana  champaign  all bitcoin transactions are documented in a public ledger

fianomaly detection in bitcoin network using unsupervised learning methods

and are in the currency unit called the bitcoin  btc  
the data set contains all bitcoin transactions beginning from the networks creation until april  th       
for each transaction  there can be multiple sender and
receiver addresses  furthermore  multiple addresses
can belong to a single user  finally  users are also
anonymous in that there are no names or personal information associated with a given user 
the data set is quite large  there are             users
with              transactions  we parse the data in
two ways  the first way  which we will call the user
graph  is quite intuitive  users  where each user owns a
list of addresses  are nodes and transactions between
users are edges  the second way  which we will call
the transaction graph  models transactions as nodes
and bitcoin flow between transactions as edges 
in our analysis  we will use both graph types to investigate the bitcoin network  the user graph will
help us detect suspicious users  while the transaction
graph will help us detect suspicious transactions  using these two graph representations  we can not only
find out both abnormal users and abnormal activities  but also check if our methods are consistent in
the sense that suspicious transactions should belong
to suspicious users 
     feature extraction
in order to use k means as a baseline  calculate the
mahalanobis distance  use an unsupervised svm  for
each node in the graph we extract a set of features 
in each of the graph representations of the data  mentioned above   we extract the following    features 
keep in mind that even with the same names  the features mean different things for the two representations 
 in degree  out degree  unique in degree  unique
out degree  clustering coefficient
 average in transaction  average out transaction
 average time interval between in transactions  average time interval between out transactions 
 balance  creation date  active duration
     unsupervised learning techniques
       k means clustering
the purpose of the k means clustering method is to
partition m points  i e  m nodes in the graph  into k
groups of similar characteristics  technically speaking 
k means clustering itself is not a method for anomaly
detection  however  it can be useful  because we expect outliers to stay far away from the centroids found

by k means  k means can be used to assess our true
methods 
for this method to work  we first represent each node
as a multi dimensional vector in the euclidean space 
each dimension of a node is a feature that we choose
from the list described in part      for runtime purposes  we select only a subset of features  for the user
graph  we use six features  in degree  out degree  mean
incoming transaction value  mean outgoing transaction value  mean time interval  and clustering coefficient  for transaction graph  we use three features 
in degree  out degree  total amount of each transaction 
this method produces a set of
in which xi  rn  where n  
graphs  for each i           m 
these m points into k clusters s
min
s

k x
x

m points  x         xm  
  or   depending on
we seek to partition
   s         sk   to solve

  x  i      

i   xsi

where i is the mean of the points in si for each i  
        k  we use the k means clustering algorithm as a
heuristic method to solve this problem  the algorithm
in details can be found in      our final note in this part
is that we use the normalized log of feature values to
account for different value scales of different features 
       mahalanobis distance based method
this method is based on the multivariate gaussian
distribution assumption 
specifically  we assume the training set  x         xm  
where xi  rn  again  n     for user graph and n    
for transaction graph  drawn from multivariate normal
distribution


 
 
t  
 x

 

 x

 
 
exp

p x       
n
 
 
          
the normal parameter fitting method  mle  implies
that  and  can be estimated by
m


b 

m

x
  x
b   
xi and 
 xi    xi   t  
m i  
m i  

b   
then  we will flag x as an anomaly if p x  
b   
for some chosen threshold   note that our data are
unlabelled  so we will train and detect on the same
data set 
       unsupervised svm
the usual svm method does not work here because
our data are unlabeled  so we will use a modified ver 

fianomaly detection in bitcoin network using unsupervised learning methods

sion of it  we also take advantage of the kernel trick
so that we can use an infinite dimensional feature
space  we also assume the training set  x         xm  
where xi  rn for all i 
we start with the primal optimization problem 


  t
w w s t  wt xi   i           m 
min
w 
 
a new test example x will be labeled sign wt x    
the point x with label     is flagged as an anomaly 
note that the data are not linearly separable  so we
need to use a soft margin svm  however  we will not
use the constant c as in the usual soft margin svm
due to its difficulty in interpretation  instead  we follow     to use  svm method as follows 

min

w  

 
m
  x
  t
i     s t 
w w 
 
m i  

wt xi    i i           m and i    i           m 
here           can be interpreted as an upper bound
for the fraction of outliers  i e  anomalies   in the
results section  we will determine which  is optimal 
following     again  we can write the corresponding
dual problem using the kernel trick 


m
m x
x
 
min 
i j k xi   xj   subject to

  i   j  
   i 

m
x
 
i           m and
i     
m
i  

here  we choose k x  z    exp  x  z     where the
hyper parameter  will be fine tuned later 
to solve for this optimization problem efficiently  we
can use smo method       
finally for     j  
 

 
m  
m
x

we can recover  

i k xi   xj   

i  

then
pm

a new point x is flagged anomaly if

i   i k xi   x      again  since our data are all unlabelled  we will will use the same data set for training
and detecting 

 using k means as a baseline  we can calculate
the relative distances between the detected outliers and the centroids  if these values are small 
then we conclude that our methods are not good
enough  we call this visualization evaluation 
 since we represent our data in two ways with
nodes and edges somehow exchanging  we can test
for our methods consistency by checking if detected suspicious users own detected suspicious
transactions  we call this dual evaluation 
specifically  with the user graph we can get the
top n user outliers and with the transaction
graph we can get the top m transaction outliers 
in this paper  we choose n   m        we
then determine xn   the set of transactions corresponding to the top n node outliers and ym the set of users corresponding to the top m transaction outliers defined above  we define

a   

 xn  top xn transaction outliers 
 xn  

and
a   

 ym  top ym user outliers 
 
 ym  

finally  we define the dual evaluation metric
mde by
a    a 
mde  
 
 
note that mde          and the bigger it is the
more accurate our method is 
 finally  there are roughly    revealed thieves in
the bitcoin network  we can check if they belong
to our detected suspicious user and transaction
sets  for this reason  these users and their illegal
transactions will be included in the test sets of
our methods 

   results
the  svm method takes a long time to run  and since
we are not able to use techniques like gpu parallelized
computation at the moment  we will limit our data set
to          data points for all methods 
     k means clustering

   evaluation methods
with unlabeled data  evaluating our methods is a difficult challenge  due to the nature of the network type
data set we have  we propose three evaluation methods 

using the k means clustering metric in     we find that
setting k     minimizes cross cluster entropy for the
user graph and k     for the transaction graph   figure     for the sake of the dual evaluation method  we
choose k     for both graph types 

fianomaly detection in bitcoin network using unsupervised learning methods

figure    cluster entropy vs  k

figure    anomaly detection using mahalanobis distance 
transaction graph

     mahalanobis distance based method
now  we run the mahalanobis distance based method
for two types of graphs   figures       

figure    plot of a  and a  over  in  svm method 

figure    anomaly detection using mahalanobis distance 
user graph

the detected anomalies seem to appear at the border
of the plot  which indicates that abnormal activities
are usually extreme 
     unsupervised svm
we now run the unsupervised  one   class   svm
method for two graph types  we start with identifying the optimal hyper parameter   based on the
evaluation section  we will choose the  which gives
the largest values of a  and a    it turns out that the
optimal  is around         figure    
now with           the  svm method gives us the

detected anomalies for both types of graph representations in figures   and   
the suspicious users and transactions suggested by the
unsupervised svm method appear to be quite similar
to those suggested by the mahalanobis distance based
method  they both usually appear on the outer borders of the graphs 

   evaluation results
 using k means clustering method  we get k clusters with corresponding k centroids  for each
graph type  user and transaction  and for each
method  mahalanobis and unsupervised svm  
we calculate the average of the ratios of detected
anomaly distances to corresponding centroids over
max distances from those centroids to their as 

fianomaly detection in bitcoin network using unsupervised learning methods

for the unsupervised svm method  we get a   
       and a           which gives mde  
         this value is much higher than the
one produced by the mahalanobis distance based
method  even given our small set of data 
 for the mahalanobis distance based method  we
detect one known theft that occurred in june
      the anomalous transaction obtained a total of over      btc from     various addresses
and funneled them to a single address 

figure    anomaly detection using unsupervised svm 
user graph

for the unsupervised svm based method  we
detect one known loss that occurred in october
      the anomalous transaction was one of   
transactions that caused a user to lose over       
btc due to corruption in a hashing function 

   future studies
we propose to parallelize computation in order to enable faster outlier detection using a gpu  this involves
significant work  such as introducing thread safety in
the learning methods  but will allow us to analyze the
full dataset of     million transactions 

   conclusions

figure    anomaly detection using unsupervised svm 
transaction graph

in this paper  we have investigate the bitcoin network 
we first represent the data with two focuses  users and
transactions  we then use three main social network
techniques to detect anomalies  which are potential
anomalous users and transactions  while the agreement metrics are not high  we are able to detect two
known cases of theft and one known case of loss  out
of the    known cases we have 

references
signed points for the top     outliers 
for the mahalanobis method  we get        for
the user graph and        for the transaction
graph  for the unsupervised svm method  we
get        for the user graph and        for the
transaction graph  these values are as large as
we expect them to be since by observations in the
result section  detected anomalies appear to be
extreme points 
 for the mahalanobis distance based method  we
calculate a  and a  to be         and         
respectively  which gives mde            
though this value is quite small  it comes out not
as a surprise given the simplicity of our method
and our small set of data 

    https   bitcoin org en 
    lloyd  stuart p          least squares quantization
in pcm  ieee transactions on information theory
                
    b  scholkopf  j  platt  j  shawe taylor  a  j 
smola  and r  c  williamson estimating the support
of a high dimensional distribution  neural computation                      
    j  platt  sequential minimal optimization  a
fast algorithm for training support vector machines 
technical report msr tr        microsoft research 
    a 
    xiong  h  et al  k means clustering versus validation measures  a data distribution perspective 
kdd    august             

fi