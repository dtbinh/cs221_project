automatic detection of plasmonic nanoparticles in tissue sections
dor shaviv and orly liba

   introduction
plasmonic nanoparticles  such as gold nanorods  are gaining popularity in both medical imaging and therapeutics  for example  they
can be used for treating cancer  the rods are first coated with antibodies that bind to tumor specific antigens  they are then injected to
a patient and accumulate in the tumor  next  the patient is illuminated by infra red light  the light is absorbed by the nanoparticles 
causing local heating that destroys the tumor cells which the rods are bound to  the healthy cells which are not near the nanoparticles
remain intact  it is important to quantify the binding of the nanoparticles to their target and prove that the binding is indeed specific to
the tumor cells  very recently  it has become feasible to image both the nanoparticles and tissue section  by using a dark field
microscope with an infra red hyperspectral camera we are able to see the pathology of the tissue and the nanoparticles  however  it is
not simple to locate and differentiate the nanoparticles from other structures in the tissue sections 
in this project we propose an algorithm for automatic detection of nanoparticles in tissue sections by using their scattering spectrum in
a dark field hyperspectral microscope 
owing to their plasmonic resonance  the gold nanorods have a peak scattering wavelength at around     nm  this unique scattering
spectrum  along with the high scattering intensity of the nanorods  enables us to detect them in tissue sections by using a dark field
hyperspectral microscope  although the nanorods have a very unique scattering spectrum  it is well known that their spectrum is
sensitive to their environment and orientation  therefore  one of the challenges in this project is the variability in the spectrum of the
particles we wish to detect 
although the nanorods can be spotted in the images by eye  it can be very difficult to be sure that we are able to detect all of them in
the tissue samples  this is because the images of the hyperspectral microscope are ultimately represented by only three channels  r  g
and b  and do not show the full spectrum of each pixel  the large benefit of using an automatic detection scheme rather than just
looking at the images is that it can classify the nanoparticles from the tissue by using the full spectrum  another benefit of the
automated algorithm is that it can detect and then count the number of nanoparticles in the image  the number of nanoparticles is
valuable for understanding the efficiency and specificity of their binding 
this report describes our progress in detecting the nanorods using methods learned in cs     we have examined three methods of
classification  logistic regression  svm and k means  we also looked at reducing the dimensionality of our data with pca  the details
and results are described below 

   experimental setup
the gold nanorods that we are using were made in house by the members of the de la zerda lab  their dimensions are   x    nm and
have a peak scattering wavelength at around     nm  in order to stabilize them and make them bio compatible they were coated with
pss mpeg  functionalization  i e   adding a binding agent to the nanorods  was done by introducing antibodies which are meant to be
tumor specific  for example anti avb  
in order to create tumor models  we injected the ears of nude mice with cancer cells  seven days after the cells were injected  we
injected the nanorods to the tail veins of the mice  after several hours we sacrificed the mice and preserved the ears  which include the
tumors and healthy regions  the preserved ears were sliced to   um thick slices and stained with h e staining 
we imaged the slides using the cytoviva hsi system with enhanced sensitivity dark field hyperspectral microscope      which is
located at snf  the hyperspectral camera records the spectrum of each pixel at     sample points  at the wavelength range of     to
     nm  the spectrums are lamp normalized  meaning that they are independent of the spectrum of the light source  each image has
   x    pixels       um   we used an objective with   x magnification  which provides a pixel size of around     nm  we collected
   images of sections of mice in which nanorods were injected    images of sections of mice without any injection and   image of
gold nanorods on a glass slide 
 

a

   

c
c

b

d

   
   
   
 
   

   

   

   

   

    

  nm 

figure   a  tem image of gold nanorods  b  scattering spectrum of the nanorods  measured with the hyperspectral microscope  c  h e stained tissue slice of
a mouse ear    x magnification   d  diagram of a dark field microscope 

fi   data preparation
the raw data we use for the machine learning problem are the spectrums recorded for each pixel in the image  we have noticed that
applying pre processing to the raw data improves the results significantly  these are the steps we are currently performing before
applying each of the machine learning models 
   spectrum truncation  the first     samples of the spectrum           nm  are removed because they contain mainly noise
and do not contribute to the detection of the nanorods  therefore  we remain with     feature points 
   background removal  the average signal across the spectrum was measured for each pixel  the pixels with very low values
were disregarded because they are background and contain only noise 
   spectral smoothing  noise in the spectrum is amplified at the edges due to the lamp normalization  we applied the savitzkygolay filter  with length    and degree   to reduce the noise in the spectrum 
   normalization  the spectrum of each pixel was normalized by its maximum value  this was done to make the algorithm
invariant to illumination 

   machine learning methods and their application
support vector machine  svm   training and prediction were done with liblinear v           we used l  regularized l  loss
support vector classification  primal  with the default regularization parameter  c    and with a bias term  b    

 

        max                 

 
  

when solving the dual problem  the optimization did not converge in the maximal number of iterations  we chose a linear kernel
owing to the high number of samples and features of our data  the model was trained using two images  fig   a  b   in an image of
nanorods on glass  without tissue   each pixel above the background noise level was labeled as      in an image of a tissue slide
without nanorods  each pixel above the background noise level was labeled as       the model was tested with cross validation on the
two training images  fig   a  b  with k     the model was also tested qualitatively on images of tissue with nanorods 
logistic regression  we implemented logistic regression with stochastic gradient ascent on matlab  the convergence criterion was
      training error  the learning parameter    was annealed in each iteration  we used a similar training and testing scheme as svm 
batch gradient descent was also implemented but it did not converge well 
k means  since we know that the nanorod spectrum is sensitive to its environment  it is preferable to train our model on more
representing samples  i e   tissue samples with nanorods  rather than nanorods on glass  because we can never be sure if what we are
seeing is a nanorod or part of the tissue  it should be beneficial to use a non supervised learning method  such as k means  to cluster
the different objects in the images  and hopefully obtain a separate cluster for the nanorods which will allow us to classify them  we
used matlabs k means function  with            and   clusters  and trained it on   images of nanorods in tissue  we tested our model
against the two images containing nanorods on glass and tissue without nanorods  fig   a  b   and also qualitatively  the nanorods
cluster  positives  was determined by picking the most prevalent cluster in the image with nanorods on glass  whereas all other
clusters were labeled negative 
principal component analysis  pca   we implemented pca on matlab to reduce the dimensionality of the data  pca was done on
  images of tissue sections with nanorods  we managed to reduce the dimension of our features from     to just   and conserve
      of the energy which is quite amazing 
pca   k means  spectral clustering   following pca  we clustered our data in a similar manner to the previously described kmeans  we present the results for   clusters  the model was tested against fig    a  b 

a

b

c

figure   images used for training and testing our models  a  tissue section with no nanorods  b  nanorods on top of a glass slide  c  a tissue section in which
nanorods are present and shown with a red orange color 

fi   results
svm   logistic regression
svm
predicted
true
 
 
precision
recall
f score
training error
   of samples 
test error
   of samples 
  of iterations

 
        tn 
   fp 

stochastic logistic regression
 
     fn 
        tp 

 
      
  

      
      
      
     
         
     
        
 

 
  
      
      
      
      
      
         
      
        
  

svm based on k means labels
 explained in section   
 
 
      
   
  
      
      
      
      
         
     
        
 

k means
predicted
true
 
 
precision
recall
f score
training error
   of samples 
test error
   of samples 
iterations  

  clusters
 
 
      
   
   
      
      
      
      
         
     
        
  

a

  clusters
 
 
      
   
   
      
     
      
      
         
     
        
  

  clusters
 
 
      
   
   
      
      
      
     
         
     
        
  

c

b

  clusters
 
 
      
   
  
      
      
      
      
         
     
        
  

pca     clusters
 
 
      
   
   
      
      
      
         
     
        
  

d

figure    an example of one image classified by a  svm  b  logistic regression  c  k means with   clusters and d  pca   k means  the pixels labeled positive
 nanorods  are marked in magenta  the yellow circles show regions which are positive for unsupervised learning and negative for supervised learning 

a

c

b

   

   

   

figure    a  the   cluster centers obtained by k means  the magenta plot corresponds to the nanorod cluster  b  validation of the spectrums
of the pixels detected as nanorods by the k means classifier  they all have the distinctive nanorod peak  c  the principal components

fi   interesting observations
  

it is interesting to see that k means detects more nanorods than the supervised learning methods  visualizing the data by
looking at its principal components reveals that k means detects more positives than the svm decision boundary allows 
moreover  we see that the nanorods on glass are distinctly different than the nanorod cluster in the tissue section  this leads
us to conclude that nanorods on glass have a different spectrum than in tissue section  which implies that unsupervised
methods may be better than supervised methods in this case 
svm decision boundary
nanorod cluster
non nanorod
cluster

nanorods on glass
region classified as
positives by k means and
negative by svm

tissue only

figure   visualization of the data with pca  red  nanorods on glass  blue  tissue only  magenta  pixels in the nanorods cluster  from
images of tissue with nanorods  according to k means with   clusters  applied on the data after pca   cyan  pixels not in the nanorod
cluster  the plane is the decision boundary calculated by svm trained on the red and blue data 

  

following our observation that nanorods on glass have a different spectrum than nanorods in tissue  it is interesting to create
a supervised learning model based only on the tissue sections  assuming that the labeling of k means is correct  this claim is
supported by looking at the spectrums   we trained the supervised learning model  svm  in this case  based on the k means
labels  doing this after reducing the dimensionality of the data with pca provides insight to the difference between the
models  as shown previously  the model trained on tissue samples increases the number of positives  the results of this
method  when tested on the two images with nanorods only and tissue only are in section   

figure   data visualized with pca as in fig    with two svm decision boundaries  green  trained on positive and negative samples
 nanorods on glass and tissue only   yellow  trained on the data labeled with k means  train and test samples are from different images 

  

in two of the tissue images in which nanorods were not injected  the k means model detects positives  nanorods  near the
edges of features  these are actually imaging artifacts caused by chromatic aberrations  analyzing the spectrum of the
aberrations shows a significant difference to that of the rods  using k means a second time  with   clusters  trained only on

fithe pixels in the nanorod cluster  from the original   training images   reduces the positives in these images  the test error
after adding the additional cluster is       the test samples dont include the image below  

a

b

c

figure   reduction in false positives caused by chromatic aberrations by applying an additional cluster  a  analysis of the spectrums of
positives in the tissue samples  chromatic aberrations  blue   nanorods in tissue  magenta  and nanorods on glass  red   b  tissue section with
false positives using   k means clusters  c  tissue section with much less false positives using   k means clusters and an additional k means
clustering step on all of the positives 

   summary   discussion
we have succeeded in detecting the gold nanorods in tissue samples with k means  svm  logistic regression and a combination of
those with pca  all had a test error that was less than       k means  even with only   clusters  does a good job detecting the rods in
the tissue section  increasing the number of clusters to      and   further improves the classification  it was nice to see that pca
managed to reduce the dimension of our features from     to just   and conserve       of the energy  we have shown that the
nanorods on a glass slide have a different spectrum than nanorods in tissue  this difference leads to a decrease in the number of pixels
classified as positives when we use supervised learning  svm and logistic regression  compared to unsupervised learning that was
trained on the tissue slices  therefore  unsupervised learning methods  such as k means  are more suited for this task  we also found
that chromatic aberrations are sometimes detected as nanorods and that we can reduce these false positives with an additional k means
cluster 

   next steps







since we have found that nanorods on glass have a different spectrum than in tissue  training and testing using nanorods on glass
is sub optimal  thus  we would create a ground truth of rods in tissue  perhaps by observing the spectrums at potential pixels 
this ground truth could be used for training supervised learning models and testing all types of models 
we would like to try additional machine learning models  such as neural networks  svm with different kernels and gaussian
mixture models 
seeing that we were able to reduce the number of features from     to    could we use these   features to encode for color  rgb 
and visualize the rods in the tissue sections in a  d colored image 
in addition  we would like to optimize the preprocessing of the data to allow for better background and noise removal and
reduction of chromatic aberrations 
another possible approach to improving the detection of the nanorods would be to image the tissue sections before staining them 
since the staining changes the spectrum of the nanorods 
in the future it would be nice to be able to classify multiple kinds of nanoparticles  with different scattering spectra  and perhaps
also different cell types and organelles 

   acknowledgements
the authors would like to thank elliott sorelle  roopa dalal and the members of the de la zerda lab for providing the materials and
data for this project  we would also like to that professor andrew ng and the ta team of cs    

    references
    http   www cytoviva com wp content uploads         spec sheet vnir enhanced sensitivity pdf
    r  e  fan  k  w  chang  c  j  hsieh  x  r  wang  and c  j  lin  liblinear  a library for large linear classification  journal
of machine learning research                     software available at http   www csie ntu edu tw  cjlin liblinear

fi