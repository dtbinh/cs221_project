new york city bike share
gary miguel  garymm   james kunz  jkunz   everett yip  everetty 
background and data 
citibikeisapublicbicyclesharingsysteminnewyorkcity itisthelargestbikesharingprogramin
theunitedstates thesystemadministratorshavemadethefollowingdatafreelyavailable
 http   www citibikenyc com systemdata foreverytripfrom      to           milliontrips  
 starttimeanddate endtimeanddate 
 startlocation endlocation 
 whichbiketheuserison 
 typeofuser subscriberorcustomer oneoffrental  
 birthyearoftheuser onlyforsubscribers  
 genderoftheuser onlyforsubscribers  
wealsouseotherfreelyavailabledataonweather events holidaysandgeographicfeatures 

motivation and goals 
weputourselvesinthemindsetofanadministratorofthebikesharesystem andusethedatato
betterunderstandthesystemsusersinordertoprovidebetterservice inparticularwe 
 predicttherateofdeparturesatagivenstationatagiventime ifsystemadministrators
underpredictthis demandforbikesexceedssupplyandcustomerswillbeunhappy ifthey
overpredict theywillwastemoneyonexcesscapacity 
 predictthetotalnumberofbikesbeingusedthroughouttheentiresystematanygiventime 
understandingwhenbikeswillbeinusewillgiveadministratorsahighlevelviewofgeneral
usagepatterns allowingthemtoplanmaintenanceandcapacityincreasesmoreeffectively 
 findparticularpropertiesofdifferentstations forexample whichstationshavenetoutflows
orinflowsofbikesatcertaintimes 

preparing the data 
inadditiontothecitibikeridedata wealsoincludedthefollowingdata 
 weatherdatafromnoaa http   cdo ncdc noaa gov qclcd qclcd  
 listofstateholidaysfromwikipedia 
 schedulesofnewyorksmlb nbaandnflteamsgames 
 eventscollectedbythenewyorktimes http   developer nytimes com docs events api 

weconvertedtheperridedatatoseveralaggregatedmeasures including 
 countsofdeparturesandarrivalsateachstationforeachhourinthedata 
 combinedmeasuresforeachhourofthedayacrossalldaysinthedataset egalldepartures
between          summedacrossalldays  
 totalbikesbeingusedacrosstheentiresystemforeveryhour 

thisdatawasjoinedwiththeotherdatasourceswecollected thisinvolvedextensive
preprocessingasweencounteredmajorchallengeswithdataformattingandquality eachdata
sourcehasitsowndateandtimeformatwhichwehadtoparseandjoin forexample thenewyork
timeseventsapireturneddatetimedatainstringslikedec     wednesdayat    p m  

fithursdayandfriday p m  saturdayat and p m  sundayat p m  whichweconvertedintoa
listofspecifictimes theweatherdatamixednumericvalueswithspecialalphanumericcodesthat
wehadtolearnhowtointerpret 
wealsofounditusefultoaddintimeshiftedfeatures forexample wehaveonefeatureforthe
outsidetemperatureatacertainhour andweaddedfeaturesforwhatthetemperaturewouldbe  
  and hoursinthefuture andinthepast dependingonhowfarintothefuturepredictionsneed
tobemade wealsofoundprovidingactualusageintherecentpastasafeaturetobeincredibly
useful 

data analysis 
bike mixing  how many stations do most bikes visit 
welookedattryingtoclusterstationsbythetravelpatternsof
bikes inparticular wewerecuriousifwecouldlearn
associationsbetweenstationsbythebikesthattendtotravel
betweenthem itturnsoutthatalmostallbikesvisitallthe
stationshowever therearesomeam pmpatternsthatare
interesting seebelow  


which stations typically lose or gain bikes in one day 
asasystemadministrator ifbikestakenfromstationxinthe
morningarereturnedtothesamestationxintheevening then
noworkneedstobedonetokeepthenumberofbikesatthat
stationstable assumingtherearesufficientbikesatthestation
tosatisfyadaysworthofdemand onlyabout    oftripsstartandendatthesamestation soin
ordertoanalyzethis wehavetolookatnetdeparturesand
arrivalsperdaytoseehowmuchthesystemadministrators
havetomanuallycorrectthedistributionofbikes 


wefound 
 almostallstationsareinbalancewithintheday 
 whilestationsbalanceoveraday theyoftendosoin
differentways inparticular certainstationslosebikes
inthemorningandgainthemintheevening while
othersseetheoppositepattern 


eachpointintheaboveplotrepresentsastation thexandy
valuesarethenetnumberofbikeslostinamandpm 
respectively negativeloss again  beingabovethey xline
meansastationlosesbikesonanaverageday 


inthefollowingtwoplots greendotsrepresentthenetsources wecanclearlyseetherushintothe
citycoreinthemorningandoutintheevening ascanbeseeninthepreviousplot ahandfulof
stationsarealwaysnetsourcesornetsinks 


fi
morningcommute

eveningcommute

predicting total system usage  by hour
wehaveexploredafewalgorithmsandfeaturesetstopredictthetotalnumberofsystemusersat
anygiventime wehavedatafor      hours aggregatingthedepartureandarrivalsacrosstrips 
wecancomputeanestimateofthetotalnumberofbikes
currentlysignedoutofthesystemoverthecourseofany
particularhour webuiltalinearregressionmodelbased
onthefeaturesmentionedearlier thelearningcurveis
totheleft itisaclassiccaseofhighbias testset
performanceissimilartotrainingandbotharewoefully
bad infact itperformedsopoorly mse     itwas
nearlyoutperformedbysimplypredictingthemean mse 
       


webuilttwoadditionalmodelsonthisdata firstusinga
glm specificallypoisson  giventhatitisthecanonical
distributionformodellingthissortofproblem butittoo
underfit secondly webuiltarandomforestusingrs
randomforestlibrary itachievedconsiderablybetter
     mseonthetrainingsetand    onthetestset  

how many bikes will leave a particular station at a
particular time 
tonarrowdownwhichfeaturesandtechniqueswouldbe
usefulforthisproblem westartedoffbyfocusingonjustoneparticularstation e  st  ave and
justfocusingonsubscriberdepartures 
foreachalgorithmweusedthescikitlearnimplementation withgridsearchand fold
crossvalidationtofindmetaparameters foreachhour wetriedtopredictlog numberof
departures    seelastsectionforrationale  wetrainedon   ofthedata testedonthe
remainder resultsofvariousalgorithmsandfeaturetypesonourtestset 


fidescription

meansquarederror log x    

ridge       

     

lasso        

     

lasso         scaledfeatures

     

lasso         scaledpolynomialfeatures

     

svm rbfkernel c    

     

svm rbfkernel c     scaledfeatures

     

svm rbfkernel c     scaledpolynomialfeatures

     

randomforest   trees 

     



notewealsotriedelasticnetmodels butcrossvalidationfoundtheoptimall ratiowas    meaning
itwasexactlythesamemodelaslasso 
havingdeterminedthatarandomforestisthebesttypeofmodelfromtheoneswetried wethen
appliedittosomerelatedpredictiontasks 
foreachstation webuiltarandomforest andpredictedhourlydeparturesforit sortedthestations
bymseandthenlookedat  th   thand  thpercentilemse 
thefirsttaskwastotrytopredicthowmanysubscriberswoulddeparteachstationateachhour we
triedtwoapproaches predictingthisdirectlyforeachstation andpredictingitasafractionofthe
totalsystemusage predictedtotfornonpoliticalactivitiesandprogramsonlyalsystemusage our
guesswasthatwehavemuchmoredatatobuildabettermodeloftotalsystemusage sothis
methodmightbebetter infactitwasnot 
description

  th mse   th mse

  th mse

subscribersforeachstation

     

     

      

subscribersforeachstation calculatedas
 predictedfractionoftotalsystemdepartures  
 predictedsystemdepartures 

     


     

      



afterthiswestartedpredictinglog hourlydepartures  seenoteattheendforwhywethinkthisisa
betterthingtopredict wetriedtwoapproachestopredictingtotaldepartures predictingitdirectly 
andbuildingonemodelforcustomers anotherforsubscribers andsummingtheirpredictions the
intuitionisthatthesetwotypesofusersbehaveverydifferently andtheseparatemodelsdidgive
differentfeaturesimportance forexample forourteststationofchoice ourrandomforestshadthe
followingfeatureimportances wheretheimportanceacrossallfeaturesmustsumto   
subscribertopfeatureimportances

customertopfeatureimportances

hourofday      

hourofday      

dayofweek      

currenttemperature      

ficurrenttemperature      

temperature hoursago      

temperature hoursago      

dayofweek      



thedifferencesinfeatureimportancesareclear butthetwoapproachesperformverysimilarly 
log alldeparturesforeachstation 

     

     

     

log alldeparturesforeachstation  predictedas
predictionforcustomers predictionforsubscribers

     

     

     



andwetriedtwowaysofpredictingthesubscriberdepartures summedoverallstationsintheentire
system again wethoughtbuildingseparatemodelsforseparatestationsmightbebeneficial butit
seemswejustdonthaveenoughfeaturestoaccuratelypredicttheperstation


description

mse

log systemwidesubscribers 

     

log systemwidesubscribers  predictedassumofpredictionsforeachstation

     



technical aside  log  s   heteroskedastic data
inclassandps wesawtheimportanceofafixedvarianceintheerrortermwhenperforminglinear
regression itisunreasonableforourproblemtoassumethatthisexists instead weexpectafixed
varianceintermsofsome agearoundtheexpectedvalue wecapturethisbypredictingthelogof
thevalueinsteadofthevalueitself weminimizesumof log predict log actual   or equivalently
 log predict actual   asonewouldexpectwiththissortof
formulation weseethelearningalgorithmsacceptlarger
 absolute errorsaroundlargertargetnumbersthansmallones
 seeplotshowingerrordistribution eachpointisanhourinthe
testset  the errortoleratedinthisdataremainsrelatively
constantsimilartohowyoudexpecttheabsoluteerrorsto
remainconstantinahomoskedasticproblem thisintuition
carriesoverintothepracticalapplicationofthedata 


future work 
morefeatures weknowdataexistsontransitdelays transitridership moredataexistsonlocal
events illnesses crime economictrends bikerideswithprivatelyownedbicycles 
moresophisticatedgraphclusteringalgorithmsofthesortintroducedincs   wmayhaveyielded
interestingunsupervisedlearningresults studyingtheflowoftrafficbetweenpairsofstationsmight
increasetheunderstandingofbikeflowinthesystem perhapsitwouldilluminatewhyanumberof
stationsseemtobenetsourcesorsinksregardlessofthetimeofday 

fi