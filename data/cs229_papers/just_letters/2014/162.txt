nave bayes classifier and profitability of options gamma trading
hyung sup lim
hlim  stanford edu
abstract
at any given time during the lifetime of financial options  one can set up a variety of delta neutral positions  in
essence  delta neutral volatility strategies attempt to make profit from correct prediction about the two
components of options price  the mean reverting properties of implied volatility and the change of intrinsic value
due to underlying price change  in this project  we focus on the latter  the intrinsic value  so we will assume
constant volatility across the project  delta neutral portfolios sensitivity with respect to underlying is measured
by the greek letter delta and gamma  the first and second derivative of options value with respect to underlying
price  respectively 
volatility traders who take long gamma position bet that market would move fast enough to cover the cost of
holding their delta neutral position  if one expect that market is going to stay constant for a certain amount time 
then one might want to take short gamma position and collect the decreasing time value of options as profit 
thus  in delta neutral volatility trading  it is crucial to predict whether or not the underlying market is about to
move significantly anytime soon  we will test the profitability of short gamma strategy  so we want to answer the
question  is it safe to short on options to collect time value now  or is the market swing imminent so short
position on options will result in incurring loss  in this project  we apply nave bayes classifier to kospi    
index options data to classify each days underlying price data into success or failure based on profitability of
short gamma strategy 

i  introduction
motivation
the stock price movement is generally believed to be unpredictable  true news is random  and the market is generally
efficient in reflecting new information into its price  assuming the semi efficient market  there might exist intelligent investors
who have the information which has not yet been fully reflected in the price  there might also be some investors who are
equipped with fundamental analysis and profound insights into the market  they will all try hard to make a directional bet on
price  they would take a long position as they hope the price goes up or a short position vice versa  however  the introduction
of financial derivatives  especially options  transform the rule of the game  under the cloud of the directional uncertainty 
financial derivatives allows the freedom from long or short only strategies and opens to door to variety of strategies that are
irrelevant of directional moves  then  where does the uncertainty part come in when it comes to delta neutral options
portfolio 
new rule of the game  market direction does not matter
the uncertainty now comes from two sources  the implied volatility and gamma  the implied volatility is a portion of
options contract price that we can consider as measure of investors fear of uncertainty within the market  gamma is the  nd
derivative of options price with respect to the underlying price  equivalently  gamma is the first derivative of delta  and delta is
the first derivative of options price with respect to underlying  in volatility strategies  we usually set up our options position so
as to minimize our delta  so  our delta neutral position would be insensitive to small changes of underlying price 
however  our gamma is not zero  so large movement of underlying will result in change the value of our portfolio  deltaneutral but positive gamma portfolio would generate profit if the underlying price moves significantly  however  positive
gamma is not free  positive gamma inevitably means negative theta  theta is the  st derivative of the options price with
 

firespect to the time  thus  a positive gamma and negative theta position means that we might gain if the underlying price
moves to either direction significantly  but we lose money each day if the underlying stays within some range  after all  the bet
is not about whether or not the price would go up or down but about whether the underlying price would move significant
enough to pay off our theta cost to hold that portfolio 
effect of dimension reduction  target variable is now just binary
suppose that we had to make a detailed prediction about price in the future  so response variable is multivariate  for
example  if we had to predict not only the price would go up or down  but also how much it will go or down and how long it
will take to reach that prediction price  then  it would be very challenging  and we can expect the test error rate of our model
to be very large  what if we do not have to predict the duration such that the dimension of time does not matter  the challenge
of prediction would be easier  now  suppose further that we do not have to predict how much it would move  and only be
asked to predict whether it would go up or down  then  it is now easier again  similarly  in the option volatility trading  we
only need to predict whether or not the price would move enough or not  direction does not really matter  hence  the
introduction of volatility strategy has the effect of reducing the dimension of response variable such that it makes our
prediction less challenging  if not easy 

ii  data
top    equity index futures   options contracts
rank contract index multiplier jan dec      jan dec        change
  kospi     options  krx           korean won                                   
  s p cnx nifty options  nse india    indian rupees                              
  spdr s p     etf options    n a                               
  e mini s p     futures  cme    u s  dollars                               
  rts futures  moscow exchange   u s  dollars                               
  euro stoxx    futures  eurex    euros                               
  euro stoxx    options  eurex    euros                               
  s p     options  cboe     u s  dollars                               

we use kospi     options data  kospi     options are
based on kospi    index  which is a market capitalization
weighted index that consists of     blue chip stocks listed on
the krx stock market  kospi    options is the most actively
traded index options in the world today  so the options price
is very efficient  the time series data ranges from sep       

  sensex options  bse    indian rupees                             

to dec         approximately   years of price data 



    

   



   nikkei     mini futures  ose     yen                              

          index   

during that period we had    options expiration dates  for each    options expiration  the price data is partitioned such
that each partition has    days time series data we set up a   x   matrix  in which i th row represents the ith date within
options life time  and j th column corresponds to j th expiration options 

iii  data preprocessing and target variable
we want y to indicate whether or not it is worthwhile to take a delta neutral position at time t  because we are focusing on
gamma aspect of volatility strategies  we will assume that volatility is constant throughout the project  hence  we will define y
as the following 

 
                        
 
 
                        
 
         
               
              
 
the definition above uses quadratic approximation  we chose y to be   in order to indicate that short volatility strategy is
successful  if y is    then it means we collect the time decay of options as our profit  which is net positive  since our position is

 

fidelta neutral  our portfolios value does not vary much due to      hence  most of portfolio value variation comes from
 
     assuming constant volatility  we want this to be small and time decay to be large to maximize our profit 
 

we pre processed our kospi     data to match above definition of target variable  before the pre processing  y variable is
just raw kospi     index value  data preprocessing for target variable followed the following pseudo code  and we obtained
the response variable of randomly repeating  s and  s from double type price data 
pseudo code
for each time series entry
find the delta minimizing strike prices for both itm and otm at time t
find delta gamma theta of portfolio with strikes found above at time t
compute the threshold value with quadratic approximation and time decay
if time value is greater than the threshold  
then store                otherwise 

iv  model  nave bayes classifier
naive bayes 

p y            

               
                

in this project  we focus on the gamma component of the delta neutral options portfolio  on the other hand  the implied
volatility of options portfolio is widely believed to be clustered as referred to as volatility clustering  it seems intuitive that
large changes tend to be followed by large changes  of either sign  and small changes tend to be followed by small changes 
applying similar concept to gamma aspect of options  we propose a hypothesis that fast moving period is clustered together 
and slow moving period is also clustered  based on this idea  we include some feature variables which might have some
predictive power  we will include various features into our model  and they are discussed that later 
for our model  we used nave bayes classifier with pre processed y variables as discussed in previous section and features
are chosen in a way that are related to the clustering characteristic of underlying prices 

v  features
   introduction of new variable  price rapidity
essentially  we are interested in predicting how far the future price will be away from the current price  regardless of
direction  consider the quantity 
 p  future   p current  
this quantity is independent of direction  and we want this to be
small in our short gamma strategy  because of the trade off
relationship between this quantity and the time decay  we are
naturally interested in how long it takes for the price to change by k
units  in other words  how many days do we have to wait to see k
units of price change  in this idea  we defined a variable time k  which
is the number of days it took since the time when the price was
different k units  it goes retrospectively such that it traces back to the
past from now to find the value time k  for example  consider the
following price change                          
    now   the current price      if we want to find the value time   
it will be   because the first day from now for the price to be different
 

fiby   is t                we computed the time k with simple algorithm  and we obtained above figure 
as you can see  the sporadic spikes at the figure of time k strengthens our hypothesis that the volatile and sluggish periods
are clustered together  note that large value of time k implies that it has taken long time to differ by k  so  large time k means
less volatile market  vice versa  thus  the inverse of this quantity would be rapidity of market  we defind the rapidity of our
market 
   

 


we included this quantity in our nave bayes classifier as our feature variable assuming the backward rapidity of the market
might have some explanatory effect on the gamma and theta trade off dynamics 
   other features
again  we are choosing our features that we think might help explain the clustering characteristic of our response variable 
so  we included lagged y values up to order     previous data itself might have some forecasting power on response  we hope
that some variance of response variables can be explained by their own past values  we also included the number of days that
showed the same type of response variable as the current one  for example  if a series of response showed the patter of            now   then we included   as our feature to indicate that the series has shown   success  three days in a row  we think
that if a previous response variable showed success  for an example  then it is more likely to show success than failure 
however  if the series shows many consecutive success in the past  it is very likely to reverse the pattern  and it alternates this
pattern  we did the same procedure for   failure   too  we also added days since last success and last failure  regardless of
consecutive pattern 
summary of features
     

lagging response variable with order     

     

the number of consecutive   and  
if the current y value is different from previous  then this value is zero 

     

the number of days since last   and    regardless of current value of y

     

rapidity of price as defined above

vi  delta neutral volatility trading strategy  delta neutral portfolio
delta neutral position  in order to implement an options volatility strategy  we need to set up a delta neutral portfolio  a
variety of delta neutral portfolio is possible  but here we set up the simplest kind of delta neutral position for our trading
algorithms execution efficiency 
strategy
          
                

       

         
          

       

 

             
        
 

 
           
                    

 
  
     
          
                     
      

 

fivii  results and trading performance
in our model  the classifier learned in a cumulative fashion  notice that price data is not a random permutation of variables 
every data entry is ordered  and the specific order might have some features related to response  hence  not all of the data is
available from the beginning  in the beginning  we only have a small length data  but as we go through  we accumulate the
historical data such that we have larger data set  for example  among the    expirations of time series data  the  st expiration
data was used for training purpose only  using the trained model from  st expiration  we made prediction about  st response in
the  nd expiration  for the next response in the  nd expiration  we accumulated the whole  st expiration data and the first
response in  nd expiration  we trained our classifier again and used it for the prediction about the next response  hence  as we
go across the whole time series  our classifier will have learned from the larger data set  our simulation results supports our
hypothesis that the classifier would perform better with larger training data set  for the result vector  we stored    if the
classifier predicts correctly  and    if otherwise  and we obtained the cumulative summation of the vector  and the plot is
shown below 
as we can see the figure below  the learning rate of our classifier does not seem very fast in the beginning period  however 
it starts learning at a faster rate after about     th data  this result is very promising because if we collect more and more data
such that our time series spans a longer time period  our classifier would perform even better 
trading simulations is performed in the following way  if our classifier predicts that y variable is   in the next day  we set up
short gamma delta neutral position assuming constant volatility  and we unwind the position next day  and we keep repeating
this process  the trading simulation result seemed very impressive to us because it is possible to generate positive profit in the
long run even though there seems to be some cost in the beginning phrase where the classifier need some trial and error
experience 

viii  future
we only used some transformation of response variable such as lags and the number of days since last success  if we could
include some other variable that are related to the market such as interest rate or some other regularly announced economic
indicators  we might also be able to improve our model  in future  we want to use other linear classifiers such as perceptron
and svm with same formulation of training data  we also want to trade with this model in the real options market with real
money so that we can learn what other factors affect the trading performance 

references
mandelbrot  b  b   the variation of certain speculative prices  the journal of business     no                    
john fox   sanford weisberg   an appendix to an r companion to applied regression  second edition       
will acworth   fia annual volume survey  trading falls       in                
black  fischer  myron scholes          the pricing of options and corporate liabilities   journal of political economy                 doi                      black and scholes 
original paper  
merton  robert c           theory of rational option pricing   bell journal of economics and management science  the rand corporation                 doi                 
jstor             
hull  john c          options  futures  and other derivatives  prentice hall  isbn               

 

fi