 

nfl defensive performance analysis
daniel oneel and reed johnson  doneel  rjj    stanford edu
cs      stanford university
december      

abstractwe seek to predict eight characteristics of
defensive performance in a given nfl game based on
previous games played by both that defense and the upcoming opposing offense  we choose a method of featureset
generation that generalizes to any game in the season and
then apply a variety of multivariate regression techniques
in order to predict defensive performance before the game
occurs  we compare the accuracy of our predictions to the
actual results of their respective games  and also against
existing benchmarks who publish predictions of fantasy
points  which are a known function of our eight predicted
defensive statistcs 

i  i ntroduction
player performance in the nfl is a highly analyzed
and debated subject  as evidenced by the rise of
dedicated tv channels to fantasy analysis which
seek to predict a players performance for the sake
of viewers  and of course by the massive gambling
industry  the state of nevada reported       billion of
legal nfl betting in      alone  which the national
gambling impact study commission believes comprises
less than    of annual football betting        
despite the size of the industry surrounding performance
predictions  relatively little attention is paid to defensive
unit performance  likely because it is generally
considered less exciting and more team oriented than
offense  defense remains half of the football game 
however  and due to this relative lack of attention 
accurate predictions about the performance of defensive
units offer a potentially large competitive advantage 
we look to predict a teams defensive performance as
measured by eight statistics and base our predictions off
of    statistics that represent the performance both the
teams defense and the opposing teams offense  for those
familiar with football  accuracy results offer simple
interpretation  but to benchmark our performance  we
also measure our predictions performance using a
standard fantasy football scoring system used by the
majority of leading fantasy football websites  this

id
game id
team
week

defensive
tackles for loss
sacks
sack yards
interceptions
forced fumbles
defensive tds
safeties

offensive
passing yards
rushing yards
first downs
  down conv   
  down conv  
avg  field position
points

misc 
penalties
penalty yards
  of plays
posses  time

fig     variables

metric gives us a simple way to compare the efficacy of
our analysis to the industry standard 
ii  data
a  source
we used data from the publicly available nfldb
database  which can be accessed at https   github com 
burntsushi nfldb  this dataset contains play by play
statistics for every preseason  regular season  and postseason nfl play since       we have narrowed our
analysis to regular season games  though our algorithms
would apply to any season  all statistics given throughout
this paper are from analysis on the      season for the
sake of consistency 
b  data attributes
though nfldb provides a massive number of
statistics  we extracted a subset of    statistics for both
teams in every game played in the      nfl season 
shown in table   

in bold are the eight output variables we seek to
predict  notice that for a given defense  we predict
our own sacks  interceptions  etc  but we predict the
opposing offenses passing yards  rushing yards  and
points  these are referred to as yards allowed and points
allowed  

fi 

c  feature generation

b  weighted linear regression

though our   output variables are clear  our features
are not obvious  it would not be useful to predict the
defensive performance of a team with the features being
the offense performance in the same game  the value
in these predictions is making the predictions before
the game is played  of the many possible ways to
attack this problem  we chose to compute resumes
for both the offense and defense of a team  which are
composed of all statistics in the offensive and defensive
column respectively from the table above as well as the
miscellaneous column  we average these statistics for
each game a team has played in up to the week we wish
to predict for 

the weighted linear model is very similar to the
linear model  except when fitting the model  we seek
to minimize a weighted sum of residuals  defined by

iii  m odels
given the featureset described above and the output
variables explained above  we explored various multivariate regression techniques  we originally also tried
models comprised of univariate models for every output statistic  but after equivalent performance in some
models  indeed  in some models the multivariate form
is exactly the combination of independent univariate
models  and underperforming in others during initial
analysis  we decided to limit ourselves to multivariate
models 
throughout this paper  we measure our models overall
error by normalized error  which is defined by
fifi
   fifififi
fifi
fifi y  y fifi
fifi
fifi
fifi
fifi
y
fifi
fifi

n
x

  i  
wi  y  x

i  

this models allows us to give more weight or influence
to particular observations which we train our model on 
we weighted games  which are rows xi i      n  in
our feature matrix  according to the following equation
 w      t  xi       

where  t  xi   is the indicator function that is true
if team t  for which we are predicting  played in
that game  and w is a parameter that specifies the
relative importance of such a game  when predicting
an upcoming game for team t   this has the effect of
making past games in which t has played w times as
important in our model as games in which t did not
play  we found the best weighting to be w      this
offered significant performance improvement over the
linear model 
note  however  that because the weightings depend on
the team for which we want to predict  this requires
re fitting a new model for every prediction 

c  partial least squares regression
 

a good prediction of yards allowed may have a
residual of     but a bad estimate of sacks may have
a residual of    this normalizes all our errors by the
standard deviation of the actual values so we value our
predictions in all eight categories equally 

a  linear regression

pls is a dimensionality reduction or shrinkage
technique we thought may be of use given the relatively
large amount of predictors we have  especially early in
the season  there are only a limited number of games
played  and we worried that our variance would be
very high  pls offers a technique for reducing the
dimensionality to help combat overfitting  indeed  as
can be seen in fig     pls does offer significantly better
performance over linear and weighted linear regressions
in the first half of the season 

our linear regression model can be expressed as
y   x

in this model  our x matrix is composed of the raw
resumes of the two teams  our y is an n    matrix
with n equal to the number of games in the season up
to the previous week  the performance of this model
was ultimately weak 

d  weighted random forests
multivariate random forests are an extension of decision trees which use bagging and decorrelation to
reduce overfitting  we modified leo breimans original
algorithm to do weighted random forests as described
by chen  liaw and breiman          the modification
causes points to be drawn by weighted rather than equal

fi 

fig   

probabilities when fitting each individual tree  we use
the same weighting scheme above 
 w      t  xi       

which leads the algorithm  when randomly selecting
data points to fit in each individual tree  to select games
in which team t has played with probability
w
 n  g    wg
where n is the number of total datapoints and g is the
number of games that team t has already played  as
 
opposed to  ng  wg
for all other points  this has the
effect of exaggerating the importance of games in which
team t has played  as with weighted linear regression 
this requires fitting a new model for every team 
as seen in fig     the minimum normalized error occurs
with w      which curiously is the same weighting
factor that acheived minimal error in weighted linear
regression  though we suspect coincidence rather than
hidden relationship 

e  multivariate adaptive regression spline
seeking a model that allowed nonlinearity with the
possibility variable interaction  we fit a multivariate
adaptive regression spline  mars  model to good success 
using the earth software implementation  we allowed
 nd level interactions  mars offers us a particular

fig   

sacks
interceptions
forced fumbles
defensive tds
safeties
points allowed
pass allowed
rush allowed
mean

linear
      
      
      
      
      
      
      
      
      

weighted
      
      
      
      
      
      
      
      
      

plsr
      
      
      
      
      
      
      
      
      

mars
      
      
      
      
      
      
      
      
      

fig     normalized error by category and model

advantage  though we suspect there are nonlinearities
and interactions  we did not know which  mars infers
these itself through the fitting process     

iv  r esults
table   shows the normalized error for each algorithm
in each category 
first  notice the perfrmance of mars and weighted
random forests models consistenly outperform other
models in nearly every category  algorithms which
produce the overall lowest error tend to offer small
improvement in all categories rather than significant
improvement in one category 
second  notice that some categories have consistently

wrf
      
      
      
      
      
      
      
      
      

fi 

category
sacks
interceptions
forced fumbles
defensive tds
safeties
points allowed
pass yards allowed
rush yards allowed

average error
      
      
      
      
      
      
       
       

fig     average errors

v  c onclusion

fig     fantasy point prediction performance with mean
error and varance band

lower error than others  particularly  predictions for
yards and points allowed are consistently better
predictions than turnovers and safeties  for those who
know football  this result should make sense  events
such as turnovers are single  inherently unpredictable
events  whereas points and yards allowed are less
affected by individual plays 
also notice that the numbers in this table imply
that that our models explain only a low percentage of
the variance in these statistics  in the best case  we
explain slightly over     of variance  compared to
many machine learning applications  our model appears
to have exceptionally low predictive power  in the
context of football predictions  however  our model
appears very competitive 
weve also compared our weekly error to predictions
from another well known fantasy prediction provider 
fantasy football freaks  a usa today sports subsidiary 
    fff  unlike every other projection provider weve
checked  privides historical predictions for every team
and every week of past years  which means we can
directly compare our predictions to theirs  fig    shows
the average error of both their fantasy predictions and
ours  note that we do not directly predict fantasy points 
but rather use our   predicted statistics as inputs of the
fantasy points function 

our predictions demonstrate consistently better
accuracy than those of fantasy football freaks  in
both a week by week and a team by team comparison 
our prediction model has lower error  interestingly 
our errors and theirs show some correlation          
this would seem to imply our algorithms both fail to
predict some unpredictable events  in the context of
football  we would indeed expect that some events are
truly unpredictable  and that all predictions  whether by
humans or algorithms  would be similarly affected 
our average errors also provide some insight into the
different categories  table   shows our unnormalized
errors  the residual for our points prediction is on
average      points   slightly less than a touchdown 
this is signficant especially given that betting lines are
commonly   or   points  for winning by a field goal or
touchdown  respectively   our predictions are accurate
within   points        of the time 
our average errors for yards allowed is also interesting 
while it is tempting to conclude that rushing offenses
are more reliable  one must realize that the difference
in accuracy only appears when the errors are unscaled 
one can see in table   that our prediction for rush
yards is no more accurate  teams just tend to rush for
fewer yards than they pass  leading to lower variance in
number of rush yards than number of pass yards 
another interesting trend shows up in fig     after a
generally consistent decrease in error each week  theres
a signficant a rise in prediction error in the final weeks
of the season until the very last week  which again
appears normal  this trend holds across   seasons we
tested  the trend is not obvious in fantasy point error
graph  as the fantasy point algorithm obscures much of
the inaccuracy   we speculate the rise in error is due
to the fact that these final weeks often feature games

fi 

which determine playoff spots  and often these games
are against division opponents who have already played
each other  both of these factors may contribute to a
propensity to pull out all the stops   to literally be less
predictable to their familiar opponent  and unfortunately
to us  
why then  the drop to very low error in week
    week    notoriously features many games between
teams who have their fate guaranteed one way or the
other  motivation is low and for the playoff bound
teams  there is no incentive to risk injuries  thus these
games tend to be much less exciting  but wonderfully
predictable 
it comes as no surprise that our predictions are
innaccurate in the sense that we can only explain
a small percentage of the variance in these statistics 
we are rather surprised  however  that our ability
to explain        of variance in many categories
gives us noticeably more accurate predictions than a
leading provider  we have chalked this up to both the
inherent unpredictability and  again  the relatively lack
of attention paid to the unglamorous matter of defensive
performance 
vi  n ext s teps
though we consider our existing algorithm successful 
there are some obvious opportunities for improvement 
the most obvious problem we have is that we only
generate high accuracy in the second half of the regular
season  using historical data from previous seasons as a
prior will likely give us increased accuracy at the start
of the season  additionally  we can extend our data
set to include all playoff games while still using our
existing models 
one way to improve the accuracy of our models
is to increase the number of significant features  for
instance  if peyton manning is injured and cannot play
in a game  the broncos are likely to score much fewer
points against a defense than if he was playing  since
we currently have no data available on injuries  our
models will make the same prediction whether or not
manning is playing  although it is hard to measure the
impact each individual player has on a game  a simple
count of the starting players missing on offense and
defense could help improve our predictions 
additionally  even at times when they are perfectly
healthy  many starters will sit out games or parts of
games when their team has already clinched a playoff

berth  adding a simple boolean value stating whether a
team has already clinched their playoff spot could help
account for some unusual values that may be throwing
off our models 
given that our there is an extremely high amount
of unpredictability in performances  we think it would
be useful in many cases to have confidence intervals
for each prediction we make  a team likely to score
between    and    points is significantly different
from one likely to score between    and     even
though our model will currently predict    for both 
including a confidence interval with our predictions will
let users know the range of outcomes they should expect 
finally  we would like to gather data from many
prediction providers to better benchmark our own
models  currently we are confident that our predictions
are superior to one provider  but to extend that claim
to other providers such as espn  yahoo  or the nfl
itself  we need to log their predictions  this will likely
have to wait until next season  when we will find out 
from week one  whether our model is truly competitive
with the best 
r eferences
    l  breiman  random forests machine learning vol     issue
       
    c  chen and a liaw and l breiman  using random forest to
learn imbalanced data university of california  berkeley      
    weekly
projection
ratings 
 online  
available 
http   www fantasyfootballfreaks com weekly projections ratings
    j  h  friedman  multivariate adaptive regression splines the
annals of statistics  vol      no          
    gillian spear  think sports gambling isnt big money  wanna
bet   nbc news  july   th        online   available 
http   www nbcnews com news other think sports gambling isntbig money wanna bet f c        
    national gambling impact study commission  national gambling impact study commission final report       

fi