characterizing overlapping galaxies
using machine learning techniques
luis alvarez
stanford university
 dated  december          
as next generation telescopes enhance our ability to see dimmer objects in outer space  the number
of optically overlapping galaxies in astronomical images increases  measurements of galaxy shapes
must now account for blended objects  this research attempts to study the classification of blended
objects using machine learning techniques 

i 

introduction

gravitational lensing  the bending of light through
gravitational fields  provides insight into current problems in cosmology concerning the nature of dark matter
and dark energy  mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe 
gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observing light emitted from galaxies distorted by dark matter 
galaxy shapes are the key observables  optically overlapping galaxies present a challenge to existing shape algorithms therefore classifying and resolving blended profiles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the large synoptic survey telescope  lsst  beginning
in      

a 

definitions

in this paper we use the following terminology 
 a postage stamp describes an image that bounds a
particular object of interest  a representative size is
about    x    pixels depending on the size of the
object 
 an object may consist of a blend of two or more
distinct profiles or one profile 
 each object contains a flux density that describes
the number of counts per pixel 
 the flux is the sum of flux values over all pixels  or
the total count 
 a catalog denotes the set of all objects  with corresponding postage stamps 



thank you to patricia burchat  mandeep s s  gill  and joshua
evan meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment 

ii 

methodology
a 

goal

we aim to predict whether the object in a given
postage stamp is composed of two or more profiles or
only one profile  this corresponds to two or more galaxies or only one galaxy 

b 

data collection

we use an open source galaxy simulation package
called galsim    to simulate astronomical images  we
create single or blended objects using a number of flux
densities and sampling methods and can simulate a catalog of postage stamps under the real conditions a future
survey is likely to encounter  the point spread function
 psf   the model of the effects of atmospheric turbulence
on images and sky noise  the uncertainty in the brightness of the sky at a given moment during exposure times
are modeled in galsim and give it the power to approximate real conditions  fig    provides such an example 
for any single profile  we specify the following parameters 
 flux  photon counts 
 half light radius  size 
 ellipticity component    e  
 ellipticity component    e  
 x  of centroid
 y  of centroid
with e  and e  such that

p

e     e     

using galsim gives us the distinct advantage of creating postage stamps of blended and non blended objects
while knowing the class label  we begin our study in the
simplest scenario  no sky noise  no psf  and maintain
each profile as a gaussian such that blends are sums of
gaussians  object parameters are distributed uniformly
such that the majority of flux does not lie outside the
postage stamp  we generate      postage stamps with

fi 
  

asymmetry

highly overlapping galaxies exhibit large asymmetry
due luminosity profiles that are rotationally variant    if
a postage stamp of unique overlapping galaxies is rotated
    and then subtracted from the original non rotated
postage stamp  many pixels from the residual image may
be non zero  this simple procedure produces a statistic that identifies whether the object in a given postage
stamp is likely to be a blend  we use the following definition of asymmetry   
n

  x  xorg i  xrot i  
  i
 xorg i  

aabs  

where xorg i is the flux count in the ith pixel of the
original image  xrot i is the flux count in the ith pixel of
the rotated image  and n is the number of pixels in the
postage stamp  we choose the center of rotation such
that aabs is minimized by computing aabs in all pixels
and choosing the minimal value of aabs corresponding to
the center of rotation 

fig     example image

roughly half blends and half non blends with up to   objects in one postage stamp 

c 

features

we consider a number of non parametric statistics
that identify different properties of the object in a given
postage stamp 

  

the gini coefficent

the gini coefficent is a metric used more commonly
in economics to describe the distribution of wealth
in a society    it was adapted for galaxy morphology
classification in      to quantify the relative distribution
of flux within the pixels associated with the galaxy 
generally speaking  the gini coefficient is zero in an
egalitarian society and unity in one individual has all
the wealth  analogously  the gini coefficient measures
the spread of light in the postage stamp 
for a discrete distribution  the gini coefficient is defined as   
n

n

xx
 
g 
 xi  xj  
 xn n     i j

the moment of light

the total second order moment  mtot   is defined as the
flux in each pixel fi multiplied by the squared distance
to the center of the objects summed over all the galaxy
pixels  we use the following definition   
mtot  

n
x

mi  

i

  

   

n
x

fi   xi  xc       yi  yc          

i

where xi and yi are the coordinates of the ith pixel and
xc and yc are chosen such that mtot is minimized  we
then use following definition for m   as the normalized
second order moment of the brightest     of the flux of
the galaxy    to compute m     we sort the galaxy pixels
by flux in decreasing order  sum mi over the brightest
pixels until the sum of the brightest pixels equals     of
the total galaxy flux  and then normalize by mtot  
pn
n
x
i mi
m     log
while
fi      ftot
   
mtot
i
where ftot is the total flux count of all pixels  by setting
xc and yc to be minimal for the entire postage stamp 
lotz et al  state that m   is senstitive to overlapping
galaxies  we go on to test this by generating m   over all
pixels for visual insight and choose the minimum value 

   
  

where x is the mean over all pixel flux values  n is the
number of pixels in the postage stamp and xi is the flux
in the ith pixel  we test to see if the gini coefficient is
sensitive to overlapping profiles 

centroid estimation

since blended objects are sums of individual profiles
with peaked distributions  a subset of blended profiles
are likely to exhibit multiple peaks  using a computer

fi 
vision and image processing library called mahotas    
we are able to identify regions in a postage stamp that
are disjoint  for this process  we run through a range of
pixel flux values set by the max pixel flux observed  for
each value in our range  we obtain the threshold pixel
value  zero all pixel flux values lower than the threshold 
smooth the image with a gaussian filter to minimize noisy
pixels and identify if disjoint regions are present  we
then choose the max number of centroids observed in the
iteration 

 linear logistic regression  lr 
 support vector machine  svm 
 random forests  rf 
although random forests were not discussed in class 
current literature ranks rf above svms for their
non parametric nature  ability to deal with non linearseparability  and operational ease 
we first begin optimizing parameters for mnb  because
mnb can be bucketed differently  we ask what is the generalization error for differently discretized mnb models 

fig     generalization error vs bucketing for mnb

analysis of fig     returns     buckets for the lowest
estimate of the generalization error  we go on to use that
discretization for mnb 
for lr and svm  we ask what regularization constant
provides the lowest cross validated generalization error
translating to soft vs hard margins 

fig     example feature computation for a blend and nonblend

d 

modeling

we choose the following supervised learning methods
from the python sklearn library    for binary classification 
 multinomial naive bayes  mnb 

fig     generalization error vs regularization constant for
lr  svm

fi 
we conclude that the soft margin corresponding to
c     provides the lowest generalization error from fig
  
finally  we ask how many decision trees will provide
the lowest cross validated generalization error for rf estimation  analysis of fig    returns    decision trees is
optimal  we now use the parameters set by the above
analysis to create optimal learning curves 

fig     cv learning curves for training set

fig     generalization error vs number of decision trees
for rf

iii 
  

results

supervised learning

to compute learning curves  we run through a different number of training examples  increasing the number through each iteration  compute the cross validated
training error for each model and plot  the results are
as follows 
according to fig     mnb and rf perform well
attesting to the strength of mnb in the small training
set regime as a high bias low variance classifier and
the strength of rf as an ensemble method with high
estimation power in any training set regime  as the
training set size increases  separability of data may
become reduced  influencing mnb to perform worse
than at the smaller training set regime  lr and svm
converge asymptotically and rf provides the lowest
generalization error  we now perform a similar analysis
on the test set 
using the parameters defined in our previous analysis 
we use our models on our test set to compute learning
curves 
comparing the learning curves from our training to the
test set returns a similar pattern  fig       rf returns
the lowest asymptotic generalization error with about

fig     cv learning curves for test set

     generalization error while mnb performs well in the
low training set regime with      generalization error 

  

unsupervised learning

now we ask  for binary classification  does the data
show structure such that there exist different modes
corresponding to the two class labels 
for each feature that is defined continuously  we use
a gaussian mixture model to compute the modes in the
data  we input   modes corresponding to the binary
classes  we overlay the fitted gaussians above the true
data corresponding to the blended and non blended data 

fi 
the same conclusion as before does not necessarily
apply for g  the gmm returns two closely overlapping
distributions mimicking the large overlap between many
of the observed values  while the separation is not
as clean as for aabs and m     g roughly takes on
larger values for non blended objects  this translates
to blended objects generally spreading light more in a
given postage stamp while non blended objects contain
more light in smaller region 
on centroid estimation  we note that the centroid estimates for blended objects favored number of centroids
greater than   with mode at   and conversely for nonblended objects  the mode was   estimated centroid  the
shape of the distribution bolsters the accuracy of the centroid estimation although further tuning of parameters
should be considered for much higher accuracy 
fig     gmm models for g and aabs
iv 

on fig    and    we see that for aabs and m     the
data separates quite cleanly  for blended objects  aabs
and m   have much more variation while generally taking
on greater values than those of non blended objects  aabs
and m   for non blended objects have low variation with
a high peak  this translates to blends generally being
more asymmetric and blended objects are generally more
spatially extended 

fig     gmm model for m   and centroid estimate histogram

    lotz  j   primack  i   madau  p   a new nonparametric approach to galaxy morphological classification astron j                  
    conselice  c   bershady  m   jangren  a   the asymmetry

conclusion and future direction

using galsim  we have simulated a number of postage
stamps       each in our training set and test set with
blended and non blended gaussian profiles  for each profile  we selected random parameters in order to collect
non parametric statistics on each postage stamp  after
obtaining the features of each postage stamp  we used
cross validation techniques to identify the parameters of
each model that provided the minimum cross validation
generalization error on our training set  using those
models  mnb  lr  svm  and rf  we constructed learning curves on both the training and test set and conclude
that rf does the best asymptotically with      generalization error  in the low training set regime  rf and
mnb perform well with under      generalization error 
in terms of feature analysis  we have shown that
for the continuous features  the modes in the data
corresponding to our two class labels are fully realized
and can be cleanly separated  giving insight to the
success of mnb 
future work consists of moving towards more realistic
modeling  galaxies are generally modeled as a combination of two distinct profiles that approximate the luminous bulge and the galaxy disk  inclusion of sky noise
and the psf at signal to noise ratio regimes similar to
what lsst may encounter and researching more features
that may be sensitive to overlapping galaxies are also necessary 

of galaxies  physical morphology for nearby and highredshift galaxies astrophys j               apj
    http   www great challenge info  q galsim 
    mahotas readthedocs org 
    scikit learn org

fi