diagnosing and segmenting brain tumors and
phenotypes using mri scans
cs    final project  autumn     
samuel teicher

alexander martinez

steicher stanford edu

alexm    stanford edu

i  introduction
due to significant physiological differences in
both brains and their pathologies  tumors  edema 
hemorrhaging  etc    leveraging information
contained in brain mris remains a challenging task
in medical image analysis  to address this problem 
the medical image computing and computer
assisted intervention society  miccai  facilitates
two challenges  the machine learning challenge
 mlc  and the multimodal brain segmentation
challenge  brats   in our project  we implemented
and examined learning algorithms that address both
challenges  these two challenges respectively
address two very important problems in mri
diagnosis 
the first problem is the binary classification of
brains into a clinically relevant phenotype  the
brain is normal  has a tumor  brain hemorrhage 
etc   in this case  the data set is prepared such as to
divorce the data from the clinical context 
in the second  multi modal imaging data is used
for image segmentation  or categorizing pixels into
labeled classes  here the goal is to segment the
gross tumor from normal tissue  and further
differentiate between necrotic core  edema  and
active cells in the tumor 
aside from sparing technicians from the laborintensive process of identifying tumors and brain
phenotypes by eye  automating these processes has
the potential to identify smaller  disguised
pathologies that would otherwise go unnoticed 

figure   t  mri scan of healthy brain

ii  data
the machine learning challenge  mlc      
provides the first dataset  for each of     patients 
we have both a  d voxel intensity map of the brain 
which can be seen in figure  a   as well as a set of
    features obtained using volumetric and
intensity analysis  we utilized the latter dataset to
develop our classification models 
the second data set  provided by miccaibrats       includes          voxel
representations of     patients generated using  
mri modalities  t   t  contrast enhanced  t   and
t  flair  we denote patient mri intensity data
as                             

fi  
table      results  of  models  using  optimal  feature  selection

iii  methods and results
a  phenotype  binary  classification
we analyzed the mlc data using   different
algorithms on the base data  multinomial nave
bayes  gaussian nave bayes  linear kernel svm 
gaussian kernel svm  and random forest  
gaussian nave bayes performed the best  with
       accuracy  all accuracies listed in this
section were verified using   fold cross validation 
which is the mlc competition standard 
we next optimized using feature selection on the
most successful models  we performed backward
search feature selection on our nave bayes
classifiers  we performed forward search feature
selection on our svm classifiers due to
computational constraints  we generated the
following graphs of feature selection accuracies
achieved with each algorithm 

figures      feature selection accuracies   

due to the large number of features relative to
examples  we next attempted to reduce our feature
space using pca  we created a  d representation
using the first   principal components of the data 

fioverall  gaussian nave bayes was the
algorithm that most consistently achieved high
accuracy 
linear svm performed very well with certain
feature selections  and achieved the overall best
classification accuracy of         while feature
selection greatly improved the performance of our
algorithms  the svm feature selection curves were
quite noisy  it is unclear whether the optimal
feature choices for this data set would still be
optimized when provided with more patient data 
  

  

figure     pca projection  positive and negative phenotypes are
shown in red and blue  respectively   

  
table      results  of  models  with  optimal  component  selection

we then ran gaussian nave bayes  gaussian
svm  and linear svm classifiers on reduced
feature sets generated using       components  
below is the graph of our accuracies for linear
svm  which was the most successful algorithm 

unfortunately  feature reduction using pca
failed to improve our accuracies  from the  d pca
data visualization  we can see that the data is not
clearly separable in the reduced feature space 
especially since our best pca accuracy was
achieved using     components  it seems likely that
major feature reduction using pca may often
reduce accuracy when working with volumetric
mri scan data of this type  in other words  most of
these volumetric and intensity features  though
somewhat arbitrarily chosen  seem to be relevant to
accurate classification 
while the achieved accuracies are not nearly
large enough for clinical application  mri
phenotype classification is an active research area 
the mlc competition guidelines cite     as an
acceptable accuracy for current classifiers  
b  tumor  image  segmentation

figure     linear  svm  accuracy  spiked  at      and       features    

                                                                                                                
     we neglected multinomial nave bayes in the pca
analysis  because this algorithm cannot use a set of features
that have either positive or negative magnitude without data
preprocessing  since this algorithm had not achieved top
performance on any previous trial  we believe that this was
likely not a major oversight   

in light of a recent acquisition of brain tumor
mri data from the      brats competition  we
chose to begin additional work on a tumor
segmentation algorithm  this data is exciting
primarily because tumor segmentation algorithms
may have a large impact on clinical practice in the
near future  our algorithmic approach derives from
joana festas miccai brats      submission  
using the miccai brats      data  we
extracted         voxels of tumor and        
voxels of normal tissue from    training subject
mri scans  for each voxel  we constructed a vector
of     features to encode its local information 

fiwe used voxel intensities from each of the  
imaging modalities and the differences between
each for a total of    features 
we included the cubic mean of a voxel  for
these features  we found cubes of edge lengths
        and    voxels surrounding the current voxel
and stored the mean for each mode  we also used
the differences between each mode  for a total of   
additional features 

ability to utilize relatively customized local features
of the current patients scan as input features
without incurring a large testing time penalty that
would be intractable given the time constraints
inherent to clinical usage of mri 
using this implementation  we generated the
following brain segmentation image  which can be
compared with the actual tumor location shown
below 

we next included contextual information  for
these features we calculated for each mode the
difference between the selected voxel intensity and
the mean of a  x x  cube whose center was  
voxels away from the selected voxel  since   cubes
are considered in each mode  this yielded   
additional features 
we then included the intensity range  working
with neighborhood cubes of edge lengths        
and    voxels  we developed    lines across the
space  we then calculated the difference between
the largest and smallest elements along the line to
determine the range  yielding    additional
features 
we then trained a supervised random decision
forest using our         feature vector examples
for both tumor and healthy tissue 
this algorithm yields a preliminary segmented
image by classifying each voxel in an mri brain
scan based on input intensity data from our   mode
input                           
the algorithmic advantage of using the random
forest classifier is its capability to handle many 
possibly redundant features  and its improved
generalization of unseen data given the randomness
inherent in each of its unique trees  practically
speaking  the random forest can also offer
relatively short training time relative to number of
features  which is of particular necessity given the
large set of local features required for accurate
voxel classification and the large number of voxels
in a brain mri  in particular  the random forest
offers the advantage that the training of its decision
trees is an entirely parallelizable process   in
addition  random forest classifiers offer the

figure     an  image  slice  generated  using  our  simple  
segmentation  algorithm   above   can  be  compared  favorably  
to  the  original  scan   bottom  right   and  the  marked  location  
of  the  actual  tumor   bottom  left    

   the results of our algorithm visually compare
very favorably with the truth image  these results
can be quantified in the following confusion
matrix 

actual
class

tumor
normal

predicted class
tumor
normal
    
 
   
     

we achieved segmentation accuracy of       
in classifying the voxels in this image  this was far
better than we hoped  especially since we trained
our algorithm on one slice each of only    subject
mri data sets 

firecalling the proceedings from the last three
brats challenges  the algorithm that we have
presented is representative of a recurring technique 
representing each input voxel with a complex
feature vector including local voxel information
and implementing a random forest classifier for
segmentation  theres significant variance in
preprocessing  at times a gaussian mixture model
is used to facilitate multiclass segmentation  and
feature selection is often context specific  that
being said  all these further optimizations
contribute to a longer runtime 

given the cluster computing access that is available
to many members of the scientific and medical
imaging communities  possibilities for
implementing a more accurate  d segmentation
algorithm are very promising 
references
   

iii  conclusion
overall  our initial results confirm that mri
image analysis has great potential for clinical
diagnosis of brain cancer and other phenotypes  by
utilizing existing image segmentation software to
collect volumetric and intensity data  one can create
a feature set on which simple classifiers perform
with consistent  if not yet high  accuracy without
any contextual information about the patient or
phenotype classified 
incorporating such contextual information in
clinical practice will likely improve phenotype
classification algorithms greatly  one particular
and very intentionaldifficulty of the machine
learning challenge is that neither the information
concerning the phenotype nor additional patient
data are provided  by incorporating commonly
collected patient data such as age and weight into
the feature set and employing knowledge about the
medical definition of the phenotype  more
sophisticated feature sets and algorithms can be
developed for tumor diagnosis and classification 
novel tumor segmentation algorithms that utilize
random forests and similar voxel analysis
techniques have great potential for eventual
adoption into mri installations  these algorithms
can quickly identify regions of concern on a scan
and mark them for usage in diagnosis  due to
computational constraints  we could only train on a
small example set of  d slices  though our feature
vector utilizes a  d space  from our subject mris 

   

   

   

   

e  konukoglu  miccai      machine learning
challenge mgh hst martinos center for biomedical
imaging  proc  of miccai      machine learning
challenge   mgh hst martinos center for biomedical
imaging  boston  n p   n d   online      nov       
available 
https   www nmr mgh harvard edu lab laboratorycomputational imaging biomarkers miccai     machine learning challenge
b  menze  a  jakab  s  bauer  j  kalpathy cramer  k 
farahani  et al  the multimodal brain tumor image
segmentation benchmark  brats  in ieee
transactions on medical imaging  institute of electrical
and electronics engineers  ieee         pp   
d  zikic  b  glocker  e  konukoglu  j  shotton  a 
criminisi  d  h  ye  c  demiralp  o  m  thomas  t 
das  r  jena  s  j  price context sensitive
classification forests for segmentation of brain tumor
tissues  proc miccai brats       online  
available 
http   research microsoft com apps pubs default aspx id
       
d  zikic et al   decision forests for tissue specific
segmentation of high grade gliomas in multi channel
mr in medical image computing and computerassisted interventionmiccai       springer berlin
heidelberg  berlin        pp          
j  festa et al  automatic brain tumor segmentation of
multi sequence mr images using random decision
forests in proc miccai brats       online  
available 
http   martinos org qtim miccai     proc brats      pd
f

acknowledgements
thanks to miccai for providing two collections of mri
data  permissions information for the scans that we used is
available at the websites of the miccai mlc and brats
challenges  listed above 
special thanks to michael kistler for granting us access to the
miccai brats competition data 

fi