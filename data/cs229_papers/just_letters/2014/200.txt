predicting the treatment status
nikolay doudchenko

 

introduction

many studies in social sciences deal with treatment effect models   usually there is a
treatment variable which determines whether a particular individual  or more generally
a unit of observation  was affected by some impact  the binary case  or the intensity of
this impact  a researcher is interested in evaluating the effect of the treatment measured
 i 
as some function of the joint distribution of y    the potential outcome for individual
 i 
i conditional on being treated  and y    the potential outcome conditional on not being
treated  there are many papers devoted to studying this setup due to a very fundamental
 i 
 i 
problem that for each individual i either y  or y  is observed in the data  but never
both 
in my project i consider a somewhat different problem  what if we dont know who
has got the treatment and who has not  for example  suppose that we organize a lottery
in which every participant draws a lottery ticket from a big jar  some of the tickets
are the winning ones  the individual is treated  while some arent  the individual is not
treated   we cannot observe whether a particular person has won  but we can observe
some outcome potentially affected by the realization of the lottery  can we infer anything
about the treatment   to be precise  i ask two questions   i  can we guess the treatment
status   ii  is it possible to measure the treatment effect even though we dont observe
the treatment dummy 
i approach this problem as an unsupervised learning problem  although the treatment status is observed in the data that i use  i assume that in practice it wont be and
there will be no way to train the model  the main tool in my analysis is what i call the
hidden variable model  hvm   essentially  this is a hidden markov model with the
main difference being that there is no markov structure and instead of observing a number of consecutive realizations for one individual we observe a number of independent
individuals  the hidden state is exactly the treatment status which we dont observe  we
may also know some additional details of the assignment process or how the treatment
affects the outcome  for example  we may know that the treatment status was determined
 

another prominent example would be medical studies  it does not matter for the theoretical derivations  neither does it for the simulations  the real world data that i use comes from economics so i
stick to the social sciences context and terminology 
 
another interesting formulation is the following  what if there is an additional step required to
complete the treatment  we know the individuals that were supposed to be treated  but we dont know
who actually undertook that step  what can we do in this case 

 

fibased on a subset of features or that only some of the features affect the distribution of
the outcome 
in this project i consider both simulated data and a real publicly available dataset
that comes from a study by angrist  bettinger  bloom  and king        
the results suggest that as both the treatment and the outcome are stochastic the
treatment status is hard to retrieve  not surprisingly  the stronger is the treatment effect
the easier it becomes to guess the treatment variable  intuitively  if the treatment effect is
positive and large  a large value of the outcome suggests that the individual was treated 
the estimates of the treatment effect are more precisely estimated  as obtaining these
estimates is usually the main goal of the researcher  there is some hope that this project
wasnt completely useless 
the rest of the text is organized as follows  section   describes the statistical model
referred to as the hidden variable model  section   reports the results obtained using
simulated data  section   discusses the real dataset that i use in section    section  
concludes 

 

model

suppose that for each observation i              m there are n feature  or covariates  x i   
 i 
 i 
 x            xn  t which determine the probability  p d     x i     of being assigned to the
treatment group  the treatment status  d i    and the covariates jointly determine the
distribution of the outcome variable  p y d i    x i     the graphical representation of the
model is given in figure   
figure    graphical representation of the model
rand

rand

output  y 

covariates  x 

rand

treatment status  d 

here the word rand means that the covariates  the treatment status and the outcome
are stochastic 
i assume that only x i  and y  i  are observed and d i  is hidden  the likelihood of
 i 
 y   x i    is given by
p y  i    x i     

x

p y  i    d x i   p x i    

d    

 

fithe log likelihood is
p y  i    d x i   
log p y  i    x i      log
qi  d 
qi  d 
d    
x



x

x
d    

  log p x i   

qi  d  log

p y  i    d x i   
  log p x i   
qi  d 

qi  d  log

p y  i   d  x i   p d x i   
  log p x i    
qi  d 

d    

 

 

where qi  d  is a p m f  of some distribution over d          the inequality above follows
from jensens inequality 
if we assume that p d x i    and p y d  x i    have particular parametric forms  these
parameters can be estimated using the expectation maximization  em  algorithm 
there is one fundamental issue though  we can try to split the dataset into two parts 
but it is impossible to say which of these two parts is the treatment group and which
is the control group  in practice there is usually some additional knowledge that allows
us to make an assumption about the sign of the treatment effect  here i assume that
the treatment effect is positive which allows us to predict that the group with the higher
average y  i  is the treatment group 

   

expectation maximization

i assume that p d x i      pd and is known  in other words  the assignment to the treatment
and control groups is completely random  does not depend on the covariates  and the
researcher knows the fraction of people assigned to the treatment group  
i also assume that y is binary  the case that corresponds to the real data that i use 
and that
y
 y
p y d  x i      g   d   t x i       g   d   t x i   
 
where g s           exp  s   is the sigmoid function and                     n  t are the
parameters that we need to estimate 
during the e step of the algorithm i compute qi  d   p y  i    d x i     during the
m step i use newtons method to maximize the lower bound for the log likelihood  

 

simulations

the goal of this section is to assess the performance of the model when we know exactly
 i 
how the data is generated  throughout this section n       x      for all i              m 
 

it is easy to modify the m step for the case when pd is unknown 
i tried to use gradient ascent too  but it leads to less accurate estimates of the average treatment
effect  moreover  the estimates become very sensitive to the initial values of      
 

 

fi i 

xj  n        and independent across i              m and j             n  i set p    p        
       j     for j                and j     for j                  i assume that d i  and y  i 
are generated according to the model described in section   
the next two plots show how the misclassification error  and the estimate of the average treatment effect  behave when   changes   these plots show that the algorithm fails
figure    misclassification error and average treatment effect vs   
   

   

    
average treatment effect

misclassification error

   
   
    
   
    
   
    
   

   
   
   
   
 

    

ate  estimated 
ate  oracle 
ate  true 

error  actual 
error  oracle 

 
 

 

 

 

 

   
 

  

 

 

 

 

 

  

 

to accurately predict the treatment status  although it becomes easier as the treatment
effect increases  even when        on average     of the observations are misclassified 
however  as both the treatment status and the outcome are stochastic  even the oracle
model predicts poorly and produces essentially the same misclassification errors as the
main model 
the estimates of the average treatment effect look much more promising  there are
considerable discrepancies when   is small  but as it increases the estimate of the average
treatment effect converge to that of an oracle model 
to economize the space i dont report the behavior of the misclassification error and
the estimate of the average treatment effect as a function of the sample size   the sample
sizes above       seem to have essentially no effect on the performance 

 

data

the dataset that i use comes from angrist  bettinger  bloom  and king          i use
the data from a randomized trial in colombia conducted in the   s  the idea of the
 

this is an unsupervised learning problem so the term misclassification error might be confusing 
however  the d i  are actually observed so it is possible to calculate how many times the model has
correctly guessed d i   
 
as in the statistical model that i consider the treatment status is independent of the potential out i 
 i 
come  the randomization assumption   the true average treatment effect is e y   y      e y  i   d i   
    e y  i   d i       and can be easily estimated 
 
in the plots the word oracle refers to the case when we know the true parameters of the model 
but do not observe the d i  s  the word true refers to the case when d i  s are observed 
 
i presented these results at the poster session 
 
this section is based heavily on the description of the experiment in the paper 

 

fiexperiment was to randomly assign vouchers to the low income families with children
attending public primary schools  these vouchers could be used to pay the tuitions in
private secondary schools 
the data consist of       individual level observations  the features include students
gender and age  the city where he or she lives  the year of the lottery              or       
a dummy for whether the students household has a phone  age and years of schooling
of students parents  there is also a treatment status variable which i want to predict 
but i assume that it is not observed by the researcher  the outcome variable which the
treatment status is supposed to affect is a dummy for whether the student had finished
the  th grade by the time of the follow up survey 

 

results

the table below reports the performance of the model on the real data  i compare
the hvm with the k means model on the full set of features with k      the true
average treatment effect  computed using the actual values of d i  s  is        therefore 
the numbers below demonstrate that both the hvm and the k means perform poorly  as
noted in the previous section  when the treatment effect is low the hvm tends to produce
inaccurate estimates  which substantially depend on the initial values  
model
misclassification error
k means
     
hidden variable
     

 

average treatment effect
     
     

conclusion

the results suggest that the hidden variable model allows us to estimate the average
treatment effect and tends to perform somewhat better than a simple k means model 
however  it fails to accurately predict the treatment status and the estimate of the average
treatment effect depends on the initial values 
to improve the performance of the model i would like to add more  derived  features
and consider alternative specifications of p y d  x i    

references
angrist  j   e  bettinger  e  bloom  and e  king         vouchers for private schooling in
colombia  evidence from a randomized natural experiment  the american economic
review  
kuroki  m  and j  pearl         measurement bias and effect restoration in causal inference  biometrika                 
 

fi