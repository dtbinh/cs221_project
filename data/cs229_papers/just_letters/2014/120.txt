detecting the direction of sound with a compact
microphone array
purpose
thegoalofthisprojectwastodetectthedirectionofpotentiallymultiplesoundsourcesusinga
compactarrayofmicrophones theideaisthatthiscouldbeusedtogiverobotsasenseof
hearing ibuiltaboardwithsevenmicrophonesonitthatisabletosampleeachmicrophone
simultaneously withtheaudiosamplesiwasabletodetectmultipleaudiosourcesgiventhat
theirfrequenciesaresufficientlydifferent 

data
thedataconsistsofshortaudiosamplesfromallseven
microphones icapturedthesesamplesusinganfpgato
interfacewiththemicrophonesandasmalljavaprogramto
interfacewiththefpga thesamplesweresavedincsv
filesthatcouldbeimportedintomatlab thesampleswere
splitupintomanysmallerclipstogetmoretrainingdata 
themicrophoneringhasroughlya inchradius 

pre processing
myapproachtosolvingthisproblemwasbasedontheideathatishouldbeabletocalculatethe
delayrelativetothecentermicrophoneforeachfrequencyineachoftheaudiostreams this
provedtobealittletrickytogetright ifirstnormalizedandsetthemeantozerofortheaudio
streams ithenusedahannwindowandcalculatedthefft fromthefft iextractthe
magnitudeandangleforeachfrequency ithencalculatedthedifferenceineachanglewiththe
angleofthecentermicrophone thisangleisassumedtobebetween  pi thisisensured
sincethemicrophonesareclosetoeachother foraudiblefrequenciesthedifferenceis
guaranteedtobeinthisrange thedifference
inangleisthendividedbythefrequencyto
calculatethedelay ialsodroppedthelowest
    offrequenciesandthehighest    
theresultingrangeisroughlytheaudible
signal thefollowingfigureiswhatthe
preprocesseddatalookslike 

youcanseethatthepinksignalhasthemost
positivedelayandthebluehasthemost
negativedelay itisalsoobviousthatthese
delaysaresharedacrossallfrequencieswith
justinrajewski
rajewski stanford edu

fisubstantialmagnitude thisisbecausethisisasamplefromasinglesource 

delay to direction
thefirstpartofmyprojectineededamodeltoconverttherelativedelaystoapredicted
direction thedelaysiusedtotrainwereanaverageofthedelaysofeachfrequencyinthe
sampleweightedbythemagnitudeofthatfrequency theaverageddelaywasthennormalized
tohaveitslargestcomponenthaveamagnitudeof  istartedbytryingtocomeupwithawayto
doaregressionontheangledirectly thisprovedtobereallydifficultduetotheanglesmodulo
nature itriedafewvariationsonlinearregressionthatfailedbeforecomingupwiththeideato
predictapointontheunitcircleinsteadoftheangledirectly ithentrainedtwolinearmodels one
tomatchcosineofthelabel knownangle  andonetomatchsineofthelabel 

thisapproachworkedverywellandthefiguretothe
rightshowstheoutputonthetestdata eachcoloris
adifferentlabel the testlocationswereevenly
spacedat  degreeincrements ifyouimaginethe
microphonearrayasbeinginthecenteroftheplot 
thepointsareroughlywherethesamplewastaken
from thedistanceisnotdetected  
byusingthismethod iwasabletoaccurately
approximatethedirectionofasinglesource orthe
averagedirectionofmultiplesources  

thismodelalsogavemeawaytotellifthedirection
wasambiguous ifthepredictedpointwasntnear
theunitcircle eitherclosetothecenterortoofar
out iknewthatthedelaysignaturedidntcorrespond
toasinglesource thiswasimportantforthe
secondpartofmyproject 

detecting multiple sources
whenistartedthisprojectiwantedtobeable
todetectmultiplesourcesifiwasableto
successfullydetectatleastone theapproach
idecidedtotakewasinspiredbylookingat
someofthepreprocesseddatasimilartothe
figureontheright thissampleconsistsof
threeaudiosources music talking and
tappingonacoffeecuplid  ifyoulookclosely
attheverylowfrequenciesyouwillseearegion
wherethepinksignalisontop thereisthen
anotherregionwiththeyellowsignalontopand

justinrajewski
rajewski stanford edu

fifinallyalargeregionwithblackontop thesecorrespondtothedifferentsources 
irealizedicouldthentakeeachfrequencyand using
mymodelfrombefore predictthedirectionforeach
frequencyindividually thefigureontherightshows
thatoutputwiththepointsthatarenotclosetotheunit
circleremoved theremovedpointsdontcorrespond
toapredictabledirectionandjustaddnoise the
colorsroughlycorrespondtotheeachsourceandare
fromthefinaloutputofmyalgorithm 

youcanseetherearealotofredpoints theseare
fromthefrequencieswhereblackisontop the
greenpointsarefromfrequencieswithyellowontop
andtheblueistheoneswithpinkontop 

myplanwastorunkmeansonthedatatofindthese
clusters butialsowantedfrequencieswithlarger
magnitudestomattermore ifirstweightedeach
pointwithitscorrespondingmagnitude butifound
thatusingthemagnitudesquaredgavemebetter
performancewhentryingtodiscernmultiplesources 
thegraphontherightshowsthepointsmultipliedby
themagnitudesquared itisnowobviousthereareat
leasttwosources thethirdsource tappingonthe
cup ismuchquieter butstilldetectable 

byrunningweightedkmeansiwasabletogetfind
thedirectionsofeachsource ithentookeach
directionandweighteditbytherelativemagnitude
 calculatedbythepercentofthetotalweightedpoints
belongingtoit  theresultisthegraphontheright 
youcanseethethreesourceswiththerightpointing
sourcedesignatedmuchquieterthantheothertwo 
butstillpointingthecorrectdirection 

inowhadanalgorithmthatworkedwellforpickingn
sourcesfromasignal however ididntwanttohave
tospecifyn 



justinrajewski
rajewski stanford edu

fidetecting the number of sources
theproblemihadwithkmeansisthatyouneedtospecifythenumberofsources ifyouspecify
toomanyyouwilllikelysplitasourceintotwoormorewheretheaverageofthoseislikelythe
realsource ifyouspecifytoofew youendupwithpredictingthesourceisbetweenmultiplereal
sources tocombatthisicreatedanotheralgorithmaroundtheweightedkmeansiwasusing 

thealgorithmstartsbyrunningkmeanswithonlyonecentroid eachiterationitaddsanother
centroidandtriesagain aftereachattemptitlooksatthesourcesthatwerefound ifthese
sourcesarelikelytobefromthesamerealsource thealgorithmstopsandusestheprevious
iterationsresults 

theonlytroublewiththiswascomingupwithawaytoknowiftwosourcearelikelytobefrom
thesamerealsource afterwatchingkmeansworkondifferentsamples irealizedthatifthe
differenceintheanglewassmallandthedifferenceinmagnitudewaslarge itwaslikelythat
theycamefromthesamesource thisisduetothenatureofeachsourcetypicallybeinga
relativelynarrowspike 

myfirstattemptatthisiusedtheabsolutevalueofthedifferenceintheanglesdividedbythe
absolutevalueofthedifferenceinmagnitude ifthelowestvaluebetweenanytwocentroidswas
lessthanathreshold itstopped ifiddledwiththisforsometimewithdecentresults however i
realizedthatiwasweighingthefactoftwosignalswithsimilarmagnitudeswerelikelytobe
 ang ledif f erence 
differentsignalstooheavily thatleadmetomyfinalcriteria d      m ag m ag       iaddedthe  
 

 

termtothedenominatortoputlessemphasisonthedifferenceinmagnitude ialsoaddeda
thresholdfortheminimumacceptablemagnitude afterplayingwiththethresholdagain iwas
abletogetthistoworkonallmytestcasesincludingthefollowingwithtworelativelyclose
sources thetwosourceswereat   and   degrees 





justinrajewski
rajewski stanford edu

firesults

model
linearregtraining

samples

error degrees  error   

    

   

     

   

   

     

kmeanstest single w mag 

  

   

     

kmeanstest multi w mag 

 

   

     

kmeanstest single w mag  

  

   

     

kmeanstest multi w mag  

 

   

     

kmeanstest single w mag  

  

   

     

kmeanstest multi w mag  

 

   

     

linearregtest


thelinearmodelworkedverywellandtheerroriseasilywithintheamounticouldhavemoved
whileusingmyphonetoplaymusicfromthevariousangles 

forthekmeansmodel itesteditwithvariousdifferentweightsandfoundusingthemagnitude
squaredresultedinthebestoverallperformance ifounditinterestingthattheerrorforasingle
sourcewasbetterwithlowerpowersofthemagnitude buttheerrorformultiplesourceswas
betterwithhigherpowers ibelievethisisbecauseitsimplybringsouttheloudestfrequencies
morewhichusuallyoverlaplessbetweensourcesgivingaclearerindicationofthedirection 

forthemultipointtestcases iusedtwosourcesforeach thesesamplesweremoredifficultto
workwithandididntspliteachsampleintomanysmallclipslikeididwiththelinearmodelsince
usinglongclipsgavehigherfrequencyresolutionandbetterperformance thisisthereasonfor
somanylesssamples 

future
oneofmygoalsforthisprojectwastoeventuallymovemyalgorithmtothefpgaonmyaudio
captureboardsothatthedirectioncouldbedetectedinrealtime however ididnthavetimeto
explorethisandthecurrentkmeansalgorithmwouldbedifficulttoporttoanfpga iwouldlike
toexploresimplerwaystogetthesamekindofperformance 

iwouldalsoliketorepeateverythingwithonlythreemicrophones usingthreeistheoretically
possibleandiwouldliketoknowwhatkindofperformanceimprovement ifany yougetwith
morethanthreemicrophones 

justinrajewski
rajewski stanford edu

fi