cs     final project report

 

detecting lane departures using
weak visual features
ella  jungsun  kim  jungsun stanford edu
shane soh  shanesoh stanford edu
advised by professor ashutosh saxena

abstractmany current lane departure warning systems rely
on strong visual cues  such as distinct lane markings       or
the presence of a leading vehicle     in this project  we propose
a system that detects lane departures using only weak visual
features derived from dashboard camera footages  in doing so 
we aim to build a model that can detect lane departures even
on roads with faded or missing lane markings  in inclement
weather  e g  snow covered roads  fog and heavy rain  and in
poor lighting conditions  our proposed model uses extracted
optical flow trajectories    of various points in the scene detected
using the shi tomasi corner detector     these trajectories are
then normalized and featurized using histogram of oriented
gradients  hog   we used svm with a radial basis function
 rbf  kernel to classify these trajectories into one of two
categories  straight  vehicle is within the lane  and deviate  vehicle
is leaving the lane   our svm model is compared against a
logistic regression model that provided a performance baseline 
both models produced reasonable results with our svm model
detecting lane departures up to     accuracy 

i 

algorithms  svm with radial basis function  rbf  kernel and
logistic regression  to identify the better performing model and
its corresponding features 
ii 

data c ollection and f eature e xtraction

a  data collection
we collected and labeled over    hours of driving footage
on both highway and local routes using off the shelf dashboard
video cameras  we chose to focus on highway driving videos
for this project and had a total of     straight examples and
    deviate examples  most of the highway videos were taken
on route     
b  generating optical flow trajectories

i ntroduction

a  motivation
lane departure warning  ldw  systems are designed to
warn the driver should the vehicle unintentionally leaves its
lane on freeways and arterial roads  these systems seek to
improve driver safety by addressing the common causes of
road incidents and collisions  namely inattention  intoxication 
incapacitation and drowsiness  which have resulted in a significant portion of traffic fatalities in the u s     many major
car manufacturers  such as ford  mercedes and toyota  have
started incorporating ldw systems in their vehicles since
      however  the biggest limitation of such systems is their
inability to track faded  missing or incorrect lane markings 
we seek to address this limitation by developing a ldw
system that does not rely on strong visual features such as
lane markings or the presence of a leading vehicle  instead  our
model reliably detects lane departures by inferring the relative
motion of the vehicle to its surroundings through the tracking
of various weak visual features in the scene 
b  objective
given optical flow data extracted from road view footages 
we aim to classify each time interval  i e  a certain number
of video frames  into two categories  straight  vehicle is
within the lane  and deviate  vehicle is leaving the lane   we
implemented and compared two different machine learning

fig     optical flow tracking of detected corners and its corresponding mask

we used the shi tomasi corner detection    algorithm to
detect points in the scene that are then tracked using the lucaskanade method of optical flow     this method was chosen
over dense optical flow  which is commonly used in similar
motion detection tasks such as human recognition        for
two reasons     it is computationally more efficient and is thus
more suited for real time applications such as ldw systems 
and    it is more suitable for night time driving footages where
the trackable features are likely to be sparse 
we also employed a number of heuristics at this stage  the
corner detection algorithm was made to run at every fixed
interval of   frames on a masked area as shown in fig    the
mask was chosen to encourage the detection of points around
the vanishing point of the scene as tracking these points were
found to be most indicative of relative motion  the mask also
reduced the number of detected points on relatively irrelevant
image features such as the vehicle dashboard and cars on the
opposing traffic  the mask  however  did not limit the region
in which the points can be tracked  instead  the points were

fics     final project report

 

fig      d binary image representation of trajectories and its corresponding
hog features
fig     typical set of extracted optical flow trajectories  x and y positions
plotted against frame indices  i e  time 

allowed to be track until they vanished from the scene  we
additionally imposed an artificial threshold on the speed of
the points being tracked  i e  the displacement of each tracked
point across frames  as we found that most of these noisy
optical flow trajectories tend to be the ones corresponding to
fast moving points 
c  extracting hog features
we collapsed the generated optical flow trajectories  see
fig    into  d binary image representations of x positions
of detected points against time  see fig     we then normalized each set of trajectories based on the mean x positions
of the detected points and featurized them using histogram
of oriented gradients  hog   hog essentially counts the
occurrences of gradient orientation in localized portions of an
image and generates a feature set that corresponds to histogram
bins of orientations  we found that hog features accurately
characterize the optical flow trajectories while remaining relatively invariant to the presence of noisy trajectories  we also
used feature selection as a means of normalizing the locations
of the hog cells that contain the trajectories  to be discussed
further in the next section  
there are three main parameters that we can vary  the
interval size  i e  number of frames used per training example 
cell size and the number of orientation histogram bins used for
hog feature extraction  the interval size is perhaps the most
important parameter as it represents a direct tradeoff between
accuracy and the predictive value of our models  intuitively 
larger intervals give the model more information to train and
test on  and thus result in higher accuracies  however  larger
intervals correspond to lower predictive value as more frames
are required before the model can detect the lane departure
with reasonable accuracy  i e  more time would have elapsed 
our current model can achieve the stated     accuracy using
an interval of    frames  corresponding to about   seconds
of video   when applied to a ldw system  this means that it

may take up to   seconds into the maneuver before the system
can detect lane departures with the aforementioned accuracy 
for this project  we used intervals of    frames    x  
cells and   histogram bins  which gave us a      large sparse
feature set that we then reduced to      features using feature
selection 
iii 

m ethods and e valuation

a  feature selection
initial fitting on the entire feature set  of      features 
yielded     cross validation error with the svm model and
    cross validation error with the logistic regression model 
in order to determine an optimal set of features efficiently  we
performed filter feature selection using the minimum attainable
classification error as our ranking criterion  i e  the criterion
used to assess the significance of every feature for binary
classification  we plotted various performance metrics of the
svm and lr models as we increase number of features
selected as shown in fig   and fig   

fig    

plot of various metrics against number of features selected  svm 

fics     final project report

 

scale of        heuristically chosen using subsampling   the
rbf kernel has an infinite dimensional kernel feature space
and is suitable for exploiting non linear relationships between
features 
for the svm model  we were essentially solving the following optimization problem  with box constraint  c      
max w     

m
x

i 

i  

m
  x  i   j 
y y i j hx i    x j  i
  i j  

s t    i  c  i           m
m
x
i y  i     
i  

fig     plot of various metrics against number of features selected  logistic
regression 

the optimal number of features for the svm model was
determined to be      features  as shown in fig    the cross
validation error decreased with increasing feature size before
increasing again after approximately      features  similarly 
accuracy and precision increased initially before decreasing
after approximately      features  for the logistic regression
model  the training error dropped to zero very quickly as the
number of features increased from   to      not visible in
the plot given the x axis scale   the cross validation error  as
well as other metrics  seems to remain relatively invariant to
the size of the feature set  see fig     this is expected as
regression models have the tendency to overfit their training
data 
given this analysis  we can also deduce that logistic regression is unsuitable given the high feature dimensionality  on the
other hand  svm is particularly suited given the sparseness
and high dimensionality of our feature set  there have also
been many prior works that have successfully utilized svm for
classifying hog descriptors  particularly in detecting humans
or human actions       
b  logistic regression model
table i 

c onfusion m atrix for l ogistic r egression m odel

actual straight
actual deviate

predicted straight

predicted deviate

  
  

  
  

we used a logistic regression model to provide a baseline
performance  results shown in table i   out of total    
training examples      were used to train the model and    
     of the total examples  were used to test  cross validation
error was computed using    fold cross validation  logistic
regression classified the test set with     accuracy and a crossvalidation error of     
c  svm model
we trained a svm model with rbf kernel  i e  k x  z   
exp kx  zk     with a box constraint of   and a kernel

table ii 

c onfusion m atrix for svm m odel
predicted straight

predicted deviate

  
 

 
  

actual straight
actual deviate

as shown in table ii  svm classified the test set with    
accuracy and cross validation error  using    fold  of     
our model shows high recall       but a comparatively lower
precision        the higher number of false negatives seems
to be a result of models tendency to classify driving within the
lane on curved roads as a departure from the lane  however 
this should improve with greater number of training examples
that depict straight driving on curved roads 
d  comparison of models
table iii 

svm
lr

svm vs   l ogistic r egression  lr 

cv error

accuracy

precision

recall

f score

      
      

      
      

      
      

      
      

      
      

for the purpose of this project  we chose to evaluate our
models primarily on its precision and recall  and hence its
f score   the recall is a particularly important metric for
our application as we seek to minimize the number of false
warnings  reducing the number of false negatives to close to
zero would be essential in applications that apply corrective
actions to the vehicle upon detecting lane departures 
from table iii  it is clear that svm outperforms logistic
regression in every given metric  this is an expected result
given that our model has a high dimensional feature space and
is trained on a small sample size 
iv 

a dditional a nalysis

once we identified that svm is the better model for our
purpose  we experimented with various methods to improve
the performance of our model  in this section  we will only
discuss the methods that yielded meaningful observations 

fics     final project report

 

error is indicative of a high variance  i e  over fitting  the
learning curve also indicates that the performance of our model
is likely to benefit greatly from having more training examples
as more data will help the model generalize better  the high
variance is expected given the high dimensionality of our
features  especially in comparison to the small number of
training examples 

fig     trajectories and respective hog features before and after morphological opening

a  pre processing optical flow trajectories
we experimented with two methods of cleaning the optical
flow trajectories in an attempt to improve the performance
of the model     density based clustering methods  e g  dbscan  to select only the densest clusters of trajectories  and
   morphological opening on the binary image representations
to remove sparse trajectories  i e  noisy trajectories  see fig    
however  density based clustering methods were too slow
for our purpose  especially given the large number of optical
flow data we were dealing with  and morphological opening
resulted in deteriorated performance for both svm and logistic
regression models  this is likely because many of what we
believed were noisy trajectories might have been structured
enough to have sufficient discriminative value 
b  error analysis

v  c onclusions
we conclude that using svm with a radial basis function kernel and filter feature selection gives us a reasonable
accuracy of      which is notably higher than the logistic
regression model        however  the performance of our
svm model is still below that of conventional ldw systems
that use strong visual features  typically around     and
above   nonetheless  the findings from this project have shown
us that such a model could be a viable approach for detecting
lane departures  furthermore  as our approach relies solely on
tracking weak visual features present anywhere in the scene 
it is expected to be more robust compared to existing methods
that are dependent on strong visual cues  in this aspect  we
can expect our model to outperform existing models given
non ideal conditions  e g  inclement weather  low light  etc  
vi  f uture w ork
we intend to train our model with more data  particularly of
driving footages taken in the night and in inclement weather 
our findings indicate that the accuracy of our svm model will
greatly improve as a result  we also intend to extend the model
to do multiclass classification  particularly to differentiate
between left and right lane deviations as well as other actions
such as turns and merges 
we ultimately plan to incorporate our findings in a bigger
overall project  under the guidance of prof  ashutosh saxena 
to build better predictive models for assistive driving technologies  specifically  we intend to    combine existing features
with additional features such as the drivers head pose and
gps data to predict drivers intents     use our system as a
method of determining the current lane the vehicle is in  when
given road information  such as the number of lanes   and   
use our system to automatically label drivers actions on large
quantities of driving footage which can then be used to train
other models 
acknowledgment
we would like to thank prof ashutosh saxena and ashesh
jain for their guidance and support  we would also like
to thank the few individuals who helped us with the data
collection 
r eferences

fig     learning curve depicting training error and cross validation error
against number of samples

we plotted the learning curve for our model as shown in
fig    the low training error but much higher cross validation

   

hsiao  p   hung  k   huang  s   kao  w   hsu  c   yu  y           an embedded lane departure warning system       ieee   th international
symposium on consumer electronics 
    mccall  j  c   trivedi  m  m           video based lane estimation
and tracking for driver assistance  survey  system  and evaluation  ieee
conference on intelligent transportation systems 

fics     final project report

   

   
   
   

   

   

   

lucas  b  d   kanade  t           an iterative image registration
technique with an application to stereo vision  international joint
conference on artificial intelligence 
tomasi  c   kanade  t          detection and tracking of point features 
carnegie mellon university technical report 
j  shi and c  tomasi          good features to track  ieee conference
on computer vision and pattern recognition 
olsen  e  c  b           modeling slow lead vehicle lane changing  doctoral dissertation  department of industrial and systems engineering 
virginia polytechnic institute 
dalal  n   triggs  b           histograms of oriented gradients for
human detection  ieee conference on computer vision and pattern
recognition 
zhu  q   avidan  s   yeh  m   cheng  k           fast human detection
using a cascade of histograms of oriented gradients  ieee conference
on computer vision and pattern recognition 
hadden  j a   everson  j h   pape  d b   narendran  v k   pomerleau 
d a           modeling and analysis of driver vehicle dynamics with
run off road crash avoidance systems  in proceedings of the   th
isata conference 

 

fi