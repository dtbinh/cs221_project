parking occupancy prediction and pattern analysis
xiao chen
markcx stanford edu

abstractfinding a parking space in san francisco city area
is really a headache issue  we try to find a reliable way to
give parking information by prediction  we reveals the effect
of aggregation on prediction for parking occupancy in san
francisco  different empirical aggregation levels are tested with
several prediction models  moreover it proposes a sufficient
condition leading to prediction error decreasing  due to the
aggregation effect  we would like to explore patterns inside
parking  thus daily occupancy profiles are also investigated to
understand travelers behavior in the city 

 a   lot   spots

 b   lots    spots

 c    lots     spots

 d     lots     spots

 e    lots     spots

 f    lots     spots

i  i ntroduction
according to the department of parking and traffic  san
francisco has more cars per square mile than any other city
in the us      the search for an empty parking spot can
become an agonizing experience for the citys urban drivers 
a recent article claims that drivers cruising for a parking spot
in sf generate     of all downtown congestion      these
wasted miles not only increase traffic congestion  but also
lead to more pollution and driver anxiety  in order to alleviate
this problem  the city armed      metered parking spaces
and        garages spots  total of     parking lots  with
sensors and introduced a mobile application called sfpark
     which provides real time information about availability
of a parking lot to drivers  however  safety experts worry that
drivers looking for parking may focus too much on their phone
and not enough on the road  furthermore  the current solution
does not allow drivers to plan ahead of a trip 
we wish to tackle the parking problem by  i  predicting the
occupancy rate  defined as number of occupied parking spots
over total number of spots  of parking lots in a zone given
a future time and geolocation   ii  working on aggregated
parking lots to explore if there is estimation error reduction
pattern in occupancy prediction   iii  classifying daily parking
occupancy patterns to investigate different travel behavior at
different region 
ii  p roblem s tatement
it is more useful to predict occupancy by zone than by
individual lots  since drivers generally just want to find parking
within a certain proximity  usually less then    minutes
walking distance is affordable   thus we combine part  i 
and  ii  together for prediction task  we plot the aggregated
parking spots occupancy curve for intuitive understanding  it
is obvious  fig    that aggregation of parking lots reduces
the variability of occupancy ratio illustrate the fact that it
is easier to predict occupancy with higher aggregation level 
mean absolute percentage error  mape  is used commonly
to measure the forecast accuracy  consider two time series

fig     hourly parking occupancy ratio for various aggregation
levels  a single parking lot with a few spots has little pattern to
be exploited  aggregating more parking lots generates smooth
pattern so that it can be more predictable 

y t  where t           n together with its predicted series y t  
the mape is defined as
fi
n fi
  x fifi y t   y t  fifi
   
m ap e y  y   
fi
fi
n
y t 
i  

  we use mape in this project to measure our prediction
performance 
iii  e xperiment s etup
a  data description
the data used in this paper is collected from the sfpark
between july         and december           original data
is captured every   minutes including datetime  geolocation latitude  longitude   place name  lot capacity  occupied
number of spots  parking price  lot type  on off street parking  
for analyzing daily parking occupancy  we take the hourly
average occupancy rate as our refined dataset  therefore
occupancy for each day has    data points 
b  feature selection
the types of features we identified being highly relevant in
predicting parking availability are day  time  event  distance 
parking price  etc  for day  we set an indicator function for
each day in the week  for time  we discretize time into
   intervals and set an indicator function for each time
interval  ta   tb    inclusive on ta and exclusive on tb    the
single distance feature is a distance in miles between the lot
location and the cluster centroid to which it belongs  calculated

fi  where hod   is a function takes in time t and return the
hour of the day  from   to      dow    is a function return
the day of week  from monday to friday      are dummy
variables    c  are corresponding parameters  we fit the model
by getting least square error of  t 
the r  value for linear regression model is over      after
aggregation of     spots  it gives mape close to     figure
 b show the mape performance by aggregation 

fig     pca on timeseries  shown first   component

by k means we will mention in next section   three event
features   sports  concert  and race   are also represented
by indicator functions  we mark an event feature as   if
there is an event either happening at the time of interest or
will happen within four hours  to account for people arriving
early to an event   for example  the time stamp corresponds
to monday        am  also suppose that a major race is
starting at       am  within four hours of       am  that same
day  moreover we check the pca on timeseries to discover
occupancy feature in another space  and we also input the
first   pca features because it already explains over    
variance  thus  a feature vector for time t can be expressed as
vt    m onday                distance  race  occupancy t
            occupancy t  i   p c   p c   p c  t where i is the
time step lag  we pick previous    hours occupancies  i e
i        p c  stands for first principle component  similarly
for p c   p c  
c  model selection
   arima  we implement arima                      
model to investigate the relationship between prediction error
and aggregation level  here seasonal factor is set to be   
due to the daily period  we tune the parameters by picking
the lowest aic value among different p  d  q  p  d  q combinations      and performance of mape are computed in
table i  aggregation prediction error curve is shown in
figure  a  originally the prediction error goes over      but
it drops significantly after aggregating more than     spots 
the aggregation effect become flatten out when adding over
    spots 
   linear regression  ols   given y t  is the time series 
we input previous time step value together with the dummy
variable to indicate current time is allocated at what hour in
the day  and what day of the week to fit the value at current
time  the y t  can be expressed as
y t    c   

  
x

i   hod t    i   

i  

 
x

j   dow  t    j 

j  

  y t        t 
   

 a  att park region   hour ahead   b  att park region   hour ahead 
arima                      
ols

fig     mape plot of accumulated parking spots
   support vector regression  let a vector xk  t  holds all
sample data from y t  k       y t  k               y t   where
k is the vector length  also known as time lags   svr builds
a nonlinear map between y t  and xk  t     as follows 
y t        wt  xk  t     b    t 

   

         the kernel function  is chosen particularly depending
on problem  here the kernel function is radial basis function 
we pick previous    sample observations to generate current
prediction value  which is y t  relates to y t       y t 
             y t      it gives best performance when aggregating
about     spots  generating mape with value of       for
testing 
   feed forward neural network  it is an alternative
way to map nonlinear relation between y t  and the vector
xk  t     which contains y t  k           y t          we set
  layers including   hidden layer     input nodes  previous  
occupancies    pca occupancy features    categorical features 
  numeric features    as our ffnn setup  the  st layer has
   nodes   nd layer has   nodes  the output node represents
forecasting occupancy  we leave     data out as testing set 
the mape is performance towards the aggregation  noticing
that aggregation doesnt help a lot to reduce the error  since the
mape itself is quite small  which is about    as aggregating
above     parking spots 
d  results
from following results in table i  we find that the neural
network gives us the best prediction among these models 
however it needs longest time for training which is over   
minutes  whereas arima  ols  svr only needs           
minutes respectively 
  categorical features are day of week  time of day  event  numeric features
are distance and price

fimodels
arima                      
ols
svr
neural network  logistic 

traning error
     
     
     
     

table i  error table

  y t   for
between prediction and observation  i e  t    y t 
test error the single lot  we define
     
t
     
    x
 u  t   u   v  t   v  
   

 
uv
     
t u v t  
     
  where t is the number of time points in timeseries  u   v
are the respective timeseries of deviations between prediction
and observation  u   v are the standard deviations of u   v  
u   v represent mean of corresponding series across the time
span 
the cross correlation coefficient of  quantifies how similar
two signals are  in our case  it measures the correlation of the
prediction error between two separated lots  if uv are given
for all pairs of lots  the aggregation prediction error  say n  
has the standard deviation n   it can be expressed by
n    

 a  att park region    hour ahead  ols model  error
boxplot with mile expansion

  xx
u v uv
n  u v

   

where n is the number of aggregated lots  if all single
lot prediction errors  e g u   u   are iid  assuming they have
 
gaussian       then n     n        thus  the prediction
error goes down by aggregation  here we use a general
but very strong assumption that each lot prediction error is
independent identical distributed  but in reality  those error
may or may not be correlated  we need spend more effort to
investigate it 
iv  c lustering
of n parking lots is given by xn  
sn   xn are size of a lot and corresponding
occupancy  assume a forecaster that produces the corresponding forecast xn   the forecaster is a function of the previous
data available at a particular time and other features  denote
by pn  rn t the matrix of the profile patterns pn for all n
parking lots  the mean squared error  mse  for the forecaster
can be decomposed by conditioning on the  random  profile
matrix using the tower property 
an aggregation
pn
s x
n  
pn n n   where
n   sn

 b  heatmap of prediction error    hour ahead  ols

fig     mape plot of accumulated parking spots
by plotting out heat map  figure  b  of prediction error 
we can tell that financial district and south market street
regions have relatively high error ratio  it actually follows
the intuition because these areas are close to downtown area 
and the parking in out frequency is higher then other places 
therefore it cause more uncertainty to predict 
e  error reduction by aggregation
above analysis for a specific place  att park region  of
aggregated lots shows a significant decrease of the prediction
error compared to a single lot  it also has similar error
reduction pattern based on distance expansion  fig  a   we
try to explore it from theoretical point of view  suppose there
are two parking lots  u and v  the key element associate
the geographical lots with the aggregated level of prediction
error is the cross correlation coefficients uv of the difference

e mse xn   xn      e e mse xn   xn   pn   

   

in order to find out if prediction errors are independent  we
try to explore the daily parking profiles for different regions
in this section  we divide up the san francisco city into  
regions  including att park  south market street  financial
district  mission district  fisherman wharf  lombard street
and fillmore street  a quick clustering by k mean is shown as
following figure   we also aggregate nearby parking lots up to
    spots to generate a daily shape  we move the geolocation
centroid by grid search  and cover the whole att park region
first to see if there is particular pattern in daily shapes 
 a  dual peak  dual peak pattern is very obvious in at t
park region  it hits first peak around   pm and second
peak around  pm  similar dual peak effect also can be
found at cluster      in financial district 

fifig       regions in san francisco parking

 b  drop before ramp up  some shapes have pattern that
occupancy decreased before increased to high level  cluster         in fig   has such effect because a lot of parking
spots start to charge after  am 
 c  noon peak  cluster   in financial district have highest
occupancy around   pm
different shape patterns could represent different group of
travelers with their respective travel behavior  the dual peak
shape shows some people leave after  pm who are most likely
to be regular commuters  at same time  other new drivers
arrive in from  pm till   pm representing second peak of
parking occupancy  the ramping up happens before  am may
result from drivers who are coming to work for business  which
explains the real situation that most people start to heading
work at that time  noon peak appears in financial district
region which means travelers tourists take major proportion
of people who go to that place   in other words  for some
days  a lot of tourists go to financial district for visit 
figure  b is the histogram of cluster counts in at t park
region  it shows all   clusters spread though half year more
or less the same  while the figure  b shows that profile  
has highest counts  suggesting that the corresponding shape
appears more frequently during   months time in financial
district region 

 a  att park region    clusters

 b  histogram for   clusters

v  d iscussion
we try to explore the relationship between aggregating
parking lots and predicting parking occupancy  obviously 
prediction error is reduced by aggregating multiple parking
lots  but the benefit is decreasing when the aggregation goes
over certain threshold  we compare the trade off between the
aggregation and specific accuracy of place  and we take    
      spots as our prediction level  usually  it equivalently
means adding     parking lot together  we check the geolocation  and believe it doesnt deviate user too far  since most
aggregated lots are within     mile radius 
in feature selections  we also discover that not necessarily
all previous    timesteps occupancy need to be taken in as a
feature input for some model  such as linear regression  and
the testing error doesnt increase too much with about     
difference compared with svr 

 c  variance explained percentage v s  cluster number

fig     at t park region

comparing all prediction models we find neural network
gives best result  but it also takes longest time to run  more
interesting aggregation phenomena is observed from the daily
shape pattern analysis  including dual peak  noon peak  and
drop before ramp up  profiling such groups will give huge
benefits for predictions  it will help us to decompose the
prediction error  and targeting different type of travelers 

fiaggregation error decreasing  which is basically based on law
of large number  furthermore  to decompose the error we try
to find if there is a fixed set of profiles of daily parking
occupancy  from the region of at t park and financial
district  we find that the profile pattern indeed can be clustered
into a few typical groups  such as dual peak group and noon
peak group 
vii  f uture w ork

 a  financial district region    clusters

the aggregation phenomena is also likely to be observed in
other types of prediction processes  such as for example day
ahead occupancy prediction     minute ahead occupancy prediction  more models can be utilized to justify a detailed understanding of how aggregate occupancy patterns are formed
and verified on higher resolution data  also more features
can be incorporated into our current prediction models  such
as humidity or weather  population density in corresponding
region  etc  in terms of clustering the occupancy profile 
we might need to explore more regions to cluster the daily
occupancy shape  and more profiles may be discovered from
clustered daily shapes 
r eferences

 b  histogram for   clusters

 c  variance explained percentage v s  cluster number

fig     finanical district region

vi  c onclusion
in this project  we investigate the effect of aggregation on
prediction for parking occupancy  we show that forecasting
accuracy  as measured in relative error  mape  improve with
larger mean occupancy  several models are implemented here
for our prediction  and we find that neural networks performs
best with longest training time 
we also give a sufficient condition leading to the observed

    d  shoup  the high cost of free parking  sfgate article  jun      
    m  richtel  now  to find a parking spot  drivers look on their phones 
nytimes article  may      
    sfpark  http   sfpark org  
    j  lu  f  valois  m  dohler  and m  y  wu  optimized data aggregation
in wsns using adaptive arma  in sensor technologies and applications
 sensorcomm        fourth international conference on  ieee 
      pp         
    m  welling  support vector regression 
    d  basak  s  pal  and d  c  patranabis  support vector regression 
neural information processing letters and reviews  vol      no      pp 
             
    p  auer  h  burgsteiner  and w  maass  a learning rule for very simple
universal approximators consisting of a single layer of perceptrons 
neural networks  vol      no     pp               

fi