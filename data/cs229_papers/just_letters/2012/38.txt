the quest for dark matter
cs    project report  fall     
abhishek sheshadri   pranav pai   sreenath krishnan
 aeronautics

and astronautics  stanford university  email  abisheks stanford edu
engineering  stanford university  email  pmpai stanford edu
 mechanical engineering  stanford university  email  ksree stanford edu
 electrical

abstractthe main objective of this project is to devise an
algorithm that is able to predict the locations of multiple dark
matter halos in a given image of galaxy distributions precisely
and without directional bias  it is based on the active kaggle
competition observing dark worlds  and uses the data  rules
and accuracy measures prescribed by the competition 

i  introduction
dark matter halos are not directly observable  and this
continues to be a fundamental problem in its detection  and
therefore in our understanding of its behavior  however  these
large clusters tend to have observable effects on the surrounding visible neighbors and on light due to their ability to bend
the fabric of space time via gravitational effects  this leads to
the phenomenon of gravitational lensing  whereby light from
galaxies behind these dark matter clusters is distorted along the
path to our observation point causing an observable distortion
 tangential shearing  of these nearby  in the  d sky sense 
galaxies 
understanding dark matter requires accurate estimates of
the positions of these clusters  till now  physicists have not
been able to predict dark matter locations accurately without
detailed red shift and x ray based analysis of particular small
regions in the sky  this process is expensive and can only be
used to verify halos once a reasonable prediction of the halo
locations are made 

where n is the total number of halos across all the skies
and  is a measure of directional bias 
for a completely random prediction of the position of halos 
the metric comes out to be about       an open source
software called lenstool is the most widely used and accepted
tool in this field and gets a metric of about      on the test
skies  instead of just trying to improve on lenstool  we started
off from scratch so that we can have a rich learning experience
and understand and use a variety of algorithms rather than just
trying to improve a fixed algorithm 
if the galaxies were actually circular  they would have just
appeared to be ellipses tangentially aligned to the halo  but
since the galaxies themselves are elliptical  in the  d sky  and
have random orientations to begin with  the shearing effect of
the galaxies rotates and or magnifies them towards having a
higher tangential ellipticity with respect to the halo  it was
observed that the distributions of e  and e  were  n           
iii  h alo m odel
the effect of halo on a galaxy can be modeled as a
tangential shear  the magnitude of tangential shear should
go down with distance r   assuming the halo is spherically
symmetric the shear can be modeled as 
tangential  

s
rn

   

ii  t raining data and observations

normal   tangential

we were provided with     training skies  each with        galaxies and     halos  the locations of the galaxy centers
and the ellipticities  e  and e    of the galaxies as well as
the halo positions have been provided  the final algorithm
will be tested on a different set of skies  in order to evaluate
a prediction  the competition has set a metric described as
follows 

this model has   parameters  s n    the parameter s can
be interpreted as the strength of the halo and  can be interpreted as an equivalent to poissons ratio that is encountered in
mechanics of materials  the positive integer n controls the
rate of decay with distance  as a further simplification  we
assume that     it was found that n   fits well with the data
provided 
in order to provide an intuitive picture of the model  let us
consider what effect a halo following equations        has on a
circular galaxy with radius r  the galaxy becomes elliptical
with major axis a   r    rs   and minor axis b   r  also
the major axis will be perpendicular to the line joining the
galaxy and halo  it can be proved that the application of halo
is not completely reversible  in the sense there are multiple
initial configurations of galaxy that can result in the same
final configuration 

m 

f
 g
    

   

where m is the metric  f is the average radial distance from
the prediction to the true position of the halo and
v
u
n
n
u   x
  x
cos i       
sin i   
g   t 
n i  
n i  

   

   

fiiv  m ethods for single halo skies

a  net tangential ellipticity  nte 

fig     an example of a case wherein the halo is not close to the maximum
nte point  the blue circle shows the predicted halo position and the black
circle shows the actual halo

fig     a sample   halo case  the lines are the major axes of the galaxies
and the   black circles are the halo locations  we can see the strong halo is
in a region of high nte

we observed that the effect of the halo is to increase the
effective ellipticity of a galaxy in a direction tangential to the
line joining the halo and the galaxy  so we calculated the net
tangential ellipticity at each point in the sky due to all the
galaxies and plotted it as a contour plot  in the single halo
case  the point of maximum tangential ellipticity is in general
close to the actual halo location  but in the case of multiple
halos  usually only the strong halo can be identified in this
manner as shown in fig    
nte  

n
x

fig    
 i 
 e 

cos 

 i 

 

 i 
e 

 i 

sin   

the no  of galaxies aligned almost tangential to the halo is high

   

i  

b  aligned galaxies as an indicator for outliers
though the nte is a good indicator of the location of the
strongest halo for most cases  there are a few cases for which
this does not work and we referred to these cases as outliers 
an example of such a sky is shown in fig    
in such cases a brief look at the galaxies aligned almost
tangentially to the halo gave us the idea of using the aligned
galaxies alone for calculating the maximum nte and this
sometimes improves the accuracy of the prediction  fig   
shows all galaxies aligned almost tangentially to the halo 
so  at every point we consider all galaxies almost tangentially
aligned to that point and compute the nte using these galaxies
only 

c  logistic regression
the data as such is not in a form where one can apply
logistic regression directly  this is because we have a single
output  which is the halo position  as a function of a set of
inputs  which are the properties of galaxies   not only does the
input set has varying length across different training skies  the
corresponding input sets of two different skies are not related 
however this problem can be converted to a standard logistic
regression problem using the following tricks 
 divide each sky into a fixed number of bins  each bin is
assumed to be an observation 
 instead of considering features of each galaxy  one can
now set features for each bin which will be an average
of the feature of galaxies 
 the target variable can now be set as whether a halo is
present in the given bin or not

fifig    

logistic regression results

fig     maximum likelihood contours based on generative learning results

   feature selection  it has been shown that a high value
of nte and a low value of signal mismatch  section  vi c 
are both good indicators of the presence of halos  in addition
we also saw there are significant numbers of galaxies aligned
tangential to the halo  hence it makes sense to use the
following as the input features
 nte at the center of the bin
 signal mismatch w r t the center of the bin
 the number of galaxies aligned tangentially with the
center of the bin
since nte and signal mismatch had widely varying limits
across skies  we decided to scale it between   and   before
performing the regression 
   results  it was found that the third feature is a relatively
weak one  we present the results of logistic regression for the
single halo case in figure      such a classification can also
accurately predict the position of strongest halo in multiple
halo cases  the performance metric was as low as        for
single halo predictions 
v  g enerative l earning
let g i  denote the features of galaxy i and h denote the
halo features  position and strength  and s    g i     which
denotes the entire sky  the given problem is to find h that
maximizes p h s   using bayes rule  assuming the galaxy
observations are conditionally independent given h 
n

p  h s   

p  s h p  h  y p  g i   h p  h 
 
p  s 
p  g i   
i  

   

p  g i    is constant for a given sky  since its equally likely
that the halo is present anywhere  the prior p h  is just a
uniform distribution  since we have already assumed a model
for the halo we can find a discrete estimate for p  g i   h  
even though the expression involves position of galaxies and
halos as well as the halo strength  all these can be characterized
by a particular value of tangential shear  in other words  if we

have a distribution p  e    e      where e  is in the tangential
direction of the halo  we can fully characterize p  g i   h   a
discrete approximation of p  e    e      can be obtained by the
following sampling technique 








divide the possible values of e    e  and  into a finite
number of bins  let the set of such points be  ei    ej     k  
and the bin size be  m x m x p 
generate q  q  m  pairs of random samples drawn
from n          as candidates for halo absent sky 
apply the tangential shear to the samples to find the
 i j 
 i j 
resulting e    e 
for all the p tangential shear
values  here i is an index for the sample and j is
an index for the tangential shear 
the resulting values are discretized to the respective bins
the distribution can be approximated as 
p  ei    ej    k  

pq
 

r  

 r k 

  e 

 r k 

  ei    e 
m q

  ej        m
   

we have used laplace smoothing to avoid     cases when
using this distribution  hence we can determine the likelihood
p  h s  for a given sky at any number of points using
equation    the maximum likelihood point is chosen as the
position of halo  the likelihood contour of a typical sky is
shown in figure     this approach is also successful in finding
the strongest halo  metric of       for single halo case   which
further justifies the assumptions in the model  this model can
be extended to the case with multiple halos by appropriately
calculating the probability distribution 
vi  m ethods for multiple halo skies
since we are able to identify the strongest halo by means
of one of the methods described above  most of our methods
to find the location of the second and third halo assume the
knowledge of the first halo 

fia  iterative method based on alignment of galaxies
so far we have seen methods to capture the strongest
or the last applied halo  in order to get the second and
third halo location  one of the first methods we tried
was to remove the galaxies which are aligned almost
tangentially to the first halo  these are the galaxies
which contribute the most to the high nte values around
the strong halo  so we removed all galaxies which are
almost tangential  within     of tangential direction 
and rebuilt the nte contour and considered the point
with the maximum nte to be the halo location  we
do this repeatedly in case of more than   halos  this
method gave us a metric of        across the training skies 
b  halo removal elimination strategy
given that we have effective methods to determine the
position of the strongest or last applied halo even in multiplehalo skies  we now try to unapply the identified halo so as to
capture the effect of the other halo  from physics literature 
it can be found that the shearing strength of a halo decreases
with distance from the galaxy  we already mentioned this in
the halo model section and we also noted that such a model is
non invertible  however we can find an approximate inverse by
specifying additional constraints  in the present case  given a
final configuration we selected the initial configuration that has
the minimum ellipticity  this makes the model invertible i e 
we can apply a negative strength of the same magnitude and
approximately recover the original sky  however  we need to
have an estimate for the strength of the halo before unapplying
the halo  to find an estimate for the strength 
   we assume the position of the strong halo known  from
one of the single halo methods  
   we apply a halo onto the ideal sky at this location with
varying halo strengths and calculate minimum mismatch value
 described in the next section  of the sky 
   we consider the strength which causes the least minmismatch as the strength of the halo  lets call this strength
so  
now we can use the halo model to obtain e  and e  of
sky without the halo  we can then try one of our single halo
capturing methods to get the second halo  fig    shows the
unapplication removal of the halo  here the strength of the
halo removed is varied and the resultant nte maps shown 
this method works well for   halo and   halo cases
in identifying the first   halos but does not work
very well when going from second to third halo 
this method gives us a overall metric of      across
all the training skies and about     on the test skies 
c  minimum mismatch methods
the mean of the ellipticities e  and e  are both zero  this
tells us that many of the galaxies are close to circular before
halo application  we also experimented with the order of
application of the halo and based on our observations that the

fig     effect of halo removal  the strong halo at the bottom right corner
is removed gradually and it can be seen that the red patch moves near the
second halo indicating its position

last applied halo has a high probability of being the strongest
halo in terms of the nte  we decided to assume that the
strongest halo according to the nte is also the last applied 
in this method we do the following 
   discretize the sky into bins or basically create sampling
points across the sky 
   create an ideal sky i e a sky with the same galaxy
locations but zero ellipticities  basically circular galaxies  
   at each point  or bin center   use our halo model and a
guessed strength and apply the halo on the ideal sky placing
it at this sampling point 
   now apply the first known strong halo onto this above
sky using our model and the optimal strength for this halo
 described in the previous section   let the resulting sky have
ellipticities e o and e o  
   calculate the mismatch between this resulting sky and
the actual given
p sky  we have used various definitions of mismatch like ke   e o k     ke   e o k   and ketan  etano k 
etc 
   we find the point in the sky which has the least mismatch
as the halo prediction and call this mismatch value as the
minimum mismatch or min mismatch 
   we repeat steps     for various strengths and take the
result which had the least overall min mismatch value as the
location of the second halo 
this method of using min mismatch described above can
be used in the single halo case also where step   will not
be required  we used this as an alternate to nte based
approached for the single halo cases and obtained slightly
better results overall 
this method again works well for   halo cases but not so
well for   halo cases because in the   halo case  even after
assuming the location and strength of   halo  the strongest
one   we have   halo locations and strengths to vary and test
the mismatch  it becomes both inefficient and ineffective when
trying to vary all   parameters and trying to find the least
mismatch  the overall metric is about      on the training

fiskies 
vii  f ixed p oint m ethod
it was shown how nte calculations fail for some single
halo cases  the root cause of the problem is that the halo is
weak to cause any significant change to the galaxies  however 
this would have been possible if we had information about the
initial sky the sky before the application of halos   it is natural
to ask if there is a method to recover the initial sky  let ei
and eo denote the ellipticities of initial sky and observed sky
respectively  these two skies can be related using the halo
model  let f denote the halo function of the given sky that
takes galaxy features as input  applies the tangential shear and
return the modified galaxy  then we have 
eo   f  ei  

   

f    will then denote the ellipticities had the galaxies been
circular to start with  one key observation that we made is
depicted in figure      the figure is generated based on the
model  the top left figure shows the nte distribution of the
observed sky for a weak halo case  clearly a prediction using
maxima of nte will result in a significant error  the reason
for that is clear in the top right figure  which shows the nte
distribution of the initial sky  the effect of the halo is weak
enough not to shift the maxima to its position  however if we
look at the difference bottom left   we find that the maxima
is exactly at the halo  this means that if we apply maxima
of nte criteria over the difference  it would not fail even
for weak halos  another remarkable observation is that the
difference is very similar to the nte distribution of sky formed
by applying the halo onto a circular set of galaxies  since
equation   can be represented as nte   a e  where e denotes
the ellipticities  the above observation can be written as
af      aeo  aei

   

 af      af  ei    aei

    

fig    

nte contours to explain the fixed point iteration

fig     direction of maximum expectation  the red dot indicate the angle
between halos

assuming g x    af x    af     the equation simplifies to 
g ei    ei

    

this is clearly finding a fixed point of the function g
different from zero  the fixed point gives us the initial sky 
this is slightly more complicated than a standard fixed point
problem because the function g x  is specified only if one
specifies both halo position and strength 
viii  other ideas explored
   direction of maximum expectation  this is a concept
useful in case of two halos  here we assume that the
expected value of ellipticity will be maximum in the
direction of line joining the two halos  the assumption
holds fairly well if the strength of both halos are
relatively close  figure     
   k means over intersection points  this is again an extension of the aligned galaxies concept  the assumption that
there will be a significant number of galaxies aligned

with the halo  would also mean that the intersection of
minor axis of galaxies are expected to cluster around
the halo  we calculated all the intersection points and
applied k means clustering over those points  however 
this method works only for strong halos 
   gravitational lensing approximations  the average ellipticity for an unlensed sky  a sky without a halo  is
zero  according to the weak lens approximation  the
average ellipticity in a lensed sky can be used as an
approximation to the average shear with lensing  we
used this idea to get an estimate of the strength of
the halo in order to un apply it  however this did not
work  because in a multiple halo case this average is
an indicator of the net strength rather than the strength
of the strongest halo and probably also because the
simulated data is not made to conform to this 

fi