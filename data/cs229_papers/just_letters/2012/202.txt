stock market forecasting using machine learning algorithms
shunrong shen  haomiao jiang

tongda zhang

department of electrical engineering
stanford university
 conank hjiang    stanford edu

department of electrical engineering
stanford university
tdzhang stanford edu

abstractprediction of stock market is a long time attractive
topic to researchers from different fields  in particular 
numerous studies have been conducted to predict the movement
of stock market using machine learning algorithms such as
support vector machine  svm  and reinforcement learning  in
this project  we propose a new prediction algorithm that exploits
the temporal correlation among global stock markets and various
financial products to predict the next day stock trend with the
aid of svm  numerical results indicate a prediction accuracy of
      in nasdaq      in s p    and       in djia  the
same algorithm is also applied with different regression
algorithms to trace the actual increment in the markets  finally 
a simple trading model is established to study the performance of
the proposed prediction algorithm against other benchmarks 

i 

introduction

prediction of stock trend has long been an intriguing topic
and is extensively studied by researchers from different fields 
machine learning  a well established algorithm in a wide range
of applications  has been extensively studied for its potentials
in prediction of financial markets  popular algorithms 
including support vector machine  svm  and reinforcement
learning  have been reported to be quite effective in tracing the
stock market and help maximizing the profit of stock option
purchase while keep the risk low        however  in many of
these literatures  the features selected for the inputs to the
machine learning algorithms are mostly derived from the data
within the same market under concern  such isolation leaves
out important information carried by other entities and make
the prediction result more vulnerable to local perturbations 
efforts have been done to break the boundaries by
incorporating external information through fresh financial
news or personal internet posts such as twitter  these
approaches  known as sentiment analysis  replies on the
attitudes of several key figures or successful analysts in the
markets to interpolate the minds of general investors  despite
its success in some occasions  sentiment analysis may fail
when some of the people are biased  or positive opinions
follow past good performance instead of suggesting promising
future markets 
in this project  we propose the use of global stock data in
associate with data of other financial products as the input
features to machine learning algorithms such as svm  in
particular  we are interested in the correlation between the
closing prices of the markets that stop trading right before or at
the beginning of us markets  as the connections between
worldwide economies are tightened by globalization  external
perturbations to the financial markets are no longer domestic  it

is to our belief that data of oversea stock and other financial
markets  especially those having strong temporal correlation
with the upcoming us trading day  should be useful to
machine learning based predictor  and our speculation is
verified by numerical results 
the rest of the report is organized as following  section ii
presents our algorithm in details  including the fundamental
principle of our algorithm  data collection and feature selection 
numerical results are shown in section iii followed by analysis
and discussions  in section iv  we established a simple trading
model to demonstrate the capability of the proposed algorithm
in increasing profit in nasdaq  section v summarizes the
whole report 
ii 

algorithms

a  basic principles
globalization deepens the interaction between the financial
markets around the world  shock wave of us financial crisis
hit the economy of almost every country and debt crisis
originated in greece brought down all major stock indices 
nowadays  no financial market is isolated  economic data 
political perturbation and any other oversea affairs could cause
dramatic fluctuation in domestic markets  therefore  in this
project  we propose to use world major stock indices as input
features for our machine learning based predictor  in particular 
the oversea markets that closes right before or at the beginning
of the us market trading should provide valuable information
on the trend of coming us trading day  as their movements
already account for possible market sentiment on latest
economic news or response to progress in major world affairs 

fig     world financial markets 

fib  data collection
the data set used in this project is collected from      it
contains    sources as listed in table i and covers daily price
from    jan      to     oct        since the markets are
closed on holidays which vary from country to country  we use
nasdaq as a basis for data alignment and missing data in
other data sources is replaced by linear interpolation 
table i 
stock
currency
commodity

data source

nasdaq  djia  s p      nikkei     
hang seng index  ftse     dax  asx
eur  aud  jpy  usd
silver 
platinum 
oil 
goldc  dropbox cs    project

c  feature selection
in this project  we focus on the prediction of the trend of
stock market  either increase or decrease   therefore  the
change of a feature over time is more important than the
absolute value of each feature  we define xi t   where i 
               to be feature i at time t  the feature matrix is
given by
f    x   x        xn t

   

xt    x  t  x  t      x   t  

   

where
the new feature which is the difference between two daily
prices can be calculated by
xi t    xi t   xi t  

   

 x  t    x  t   x  t   
 f

    x  t    x  t    x   t  t

   

   x        x             x n  

   

due to the difference in market value and basis of each
market  the differential values calculated above can vary in a
wide range  to make them comparable  the features are
normalized as following 

   
and the normalization can be implemented as 

   
as discussed above  the performance of a stock market
predictor heavily depends on the correlation between the data
used for training and the current input for prediction 
intuitively  if the trend of stock price is always an extension to
yesterday  the accuracy of prediction should be fairly high  to
select input features with high temporal correlation  we
calculated the autocorrelation and cross correlation of different
market trends  increase or decrease   the results shown in
figure   use nasdaq as the base market 
   

cross correlation with respect to nasdaq

in addition to stock markets  commodity prices and foreign
currency data are also listed as potential features  as different
financial markets are interconnected  for instance  slowdown
in us economy will definitely cause a drop in us stock market 
but at the same time  usd and jpy will increase with respect
to its peers as people seek for asset havens  such interplay
implies the underlying relationship between these financial
products and the possibility of using one or some of them to
predict the move of the other ones 

nasdaq
s p   
djia
hang seng
nikkei   
ftse   
dax
asx
gold pm
silver
platinum pm
palladium pm
oil
aud
euro
jpy

 

   

   

   

   

 

    
  

 
delay

 

fig     autocorrelation and cross correlation of market trends using
nasdaq as a base 

it can be seen from the graph that the autocorrelation of
nasdaq daily trend is only non zero at the origin based on
which we may conclude that the trend of nasdaq daily index
is approximately a markov process  hence  past data of
nasdaq will not provide much insight to its future
movement  the same conclusion could be made on many other
data sources whose cross correlation with nasdaq is close to
zero  although the trend of djia and s p    have strong
correlation with nasdaq given the data are on same day 
they are not available by the time they are needed for
prediction  however  data sources such as dax aud and
some other markets are promising features for our predictor
built by machine learning algorithm as they have relative high
correlation with nasdaq at the origin and their data is
available before or at the beginning of the us market trading
time  this observation actually confirms our forecast principle 
as discussed in previous sections  about the inter connection
between global markets and how the information reflected by
their movements can be beneficial to the prediction of us
stock markets 
in addition to the correlation of daily market movements  it
is also worth investigating the correlation of market trends in
longer term  which may also offer valuable information for
predicting future price        to study this   in eq      is
varied from   day to    days  and part of the results are plotted
in figure    as can be seen from the graph  temporal
correlations between the markets increase with the time

finormalized correlation

window  over which the trends of stock indices are calculated 
one explanation for this phenomenon is that the calculation in
eq      makes the time spans of the outputs overlap with each
other and therefore increase the temporal correlations 
moreover  the operation also implicitly conduct an averaging
on the data within the interval which effectively removes the
noise and the underlying correlation between the markets
become clearer 

   

the result of this experiment supports the analysis of crosscorrelation  hence  we are convinced that index value of other
stock markets and commodity prices can provide useful
information in the prediction process 
  

long term prediction
besides daily movement  sometimes we also care about
prediction results for longer terms  here  we define our
problem as predicting the sign of difference between
tomorrows index value with respect to that of certain days ago 
we use svm as a training model and the prediction accuracies
under different time spans are shown in figure   

 
   
   
   
   
 
  

  
  

 

  

time window size

 

   

relative delay

fig     autocorrelation and cross correlation of market trends with different
time spans 

given all possible features  we implemented forward
feature selection algorithm to select the features that contribute
most to the accuracy of prediction using different machine
learning algorithms  detail results are presented in the next
section  as expected  a combination of daily market trend and
long term movement provide the best result 
iii 

experimental results and discussion

a  trend prediction
  

single feature prediction
in section    we used cross correlation to estimate the
importance of each feature  to verify the information given by
correlation analysis  we use individual feature to predict daily
nasdaq index trend  the prediction accuracy by each single
feature is shown in figure   

fig     accuracy of long term prediction

from the figure  we can see that prediction accuracy
increases when time span becomes longer  this is because that
the longer the period is  the more information we have and the
higher resistance of our prediction to noise  at last  we can
reach     accuracy when time spam gets longer than    days 
actually  we can re paraphrase this problem as estimation
 
    where
of
  this
corresponds to the after mentioned regression problem of daily
stock market movements 
  

multi feature prediction
using the features described in section    we compare the
prediction accuracies of svm algorithm and mart  a
decision tree based boosting algorithm   the prediction results
are shown in table   
table ii 

svm
mart

one day prediction accuracy

top   features
     
     

all features
     
     

from table    we can see that accuracies from svm and
mart learner can reach as high as      this daily trend
prediction accuracy is higher than most of models and the
values reported on financial analysis websites 
fig     prediction accuracy by single feature

from the figure  we can see that dax yields the best
results        accuracy of prediction  prediction accuracies of
australian dollar  ftse and oil price are also relatively high 
reaching              and       respectively 

in addition  we note that svm algorithm is very sensitive to
the size of training data  when the size of training set is not
large enough  hyper plane found by svm algorithm might not
be able to split the data properly  thus  feature selection is
essential when using svm  in contrast  multiple additive
regression trees  mart  algorithm requires less training data
and prefers high dimensional feature set 

fito test the generality of our model  we used the same
algorithm to predict the other two us stock markets  the
results are shown in table   below 
table iii 

to build up the multiclass classifier  we firstly need to
define the width of the central region  to evaluate how well
our classifier is  we introduced the concepts of precision and
recall  which are defined as

prediction accuracy on all us stock markets

   
accuracy

nasdaq

djia

s p    

     

     

   

   

as can be seen  all entries in the table are high  this shows
that our model can be applied to all us stock markets  actually 
the idea of using time delay between different stock markets
can be also utilized to predict other indexes 
b  regression
compared to stock trend  the exact increment in stock
index may provide more information for investment strategy 
this means the classification problem now evolves to a
regression problem  to judge the performance of our model 
we use square root of mean square error  rmse  as criteria 
which is defined as




in the equations above  tp  fp and fn stand for true positive 
false positive and false negative respectively  the precision
and recall values against different central region widths are
plotted in fig     in the figure  recall for positive class reflects
the proportion of predicted rising days among all rising days
while precision indicates the hit rate among rising predictions 
thus  recall directly impacts the frequency of trading and
precision impacts the profit   loss at each time  taking the
product of the two  we calculate the f  score which is defined
as
   

   

we use linear regression  generalized linear model  glm 
and svm algorithm to predict exact value of daily nasdaq
movement  the rmse values for different algorithms are
reported in table   below 
table iv 

rmse

stock index regression accuracy

baseline

svm

linear

glm

    

    

    

    

the baseline predictor in the table is formed by a zeroorder hold filter  from the table  we can see that svm gives
the most accurate prediction  the rmse given by svm is      
only half of the average fluctuation        
c  multiclass classification
in previous part  we explored various methods to improve
prediction accuracy and minimize square root mean square
error  these efforts can be directly used to maximize the
trading profit  however  besides maximizing profit  another
aspect of our task is to minimize trading risk  in this part  we
will use the svm regression model and start from the basic
intuition in svm algorithm 
in svm  the further distance between the point and hyperplane is  more confident we are for the prediction we made 
whereas  our prediction cannot be very accurate when the point
is close to hyper plane  to minimize the trading risk  we can
pick out these risky points and ignore their prediction labels 
thus  we need to classify the original data into at least three
classes  negative  neutral and positive  this is the intuition that
leads to the prototype of our multiclass classification model 

fig     precision and recall vs  central window widths for positive and
negtive class

the value of f  scores for positive and negative classes are
shown in fig     as can be seen from the graph  f  scores for
both class are relatively high around   and     therefore  we
shall choose window size around   when trading fees   tax are
small enough to be ignored  otherwise  we should choose   
as the optimal window size 

fig     f  score vs  central window size for positive and negative class

fiiv 

trading model

in this section  we will build up a trading model based on
the predictor we find in section   and section    we compare
the simulation results of our model against two selected
benchmarks 
a  basic settings
we randomly select   different time slots for simulation    
days inside each time slots  the initial capital at the beginning
of the each time slot is        dollars  at the end of the trading
period  all possessed stocks are forced to be cashed 
furthermore  for simplicity  we suppose that there is no stamp
duty or any kind of tax or fees during the process and short
sale is not allowed in our simulation 
b  model specification
in our simulation  we use two benchmark models and one
model using our predictor  here  we will describe the three
models in detail 
   benchmark model  
in this simple model  we suppose we use all the money to
buy stocks on the first day and sell the stocks at the end  thus 
the profit is depend on the trend during this testing period  that
is

fees into consideration  we also assume that our operation will
not have direct effects on index value 
table v 

trading results of different trading strategies

benchmark  

benchmark  

our model

period  

     

       

       

period  

       

       

      

period  

        

       

      

period  

      

    

      

period  

       

       

     

average

      

      

      

v 

conclusion

in the project  we proposed the use of data collected from
different global financial markets with machine learning
algorithms to predict the stock index movements  our findings
can be summarized into three aspects 

    

  

   benchmark model  
in this model  we assume that closing stock index of
tomorrow is higher than today if todays index is higher than
that of yesterday  whenever the prediction is rising  we buy at
most shares of stocks  otherwise  we sell all stocks we have 

correlation analysis indicates strong interconnection
between the us stock index and global markets that
close right before or at the very beginning of us
trading time 

  

various machine learning based models are proposed
for predicting daily trend of us stocks  numerical
results suggests high accuracy

  

a practical trading model is built upon our well
trained predictor  the model generates higher profit
compared to selected benchmarks 

this model performs well when stock markets go smoothly 
but it losses a lot when the markets fluctuate or shocks
frequently 
   proposed trading model
we use the prediction results from our svm learner  the
trading principal is the same as benchmark model    that is 
we buy stock when prediction is positive and cash all stocks we
have when prediction is negative 
c  simulation results
the profit of the three models during the five period is
shown in table   below  from the table  we can see that during
most of periods  our proposed model wins the most profits  on
average  our model gains       dollars as profits for every   
days  that is    return rate in    days  therefore  we can
reach annual interests at about     
besides high profit  our model also has the advantage of
low risk  our model seldom loses in trading period while
benchmark model   and benchmark model   loses in period  
and    actually  in most cases  our model can get at least   
profits in the    day long trading period 
although we can reach high profit and low risk in our
simulation  we shall still remember that we did not take tax and

there are a number of further directions can be investigated
starting from this project  the first one is to explore other
creative and effective methods that might yield even better
performance on stock market forecasting  second  models can
be modified to take care of the tax and fees in the trading
process  finally  we can investigate the mechanism of short
sale and maximize our profit even when the market is bullish 
reference
   

   
   
   

   

w  huang et al   forecasting stock market movement direction with
support vector machine  computers   operations research      pp 
                 
j  moody  et al   learning to trade via direct reinforcement  ieee
transactions on neural networks  vol      no     jul       
www wikiposit org
s  zemke  on developing a financial prediction system  pitfall and
possibilities  proceedings of dmll      workshop  icml  sydney 
australia       
vatsal h  shah  machine learning techniques for stock prediction 
www vatsals com 

fi