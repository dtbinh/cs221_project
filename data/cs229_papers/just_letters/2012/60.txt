dining scene recognition using related
object detection
chaohao wang
chaohaow stanford edu

gilbert fu
gilfu stanford edu

alan quach
alanq stanford edu

introduction
the goal of this project is to recognize dining scenes with the help of related object detection  for
example  objects such as plates  glasses  bottles and cups will signify a restaurant setting  we will base
our object detection algorithm on the paper  histograms of oriented gradients for human detection 
by n  dalal et al  in this project  we will train objects individually by using techniques like histograms of
oriented gradients  hog  and svm  part of the training data are from pascal voc challenge and the
rest are from bing image search and our personal pictures  after individual models are trained  test
pictures will be scanned with boxes of different scales and a score for each object match will then be
computed  afterwards  the probabilities of each object model output and percentage of the image the
objects appears in are used to compute the feature vectors for another svm model that will predict a
dining scene or not  the block diagram of the system is shown in fig    

inpu
t

hog
 
hog
 
hog
 
hog
 
hog
 
hog
 
hog
 

plate model
 
plate model
 
plate model
 
plate model
 
wine model

final svm features are
f area  probabilities 

scene
svm

y n
 

bottle
model
tea cup
model

figure   block diagram of the system

histogram of oriented gradients
histogram of oriented gradients  hog  is an effective feature descriptor in computer vision for object
detection  it counts the occurrences of gradient orientation in a small region of an image  the idea
behind hog is that local object appearance and shape within an image can be described by the
distribution of intensity gradients or edge directions  this normalization within a block can be done to
get better invariance to changes in illumination or shadowing  in our project  we used cell size of    block
size of   and   different orientation bins in     degrees  the hog diagrams different objects are plotted
in fig     the orientation of the line segments correspond to the highest weighed bins in hog of cells 

fifigure   hog diagrams for different objects

svm
we use a svm for our classifier on each model  the svm code we obtained from the library of support
vector machines by chih chung chang and chih jen lin  we used their matlab svm libraries to help
train and classify using the different dining scene objects hog vectors as our input features for positive
examples  the kernel we used is the radial basis function  exp  gamma  u v     

figure   cr heat map for bottles
so there are   parameters in the optimization problem gamma in the kernel function and cost function
in regulation  cr heat map is plotted for each model showing the fold   cross validation results for
different gamma and c  cr heat map of bottle is shown in fig     optimum values for these two
parameters can be found in the heat map 

data collection
part of the training data is from pascal voc challenge  the data package includes images with different
objects bounding boxes labeled that we can directly feed into hog after resizing  we also collected
many personal pictures and pictures manually from bing googles image search results and by using a
ruby script that interfaces bings search api to grab hundreds of search image results  manual filtering

fiwas done to remove bad images  afterwards we had to crop and or resize each image so that each
image is uniform in dimension before calculating the hog  cropping and resizing was done using
matlab  about     pictures were collected for each object and roughly         pictures were used for
negative data  the negative examples we used were hog vectors from various vacation photos and
other random photos  to reduce the number of false positives we ran the trained models over hundreds
of negative pictures  the positives results from these runs over non dining pictures are then false
positives  which we then re fed into our training data as a negative example and created a more
accurate retrained model 

object models
models for bottles  plates  wine glasses  and teacups are trained with different image sizes  we decided
to use optimum image height of    pixels to balance the trade off between speed and accuracy  a
training set of a few hundred pictures were passed through a hog function and then into a svm for our
classifier on each model  here are the fold   cross validation results of each model 
bottle

cup

wine glass

empty plate

plate with food

     

     

     

     

     

angled empty
plate
     

angled plate
with food
     

figure   object model training

applying models to pictures
these results generated by using a matlab code that scans through the entire image  taking small subimages of various sizes of the image and passing it through the svm classifier with a generated model 
for testing speed purpose  all the testing images are scaled down to at most    px wide  when applying
different models to the real pictures    different scales of bounding boxes                                   
are used to scan through pictures to detect objects with different scales  during scanning  one quarter of
the bounding box width height is used as the scanning step as shown in fig     after grabbing the subimage inside the bounding box  the sub image is scaled back to the original size of the model and fed
into different object detectors 

fi   

      

      
   

      

   

      

      

   

scale  

scale    
figure   scanning and recognizing

some of the objection detection results  including false positives  are shown in fig    the highlighted
boxes indicate a positive match for a tested object and the different colors correspond to different
models 

figure   object detection results

fidining scene model
two pieces of information we get from each object detected are the area and probability of the prediction 
intuitively  the more area that objects related to dinning scene occupy the picture higher the probability the
picture is positive  also the more confident the object detector is  the more likely the picture is a dining scene
picture  besides we want to highly differentiate objects detected with low positive probability  close to    
positive  and objects with high positive probability since the former could be false positives  so the empirical
expression we use the generate feature vector element score is

where ai is the bounding box area  apic is the total area of the picture  pij is the probability of ith detected box for jth
item model  c is a scaling parameter for the probability 
different objects will have different scores based on the equation above  different object scores should be
weighted differently when predicting the result  object like plates should have high weight since it is a strong
indicator  here we didnt explicitly learn the weight of each object but use svm instead  the final feature vector for
scene detection is  s  s  s   sn  where n is the number of object models we have  in our case n    scene svm
model is trained on    pictures with objects detected by our object models 

results
after training and creating our full dining scene recognition model we tested it on a test size of
    pictures  our model correctly predicted    images to be dining or non dining scenes so its accuracy
is      the models precision is       and its recall is       giving an f  score of        we believe that
for an application  it is best and most user friendly if the false positives were minimized  so we value a
high precision rate more rather than a high recall  for the images shown above in the applying models
to pictures section  our model correctly predicts pictures              and   as dining scenes and pictures
  and    as non dining scenes  the one mistake is the false positive classification of picture    this false
positive image is reasonable for our model to classify the baby in the chair as a plate of food as the chair
is also round like a plate 

future work
to improve our models we need to collect a lot more training data for the various different
shapes of plates  glasses  and cups  each of these different shapes should also have multiple orientations
data on the different angles of plates must be collected  currently  our prediction model runs too slow
for real time classification of a photo bank as each picture takes roughly   to   minutes  parallelizing
each model on a separate process should improve the speed drastically  a deformable model detector
for incomplete objects can also be useful for our project because objects are often cut off in the picture
of behind other objects 

references
chang  chih chung  and chih jen lin   libsvm  a library for support vector machines   acm transactions
on intelligent systems and technology  tist                
dalal  navneet  and bill triggs   histograms of oriented gradients for human detection   computer
vision and pattern recognition        cvpr       ieee computer society conference on  vol     ieee 
     

fi