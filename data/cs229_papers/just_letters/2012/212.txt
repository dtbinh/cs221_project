applying machine learning algorithms to oil reservoir
production optimization
mehrdad gharib shirangi
stanford university

abstract

introduction
wang et al         applied retrospective optimization to well placement problem  they applied k means clustering for selecting the realizations at each subproblem  the focus of this
work is on well control optimization  a response
vector is introduced to well characterizes the dissimilarity between the response of realizations 
here  kernel k medoids clustering is applied for
choosing a small set of statistically representative realizations 
our objective is to find an optimal well control
vector that maximizes the expectation of the lifecycle npv over the ensemble of reservoir models 
the well control vector u  can be shown by

in well control optimization for an oil reservoir
described by a set of geological models  the expectation of net present value  npv  is optimized  this approach called robust optimization  entails running the reservoir simulator for
all the reservoir models at each iteration of the
optimization algorithm  hence  robust optimization can be computationally demanding  one
way to reduce the computational burden  is to
select a subset of models and perform the optimization on the reduced set  another popular technique  is using fast proxy models  rather
than full physics simulators  in this work  a ker    

nc
nc t
 
 
nel clustering technique is used to select a subset u   u    u         u         unw   unw        unw  
   
of reservoir models that capture the range of unwhere  each subscript denotes the well index and
certainty in the response of the entire set 
each superscript denotes the control index  nw
denotes the number of wells and nc denotes the
in this work an adaptive strategy is used
number of control steps for each well  unj can
to build fast proxy models for the npv  and
be either well pressure  bhp  or oil rate or total
then optimizing the proxy model using a pattern
liquid rate of the jth well at the nth simulation
search algorithm  the proxy model is generated
time step  in this work  the well controls are
by training an artificial neural network  ann 
the bhps  we only consider simple bound conor support vector regression model  svr  using
straints 
some training examples  the challenge in buildin robust production optimization  we want to
ing a proxy model is using finding good trainmaximize e j u  m    where
ing examples  in this work  after optimizing the
proxy model  new training examples are generne
  x
ated around the current optimal point  and a
e j u  m    
j u  mj   
   
ne
new proxy model is built and the procedure is
j  
repeated  an example is presented that shows
the efficiency of kernel k medoids clustering and where m denotes a realization of the reservoir
building proxy models for production optimiza  model  and j u  mj   denotes the corresponding
tion 
npv 
 

fi 

model selection for reducing number strategy  at this stage  as we are only interested
in calculating a dissimilarity distance  the reof realizations
a simple way to reduce the computational cost 
is to select a few statistically representative models in the ensemble  these representative models
are selected based on ranking or clustering some
attributes  a random selection of the realizations will not provide a representative set for the
ensemble 
wang et al         used k means clustering
for selecting a set of representative realizations
from a large ensemble of models in field development optimization  the attributes they used for
clustering are ooip  normalized cumulative oil
production  permeability distance  and oil water
contact depth  they applied k means clustering
to obtain a number of clusters  and then one realization was chosen randomly from each cluster 
scheidt and caers        developed an effective
model selection method using kernel k means
clustering in metric space  in this method  after
obtaining the clusters  the model nearest to the
centroid of that cluster  the medoid  is chosen 
in this work  kernel k medoids clustering is
used  where the models are divided into some
clusters and the robust production optimization
is applied on the reduced ensemble which contains the models corresponding to the clusters
centroids  as the center of each cluster represents all the models in that cluster  a weight is
assigned to each centroid  finally  the weighted
expectation of npv of the centroids of the clusters is maximized 
maximize

nk
  x
j j u  mj   yj   
ne

sponses can be obtained from a rank preserving
proxy type simulator  e g  the streamline simulator  and need not be the exact simulator 

building fast proxy models
in this work  we use ann and svr to build fast
proxy models  one challenge in building a fast
proxy  is finding good training examples  note
that the input space  well controls  is very highdimensional and continuous  hence  a randomly
generation of a few training examples may not
be very efficient 

support vector regression as a proxy
svr is a regression model that can be trained
to make predictions of output of a function for a
given vector of input features  the general idea
of svr is to perform linear regression in a high
dimensional feature space by using kernel trick
 b  scholkopf and bartlett         in this work
we use a svr software  chang and lin        
it is worthwhile to mention that for using the
svr  all the input features should be scaled to be
between   and    same is about the output value 
hence  here all the well controls  input features 
are scaled to be in         while the output values
  npv   are also scaled to be in         in  svr 
there are two important parameters that affect
the efficiency of the algorithm  which are  and
c  in addition  the number of training examples
used also affects the predictions 

   

j  

where nk denotes the number of clusters  with
nj representing number of realizations in the jth
cluster  j   nj is set as the weight of the jth
centroid in the objective function of the subproblem 
in this work  the field cumulative oil and water production and the field cumulative water injection in time are used to construct a response
vector for each realization 
to obtain the response vectors  all realizations
are ran with the simulator using the same control

artificial neural network as a proxy
artificial neural network  ann  is a popular machine learning algorithm inspired by biological
neural network  a neural network consists of
input nodes  output nodes and interconnected
groups of artificial neurons  in this work  we use
the neural network toolbox of matlab  the
idea is to build a ann proxy of some training
examples  and then optimize the ann model
rather than the computationally demanding fullphysics model 

fi 
 p 

 i 

y

  
  

   

  

    

  

p  

  

 p 

 p 

p  

  
 p 

 i 

p  

 

 

 p 

 p 

p  

 i 

 

  

  
x

p  

  

  

    

 a  true porosity field

 
 

  
   

 p 

 

   

 

 

  

    

  

 

x   

 
 

  

   

y

  

 

 

 p 
 i 

 

  

  
x

p  

  

  

 
 

 b  true ln k  field

 
 
 
 
 

x   

   
   

 

 

 

 

 a  original space

 

 

x   

   

 
     

 b  kernel space

figure    true porosity and log permeability fields  figure    mds plot of     realizations with  
clusters and their centroids 

example
  

kernel clustering
fig    shows the mds plot and the points for
each of the   clusters  in uncertainty assessment
of production optimization  capturing p    p  
and p   of the uncertain npv distribution is
very important  as one can see in fig    a   we
could achieve this goal by using only   clusters 
fig    b  shows the p    p   and p   of the optimal npv obtained by maximizing the expectation of npv of cluster centroids  the optimization was performed by first generating an ann
model and then optimizing the ann model using pattern search algorithm  will be discussed
later   we ran all the models with the optimal

npv vs time steps

 

 
 
time steps

  
npv  

this example pertains to a two dimensional horizontal reservoir model with      uniform grid 
true porosity and log permeability fields with
well locations are shown in fig    
there are   producers and   injectors in this
reservoir  ne       realizations of both porosity and log permeability are generated using geostatistics and then conditioned to     days of
production history using truncated svd parameterization  gharib shirangi         production
optimization is performed for the time interval
of     to      days 
the objective is first to reduce the number
of realizations in robust optimization to significantly reduce the computational costs while obtaining nearly the same final expected npv and
characterization of uncertainty in the expected
npv  second objective is to test the efficiency
of using svr and ann in building fast proxy
models in production optimization 

 

x   

 
 
 

 

figure    npv values in time for     realizations
colored for different clusters  markers
show the curves of the cluster centroids 
solution  and plotted the corresponding p    p  
and p    as one can see  p   and p   values for
the exhaustive set at the final time are in good
agreement with those from the cluster centroids 
this is of significant importance  fig    shows
the unoptimized npv  from initial guess  of all
realizations versus time  colored based on clusters 

building fast proxy models
we first perform a sensitivity study on parameters of svr   c and     to do so  we generate
    training examples  by randomly perturbing
the control vector around the mean  out of these
training examples  we set the last     points as
testing set  fig   shows the sensitivity of svr
to parameters c    and number of training examples  as can be seen  svr has small testing
error even for small number of training examples 
in addition  a larger value of c and a smaller 
provides smaller testing error 

fi 

  

p    p    p   from exhaustive set  and clsuter centroids
 
x   
exhaustive set
cluster centeroids

testing error of epsilonsvr for epsilon    
    
     

 
 
 
 
 
 

 

     
     
     
    

 

 

 

 
time step

 

 

 

 

       
  

 a  initial npv

 

  

    

 

     

   
 
   

 

 

 
time step

 

 

 

  

     
     
     

  of te   
  of te    
  of te    

    
 

 

error of epsilonsvr for c  

   

 
 

 

  
  
parameter c  cost 

 a  sensitivity to c

p    p    p   from exhaustive set  and clsuter centroids
 
x   
exhaustive set
cluster centeroids

relative error

p    p    p   of npv distribution

  of te   
  of te    
  of te    

 

relative error

p    p    p   of npv distribution

  

 

 

 b  optimized npv

       
  

 

  

 

  
parameter 

 

  

 

  

 b  sensitivity to 
error of epsilonsvr for        c  
   
    
relative error

figure    p    p   and p   of all     realizations and those calculated using only
cluster centroids for the initial npv 
and optimal npv 

    
    

next  we build a proxy model from a number
    
of training examples  then we optimize the svr
 
 
   
   
   
   
   
model using pattern search  ps  optimization alnumber of training examples
gorithm  depending on how many training ex c  number of training examples
amples we use in generating the svr model  the
solution from optimizing svr can be different 
figure    sensitivity of svr  testing error  with refig    shows how the optimal npv changes by inspect to parameters 
creasing the number of training examples  fig   
shows the results of directly optimizing npv using pattern search algorithm  while directly opx   
timizing npv takes about     function evalua   
optimal value from svr model
corresponding true value
tions  we could obtain the same optimal npv
   
by optimizing an svr model trained with about
   
    function evaluations  hence svr can pro   
vide significant computational saving in produc   
tion optimization 
npv    

 

   

next we use ann as a proxy  we use   hid   
 
   
   
   
   
   
den layer with    artificial neurons  increasing
number of training examples simulation runs 
the number of hidden layers or neurons didnot
have a significant effect on the efficiency of ann figure    change of optimal npv from optimizing
svr with number of training examples 
model  here  we use an adaptive strategy for
generating training examples  we first gener 

fi 
 

 

patternsearch to directly optimize npv

x   

    

npv  

npv increased
from        e    
to        e    
cost      simulation runs

   

  of simulations
npv

 
 

  

  

  

  

   

   

 
   

figure    directly optimizing npv using pattern
search algorithm  without a proxy model  
left axis shows  npv while right axis
shows the number of function evaluations
 

x   

patternsearch to optimize ann
npv increased
from        e    
to        e    
cost     simulation runs

npv

  
   

 
 

 

 

 

patternsearch iteration

 

  of simulation runs

 

 
 

the examples here  we showed that optimizing
the mean npv of only cluster centroids  would
optimize the p   and p   of the entire set of
models  and the p   and p   of the cluster centroids at optimal solution are in close agreement
with those of the exhaustive set 
water flood optimization under geological uncertainty  even over a few representative realizations  can be computationally expensive  in
this project  support vector regression and artificial neural network was applied to build proxy
models to use in production optimization  both
svr and ann provided significant computational savings  compared to optimizing without
using a proxy model 

references
b  scholkopf  r  c  w   a  j  smola and
p  l  bartlett        new support vector algorithms  neural computation               

figure    optimizing ann proxy of npv using pat  chang  c  c  and c  j  lin        libsvm 
tern search algorithm  left axis shows a library for support vector machines  acm
npv while right axis shows the number
transactions on intelligent systems and techof function evaluations
nology               
ate a few training examples  and we optimize gharib shirangi  m         history matching
the ann model  having obtained the optimal
production data with truncated svd parampoint  we run the simulator with the new point 
eterization  masters thesis  the university of
and generate new training examples around the
tulsa 
current point either by randomly perturbing the
current point or by polling in different directions scheidt  c  and j  caers        representing spatial uncertainty using distances and kernels 
around the current point  fig    shows the remathematical geosciences                
sults of using ann as a proxy  according to the
results of this figure  with only    function eval  wang  h   d  echeverra ciaurri  l  durlofsky 
uations  the npv increased to about the value
and a  cominelli        optimal well placeobtained by directly optimizing npv 
ment under uncertainty using a retrospective
optimization framework  spe journal        
       
conclusions
in this work  unsupervised learning algorithm
is applied to the robust production optimization problem to choose a set of representative
realizations  kernel clustering technique applied
to npv curves  provided a set of representative
models that capture the uncertainty in the response of the entire set of models  at least for

fi