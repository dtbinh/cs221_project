detecting absorption of solar radiation by clouds
with satellite imagery processing
liuchenghang leon  zhu changyeon jo
december         
abstract
solar irradiance data are crucial to pv system
performance analysis  although lightmeters  or
pyranometers  have been applied in utility level
solar farms  they are not economically feasible for commercial residential level solar sites 
publicly accessible data  such as meteorological
satellite imagery  are potentially an ideal source
to meet the emerging demand  this research
applied satellite imagery processing and supervised learning algorithms to classify quantity
cloud absorption  and thereby predict solar irradiance 

when passing through the atmosphere  part of
sunlight will be absorbed by clouds  we denote
the absorbed fraction as cloud factor cf   then
we have ghiground   ghics     cf    thus 
our goal is to model cf with satellite data 
on the one hand  by re writing the above equation as cf     ghiground  ghics   we show
how to obtain real cf as target values  y  
on the other hand  we predict cf as cf  
h imagep ixels  weatherp arameters 
figure    calibrated clear sky model

prior work
in the past two decades  researches have been
conducted on solving the satellite to radiance
problem both commercially and academically 
the handful published researches are either
based on data feed intensive physical models or
simple statistical models  and presented high
variance  hourly bias            hourly variance
         polo et         also  the commercial
models are kept confidential to the public  this
study aimed to apply machine learning classification and regression algorithms to explore and
improve analytic approaches to solve this probdata processing
lem 
ghiground were collected by lightmeters at university of nevada and nevada power clark staintroduction
the solar irradiance that reaches the top of tion  nevada  hauwitz model        was apearth atmosphere is fairly deterministic and can plied to model ghics   we found it tended to
be modeled by several mature models  matthew underestimate clear sky irradiance after checket al          we name it as clear sky ir  ing it with ground measurement we observed
model expression 
radiance ics  here our target irradiance type ghimodel   measure  
     
  where
is global horizontal irradiance  ghi   w m     ghics         cos z   exp  cos z 
 

fiz is the solar zenith angle  we adjusted the
baseline by keeping its model structure while
linear regressing it so that it selectively fitted
clear sky like points while made nearly all the
other points below the modeled results  shown
fig    log ghics     log a    b  log cos z    

figure    infrared   visible

c
cos z 

satellite images of multiple bands  visible  infrared  near infrared  ice and water vapor  were
collected from the national center of atmospheric research  they maintain a weekly
archive of hourly observations  we kept track
of images for   months  we first geo referenced
raw images with arcgis r   so that we could
query pixel locations  column  row  by geographical locations  latitude  longitude     neighboring pixels  along with the central pinpoint  were
extracted and averaged as our raw pixel data for
each band the weather station data were collected from noaas hourly sub hourly observational data 

classes  while we only classifyed the noisy portion as heavy  cf        and lighttomedium
 cf       two classes 
we applied svm and gaussian naive bayes to
classify the dataset  for svm  feature scaling
was critical for successful classification  since
its a distance based classifier  features with high
magnitudes tend to be biased  in addition  according to perez et al        all pixel values were
corrected with hourly solar zenith angle  normalized by cos zen    navie bayes was sensitive to
feature distribution  a feature clg  cloud ceiling  belonging to weather station observations 
is a binary like random variable  its high value
is exclusively     while other values randomly
spread out between   and      based on its
physical meaning  clg would be indicative in
cloud cover classification and it did work well
for svm  but poorly for naive bayes  due to its
non gaussian distribution  the results were presented in table    the sample counts of dierent classes were based on the whole dataset  but
the training and testing was based on a     vs
    random split  all features  scaled to   to   
were used in svm  selected features  not scaled 
for naive bayes   visible  infrared  water vapor 
temperature  dew point  pressure 

classfication although our ultimate goal was
to quantify cloud cover or solar irradiance  we
found a simple linear regression of raw pixel
data wouldnt work  therefore  we started
to classify the clouds to see if it would facilitate quantification  or hopefully if a granular
multi class classification could proximate a quantification  the features were listed as  pixelintensities  visible  infrared  water vapor  ice 
near infrared red   near infrared green   nearinfrared blue    station data  temperature  dew
point  cloud ceiling  pressure  windspeed   

unlike expected  there seemed to be only   distinct classes  light cf         medium cf    
     and heavy  cf        clouds  as shown in
fig   in addition  classifiers had difficulty classifying points with visible pixel intensity         
out of      samples   near the lower bound  imagery noises posed significant impacts on distinguishability  our solution was classifying samples with visible pixel values      and the rest
separately  for the non noisy portion of samples  regression
we classified them as the previously mentioned   perez et al        proposed a non linear relation
 

ficlass
count
svm score
nb score

table   
scores

vis     
lighttomid heavy
   
  
     
     

light
   

vis   
mid heavy
   
  
     
     

corr
mbe
mbe   
rmse
rmse   

full freedom
     
     
     
     
     

perez
     
    
    
     
     

two step
     
    
    
     
     

classification and cross validation
table    cross validation of three regression
approaches

between ghi and cloud index ci   which performed generally well for pixel to irrdiance quantification 
ghi   k  ghics        k  ghics       
with k       ci  
   ci         ci  
 
    ci
    ci    

and irradiance dependent  which explains why
we previously werent able to fit cf simply based
cloud informations  pixel intensities  
perez is credited for the found of this empirical quadratic relation  though we feel sceptic
about the model parameterization  as long
as ghi   hg  k  ghics   is not strictly derived from physics  its parameters can actually
be fitted too  eort had been paid mainly
to engineer cloud features while leaving this
quadratic function untrained  our idea is that
we can simultaneously train the two equations
in a more balanced manner  firstly  a simple approach is to plug k   hk  ci  into
hg   expand the equation and fit all the coefficients  specifically  assuming the intercepts
are unfixed  we can expand the overall model
  ci      a ghi   ci    
as ghi   a   ghics
 
cs
 
    b ghi
 
      a  ghics ci   a  ghics
 
cs ci  
b  ghics ci           b  ghics ci   b  ghics   c
now we have    features and    coefficients  one
intercept  for linear regression 

in perezs model  cloud index was not the
same as the cloud absorption factor  cf  in
our study of classification  ci was simply a
normalized value of visible band pixel intensity
vismax
 ci   visvis
   the quadratic function
max vismin
ghi   hg  k  ghics   was assumed with fixed
parameters  while the coefficients of the polynomial function k   hk  ci  came from fitting 
these were given without further explanation
in the publication  to infer its rationality  we
derived cf from perezs model 
ghi
cf     ghi
    k       k  ghics  
cs
            k       k    ghics
as we can see  k was probably defined to describe cloud transmittance  if we plug in a very
low ghics   then cf will get close to      k 
and if we increase the coefficient of k from     to
   we will get cf    k  in this case  k will
exactly represent the fraction of light that passes
through the cloud  namely ghi   k  ghics
thus  fitting k verses ci is equivalent to fitting cf verses ci  or generally  features generated from pixel intensity   interestingly  perezs
model indicates that this only holds at low irradiance level  as we have higher values of irradiance  cf will not be linearly correlated with k 
due to the significant eects from the quadratic
term associated with ghics   physically  it
means cloud absorption fraction is both cloud

two step regression
if the empirical equations bear some unrecognized physical meanings  we should expand the
hypothesis set more cautiously  for example 
when constructing the function k ci   perez
had probably taken into account that k ci   
should equal    and hence made the intercept
fixed  if we arbitrarily unlock dimensions of freedom for a simple linear regression  we wont have
clear idea what physical bounds might be missing  here  the problem really is we want of fit
the quadratic function  but at the meantime  we
dont want to unlock other   extra dimensions of
 

fia
b
corr
mbe
mbe   
rmse
rmse   

freedom  in concern of over fitting 
we experimented with a two step linearregression approach  loop until converge
  g step 
 
 
with k  i 
 
g  ci  i    g  ci  i   
 
 
g  ci  i    g  ci  i    g  ci  i    fit ghi  i   
 i 
 i 
a k  i  ghics      b k  i  ghics   
k step 
with k  i   

b 

p

b   a c ghi  i   
 i 

 aghics
 
 i 
ci
  g

     
   
     
     
    
     
     

    
   
     
     
     
      
     

      
    
     
     
    
      
     

      
     
     
     
     
      
     

table    changing parameters of perez model
cient  root mean square error  w m     mean
bias error  w m     respectively  rmse    and
mbe    were also normalized by the mean irradiance value to percentages  three models all
had good performance  two step regression performed no better than perezs model  this indicated that perez made an excellent estimate
of the quadratic coefficients  the quadratic parameters optimized by the two step model were
a         b       which were of the same magnitudes of perezs  a           b          weve
also experimented changing a and b of perezs
model and found the magnitudes really mattered  shown in table    therefore  the two step
regression can be seen as a validation of perezs
quadratic parameterization 

 
 

      
   
     
    
    
     
     

 

 i    g ci  i   
fit k  i    g 
  ci
 
 
 i 
 i 
g  ci
  g  ci  
the adjustable parameters were a  b in hg  k 
ghics   and the other   linear coefficients in
hk  ci   also  we fixed the intercepts of the two
linear regressors as   and    respectively  by
doing so  we only unlocked two dimensions of
freedom  a and b  that we were interested in 
while strictly keeping other model structure unchanged  mathematically  this algorithm is not
guaranteed to converge  in addition  two possible roots of the quadratic equation makes k step
ambiguous  however  lets think about the physical bounds of our satellite to irradiance problem  k was constructed to describe cloud transmittance factor  with a range of        clear skyirradiance ghics is a positive value  or     so
is the real irradiance ghi we have to pay attention  since measurement noise and baseline shifting may result in negative values   thus  as one
of the quadratic solution  our k  ghics should
theoretically be non negative  at the mean time 
according to the equation  the sign of the two
roots depends on ghi which is negative or
zero  then well always have a positive root  if
not zero   if the data is of good quality  and
given the system is self consistent  this approach
is likely to work  all the coefficients of hg was
initialized as   

classification linear regression
as we have discussed  we were able to classify
clouds as three classes in terms of their absorption factors  we were interested in exploring how
well each class of clouds was regressed by the
model  as shown in fig   and    we believed it
necessary to perform regression separately for  
classes  the training results were presented in
table   

we constructed an integrated model with a combination of classification and regression  shown
in fig    a comparative cross validation was performed on our model and perezs  one dataset
was randomly split as     and     to train
and test both models  the results were shown
in table    as we can see  with similar corthe results were presented in table   along with relation coefficients  the integrated model preother two regression approaches  where corr  sented significantly smaller bias and variance
rmse and mbe stand for correlation coeffi  than perezs 
 

fifigure    a universal regression on   classes

class
corr
mbe
mbe   
rmse
rmse   

l
     
    
    
     
    

one for all
m
h
     
     
      
      
              
     
     
     
      

l
     
    
    
     
    

sperate
m
h
           
     
     
     
     
     
    
     
    

table    regression training results
model
corr
mbe
mbe   
rmse
rmse   

integrated
     
    
    
     
    

perez
     
     
    
     
    

table    integrated model vs perez model
figure    separate regressions on   classes
model  we expect future works can be done on
validating the model with more data  especially
for more medium and heavy cloud conditions  for
they are not common in our current study site 
las vegas  in addition  this model can probably be extended to perform hour ahead forecast
of solar irradiance  which will benefit grid dispatching market in the near future  we would
like to acknowledge scikit learn for their powerful machine learning modules on python 
references
matthew j  reno  cliord w  hansen  joshua
s  stein        global horizontal irradiance
clear sky models  implementation and analysis

figure    model work flow

b  haurwitz        insolation in relation to
cloudiness and cloud density
jesus polo  luis f  zarzalejo and lourdes
ramrez        solar radiation derived from
satellite images

conclusion
in this study  we found that a   class classification facilitated cloud absorption quantification 
the parameterization of perezs model was validated by a two step regression  an integrated
classification regression model was developed to
solve the satellite to irradiance problem  and it
presented higher performance than the perezs

richard perez  pierre ineichen  kathy moore 
marek kmiecik  cyril chain  ray george and
frank vignola       
a new operational
satellite to irradiance model description and
validation
 

fi