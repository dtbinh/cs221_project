 

machine learning and capri  a commuter incentive
program
hossein karkeh abadi  jia shuo tom yue
stanford center for societal networks  https   scsn stanford edu 

i  i ntroduction
societal problems  such as peak hour congestion  over usage
of water  and power shortages  have become more frequent
and pronounced in the last decade  fortunately  technology
can now aid in the search for solutions of such problems 
capri   short for congestion and parking relief incentives 
is a program currently underway at stanford  which seeks to
demonstrate that technology can be used to reduce peak hour
congestion in a large urban area 
a  background  traffic congestion at stanford
stanford is one of the largest employers in the county
of santa clara  during morning and afternoon peak hours 
traffic in and out of the main stanford campus have caused
congestion on major thoroughfares in the surrounding cities
 such as el camino real and page mill road   in the fall
of       stanford established a general use permit with the
county  specifying the conditions under which stanford will
be allowed to begin new constructions     per the agreement 
stanford needs to control the amount of peak hour traffic
in and out of the campus in the mornings and evenings    
capri is a program started by the stanford center for societal
networks  aimed at incentivizing daily commuters to drive
into and out of the campus at off peak hours  thereby relieving
traffic pressure during peak hours and helping stanford comply
with the gup 
b  capri
capri leverages rfid technology to provide commuters
with near instantaneous feedback on their driving behavior  a
capri user is given a rfid tag to apply onto her windshield 
each of the users commutes is captured by a rfid tag
scanner when the user drives through one of the    predefined
entrances exits around the stanford campus  if the commutes
capture time is within the off peak period     am      am
for inbound commutes     pm     pm for outbound commutes   the user is rewarded with credits  these credits can
be deterministically or probabilistically redeemed for cash 
paid out monthly 
as of november       capri has been in operation for  
months  we have registered over      stanford commuters 
    of whom have taken at least one trip with a capri rfid
tag  capri has captured over         commutes and paid out
over         
  https   stanfordcapri org 
  http   scsn stanford edu 

c  machine learning opportunities
capri has copious amounts of commute data  by using
machine learning  we are able to understand behaviors and
changes in stanfords commuting population  we are also able
to use machine learning to provide guidance for improving
capris incentives to better target this population  in this
report  we focus our attention on two applications of machine
learning 
 improving capri trip scanning accuracy  rfid tags can
experience wear and tear  improper installations  bending 
etc  will also cause the tags to degrade  a degraded tag
may only scan sporadically or not at all  when a user is
not credited for an eligible commute  the capri team has
to re issue a new tag and add missed commutes  for this
reason  it is desired to have a system that would detect
when the user is likely to have had a uncredited commute 
 carpool matching  until now  there has been no easy way
for commuters who live in the same area to discover each
other and to form carpool partnerships  however  capri
can be used to group participants who live in the same
area  facilitating carpool matching 
ii  b uilding a commuter model
we wish to build a model to characterize the commute
behaviour of each user  to do this  we have taken anonymous
data from capris database of commutes  each item consists
of the following attributes 
 anonymous user id  used to aggregate all commutes
belonging to a certain user  the id cannot be used to
reveal the identity of the user 
 commute time 
 location  specific entrance exit used for the commute 
figure   shows the locations defined for capri 
a  commute model
we start by making the following assumptions 
   each user may have different driving times on different
days of the week  for example  a student may arrive
early on monday and wednesday for her cs    class 
but later on other days 
   on the same day of the week  the user sticks to roughly
the same schedule  this might change between quarters 
which would necessitate re building the model for each
academic quarter 

fi 

figure   

large variances in user  s models  versus the very small
variances user  s models 
 users keep different schedules for different days of the
week  for example  user   arrives after  pm and leaves
after  pm on tuesdays  thursdays and fridays  but arrive
before  pm and leave before  pm on wednesdays 
 capri is effective in incentivizing users to avoid commuting into out of campus during peak hours  shaded in grey 
user    when unable to enter the campus at her dominant
time  still strives to avoid the peak hours by moving an
hour before or after 
however  this model does not take into consideration transient
occurences  for example  construction on junipero serra blvd 
may delay traffic in the area by up to    minutes on nov   
we create a different model  called day model  to deal with
such events 

capri rfid scanner locations 

b  day model
based on these two assumptions  for each commuter  we need
to build    models  for each day d of the week     d     
two models are necessary  one corresponding to the morning
commute  t       and the other corresponding to the afternoon
commute  t       we call each model a commute model 
denoted cmd t  
furthermore  the user may prefer to drive through different
locations  therefore  we use gaussian discriminant analysis
to arrive at a model for each commute  let the samples be
   
 m 
xd t        xd t   corresponding to the commute times of all
the commutes taken by the commuter on a certain day d of
the week and a certain time of day t  the target variables
   
 m 
yd t        yd t label the locations used for each commute 
taking integer values between   and     let
m
o
  x n  j 
cm d t i   p r yd t   i   
  yd t   i
m j  
be the probability of the user taking location i  for each
location  we model the commutes
via a gaussian
random


 
variable xd t  yd t   i  n cm d t i   cm d t i
  defined by 
  j 
   j 
  i xd t
j     y

 
pm
 j    i
j     y
  j 
 
pm
  i x j  
j     y

 
pm
 j    i
j     y
pm
cm d t i
 
cm d t i

 

 

i

 
 

now  if a commute is not recorded on a certain day d at a
certain time t  the most likely location i and time x for her
commute is given by
i

 

arg max p r yd 
 t   i    arg max cm d 
 t i

x

 

arg max p x yd 
 t   i    cm d 
 t i  

i

the day model dmr t captures the distribution of commutes
on a certain date r  at a certain time t  morning or afternoon 
over all locations   we do not have enough data to create
separate models for each location on a certain day   we quickly
see that modelling the commutes for a day model using one
gaussian rv is insufficient  instead  we consider a gaussian
mixture model with three gaussians  describing 
 commuters who tend to commute prior to the peak hour 
 commuters who tend to commute during the peak hour 
 commuters who tend to commute after the peak hour 
we use the matlab gmdistribution fit function to
arrive at these models  each dmr t is described by   variables 
 
for    g     dm r t g   dm r t g
and dm r t g are the
mean  the variance  and the mixture ratio of gaussian g 
respectively  wlog  assume that dm r t     dm r t    
dm r t     see figure   for an example of the gaussian
mixture trained 
we also create an all days model that captures the distribution of all commutes on all dates at a certain time of
day t  admt   combined  these two sets of models give us
information about transient events occuring on certain dates
that will influence our predictions  admt is described by  
 
variables adm t g   adm t g
and adm t g as defined above 
see figure   for the admt gaussians trained 
we see that the three gaussians assumption is largely
correct  for morning commutes  a significant number of commuters arrive in the morning prior to the peak hour  the
gaussian corresponding to this set of commutes has a large
mixture percentage  peak hour commutes in the morning are
reduced  this effect is less pronounced in afternoon commutes 
we elaborate on possible reasons in section     

i

x

we illustrate these models for three particular users in
figure    we can discern certain trends  and confirm our
assumptions about commuting behaviour 
 some users have a large variance in arrival time  while
others keep very tight schedules  this can be seen by the

c  morning evening correlations
we further note that a commuters morning and afternoon
commutes are correlated when she enters the campus prior
to  am  and leaves prior to  pm  as shown in figure   
however  there is very weak correlation between entrance time
and departure time at other times of the day  therefore  we

fi 

figure    models created   a  user models for three users  for each day of the week and each time of the day  the most likely location is used and the time
distribution for that location is shown   b  day model for october           c  all days model 

  
   

r and time of day t  morning afternoon  via the following
algorithm 

  
  
  



afternoon

  
  
  
  

  

  



  
  
  
 

 

 

  



morning

figure    density of morning afternoon trip pairs  darker regions indicate
more commuters making both morning and afternoon trips in the same day 


do not consider morning and evening commutes times to be
correlated  and we do not use this information in our models 

iii  a pplication   p redicting commute times
a straightforward application of the model is to predict
commute times for missed commutes 
a  model based prediction
to predict a users commute time  we combine information
given by the commute model and the day model  for a user 
we predict her commute time and location for particular date

let i   arg maxi cm d 
 t i be the most likely location the
user commuted through  where d is the day of the week
corresponding to r  use cm d 
 t i as a rough estimate of
the users commute time 


let g   arg maxg adm t g padm t g cm d 
 t i be the
most likely gaussian corresponding to the users rough
estimate commute time 
consider the day model dmr t   this is the day model
describing the overall commute condition on date r and
time of day t  let d   dm r t g  adm t g   d describes
the delay  or anti delay  caused by external factors on
date r 
then we estimate the commute time for the user to be
x   cm d 
 t i   d 

b  results
we train the model described in section   with capri
commute data taken between june   and oct     a randomly
chosen subset is withheld for testing  the error historgram is
reported in figure    the error for each prediction is calculated
as    xestimated  xactual   we report the mean  variance
and absolute mean of the errors  calculated for all commutes 
morning commutes and afternoon commutes  these figures are
given in table i 

fi 

 k 

cm d t
 k 

 
cm d t

 
 

  
x
i  
  
x

 k 

 k 

cm d t i cm d t i
 k 

 k 

 
cm d t i cm d t i
 

i  
 i j 

pd t m

   
  
x


  
 
 k 
 k 
 k 
cm d t i cm d t i  cm d t

   

i  

fi
fi

fi  i 
fi
 j 
  p r fitcm d t  tcm d t fi   m


 i 
 j 
  p r m   tcm d t  tcm d t   m




 i 
 j 
 i 
 j 
m   cm d t  cm d t  
m   cm d t  cm d t  
  q q
 
  q q
  i 
  j 
  i 
  j 
cm d t
  cm d t
cm d t
  cm d t

   

equations used for carpool matching 

morning trips

   

   

   

   
   

frequency

 

   

   
   
   

 
 

figure   

afternoon trips

 

frequency

frequency

all trips
 

 
testing error  hours 

 

 
 

   
   
   

 
testing error  hours 

 

 
 

 
testing error  hours 

 

prediction results 

trips
all
morning
afternoon

mean
    
     
     

st  dev 
     
     
     

abs  mean
     
    
     

table i
p rediction errors in minutes  

the results show that the morning estimates are more
consistent and accurate  this is in line with our expectations  as morning commute times are largely dictated by
class and work schedules  and commuters tend to follow
roughly the same schedule on a day to day basis  however 
afternoon commute times are dictated by more factors  such
as after work activities  therefore  afternoon commute times
are more variable and less schedule based  prediction failures
 instances where the predicted commute time differs from
actual commute time by a significant amount  are largely due
to commuters deviating from their normal schedule  and are
more pronounced in the afternoon 
iv  c arpool matching
capri may introduce additional incentives whereby carpool
drivers are incentivized differently than single drivers  for
this reason  it may be useful for capri to match drivers in
the database to form carpool partners  to perform carpool
matching  we consider the zipcodes provided by users when

figure   

top    zipcodes of capri participants 

they register  figure   shows the top    zipcodes of capri
participants 
we use the models created to estimate the probability
that two users who reside in a same zipcode may want to
commute together on a given day of the week  suppose
ck   k           k  represent the commuters of a certain
 k 
 k 
  k 
zipcode  and cm d t i   cm d t i and cm d t i
are their
corresponding parameters as estimated by the model  in our
new model  we assume that the carpool partnerships are not
affected by the difference of entrance exit locations used by
commuters  in practice  this is valid as entrance exit locations

fi 

figure    carpool matching results for zipcode         a  number of pairs as a function of mthr with pthr         b  number of pairs as a function of
pthr with mthr      minutes   c  sample matchings with pthr       and mthr      minutes 

are strongly correlated with zipcodes  we define new random
 k 
variables tcm d t as the entrance exit time of commuter ck
on a certain day d of the week and a certain direction t 
 k 
furthermore  we assume that variables tcm d t are gaussian
 k 
 k 
 k 
 
with
 mean cm d t   and variance cm d t   i e  tcm d t 
 k 

the same approach can be done on evening commutes to
estimate the empirical distribution of exit times  so  in this
model the feature vectors are    dimensional  if we feed these
features as the input to the k means algorithm  then for k    
the result is shown in table ii 

 k 

 
n cm d t   cm d t
  using our previous model parameters 
 k 

 k 

 
the values of cm d t and cm d t
can be computed by
equations     and      derived from the law of conditional
variances  for each day d of the week and direction t we
 i j 
can estimate the probability pd t m that two users ci and cj
commute within m minutes of each other by equation     
we suggest two commuters to carpool on day d of the
week if for a certain threshold mthr   the calculated probability
 i j 
pd t mthr exceeds a certain probability threshold pthr for both
morning and evening commutes  figure   shows the number
of pairs of commuters for zipcode       who could become
carpool partners according to our carpool matching method 
and a sample carpool matching done for this zipcode on
mondays with thresholds mthr      minutes and pthr       
we are able to identify a few potential pairs of carpool
partners  furthermore  there is one well connected sub graph 
suggesting that a few commuters could benefit from vanpooling 

v  other models   k  means clustering
registered commuters can be classified into four different
groups according to their affiliations with stanford  faculties 
staffs  students and others  it would be beneficial to classify
commuters using an unsupervised learning method such as
k means  in order to employ k means algorithm  we first
estimate the empirical distributions for both entrance exit times
for each commuter and then feed them to the algorithm as
features  let the samples x           x m  be the entrance times
of all the morning commutes taken by a certain commuter 
in our model we break down the time interval     am into
half hour time slots  ti for i                and estimate the
empirical distributions of entrance time as
m

o
  x n  j 
p r t  ti    
  x  ti  
m j  

faculty
staff
students
others

cluster  
   
   
  
   

cluster  
   
   
   
   

table ii
  c lusters vs affiliations  

although this clustering algorithm put most of the students
in one cluster  students are more likely to enter the campus
after  am   both clusters have a remarkable number of staff
members  we repeated the algorithm for k     and k     but
again all the clusters contain commuters from all affiliations 
so  it seems that we dont have sufficient data to classify commuters  we need to add more features in our implementation
to get better results 
vi  c onclusions
we have created a model for commutes  using anonymous
data from the capri commutes database  we have been able
to predict commute times for missing commutes in this model
with a fair degree of accuracy  we also used this model to
create a carpooling recommendation system where commuters
in the same zipcode are matched based on commute behiavour 
and similar commuters are recommended as carpool partners 
we also attempted to classify commuters using an unsupervised algorithm with features generated from their commute
times  the results show that commute times alone are not
sufficient for generating accurate clusters 
r eferences
    stanford university general use permit conditions of approval  retrieved from http   gup stanford edu pdf final gup        pdf  nov
         
    stanford university parking and transportation services  frequently
asked questions  stanford and the gup  retrieved from http   transportation stanford edu pdf gup faqs pdf  nov          

fi