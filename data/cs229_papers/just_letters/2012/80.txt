cs   
c
final projeect
gesture recognitio
r
on and claassificatio
on using th
he microsooft kinectt
justtin huang

c
chun wei leee

junji ma
m

dept  of elecctrical engineeering
stanforrd university
jjhuang   stanford eddu

dept  off electrical engineering
staanford univerrsity
chunnweil stanforrd edu

deptt  of electrical engineering
stanford un
niversity
jjunjima stan
nford edu

ab
bstractin thiis report we detail a few machine learrning
meth
hods in which a system can
n learn to reco
ognize and claassify
hum
man gestures  our focus is primarily on
n hidden maarkov
mod
dels  and we disscuss the advan
ntages of using
g such a methood 

i  intro
oduction
the
t field of hhuman compuuter interface  hci  has inn the
past few decades made strides in making hu
uman control of a
comp
mputer system more convennient and more intuitive  f
from
starting with a keeyboard  the field
f
progresssed onto grapphical
user interfaces  g
gui   to the mouse 
m
to allow
wing the compputer
to un
nderstand speeech  the ideaa of allowing a computer syystem
to understand
u
huuman gesturees  however  has always been
difficult to reachh  due to thee sophistication in technoology
requ
uiredsuch aas fast processsing power and good caamera
systeems  in        microsoft corporation
c
lau
unched the k
kinect
systeem for the xbbox      whicch combines both
b
a stereosccopic
cameera  infrared ssensor and more
m
into a co
ompact devicee  but
moree importantly was availablee at an easily affordable pricce 

b  coding
c
enviro
onment
our
o algorithm
ms are primaarily coded in the mat
tlab
enviironment  alth
hough code to trigger the kinect
k
and inteerface
it wiith matlab is written in c
c  
iii  da
ataset
a  kinect
k
sensor capability
the
t kinects image proceessing power allows it to track
skeeleton for up to   users in front of it  bu
ut we will focuus on
the first
f
person beeing tracked  t
the sdk allows us to obtaiin the
doub
ble precision xyz coordiinates of the twenty key joint
poin
nts that make up
u the skeletonn 

figure    kiinect skeleton
n

f
figure    miicrosoft kinect
the
t kinect seerved as an innterpreter thatt translated huuman
gestu
ures into gaame commannds  although
h microsoft later
releaased the kineect sdk in early
e
      grranting develoopers
acceess to many off the kinects sensors  its gesture
g
recognnition
algorithms remainned proprietarry and hidden
n from the puublic 
thiss project is thuus an effort too implement a real time geesture
classsification systtem using thee kinect for data sensingg and
colleection 

b  data
d
collectio
on
using
u
these coordinates  w
we collected fo
our sets of datta for
each
h of our baseline gestures  w
with each of our team mem
mbers
perfforming     trraining exampples each  resulting in a totall of at
leastt     examples per gesturee  each training window laasts a
seco
ond  where thee kinect takess    frames worth
w
of data and
a in
whicch an individ
dual must beggin and finish
h the action in
i its
entirrety  in additiion  we recordded an additio
onal set of daata to
reprresent random
m noise  involvving lack of action
a
or a ranndom
flurrry of action  intended for use in evalu
uating our moodels
accu
uracies later on
n in validationn 

ii  projeect goals
our
o project aim
ms to exploree various learn
ning techniquees for
mod
deling human ggestures  withh the ultimate goal of beingg able
to trrain a real tim
me action classsifier  the cllassifier shoulld be
able to distinguishh between a geesture and notthing at all  ass well
as th
he distinguishiing between diifferent types of gestures 
a  baseline
b
gestuures
our
o baseline gestures are the followin
ng  punch  sw
wing 
wavee and slap  t
these are all actions
a
performable by a ssingle
hand
d  in our case  we focused on
o the right han
nd  
figuree    examples of baseline gestures
g

fisince
s
our gesstures mainly concern the movement o f the
rightt arm  we tookk only the xy
yz coordinatess of the head  sspine 
rightt hip  right elbbow  right wriist and right hand 
h
for a tottal of
   values 
v
thus  aan individual training
t
examp
ple vector is   x    
c  feature
f
extracction
when
w
deliberaating our feattures  we deteermined that m
much
of th
he body does not move when
w
performin
ng our designnated
actio
ons and ratherr only the righht hand does  thus  we deccided
to make
m
our featuures merely deependent on th
he relative possition
of ou
ur hand to ourr spine coordinnates  to com
mpensate for boodies
of diifferent staturees  we normallize  divide  th
hese values byy the
distaance between the head annd the spine points  usingg the
assumption that m
most of our useers have a fairlly consistent hheadbody
y arm ratio  t
thus our baseeline features are calculateed as
such
h 

figgure    selecteed feature po
oints


 


 


 

 

 

 


  

 

 

   
   
   

we
w also considdered several other featuress  such as the aangle
betw
ween hand andd elbow coordinates  as welll as the velociity of
the hand
h
coordinaate  though thee latter is theorretically accouunted
for in
n our time fram
ames 
iv  exploration of model options
p
before
b
implem
menting our syystem  we gav
ve consideratioon to
a few
w different tyypes of learninng techniques for distinguisshing
gestu
ures from one another basedd on our trainiing examples 
a  su
upport vectorr machine  sv
vm 
svms
s
were oone of the firsst tools we tu
urned to  givenn the
availlability of ooff the shelf libraries such
h as libsvm  our
proccedure was to ffirst calculate the above feaatures for all oof our
sequ
uences of dataa  these vectoors are then sh
huffled  beforre we
divid
de it up such tthat we have    
  training ex
xamples from each
set  reserving
r
the rremaining as the
t validation
n set  we then train
a mo
odel from ourr training matrrix and fit it over the test m
matrix
to deetermine the reecognition rate for each of our
o actions 
table
e i 
trrue
lab
bels

it
i would turn out that the ov
overall svm accuracy
a
was about
a
    
    which is pretty
p
good fo
for a first attem
mpt  althoughh it is
cleaar some actions are harder foor the system to detect  how
wever 
this changes wh
hen we introoduce the po
ossibility of false
posiitives 
ta
able ii 

svm
m gesture recoognition rates  w  false positiives 

trrue
la
abels

dete
tected actions
punch

slap

swing

wave

false

     

  

  

     

  

  

    

  

  

  

swing

    

     

     

    

     
 

wa
ave

     

  

   

  

     
 

fallse

     

  

     

     
 

     
 

pun
nch
sla
ap

the
t overall acccuracy in thiss latter case drropped to a         
ordinarily  one might
m
improvee the feature selection to boost
b
our score  howev
ver  we determ
mined that svm
ms were not worth
w
purssuing  due to their inabilityy to efficiently model the time
slicee nature of our problem  the svm models
m
our traaining
vecttors as is from
m start to end  but realisticallly the same action
a
may
y start in a laater frame andd end in an earlier frame   the
svm
ms lack of fleexibility in acccounting for th
his makes it a poor
cand
didate for mod
deling gesturees  in addition
n  the svm is good
for multi class classification 
c
however  n
no action is very
broaad and cannot possibly encaapsulate all po
ossibilities andd still
train
n a good and
d consistent m
model  what we require is
i the
mod
dels ability to
o default to nno action if a certain likeliihood
threshold for the action was not reached  rather than being
b
forced to choose one
o of k classees 
b  k means
k
clusttering
one
o other opttion we explor
ored was invesstigating whetther a
patteern existed in
n the sequencces of the geestures such that
t
a
clustering algorith
hm such as k  means could mark divisionns for
h class  due to the highh dimensionss of our traaining
each
exam
mples   x    after feature sselection   thee classificationn was
poorr and resulted in every singgle example beeing classifiedd as a
pun
nch  intuitiveely  it is under
erstandable thaat k means would
w
perfform horribly  due to it loooking at every
y single time slice
altog
gether at once  making it ratther inflexiblee 
v  hidden mark
kov model  h
hmm 
a  in
ntroduction to
o hmms

svm gestture recognitio
on rates
deteected actions

puncch

slaap

swin
ng

wave

    
 

  
 

  
 

  

  

     

  
 

  

figure    example of a hidden marrkov model

swiing

    
 

  
 

    
  

    

wa
ave

  

     

  
 

     

we
w ultimately
y settled on uttilizing hidden markov moodels 
a grraph based mo
odel which coonsiders a seq
quence of sym
mbols
emittted by true hiidden states inn time  criticaal to the hmm
m are
transitive probabilities  whichh determine how
h
likely a state
transitions to ano
other state  orr to itself   ass well as emiission

pun
nch
slap
p

fifigure     hidden markkov model of a gesture
as
a we have four baseline acctions  we corrrespondingly nneed
to traain four hmm
ms in which we
w can match our
o test gesturre
sequ
uences againstt and determinne the likelihood that our tesst
data occurs in the given modelss 
b  the
t baum wellch algorithm
while
w
we possess observaations emission in the form
m of
train
ning data  it iss rather difficuult as humanss to predict wh
what a
correesponding trannsition and orr emission probability matriix for
a ceertain type oof action is  fortunately  the baum w
welch
algorithm allows us to estimaate these parrameters given
en an
obseervation sequuence and random
r
initiaalized probabbility
matrrices  unfortun
unately  due too the presencee of local maxxima 
the methodology
m
of random innitialization does
d
influencee the
end result 
r
but wass not thoroughhly explored during
d
this proj
oject 
following
f
thee calculation of the pro
obability matrrices 
deterrmining the llikelihood of a sequence would
w
be a siimple
forw
ward algorithm
m tracing thhe steps of the sequenc e of
obseervations and ddetermining thhe most likely states             
c  codebook
c
of syymbols
to
t continue w
with hmms  our features need
n
to be fuurther
proccessed  our sim
mple hmms emit
e
discrete observations
o
oout of
a seet list of poossibilities  however 
h
ourr current feaatures
origiinate from a th
theoretically innfinite set of  d
  points  maaking
it ratther infeasiblee to capture inn an hmm em
mission probabbility
matrrix  to cope with this issuue  we introd
duce the idea of a
vocaabulary  or hm
mm codeboook  essentially
y  we segment
nt our
 d space into ddiscrete blockks  symbols   instead grouuping
poin
nts together  a
and the  d sppace is calculaated relativelyy and
norm
malized by thhe height of the person in
n the scene  this
allow
ws the hmm tto estimate thee probability that
t a symbol from
a sett vocabulary w
was observed 

the segmentation was donne in an arbiitrary matter but
b a
prefference to giv
ve greater resoolution to thee xy plane  rather
r
than
n to depth  sin
nce most of thhe baseline acctions span a wide
areaa at approxim
mately the sam
ame depth lev
vel  if settingg the
num
mber of symbo
ols to be     w
we would mak
ke   divisions each
alon
ng the x and y axis  but only
ly   divisions along
a
the z axxis 
d  model
m
classification threshhold
having
h
prepaared our dataa  we trained our five dattasets
 inclluding the noiisy action set   using baum welch to prooduce
five hmms  as mentioned
m
beffore  we prepaare our testingg data
in a similar manner  and then m
match the dataa to each of thee five
mod
dels to find th
he one that refflects the high
hest log likelihhood 
how
wever  it is nott adequate to ssimply pick th
he best modeel as a
resu
ult of that callculation  as tthis would fo
orce the systeem to
mak
ke a choice eveen if none of tthe actions weere good candiidates 
to deal
d with this  we set a thrreshold value that the likeliihood
scorres must surpaass before thee program eveen considers itt as a
bestt match candid
date     

figure
f
   systtem flow cha
art
vi  sim
mulation re
esults and analysis
we
w ran our verification
v
seet on the train
ned models  while
w
explloring the effeects of adjustiing the number of hidden states
s
as well
w as the num
mber of symbools  in search of
o an optimal value 
v
 

 

x   

    
  
    
loglikelihood

prob
babilities that dictate how liikely an obserrvation occurss at a
certaain state  while running thee model  the true state is hiidden
to uss  and only obbservations as a result of th
he state are shhown 
baseed on these oobservations  our system calculates
c
the loglikellihood of thee most likelyy true state and
a
the folloowing
sequ
uence  in our case  our obsservations aree the skeletonn key
poin
nts available tto us  the hidden
h
states are the posees or
postu
ures of the human user   and the seequence of sstates
consstitutes an action 

  
    

swing
wave
slap
punch

  
    
  
    
  

 

  

  

  

  
cycle

  

  

  

 
  

figure   
  hmm trainning likelihoo
od curves

figuure    segmentation of  d space
s

we
w observed
d that underr reasonable parameters   the
learn
ning curves generally
g
apppeared to have flattened ouut by
arou
und the   th cy
ycle of traininng  but would not truly convverge
until approximately    cycless  in the interest of timee  we
placced caps to stop training ite
terations upon
n     cycles  such
situaations imply a failure for thhe algorithm to
o converge at local
optima  but surprisingly  oft
ften the resu
ulting model still
capttures the desig
gnated action vvery well 
simulation
s
oftten yielded veery good results  for num states
s
    
   num symbo
ols       the same parameeter values foor the
curv
ves in figure    
  we achieveed the followin
ng 

fias
a expected  the training titime does app
pear to increasse for
morre states within
n the system  for very smaall number of states 
s
such
h as in the range of   too    however   the differennce is
neglligible enough
h that the com
mputation is co
omplete in rouughly
the same
s
amountss of time 

figure     g
gesture recoggnition by eacch classifier
table iii 

gestture recognitio
on rates  state
es     symbolss    

trrue
lab
bels

deteected actions
punch

slap

swing

wave

falsee

figu
ure     recog
gnition rate vss num  of stattes  symbols     

      

     

  

  

     
 

slap
p

  

      

  

  

     
 

swiing

  

  

      

  

     
 

wa
ave

  

  

  

      

     
 

falsse

      

      

     

      

      
 

the effect on
n accuracy byy the number of
o states is perrhaps
morre surprising  as
a expected  tthe improvem
ment in accuraacy as
num
mber of states increases staggnates  howev
ver  it appearss that
wheen the number is reduced to very small  our
o recognitionn rate
remains very hig
gh  all exceptt for the waave action which
w
drop
ps significan
ntly in loweer state num
mbers  eventtually
beco
oming confuseed for anotherr action  not sh
hown in figurres  
we believe that this coounter intuitive result caan be
partially explained by the fact tthat although we have  say   only
a sin
ngle state  wee have a lot oof symbols  we
w believe thaat our
fourr actions are different
d
enouugh that they do not have many
m
overrlapping or sh
hared symbolls  thus  durring the likeliihood
calculation  altho
ough the trannsition probab
bility is alwaays  
 onee state transitioning to itselff   the emissio
on probabilitiees for
each
h symbol can still be differrent  this allo
ows for the traained
mod
dels to classiify our validdation data based on emiission
prob
babilities alon
ne  the wavee accuracy th
hen dropped  likely
l
becaause it shared a few commoon symbols with
w another acction 
enou
ugh for it to be recognized m
more frequenttly as the otheer  in
pracctice  when th
his one state m
model was ap
pplied to our realtimee program  only
o
the puunch action was consisttently
deteected 
based on ou
ur data  we determined that the optiimum
num
mber of states for our particcular set of acttions is arounnd    
thiss is the point where
w
all of oour actions aree recognized fairly
f
welll  and our mod
dels are able tto distinguish the noise bettter as
welll  preventing more
m false possitives 

pun
nch

based
b
on thesse two charts  one can see that
t the designnated
actio
on is being rrecognized veery well by the
t corresponnding
hmm
m  with at leaast     recoggnition in everry single casee  for
the negative exaample  we seee that the reccognition is m
much
moree distributed between all the actions  with
w
none haaving
moree than     reecognition  whhich is good 
a  effect
ef
of numbber of states
it
i would be innteresting to observe
o
the efffect of numbber of
statees on our moddel results  onne might theo
orize that the m
more
hidd
den states therre are  the moddel should traain to be betteer  up
to a point wherre having tooo many statees might beccome
redu
undant if the action set is too basic  on
o the other hhand 
having too manny states may
m
slow do
own the traiining
signiificantly  duee to the extraa computation needed forr the
matrrices  converssely  having too few statees should maake it
difficult for the system to distinguish
d
beetween all off our
diffeerent actions  leading to mixed
m
up acccuracies  we first
explore the effect this number has
h on the train
ning runtime 

b  effect
e
of numb
ber of symbolss
in
i addition  we
w also perfo
formed a sweeep on number of
sym
mbols  from   
  to       keepping z segmeentation      and
a x
and y segmentatiions the same   such that x 
 y z   numbber of
sym
mbols  we peerformed a rruntime analy
ysis as well   but
surp
prisingly  the number
n
of sym
mbols seemed
d to have negliigible
impact on the runtime  and thuss the chart is not
n included 

figure
f
    traain time vs nuum  of states  symbols    
 
  

fic  additional
a
gesstures
to
t include mo
ore variety in our gesture liibrary  we inclluded
two more actions  a fist pump  and a circlee drawn in midair 
m
the fist pump is an action
on that mainlly only spanns ycoorrdinates  wherreas the circle spans both x and y at lenggth 
tab
ble iv 

gest
ture recognitio
on rates  state
es     symbols
s     

trrue
lab
bels
punch

slap

swinng

wave

fist

circle

false

     

 

 

 

    
 

 

    

sla
ap

 

     

 

 

 

 

    

swing

 

 

      

 

 

 

    

wa
ave

 

 

 

     

 

 

    

   

 

 

 

    
 

 

    

cirrcle

 

 

      

 

 

     

     

fallse

    

     

 

     

    
 

    

     

pun
nch

fig
gure     recoggnition rate vs
v num  of sym
mbols  states 
    
since a low
wer number of
o symbols equates to l ower
resolution in term
ms of our segm
mented  this would cause fe ature
poin
nts that may nnot originally be very similar to get clusttered
together  confusinng the model  indeed  figu
ure    does sshow
that as the numbeer of symbolss decrease  th
he recognitionn rate
for wave
w
and sw
wing do signifficantly fall as well  curioously 
puncch and slap reemain very reecognizable  possibly
p
due too the
fact that these arre the only two
t
actions that
t
change iin zcoorrdinates  whicch we did not alter in termss of segmentaation 
conv
versely  it seeems that thee more symbols there aree  the
betteer the overall recognition rate can becom
me  perhaps iif we
had more features and more clustering
c
requ
uired  the runntime
wou
uld increase drramatically  buut in our partiicular case it iis not
evid
dent  thus  foor our case  thhe optimal nu
umber of sym
mbols
seem
ms to be arouund    and more 
m
based on
o keeping alll the
recognition rates aabove     
viii  real time implementat
tion
a  im
mplementationn details
following
f
ourr matlab simulations  we interfacedd the
kineect api with matlab via
v c   the models were pretrain
ned  with the code only innvolved in caapturing the ssingle
seco
ond worth of ddata  sending it to the mat
tlab modulle for
calcu
ulation and obbtaining the returned label 
our
o system beegins picks a valid
v
starting state
s
only wheen the
 
hand
d has been staable for a whhile  with a difference
d
        
betw
ween frames  iif the frame reemains stable after
a
this poinnt  we
do not
n begin reccording until the difference is beyondd the
thresshold  if the m
movement lasts beyond a seccond  we will only
take the most receent    frames for
f feature pro
ocessing  assum
ming
the user
u
wants too finalize theiir gesture and
d that the cliipped
portiion is simply noise  the reeason for succh a mechanissm is
that our actions ussually begin with
w zero velo
ocity or with sslight
jitterr that could potentially seet off recordiing falsely  t
these
criteeria allow uss to have more
m
accurate and contrrolled
recordings     
b  observations
o
our
o system trrained on    states and    symbols is ffairly
accu
urate in recognnizing the corrrect gesture an
nd seldom connfuse
one for another  t
the few errorrs that do occcur are due too the
systeem sometimess being unablle to recognizze a movemennt as
one it has been traained to learnn  this problem
m is a lot of ttimes
due to the user nnot performinng the action within a seccond 
partiicularly for sw
wing  other times 
t
the userr needs to be rrather
precise in where rrelative to thee body they perform
p
the acction 
due to
t the way in w
which we defi
fined our featu
ures 

d
detected actions

fist

it can be seen
n from this neew data that reecognition rem
mains
very
y good for the baseline geestures  but leess so for ourr new
addiitions  this may
m be due to there being leess variance in
i the
train
ning validation
n data for thee fist pump and
a circle  as they
weree both trained by the same iindividual  wh
hereas the basseline
invo
olved the efforrts of the entirre team  at leaast   secondlyy  it is
posssible that thee negative ddata  which did involve some
rand
dom movements  inadverteently containeed fist pumpp and
circlle actions  as this data triedd avoiding thee baseline gesstures
but was collected
d before we made the tw
wo new inclussions 
otheerwise  it maakes sense thhat swing siphoned
s
som
me of
circcles recognitiion  as swingg shares rough
hly half of cirrcles
gestture 
viii  con
nclusion
from
f
this pro
oject  we mayy conclude th
hat hmms arre an
effective and effficient methhod of both recognizing and
n gestures  too further imp
prove this conncept 
classifying human
we may
m try to buiild a more sopphisticated featture set besidees the
simp
ple normalized xyz coorddinates of the right hand thaat we
currrently use  th
his may allow
w greater diffeerentiation bettween
each
h action  in ad
ddition  it woould be interesting to add many
m
morre kinect dataa points and aallow our classsifier to recognize
morre complicated
d gestures invo
volving the enttire body  wee may
also extend our recording
r
timee beyond a seecond  this  again 
a
allow
ws for more complex recoggnitions  but allso complicatees the
proccess by testing
g the systemss ability to reecognize actioons of
diffeerent duration 
we
w may posssibly improvee our results a lot by recruuiting
man
ny more people to perform
m actions for us  merely addding
morre variance intto our dataset t  preventing trained
t
modelss that
are too
t constrained 
finally 
f
it may be desirablee to further optimize
o
the hmm
h
train
ning and expeectation maxim
mization algorrithms to allow
w the
system to give neear instant feeddback  instead
d of having too wait
a deelay of approx
ximately one ssecond  this would
w
make it truly
viab
ble for an hci application 
acknowlledgment
we
w would like to thank proofessor andreew ng for teacching
such
h a large cs  
   class  as w
well as all the tas
t for helpinng us
out throughout
t
thee quarter 

fireferences
    l  r  rabiner  a tutorial on hidden markov models and
selected applications in speech recognition  proceedings of
the ieee  vol      no     february      
    z  ghahramani  em for hidden markov models for discretevalued
observations
 online  
available 
http   mlg eng cam ac uk zoubin software html
    j  c  hall         dec      how to do gesture recognition
with kinect using hidden markov models  hmms   online  

available  http   www creativedistraction com demos gesturerecognition kinect with hidden markov models hmms 
    h  lee and j  kim  an hmm based threshold model
approach for gesture recognition  ieee transactions on
pattern analysis and machine intelligence  vol      no     
october      
    y  wang  c  yang  x  wu  s  xu and h  li  kinect based
dynamic hand gesture recognition algorithm research   th
international conference on intelligent human machine
systems and cybernetics       

fi