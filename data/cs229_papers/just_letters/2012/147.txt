pattern recognition and prediction in equity market
lang lang  kai wang

   introduction
in finance  technical analysis is a security analysis discipline used for forecasting the direction of prices through the
study of past market data  the technical analysis of the past market data would usually be focused in the moving
average of price  support line  resistance line and charting patterns  this type of technique has been widely among
the traders and investors of the market  however  technical analysis has not received the same level of academic
scrutiny and acceptance as more traditional approaches such as fundamental analysis  one of the main obstacles is
the highly subjective nature of technical analysisthe presence of geometric shapes in historical price charts is
often in the eyes of the beholder  so in this project  we propose to build appropriate quantitative models to recognize
some tradable signals from technical perspective from past data and test the signals in the equity market  we will
discuss generating technical signals from supply and demand perspective  from charting patterns perspective and
from softmax classification perspective  we back tested these signals on thousands of stocks and got fairly good
results 

   signal type one  support line and resistance line
support and resistance lines appear as thresholds to price patterns  they are the respective lines where prices stop
moving down or up  a support line is the level that a stock s price generally will not fall below  it marks the price
level where there is adequate demand to stop  and possibly to turn a downtrend higher  a resistance line is the level
above which a stock s price typically will not rise  it indicates a price level where an adequate supply of stock is
available to stop and fend off an uptrend in prices 
support and resistance levels can be identified by trend lines  some traders believe in using pivot point calculations 
the more often a support resistance level is  tested   touched and bounced off by price   the more significance given
to that specific level  if a price breaks past a support level  that support level often becomes a new resistance level 
the opposite is true as well  if price breaks a resistance level  it will often find support at that level in the future 

figure    support line and resistance line

 

fisupport and resistance levels are useful in evaluating the stock supply and demand  but the choosing of support line
and resistance line is highly subjective  to test the signals  a quantitative way to detect support line and resistance
line is proposed as follows  first  for any specific stock on a specific day  smooth the past data first to eliminate
wrong local minimums and maximums brought by market noise and find out ten most recent true minimum and
maximum points  second  regress over the past ten local minimums and maximums to get slopes of the two lines  in
our hypothesis  these two lines represents the support and resistance levels and give us signals for trading 
we use following principles to trade this signal 
   when price rises to around resistance line  short the stock
   when price goes above resistance line  buy the stock and consider the resistance line as the new support
line
   when price drops to around support line  buy the stock
   when price drops below support line  short the stock and consider the support line as the new resistance
line
following are sample plots of support resistance line and the plot of its trading performance

figure    recognizing support line and resistance line in matlab

figure    performance of support resistance line signals

we can see that the return seem to be quite good  with the risk adjusted return  ir  being       

   signal type two  charting patterns
candlesticks are usually composed of the body  black or white   and an upper and a lower shadow  wick   the area
between the open and the close is called the real body  price excursions above and below the real body are
called shadows  the wick illustrates the highest and lowest traded prices of a security during the time interval
represented  the body illustrates the opening and closing trades  if the security closed higher than it opened  the
body is white or unfilled  with the opening price at the bottom of the body and the closing price at the top  if the
security closed lower than it opened  the body is black  with the opening price at the top and the closing price at the
bottom  a candlestick need not have either a body or a wick 

 

fifigure    candlesticks chart

the second type of trading signals that we want to test comes directly from analyzing the candlesticks chart  which
represents a stocks open price  close price  highest price and lowest price of a day  different shapes of candlesticks
typically indicate different distributions of price movement  we can build up programs to keep track of any stocks
high  low  open and close and recognize different candlesticks chart patterns and test them  for example  hammer
candlesticks are usually a signal of reversal  indicating that the current price trends may not last long any more  the
hammer type is characterized as having a very long shadow  typically twice larger than the real body  using
matlab  we are actually able to test many chart patterns to see if they are informative in predicting the future 
following are figures of hammer pattern and its trading performance 

figure    hammer type candlesticks

figure    performance of charting pattern signals

   signal type three  softmax regression and classification of future returns
the first two types of signals that we talked before are traditional technical analysis methods  in general  these
methods work fine in the sense that they usually reflect some probability rules  so while we have a very large asset
class that we can trade on  we can get positive return  a third type of technical signals we can think of is from the
idea of machine learning class  we all know that equity market is not a complete market  which means that past data
can contain information about future  therefore  information like past prices  return  trading volume  volatility  etc 
may be useful if we can learn some patterns from them  here  we choose to use softmax regression to model the
relationship between future return and past market data 
the input variables come from a stocks one day return    days return  ratio of intraday high and low  changes in
daily high  low  open and close prices in two consecutive days  difference between morning volume and afternoon
volume and its daily changes  changes in one day return  daily morning return  daily afternoon return  change in
daily volume  ratio of afternoon return standard deviation and morning return standard deviation  changes in
morning return and afternoon return in two days  changes in  days return in   days  and sp     return  vix index 
daily top     stock return  etc  with above information  we are able to select and construct    variables that we
consider to be most informative technical input variables 

 

fiwe want to use these input variables to predict tomorrows daily return  future returns are classified into three
buckets 
positive
neutral
negative
return       
return        
      return     
our goal is to predict which bucket tomorrows return will fall into and design a trading strategy using the predicted
values  therefore  we implemented softmax regression for this problem  part of the program comes from exercise 
softmax regression  stanford ufldl tutorial  
softmax regression is a method to solve classification problems in which the response variable y can take on any
one of k values  i e 
 
for softmax regression model  we assume

by linearity  we only need to consider
our hypothesis will out put

is linear with

  thus 

as parameters of the model 

in other words  our hypothesis will output the estimated probability that
for parameter fitting  if we have m training samples

for every value i    k 
  the log likelihood can be written as 

thus we can obtain the maximum likelihood estimate of the parameters by maximizing
in terms of using
stochastic gradient ascent 
we trained the model on a data set of size       and applied out of sample test on      stocks for      days  the
accuracy is      which is slightly higher than random guess  considering the equity market is extremely hard to
predict and highly random      accuracy in choosing one from the three buckets is actually a decent number 
indicating a positive r square between the input variables and dependent variable 
to test whether this prediction model is useful in trading or not  we first assign a signal value to the three buckets 
indicating how much to buy or sell a stock 
positive
neutral
negative
 
 
  
the performance of this trading strategy is plotted below 

 

fifigure    performance of softmax regression signal

we can see that trading signals from softmax regression perform ok  but the return line is a little less smooth  which
means that this method is still not very steady and consistent and can be further improved 

   conclusion 
quantitative methods to model three types of technical signals have been discussed and back tested in this paper 
the performance metric of these three types of signals are summarized as follows 
information ratio
turnover
drawdown
 risk adjusted return 
support resistance line
     
     
    
charting patterns
     
     
    
softmax regression
     
     
   
we can find that quantitative signals generated from traditional technical analysis give fairly good risk adjusted
return and low turnover  but has high drawdown  while the more modern technical signal generated by running a
softmax regression model over many technical variables  gives slightly lower but still positive risk adjusted return
with high turnover  the application of machine learning techniques in trading signal construction seems not to be
able to beat traditional techniques  but from the performance we can see that this signal has value  considering that
modern methods use totally different principles from traditional ones  they generate signals with very low
correlations  and thus add value to one another  we can improve the model by selecting better and more input
variables for the model as well as researching to assign better signal values in the trading process 

reference
    andrew ng  cs    lecture notes on softmax regression       
    wikipedia  support and resistance  http   en wikipedia org wiki support and resistance
    wikipedia  candlestick chart  http   en wikipedia org wiki candlestick chart

 

fi