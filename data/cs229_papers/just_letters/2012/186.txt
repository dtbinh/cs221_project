use of machine learning in petroleum production
optimization under geological uncertainty
obiajulu j  isebor
ognjen grujic
december         

 

abstract

intrinsic part of the problem  firstly  as the
petroleum reservoir from which we plan to
produce is below the surface of the earth  we
only have approximate models of what we
think the reservoir looks like  in attempts
to capture this geological uncertainty in the
reservoir description  tens to hundreds of
probable earth models with dierent reservoir properties and property distributions
are typically generated using stochastic simulation 
generating these dierent realization
models is not a goal in and of itself but the
use of the models to understand the uncertainty in modeling some response function
is what we are after  the response function
is typically a measure of the performance of
the eld  e g   cumulative oil production or
net present value  npv   that is of interest to decision makers in charge of managing the elds production  in recent years 
techniques from the eld of numerical optimization have been applied to optimize our
measure of eld performance so that we can
plan to get the best out of our eld moving
forward in time  given the information we
know about the eld right now 
our project involved the investigation of
the use of machine learning methods to classify the tens to hundreds of earth models  and select a small representative subset 
that still represents the uncertainty range 
to use for forecasting or optimization  this
is done in order to not run numerical reservoir simulations  which can be quite expen 

geological uncertainty is of signicant
concern in petroleum reservoir modeling
with the goal of maximizing oil production  stochastic simulation allows generating multiple reservoir models that can be
used to characterize this uncertainty  however  the large computation time needed for
ow simulation  e g   for use in production
forecasting  impedes the evaluation of ow
on all reservoir models  in addition  performing a formal optimization of the well
controls to maximize say npv leads to hundreds or thousands of function evaluations 
each of which requires tens to hundreds
of reservoir simulations depending on the
number of reservoir models available 
in this work we apply machine learning
techniques to provide computational savings on two fronts  we use kernel k means
clustering to select a small representative
set of earth models that characterize the
geological uncertainty so as to reduce the
number of simulations for each optimization function evaluation  and use a kriging
surrogate in the optimization to reduce the
required number of function evaluations 

 

introduction

the task of optimizing the production from
an oil eld is a tough one fraught with theoretical and computational challenges centered around the uncertainties that are an
 

fisive  on all the models but only a subset
of them  while still spanning the range of
uncertainty in the desired response  e g  
npv  
in addition to earth model selection  we
would also like to investigate the use of machine learning methods as proxies for the
objective function evaluations during the
optimization process  for example  having
a supervised learning algorithm  like a kriging surrogate  trained to reproduce the response might provide signicant savings in
an optimization process that requires running hundreds or thousands of simulations
by replacing a good number of these simulations  which could take minutes to hours to
run each  depending on the size of the reservoir model  with approximations from the
kriging surrogate  which runs in a fraction
of a second  

 

erage of npv over several geological realizations  formally stated  the optimization
problem we aim to solve is given as
nr
  
max j  x   
npv  x  mj    
xx
nr j  

   

where x represents the vector of well control
variables  well bhps   x    x  rn   xl 
x  xu   represents the box constraints for
the control variables  nr is the number of
geological realizations  mj represents the
geological model parameters for realization
j  and the undiscounted npv from each
model is given by
npv  x  mj     po qo  x  mj   
 
 z
 
oil revenue

cwp qwp  x  mj    cwi qwi  x  mj      
 
 z
   
 z
 
water production cost

water injection cost

where po   cwp and cwi are the price of oil
and costs of produced and injected water
per barrel  respectively  qo   qwp and qwi
are the cumulative oil and water production and water injection in barrels  respectively  these are the outputs from the
reservoir simulator that are required for
the npv computation  figure   below
presents the workow for the average npv
calculation for running example used in the
project  this example involves using    ge 

problem statement

the problem we aim to solve is the optimization of well controls in a petroleum eld
produced under waterooding  where water
is pumped through injection wells in order
to maintain reservoir pressure and displace
the resident oil toward production wells 
simulating the ow through the petroleum
reservoir  in order to ascertain injection and
production volumes for npv calculations 
is done with the use of a reservoir simulator  in this work  we use the stanforddeveloped reservoir simulator called gprs
     
the well controls  part of the inputs
to the reservoir simulator  being optimized
are the injection and production bottomhole pressures  bhps  and the objective is
to maximize undiscounted npv from the
petroleum eld  due to the uncertainty in
the reservoir description  the optimization
is performed in a robust manner where the
objective function is actually the expected
value of the projected production given a
set of well controls  characterized as the av 

figure    illustration of computation of
npvs for full set of realizations 
ological realizations     each produced from
stochastic simulations assuming   dierent
depositional environments   the eld has
eight wells  four production  red circles in
gure  and four injection  blue circles in
 

figure  wells  with these well locations together with the initial specied well controls
of constant injection and production  the   
reservoir simulations are run  resulting in
   injection and production proles  only
oil production proles shown in figure   
from which we can calculate    npv values  shown as an empirical cumulative density function  cdf  in figure    from these
   npv values  we can calculate the average npv   npv   which is the objective
function value for the initial set of controls 

 

scheidt and caers in           details of the
approach can be found in this paper   in
figure   we present an illustration of the
process for our running example 

machine learning for
computational savings

from equations     and     we see that each figure    earth model selection process 
evaluation of the objective function in the
the process illustrated in figure   shows
optimization requires running nr reservoir
simulations     simulations in our exam  our clustering and model selection process
ple   in addition  the optimization process and the dierent parts of the process are as
can require hundreds to thousands of func  follows
tion evaluations  depending on the complex   given the initial well controls  we genity of the problem and the optimization alerate the model responses  cumulative
gorithm used  it is no surprise that this opoil production proles  for all    resertimization process considering the dierent
voir models using the process illusgeological realization can be quite expentrated in figure   
sive  as a result  we investigate using machine learning techniques to provide compu   find pairwise distances between the
tational savings on two major fronts  reducthe model responses 
ing the number of realizations using clustering  while still eectively characterizing
   map with multi dimensional scaling
the geological uncertainty in the problem 
 mds  into a  d mds space  as is done
in order to reduce the simulations needed
in     
for each objective function evaluation  and
   transform using a gaussian kernel into
using an optimization approach that uses a
a low dimensional feature space where
kriging surrogate to reduce the number of
the points for each model are more sepfunction evaluations that require reservoir
arable 
simulations 

   

clustering
and
model selection

   perform k means clustering to cluster
the data into six clusters  dierent colors in figure    and identify the models
that are the closest to the cluster centroids 

earth

the idea of using k means clustering for
earth model selection to represent uncertainty in model responses using a subset
of the original models was introduced by

   transform back to the mds space and
identify the selected earth models 
 

fi   identify six selected model responses every time the polling step is unsuccessful 
and show that they span the same un  using the new points that were evaluated in
certainty range as the initial    models  the polling process 

  

  

  

  

average npv    mm 

average npv    mm 

   show that the selected models reproduce the ensemble statistics  p    p    
results
and p    as the initial set of models 
we ran the optimization codes on our well
again for the initial well controls 
control problem for several cases  with the
    surrogate based optimiza  original    models and with the selected  
models  as well as with and without the use
tion
of the kriging surrogate in the optimization
after performing the model selection ex  process  our project results are summaplained in the preceding subsection  we now rized below in figure    in figure  a we
need to run the optimization in order to determine the optimal well controls that maximize  npv   we applied a surrogatebased search poll optimization procedure
introduced by booker et al       with a modied implementation from abramson     and
illustrated below in figure   
 a  improvement due to  b  improvement due to
  
 
 

 

  
  

  
 

   realizations  without surrogate
  realizations  with surrogate

   

   

   

   

    

  
 
 

 

  
  

  
 

    

number of function evaluations

  

  

  

model number reduction

 

 
   realizations  without surrogate
  realizations  with surrogate

   realizations  without surrogate
  realizations  with surrogate

   

   

   

   

f npv 

f npv 

  

number of simulations  thousands 

surrogate use

   

   

 
   

   realizations  without surrogate
  realizations  with surrogate

  

   

   

   

  

 

  

npv    mm 

 c  initial npv cdfs

 
 

 

 

  

  

  

  

npv    mm 

 d  final npv cdfs

figure    performance result comparisons 
figure   
workow 

surrogate based optimization
show the improvement in computational efciency of optimization with and without
surrogates  we see that with the use of the
kriging surrogate  there is a rapid increase
in  npv  after only a few true function
evaluations because we are doing a lot of the
optimization on the surrogates and running
the results on the true function evaluation 
to get an idea of the timing  one surrogate
function evaluation is a small fraction of a
second  where each true function evaluation
is about    seconds  for this simple case 
the point of figure  a is that we get about
the same optimal solution but with much
less function evaluations 
in figure  b we show the improvement
in computational eciency due to reduc 

the poll step involves using the generalized pattern search  gps  algorithm of audet and dennis jr       which uses a stencilbased approach to identify points in optimization parameter space to evaluate the
objective function  before each poll step 
there is a search step where a fast running
surrogate is optimized and the resulting well
controls applied to the true objective function evaluation  we use a kriging surrogate
 from the dace kriging toolbox       which
is essentially a response surface approximating the true objective function surface  the
initial surrogate is built from points from a
latin hypercube search  lhs  and updated 
 

fiing the number of reservoir models that
characterize the uncertainty in the problem  for the case with nr realizations  each
function evaluation corresponds to nr reservoir simulations and thus reducing the number of models needed to characterize uncertainty directly leads to a reduction in number of simulations needed for the optimization  combine this with the improvement
in computational eciency from including
surrogate use in the optimization and we
get the comparison shown in figure  b 
figures  c and  d present the initial
and nal cdfs respectively for the cases
where we optimize  npv  from all initial    models without using a surrogate
and where we optimize  npv  from only
the six models with surrogate use in the
optimization  the gures show that the
six model representation of uncertainty is
just as good as the one with    models 
the optimization is successful in improving the performance from the reservoir  initially   npv  was negative meaning that
the project is unprotable under the scenario where we implement the initial well
controls  after optimization  we improve
 npv  to about     million  our optimized well controls are also more robust because the range of npvs in the nal cdf
is     million  compared with about     
million for the initial well controls 

 

ample  we showed that surrogate based optimization  using a kriging surrogate  signicantly reduces the optimization computational cost  our results show that the
optimized well control obtained with our
surrogate based approach run on the selected subset of reservoir models is comparable in terms of quality of solution with the
full optimization with    models  while requiring signicantly less computational expense 

references
    m  a  abramson  nomadm version
    users guide  department of mathematics and statistics  air force institute of technology       
    c  audet and j  e  dennis jr  analysis
of generalized pattern searches  siam
journal on optimization           
          
    a  j  booker  j  e  dennis jr   p  d 
frank  d  b  serani  v  torczon  and
m  w  trosset  a rigorous framework
for optimization of expensive functions
by surrogates  structural optimization 
             
    h  cao  development of techniques for
general purpose simulators  phd thesis  department of petroleum engineering  stanford university       

concluding remarks

    s  n  lophaven  h  b  nielsen  and
j  sondergaard  dace  a matlab kriging toolbox  version      technical report  technical university of denmark 
     

in this work  we successfully implemented
an approach for optimizing well controls in
petroleum production under geological uncertainty  this process can be computationally expensive but we present machine
learning approaches to improve the compu      c  scheidt and j  caers  uncertainty
quantication in reservoir performance
tational eciency of the optimization apusing distances and kernel methods 
proach 
application to a west africa deepwawe showed that mds and kernel k means
ter turbidite reservoir  spe journal 
clustering is suitable for selecting a repre                   
sentative subset of earth models  for our
waterooding well control optimization ex 

fi