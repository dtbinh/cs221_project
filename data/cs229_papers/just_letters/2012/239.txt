 

cs     project milestone report  automated
segmentation of breast density
rebecca l  sawyer

abstractthis project is to develop an automated breast
density segmentation system  breast density has been shown to
be a key indicator of breast cancer risk  currently the primary
computational system for analyzing breast density is a semiautomated segmentation system that requires a radiologist to set
thresholds for the segmentation algorithm  this results in reader
variability  which reduces the validity of the density assessment 
i propose a fully automated segmentation system  the system
will utilize superpixels and neighborhood information to create
visual dictionaries from training data and use this information to
segment image patches  small superpixels  as dense or not dense 

i  i ntroduction
breast cancer affects approximately   in   women in the
united states  and it is the leading cause of cancer deaths
amongst women worldwide      it has be shown that early
detection is an important factor in cancer survival  mammography is beneficial for early detection of breast cancer
     currently  the american cancer society recommends that
women with average risk for breast cancer get yearly screening
mammograms to detect potentially malignant findings at an
early stage     
of the mammographic risk factors for breast cancer  breast
density has been shown to be a significant predictor  women
with increased breast density are four to six times more likely
to develop breast cancer        in current practice  the overall
mammographic breast density is reported by the radiologist
qualitatively on a four point scale using the breast imaging 
reporting and data system  birads       although this
standard has specific reporting guidelines  it is qualitative and
subject to the inherent variability of radiology reporting       it has been suggested that quantitative breast density can
provide a more robust predictor of mammography risk 
recently  there has been growing interest in reproducible
quantitative methods for estimating breast density  initial methods were based on hand drawn segmentations of the breast
and dense tissue  however  with the development of digital
mammography  more semi automated approaches are being
studied  in these methods  the radiologist outlines the area
of the breast parenchyma and the total area of the breast  or
semi automatic segmentation of the mammogram is performed
by radiologists adjusting software parameters      the current
state of the art method for semi automated segmentation is
the cumulus software          this method requires the user
to participate in producing the segmentation  which is timeconsuming and disrupts the workflow  my goal was to develop
a fully automated method of quantifying breast density  this
would eliminate user variability and provide an efficient means
to quantify breast cancer risk 

my previous efforts towards this goal also involved an unsupervised feature learning approach to classify image patches
has dense or not dense  this method involved the extraction
of  x  pixel image patches and then clustering of the patches
using k means  the final feature vector for each patch was
the distance of the patch to each cluster  resulting in a vector
of length k  the patch classification was then performed
using l   regularized logistic regression classifier  lasso  
the results were evaluated by two metrics  per pixel accuracy
and the jaccard index as shown in equation  
t
predicted true
s
   
jaccardindex  
predicted true
where r  and r    in our case  correspond to masks of
the actual density and the predicted density  the average
per pixel accuracy was approximately      which is not
surprising considering the ratio of non dense patches to dense
patches  the average jaccard index  however  was        this
shows that there is room for improvement in breast density
segmentation 
i made alterations to improve upon my previous work by
making the following changes      using superpixels instead
of square patches and     incorporating neighbor information
into the patch classification  i will explain more about these
changes and why each of them could improve classification in
the next section  results of this work will be shown in section
iii  and conclusions will follow 
ii  m aterials and m ethods
i built a system that takes an input of a cranio caudal
view of a breast and outputs a binary mask delineating dense
regions as described in figure    it works by dividing the
image into superpixels using vlfeat        software package
and characterizes these superpixels  the features are then used
to train a lasso classifier using glmnet software to estimate
the probability of density given the features  whole patches
are classified as dense if the probability is higher than a given
threshold that is determined during training  each patch is then
mapped to original breast image to create a density mask 
a  data set
i obtained    cranio caudal mammography images that have
been segmented by an expert radiologist using cumulus software  the cumulus company developed an algorithm that uses
thresholding based segmentation to distinguish dense and nondense breast tissue          the images are scanned film files
and have been subsequently normalized to have equal optical

fi 

formed in step size s  a free parameter to optimize via crossvalidation  next  the algorithm computes a modified version
of k means that calculates distances  or searches for points
of its class  in a  sx s region around each centroid  the
distance equations are shown below 
q
   
dc    gi  gj   
ds  

q
 xi  xj       yi  yj   

   

r

ds    
  m
   
s
where dc is the distance between colors  ds is the distance
between columns and rows of the image  and d is the overall
distance calculation  note that dc would normally consist
of differences between r  g  and b values  however  since
mammograms are grayscale images  this is simplified to the
distance between the grayscale values  also  of note is the
parameter m in equation    this parameter is used to control
the tradeoff between spatial and intensity distances  it is
another parameter to be chosen via cross validation 
the combination of spatial distance and intensity measures
results in pixel groups that are more homogeneous than
uniformly extracted square patches  the result is that these
sets of pixels will be more accurately classified since each set
is classified together 
   superpixel features  the original system was modified
to extract superpixels and to obtain sift features and statistical features  mean and variance   the features are then
clustered using k means in order to obtain a dictionary of
visual words to use for classification  from there the system
classifies using lasso 
the sift algorithm first finds local maxima and minima
by convolving the image with gaussians at various scales and
then taking the difference of the images  maxima and minima
are then found by comparison with neighboring pixels  this
is repeated at each level near the maxima and minima of the
previous level until the maxima or minima no longer appears 
the maxima and minima that remain  considered stable 
correspond to key locations in the image  the next step in to
characterize the image and each of these key locations  this
is accomplished first my computing the gradient magnitude 
mi j   and the orientation  ri j   at each pixel  ai j  
d 

fig    

system overview

fig    

feature extraction flowchart

density values  the radiologist performing the segmentation is
a trained expert in cumulus and has over    years experience
using semi automated thresholding based density segmentation
experience  i use these segmentation results as ground truth for
training and evaluation of our system 
b  image processing
the images are analyzed by first segmenting the image into
superpixels for analysis  these superpixels provide a robust
way to describe local areas of an image  the superpixels are
then characterized using real valued features that are derived
entirely from the data figure    once features are extracted
for each patch  they are used to train a lasso classifier to
predict their density state      
   superpixel extraction  superpixels are groupings of
pixels related by distance as well as intensity values  the
algorithm i used to extract superpixels is the simple linear
iterative clustering  slic  algorithm       slic works by first
initializing cluster centroids of column  row  intensity values
at equally spaced points in a grid across the image  the grid is

q

d c    

 ai j  ai      j      ai  j  ai  j      

   

ri j   arctan   ai j  ai      j  ai j    ai j  

   

mi j  

the gradient magnitudes are thresholded at     times the
maximum possible gradient value in order to obtain limited
effect by illumination changes  next  each image is a assigned
an orientation  this is done so that the image descriptors will
be invariant to rotation  an orientation histogram is created
by applying a gaussian weighted window  the weights are
multiplied my the thresholded gradient magnitude  then binned
to form a histogram in locations corresponding to ri j   then 
key location descriptors are obtained      

fi 

after obtaining sift features  k means is used to transform
these features into a dictionary of visual words  using each
cluster centroid as an individual word 
c  superpixel classification
the authors      performed similar image processing using the quick shift algorithm for obtaining superpixels  then
finding sift features  they found success using support
vector machines  svm  for classification and then incorporating neighborhood information using conditional random
fields  crfs   mathematically  p  c g  w  is the conditional
probability of the set of class label assignments c given the
adjacency graph g s  e  and a weight w 
log p  c g  w   

x

 ci  si     w

si s

x

original
modified without crf
modified with crf

mean accuracy
     
     
     

mean jaccard index
     
     
     

table i
m ean accuracy and m ean jaccard i ndex of the o riginal
s ystem   the m odified s ystem without crf s   and the m odified
s ystem with crf s  

 ci   cj  si   sj  

si  sj e

   
here  s refers to the collection of superpixels in a given
image  also  we have 
 ci  si     log p  ci  si   

   

the calculation of  ci  si   comes from the svm  and finally   ci   cj  si   sj   is a measure of pairwise edge potentials 
 ci   cj  si   sj    

l si   sj  
  ci    cj  
   k si  sj k

   

where   ci    cj   is the indicator function and k si  sj k is
the norm of the color difference between superpixels  l si   sj  
is the shared boundary length between superpixels si and sj  
my density segmentation system was modeled after this
system  however  i tested my system with both svm and
lasso 
d  evaluation
the system was evaluted via leave one out cross validation 
two metrics were used to describe the system      per pixel
accuracy and     the jaccard index as defined in equation   
which provides a measure of the amount of overlap of the
actual dense region and the predicted dense region 
iii  r esults
the system was tested on       x    pixel mammograms
with two types of features      sift features and     statistical
features and two different classifiers  svm and lasso  unfortunately  do to the large size of the images the sift feature
extraction resulted in extremely long run times of several days
on the barley cluster  these jobs were aborted  and results
were not able to be obtained  additionally  the svm classifier
resulted in majority rule classification  therefore  the results
are not included here 
results as shown in table   were obtained with lasso
classification using statistical features with and without crf
computations included  the results with crf regularization
were significantly lower than those without  figure   shows
examples of segmentation accomplished with my system  the

fig     top left  true density mask  top right  prediction from original
system  jaccard         bottom left  prediction from modified system without
crfs  jaccard         bottom right  prediction from modified system with
crfs  jaccard       

first image shows the true segmentation as obtained from the
radiologist  the second  third  and fourth images show segmentations from the square patch based system from my prior
work  the modified system without crfs  and the modified
system with crf  respectively  it is clear from these images
that use of crfs result in over segmentation 

fi 

overall  the modified system without crfs showed comparable results than the original system 
iv  c onclusion
breast density is a key indicator of breast cancer  and as
such  breast density segmentation of mammograms is important for assessing cancer risk  my prior work showed some
promising results  but modifications are necessary for further
improvement  in that view  i have altered the system to obtain
superpixels instead of square patches with the intention of
classifying more homogeneous patches of the image  second 
i implemented crf regularization on the predictions obtained
from lasso 
the current modifications to the original breast density
segmentation algorithm unfortunately have not resulted in
improvement  however  there are many further improvements
that can be made to increase segmentation accuracy  first 
there are several parameters that can be optimized in the
current system  the number of visual words in the dictionary
 k in k means   the size of the superpixels  s in the search
window of the slic algorithm   and the weight giving the
tradeoff between spatial and intensity components of the slic
algorithm  w   next  implementing the system in a programming language other than the current language  matlab  could
result in faster processing time  this would allow for obtaining
smaller superpixels as well as extracting more features to
describe the superpixels  further  other classifiers may result
in improved classification 
v  acknowledgements
dr  daniel rubin and fellow phd student francisco
gimenez contributed to the original segmentation system
which was modified for this work  dr  rubin obtained data and
advised the project  francisco implemented the classification
and thresholding code 
vi  r eferences
    jemal a   et al   global cancer statistics  ca cancer j
clin       mar apr           
    nystrm l  andersson i  bjurstam n  frisell j  nordenskjld b  rutqvist le  long term effects of mammography
screening  updated overview of the swedish randomised trials 
lancet      mar                    
    smith ra  saslow d  sawyer ka  burke w  costanza
me  evans wp  et al  american cancer society guidelines for
breast cancer screening  update       ca  a cancer journal
for clinicians  john wiley   sons  ltd                   
    harvey ja  bovbjerg ve  quantitative assessment of
mammographic breast density  relationship with breast cancer risk   radiology  radiological society of north america 
                 
    nelson hd  zakher b  cantor a  fu r  griffin
j  omeara es  et al  risk factors for breast cancer
for women aged    to    years  ann  intern  med 
    jan                

    baker ja  kornguth pj  floyd ce  breast imaging
reporting and data system standardized mammography lexicon  observer variability in lesion description  ajr am j
roentgenol      apr              
    boyer b  canale s  arfi rouche j  monzani q  wassef
k  balleyguier c  variability and errors when applying the
birads mammography classification  european journal of
radiology      apr   
    jackson sl  taplin sh  sickles ea  abraham l  barlow
we  carney pa  et al  variability of interpretive accuracy
among diagnostic mammography facilities  j  natl  cancer
inst      jun                 
    beam ca  layde pm  sullivan dc  variability in the
interpretation of screening mammograms by us radiologists  findings from a national sample  arch intern med 
    jan                 
     byng jw  boyd nf  fishell e  jong ra  yaffe mj 
automated analysis of mammographic densities  phys med
biol      may             
     byng jw  boyd nf  fishell e  jong ra  yaffe mj 
the quantitative analysis of mammographic densities  phys
med biol      oct                
     tibshirani rt  regression shrinkage and selection via
the lasso  journal of the royal statistical society  series b
 methodological   blackwell publishing for the royal statistical society      jan               
     achanta  radhakrishna  et al   slic superpixels compared to state of the art superpixel methods  pattern analysis
and machine intelligence  ieee transactions on   vol    
no     pp            nov       
     lowe  d g   object recognition from local scaleinvariant features  computer vision        the proceedings
of the seventh ieee international conference on   vol    no  
pp           vol         
     fulkerson  brian  et al   class segmentation and object
localization with superpixel neighborhoods  computer vision 
     ieee   th international conference on   vol   no  
pp          sept          oct         

fi