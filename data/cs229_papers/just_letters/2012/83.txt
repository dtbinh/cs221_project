cs     project  final report

incorporating global information into local upscaling
of fluid flow in porous media
kasama itthisawatpan and perth  pu  charernwattanagul
december         

 

introduction

around the interface of interest to compute the equivalent coarse scale transmissibility  it is often very quick
    background
yet inaccurate 
making an accurate forecast of hydrocarbon production
on the other hand  global upscaling performs the full
is one of the most important tasks in the upstream fine scale single phase simulation and use its results to
petroleum industry  to accomplish such goal  petroleum solve for effective transmissibility  global upscaling is
engineers use numerical simulator to model the fluid usually more accurate than local upscaling  however  it
movement in the subsurface reservoir  the accurate pro  is computationally expensive  as the full fine scale simuduction forecast can be achieved only if the reservoir lation is required 
model is accurate 
reservoir simulation models that have finer grid sizes
can generally provide more accurate results  however      project description
performing fine scale simulation is often not attainable
advantages and disadvantages of local and global upscaldue to its high computational cost  and the simulation is
ing form a motivation of the project  it is desirable that
performed on the coarser models  the process that genwe use local upscaling for all geostatistical realizations 
erates coarse scale models from fine scale models while
however  due to the challenging geology  such accuracy is
trying to preserve the solution is called upscaling 
not achieved  so some amount of global upscaling must be
the project focuses on the upscaling of the singleused  because fine scale models are generated by geostaphase flow properties  only transmissibility   which is oftistical methods  there may be some similarities among
ten performed almost exclusively in the petroleum industhe realizations  we aimed to apply global upscaling to
try      in particular  we tried to generate an accurate
a small percentage of the realizations  then  we trained
upscaled transmissibility  which measures how much fluid
machine learning models so that they can correct the locan flow between two simulation blocks given a pressure
cal upscaling results from other realizations 
difference  as illustrated in figure   

 
   

fine scale model generation

the data used in this study is collected from two stages 
first  we generate  d fine scale properties by geostatistical methods  we applied training image generator and
sequential gaussian simulation in the software sgems
    to create the permeability distribution  the models
are representative of a reservoir deposited in the fluvial
environment  the properties of each facies are similar to
those of the top layers of the standard stanford v reservoir      an example of rock permeability distribution is
shown in figure   
it is generally known that this type of reservoir properties is very challenging for upscaling  specifically  local
upscaling usually results in predicting flow rate that is
too low given a specified pressure drop     

figure    schematic diagram showing the flow from
coarse block    left  to coarse block    right   transmissibility is defined as the ratio between flow rate and
  
pressure drop t     p qp
 
 

   

data and methods

local and global upscaling

the upscaling methods can be classified into local upscaling and global upscaling  the difference between local and global upscaling is the amount of information
required in constructing the equivalent properties  for
transmissibility upscaling  local upscaling uses the areas
 

fi   location  x  y  of the interface 
   permeability map of the local domain  and
   simplified permeability map of the extended domain
    coarse blocks around the interface  
because the underestimation and overestimation of the
transmissibility values from local upscaling depend on
the distribution of low and high permeability in the dofigure    an example of permeability field in log scale main instead of the actual permeability values  we dis log   md  from one of the realizations used in this study  cretized the permeability to
hot colors represent high permeability regions  where the
 
flow rate is high 
  pi  pdi
pi  
  pi   pdi

   

upscaling implementation
where pdi is the geometric mean of permeability in the
for local upscaling  we applied the standard transmissi  extended local domain  the attributes are illustrated in
bility upscaling  see e g      for an explanation  with the figure   
fine scale simulation result from mrst      for global
upscaling  we used an iterative method as outlined in     
fine scale simulation and upscaling were performed on
all realizations to confirm our expectation  the results
are shown as empirical cdf in figure    it is seen that
global upscaling can accurately reproduce fine scale flow
statistics  while local upscaling shows significant underestimation of the flow 

figure    processing of the attributes
all the attributes were scaled to         these attributes
are supplied directly to the classification models with the
training data set from    realizations  the rest of the
realizations are used as the testing data set  for transmissibility prediction  we further simplified the attributes
e g  taking averages of some groups of attributes to reduce the complexity of the model since we have smaller
training data sets 

figure    empirical cdf from     realizations  the
coarse scale simulation from local upscaling gives consistently lower flow rate than the fine scale simulation 

   

machine learning techniques

we have     geostatistical realizations  from each of
in this project  we consider the results from global upwhich      transmissibility values are obtained  in total 
scaling as the accurate results and tried to correct the
we have       data points for training and testing 
values from local upscaling  in other words  we want to
predict the factors i of all coarse block interfaces such
    feature extraction
that
as discussed earlier  a major difference between local upscaling and global upscaling is the amount of information considered in the upscaling processes  while local
upscaling uses only the properties adjacent to the coarseblock interface  global upscaling take the entire reservoir
properties  as well as the well locations  into account 
therefore  the discrepancies between local upscaling results and global upscaling results should depend on the
global permeability field that is not captured in the local
domain when local upscaling is performed  therefore  we
considered the following properties as the attributes for
the model 

tglobal i   i tlocal i   or
log tglobal i   log i   log tlocal i
figure   shows the histogram of log i  
the factors log i indicate whether the local upscaling
results underestimate or overestimate the true transmissibility  we applied machine learning techniques in two
stages  classification and prediction 
      classification
the goal of classification is to identify the interfaces with
log i     log i     and log i     which correspond
 

fisets to predict the correction factor log i   the model
parameters are different for different groups 
linear regression 
rameter l such that

for each group l  we find the pam

   arg min
l

l 
 
 x
y  i   lt x i 
  i  

figure    histogram showing the statistics of log i in support vector regression  svr   similar to support vector machines  svr model can be constructed
the training data set 
from an optimization problem
ml
ml
x
x
 
to the cases with transmissibility from local upscaling
min   kwk    c
i   c
i  subject to
w b    
being a significant overestimation  a good approximate 
i  
i  
and a significant overestimation  respectively  in partict
 i 
 i 
w  x     b  y     i
ular  each interface in the training data set assigned the
category from the following rule 
y  i   wt  x i     b     i 

i   i    

  log i   a   underestimation 
y  i     
because each model has to be constructed from the
a  log i  a   satisfactory estimation 


training data in each group  the number of training data
 
log i   a   overestimation 
points in the training set is smaller than the classification
where a is some threshold between      and     
stage  to prevent against possible bias if the training
set is not sufficient  we also tried a simpler linear kernel
multiclass support vector machines using the set  x  z    xt z in addition to the rbf kernel for the svr
of feature vectors  we applied svm to classify the in  problem 
terfaces  for three class classification  one against one
it is worthwhile to note that the approach is slightly
strategy is applied in selecting the most probable group  different from the typical machine learning framework 
the optimization problem for multiclass svm is set up earlier in the project  we attempted to correct the loas
cal upscaling results directly using linear regression and
support vector regression on the continuous value log i
m
x  t 
  t
and multiclass support vector machine on the discretized
min
wij wij   c
ij subject to
wij  bij  ij  
log i   however  as shown in figure    the large majort  
 t 
t
 t 
 t 
ity of log i are close to    however  the interfaces with
wij  x     bij     ij   y   i
log i very far from   are the most important contribu t 
t
wij
 x t      bij      ij   y t    j
tors to the inaccuracy of local upscaling  straightforward
 t 
prediction does not capture these outliers  so it turns out
ij   
to be an inaccurate correction 
it should also be noted that the number of realizations
from the experiment  we observe that the radial basis
function  rbf  kernel  x  z    exp kx  zk  gen  used in the training data set is limited by practical aperally gives better results than linear or polynomial ker  plication  in reality  we do not wish to perform global
nels  so we applied rbf kernel throughout the project  upscaling on too many realizations  as it is against the
initial goal of applying machine learning techniques to
the library libsvm     is used for implementation 
we also studied the effects of the parameters c and   reduce the need for global fine scale simulation  around
these parameters are adjusted so that we get a reason      to     realizations is a practical range for uncertainty
quantification in the industry 
able result  c                 

k means  we performed k means clustering on the  
results
training data set  the number of clusters ranges between
  and    groups  after convergence  we study the char      classification
acteristics of each cluster by observing the distribution figure   plots an example of the classification results
from support vector machines  figure   shows how
of the correction factor i  
varying the parameters a  threshold to assign actual cat      prediction
egories  affects the accuracy 
once we classified the interfaces into groups  we conalthough the classification is not perfect        perstruct supervised learning models with reduced feature cent accuracy is sufficient for proceeding to the prediction
 

fifrom the fact that support vector machines can perform much better with the rbf kernel than with the
simple linear kernel  it is seen that the correction factor can be separated only in the high dimensional space 
the results from k means reinforces this observation  as
it fails to distinguish between the clusters in the primitive
feature space 

   

prediction

figure    classification result  accuracy       

figure    accuracy of classification with different a
stage  as will be shown in the next section  the result
shown in figure   suggests that it is important to choose
a reasonable values of the threshold a  for a        larger
a leads to higher accuracy of classification  this result is
aligned with the observations when the feature sets are
chosen  that the permeability distribution causes inaccuracy of the local upscaling results   separation between
the very inaccurate results and the satisfactory results
is clearer when we define a stricter condition of deeming
the result to be very inaccurate  when a is large  
however  too large a  while having accurate classification result  will lead to too small set of interfaces being
classified as inaccurate  which will affect the performance
of the next stage since the number of training data will
be too small  we choose a       for the rest of the study 

figure    comparing the prediction results from different groups and different methods  red dots show uncorrected tlocal   blue dots show the corrected t   black lines
correspond to     prediction  perfect correction  
figure   shows the results of the correction factor prediction on different groups by different methods  it is
shown that both linear regression and support vector
regression can slightly improve the transmissibility estimates from the values given by local upscaling as it is
seen that the predicted values cluster slightly closer to
the     line  which would correspond to perfect correction  
the performances of the predictions are measured as
mean absolute error and root mean square error between
the global upscaling result  treated as the correct value 
and the result after correction from different methods in
the testing data set  the errors are shown in the following table 
method
no correction
linear regression
svr  linear kernel 
svr  rbf kernel 

figure    distribution of correction factors of each cluster
from k means

mean abs  err 
      
      
      
      

rms err 
      
      
      
      

an example of the results from k means  with
nclusters       is plotted in figure    as the distribution of the correction factors from all clusters are very
similar  it can be concluded that the correction factors
from the table  both linear regression and support
cannot be differentiated by proximity of the feature vec  vector regression can slightly correct the transmissibiltors alone  this general result applies when we range the ity values from local upscaling  comparison between the
number of clusters from   to    
methods shows that support vector machines with rbf
 

fikernel gives the best correction  but the correction is still
small  from all the methods  the reduction of the mean
absolute error is very similar in magnitude to the reduction of the root mean square error  this suggests that
the extremes  data with large   log i    are not corrected 

 

vestigation 
despite the imperfection of the prediction stage  this
project provides an insight on the possibility of applying the machine learning techniques to aid the upscaling problems  the classification stage suggests that even
with the simplified attributes  the permeability distribution maps can be used to predict the fluid flow properties at least qualitatively  this finding can be useful
in other upscaling processes  especially those that only
focus on local domain such as relative permeabilitya
multiphase parameterupscaling  which is not considered in this project  in fact  several attempts have been
successful in using k means to aid local relative permeability upscaling      it is seen in this project that svm
can work better than k means under the non clustering
permeability distribution  it will be worth investigating
the use of svm in relative permeability upscaling 

discussion and conclusion

in this project  we presented the potential uses and limitations of an attempt to correct the effective transmissibility from local upscaling using the permeability distribution information  we have seen that in general  the
permeability distribution information can be used to predict whether the transmissbility from local upscaling will
be an underestimation or an overestimation  classification stage   for the prediction stage  linear regression
and support vector regression can slightly predict the correct values of the effective transmissibility  however  the
correction is small and may not have a large effect on the
flow behavior  from the results  we make the following
observations 
 the simplified attributes applied in this project cannot capture the complex relationship between transmissibility from local and global upscaling  this is
seen during the project that if the actual permeability values are used as inputs instead of the processed
values  svm gives perfect prediction on the training data set but inaccurate prediction on the testing
data set  this observation suggests that the model
has high variance  and the result may improve with
a more complex model 
 the extended domain considered in this project is
not large enough to capture the general pattern of
the permeability distribution from different geostatistical realizations  the physical problem that governs the single phase upscaling is an elliptic pde 
so the property at a single point is affected by all
points in the global domain  this project assumes
that the extended local domain is large enough to
represent the entire reservoir  this assumption may
be invalid  consideration of a larger domain may
enhance accuracy 
 the extreme values of transmissibility  the ones
whose results from local upscaling are highly incorrect  are still problematic  one possible remedy is to
increase the number of categories in the classification
stages  so the extremes can be grouped together 
all the discussions above would implies the necessity
of a more complex model  as its degrees of freedom increases  which would in turn demand for a larger training
data set  as discussed earlier  this may not be practical
as we aimed to limit the number of global upscaling runs
to reduce computational burden  however  it could be
more useful in a much larger reservoir model  with a
much larger number of coarse blocks   where many more
coarse block interfaces can provide more training data 
the success of this method on a larger model needs in 

 

acknowledgment

we would like to thank professor louis durlofsky  energy resources engineering  for the motivation and guidance for the project  we also thank matthieu rousset
 ph d  student  energy resources engineering  for providing the global upscaling code 

references
    c  c  chang and c  j  lin  libsvm  a library
for support vector machines  acm transactions
on intelligent systems and technology              
      software available at http   www csie ntu 
edu tw  cjlin libsvm 
    y  chen  upscaling and subgrid modeling of flow and
transport in heterogeneous reservoirs  phd thesis 
stanford university       
    y  chen  b  t  mallison  and l  j  durlofsky  nonlinear two point flux approximation for modeling fulltensor effects in subsurface flow simulations  computational geosciences       
    k  a  lie  s  krogstad  i  s  ligaarden  j  r  natvig 
h  m  nilsen    and b  skaflestad  open source matlab
implementation of consistent discretisations on complex grids  comp  geo                      
    s  mao and a  g  journel  generation of a reference petrophysical and seismic  d data set  technical
report  scrf report  stanford univ        
    n  remy  j  wu  and a  boucher  applied geostatistics with sgems  a users guide  cambridge university press       
    s  suzuki  pattern based approach to multiphase flow
upscaling using distance based clustering  in proceeding to spe annual technical conference and exhibition  denver  co  usa       
    x  h  wen  l  j  durlofsky  and m  g  edwards  use
of border regions for improved permeability upscaling  math  geol                   
 

fi