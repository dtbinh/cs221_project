video restoration using multichannel morphological component
analysis inpainting
adam s  backer  benjamin t  rolfs  and felix l y  yu

december      
abstract  morphological component analysis  mca        is a popular image processing algorithm that
extracts degrading patterns or textures from images and simultaneously performs inpainting  estimation
of lost pixels   mca has a wide range of uses  including mri image enhancement and restoration of old
photographs  however  in these authors opinions  an application that has been widely overlooked is the
use of mca in restoring video footage  we present a novel implementation of an augmented version of
mca known as multichannel morphological component analysis  mmca   and use it to reconstruct heavily
degraded video  our algorithm examines consecutive frames of video footage in order to identify and remove
distortions  results in this paper indicate that this approach has some significant advantages over the use
of conventional mca on individual video frames 

   introduction
repetitive textures often degrade images  ruining fine detail and obscuring relevant information  formally 
p
if we represent an image as a vector  x  we can decompose it into two or more components  x  
xn  
a particularly useful decomposition for image processing applications is into piecewise smooth  cartoon 
and repetitive  texture  components  respectively called x  and x    in this case  we are interested only
in the undistorted cartoon component  and would like to isolate the degrading texture  figure     shows a
decomposition of an image into cartoon and texture components  we can introduce another complication 
the data vector x may have missing entries  this can occur when the image itself is damaged  or if the system
used to capture the image is imperfect  in this case we would like to remove the texture component of an
image and simultaneously make the best possible estimate for the missing entries of the cartoon component 
while a great deal of previous literature has been devoted to mcaan algorithm that accomplishes this task
for single imagesthis report focuses on video restoration  we address the following question  given not one
vector x  but a sequence of vectors labeled xi   how is this additional data optimally leveraged to produce
accurate estimates of the original  undistorted cartoon components x i   we do this by implementing an
extension of mca called multichannel mca  mmca     and applying it to video data 

figure      mca  as implemented in the mcalab package     used to decompose an
image into cartoon and texture components 
 

although it is conventional to represent an image as a matrix  for ease of notation we use a vector representation  reasons
for this will be clarified in the theory section 
 

fivideo restoration using multichannel morphological component analysis inpainting

 

this paper is organized as follows  in section    we outline the theory behind mca  explaining how
it separates morphological components  in this case  cartoon and texture layers   and how it performs
inpainting  in this discussion  we describe how the inpainting process is essentially expectation maximization
 em   in section    we outline our approach for restoring video data  in section    we present results from
a series of experiments to determine the effectiveness of this extension of mca  we find that when a high
percentage         of the pixels are missing  our method substantially outperforms merely applying the
standard version of mca to individual video frames  we end with a short conclusion where we consider
possible future directions of this research 
   theory
p
the fundamental insight behind mca with respect to the decomposition problem x  
xn is that
for each layer xn there often exists a basis tn in which the given layer is sparsely represented  these
bases are referred to in this paper as dictionaries  which is their conventional name in mca work          
for the cartoon texture decomposition of an image  x   x    x   henceforth  we will only consider this
decomposition  although the theory is valid for a general decomposition as well   this gives x   t     t     
with i sparse  furthermore  the dictionaries can be made mutually incoherent  meaning that for instance
the cartoon component x  is sparsely represented only when transformed by some operator   into the
t   cartoon  basis but is not sparse when transformed into the texture basis  and vice versa  in other
words  each dictionary is a desirable basis only for its specific component  allowing the mca algorithm to
distinguish between the cartoon and texture components of an image  this formulation leads to the following
optimization problem 
           arg min k  k    k  k    x   t      t   

   

here kk  is the l  norm  the number of non zero entries in a vector  note that due to the structure of the
dictionaries  the transform operators i   and the nature of the l  norm  the optimization problem is more
conveniently posed when we represent our image  and each transformed layer i   as vectors 
the optimization problem     is highly non convex  and in most cases intractable     fortunately  it is
possible to solve a related  and in many cases equivalent    problem resulting from replacing the l  norms
with l  norms  this convexification yields a solvable optimization problem  however  we can only hope
that such a decomposition will be sparse if our image x is indeed composed solely of cartoon and texture
components  and thus can actually be represented sparsely in terms of the dictionaries t  and t    since
this is generally not the case  we can compensate by including a penalized residual term  assumed to be in
the form of some noise     this results in the below equation  which is the optimization problem    actually
solved by mca 
 

           arg min k  k    k  k     kx  t     t    k 

   

where the norms have been changed to l  norms and the constraint that the transformed components k
perfectly represent our image has been replaced with a  penalized residual term  solving this optimization
problem  with the right choice of dictionaries  yields a decomposition of an image into cartoon and texture
components 
the mca algorithm can be reformulated to solve the inpainting problem  suppose we have a diagonal
nxn
masking matrix m        
  whose entries signify whether or not a given pixel in our true image vector
x has been occluded or not  we are only able to observe the masked image mx  but would like to estimate
the missing entries as follows    
 

           arg min k  k    k  k     km x  t     t     k 

   

which is the optimization problem solved for mca inpainting  this problem can be motivated from a
 
maximum a posteriori  map  estimation standpoint by viewing the km x  t     t     k  term as a
log likelihood  and the cartoon and texture representations k  k  and k  k  as prior terms that favor sparse
 low norm  solutions  in this way  we can view the true image as x   x    x    but degraded by gaussian
noise that leads to the log likelihood term    
this map estimation structure leads to an em algorithm that can be used to perform inpainting  in the
em framework  this is done by computing the conditional expectation of the penalized error  log likelihood 

fivideo restoration using multichannel morphological component analysis inpainting

 

term given the current estimate for full image  and in the m step optimize each representation vector i
while holding the others fixed  a sketch of the algorithm for this is as follows    
p
 i 
e  step  
xest   mx    i  m  tk k

 

p
p

  i  
 i  
 i   
f or j       
   
m  step   j
  arg min k     xest  tk k 
 

 

to clarify  in the e step we are using our observed image mx and our last update for each k to estimate
the combined texture and cartoon components for our full image  xest   in the m step  we hold all but one
 i 
 i 
k constant  and optimize equaion     with respect to that k which is not fixed  in each m step  this
update is performed for all k  this iterates for a certain number of steps in order to attain estimates for  
and   from which we can reconstruct our full image  thus filling in the missing pixels 
at this point  it merits pointing out that this entire formulation requires access to applicable dictionaries
in which our texture and cartoon components can be represented sparsely and with mutual incoherence 
standard dictionary choices are the curvelet    basis for the cartoon components and the local discrete cosine
transform  ldct     basis for the texture components  fast transform and inverse transform operators exist
for both of these bases  allowing projection into each space and reconstruction from coefficients in each basis
during the mca inpainting algorithm  these are the dictionaries we used in our application of mca 
the final theoretical extension to mca that must be discussed for our application is that it can be used
for inpainting multichannel data        multichannel morphological component analysis  mmca  extends
mmca to take into account n m dimensional observations  for example a color picture or in the case of our
application a sequence of consecutive video frames  analogous to independent component analysis  ica  
mmca assumes independence between sources of pre mixed data  and attempts to find an unmixing operator
that best separates sources  the difference is that mmca specifically searches for sparse representations of
the morphological layers with respect to mutually incoherent dictionaries  that is  we attempt to find an
unmixing operator that maximizes sparsity 
   methodology
to solve the minimization problem     that defines mmca  we implement the optimization procedure
discussed in      which iteratively estimates each k and the unmixing operator  supplementary matlab
code for our mmca function  as well as a driver script and a provisional dataset can be downloaded at
http   www stanford edu  abacker  our code performs restoration upon two frame blocks of video data 
for example  to restore frame n  frame n and frame n     are input  hence  the final restored video had
one fewer frame than the original  throughout all our experiments  we used curvelet and ldct dictionaries
to separate relevant image content from texture  we calculate such transforms using functions provided in
the open source image processing suite wavelab  in all experiments  the penalty parameter  from     was
set to the inverse of the estimated standard deviation of the noise in the input images  this estimation was
accomplished by band pass filtering the input image  and then calculating the variance 
to compare the merits of our method versus other approaches  we perform mca restoration on individual
video frames as well  for mca trials  we use the package mcalab     which can be found at http   www 
greyc ensicaen fr  jfadili   in order to acquire a suitable video dataset  we captured a three second
video clip using an ordinary camera phone  each frame was cropped to     by     pixels  and color was
removed  a synthetic texture was then added to each frame and a random selection of pixels were removed in
order to allow inpainting  for inpainting experiments  we had free choice of how to initialize missing pixels 
we heuristically found that random initializations worked best for our mmca implementation  while this
practice led to instability and unpredictable results for conventional mca  the best performance for mca
occurred when missing pixels were initialized to zero 
   results
to demonstrate the efficacy of mmca  we perform two video restoration experiments  in the first experiment  we restore a black and white video clip respectively using mmca and mca  and make a qualitative
comparison of results  in our second experiment  we push these algorithms to their limits by investigating
the percentage of pixels that must be supplied to mca and mmca in order to yield reasonable restorations 
in this experiment  we determine that mca needs a critical minimum number of input pixels  if fewer pixels
are given  mca produces wildly inaccurate restorations  mmca  on the other hand  exhibits no threshold

fivideo restoration using multichannel morphological component analysis inpainting

 

of this sort  results become increasingly inaccurate as the number of input pixels dwindles  however there
is no point at which the method catastrophically breaks down  a significant achievement over mca 
     experiment    we include four avi files to evaluate the respective merits of mca and mmca
restoration on a short clip of degraded video  the first avi shows the original video clip  while the second
clip shows the image after the addition of a degrading texture  and random removal of thirty percent of
the pixels from each frame  the third and fourth videos show the recovered images after applying mca
and mmca  qualitatively  both recovery algorithms perform similarly  while it is difficult to distinguish
meaningful content before restoration  it becomes obvious after applying mca and mmca that the video
is of a hand  furthermore  both algorithms successfully identify and reduce the added texture content  in
general  the mmca algorithm exhibits slightly more blurring  this is due to the fact that it draws upon
information from two consecutive frames in order to reconstruct individual images  some representative
frames for both recovery methods are provided in figure     

figure      video restoration on frames with     pixel loss  using mca  left  and mmca  right  
     experiment    to quantitatively determine how increasingly high percentages of pixel removal impairs
mca and mmca  we selected two consecutive frames from our video clip  after the addition of a degrading
texture  and repeatedly perform mmca and mca on these frames  while removing between ninety three and
ninety eight percent of the pixels during each run  again  removed pixels were selected randomly   the total
error in the separated cartoon component kx true  x est k  for both mca and mmca is plotted in figure     
this plot provides compelling evidence of major failure in the mca algorithm occurring after about
ninety five percent pixel removal  around this region  the recovery error of mca dramatically increases  on the other hand  the error gradually increases for mmca  but exhibits no abrupt failure 
images produced by the two recovery methods  after removal of    percent of the pixels  are shown in
figure      the mca algorithm retrieves none of the
relevant content from the original image  however 
mmca is capable of distinguishing general trends
in the data  such as an oval white splotch superimposed upon a darker background  the key reason
figure      error in catoon compofor the success of mmca is more subtle than the
nent for mca vs  mmca
simple fact that it has access to twice the amount of
data  as mentioned previously  we have a number
of options in regard to how to initialize the values of the missing pixels  normally  initializing missing pixels
to zero works fine for both mmca and mca  however  since sparse vectors can be represented sparsely in
the curvelet basis as well  such an initialization strongly biases mca and mmca toward extremely sparse
recovered images  if an overwhelming number of the missing pixels are initially set to zero  hence  when

fivideo restoration using multichannel morphological component analysis inpainting

 

figure      video frame restoration for     pixel loss using mca  left  and mmca  right  
conducting mmca  it is best to initialize pixels randomly  so that the results are not unduly influenced 
since there is no correlation between the starting values of missing pixels from one frame to the next  a
random initialization rarely biases output of mmca unfavorably  the same trick does not work for mca 
since it has no means of inferring inter frame correlations  or lack thereof  
   conclusions
this report demonstrates a novel application of mmca to video restoration  which has some advantages
over conventional mca  in particular  we find that performance is enhanced when a very high percentage
of pixels have been lost  under less challenging circumstances  when a larger amount of data is available 
both methods produce similar results  further enhancements to our mmca algorithm are possible  in the
future  we would like to augment our code to consider more than two successive frames  while such an
improvement may seem trivial  it encroaches upon dangerous territory  since motion blurring in restored
images will increase if the number of input frames to mmca is large  hence mmca could greatly benefit
from methods that adaptively determine the optimal number of frames to provide as input to mmca 
depending upon the amount of motion which occurs in those frames 
references
    m j  fadili  j  l  starck  m  elad and d l  donoho  mcalab  reproducible research in signal and image decomposition
and inpainting  ieee computing in science and engineering        
    j  l  starck  m  elad  d  donoho  image decomposition via the combination of sparse representations and a variational
approach  ieee trans  image proces                           
    j  bobin  y  moudden  j  l  starck  m  elad  multichannel morphological component analysis  proceedings of spars    
               
    m  elad  j  l  starck  p  querre  d l  donoho  simultaneous cartoon and texture image inpainting using morphological
component analysis  mca   j  app    comp  harm  anal                     
    m j  fadili  j  l  starck  em algorithm for sparse representation based image inpainting  proc  ieee int  conf  image
processing                 
    e j  cands  d l  donoho  curvelets  a surprisingly effective nonadaptive representation for objects with edges  curves
and surfaces        
    s a  khayam  the discrete cosine transform  dct   theory and application        
    j  bobin  y  moudden  j  fadili  j  l  starck  morphological diversity and sparsity for multichannel data restoration 
j  math  imaging vis                     

fi