inferring passenger boarding and alighting preference for
the marguerite shuttle bus system
adrian albert
abstract
we analyze passenger count data from the marguerite shuttle system operating on the stanford university campus  the
aim is to infer the time varying passenger alighting and boarding preference across stops for several important shuttle
routes  we look at the problem from the perspective of filling in the missing entries of a transit route o d matrix  a
preliminary analysis indicates that there are certain trips  e g   the quarry welch rd   med school quarry  that are
preferred by passengers 

 

introduction and motivation

stanford is undergoing a large effort for reducing the its traffic associated environmental footprint  taking
part in this campus wide initiative  the p ts collaborates with the information systems lab in the electrical
engineering department to investigate possibilities for increasing energy efficiency of the marguerite shuttle
system    this can be achieved through bus allocation strategies for the various routes that better take into
account passenger rideship preference 
marguerite shuttles are equipped with devices that allow p ts to accurately assess the number of passengers
boarding and alighting at each stop in the marguerite system  see section     however it is not currently possible
to determine how many of the passengers that board at one stop choose to alight at another  given  stop 
an estimate of passenger preference for the various stops in the system based on temporal factors  such as
day of week or month of year  or on historical factors  special events  construction sites  etc   may aid p ts in
e g   planning the number of busses allocated for particular routes at different times  in addition  an assessment
on the number of people riding the bus in between different stops could contribute to estimating and predicting
spatial and temporal information of overcrowding on the marguerite 
in this paper we focus our attention on one of the main lines in the marguerite system  the a line  this
line runs on weekdays and has    stops  starting from  and ending at  the palo alto transit center  where the
buses station for up to    minutes 

 

problem formulation

let us consider the case of one marguerite shuttle completing one full trip  route   meaning it starts from a
certain initial stop  visits other stops on the way  and ends at the same stop it started from  we are interested
to infer the distribution across stops of the number of people who boarded at a certain stop and alighted at
another  given  stop  for all stops along a given line  given the boarding and alighting passenger counts for each
stop along that line  in the present paper  the a line   we may assume that the bus completes an integer
number of routes per day  and after each route the bus has no passengers left on 
mathematically  this is equivalent to finding individual entries of a m  m square matrix  with m the total
number of stops on the respective line  when only the row and column sums are known  the matrix n columns
and rows represent the individual stops si   with i              m   and nij   number of people boarding at stop
i who alight at stop j  as it is immediately apparent  the row sum for row i is the total numberve of people bi
boarding at stop si   whereas the column sum for column j is the total number of people aj alighting at stop
sj  
x
x
nij   bi and
nij   aj  
   
j

i

this problem is illustrated in table    above we assumed that no passengers board at the final stop  bm     
or alight at the initial stop  a        while the ai s and bi s are observable  the nij s are not and need to be
inferred  by definition  nij     for all i  j  since in this case no people have yet boarded at stop i who can
alight at j  this is the well known transit route origin destination  o d  problem 
 

stanford universitys free public transportation service

fi  approach

 

stop

s 

s 

s 

   

sm 

sm

s 
s 
s 
  
 

 
 
 
  
 

n   
 
 
  
 

n   
n   
 
  
 

   
   
   
  
 

n  m 
n  m 
n  m 
  
 

n  m
n  m
n  m
  
 

sm 
sm
origin
 boards 

 
 
b 

 
 
b 

 
 
b 

   
   
   

 
 

nm  m
 
bm

bm 

destination
 alights 
a 
a 
a 
  
 
am 
am

tab     transit route origin destination  od  matrix problem  the alight counts ai and board counts bi are
 
 
observable  while the transition counts n  i       m  j       m are not 
ij

 

approach

the problem of filling an origin destination matrix is highly underspecified  whereby there are many unknown
entries and only a few observations  for a given set of observed values of row and column sums there are
arbitrarily many solutions  and solving for integer entries is np hard 
there are many approaches in the literature that attempt to fill in the matrix elements nij using linear
algebra based approaches  such as the balancing method proposed by  lamond and stuart         there  a seed
o d matrix  with known entries obtained  e g   from historical data  is transformed by iteratively multiplying
each entry in a row with a certain number  such that the row sum matches the observed count  the disadvantage
of such linear algebraic methods is that they do not have a natural way to incorporate prior information  and
only look at a snapshots of the routes independently of eachother 
a dynamic approached is adopted by  hazelton         who looks at inference for o d matrices for the
time varying case  for a sequence of daily counts  they describe the day to day evolution of o d matrices using
a model of the day to day structural change in the matrix  e g   weekday vs  week end   the model parameters
are learned using bayesian inference on the time series data 
in the following we build upon a recent study by  li         which we outline below 

   

a markov decision model

 li        break down the transit route o d matrix filling problem into two parts  the estimation step and the
reconstruction step 
in the estimation step we make the important observation that a passenger boarding at sj can alight at
si only if he is onboard at stop si    we assume that the transition probability for stop si will depend only on
the passengers status at a small number of stops sk   sk          si    for some k          i      this motivates
the use of a markov chain model  mcm  to express transition probabilities 
for the sake of simplicity  in a first stage we look at a first order mcm  defining the random variable i by
i      if a passenger is on board at stop i  and i      if the passenger is not on board at stop i  the markov
transition probabilities become 
p r i     i      

  qi

p r i     i      

 

   

   qi  

for i              m     above  qi is the probability that a passenger alights at stop i given that they are onboard
at stop i     it is shown in  li        that the transition preference probability distribution across stops is
given by 
j 
y
pi i     qi   and pij   qj
    qk   j   i              m  
   
k i  

in the reconstruction step we use the obtained preference probability distribution to calculate the entries
of the sought od matrix 
d
n
   
ij   pij bi    i              m     j   i              m  
d
and n
ij     if i  j 

   

bayesian inference

in order to infer the markov parameters qj  j              m    li        propose that qj  beta j   j    using this
pj 
assumption and that aj  bin  k    bk  ak    qj    since the transition process is markov  see  li          one

fi  data processing and inspection

line name
a line
a line
a line
a line
  
 

date time
                   
                   
                   
                   

 

count type
boarding
boarding
alighting
boarding

count
 
 
  
  

stop label
quarry hooverpv
medicalc quarry
paloalto transc
paloalto transc

stop id
   
  
  
  

bus id
 
 
 
 

tab     marguerite data for the a line  excerpt   for example     people alighted at the palo alto transit
center on the   st of july                  and    people boarded at that stop on bus   
arrives at the following estimate on qj  
qj    j   aj    j   j  

j 
x

 
 bk  ak     j              m   

   

k  

the bayesian framework allows for incorporation of prior information  which is effectively the learning process
through which the initial non informative priors  j   j      can be updated to reflect the new information
after solving the od estimation problem for a training set of routes  we leave this aspect for a future study 
and concentrate here on the simpler approach of calculating the aggregate estimate of the whole set of routes
with non informative priors 

 
   

data processing and inspection
data retrieval

the p ts provided access to the marguerite shuttle data  which was in the form of several tens of sql odbc
tables stored remotely on the servers of a contractor company  a fair amount of interfacing with p ts and the
contractor was necessary in order to obtain the permissions for vpn access  we used commercial database and
spreadsheet software  ms access and excel  for inspecting the myriad tables available  constructing queries on
variables of interest across multiple tables and exporting results into a text format easily accessible to matlab 
an excerpt from a sample file obtained after processing is presented in table   

   

extracting route information

extracting route information from the p ts data proved to be particularly challenging  owing to the sheer
volume and format complexity of the available information  and to imperfections in the data relative to the
assumptions of the od matrix filling problem  for example  counts were not available for certain stops or
periods of time  there were multiple counts taken at the same time for certain stops and buses  or routes were
recorded to start at stops other than the designated initial stop  also  the p ts tables centralized counts from
all buses in service  averaging      at most times for the a line only   which meant that for mining the data
to extract routes we needed to keep track of the progress of every bus along the line 
our inspection of the data suggests that counts at the initial  and thus end route  stop are especially sensitive
to error sources such as the ones outlined above  for example  at the final stop a bus stations for a longer period
of time  during which several readings are taken  both alights and boards   which usually are large compared to
the ones at other stops along the line  it may also happen that passengers choose to board a few stops before
the end stop  and remain on the bus while it stations at the end stop  continuing their journey thereafter  in
particular  effects like these lead the total passenger count deficit for some completed trips 
d

m
x
j  

bj 

m
x

aj  

   

j  

to take values d       which contradicts a key assumption of the transit route od problem 
we sequentially parse the pre processed data to extract route information  storing information in a bus queue
as we proceed  see algorithm      our implementation uses a state machine and a queue for keeping track of
the stops visited by each bus  and of the routes completed  and thus is fairly robust to any change in the order
of which the count readings are processed  when a route is signaled to have ended with a non zero passenger
deficit  we divide up the value of last count  either board or alight  between the last stop of the completing
route and the first stop of the new route such that the last route had a total value of d      the balancing step
in algorithm     
we believe that  by far  the effect that plagues most our analysis is the non zero value of the passenger
deficit d for many of the routes  to obtain an intuition of how the deficit varies with time for the interval

fi  preliminary analysis

 

input  count readings  time series  as a matrix of the form in table  
output  completed routes  time series  in the form given in table  
 
 
 
 
 
 
 
 
 

initialize bus queue
foreach count reading do
if current stop    last stop in route then
queue   push queue  current stop info 
end
else
completed route   pop queue 
balance last count between completed route and new route to satisfy eq     
set route to transit route od format as in table  
 assign time stamp to each route as average time of visits to stops

  
  
  

store completed route in routes array
end
end
sort routes chronologically according to time stamp
algorithm    algorithm for extracting route information from pre processed counts data 

passenger count deficit

markov parameters q  timeaveraged 
 

  

   
   

  
   
   

q

 deficit 

  

   

  
   
  

   
   

 

   
  
 
 

     

date  dd mm 

fig     passenger count deficit d for the week of february  th         the deficit has two peaks around
    am and     pm  and is small around noon 

 

  

  

  

  

  

  

stop

fig     markov parameters q accross stops in the a line
 time averaged   by construction  at the secondto last stop q       and at the initial stop q      

considered we created plots such as the one in figure    such a plot can be useful as a crude measure of the
confidence in the estimate on the preference probability matrix p when considering variations on time scales
such as hour of day 

 

preliminary analysis

implementing the approach presented in section   is fairly straightforward  for each completed route obtained
as described in section   we estimate the markov parameters q using equation    which we use to infer the
preference probability matrix p  the entries of the od matrix n are calculated using equation    in a first
analysis we use non informative priors  and take the time averages of quantities of interest for the considered
interval  january april        during this interval there were      complete trips on the a line 
we plot the time averaged markov model parameters qj obtained with non informative priors j   j    
in figure    as the model requires  see section     at the second to last stop q       and at the initial stop
q       on average  people who board around the   th stop  quarry welch rd   will tend to remain on the bus
for more than one stop with a probability of      while people who board between stops    and     serram
mainquad through serra s campusw   will only stay on the bus for after the next stop with a     probability 
in figure   we illustrate the preference probability matrix estimate p  computed with non informative priors
j   j      and time averaged for january april       for this period  people who board at stop      quarry
welch rd through viaortega serra  have a     preference probability of alighting at the next stop or staying

  

fi  conclusions and future work

 

on the bus until stop     olmsted wellsly   people boarding from stop   through     quarry medcent   serra
burnhampa  have a similar preference probability of     of alighting at stop     serra mall oval   or stop   
 medschoo quarry   also  people seem to have higher preference        to alight at the latter stop if they
boarded at the former 

 

conclusions and future work

motivated by the problem of increasing
energy efficiency for the marguerite shuttle by better allocation of buses  we analyzed passenger count data for the a
line from january through march     
to determine passenger preference probability of boarding and alighting accross
stops 
to solve the associated transit route origin destination  od  matrix filling problem  we used an approach based on a first order markov
model an on bayesian analysis  the bulk
of our effort until now went into preprocessing the data and parsing it to extract complete od trips  interesting insights offered by a preliminary analysis
using non informative priors include  e g  
that passengers have high preference of
alighting at the medical school quarry  fig     preference probability matrix with non informative priors
 time averaged for january april       
if they boarded at the quarry welch
rd 
we plan to continue working on this problem to extend the approach outlined in section   as follows 
 incorporate bayesian learning  treat part of the data as training set  then use learned parameters as
priors for subsequent analysis on remaining data 
 replace first order markov model with a higher order model  as first order mcm tends to give preference
to very short trips  one stop  
 investigate temporal distribution of passenger preference probability by dividing up the data in time
intervals of interest and analyzing each interval separately  for this we plan to incorporate the time varying
model of  hazelton        with the  seemingly static  markov chain model of passenger boarding alighting
probability proposed pursued in this paper 
acknowledgements  the author would like to thank prof  balaji prabhakar  deepak marugu  and seewong
ou from the electrical engineering department  and catie chang from the computer science department at
stanford for fruitful discussions and suggestions  we are grateful to ramses madou and angus davol from the
stanford parking   transportation services for providing access to the marguerite shuttle data and helpful
hints about processing it 

references
 hazelton        hazelton  m  l          statistical inference for time varying origin destination matrices 
transportation research part b  methodological                 
 lamond and stuart        lamond  b  and stuart  n  f          bregmans balancing method  transportation
research b               
 li        li  b          markov models for bayesian analysis about transit route origin destination matrices 
transportation research part b  methodological               

fi