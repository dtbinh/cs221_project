 
december         
cs    final project
andrew beck
winnie cheng
franklin wu
integrated analysis of breast cancer gene expression  morphology  and patient survival
acknowledgements  we received support on this work from professor daphne koller  stephen gould  and daniela witten  we
thank drs rob west  matt van de rijn  and marc van de vijver for providing access to the nki breast cancer images 
i  introduction
since the mid   th century  scientists have recognized that the process of carcinogenesis produces characteristic morphological
changes in cancer cells  to this day  careful morphological analysis of microscopic images remains the single most important
diagnostic tool used to classify cancer in routine clinical practice  in the past decade  the molecular understanding of cancer has
increased tremendously  driven in large part by gene expression profiling experiments  which quantify the expression of virtually
all known transcripts in the human genome     despite widespread acceptance of the clinically and biologically useful
information contained in both morphological features and gene expression profiles  there has to date been no effort to
systematically integrate gene expression changes in cancer with a computational assessment of morphologic changes 
in this paper  we developed tools to permit an integrative analysis of gene expression and morphology  thus allowing the
identification of gene sets that are associated with morphologic phenotypes  to accomplish this  we first developed image
analysis tools to permit the measurement of tissue and cellular structures in breast cancer microscopic images  we then applied
sparse canonical correlation analysis  cca  to identify relatively small sets of genes that show maximal correlation with
relatively small sets of image features  lastly  we assessed the association of a score integrating data from image and gene
feature with patient survival  this analysis permits the first steps towards a molecular understanding of the morphologic
variability in breast cancer and suggest pathways through which molecular changes drive tumor morphologic changes  which
ultimately impact patient outcome 
ii  materials and methods
iia  breast cancer dataset
we are using the netherlands cancer institute  nki  dataset  which contains gene expression profiling data     k probes per
sample  and survival data from     breast cancer patients       this data is publically available  http   microarraypubs stanford edu wound nki explore html   in addition to the gene expression microarray and clinical data  we have obtained
         images per patient  microscopic images of h e stained breast cancer histologic sections from     of the nki patients 
iib  epithelial stromal and nuclear cytoplasmic segmentation
epithelial cancers are composed of two tissue compartments  the malignant epithelium  which contains the breast cancer cells 
and the cancer stroma  which contains a milieu of  supportive  cell types  including fibroblasts  endothelial cells  and smooth
muscle cells      the epithelium itself is comprised of individual epithelial cells  each of which contains a nucleus  with the
cell s genetic material  as well as the cytoplasm  all tissue and cellular compartments of cancer undergo changes  but these
changes are often most profound in the epithelial nuclei  as the nuclei contain dna  and cancer is primarily a disease of genetic
abnormalities  acquired and or inherited   therefore  an important first stage of our project was to develop a classifier to separate
epithelium from stroma  and then to develop a second classifier to work within epithelial cells to separate nuclei from cytoplasm 
to develop a classifier to distinguish tissue regions  epithelium and stroma  and cellular regions  nucleus and
cytoplasm   we adapted a standard pixelwise crf model  as described as the baseline method in gould et al       given an
image  composed of pixels   region class labels   and pixel appearance vector    this model took the form of a unified
energy function 
                                where  is a multi class logistic over boosted appearance
features   is a boundary penalty to encourage adjacent pixels to take the same value  and  are model parameters  the model
was implemented using functions provided in the stair vision library      for each pixel in the training set  the local pixel
appearance vector  was constructed with both raw image features of the pixel and of surrounding pixels  the raw features
measured for the pixel and surrounding pixels are the    dimensional color and texture features determined in shotton et al      
in training the classifier  the raw image features are augmented by region predictions made by a one vs all boosted classifier
trained on the raw features of a given pixel s neighboring pixels  inference of region label is performed with a two sage hill
climbing approach to minimize the energy function 

fi 
to obtain ground truth labels  a pathologist  ab  manually labeled a subset of images     images were labeled for the
epithelial stromal classifier   after epithelial stromal segmentation and prior to nuclear segmentation  the epithelial images were
further processed to remove inflammatory cells  by implementing the strel and imopen functions in matlab  which
morphologically open the image based on a structure element  a threshold is then applied to this opened image and the pixel
locations of the thresholded image are mapped to the original image of epithelium  with most inflammatory cells  which tend to
be smaller and less cohesive than the epithelial cells  filtered out  following this step  ground truth labels were obtained for
nuclei and cytoplasm from   images and a nuclear cytoplasmic classifier was trained and applied to the segmented epithelial
regions  following identification of nuclear regions  as described above   we performed segmentation of individual nuclei using
an adaptive otsu approach      
iic  image feature extraction
to measure epithelial and stromal image features  we have developed an epithelial nuclear feature measurement pipeline and a
stromal feature measurement pipeline using the open source cellprofiler software  http   www cellprofiler org    which
implements routines in matlab  we measured a variety of descriptors of image texture and heterogeneity as well as nuclear size 
shape  intensity  texture  and crowding  following development of the image feature extractions pipelines  we used the analytic
pipelines to measure     epithelial features and     stromal features from our set of      images obtained from     patients 
for features measured from individual nuclei  we summarized the measurements per image by taking the mean  this process
produced a     patient by     image feature data matrix 
iid  identification of sets of genes that show maximal correlation with sparse sets of morphologic features
a primary goal of this project was to identify gene expression patterns that show maximal correlation with morphological
phenotypes  a natural unsupervised learning algorithm for achieving this goal is canonical correlation analysis  cca   the cca
procedure was initially proposed by hotelling in          and can be applied to this project as follows  let x  denote the n x p 
data matrix of image features with n samples and p  image features  and let x  denote the n x p  data matrix of gene expression
features with n samples and p  gene expression features  we first standardize the features in each dataset to have mean zero and
standard deviation of    the cca procedure will produce a p  dimensional weight vector w  and a p  dimensional weight vector
w  that maximize the cca criterion 
                                     
standard cca is difficult to implement with high dimensional data  where the numbers of features measured  p  far exceeds the
number of samples  n   given the large number of image and gene features measured in our study  we chose to implement a
penalized form of cca to produce sparse linear combinations of genes highly correlated with sparse linear combinations of
image features  we implemented penalized cca using the technique of witten et al          with the package  pmd  in the r
language for statistical computing  http   cran r project org    the sparse cca criterion is as follows 
 
 
                                                
the l   lasso       penalty applied to the weight vectors  w  and w                           has the effect of
driving most weights to zero for small values of the tuning parameter c  resulting in sparse and more easily interpretable sets of
image and gene features with non zero weights  it is noted that the sparse cca criterion is biconvex  and with   fixed is
convex in     and with   fixed is convex in     and thus can be solved by an iterative algorithm  in which   is initialized to
have an   norm   and the following   steps are repeated until convergence      
 
      arg                             
 

      arg                             
to select the penalty terms c  and c   we evaluated ten sets of c  and c  values evenly spaced within a range from   to p  and
p   respectively  during each of these ten trials  sparse cca is performed with a given set of tuning parameters c  and c  to
generate a pair of weight vectors  w  w   and the value of            is recorded  the significance of the
             for a given set of c  and c  is estimated by permutations  we performed     permutations  during each  the
samples in x  and x  are randomly permuted to obtain matrices        sparse cca was then performed on the permuted
data to generate      and               the sparse cca algorithm then implements fisher s transformation to
convert the real correlation and set of     permuted correlations into random variables that were approximately normally
distributed  which we denote as fc and fc   a p value is then computed for each pair of w  w  resulting from a given value of the
tuning parameter c  as the fraction of the     fc  that exceed fc  we ultimately selected tuning parameters c  and c  that gave a
high               low p value  and an easily interpretable number of non zero weights  to compute a second
approximately orthogonal set of feature weights  w    w        it is noted that the the sparse cca criterion can be re formulated as
 
 
maximizing                                            where           z  is then

fi 
computed as                the optimization problem stated above is then repeated with z  replacing z   we chose to
compute only two factors for this project  however  the above procedure may be repeated to obtain as many sets of weight
vectors as desired    
iid  analysis of functional gene set enrichment
following identification of genes with non zero values in the gene weight vector for factors   and    we identified biological
pathways significantly enriched in the sets of genes positively and negatively associated with the linear combination of image
features by uploading our gene sets to the david set of bioinformatics resources    and identifying clusters of annotation terms
with highly significant enrichment in our gene sets 
iie  survival analysis
to assess the association of the image gene feature combinations with survival  we computed a single score for each patient that
we called the image gene score  igs   which was simply the sum of the linear combinations of image features and gene
features for the two factors  for a given sample  i   where    denotes the ith row of matrix x and     denotes the weight vector
for the kth factor  
   
   
   
   
                                   
to assess  the association of the igs score with survival  we discretized the scores into three quantiles  plotted kaplan meier
survival curves  and performed the log rank test to assess statistical significance  to assess the additive effect of the igs for
predicting survival in a multivariate model containing histologic grade  we fitted a cox proportional hazards model    and
computed p values to assess the probability that the igs and grade were each contributing to the predictive accuracy of the
model 

iii  results
iiia  development of epithelial stromal classifier and nuclear cytoplasmic classifier
for the purposes of quantitatively assessing accuracy  we trained the classifier on     of our labeled images and tested it on the
remaining      the epithelial stromal classifier achieved an overall accuracy of     with recall precision of           on
background            on epithelium  and           on stroma  an example test image is provided in figure    we have not yet
labeled enough nuclear cytoplasmic regions on images to permit a quantitative evaluation of the nuclear cytoplasmic classifier
on new images  but it achieved an overall accuracy of      on the training images and qualitatively performed well on the new
images in the dataset  we also have not yet quantitatively assessed the accuracy of the nuclear region segmentation or nuclear
measurements  however  they appear to work well in most cases 

figure    segmented breast cancer image from test set  a  h e stained microscopic image of breast cancer  b  image with
superimposed labeling of epithelium  red  and stroma  green   c  outlines of segmented stromal nuclei objects  d  h e stained
segmented epithelial region  e  epithelial region is further subdivided into nuclear  red  and cytoplasmic  green  regions  f 
outlines of segmented epithelial nuclei objects 

iiib  identification of highly correlated gene expression and image features as described in materials and methods  we
performed sparse canonical correlation analysis with   factors and selected tuning parameters c  and c  based on the resulting
              significance of the correlation  and desired number of non zero weights for images and genes  a plot of the
observed correlation for the set of ten penalty terms tested is shown in figure    we selected c         and c          which gave
                           and resulted in       non zero gene weights and     non zero image feature weights 

fi 

iiic  biological analysis of sets of highly correlated gene expression and image features
the   image features with non zero weights in factor   were all measurements of stromal density  functional gene set
enrichment analysis of the      genes with non zero weights in factor   shows that the set of genes with non zero weights  both
positive and negative  is most enriched for membrane glycoproteins  bonferroni p    e     the    image features with non zero
weights in factor   were descriptors of epithelial nuclear size  shape  and texture  functional gene set enrichment analysis of the
     genes with non zero weights in factor   shows that the set of genes with positive weights is highly significantly enriched
for proteins operating in the stroma extracellular matrix  bonferroni p      e     and the set of genes with negative weights is
highly significantly enriched for proteins that operate in cell cycle regulation  bonferroni p      e      these findings represent
the first step to a detailed understanding of the gene expression patterns driving stromal and epithelial morphologic variability in
breast cancer  the findings from factor   suggest that the expression of membrane glycoproteins may be a regulator of stromal
density  analysis of the factor   gene set suggests that the expression of a coherent set of extracellular matrix proteins is
negatively correlated with the expression of a set of proteins regulating dna replication  these findings suggest a network of
epithelial stromal interactions and provide a candidate list of  likely  epithelial  including  tnfsf  b  pttg   ccnb   and
stromal proteins  including  tgfb   col a   spon   sparc  whose interaction is tightly correlated with nuclear
morphologic changes 
iiid  analysis of patient survival
although we did not supervise our sparse cca analysis with survival data  it seemed plausible that genes with non zero weights
may be mechanistically important drivers of patient survival  as they were chosen due to their high correlation with tumor
morphologic changes  to assess this hypothesis  as described in the materials and methods  we computed an igs score for each
patient to summarize the gene and image linear combinations generated by sparse cca  we stratified patients into three equalsized groups based on their igs score and plotted kaplan meier curves  which demonstrated significantly different survival rates
in the three groups  log rank test p    e     figure     we fit a cox proportional hazards survival model with grade and the
discretized igs score and found that both features contributed prognostic information to the model  both p         
a  kaplan meier survival curves
b  cox multivariate survival analysis

figure    survival analysis  a  kaplan meier survival curve of breast cancer cases stratified by igfs into   quantiles  the y
axis is probability of survival and the x axis is time in years  the log rank test compares the equality of the three survival
functions  the p value indicates that the probability of equality of the three survival functions is  e    b  a multivariate cox
proportional hazards survival model was fitted with discretized igfs and grade  which were both independent predictors of


survival in the model  the cox model takes the form        exp
  
   
   where   represents patient
i s risk of death at time t     is the baseline hazard function  and the  are the coefficients for the covariates in the model    
exp coef  can be interpreted as multiplicative effects of the covariates on the hazard  holding grade constant  an igs score of  
reduces the yearly risk of death by     compared to an igs score of    column z displays the ratio of each regression
coefficient to its standard error  which is a wald statistic  both igs and grade have significant coefficients and their z s are

fi 
associated with low p values  the logrank test p value on the final row indicates the probability of the truth of the null hypothesis
that all of the  s are zero  this hypothesis is rejected 

iv  conclusions
in this paper  we developed methods for computational analysis of tumor morphology and integration of these measurements
with gene expression data and patient survival data  using sparse cca  we identified two factors  each comprised of a set of
genes highly correlated with a set of image features  the image features in the first factor were entirely stromal  and the image
features in the second factor were entirely epithelial nuclear  functional gene set analysis of genes with non zero weights in
factor   suggests that membrane glycoproteins may be important regulators of stromal morphology  analysis of the factor  
gene set demonstrated that the genes with positive weights were highly significantly enriched for proteins operating in the
stroma extracellular matrix  while genes with negative weights were highly significantly enriched for proteins that regulate dna
replication cell cycle  these findings suggest that this set of stromal and cell cycle proteins likely interact in a pathway that
directly impacts epithelial nuclear morphologic changes  since the sparse cca analysis was designed to identify genes and
image features that were mutually correlated  it seemed likely that these sets of morphologic and molecular changes might be
mechanistically important and associated with patient survival  to assess the association of the factors identified by sparse cca
with outcome  we simply added the linear combinations of the gene and image features from the two factors into a unified score
 igs   we found that the igs was highly associated with patient survival and provided additional prognostic information to
histological grade  taken together  our findings suggest that the integration of molecular and morphologic measurements
represents a promising new strategy for studying breast cancer biology and for identifying sets of genes and image features
associated with patient outcome 
references 
   
a  k  abbas  r  s  cotran  n  fausto  v  kumar  j  a  perkins and s  l  robbins  robbins and cotran pathologic basis of
disease  print digital   elsevier saunders  philadelphia       
   
p  o  brown and d  botstein  exploring the new world of the genome with dna microarrays  nat genet             pp 
     
   
d  r  cox  regression models and life tables  journal of the royal statistical society  series b  methodological         
pp          
   
j  fox  cox proportional hazards regression for survival data  an r and splus companion to applied regression        
   
s  gould  r  fulton and d  koller  decomposing a scene into geometric and semantically consistent regions  iccv 
     
   
s  gould  a  y  ng and d  koller  the stair vision library       
   
s  gross  sparse canonical correlation analysis for the integrative analysis of genomic data user guide and technical
document  department of statistics  stanford university 
   
h  hotelling  relations between two sets of variates  biometrika             pp          
   
w  huang da  b  t  sherman and r  a  lempicki  systematic and integrative analysis of large gene lists using david
bioinformatics resources  nat protoc            pp        
    
n  otsu  a threshold selection method from gray level histograms  automatica             pp          
    
j  shotton  j  winn  c  rother and a  criminisi  textonboost  joint appearance  shape and context modeling for multiclass object recognition and segmentation  lecture notes in computer science               pp    
    
r  tibshirani  regression shrinkage and selection via the lasso  journal of the royal statistical society  series b
 methodological              pp          
    
m  j  van de vijver  y  d  he  l  j  van t veer  h  dai  a  a  hart  d  w  voskuil  g  j  schreiber  j  l  peterse  c  roberts  m 
j  marton  m  parrish  d  atsma  a  witteveen  a  glas  l  delahaye  t  van der velde  h  bartelink  s  rodenhuis  e  t 
rutgers  s  h  friend and r  bernards  a gene expression signature as a predictor of survival in breast cancer  n engl j
med              pp            
    
d  m  witten  r  tibshirani and t  hastie  a penalized matrix decomposition  with applications to sparse principal
components and canonical correlation analysis  biostatistics             pp         
    
d  m  witten and r  j  tibshirani  extensions of sparse canonical correlation analysis with applications to genomic
data  statistical applications in genetics and molecular biology           

fi