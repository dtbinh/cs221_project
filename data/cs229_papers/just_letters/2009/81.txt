hedging and pricing options
 using machine learning 
jacob michelsen kolind  jon harris
and karol przybytkowski
december         
introduction

discretely rebalanced trading strategy will
only approximately hedge the option  and
it is not immediately clear how to choose
the proportion of wealth to invest in the
underlying security at each trade  if we
abstract away from choosing the size of
the time steps between portfolio adjustments  we are left with an interesting machine learning problem  how do we optimally choose the proportion of wealth to
invest in the security  the so called delta 
  so that the value of our portfolio at the
next readjustment point in time is as close
as possible to the actual options price 

options hedging has important applications in risk management  in its most simple form  options hedging is a trading strategy in a security and a risk free bank account  an option written on the security
is hedged by this strategy if the strategy
is self financing  and replicates the price of
the option at all times and in all states
of the world  in the simple black scholes
model  where only one source of uncertainty is present  it can be shown that such
strategies do exist and an analytical expression can be found for the proportion of
wealth that should be invested in the underlying security  for an options seller as
well as an options buyer  this trading strategy is important to know  since being short
the option but long the hedging strategy or
vice versa allows the seller buyer to eliminate the risk associated with selling buying
the option 
in a real life setting  many of the blackscholes assumptions are violated  there
are many sources of risk and agents incur transaction costs  so a perfect hedging strategy cannot be expected to exist  a more realistic approach for an options trader is to minimize  not eliminate 
their risk by rebalancing their portfolio discretely  the size of the time steps between adjustments would then depend on
the volatility of the market  the size of the
portfolio  and the size of the transaction
costs incurred at each trading round  a

data
we consider options data on the
s p    index from the period                        to                         
our data set contains tick by tick data of
every trade made in call and put options
on the index  each observation contains
the following variables 
   the time at which the trade took
place  t 
   the type of the option  call or put  
   the strike price of the option  k 
   the maturity date of the option  t  
   the s p     index price  s 
   the price of the option  p  
   an implied volatility proxy   
since the numeraire in price data can be arbitrarily chosen  there is some redundancy
in our data set  we choose to use the strike

 

fifigure    left panel  a  d scatter plot of the call options data including a fitted mesh 
right panel  a  d scatter plot of the observed deltas including a fitted mesh 
in the right panel of figure   we have plotted dp ds for those observations where
ds       dp ds corresponds to the value
of  that would make the loss gain of the
hedging portfolio equal to zero 

price as the numeraire and thus henceforth
only look at moneyness  log s k   and
calliness puttiness  p k  ignoring the
time aspect of the data we have plotted  the
dots 
p k   log s k    t  t  

methodology

in the left panel of figure    qualitatively
the data behaves very much as would be expected from the black scholes model  close
to maturity  p k as a function of s k
resembles a hockey stick  whereas further
away from maturity this hockey stick has
been smoothed out  the data contains a
high degree of time variation  this cannot be seen from left panel of figure    but
a closer inspection of the data reveals that
the surface has a positive thickness  if market conditions were stable arbitrage would
force the surface to have zero thickness 
by identifying options with the same
strike and maturity date  we extracted oneday movements in option prices and included that as an extra column in our data 
 dp    corresponding to these one day
movements  we also extracted the movements in the s p    index   ds   ignoring
interest payments  the gain loss of a strategy that buys one option and sells  units
of the index at time t and then reverses
these trades at time t     is

we explore two ways to model the price
and the optimal hedge  parametrically and
non parametrically  the goal of both models is first to be able to fit the surfaces like
the one displayed in figure    for the price
surface we use a weighted squared error loss
function
pi   wi  pi  pi   
where wi is a weight that will be specified
shortly  for the delta surface we use the
loss function
 i   
 i   wi  dpi  ds

  
  wi dsi   dpi  dsi   
i e  a weighted version of the squared
loss gain of the one day hedge  minimizing both loss functions results in an wls
 respectively when
estimator of p and 
these are considered as being functions of
the covariates log moneyness log s k  and
time to maturity t  t  since neither surface looks like a hyperplane we approximate them using fourth order tensor spline
by a b spline basis expansion of the standard linear design matrix  our parametric

 p  t       s t         p  t   s t  
  dp  t   ds t 

 

fifigure    left panel  seven days trailing realized volatility calculated from the spot
s p    index price  right panel  a plot of the cross section at     t  t     
of the data plotted in the right panel of figure    the blue points are fitted
values 
servation i  and t is the time at which the
model is used for prediction  the nonparametric model weighs data points observed just prior to a point of prediction
more heavily than data points observed further away in the past   

model also includes a third covariate  trailing realized volatility      a measure of the
observed market volatility during the last
seven days before the data point  trailing realized volatility  depicted in the left
panel of figure    is added to the parametric model as a linear factor independent
of the tensor spline basis in log s k  and
t t  our calculations of realized volatility
follows  to some extent  the papers by andersen et  al        and barndorff nielsen
et  al       
the trailing realized volatility is included
in the parametric model to accomodate
the time variation inherent in the data 
that is  we use the trailing realized volatility as a proxy for the time variation in
the data  and hope that the observed call
prices deltas can be described as noisy
observations of a function of the vector
 log s k   t  t     in the parametric
model wi     
another way of incorporating timevariation into our model  the nonparametric approach  is to let the weights
 wi   account for the time variation  our
approach is to let

results
examples of how our models fit to the data
are displayed in the panels of figure    the
plotted grids represent the fitted spline surfaces 
it is most interesting to focus on the performance of our delta estimates  in the
left panel of figure    a histogram of the
distribution of gains losses using predicted
deltas for the month of april      is displayed  in the right panel  the corresponding distribution of gains losses using black
scholes deltas is displayed  the black scholes deltas are simply calculated using the
formula


log s k     r          t  t 

 n
 t t

where  is the implied volatility and r is the
the risk free interest rate  the black scwhere ti is the time corresponding to ob  holes delta should result in a perfect hedge
wi   e tti     ti      t   ti  

 

 is a fixed cutoff that sets weights that would otherwise have been very small to zero  this mitigates
some of the computational burden involved in fitting the non parametric model 

 

fifigure    left panel  a histogram of the distribution of gains losses using predicted
deltas from the non parametric model with      day for the month of april
      right panel  the corresponding plot for black scholes deltas 
whether the better performance of our
delta estimates is due to the fact that the
data was not generated from the black scholes model  we generated a simulated
data set using the black scholes model 
using the strikes  the times and the maturities from our original data  we then
applied the two ways of predicting deltas
to the simulated data  the result can be
seen in figure    again our model outperforms the black scholes formula  the average absolute loss gains are  respectively 

with continuous rebalancing of the hedging portfolio  but with discrete rebalancing the bs delta can be seen as a first
order approximation to an optimal delta 
our deltas perform slightly better than the
black scholes deltas  the average absolute
loss gains are  respectively            on
the training data            on the test set
with black scholes deltas  and          
on the test set with the non parametric
spline and      
it

seems

interesting

to

investigate

figure    left panel  a histogram of the distribution of gains losses using predicted
deltas from the non parametric model with      day for the month of april
     on the simulated data  right panel  the corresponding plot for black
scholes deltas 

 

fifigure    left panel  real data right panel  simulated data  the red dots are calculated
using black scholes deltas  blue dots are spline fitted deltas 
          on the training data            e g  hedging straddles  but these kinds of
on the test set with black scholes deltas  strategies requires insight an opinon about
and           on the test set with the non  future volatility 
parametric spline and      
we do not present any results from the
figure   gives some intuition behind why parametric model  since it  in its current
our method outperforms the black scholes form  performed worse than the black scdelta  there is a convexity effect inher  holes deltas 
ent in the black scholes deltas that creates large gains when the underlying stock
moves a lot  our method specifically targets these large movements  using ds   as a
weight in the fitting  to try to minimize the
impact of these movements on the loss gain
in the hedging portfolio  the point cloud
representing gains losses using our models
thus curves less than the point cloud corresponding to the analytical black scholes
deltas  we are aware that some trading
strategies exploit the convexity effect by

conclusion
we have presented a new way of estimating
good delta hedges using tensor splines  the
methods we developed seem to work well
on simulated as well as real data  and generally outperform the generic choice  the
analytical black scholes delta hedging formula  related to our work are the papers
by hutchinson et  al         lai et  al  
     and bennell et  al        

references
andersen t  g   bollerslev t   diebold f  x  and labys p   modeling and forecasting realized volatility 
econometrica  vol      no     mar          pp          
barndorff nielsen o  e  and shephard n   econometric analysis of realized volatility and its use in
estimating stochastic volatility models  journal of the royal statistical society  series b  statistical
methodology   vol      no            pp          
bennell j  and sutcliffe c   black scholes versus artificial neural networks in pricing ftse     options 
intelligent systems in accounting  finance   management  vol     issue        pp          
hutchinson j   lo a  and poggio t   a nonparametric approach to pricing and hedging derivative
securities via learning networks  journal of finance  vol          pp          
lai t l  and wong s   valuation of american options via basis functions  ieee transactions on automatic control  vol          pp          

 

fi