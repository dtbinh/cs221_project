automatic identification of glomerulus in the antenna lobe of drosophila
melanogaster
li liu  stflily stanford edu 
liang liang  liangl stanford edu 
project for cs    
dec        
abstract
antenna lobe  al  in the drosophila brain is composed of     glomeruli  each of the glomeruli
has a stereotyped shape  position  and neuronal composition  however  manually identification
of the glomeruli usually is very time consuming and demands high familiarity with the structure 
in this project  we applied principle component analysis method via singular value
decomposition to identify a single glomerulus in al      training examples were used to
construct the eigen basis for the al image  based on the coefficient of constructing al eigen
basis  the eigen basis for the target glomerulus images in the training set was also calculated  to
identify the target glomerulus in the test examples  its al image information was used as the
input  the test results from the about    examples showed reasonably good reliability and
robustness of the algorithm  although we only trained the algorithm to identify a certain
glomerulus  v glomerulus  in this case  this approach should also be applicable to other
glomeruli so that many glomeruli in the al can be recognized automatically 
   introduction
     antenna lobe and glomeruli
al is the primary odor processing center in the model organism drosophila melanogaster  fruit
fly   over the last decade  biological research on neurons in al has provided many insights on
the development  organization  and information processing of the neural circuit        al has a
very clear and stereotyped anatomy  one al is composed of about    glomeruli  compactly
packed into a  d structure  each glomerulus has its specific shape and localization in al       
 fig     usually  a certain al olfactory neuron innervates a single or a certain combination of
glomeruli  by identifying the innervated glomeruli  the neuronal identity can be assigned  thus
in many studies on these neurons  an important step is to identify the glomeruli  this is usually
accomplished by carefully comparing the morphology with a reference  like fig  b  and requires
a lot of experience and time from the researcher  it would thus be very useful to develop an
automatic method to reliably identify the glomeruli in al 
     motivation and principles
we propose to address the problem by first training an algorithm to recognize one of glomerulus 
then similar approach can be applied to the identification of other glomeruli one by one  in the
end  given an al image  a tagged al like that in fig   b can be automatically generated  to
achieve one glomerulus identification  we can take advantage of the neuronal organization in the
al  there are     classes of odorant sensory neurons  osn  in the fly  osn project their axons
into the al and each class of osn converge their axonal terminals into a single glomerulus 
there are genetic methods available to label each class of the osn  by labeling a single class of
osn  the corresponding glomerulus is labeled as well  this biological approach can be utilized
to train the computer where the target glomerulus is localized  on the other hand  the whole al
morphology  as well as other neuropil  can be immunostained with specific synaptic markers
independently from the orn labeling  we will use the image from samples with both al and

fitarget glomerulus labeled to train the algorithm and then when a new image with only al is
introduced  the glomeruli identity will be assigned to it 
to develop the algorithm  we started from some intuitive methods based on our observation of
the al and target glomerulus  but these methods may lack the generality to other glomerulus and
we thought a general machine learning method might be more robust  specifically  we figured
that the glomeruli identification is somehow similar to the face recognition problem and we
might borrow some principles from the latter one 
principle component analysis  pca  is a widely used method for face recognition  in pca  a set
of eigenfaces are first abstracted from the training data  through the projection operation  a
face image can be calculated as a weighted sum of the eigenfaces  by comparing these weights
to those of known individuals  a new face can be recognized      eigenfaces with large singular
values represent the more general features of the given faces  while those corresponding to
relatively small singular values feature the variation among the faces  the eigenfaces with really
tiny singular values can be to some extent treated as the unexpected distortion in the training
data 

figure    anatomy for a fly brain and a al  a  scheme of the anatomy of a fly brain  an al was circled out  b  a
more detailed scheme for the circled al as shown in a  the al as seen from the anterior  lateral is to the right 
dorsal on top     glomeruli are named in this figure        

in the case of glomeruli identification  we took advantage of the correlation between the two
intensity matrices in the same example  al matrix  labeling mostly al and some other brain
regions  and target glomerulus matrix  only highlighting the glomerulus we are trying to identify
   and correlated their eigenfaces  specifically  the al matrices were used to calculate the eigen
basis for the al feature space  technically  each al eigen basis can be represented as the
weighted sum of the training al vectors  the same weights were then used to calculate the
corresponding eigen basis for the target glomerulus feature space  when a new al image was
given  it was projected to the al eigen basis and the coefficients of the projection was treated as
the weights to sum up the target glomerulus eigen basis and thus construct the target glomerulus
for the new al image  the location of the constructed glomerulus in the new al image therefore
was assigned the identity of the target glomerulus 
moreover  we tried to avoid possible local distortions in the images and to predict the location of

fithe glomerulus in its most reasonably possible place  we figured data compression  reduce the
matrix dimention  could mitigate those undesired intensity fluctuations  besides  we also
dropped the singular vectors with tiny singular values when we constructed the basis  this
improved the recognition result and lowered the computation complexity  in addition  the images
were scanned with roughly good alignment from symmetry intuition of the experimenter  which
dramatically reduces the dimension of basic space and allows the use of techniques similar to
face recognition for glomeruli identification 
   methods and results
    al and target glomerulus images
the al and target glomerulus  v glomerulus  labeled with gr  a gal   uas rfp  images in
the training and test set were obtained by confocal laser scanning microscrope in liqun luo lab
at dept of biology in stanford university  for each fly sample  the whole brain was dissected out
and immunostained against the presynaptic marker nc    labeling neuropil and thus revealing
al as well as other brain region structures  and the rfp  labeling the target glomerulus   the
secondary antibodies are conjugated with different fluorophores so that the neuropil and target
glomerulus can be spectrally separated  the neuropil  al regions  was in the purple channel
whereas the target glomerulus was scanned in the red channel as shown in fig    since the al is
about   um  um  um        single plane images were taken  with  um step in between  to
go through the whole depth of al  at each single z plane  a     pixel     pixel scanning was
performed at a resolution of     pixels um  the zoom in the x y dimension was slightly adjusted
from sample to sample so that the scanned als were about similar sizes laterally  an example
scanned sample is shown in fig    the target glomerulus usually spans     of the entire z stack 

figure   al and target glomerulus images from a sample  a  the al images  b target glomerulus images  c 
overlay of the al and target glomerulus images      the maximum projection of the whole z stack  z total is         
                single z plane image from z    z     z     z     z     respectively    a  b  c  al is labeled in
purple  target glomerulus is labeled in red 

    data processing

fieach sample image usually contains       z planes  each z plane  denoted as an example  has
two separate channels  one for al and one for the target glomerulus  the training set is a
collection of     single z plane images  examples  from   al samples  with    examples per
sample  usually the middle ones of the z stack  we didn t choose exactly the same z planes cross
samples  since the samples had different sizes and occupied different depth  and there was no
standard reference points at which to start and end the z stack during image acquisition  just
roughly from the emergence to the disappearance of the al  each example was read by
matlab as a           matrix  where     is the number of pixels in x y dimension and  
refers to the two sets of matrices  al and the target glomerulus  
the scanned images usually contained noises  due to the nonspecific immunostaining  and had
regions outside al labeled  we manually removed those images either with too much noise or at
undesired z plane  with a lot of other brain regions  beforehand  which comprised about     of
the total collected data 
another step we took at this stage was data compression  to reduce random noises  due to shot
noise and dark noise  and to reduce the data dimension  by reducing the dimension from
       to       the processing time dropped from         minutes to a few seconds  with not
much influence on the target glomerulus identifying accuracy  but   x   was not mandatory  and
we actually worked on images at both        and      resolutions 
    eigen basis construction
the    x    intensity matrix for each channel in a given example was reshaped into a       
     x     dimension vector  a       x    al training matrix m  m   m         m     was thus
formed where each column represented one al training image  similarly  n  n   n         n    
was used to denote the training matrix of the target glomerulus  the mean value of m   m        
m     mmean  was then subtracted from m   m        m    to form m    m    m          m       the
al image of mmean is shown in figure   

figure   the mean of   x   al images in the training set  note 
al is artificially labeled in red instead of purple for the
convenience of displaying images 

in order to centralize the final decision of the position of the targeted glomerulus  we also preeliminated all the points whose intensities were smaller than a particular threshold in the
glomerulus    by setting the corresponding matrix element to zero  in our particular example  we
set the threshold to be     of the maximum intensity value in each column 
the left singular vectors of m  formed the eigen vectors of the whole al image space  due to
the extremely high dimensions  it was impractical to do singular value decomposition in
matlab directly  a viable approach was to find the left singular vectors from their

ficorresponding right singular vectors whereas the right singular vectors were eigenvectors of
m tm   a        matrix 
the formula to transform from right unitary singular vectors to left unitary singular vectors is
 
  where
is the non zero th eigenvalue of m tm  
is the th
given by
t
unitary eigenvector of m  m  or the th right unitary singular vector of m   and is the th left
singular value 
singular vectors corresponding to the singular values smaller than a certain threshold were
dropped  since we had about     training examples in this case  we set the threshold to be
       of the largest singular value  the eigen basis space we obtained in the end was composed
of about    eigenvectors  the first   al eigen images were shown in the red channel in fig   
    identify the target glomerulus in each of the eigen basis vectors
the eigen basis for the target glomerulus was calculated based on the principle discussed in
section      the eigen basis for al matrix was first obtained  each eigen basis can be considered
as an linear combination of all the example al vectors  the column vector of m  to calculate
  for example  the coefficients were actually the corresponding elements in   the same
coefficient for the linear combination was used to form the eigen basis for the target glomerulus
matrix  mathematically  the matrices corresponding to the al and target glomerulus are m   
m    m        m      and n    n    n        n        u   u      uk   
   in our case  form the


  then
gives the th
eigen basis of the al image space  and
eigen basis vector for the target glomerulus image space  the plot of the first   eigen basis with
the corresponding glomerulus labels are shown in the green channel in fig    from    x    and
  x   respectively for comparison  

figure    the first   calculated eigen images at    x    and   x   resolutions  a  eigen images at    x   
resolution  b  eigen images at   x   resolution  red  al channel  green  target glomerulus channel  yellow 
overlay 

to get an idea about the singular vectors corresponding to relatively small singular values we
also plotted the   th and   th singular vector in fig    in these plots  the intensity was relatively

fiuniformly distributed and didnt even fit into the preliminary shape of al  it confirmed our
speculations that they rather carried the noise information  another important aspect worth
noticing was that we almost couldnt see any target glomerulus labeling there  which also
validated our decision to drop these singular vectors corresponding to really small singular
values 

figure    the   th and   th eigen images
at    x     a  and   x   resolution  red 
al channel  green  target glomerulus
channel  yellow  overlay 

    test principle and result
the    test examples were collected under the same imaging conditions  and selected from the
same criteria regarding to the z plane  noise level and image distortion  the same preprocessing
steps were carried on these test examples  we also made sure that none of the test examples were
taken from samples used in the training set 
to identify the position of target glomerulus in the test examples  our strategy was to construct
the target glomerulus based on the al image in the same example set  to achieve that  we first
projected the al matrix of the test example onto the al eigen basis vectors  u   u         uk     as
was usually done in the face recognition process  then the same set of projection coefficients
were used to calculate the weighted combination of the target glomeurlus eigen basis vectors
t
 b w   where b
m
u   and u   w are
 w   w         wk      mathematically  n
the eigenbasis for the al matrix and target glomerulus matrix  randomly chosen results are
shown in fig    we can see that the algorithm can predict pretty well the location of the target
glomerulus when the test al image is close to the mean of training al image  fig   b  b   
when the test al image is far off the mean of training al image  the predicted target glomerulus
is roughly around the true region 

fifigure    the test result of predicting target glomerulus position at    x    and   x   resolutions  a  three
samples of the predicted target glomerulus position at    x    resolution  red  test al image  green  predicted
target glomerulus  yellow  overlay  b  three samples of the predicted target glomerulus position at   x  
resolution  for each bi  the image on the left is the overlay between the real target glomerulus  red  and the
predicted target glomerulus  green   the image on the right is the overlay between the al  red  and the predicted
target glomerulus  green  

   discussions and future work
the approach we applied to identify the glomerulus in our project mainly originated from the
pca face recognition algorithm  although the estimation on the position of the target glomerulus
was quite satisfactory  our method didnt fully utilize the information contained in both the
training and test data  or capture the unique properties of this specific problem  both the training
and test data describe dynamic process  data went through a series of z planes  and a close
observation showed that there was actually a close relationship between the intensity change of
the elements for the target glomerulus and non target glomerulus parts over the zs  plots of the
intensity change of the glomerulus randomly chosen from the training example in contrast with
the non target intensity change are shown in fig   
the plots of intensity change shows that the intensity for the target glomerulus is more
concentrated on the left side  corresponding to smaller z numbers   their intensity is also less
spread and generally has only one peak  one the other hand  the intensity of non glomeruli
elements are more sparsely distributed and could have multiple peaks  those differences could
x x y   y  
be mathematically captured with x  x y    y   var 

fifigure    the intensity change with depth  a  the intensity change of the glomerulus region over depth from four
samples  b  the intensity change of the non glomerulus region over depth from four samples  the y axis is the
intensity  and the x axis is the depth  number of the z plane  

however full dependence on those features  as we tried  was not an optimal choice  the test error
from the true value was more obvious  our next step is to try to combine these two approaches to
see if we could get better results 

   references
  
  
  
  
  
  
  
  

olsen  s r  and r i  wilson  lateral presynaptic inhibition mediates gain control in an olfactory circuit 
nature                   p         
wang  j w   et al   two photon calcium imaging reveals an odor evoked map of activity in the fly brain 
cell                p         
vosshall  l b  and r f  stocker  molecular architecture of smell and taste in drosophila  annu rev
neurosci            p         
komiyama  t   et al   graded expression of semaphorin  a cell autonomously directs dendritic targeting of
olfactory projection neurons  cell                p          
laissue  p p   et al   three dimensional reconstruction of the antennal lobe in drosophila melanogaster  j
comp neurol                p         
couto  a   m  alenius  and b j  dickson  molecular  anatomical  and functional organization of the
drosophila olfactory system  curr biol                p          
turk  m  and a  pentland  eigenfaces for recognition  journal of cognitive neuroscience              p 
      
heisenberg  m   mushroom body memoir  from maps to models  nat rev neurosci              p         

fi